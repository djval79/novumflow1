# PgBouncer Configuration for CareFlow AI
# Connection pooler to prevent database connection exhaustion

[databases]
careflow_db = host=aws-0-us-west-1.pooler.supabase.com port=5432

[pgbouncer]
# Pool settings
pool_mode = transaction
max_client_conn = 100
default_pool_size = 20
min_pool_size = 5
reserve_pool_size = 5
reserve_pool_timeout = 5
max_db_connections = 50
max_user_connections = 50

# Timeouts
server_reset_query = DISCARD ALL
server_check_delay = 30
server_check_query = select 1
server_lifetime = 3600
server_idle_timeout = 600

# Logging
log_connections = 1
log_disconnections = 1
log_pooler_errors = 1
admin_users = postgres
stats_users = stats, postgres

# Authentication
auth_type = md5
auth_file = /etc/pgbouncer/userlist.txt

# Listen address
listen_addr = 127.0.0.1
listen_port = 6432

# Unix socket for local connections
unix_socket_dir = /tmp

# TLS settings (optional, recommended for production)
client_tls_sslmode = prefer
server_tls_sslmode = require