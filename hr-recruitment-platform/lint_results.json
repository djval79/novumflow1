[{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/capacitor.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/check-analytics-data.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/check-seeded-data.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/check-templates.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/check_tables.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/check_workflow.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/configure-leave-rules.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/deployComplianceSchema.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/deploy_migration.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/deploy_missing_compliance.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/deploy_sync_trigger.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/diagnose-login.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/inspect-schema.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/playwright.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/scripts/analyze-har.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/scripts/enable-careflow.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/scripts/generate-manifest.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/scripts/generate-sitemap.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/scripts/verify-sync.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/seed-analytics-data-v2.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/seed-analytics-data-v3.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/seed-analytics-data.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/App.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LandingPage' is defined but never used. Allowed unused vars must match /^_/u.","line":38,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect } from 'react';\nimport { automationService } from '@/lib/services/AutomationService';\nimport { BrowserRouter, Routes, Route, Navigate, useLocation } from 'react-router-dom';\nimport { AuthProvider, useAuth } from './contexts/AuthContext';\nimport { TenantProvider } from './contexts/TenantContext';\nimport { QueryProvider } from './contexts/QueryProvider';\nimport { PWAUpdateNotification } from './components/PWAUpdateNotification';\nimport AppLayout from './components/AppLayout';\nimport FeatureRoute from './components/FeatureRoute';\nimport LoginPage from './pages/LoginPage';\nimport SignUpPage from './pages/SignUpPage';\nimport ForgotPasswordPage from './pages/ForgotPasswordPage';\nimport ResetPasswordPage from './pages/ResetPasswordPage';\nimport DashboardPage from './pages/DashboardPage';\nimport HRModulePage from './pages/HRModulePage';\nimport RecruitmentPage from './pages/RecruitmentPage';\nimport LettersPage from './pages/LettersPage';\nimport SettingsPage from './pages/SettingsPage';\nimport RecruitSettingsPage from './pages/RecruitSettingsPage';\nimport CompliancePage from './pages/CompliancePage';\nimport BiometricPage from './pages/BiometricPage';\nimport AutomationPage from './pages/AutomationPage';\nimport DocumentsPage from './pages/DocumentsPage';\nimport MessagingPage from './pages/MessagingPage';\nimport NoticeBoardPage from './pages/NoticeBoardPage';\nimport PerformancePage from './pages/PerformancePage';\nimport IntegrationsPage from './pages/IntegrationsPage';\nimport FormsPage from './pages/FormsPage';\nimport TenantManagementPage from './pages/TenantManagementPage';\nimport ComplianceDashboardPage from './pages/ComplianceDashboardPage';\nimport ComplianceHubPage from './pages/ComplianceHubPage';\nimport AuditLogPage from './pages/AuditLogPage';\nimport PrivacyPage from './pages/PrivacyPage';\nimport SupportPage from './pages/SupportPage';\nimport InspectorDashboard from './pages/InspectorDashboard';\nimport StaffPassportPage from './pages/StaffPassportPage';\nimport StaffPortalPage from './pages/StaffPortalPage';\nimport LandingPage from './pages/LandingPage';\nimport TenantSignupPage from './pages/TenantSignupPage';\nimport AdminPortalPage from './pages/AdminPortalPage';\nimport AdminSecurityDashboard from './pages/AdminSecurityDashboard';\nimport AttendancePage from './pages/AttendancePage';\nimport ReportsPage from './pages/ReportsPage';\nimport TeamPage from './pages/TeamPage';\nimport OnboardingPage from './pages/OnboardingPage';\nimport TrainingPage from './pages/TrainingPage';\nimport ComplianceFormsPage from './pages/ComplianceFormsPage';\nimport WorkforceManagementPage from './pages/WorkforceManagementPage';\nimport GovernanceDashboard from './pages/GovernanceDashboard';\n\nfunction ProtectedRoute({ children }: { children: React.ReactNode }) {\n  const { user, profile, loading } = useAuth();\n  const location = useLocation();\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600\"></div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return <Navigate to=\"/login\" replace />;\n  }\n\n  // RBAC: Smart Redirects\n  // If user is a 'carer' (and NOT a super admin), they are restricted to the Staff Portal and Passport\n  // We allow them to access /staff-portal, /my-passport, /documents, /noticeboard, /training\n  const restrictedRoutes = ['/dashboard', '/hr', '/recruitment', '/settings', '/compliance-dashboard'];\n  const isRestrictedUser = profile?.role === 'carer' || profile?.role === 'staff';\n  const isSuperAdmin = profile?.is_super_admin;\n\n  if (isRestrictedUser && !isSuperAdmin) {\n    // If they are trying to access a restricted route, bounce them to portal\n    // We check if the current path STARTS with any restricted path\n    const isTryingRestricted = restrictedRoutes.some(route => location.pathname.startsWith(route));\n\n    // Also, if they are at root '/', send them to portal instead of dashboard\n    if (location.pathname === '/' || isTryingRestricted) {\n      return <Navigate to=\"/staff-portal\" replace />;\n    }\n  }\n\n  return <>{children}</>;\n}\n\nfunction PublicRoute({ children }: { children: React.ReactNode }) {\n  const { user, loading } = useAuth();\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600\"></div>\n      </div>\n    );\n  }\n\n  if (user) {\n    return <Navigate to=\"/dashboard\" replace />;\n  }\n\n  return <>{children}</>;\n}\n\n\n\n\nfunction App() {\n  useEffect(() => {\n    // Service is initialized on import, but we can add cleanup here if needed\n    return () => {\n      automationService.cleanup();\n    };\n  }, []);\n\n  return (\n    <QueryProvider>\n      <AuthProvider>\n        <TenantProvider>\n          <BrowserRouter>\n            <PWAUpdateNotification />\n            <Routes>\n              {/* Public Routes */}\n              <Route\n                path=\"/login\"\n                element={\n                  <PublicRoute>\n                    <LoginPage />\n                  </PublicRoute>\n                }\n              />\n              <Route\n                path=\"/signup\"\n                element={\n                  <PublicRoute>\n                    <SignUpPage />\n                  </PublicRoute>\n                }\n              />\n              <Route path=\"/forgot-password\" element={<ForgotPasswordPage />} />\n              <Route path=\"/reset-password\" element={<ResetPasswordPage />} />\n              <Route path=\"/privacy\" element={<PrivacyPage />} />\n              <Route path=\"/support\" element={<SupportPage />} />\n              <Route path=\"/tenant/create\" element={<TenantSignupPage />} />\n\n              {/* Protected Routes */}\n              <Route\n                path=\"/\"\n                element={\n                  <ProtectedRoute>\n                    <AppLayout />\n                  </ProtectedRoute>\n                }\n              >\n                <Route index element={<Navigate to=\"/dashboard\" replace />} />\n                <Route path=\"dashboard\" element={<FeatureRoute feature=\"dashboard\"><DashboardPage /></FeatureRoute>} />\n                <Route path=\"hr\" element={<FeatureRoute feature=\"hr_module\"><HRModulePage /></FeatureRoute>} />\n                <Route path=\"recruitment\" element={<FeatureRoute feature=\"recruitment\"><RecruitmentPage /></FeatureRoute>} />\n                <Route path=\"performance\" element={<FeatureRoute feature=\"performance\"><PerformancePage /></FeatureRoute>} />\n                <Route path=\"integrations\" element={<FeatureRoute feature=\"integrations\"><IntegrationsPage /></FeatureRoute>} />\n                <Route path=\"documents\" element={<FeatureRoute feature=\"documents\"><DocumentsPage /></FeatureRoute>} />\n                <Route path=\"messaging\" element={<FeatureRoute feature=\"messaging\"><MessagingPage /></FeatureRoute>} />\n                <Route path=\"noticeboard\" element={<FeatureRoute feature=\"noticeboard\"><NoticeBoardPage /></FeatureRoute>} />\n                <Route path=\"compliance\" element={<FeatureRoute feature=\"compliance\"><CompliancePage /></FeatureRoute>} />\n                <Route path=\"biometric\" element={<FeatureRoute feature=\"biometric\"><BiometricPage /></FeatureRoute>} />\n                <Route path=\"automation\" element={<FeatureRoute feature=\"automation\"><AutomationPage /></FeatureRoute>} />\n                <Route path=\"letters\" element={<FeatureRoute feature=\"letters\"><LettersPage /></FeatureRoute>} />\n                <Route path=\"settings\" element={<FeatureRoute feature=\"settings\"><SettingsPage /></FeatureRoute>} />\n                <Route path=\"recruit-settings\" element={<FeatureRoute feature=\"recruit_settings\"><RecruitSettingsPage /></FeatureRoute>} />\n                <Route path=\"forms\" element={<FeatureRoute feature=\"forms\"><FormsPage /></FeatureRoute>} />\n                <Route path=\"tenant-management\" element={<TenantManagementPage />} />\n                <Route path=\"compliance-dashboard\" element={<ComplianceDashboardPage />} />\n                <Route path=\"compliance-hub\" element={<ComplianceHubPage />} />\n                <Route path=\"compliance-forms\" element={<ComplianceFormsPage />} />\n                <Route path=\"audit-logs\" element={<AuditLogPage />} />\n                <Route path=\"admin\" element={<AdminPortalPage />} />\n                <Route path=\"admin/security\" element={<AdminSecurityDashboard />} />\n                <Route path=\"attendance\" element={<AttendancePage />} />\n                <Route path=\"reports\" element={<ReportsPage />} />\n                <Route path=\"team\" element={<TeamPage />} />\n                <Route path=\"onboarding\" element={<OnboardingPage />} />\n                <Route path=\"training\" element={<TrainingPage />} />\n                <Route path=\"workforce-management\" element={<WorkforceManagementPage />} />\n                <Route path=\"governance\" element={<GovernanceDashboard />} />\n              </Route>\n\n              {/* Standalone Protected Routes (No App Layout) */}\n              <Route\n                path=\"/inspector-mode\"\n                element={\n                  <ProtectedRoute>\n                    <InspectorDashboard />\n                  </ProtectedRoute>\n                }\n              />\n              <Route\n                path=\"/my-passport\"\n                element={\n                  <ProtectedRoute>\n                    <StaffPassportPage />\n                  </ProtectedRoute>\n                }\n              />\n              <Route\n                path=\"/staff-portal\"\n                element={\n                  <ProtectedRoute>\n                    <StaffPortalPage />\n                  </ProtectedRoute>\n                }\n              />\n\n              {/* Landing Page - currently shadowed by protected root */}{/* <Route path=\"/\" element={<LandingPage />} /> */}\n\n              {/* Catch all */}\n              <Route path=\"*\" element={<Navigate to=\"/\" replace />} />\n            </Routes>\n          </BrowserRouter>\n        </TenantProvider>\n      </AuthProvider>\n    </QueryProvider>\n  );\n}\n\nexport default App;\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/ActivityTimeline.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadActivities'. Either include it or remove the dependency array.","line":32,"column":8,"nodeType":"ArrayExpression","endLine":32,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [currentTenant, loadActivities]","fix":{"range":[1208,1223],"text":"[currentTenant, loadActivities]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport { useTenant } from '@/contexts/TenantContext';\nimport {\n    User, Briefcase, FileText, Calendar, Bell, CheckCircle,\n    AlertTriangle, Clock, ArrowRight, MessageSquare, X\n} from 'lucide-react';\nimport { format, formatDistanceToNow, parseISO } from 'date-fns';\n\ninterface ActivityEvent {\n    id: string;\n    type: 'employee_added' | 'application_received' | 'interview_scheduled' | 'document_uploaded' |\n    'offer_sent' | 'employee_onboarded' | 'leave_requested' | 'training_completed' |\n    'compliance_alert' | 'message_received';\n    title: string;\n    description: string;\n    timestamp: string;\n    user?: string;\n    metadata?: Record<string, any>;\n}\n\nexport default function ActivityTimeline() {\n    const { currentTenant } = useTenant();\n    const [activities, setActivities] = useState<ActivityEvent[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [filter, setFilter] = useState<string>('all');\n    const [selectedActivity, setSelectedActivity] = useState<ActivityEvent | null>(null);\n\n    useEffect(() => {\n        loadActivities();\n    }, [currentTenant]);\n\n    function mapActionToType(action: string, entityType: string): ActivityEvent['type'] {\n        if (entityType === 'employee' && action === 'CREATE') return 'employee_added';\n        if (entityType === 'application') return 'application_received';\n        if (entityType === 'interview') return 'interview_scheduled';\n        if (entityType === 'document') return 'document_uploaded';\n        if (entityType === 'training') return 'training_completed';\n        if (entityType === 'leave_request') return 'leave_requested';\n        if (entityType === 'employee_digital_skills') return 'employee_onboarded';\n        if (entityType === 'jobs') return 'offer_sent';\n        return 'employee_added';\n    }\n\n    function formatActivityTitle(action: string, entityType: string, entityName: string, metadata?: any): string {\n        const entityLabel = {\n            'employee': 'Employee Profile',\n            'application': 'Job Application',\n            'interview': 'Interview Session',\n            'leave_request': 'Leave Request',\n            'jobs': 'New Role',\n            'employee_digital_skills': 'Skill Matrix',\n            'email_templates': 'Communication Template'\n        }[entityType] || entityType;\n\n        if (action === 'CREATE') {\n            if (entityType === 'leave_request') return `New Leave Request Filed`;\n            if (entityType === 'jobs') return `New Role Posted: ${entityName}`;\n            if (entityType === 'employee_digital_skills') return `New Digital Skill Verified`;\n            return `New ${entityLabel} Registered`;\n        }\n\n        if (action === 'UPDATE') {\n            if (entityType === 'application' && metadata?.status) {\n                return `Application moved to ${metadata.status}`;\n            }\n            if (entityType === 'leave_request' && metadata?.status) {\n                return `Leave Request ${metadata.status}`;\n            }\n            return `${entityLabel} Profile Updated`;\n        }\n\n        if (action === 'DELETE') return `${entityLabel} Removed`;\n\n        return `${entityLabel} ${action.toLowerCase()}`;\n    }\n\n    async function loadActivities() {\n        setLoading(true);\n        try {\n            const { data, error } = await supabase\n                .from('audit_logs')\n                .select('*')\n                .eq('tenant_id', currentTenant?.id)\n                .order('timestamp', { ascending: false })\n                .limit(50);\n\n            if (error) throw error;\n\n            if (!data || data.length === 0) {\n                setActivities(generateMockActivities());\n                return;\n            }\n\n            // Transform audit logs to activity events\n            const events: ActivityEvent[] = data.map(log => ({\n                id: log.id,\n                type: mapActionToType(log.action, log.entity_type),\n                title: formatActivityTitle(log.action, log.entity_type, log.entity_name, log.changes),\n                description: log.entity_name || 'System event',\n                timestamp: log.timestamp,\n                user: log.user_email?.split('@')[0].replace('.', ' '),\n                metadata: log.changes,\n            }));\n\n            setActivities(events);\n        } catch (error) {\n            log.error('Error loading activities', error, { component: 'ActivityTimeline', action: 'loadActivities' });\n            setActivities(generateMockActivities());\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    function generateMockActivities(): ActivityEvent[] {\n        const now = new Date();\n        const types: ActivityEvent['type'][] = [\n            'employee_added', 'application_received', 'interview_scheduled',\n            'document_uploaded', 'offer_sent', 'leave_requested', 'training_completed',\n            'compliance_alert', 'message_received'\n        ];\n\n        return Array.from({ length: 20 }, (_, i) => {\n            const type = types[Math.floor(Math.random() * types.length)];\n            const timestamp = new Date(now.getTime() - i * 3600000 * (1 + Math.random()));\n\n            return {\n                id: `activity-${i}`,\n                type,\n                title: getMockTitle(type),\n                description: getMockDescription(type),\n                timestamp: timestamp.toISOString(),\n                user: ['John Smith', 'Sarah Johnson', 'Michael Chen', 'Emma Wilson'][Math.floor(Math.random() * 4)],\n            };\n        });\n    }\n\n    function getMockTitle(type: ActivityEvent['type']): string {\n        const titles: Record<string, string> = {\n            employee_added: 'New employee added',\n            application_received: 'New application received',\n            interview_scheduled: 'Interview scheduled',\n            document_uploaded: 'Document uploaded',\n            offer_sent: 'Offer letter sent',\n            employee_onboarded: 'Employee onboarded',\n            leave_requested: 'Leave request submitted',\n            training_completed: 'Training completed',\n            compliance_alert: 'Compliance alert',\n            message_received: 'New message received',\n        };\n        return titles[type] || 'Activity';\n    }\n\n    function getMockDescription(type: ActivityEvent['type']): string {\n        const descriptions: Record<string, string[]> = {\n            employee_added: ['Sarah Wilson joined as Senior Developer', 'Michael Chen joined as Product Manager'],\n            application_received: ['Application for Senior Developer position', 'Application for Marketing Manager'],\n            interview_scheduled: ['Interview with James Brown at 2:00 PM', 'Final round with Emily Davis'],\n            document_uploaded: ['Employment contract uploaded', 'DBS certificate uploaded'],\n            offer_sent: ['Offer sent to candidate Sarah W.', 'Revised offer sent to John D.'],\n            employee_onboarded: ['Emma completed onboarding checklist', 'Robert started orientation'],\n            leave_requested: ['Annual leave request for Dec 20-27', 'Sick leave request for today'],\n            training_completed: ['Fire safety training completed', 'GDPR training completed'],\n            compliance_alert: ['DBS check expiring in 30 days', 'Training certificate expired'],\n            message_received: ['New message from HR department', 'Reply from IT support'],\n        };\n        const options = descriptions[type] || ['Activity occurred'];\n        return options[Math.floor(Math.random() * options.length)];\n    }\n\n    function getActivityIcon(type: ActivityEvent['type']) {\n        const icons: Record<string, { icon: React.ReactNode; color: string; bg: string }> = {\n            employee_added: { icon: <User className=\"w-4 h-4\" />, color: 'text-blue-600', bg: 'bg-blue-100' },\n            application_received: { icon: <Briefcase className=\"w-4 h-4\" />, color: 'text-green-600', bg: 'bg-green-100' },\n            interview_scheduled: { icon: <Calendar className=\"w-4 h-4\" />, color: 'text-purple-600', bg: 'bg-purple-100' },\n            document_uploaded: { icon: <FileText className=\"w-4 h-4\" />, color: 'text-orange-600', bg: 'bg-orange-100' },\n            offer_sent: { icon: <CheckCircle className=\"w-4 h-4\" />, color: 'text-teal-600', bg: 'bg-teal-100' },\n            employee_onboarded: { icon: <User className=\"w-4 h-4\" />, color: 'text-indigo-600', bg: 'bg-indigo-100' },\n            leave_requested: { icon: <Clock className=\"w-4 h-4\" />, color: 'text-yellow-600', bg: 'bg-yellow-100' },\n            training_completed: { icon: <CheckCircle className=\"w-4 h-4\" />, color: 'text-green-600', bg: 'bg-green-100' },\n            compliance_alert: { icon: <AlertTriangle className=\"w-4 h-4\" />, color: 'text-red-600', bg: 'bg-red-100' },\n            message_received: { icon: <MessageSquare className=\"w-4 h-4\" />, color: 'text-blue-600', bg: 'bg-blue-100' },\n        };\n        return icons[type] || { icon: <Bell className=\"w-4 h-4\" />, color: 'text-gray-600', bg: 'bg-gray-100' };\n    }\n\n    const filterOptions = [\n        { value: 'all', label: 'All Activity' },\n        { value: 'employee', label: 'Employees' },\n        { value: 'recruitment', label: 'Recruitment' },\n        { value: 'documents', label: 'Documents' },\n        { value: 'compliance', label: 'Compliance' },\n    ];\n\n    const filteredActivities = filter === 'all'\n        ? activities\n        : activities.filter(a => {\n            if (filter === 'employee') return ['employee_added', 'employee_onboarded', 'leave_requested'].includes(a.type);\n            if (filter === 'recruitment') return ['application_received', 'interview_scheduled', 'offer_sent'].includes(a.type);\n            if (filter === 'documents') return a.type === 'document_uploaded';\n            if (filter === 'compliance') return ['training_completed', 'compliance_alert'].includes(a.type);\n            return true;\n        });\n\n    if (loading) {\n        return (\n            <div className=\"bg-white rounded-xl border border-gray-200 p-6\">\n                <div className=\"animate-pulse space-y-4\">\n                    <div className=\"h-6 bg-gray-200 rounded w-1/4\" />\n                    {[1, 2, 3, 4, 5].map(i => (\n                        <div key={i} className=\"flex items-start space-x-3\">\n                            <div className=\"w-10 h-10 bg-gray-200 rounded-full\" />\n                            <div className=\"flex-1 space-y-2\">\n                                <div className=\"h-4 bg-gray-200 rounded w-3/4\" />\n                                <div className=\"h-3 bg-gray-100 rounded w-1/2\" />\n                            </div>\n                        </div>\n                    ))}\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"bg-white rounded-xl border border-gray-200 overflow-hidden\">\n            {/* Header */}\n            <div className=\"px-6 py-4 border-b border-gray-200\">\n                <div className=\"flex items-center justify-between\">\n                    <h2 className=\"text-lg font-semibold text-gray-900\">Activity Timeline</h2>\n                    <select\n                        value={filter}\n                        onChange={(e) => setFilter(e.target.value)}\n                        className=\"px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none\"\n                    >\n                        {filterOptions.map(option => (\n                            <option key={option.value} value={option.value}>{option.label}</option>\n                        ))}\n                    </select>\n                </div>\n            </div>\n\n            {/* Timeline */}\n            <div className=\"p-6\">\n                <div className=\"relative\">\n                    {/* Timeline line */}\n                    <div className=\"absolute left-5 top-0 bottom-0 w-0.5 bg-gray-200\" />\n\n                    {/* Events */}\n                    <div className=\"space-y-6\">\n                        {filteredActivities.map((activity, index) => {\n                            const { icon, color, bg } = getActivityIcon(activity.type);\n                            const isFirst = index === 0;\n\n                            return (\n                                <div key={activity.id} className=\"relative flex items-start group\">\n                                    {/* Icon */}\n                                    <div className={`relative z-10 flex items-center justify-center w-10 h-10 rounded-full ${bg} ${color} ring-4 ring-white`}>\n                                        {icon}\n                                    </div>\n\n                                    {/* Content */}\n                                    <div\n                                        className=\"ml-4 flex-1 min-w-0 p-3 bg-gray-50 rounded-lg group-hover:bg-gray-100 transition cursor-pointer\"\n                                        onClick={() => setSelectedActivity(activity)}\n                                    >\n                                        <div className=\"flex items-center justify-between\">\n                                            <p className=\"text-sm font-medium text-gray-900\">{activity.title}</p>\n                                            <span className=\"text-xs text-gray-500\">\n                                                {formatDistanceToNow(parseISO(activity.timestamp), { addSuffix: true })}\n                                            </span>\n                                        </div>\n                                        <p className=\"text-sm text-gray-600 mt-0.5\">{activity.description}</p>\n                                        {activity.user && (\n                                            <p className=\"text-xs text-gray-400 mt-1\">by {activity.user}</p>\n                                        )}\n                                    </div>\n\n                                    {/* \"New\" badge for recent items */}\n                                    {isFirst && (\n                                        <span className=\"absolute -left-1 top-0 px-2 py-0.5 bg-indigo-600 text-white text-xs font-medium rounded-full\">\n                                            New\n                                        </span>\n                                    )}\n                                </div>\n                            );\n                        })}\n                    </div>\n                </div>\n\n                {/* Load More */}\n                {filteredActivities.length > 0 && (\n                    <div className=\"mt-6 text-center\">\n                        <button className=\"text-indigo-600 hover:text-indigo-700 text-sm font-medium inline-flex items-center\">\n                            Load more activities\n                            <ArrowRight className=\"w-4 h-4 ml-1\" />\n                        </button>\n                    </div>\n                )}\n\n                {filteredActivities.length === 0 && (\n                    <div className=\"text-center py-12 text-gray-500\">\n                        <Clock className=\"w-12 h-12 mx-auto mb-2 text-gray-300\" />\n                        <p>No activities found</p>\n                    </div>\n                )}\n            </div>\n\n            {/* Activity Detail Modal */}\n            {selectedActivity && (\n                <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n                    <div className=\"bg-white rounded-xl max-w-md w-full overflow-hidden\">\n                        <div className=\"px-6 py-4 border-b border-gray-200 flex items-center justify-between\">\n                            <h3 className=\"font-semibold text-gray-900\">Activity Details</h3>\n                            <button onClick={() => setSelectedActivity(null)} className=\"text-gray-400 hover:text-gray-600\">\n                                <X className=\"w-5 h-5\" />\n                            </button>\n                        </div>\n                        <div className=\"p-6 space-y-4\">\n                            <div className=\"flex items-center space-x-3\">\n                                <div className={`p-2 rounded-lg ${getActivityIcon(selectedActivity.type).bg}`}>\n                                    {getActivityIcon(selectedActivity.type).icon}\n                                </div>\n                                <div>\n                                    <p className=\"font-medium text-gray-900\">{selectedActivity.title}</p>\n                                    <p className=\"text-sm text-gray-500 capitalize\">{selectedActivity.type.replace(/_/g, ' ')}</p>\n                                </div>\n                            </div>\n                            <div>\n                                <p className=\"text-sm text-gray-600\">{selectedActivity.description}</p>\n                            </div>\n                            <div className=\"text-sm text-gray-500\">\n                                <p><strong>Time:</strong> {format(parseISO(selectedActivity.timestamp), 'PPpp')}</p>\n                                {selectedActivity.user && <p><strong>User:</strong> {selectedActivity.user}</p>}\n                            </div>\n                            {selectedActivity.metadata && (\n                                <div>\n                                    <p className=\"text-sm font-medium text-gray-700 mb-2\">Additional Details</p>\n                                    <pre className=\"text-xs bg-gray-50 p-3 rounded-lg overflow-auto max-h-32\">\n                                        {JSON.stringify(selectedActivity.metadata, null, 2)}\n                                    </pre>\n                                </div>\n                            )}\n                        </div>\n                        <div className=\"px-6 py-4 bg-gray-50 flex justify-end\">\n                            <button\n                                onClick={() => setSelectedActivity(null)}\n                                className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition\"\n                            >\n                                Close\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/AddApplicationModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/AddCriteriaModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/AddEmployeeModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'supabaseAnonKey' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":48}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport Modal from './Modal';\nimport { supabase, supabaseUrl, supabaseAnonKey } from '@/lib/supabase';\nimport { useAuth } from '@/contexts/AuthContext';\n\ninterface AddEmployeeModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess: () => void;\n  onError: (message: string) => void;\n}\n\nexport default function AddEmployeeModal({ isOpen, onClose, onSuccess, onError }: AddEmployeeModalProps) {\n  const { user } = useAuth();\n  const [loading, setLoading] = useState(false);\n  const [formData, setFormData] = useState({\n    first_name: '',\n    last_name: '',\n    email: '',\n    phone: '',\n    employee_number: '',\n    department: '',\n    position: '',\n    employment_type: 'full_time',\n    date_of_birth: '',\n    date_hired: '',\n    salary: '',\n    salary_grade: '',\n    status: 'active'\n  });\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      // Get the user's session token\n      const { data: { session } } = await supabase.auth.getSession();\n      if (!session) {\n        throw new Error('No active session');\n      }\n\n      const response = await fetch(\n        `${supabaseUrl}/functions/v1/employee-crud`,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${session.access_token}`\n          },\n          body: JSON.stringify({\n            action: 'create',\n            data: {\n              ...formData,\n              salary_grade: formData.salary_grade,\n              created_by: user?.id\n            }\n          })\n        }\n      );\n\n      const result = await response.json();\n\n      if (response.ok && result.data) {\n        onSuccess();\n        onClose();\n        setFormData({\n          first_name: '',\n          last_name: '',\n          email: '',\n          phone: '',\n          employee_number: '',\n          department: '',\n          position: '',\n          employment_type: 'full_time',\n          date_of_birth: '',\n          date_hired: '',\n          salary: '',\n          salary_grade: '',\n          status: 'active'\n        });\n      } else {\n        throw new Error(result.error?.message || 'Failed to create employee');\n      }\n    } catch (error: any) {\n      onError(error.message || 'Failed to create employee');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <Modal isOpen={isOpen} onClose={onClose} title=\"Add New Employee\" maxWidth=\"max-w-4xl\">\n      <form onSubmit={handleSubmit} className=\"space-y-4\">\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">First Name *</label>\n            <input\n              type=\"text\"\n              required\n              value={formData.first_name}\n              onChange={(e) => setFormData({ ...formData, first_name: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Last Name *</label>\n            <input\n              type=\"text\"\n              required\n              value={formData.last_name}\n              onChange={(e) => setFormData({ ...formData, last_name: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Email *</label>\n            <input\n              type=\"email\"\n              required\n              value={formData.email}\n              onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Phone</label>\n            <input\n              type=\"tel\"\n              value={formData.phone}\n              onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Employee Number *</label>\n            <input\n              type=\"text\"\n              required\n              value={formData.employee_number}\n              onChange={(e) => setFormData({ ...formData, employee_number: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Department *</label>\n            <input\n              type=\"text\"\n              required\n              value={formData.department}\n              onChange={(e) => setFormData({ ...formData, department: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Position *</label>\n            <input\n              type=\"text\"\n              required\n              value={formData.position}\n              onChange={(e) => setFormData({ ...formData, position: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Employment Type</label>\n            <select\n              value={formData.employment_type}\n              onChange={(e) => setFormData({ ...formData, employment_type: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n            >\n              <option value=\"full_time\">Full Time</option>\n              <option value=\"part_time\">Part Time</option>\n              <option value=\"contract\">Contract</option>\n              <option value=\"intern\">Intern</option>\n            </select>\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Date of Birth</label>\n            <input\n              type=\"date\"\n              value={formData.date_of_birth}\n              onChange={(e) => setFormData({ ...formData, date_of_birth: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Hire Date *</label>\n            <input\n              type=\"date\"\n              required\n              value={formData.date_hired}\n              onChange={(e) => setFormData({ ...formData, date_hired: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Annual Salary (Â£)</label>\n            <input\n              type=\"number\"\n              min=\"0\"\n              max=\"999999\"\n              step=\"1000\"\n              placeholder=\"e.g. 45000\"\n              value={formData.salary}\n              onChange={(e) => setFormData({ ...formData, salary: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Status</label>\n            <select\n              value={formData.status}\n              onChange={(e) => setFormData({ ...formData, status: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n            >\n              <option value=\"active\">Active</option>\n              <option value=\"on_leave\">On Leave</option>\n              <option value=\"terminated\">Terminated</option>\n            </select>\n          </div>\n        </div>\n\n        <div className=\"flex justify-end gap-3 mt-6 pt-4 border-t border-gray-200\">\n          <button\n            type=\"button\"\n            onClick={onClose}\n            className=\"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition\"\n          >\n            Cancel\n          </button>\n          <button\n            type=\"submit\"\n            disabled={loading}\n            className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50\"\n          >\n            {loading ? 'Adding...' : 'Add Employee'}\n          </button>\n        </div>\n      </form>\n    </Modal>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/AddGoalModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/AddInterviewModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/AddJobModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/AddKPIModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/AddLeaveRequestModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'supabaseAnonKey' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":48}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport Modal from './Modal';\nimport { supabase, supabaseUrl, supabaseAnonKey } from '@/lib/supabase';\nimport { useAuth } from '@/contexts/AuthContext';\n\ninterface AddLeaveRequestModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess: () => void;\n  onError: (message: string) => void;\n}\n\nexport default function AddLeaveRequestModal({ isOpen, onClose, onSuccess, onError }: AddLeaveRequestModalProps) {\n  const { user } = useAuth();\n  const [loading, setLoading] = useState(false);\n  const [employees, setEmployees] = useState<any[]>([]);\n  const [formData, setFormData] = useState({\n    employee_id: '',\n    leave_type: 'annual',\n    start_date: '',\n    end_date: '',\n    reason: '',\n    status: 'pending'\n  });\n\n  useEffect(() => {\n    if (isOpen) {\n      loadEmployees();\n    }\n  }, [isOpen]);\n\n  async function loadEmployees() {\n    const { data } = await supabase\n      .from('employees')\n      .select('id, first_name, last_name, employee_number')\n      .eq('status', 'active')\n      .order('first_name');\n    setEmployees(data || []);\n  }\n\n  const calculateDays = () => {\n    if (formData.start_date && formData.end_date) {\n      const start = new Date(formData.start_date);\n      const end = new Date(formData.end_date);\n      const diffTime = Math.abs(end.getTime() - start.getTime());\n      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;\n      return diffDays;\n    }\n    return 0;\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      const totalDays = calculateDays();\n      \n      // Get the user's session token\n      const { data: { session } } = await supabase.auth.getSession();\n      if (!session) {\n        throw new Error('No active session');\n      }\n\n      const response = await fetch(\n        `${supabaseUrl}/functions/v1/process-leave-request`,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${session.access_token}`\n          },\n          body: JSON.stringify({\n            leaveRequest: {\n              ...formData,\n              total_days: totalDays,\n              requested_by: user?.id\n            }\n          })\n        }\n      );\n\n      const result = await response.json();\n\n      if (response.ok && result.data) {\n        onSuccess();\n        onClose();\n        setFormData({\n          employee_id: '',\n          leave_type: 'annual',\n          start_date: '',\n          end_date: '',\n          reason: '',\n          status: 'pending'\n        });\n      } else {\n        throw new Error(result.error?.message || 'Failed to create leave request');\n      }\n    } catch (error: any) {\n      onError(error.message || 'Failed to create leave request');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <Modal isOpen={isOpen} onClose={onClose} title=\"Add Leave Request\">\n      <form onSubmit={handleSubmit} className=\"space-y-4\">\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">Employee *</label>\n          <select\n            required\n            value={formData.employee_id}\n            onChange={(e) => setFormData({ ...formData, employee_id: e.target.value })}\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n          >\n            <option value=\"\">Select Employee</option>\n            {employees.map((emp) => (\n              <option key={emp.id} value={emp.id}>\n                {emp.employee_number} - {emp.first_name} {emp.last_name}\n              </option>\n            ))}\n          </select>\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">Leave Type *</label>\n          <select\n            required\n            value={formData.leave_type}\n            onChange={(e) => setFormData({ ...formData, leave_type: e.target.value })}\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n          >\n            <option value=\"annual\">Annual Leave</option>\n            <option value=\"sick\">Sick Leave</option>\n            <option value=\"personal\">Personal Leave</option>\n            <option value=\"maternity\">Maternity Leave</option>\n            <option value=\"paternity\">Paternity Leave</option>\n            <option value=\"unpaid\">Unpaid Leave</option>\n          </select>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Start Date *</label>\n            <input\n              type=\"date\"\n              required\n              value={formData.start_date}\n              onChange={(e) => setFormData({ ...formData, start_date: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">End Date *</label>\n            <input\n              type=\"date\"\n              required\n              value={formData.end_date}\n              onChange={(e) => setFormData({ ...formData, end_date: e.target.value })}\n              min={formData.start_date}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n            />\n          </div>\n        </div>\n\n        {formData.start_date && formData.end_date && (\n          <div className=\"bg-indigo-50 border border-indigo-200 rounded-lg p-3\">\n            <p className=\"text-sm text-indigo-900\">\n              Total Days: <span className=\"font-bold\">{calculateDays()}</span>\n            </p>\n          </div>\n        )}\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">Reason *</label>\n          <textarea\n            required\n            rows={3}\n            value={formData.reason}\n            onChange={(e) => setFormData({ ...formData, reason: e.target.value })}\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n          />\n        </div>\n\n        <div className=\"flex justify-end gap-3 mt-6 pt-4 border-t border-gray-200\">\n          <button\n            type=\"button\"\n            onClick={onClose}\n            className=\"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition\"\n          >\n            Cancel\n          </button>\n          <button\n            type=\"submit\"\n            disabled={loading}\n            className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50\"\n          >\n            {loading ? 'Submitting...' : 'Submit Leave Request'}\n          </button>\n        </div>\n      </form>\n    </Modal>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/AddReviewTypeModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":20,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport Modal from './Modal';\nimport { supabase } from '@/lib/supabase';\nimport { useAuth } from '@/contexts/AuthContext';\n\ninterface AddReviewTypeModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess: () => void;\n  onError: (message: string) => void;\n}\n\nexport default function AddReviewTypeModal({\n  isOpen,\n  onClose,\n  onSuccess,\n  onError,\n}: AddReviewTypeModalProps) {\n  const [loading, setLoading] = useState(false);\n  const { user } = useAuth();\n\n  const [formData, setFormData] = useState({\n    name: '',\n    description: '',\n    frequency: 'annual',\n    auto_schedule: false,\n    schedule_offset_days: 365,\n    trigger_event: 'anniversary',\n    duration_days: 14,\n    requires_self_assessment: true,\n    requires_manager_review: true,\n    requires_peer_review: false,\n    peer_review_count: 0,\n    allow_skip_level_review: false,\n    rating_scale_type: '1-5',\n    passing_threshold: 3.0,\n    notification_template: '',\n  });\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n\n      const response = await fetch(\n        `${supabaseUrl}/functions/v1/performance-crud`,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${session?.access_token}`,\n          },\n          body: JSON.stringify({\n            action: 'create',\n            entity: 'review_types',\n            data: formData,\n          }),\n        }\n      );\n\n      const result = await response.json();\n\n      if (result.error) {\n        throw new Error(result.error);\n      }\n\n      onSuccess();\n      onClose();\n      \n      // Reset form\n      setFormData({\n        name: '',\n        description: '',\n        frequency: 'annual',\n        auto_schedule: false,\n        schedule_offset_days: 365,\n        trigger_event: 'anniversary',\n        duration_days: 14,\n        requires_self_assessment: true,\n        requires_manager_review: true,\n        requires_peer_review: false,\n        peer_review_count: 0,\n        allow_skip_level_review: false,\n        rating_scale_type: '1-5',\n        passing_threshold: 3.0,\n        notification_template: '',\n      });\n    } catch (error: any) {\n      onError(error.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <Modal isOpen={isOpen} onClose={onClose} title=\"Create Review Type\">\n      <form onSubmit={handleSubmit} className=\"space-y-4\">\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700\">\n            Review Type Name *\n          </label>\n          <input\n            type=\"text\"\n            required\n            value={formData.name}\n            onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n            className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500\"\n            placeholder=\"e.g., Annual Performance Review\"\n          />\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700\">\n            Description\n          </label>\n          <textarea\n            value={formData.description}\n            onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n            rows={3}\n            className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500\"\n          />\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700\">\n              Frequency *\n            </label>\n            <select\n              value={formData.frequency}\n              onChange={(e) => setFormData({ ...formData, frequency: e.target.value })}\n              className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500\"\n            >\n              <option value=\"one-time\">One-Time</option>\n              <option value=\"quarterly\">Quarterly</option>\n              <option value=\"semi-annual\">Semi-Annual</option>\n              <option value=\"annual\">Annual</option>\n              <option value=\"custom\">Custom</option>\n            </select>\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700\">\n              Rating Scale *\n            </label>\n            <select\n              value={formData.rating_scale_type}\n              onChange={(e) => setFormData({ ...formData, rating_scale_type: e.target.value })}\n              className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500\"\n            >\n              <option value=\"1-5\">1-5 Scale</option>\n              <option value=\"1-10\">1-10 Scale</option>\n              <option value=\"A-F\">A-F Grade</option>\n              <option value=\"custom\">Custom</option>\n              <option value=\"none\">No Rating</option>\n            </select>\n          </div>\n        </div>\n\n        <div className=\"border-t pt-4\">\n          <h4 className=\"text-sm font-medium text-gray-900 mb-3\">Auto-Scheduling</h4>\n          \n          <div className=\"flex items-center mb-3\">\n            <input\n              type=\"checkbox\"\n              checked={formData.auto_schedule}\n              onChange={(e) => setFormData({ ...formData, auto_schedule: e.target.checked })}\n              className=\"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\"\n            />\n            <label className=\"ml-2 block text-sm text-gray-700\">\n              Enable automatic scheduling\n            </label>\n          </div>\n\n          {formData.auto_schedule && (\n            <>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700\">\n                    Trigger Event\n                  </label>\n                  <select\n                    value={formData.trigger_event}\n                    onChange={(e) => setFormData({ ...formData, trigger_event: e.target.value })}\n                    className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500\"\n                  >\n                    <option value=\"hire_date\">After Hire Date</option>\n                    <option value=\"anniversary\">Work Anniversary</option>\n                    <option value=\"last_review\">After Last Review</option>\n                    <option value=\"end_of_probation\">End of Probation</option>\n                    <option value=\"manual\">Manual Only</option>\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700\">\n                    Schedule After (Days)\n                  </label>\n                  <input\n                    type=\"number\"\n                    value={formData.schedule_offset_days}\n                    onChange={(e) => setFormData({ ...formData, schedule_offset_days: parseInt(e.target.value) })}\n                    className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"mt-3\">\n                <label className=\"block text-sm font-medium text-gray-700\">\n                  Review Period Duration (Days)\n                </label>\n                <input\n                  type=\"number\"\n                  value={formData.duration_days}\n                  onChange={(e) => setFormData({ ...formData, duration_days: parseInt(e.target.value) })}\n                  className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500\"\n                />\n                <p className=\"mt-1 text-xs text-gray-500\">\n                  How many days the review stays open for completion\n                </p>\n              </div>\n            </>\n          )}\n        </div>\n\n        <div className=\"border-t pt-4\">\n          <h4 className=\"text-sm font-medium text-gray-900 mb-3\">Review Participants</h4>\n          \n          <div className=\"space-y-2\">\n            <div className=\"flex items-center\">\n              <input\n                type=\"checkbox\"\n                checked={formData.requires_self_assessment}\n                onChange={(e) => setFormData({ ...formData, requires_self_assessment: e.target.checked })}\n                className=\"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\"\n              />\n              <label className=\"ml-2 block text-sm text-gray-700\">\n                Require self-assessment\n              </label>\n            </div>\n\n            <div className=\"flex items-center\">\n              <input\n                type=\"checkbox\"\n                checked={formData.requires_manager_review}\n                onChange={(e) => setFormData({ ...formData, requires_manager_review: e.target.checked })}\n                className=\"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\"\n              />\n              <label className=\"ml-2 block text-sm text-gray-700\">\n                Require manager review\n              </label>\n            </div>\n\n            <div className=\"flex items-center\">\n              <input\n                type=\"checkbox\"\n                checked={formData.requires_peer_review}\n                onChange={(e) => setFormData({ ...formData, requires_peer_review: e.target.checked })}\n                className=\"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\"\n              />\n              <label className=\"ml-2 block text-sm text-gray-700\">\n                Require peer review\n              </label>\n            </div>\n\n            {formData.requires_peer_review && (\n              <div className=\"ml-6\">\n                <label className=\"block text-sm font-medium text-gray-700\">\n                  Number of Peer Reviewers\n                </label>\n                <input\n                  type=\"number\"\n                  min=\"1\"\n                  max=\"10\"\n                  value={formData.peer_review_count}\n                  onChange={(e) => setFormData({ ...formData, peer_review_count: parseInt(e.target.value) })}\n                  className=\"mt-1 block w-32 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500\"\n                />\n              </div>\n            )}\n\n            <div className=\"flex items-center\">\n              <input\n                type=\"checkbox\"\n                checked={formData.allow_skip_level_review}\n                onChange={(e) => setFormData({ ...formData, allow_skip_level_review: e.target.checked })}\n                className=\"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\"\n              />\n              <label className=\"ml-2 block text-sm text-gray-700\">\n                Allow skip-level review (manager's manager)\n              </label>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex justify-end space-x-3 pt-4\">\n          <button\n            type=\"button\"\n            onClick={onClose}\n            className=\"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n          >\n            Cancel\n          </button>\n          <button\n            type=\"submit\"\n            disabled={loading}\n            className=\"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400\"\n          >\n            {loading ? 'Creating...' : 'Create Review Type'}\n          </button>\n        </div>\n      </form>\n    </Modal>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/AddTemplateModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":14,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport Modal from './Modal';\nimport { supabase, supabaseUrl } from '@/lib/supabase';\nimport { useAuth } from '@/contexts/AuthContext';\n\ninterface AddTemplateModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess: () => void;\n  onError: (message: string) => void;\n}\n\nexport default function AddTemplateModal({ isOpen, onClose, onSuccess, onError }: AddTemplateModalProps) {\n  const { user } = useAuth();\n  const [loading, setLoading] = useState(false);\n  const [formData, setFormData] = useState({\n    template_name: '',\n    template_type: 'offer_letter',\n    category: '',\n    subject: '',\n    content: '',\n    version: 1\n  });\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      // Get the user's session token\n      const { data: { session } } = await supabase.auth.getSession();\n      if (!session) {\n        throw new Error('No active session');\n      }\n\n      const response = await fetch(\n        `${supabaseUrl}/functions/v1/letter-template-crud`,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${session.access_token}`\n          },\n          body: JSON.stringify({\n            action: 'create',\n            data: {\n              ...formData,\n              version: parseInt(formData.version.toString()),\n              is_active: true\n            }\n          })\n        }\n      );\n\n      const result = await response.json();\n\n      if (response.ok && result.data) {\n        onSuccess();\n        onClose();\n        setFormData({\n          template_name: '',\n          template_type: 'offer_letter',\n          category: '',\n          subject: '',\n          content: '',\n          version: 1\n        });\n      } else {\n        throw new Error(result.error?.message || 'Failed to create template');\n      }\n    } catch (error: any) {\n      onError(error.message || 'Failed to create template');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <Modal isOpen={isOpen} onClose={onClose} title=\"Create Letter Template\" maxWidth=\"max-w-4xl\">\n      <form onSubmit={handleSubmit} className=\"space-y-4\">\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Template Name *</label>\n            <input\n              type=\"text\"\n              required\n              value={formData.template_name}\n              onChange={(e) => setFormData({ ...formData, template_name: e.target.value })}\n              placeholder=\"e.g., Standard Offer Letter\"\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Template Type *</label>\n            <select\n              required\n              value={formData.template_type}\n              onChange={(e) => setFormData({ ...formData, template_type: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n            >\n              <option value=\"offer_letter\">Offer Letter</option>\n              <option value=\"appointment_letter\">Appointment Letter</option>\n              <option value=\"termination_letter\">Termination Letter</option>\n              <option value=\"promotion_letter\">Promotion Letter</option>\n              <option value=\"warning_letter\">Warning Letter</option>\n              <option value=\"experience_certificate\">Experience Certificate</option>\n              <option value=\"salary_slip\">Salary Slip</option>\n            </select>\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Category</label>\n            <input\n              type=\"text\"\n              value={formData.category}\n              onChange={(e) => setFormData({ ...formData, category: e.target.value })}\n              placeholder=\"e.g., HR, Legal, Onboarding\"\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Version</label>\n            <input\n              type=\"number\"\n              value={formData.version}\n              onChange={(e) => setFormData({ ...formData, version: parseInt(e.target.value) || 1 })}\n              placeholder=\"1\"\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n            />\n          </div>\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">Subject *</label>\n          <input\n            type=\"text\"\n            required\n            value={formData.subject}\n            onChange={(e) => setFormData({ ...formData, subject: e.target.value })}\n            placeholder=\"e.g., Job Offer - [position]\"\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n          />\n          <p className=\"mt-1 text-xs text-gray-500\">\n            Use merge fields: [employee_name], [position], [department], [salary], [start_date]\n          </p>\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">Content *</label>\n          <textarea\n            required\n            rows={10}\n            value={formData.content}\n            onChange={(e) => setFormData({ ...formData, content: e.target.value })}\n            placeholder=\"Dear [employee_name],&#10;&#10;We are pleased to offer you the position of [position] in the [department] department...\"\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none font-mono text-sm\"\n          />\n          <p className=\"mt-1 text-xs text-gray-500\">\n            Available merge fields: [employee_name], [employee_number], [position], [department], [salary], [start_date], [company_name], [date]\n          </p>\n        </div>\n\n        <div className=\"flex justify-end gap-3 mt-6 pt-4 border-t border-gray-200\">\n          <button\n            type=\"button\"\n            onClick={onClose}\n            className=\"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition\"\n          >\n            Cancel\n          </button>\n          <button\n            type=\"submit\"\n            disabled={loading}\n            className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50\"\n          >\n            {loading ? 'Creating...' : 'Create Template'}\n          </button>\n        </div>\n      </form>\n    </Modal>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/AdminPrivilegeSetup.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkCurrentRole'. Either include it or remove the dependency array.","line":16,"column":6,"nodeType":"ArrayExpression","endLine":16,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [checkCurrentRole, user]","fix":{"range":[572,578],"text":"[checkCurrentRole, user]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":23,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '../lib/supabase';\nimport { log } from '../lib/logger';\nimport { useAuth } from '../contexts/AuthContext';\nimport { Shield, User, Settings } from 'lucide-react';\n\nexport default function AdminPrivilegeSetup() {\n  const { user } = useAuth();\n  const [userRole, setUserRole] = useState<string>('');\n  const [loading, setLoading] = useState(false);\n  const [checking, setChecking] = useState(true);\n  const [success, setSuccess] = useState(false);\n\n  useEffect(() => {\n    checkCurrentRole();\n  }, [user]);\n\n  async function checkCurrentRole() {\n    if (!user) return;\n\n    setChecking(true);\n    try {\n      const { data, error } = await supabase\n        .from('users_profiles')\n        .select('role, full_name')\n        .eq('user_id', user.id)\n        .single();\n\n      if (data) {\n        setUserRole(data.role || 'No role assigned');\n      } else {\n        setUserRole('No profile found');\n      }\n    } catch (error) {\n      log.error('Error checking role', error, { component: 'AdminPrivilegeSetup', action: 'checkCurrentRole' });\n      setUserRole('Error checking role');\n    } finally {\n      setChecking(false);\n    }\n  }\n\n  async function setupFullAdminAccess() {\n    if (!user) return;\n\n    setLoading(true);\n    try {\n      // Use direct DB call instead of Edge Function for reliability\n      const { error } = await supabase\n        .from('users_profiles')\n        .upsert({\n          user_id: user.id,\n          email: user.email,\n          full_name: 'System Administrator',\n          role: 'Admin',\n          updated_at: new Date().toISOString(),\n          permissions: JSON.stringify([\n            'create_jobs',\n            'manage_applications',\n            'schedule_interviews',\n            'manage_employees',\n            'create_announcements',\n            'manage_documents',\n            'generate_letters',\n            'access_reports',\n            'manage_settings',\n            'admin_access'\n          ])\n        }, {\n          onConflict: 'user_id'\n        });\n\n      if (error) throw error;\n      if (error) throw error;\n\n      setUserRole('Admin');\n      setSuccess(true);\n\n      // Add audit log (best effort)\n      await supabase.from('audit_logs').insert({\n        user_id: user.id,\n        action: 'SET_ADMIN_PRIVILEGES',\n        entity_type: 'users_profiles',\n        entity_id: user.id,\n        details: 'Full admin access granted via Edge Function',\n        timestamp: new Date().toISOString()\n      });\n\n      // Refresh the page after 2 seconds to apply changes\n      setTimeout(() => {\n        window.location.reload();\n      }, 2000);\n\n    } catch (error: any) {\n      log.error('Error setting admin privileges', error, { component: 'AdminPrivilegeSetup', action: 'setupFullAdminAccess' });\n      alert('Failed to grant admin access: ' + (error.message || 'Unknown error'));\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  if (!user) return null;\n\n  const isAdmin = userRole === 'Admin';\n  const needsSetup = !isAdmin && userRole !== 'checking';\n\n  // Hide badge if user is already Admin\n  if (isAdmin) return null;\n\n  if (success) {\n    return (\n      <div className=\"fixed top-4 right-4 bg-green-50 border border-green-200 rounded-lg p-4 shadow-lg z-50 max-w-md\">\n        <div className=\"flex items-center gap-3\">\n          <Shield className=\"w-6 h-6 text-green-600\" />\n          <div>\n            <h3 className=\"font-medium text-green-800\">Admin Access Granted!</h3>\n            <p className=\"text-sm text-green-600\">Full privileges activated. Refreshing page...</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"fixed top-4 right-4 bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-w-md\">\n      <div className=\"p-4\">\n        <div className=\"flex items-center gap-3 mb-3\">\n          <User className=\"w-5 h-5 text-gray-600\" />\n          <div>\n            <h3 className=\"font-medium text-gray-900\">Account Privileges</h3>\n            <p className=\"text-sm text-gray-600\">Email: {user.email}</p>\n          </div>\n        </div>\n\n        <div className=\"mb-3 p-3 bg-gray-50 rounded\">\n          <p className=\"text-sm\">\n            <strong>Current Role:</strong> {checking ? 'Checking...' : userRole}\n          </p>\n          {isAdmin && (\n            <div className=\"flex items-center gap-2 mt-2\">\n              <Shield className=\"w-4 h-4 text-green-600\" />\n              <span className=\"text-sm text-green-600 font-medium\">Full Admin Access</span>\n            </div>\n          )}\n        </div>\n\n        {needsSetup && (\n          <div>\n            <p className=\"text-sm text-orange-600 mb-3\">\n              You need admin privileges to access all features including the Notice Board.\n            </p>\n            <button\n              onClick={setupFullAdminAccess}\n              disabled={loading}\n              className=\"w-full flex items-center justify-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50\"\n            >\n              {loading ? (\n                <>\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\n                  Setting up...\n                </>\n              ) : (\n                <>\n                  <Settings className=\"w-4 h-4\" />\n                  Grant Full Admin Access\n                </>\n              )}\n            </button>\n          </div>\n        )}\n\n        {isAdmin && (\n          <div className=\"text-center\">\n            <p className=\"text-sm text-green-600\">â You have full admin privileges!</p>\n            <button\n              onClick={() => window.location.reload()}\n              className=\"mt-2 text-sm text-indigo-600 hover:text-indigo-800\"\n            >\n              Refresh page\n            </button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/AdminSetup.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/AnnouncementsWidget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Edit2' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Trash2' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isAfter' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isBefore' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":45},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadAnnouncements'. Either include it or remove the dependency array.","line":33,"column":8,"nodeType":"ArrayExpression","endLine":33,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [currentTenant, loadAnnouncements]","fix":{"range":[1144,1159],"text":"[currentTenant, loadAnnouncements]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { log } from '@/lib/logger';\nimport {\n    Megaphone, Pin, Calendar, User, ChevronRight,\n    Plus, Edit2, Trash2, X, Check, AlertTriangle\n} from 'lucide-react';\nimport { format, parseISO, isAfter, isBefore, formatDistanceToNow } from 'date-fns';\n\ninterface Announcement {\n    id: string;\n    title: string;\n    content: string;\n    type: 'info' | 'warning' | 'urgent' | 'celebration';\n    is_pinned: boolean;\n    author_name: string;\n    publish_date: string;\n    expiry_date?: string;\n    department?: string;\n    read_by?: string[];\n}\n\nexport default function AnnouncementsWidget() {\n    const { currentTenant } = useTenant();\n    const [announcements, setAnnouncements] = useState<Announcement[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [selectedAnnouncement, setSelectedAnnouncement] = useState<Announcement | null>(null);\n    const [filter, setFilter] = useState<'all' | 'pinned' | 'unread'>('all');\n\n    useEffect(() => {\n        loadAnnouncements();\n    }, [currentTenant]);\n\n    async function loadAnnouncements() {\n        setLoading(true);\n        try {\n            const { data, error } = await supabase\n                .from('announcements')\n                .select('*')\n                .eq('tenant_id', currentTenant?.id)\n                .order('is_pinned', { ascending: false })\n                .order('publish_date', { ascending: false });\n\n            if (error) throw error;\n            setAnnouncements(data || []);\n        } catch (error) {\n            log.error('Error loading announcements', error, { component: 'AnnouncementsWidget', action: 'loadAnnouncements' });\n            setAnnouncements(generateMockAnnouncements());\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    function generateMockAnnouncements(): Announcement[] {\n        return [\n            {\n                id: '1',\n                title: 'ð Company Holiday Party - December 20th!',\n                content: 'Join us for our annual holiday celebration at the Grand Hall. There will be food, drinks, music, and a special surprise for everyone. Family members are welcome! RSVP by December 15th.',\n                type: 'celebration',\n                is_pinned: true,\n                author_name: 'HR Team',\n                publish_date: new Date().toISOString(),\n                department: 'All',\n            },\n            {\n                id: '2',\n                title: 'â ï¸ System Maintenance - Saturday 2AM-6AM',\n                content: 'The HR system will undergo scheduled maintenance this Saturday. During this time, the system will be unavailable. Please plan your tasks accordingly.',\n                type: 'warning',\n                is_pinned: true,\n                author_name: 'IT Department',\n                publish_date: new Date(Date.now() - 86400000).toISOString(),\n            },\n            {\n                id: '3',\n                title: 'New Health & Safety Guidelines',\n                content: 'Please review the updated health and safety guidelines posted on the intranet. All staff must complete the acknowledgment form by end of month.',\n                type: 'info',\n                is_pinned: false,\n                author_name: 'Compliance Team',\n                publish_date: new Date(Date.now() - 172800000).toISOString(),\n            },\n            {\n                id: '4',\n                title: 'ð¨ Urgent: Fire Drill Tomorrow at 10AM',\n                content: 'A fire drill is scheduled for tomorrow at 10:00 AM. Please familiarize yourself with the evacuation routes and assembly points.',\n                type: 'urgent',\n                is_pinned: false,\n                author_name: 'Facilities',\n                publish_date: new Date(Date.now() - 259200000).toISOString(),\n            },\n            {\n                id: '5',\n                title: 'Welcome New Team Members!',\n                content: 'Please join us in welcoming Sarah, Michael, and Emma who joined our team this week. Take a moment to say hello and help them feel at home!',\n                type: 'info',\n                is_pinned: false,\n                author_name: 'HR Team',\n                publish_date: new Date(Date.now() - 432000000).toISOString(),\n            },\n        ];\n    }\n\n    function getTypeStyles(type: Announcement['type']) {\n        switch (type) {\n            case 'urgent':\n                return { bg: 'bg-red-50', border: 'border-red-200', icon: 'text-red-500', badge: 'bg-red-100 text-red-700' };\n            case 'warning':\n                return { bg: 'bg-yellow-50', border: 'border-yellow-200', icon: 'text-yellow-500', badge: 'bg-yellow-100 text-yellow-700' };\n            case 'celebration':\n                return { bg: 'bg-purple-50', border: 'border-purple-200', icon: 'text-purple-500', badge: 'bg-purple-100 text-purple-700' };\n            default:\n                return { bg: 'bg-blue-50', border: 'border-blue-200', icon: 'text-blue-500', badge: 'bg-blue-100 text-blue-700' };\n        }\n    }\n\n    function getTypeLabel(type: Announcement['type']) {\n        return { urgent: 'Urgent', warning: 'Warning', celebration: 'Celebration', info: 'Info' }[type];\n    }\n\n    const filteredAnnouncements = announcements.filter(a => {\n        if (filter === 'pinned') return a.is_pinned;\n        if (filter === 'unread') return !a.read_by?.includes('current-user-id'); // Simplified\n        return true;\n    });\n\n    if (loading) {\n        return (\n            <div className=\"bg-white rounded-xl border border-gray-200 p-6\">\n                <div className=\"animate-pulse space-y-4\">\n                    <div className=\"h-6 bg-gray-200 rounded w-1/3\" />\n                    {[1, 2, 3].map(i => (\n                        <div key={i} className=\"h-20 bg-gray-100 rounded-lg\" />\n                    ))}\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"bg-white rounded-xl border border-gray-200 overflow-hidden\">\n            {/* Header */}\n            <div className=\"px-6 py-4 border-b border-gray-200\">\n                <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center space-x-2\">\n                        <Megaphone className=\"w-5 h-5 text-indigo-600\" />\n                        <h2 className=\"font-semibold text-gray-900\">Announcements</h2>\n                        {announcements.length > 0 && (\n                            <span className=\"px-2 py-0.5 text-xs bg-indigo-100 text-indigo-700 rounded-full\">\n                                {announcements.length}\n                            </span>\n                        )}\n                    </div>\n                    <button className=\"p-2 text-indigo-600 hover:bg-indigo-50 rounded-lg transition\">\n                        <Plus className=\"w-4 h-4\" />\n                    </button>\n                </div>\n\n                {/* Filters */}\n                <div className=\"mt-3 flex space-x-2\">\n                    {(['all', 'pinned', 'unread'] as const).map(f => (\n                        <button\n                            key={f}\n                            onClick={() => setFilter(f)}\n                            className={`px-3 py-1 text-xs rounded-lg transition ${filter === f\n                                ? 'bg-indigo-100 text-indigo-700 font-medium'\n                                : 'text-gray-600 hover:bg-gray-100'\n                                }`}\n                        >\n                            {f.charAt(0).toUpperCase() + f.slice(1)}\n                        </button>\n                    ))}\n                </div>\n            </div>\n\n            {/* Announcements List */}\n            <div className=\"divide-y divide-gray-100 max-h-96 overflow-y-auto\">\n                {filteredAnnouncements.length === 0 ? (\n                    <div className=\"p-8 text-center text-gray-500\">\n                        <Megaphone className=\"w-12 h-12 mx-auto mb-2 text-gray-300\" />\n                        <p>No announcements</p>\n                    </div>\n                ) : (\n                    filteredAnnouncements.map(announcement => {\n                        const styles = getTypeStyles(announcement.type);\n                        return (\n                            <div\n                                key={announcement.id}\n                                onClick={() => setSelectedAnnouncement(announcement)}\n                                className={`p-4 cursor-pointer hover:bg-gray-50 transition ${announcement.is_pinned ? 'bg-gradient-to-r from-indigo-50/50 to-transparent' : ''\n                                    }`}\n                            >\n                                <div className=\"flex items-start\">\n                                    <div className={`p-2 rounded-lg ${styles.bg} ${styles.icon} flex-shrink-0`}>\n                                        {announcement.type === 'urgent' ? (\n                                            <AlertTriangle className=\"w-4 h-4\" />\n                                        ) : (\n                                            <Megaphone className=\"w-4 h-4\" />\n                                        )}\n                                    </div>\n                                    <div className=\"ml-3 flex-1 min-w-0\">\n                                        <div className=\"flex items-center space-x-2\">\n                                            {announcement.is_pinned && (\n                                                <Pin className=\"w-3 h-3 text-indigo-500\" />\n                                            )}\n                                            <span className={`px-2 py-0.5 text-xs rounded ${styles.badge}`}>\n                                                {getTypeLabel(announcement.type)}\n                                            </span>\n                                        </div>\n                                        <p className=\"text-sm font-medium text-gray-900 mt-1 truncate\">\n                                            {announcement.title}\n                                        </p>\n                                        <p className=\"text-xs text-gray-500 mt-0.5 line-clamp-2\">\n                                            {announcement.content}\n                                        </p>\n                                        <div className=\"flex items-center mt-2 text-xs text-gray-400\">\n                                            <User className=\"w-3 h-3 mr-1\" />\n                                            <span>{announcement.author_name}</span>\n                                            <span className=\"mx-2\">â¢</span>\n                                            <span>{formatDistanceToNow(parseISO(announcement.publish_date), { addSuffix: true })}</span>\n                                        </div>\n                                    </div>\n                                    <ChevronRight className=\"w-4 h-4 text-gray-400 flex-shrink-0\" />\n                                </div>\n                            </div>\n                        );\n                    })\n                )}\n            </div>\n\n            {/* Announcement Detail Modal */}\n            {selectedAnnouncement && (\n                <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n                    <div className=\"bg-white rounded-2xl max-w-lg w-full max-h-[80vh] overflow-hidden\">\n                        <div className={`px-6 py-4 ${getTypeStyles(selectedAnnouncement.type).bg} border-b`}>\n                            <div className=\"flex items-center justify-between\">\n                                <div className=\"flex items-center space-x-2\">\n                                    <span className={`px-2 py-0.5 text-xs rounded ${getTypeStyles(selectedAnnouncement.type).badge}`}>\n                                        {getTypeLabel(selectedAnnouncement.type)}\n                                    </span>\n                                    {selectedAnnouncement.is_pinned && (\n                                        <span className=\"flex items-center text-xs text-indigo-600\">\n                                            <Pin className=\"w-3 h-3 mr-1\" />\n                                            Pinned\n                                        </span>\n                                    )}\n                                </div>\n                                <button\n                                    onClick={() => setSelectedAnnouncement(null)}\n                                    className=\"p-2 text-gray-400 hover:text-gray-600 rounded-lg\"\n                                >\n                                    <X className=\"w-5 h-5\" />\n                                </button>\n                            </div>\n                            <h3 className=\"text-lg font-semibold text-gray-900 mt-2\">\n                                {selectedAnnouncement.title}\n                            </h3>\n                        </div>\n                        <div className=\"p-6\">\n                            <p className=\"text-gray-700 whitespace-pre-wrap\">\n                                {selectedAnnouncement.content}\n                            </p>\n                            <div className=\"mt-6 pt-4 border-t border-gray-100 flex items-center text-sm text-gray-500\">\n                                <User className=\"w-4 h-4 mr-1\" />\n                                <span>{selectedAnnouncement.author_name}</span>\n                                <span className=\"mx-2\">â¢</span>\n                                <Calendar className=\"w-4 h-4 mr-1\" />\n                                <span>{format(parseISO(selectedAnnouncement.publish_date), 'PPP')}</span>\n                            </div>\n                        </div>\n                        <div className=\"px-6 py-4 bg-gray-50 flex justify-end space-x-2\">\n                            <button\n                                onClick={() => setSelectedAnnouncement(null)}\n                                className=\"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg transition\"\n                            >\n                                Close\n                            </button>\n                            <button className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition flex items-center\">\n                                <Check className=\"w-4 h-4 mr-1\" />\n                                Mark as Read\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/AppLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/AutomationDashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/BrandedFooter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/BulkActions.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/CharacterDeclarationForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Controller' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'control' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":157,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":157,"endColumn":51}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { useForm, Controller } from 'react-hook-form';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport {\n    Shield,\n    CheckCircle,\n    AlertTriangle,\n    Loader2,\n    FileText,\n    User,\n    Scale,\n    Heart,\n    Info\n} from 'lucide-react';\n\n// ==========================================\n// CQC Regulation 19 Compliance\n// ==========================================\n// This form satisfies the \"good character\" assessment \n// requirement under CQC Regulation 19 (Fit and Proper Persons Employed)\n// ==========================================\n\ninterface CharacterDeclarationData {\n    // Personal Details\n    full_name: string;\n    date_of_birth: string;\n    current_address: string;\n\n    // Declaration Questions\n    criminal_convictions: boolean;\n    criminal_convictions_details?: string;\n    pending_charges: boolean;\n    pending_charges_details?: string;\n    disciplinary_proceedings: boolean;\n    disciplinary_proceedings_details?: string;\n    professional_sanctions: boolean;\n    professional_sanctions_details?: string;\n    safeguarding_concerns: boolean;\n    safeguarding_concerns_details?: string;\n    barred_lists: boolean;\n    barred_lists_details?: string;\n    health_conditions: boolean;\n    health_conditions_details?: string;\n\n    // Values-Based Declarations\n    compassion_statement: string;\n    respect_statement: string;\n    integrity_statement: string;\n\n    // Consent\n    consent_background_check: boolean;\n    consent_reference_check: boolean;\n    consent_data_processing: boolean;\n    declaration_truthful: boolean;\n\n    // Signature\n    signature_name: string;\n    signature_date: string;\n}\n\ninterface CharacterDeclarationFormProps {\n    employeeId?: string;\n    employeeName?: string;\n    onSuccess: () => void;\n    onCancel: () => void;\n}\n\nconst declarationQuestions = [\n    {\n        key: 'criminal_convictions',\n        label: 'Criminal Convictions',\n        question: 'Do you have any unspent criminal convictions, cautions, reprimands, or final warnings under the Rehabilitation of Offenders Act 1974?',\n        detailsLabel: 'Please provide full details of convictions, dates, and sentences:',\n        icon: Scale\n    },\n    {\n        key: 'pending_charges',\n        label: 'Pending Charges',\n        question: 'Are you currently subject to any pending criminal charges, investigations, or court proceedings?',\n        detailsLabel: 'Please provide details:',\n        icon: AlertTriangle\n    },\n    {\n        key: 'disciplinary_proceedings',\n        label: 'Disciplinary History',\n        question: 'Have you ever been subject to disciplinary proceedings, dismissed, or asked to resign from any employment?',\n        detailsLabel: 'Please provide details including employer, dates, and circumstances:',\n        icon: FileText\n    },\n    {\n        key: 'professional_sanctions',\n        label: 'Professional Sanctions',\n        question: 'Have you ever been subject to sanctions, conditions, or removal from any professional register?',\n        detailsLabel: 'Please provide details of the professional body and sanctions:',\n        icon: Shield\n    },\n    {\n        key: 'safeguarding_concerns',\n        label: 'Safeguarding Concerns',\n        question: 'Have you ever been the subject of any safeguarding investigation or allegation (substantiated or not)?',\n        detailsLabel: 'Please provide details:',\n        icon: Heart\n    },\n    {\n        key: 'barred_lists',\n        label: 'Barred Lists',\n        question: 'Are you, or have you ever been, included on the DBS Barred Lists (Adults or Children) or POVA/POCA lists?',\n        detailsLabel: 'Please provide details:',\n        icon: Shield\n    },\n    {\n        key: 'health_conditions',\n        label: 'Health Declaration',\n        question: 'Do you have any physical or mental health conditions that may affect your ability to perform the duties of this role safely?',\n        detailsLabel: 'Please provide details (we will discuss reasonable adjustments):',\n        icon: Heart\n    }\n];\n\nconst valuesQuestions = [\n    {\n        key: 'compassion_statement',\n        label: 'Compassion',\n        prompt: 'Describe a time when you showed compassion to someone in need. How did you support them?',\n        placeholder: 'In my previous role, I noticed an elderly resident was feeling isolated...',\n        minLength: 100\n    },\n    {\n        key: 'respect_statement',\n        label: 'Respect & Dignity',\n        prompt: 'Give an example of how you have maintained someone\\'s dignity and respect in a care setting.',\n        placeholder: 'I always ensure that I knock and wait before entering a resident\\'s room...',\n        minLength: 100\n    },\n    {\n        key: 'integrity_statement',\n        label: 'Integrity & Honesty',\n        prompt: 'Describe a situation where you had to make an ethical decision. What did you do and why?',\n        placeholder: 'When I witnessed a colleague speaking inappropriately to a service user...',\n        minLength: 100\n    }\n];\n\nexport default function CharacterDeclarationForm({\n    employeeId,\n    employeeName,\n    onSuccess,\n    onCancel\n}: CharacterDeclarationFormProps) {\n    const { currentTenant } = useTenant();\n    const [loading, setLoading] = useState(false);\n    const [step, setStep] = useState(1);\n    const totalSteps = 4;\n\n    const { register, handleSubmit, watch, control, formState: { errors } } = useForm<CharacterDeclarationData>({\n        defaultValues: {\n            full_name: employeeName || '',\n            signature_date: new Date().toISOString().split('T')[0],\n            criminal_convictions: false,\n            pending_charges: false,\n            disciplinary_proceedings: false,\n            professional_sanctions: false,\n            safeguarding_concerns: false,\n            barred_lists: false,\n            health_conditions: false,\n            consent_background_check: false,\n            consent_reference_check: false,\n            consent_data_processing: false,\n            declaration_truthful: false\n        }\n    });\n\n    const watchAllFields = watch();\n\n    const onSubmit = async (data: CharacterDeclarationData) => {\n        if (!currentTenant) return;\n\n        setLoading(true);\n        try {\n            // Calculate risk score based on disclosures\n            const disclosures = [\n                data.criminal_convictions,\n                data.pending_charges,\n                data.disciplinary_proceedings,\n                data.professional_sanctions,\n                data.safeguarding_concerns,\n                data.barred_lists\n            ].filter(Boolean).length;\n\n            const riskLevel = disclosures === 0 ? 'low' : disclosures <= 2 ? 'medium' : 'high';\n\n            // Save to database\n            const { error } = await supabase\n                .from('character_declarations')\n                .insert({\n                    tenant_id: currentTenant.id,\n                    employee_id: employeeId,\n                    full_name: data.full_name,\n                    date_of_birth: data.date_of_birth,\n                    current_address: data.current_address,\n\n                    // Disclosures\n                    criminal_convictions: data.criminal_convictions,\n                    criminal_convictions_details: data.criminal_convictions_details,\n                    pending_charges: data.pending_charges,\n                    pending_charges_details: data.pending_charges_details,\n                    disciplinary_proceedings: data.disciplinary_proceedings,\n                    disciplinary_proceedings_details: data.disciplinary_proceedings_details,\n                    professional_sanctions: data.professional_sanctions,\n                    professional_sanctions_details: data.professional_sanctions_details,\n                    safeguarding_concerns: data.safeguarding_concerns,\n                    safeguarding_concerns_details: data.safeguarding_concerns_details,\n                    barred_lists: data.barred_lists,\n                    barred_lists_details: data.barred_lists_details,\n                    health_conditions: data.health_conditions,\n                    health_conditions_details: data.health_conditions_details,\n\n                    // Values statements\n                    compassion_statement: data.compassion_statement,\n                    respect_statement: data.respect_statement,\n                    integrity_statement: data.integrity_statement,\n\n                    // Consents\n                    consent_background_check: data.consent_background_check,\n                    consent_reference_check: data.consent_reference_check,\n                    consent_data_processing: data.consent_data_processing,\n                    declaration_truthful: data.declaration_truthful,\n\n                    // Signature\n                    signature_name: data.signature_name,\n                    signature_date: data.signature_date,\n\n                    // Metadata\n                    risk_level: riskLevel,\n                    disclosure_count: disclosures,\n                    status: disclosures > 0 ? 'requires_review' : 'approved',\n                    submitted_at: new Date().toISOString()\n                });\n\n            if (error) throw error;\n\n            onSuccess();\n        } catch (error) {\n            log.error('Error submitting character declaration', error, { component: 'CharacterDeclarationForm', action: 'onSubmit', metadata: { employeeId } });\n            alert('Failed to submit declaration. Please try again.');\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const renderStepIndicator = () => (\n        <div className=\"flex items-center justify-center mb-6\">\n            {[1, 2, 3, 4].map((s) => (\n                <React.Fragment key={s}>\n                    <div\n                        className={`w-10 h-10 rounded-full flex items-center justify-center font-semibold text-sm transition-all ${s === step\n                            ? 'bg-cyan-600 text-white shadow-lg'\n                            : s < step\n                                ? 'bg-green-500 text-white'\n                                : 'bg-gray-200 text-gray-500'\n                            }`}\n                    >\n                        {s < step ? <CheckCircle className=\"w-5 h-5\" /> : s}\n                    </div>\n                    {s < 4 && (\n                        <div className={`w-16 h-1 ${s < step ? 'bg-green-500' : 'bg-gray-200'}`} />\n                    )}\n                </React.Fragment>\n            ))}\n        </div>\n    );\n\n    const stepTitles = [\n        'Personal Details',\n        'Character Disclosures',\n        'Values Assessment',\n        'Consent & Signature'\n    ];\n\n    return (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n            <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col\">\n                {/* Header */}\n                <div className=\"p-6 border-b border-gray-200 bg-gradient-to-r from-cyan-600 to-blue-600\">\n                    <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-3\">\n                            <Shield className=\"w-8 h-8 text-white\" />\n                            <div>\n                                <h2 className=\"text-xl font-bold text-white\">Character Declaration Form</h2>\n                                <p className=\"text-cyan-100 text-sm\">CQC Regulation 19 Compliance</p>\n                            </div>\n                        </div>\n                        <button onClick={onCancel} className=\"text-white/80 hover:text-white text-2xl\">\n                            &times;\n                        </button>\n                    </div>\n                </div>\n\n                {/* Step Indicator */}\n                <div className=\"px-6 pt-6\">\n                    {renderStepIndicator()}\n                    <h3 className=\"text-lg font-semibold text-gray-800 text-center mb-2\">\n                        Step {step}: {stepTitles[step - 1]}\n                    </h3>\n                </div>\n\n                {/* Form Content */}\n                <form onSubmit={handleSubmit(onSubmit)} className=\"flex-1 overflow-y-auto\">\n                    <div className=\"p-6 space-y-6\">\n                        {/* Step 1: Personal Details */}\n                        {step === 1 && (\n                            <div className=\"space-y-6\">\n                                <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                                    <div className=\"flex items-start gap-3\">\n                                        <Info className=\"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5\" />\n                                        <div className=\"text-sm text-blue-800\">\n                                            <p className=\"font-semibold\">Why we need this information</p>\n                                            <p className=\"mt-1\">Under CQC Regulation 19, employers must ensure all staff are of good character before working with vulnerable people. This declaration helps us meet our legal obligations.</p>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Full Legal Name *</label>\n                                        <input\n                                            type=\"text\"\n                                            {...register('full_name', { required: 'Full name is required' })}\n                                            className=\"block w-full rounded-lg border-gray-300 shadow-sm focus:border-cyan-500 focus:ring-cyan-500\"\n                                        />\n                                        {errors.full_name && <p className=\"text-red-500 text-xs mt-1\">{errors.full_name.message}</p>}\n                                    </div>\n\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Date of Birth *</label>\n                                        <input\n                                            type=\"date\"\n                                            {...register('date_of_birth', { required: 'Date of birth is required' })}\n                                            className=\"block w-full rounded-lg border-gray-300 shadow-sm focus:border-cyan-500 focus:ring-cyan-500\"\n                                        />\n                                        {errors.date_of_birth && <p className=\"text-red-500 text-xs mt-1\">{errors.date_of_birth.message}</p>}\n                                    </div>\n\n                                    <div className=\"md:col-span-2\">\n                                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Current Address *</label>\n                                        <textarea\n                                            {...register('current_address', { required: 'Address is required' })}\n                                            rows={3}\n                                            className=\"block w-full rounded-lg border-gray-300 shadow-sm focus:border-cyan-500 focus:ring-cyan-500\"\n                                            placeholder=\"House number, Street, Town/City, Postcode\"\n                                        />\n                                        {errors.current_address && <p className=\"text-red-500 text-xs mt-1\">{errors.current_address.message}</p>}\n                                    </div>\n                                </div>\n                            </div>\n                        )}\n\n                        {/* Step 2: Character Disclosures */}\n                        {step === 2 && (\n                            <div className=\"space-y-6\">\n                                <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4\">\n                                    <div className=\"flex items-start gap-3\">\n                                        <AlertTriangle className=\"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5\" />\n                                        <div className=\"text-sm text-amber-800\">\n                                            <p className=\"font-semibold\">Honest Disclosure Required</p>\n                                            <p className=\"mt-1\">Please answer all questions truthfully. Having a conviction or disclosure does not automatically prevent employment â each case is assessed individually. Failure to disclose may result in dismissal.</p>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                {declarationQuestions.map((q) => {\n                                    const Icon = q.icon;\n                                    const fieldValue = watchAllFields[q.key as keyof CharacterDeclarationData] as boolean;\n\n                                    return (\n                                        <div key={q.key} className=\"border border-gray-200 rounded-lg p-4 hover:border-gray-300 transition-colors\">\n                                            <div className=\"flex items-start gap-3\">\n                                                <Icon className=\"w-5 h-5 text-gray-500 flex-shrink-0 mt-1\" />\n                                                <div className=\"flex-1\">\n                                                    <p className=\"font-medium text-gray-900 mb-3\">{q.question}</p>\n                                                    <div className=\"flex gap-4\">\n                                                        <label className=\"flex items-center gap-2 cursor-pointer\">\n                                                            <input\n                                                                type=\"radio\"\n                                                                value=\"false\"\n                                                                {...register(q.key as any)}\n                                                                className=\"w-4 h-4 text-cyan-600\"\n                                                            />\n                                                            <span className=\"text-sm\">No</span>\n                                                        </label>\n                                                        <label className=\"flex items-center gap-2 cursor-pointer\">\n                                                            <input\n                                                                type=\"radio\"\n                                                                value=\"true\"\n                                                                {...register(q.key as any)}\n                                                                className=\"w-4 h-4 text-cyan-600\"\n                                                            />\n                                                            <span className=\"text-sm\">Yes</span>\n                                                        </label>\n                                                    </div>\n                                                    {fieldValue && (\n                                                        <div className=\"mt-3\">\n                                                            <label className=\"block text-sm text-gray-600 mb-1\">{q.detailsLabel}</label>\n                                                            <textarea\n                                                                {...register(`${q.key}_details` as any)}\n                                                                rows={3}\n                                                                className=\"block w-full rounded-lg border-gray-300 shadow-sm focus:border-cyan-500 focus:ring-cyan-500 text-sm\"\n                                                            />\n                                                        </div>\n                                                    )}\n                                                </div>\n                                            </div>\n                                        </div>\n                                    );\n                                })}\n                            </div>\n                        )}\n\n                        {/* Step 3: Values Assessment */}\n                        {step === 3 && (\n                            <div className=\"space-y-6\">\n                                <div className=\"bg-purple-50 border border-purple-200 rounded-lg p-4\">\n                                    <div className=\"flex items-start gap-3\">\n                                        <Heart className=\"w-5 h-5 text-purple-600 flex-shrink-0 mt-0.5\" />\n                                        <div className=\"text-sm text-purple-800\">\n                                            <p className=\"font-semibold\">Values-Based Assessment</p>\n                                            <p className=\"mt-1\">Working in care requires specific values and behaviours. Please provide genuine examples from your experience. Minimum 100 characters per response.</p>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                {valuesQuestions.map((q) => (\n                                    <div key={q.key} className=\"border border-gray-200 rounded-lg p-4\">\n                                        <label className=\"block font-semibold text-gray-900 mb-2 flex items-center gap-2\">\n                                            <Heart className=\"w-4 h-4 text-purple-500\" />\n                                            {q.label}\n                                        </label>\n                                        <p className=\"text-sm text-gray-600 mb-3\">{q.prompt}</p>\n                                        <textarea\n                                            {...register(q.key as any, {\n                                                required: `${q.label} response is required`,\n                                                minLength: {\n                                                    value: q.minLength,\n                                                    message: `Please provide at least ${q.minLength} characters`\n                                                }\n                                            })}\n                                            rows={4}\n                                            className=\"block w-full rounded-lg border-gray-300 shadow-sm focus:border-cyan-500 focus:ring-cyan-500\"\n                                            placeholder={q.placeholder}\n                                        />\n                                        <div className=\"flex justify-between mt-1\">\n                                            {errors[q.key as keyof CharacterDeclarationData] && (\n                                                <p className=\"text-red-500 text-xs\">{(errors[q.key as keyof CharacterDeclarationData] as any)?.message}</p>\n                                            )}\n                                            <p className=\"text-xs text-gray-400 ml-auto\">\n                                                {(watchAllFields[q.key as keyof CharacterDeclarationData] as string || '').length} / {q.minLength} min\n                                            </p>\n                                        </div>\n                                    </div>\n                                ))}\n                            </div>\n                        )}\n\n                        {/* Step 4: Consent & Signature */}\n                        {step === 4 && (\n                            <div className=\"space-y-6\">\n                                <div className=\"bg-green-50 border border-green-200 rounded-lg p-4\">\n                                    <div className=\"flex items-start gap-3\">\n                                        <CheckCircle className=\"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5\" />\n                                        <div className=\"text-sm text-green-800\">\n                                            <p className=\"font-semibold\">Final Step: Consent & Declaration</p>\n                                            <p className=\"mt-1\">Please read each statement carefully and tick to confirm your consent.</p>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div className=\"space-y-4\">\n                                    <label className=\"flex items-start gap-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer\">\n                                        <input\n                                            type=\"checkbox\"\n                                            {...register('consent_background_check', { required: 'This consent is required' })}\n                                            className=\"w-5 h-5 text-cyan-600 rounded mt-0.5\"\n                                        />\n                                        <div>\n                                            <span className=\"font-medium text-gray-900\">DBS Check Consent *</span>\n                                            <p className=\"text-sm text-gray-600 mt-1\">I consent to an Enhanced DBS check including a check of the Adults and Children's Barred Lists where applicable to the role.</p>\n                                        </div>\n                                    </label>\n\n                                    <label className=\"flex items-start gap-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer\">\n                                        <input\n                                            type=\"checkbox\"\n                                            {...register('consent_reference_check', { required: 'This consent is required' })}\n                                            className=\"w-5 h-5 text-cyan-600 rounded mt-0.5\"\n                                        />\n                                        <div>\n                                            <span className=\"font-medium text-gray-900\">Reference Check Consent *</span>\n                                            <p className=\"text-sm text-gray-600 mt-1\">I consent to the organisation contacting my previous employers and referees to obtain references.</p>\n                                        </div>\n                                    </label>\n\n                                    <label className=\"flex items-start gap-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer\">\n                                        <input\n                                            type=\"checkbox\"\n                                            {...register('consent_data_processing', { required: 'This consent is required' })}\n                                            className=\"w-5 h-5 text-cyan-600 rounded mt-0.5\"\n                                        />\n                                        <div>\n                                            <span className=\"font-medium text-gray-900\">Data Processing Consent *</span>\n                                            <p className=\"text-sm text-gray-600 mt-1\">I consent to my personal data being processed in accordance with GDPR for the purposes of assessing my suitability for employment.</p>\n                                        </div>\n                                    </label>\n\n                                    <label className=\"flex items-start gap-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer bg-amber-50\">\n                                        <input\n                                            type=\"checkbox\"\n                                            {...register('declaration_truthful', { required: 'You must confirm this declaration' })}\n                                            className=\"w-5 h-5 text-amber-600 rounded mt-0.5\"\n                                        />\n                                        <div>\n                                            <span className=\"font-medium text-amber-900\">Declaration of Truth *</span>\n                                            <p className=\"text-sm text-amber-800 mt-1\">I declare that all information provided in this form is true, complete, and accurate. I understand that providing false or misleading information may result in the withdrawal of any offer of employment, or dismissal if already employed.</p>\n                                        </div>\n                                    </label>\n                                </div>\n\n                                {/* Signature */}\n                                <div className=\"border-t border-gray-200 pt-6 mt-6\">\n                                    <h4 className=\"font-semibold text-gray-900 mb-4 flex items-center gap-2\">\n                                        <FileText className=\"w-5 h-5\" />\n                                        Electronic Signature\n                                    </h4>\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                                        <div>\n                                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Type Your Full Name *</label>\n                                            <input\n                                                type=\"text\"\n                                                {...register('signature_name', { required: 'Signature is required' })}\n                                                className=\"block w-full rounded-lg border-gray-300 shadow-sm focus:border-cyan-500 focus:ring-cyan-500 font-serif text-lg\"\n                                                placeholder=\"Your full name as signature\"\n                                            />\n                                        </div>\n                                        <div>\n                                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Date *</label>\n                                            <input\n                                                type=\"date\"\n                                                {...register('signature_date', { required: 'Date is required' })}\n                                                className=\"block w-full rounded-lg border-gray-300 shadow-sm focus:border-cyan-500 focus:ring-cyan-500\"\n                                            />\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        )}\n                    </div>\n\n                    {/* Footer Navigation */}\n                    <div className=\"p-6 border-t border-gray-200 bg-gray-50 flex justify-between\">\n                        <button\n                            type=\"button\"\n                            onClick={() => step > 1 ? setStep(step - 1) : onCancel()}\n                            className=\"px-5 py-2.5 bg-white text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium\"\n                        >\n                            {step === 1 ? 'Cancel' : 'Previous'}\n                        </button>\n\n                        {step < totalSteps ? (\n                            <button\n                                type=\"button\"\n                                onClick={() => setStep(step + 1)}\n                                className=\"px-5 py-2.5 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 font-medium flex items-center gap-2\"\n                            >\n                                Next Step\n                                <CheckCircle className=\"w-4 h-4\" />\n                            </button>\n                        ) : (\n                            <button\n                                type=\"submit\"\n                                disabled={loading}\n                                className=\"px-5 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 font-medium flex items-center gap-2\"\n                            >\n                                {loading && <Loader2 className=\"w-4 h-4 animate-spin\" />}\n                                <Shield className=\"w-4 h-4\" />\n                                Submit Declaration\n                            </button>\n                        )}\n                    </div>\n                </form>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/CompetencyAssessment.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Star' is defined but never used. Allowed unused vars must match /^_/u.","line":26,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used. Allowed unused vars must match /^_/u.","line":27,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Upload' is defined but never used. Allowed unused vars must match /^_/u.","line":28,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":11},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadCompetencyRecords'. Either include it or remove the dependency array.","line":97,"column":8,"nodeType":"ArrayExpression","endLine":97,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [employeeId, loadCompetencyRecords]","fix":{"range":[3810,3822],"text":"[employeeId, loadCompetencyRecords]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Competency Assessment Component\n * \n * Provides a structured interface for:\n * - Viewing employee competency progress\n * - Recording competency evidence\n * - Supervisor sign-off workflow\n * \n * CQC Regulation 18 & 19 compliant\n */\n\nimport React, { useState, useEffect } from 'react';\nimport {\n    Award,\n    CheckCircle,\n    Clock,\n    AlertTriangle,\n    BookOpen,\n    Eye,\n    UserCheck,\n    FileCheck,\n    ChevronRight,\n    X,\n    Loader2,\n    ClipboardCheck,\n    Star,\n    Calendar,\n    Upload,\n    MessageSquare\n} from 'lucide-react';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport {\n    COMPETENCY_CATEGORIES,\n    CompetencyRecord,\n    CompetencyStatus,\n    EvidenceType,\n    getRequiredCompetenciesForRole,\n    calculateCompetencyCompletion\n} from '@/lib/competencies/competencyTypes';\n\ninterface CompetencyAssessmentProps {\n    employeeId: string;\n    employeeName: string;\n    employeeRole: string;\n    onClose: () => void;\n}\n\nconst statusConfig: Record<CompetencyStatus, { color: string; bg: string; label: string; icon: React.ReactNode }> = {\n    'not_started': { color: 'text-gray-500', bg: 'bg-gray-100', label: 'Not Started', icon: <Clock className=\"w-4 h-4\" /> },\n    'in_progress': { color: 'text-blue-600', bg: 'bg-blue-100', label: 'In Progress', icon: <BookOpen className=\"w-4 h-4\" /> },\n    'pending_signoff': { color: 'text-amber-600', bg: 'bg-amber-100', label: 'Pending Sign-off', icon: <Eye className=\"w-4 h-4\" /> },\n    'competent': { color: 'text-green-600', bg: 'bg-green-100', label: 'Competent', icon: <CheckCircle className=\"w-4 h-4\" /> },\n    'expired': { color: 'text-red-600', bg: 'bg-red-100', label: 'Expired', icon: <AlertTriangle className=\"w-4 h-4\" /> },\n    'not_applicable': { color: 'text-gray-400', bg: 'bg-gray-50', label: 'N/A', icon: <X className=\"w-4 h-4\" /> }\n};\n\nconst evidenceTypes: { value: EvidenceType; label: string; description: string }[] = [\n    { value: 'observation', label: 'Direct Observation', description: 'Supervisor observed competency in practice' },\n    { value: 'practical_assessment', label: 'Practical Assessment', description: 'Formal practical skills test' },\n    { value: 'written_test', label: 'Written Test/Quiz', description: 'Knowledge assessment completed' },\n    { value: 'certificate', label: 'External Certificate', description: 'Certificate from training provider' },\n    { value: 'training_completion', label: 'Training Completion', description: 'Completed e-learning or course' },\n    { value: 'self_declaration', label: 'Self-Declaration', description: 'Employee self-assessment (provisional)' }\n];\n\nexport default function CompetencyAssessment({\n    employeeId,\n    employeeName,\n    employeeRole,\n    onClose\n}: CompetencyAssessmentProps) {\n    const { currentTenant } = useTenant();\n    const { user, profile } = useAuth();\n    const [loading, setLoading] = useState(true);\n    const [records, setRecords] = useState<CompetencyRecord[]>([]);\n    const [activeCategory, setActiveCategory] = useState<string | null>(null);\n    const [signoffModal, setSignoffModal] = useState<{\n        record: CompetencyRecord | null;\n        categoryName: string;\n    } | null>(null);\n    const [signoffData, setSignoffData] = useState({\n        evidenceType: 'observation' as EvidenceType,\n        evidenceNotes: '',\n        outcome: 'competent' as 'competent' | 'not_yet_competent' | 'needs_development',\n        developmentNotes: ''\n    });\n    const [submitting, setSubmitting] = useState(false);\n\n    // Get required competencies for this role\n    const requiredCompetencies = getRequiredCompetenciesForRole(employeeRole);\n\n    useEffect(() => {\n        loadCompetencyRecords();\n    }, [employeeId]);\n\n    const loadCompetencyRecords = async () => {\n        if (!currentTenant) return;\n\n        setLoading(true);\n        try {\n            const { data, error } = await supabase\n                .from('competency_records')\n                .select('*')\n                .eq('tenant_id', currentTenant.id)\n                .eq('employee_id', employeeId);\n\n            if (error) throw error;\n            setRecords(data || []);\n        } catch (error) {\n            log.error('Error loading competency records', error, { component: 'CompetencyAssessment', action: 'loadCompetencyRecords', metadata: { employeeId } });\n            // Initialize with empty records for demonstration\n            setRecords([]);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const getRecordForStandard = (categoryId: string, standardId: string): CompetencyRecord | undefined => {\n        return records.find(r => r.category_id === categoryId && r.standard_id === standardId);\n    };\n\n    const getStatusForStandard = (categoryId: string, standardId: string): CompetencyStatus => {\n        const record = getRecordForStandard(categoryId, standardId);\n        return record?.status || 'not_started';\n    };\n\n    const calculateCategoryCompletion = (categoryId: string): { completed: number; total: number; percentage: number } => {\n        const category = Object.values(COMPETENCY_CATEGORIES).find(c => c.id === categoryId);\n        if (!category) return { completed: 0, total: 0, percentage: 0 };\n\n        const total = category.standards.length;\n        const completed = category.standards.filter(s =>\n            getStatusForStandard(categoryId, s.id) === 'competent'\n        ).length;\n\n        return { completed, total, percentage: total > 0 ? Math.round((completed / total) * 100) : 0 };\n    };\n\n    const handleSignoff = async () => {\n        if (!signoffModal?.record && !activeCategory) return;\n        if (!currentTenant || !user) return;\n\n        setSubmitting(true);\n        try {\n            // Create or update competency record\n            const recordData = {\n                tenant_id: currentTenant.id,\n                employee_id: employeeId,\n                category_id: signoffModal?.record?.category_id || activeCategory,\n                standard_id: signoffModal?.record?.standard_id,\n                standard_name: signoffModal?.record?.standard_name,\n                status: signoffData.outcome === 'competent' ? 'competent' :\n                    signoffData.outcome === 'needs_development' ? 'in_progress' : 'not_started',\n                evidence_type: signoffData.evidenceType,\n                evidence_notes: signoffData.evidenceNotes,\n                assessed_by: user.id,\n                assessed_at: new Date().toISOString(),\n                assessor_role: profile?.role,\n                signed_off_by: signoffData.outcome === 'competent' ? user.id : null,\n                signed_off_at: signoffData.outcome === 'competent' ? new Date().toISOString() : null,\n                signoff_notes: signoffData.developmentNotes,\n                requires_renewal: false,\n                updated_at: new Date().toISOString()\n            };\n\n            const { error } = signoffModal?.record?.id\n                ? await supabase\n                    .from('competency_records')\n                    .update(recordData)\n                    .eq('id', signoffModal.record.id)\n                : await supabase\n                    .from('competency_records')\n                    .insert(recordData);\n\n            if (error) throw error;\n\n            // Reload records\n            await loadCompetencyRecords();\n            setSignoffModal(null);\n            setSignoffData({\n                evidenceType: 'observation',\n                evidenceNotes: '',\n                outcome: 'competent',\n                developmentNotes: ''\n            });\n\n            alert('Competency assessment saved successfully!');\n        } catch (error) {\n            log.error('Error saving competency', error, { component: 'CompetencyAssessment', action: 'handleSignoff', metadata: { employeeId } });\n            alert('Failed to save assessment. Please try again.');\n        } finally {\n            setSubmitting(false);\n        }\n    };\n\n    const overallCompletion = calculateCompetencyCompletion(records, requiredCompetencies);\n\n    return (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n            <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col\">\n                {/* Header */}\n                <div className=\"p-6 border-b border-gray-200 bg-gradient-to-r from-purple-600 to-indigo-600\">\n                    <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-4\">\n                            <div className=\"p-3 bg-white/20 rounded-xl\">\n                                <Award className=\"w-8 h-8 text-white\" />\n                            </div>\n                            <div>\n                                <h2 className=\"text-xl font-bold text-white\">Competency Assessment</h2>\n                                <p className=\"text-purple-100\">{employeeName} â¢ {employeeRole}</p>\n                            </div>\n                        </div>\n                        <div className=\"flex items-center gap-4\">\n                            <div className=\"text-right\">\n                                <p className=\"text-sm text-purple-100\">Overall Completion</p>\n                                <p className=\"text-2xl font-bold text-white\">{overallCompletion}%</p>\n                            </div>\n                            <button onClick={onClose} className=\"text-white/80 hover:text-white text-2xl\">\n                                &times;\n                            </button>\n                        </div>\n                    </div>\n                </div>\n\n                {/* Content */}\n                <div className=\"flex-1 overflow-hidden flex\">\n                    {/* Category Sidebar */}\n                    <div className=\"w-72 border-r border-gray-200 bg-gray-50 overflow-y-auto\">\n                        <div className=\"p-4\">\n                            <h3 className=\"text-sm font-semibold text-gray-500 uppercase tracking-wide mb-3\">\n                                Competency Areas\n                            </h3>\n                            {Object.values(COMPETENCY_CATEGORIES).map(category => {\n                                const { completed, total, percentage } = calculateCategoryCompletion(category.id);\n                                const isActive = activeCategory === category.id;\n                                const isRequired = category.requiredFor.includes(employeeRole as any);\n\n                                return (\n                                    <button\n                                        key={category.id}\n                                        onClick={() => setActiveCategory(isActive ? null : category.id)}\n                                        className={`w-full text-left p-3 rounded-lg mb-2 transition-all ${isActive\n                                            ? 'bg-purple-100 border-purple-300 border'\n                                            : 'bg-white border border-gray-200 hover:border-purple-200'\n                                            } ${!isRequired ? 'opacity-50' : ''}`}\n                                    >\n                                        <div className=\"flex items-center justify-between mb-2\">\n                                            <span className={`font-medium ${isActive ? 'text-purple-700' : 'text-gray-700'}`}>\n                                                {category.name}\n                                            </span>\n                                            <ChevronRight className={`w-4 h-4 transition-transform ${isActive ? 'rotate-90 text-purple-600' : 'text-gray-400'}`} />\n                                        </div>\n                                        <div className=\"flex items-center gap-2\">\n                                            <div className=\"flex-1 h-2 bg-gray-200 rounded-full overflow-hidden\">\n                                                <div\n                                                    className=\"h-full bg-green-500 rounded-full transition-all\"\n                                                    style={{ width: `${percentage}%` }}\n                                                />\n                                            </div>\n                                            <span className=\"text-xs text-gray-500\">{completed}/{total}</span>\n                                        </div>\n                                        {!isRequired && (\n                                            <p className=\"text-xs text-gray-400 mt-1\">Not required for this role</p>\n                                        )}\n                                    </button>\n                                );\n                            })}\n                        </div>\n                    </div>\n\n                    {/* Main Content */}\n                    <div className=\"flex-1 overflow-y-auto p-6\">\n                        {loading ? (\n                            <div className=\"flex items-center justify-center h-64\">\n                                <Loader2 className=\"w-8 h-8 animate-spin text-purple-600\" />\n                            </div>\n                        ) : activeCategory ? (\n                            <div>\n                                {Object.values(COMPETENCY_CATEGORIES)\n                                    .filter(c => c.id === activeCategory)\n                                    .map(category => (\n                                        <div key={category.id}>\n                                            <div className=\"mb-6\">\n                                                <h3 className=\"text-lg font-bold text-gray-900\">{category.name}</h3>\n                                                <p className=\"text-gray-600 mt-1\">{category.description}</p>\n                                            </div>\n\n                                            <div className=\"space-y-3\">\n                                                {category.standards.map(standard => {\n                                                    const status = getStatusForStandard(category.id, standard.id);\n                                                    const record = getRecordForStandard(category.id, standard.id);\n                                                    const config = statusConfig[status];\n\n                                                    return (\n                                                        <div\n                                                            key={standard.id}\n                                                            className=\"border border-gray-200 rounded-lg p-4 hover:border-purple-200 transition-colors\"\n                                                        >\n                                                            <div className=\"flex items-start justify-between gap-4\">\n                                                                <div className=\"flex-1\">\n                                                                    <div className=\"flex items-center gap-2 mb-1\">\n                                                                        <span className=\"font-medium text-gray-900\">{standard.name}</span>\n                                                                        <span className={`px-2 py-0.5 rounded-full text-xs font-medium flex items-center gap-1 ${config.bg} ${config.color}`}>\n                                                                            {config.icon}\n                                                                            {config.label}\n                                                                        </span>\n                                                                    </div>\n                                                                    <p className=\"text-sm text-gray-600\">{standard.description}</p>\n\n                                                                    {record?.signed_off_at && (\n                                                                        <div className=\"flex items-center gap-2 mt-2 text-xs text-gray-500\">\n                                                                            <UserCheck className=\"w-3 h-3\" />\n                                                                            Signed off: {new Date(record.signed_off_at).toLocaleDateString()}\n                                                                        </div>\n                                                                    )}\n                                                                </div>\n\n                                                                <button\n                                                                    onClick={() => setSignoffModal({\n                                                                        record: record || {\n                                                                            id: '',\n                                                                            tenant_id: currentTenant?.id || '',\n                                                                            employee_id: employeeId,\n                                                                            category_id: category.id,\n                                                                            standard_id: standard.id,\n                                                                            standard_name: standard.name,\n                                                                            status: 'not_started',\n                                                                            requires_renewal: false,\n                                                                            created_at: new Date().toISOString(),\n                                                                            updated_at: new Date().toISOString()\n                                                                        } as CompetencyRecord,\n                                                                        categoryName: category.name\n                                                                    })}\n                                                                    className=\"px-3 py-1.5 bg-purple-100 text-purple-700 rounded-lg text-sm font-medium hover:bg-purple-200 transition-colors flex items-center gap-1\"\n                                                                >\n                                                                    <ClipboardCheck className=\"w-4 h-4\" />\n                                                                    {status === 'competent' ? 'Update' : 'Assess'}\n                                                                </button>\n                                                            </div>\n                                                        </div>\n                                                    );\n                                                })}\n                                            </div>\n                                        </div>\n                                    ))}\n                            </div>\n                        ) : (\n                            <div className=\"flex flex-col items-center justify-center h-64 text-center\">\n                                <Award className=\"w-16 h-16 text-gray-300 mb-4\" />\n                                <h3 className=\"text-lg font-semibold text-gray-700\">Select a Competency Area</h3>\n                                <p className=\"text-gray-500 mt-1 max-w-md\">\n                                    Choose a category from the sidebar to view and assess individual competencies\n                                </p>\n                            </div>\n                        )}\n                    </div>\n                </div>\n            </div>\n\n            {/* Sign-off Modal */}\n            {signoffModal && (\n                <div className=\"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-60 p-4\">\n                    <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-lg overflow-hidden\">\n                        <div className=\"p-5 border-b border-gray-200 bg-gradient-to-r from-green-600 to-emerald-600\">\n                            <div className=\"flex items-center justify-between\">\n                                <div className=\"flex items-center gap-3\">\n                                    <FileCheck className=\"w-6 h-6 text-white\" />\n                                    <div>\n                                        <h3 className=\"font-bold text-white\">Competency Sign-Off</h3>\n                                        <p className=\"text-green-100 text-sm\">{signoffModal.record?.standard_name}</p>\n                                    </div>\n                                </div>\n                                <button onClick={() => setSignoffModal(null)} className=\"text-white/80 hover:text-white\">\n                                    <X className=\"w-5 h-5\" />\n                                </button>\n                            </div>\n                        </div>\n\n                        <div className=\"p-5 space-y-5\">\n                            {/* Assessment Outcome */}\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Assessment Outcome *</label>\n                                <div className=\"grid grid-cols-3 gap-2\">\n                                    {[\n                                        { value: 'competent', label: 'Competent', color: 'green', icon: <CheckCircle className=\"w-4 h-4\" /> },\n                                        { value: 'needs_development', label: 'Needs Development', color: 'amber', icon: <BookOpen className=\"w-4 h-4\" /> },\n                                        { value: 'not_yet_competent', label: 'Not Yet Competent', color: 'red', icon: <AlertTriangle className=\"w-4 h-4\" /> }\n                                    ].map(option => (\n                                        <button\n                                            key={option.value}\n                                            type=\"button\"\n                                            onClick={() => setSignoffData(prev => ({ ...prev, outcome: option.value as any }))}\n                                            className={`p-3 rounded-lg border-2 text-sm font-medium flex flex-col items-center gap-1 transition-all ${signoffData.outcome === option.value\n                                                ? `border-${option.color}-500 bg-${option.color}-50 text-${option.color}-700`\n                                                : 'border-gray-200 hover:border-gray-300 text-gray-600'\n                                                }`}\n                                        >\n                                            {option.icon}\n                                            {option.label}\n                                        </button>\n                                    ))}\n                                </div>\n                            </div>\n\n                            {/* Evidence Type */}\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Evidence Type *</label>\n                                <select\n                                    value={signoffData.evidenceType}\n                                    onChange={(e) => setSignoffData(prev => ({ ...prev, evidenceType: e.target.value as EvidenceType }))}\n                                    className=\"w-full rounded-lg border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500\"\n                                >\n                                    {evidenceTypes.map(type => (\n                                        <option key={type.value} value={type.value}>{type.label}</option>\n                                    ))}\n                                </select>\n                                <p className=\"text-xs text-gray-500 mt-1\">\n                                    {evidenceTypes.find(t => t.value === signoffData.evidenceType)?.description}\n                                </p>\n                            </div>\n\n                            {/* Evidence Notes */}\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                    <MessageSquare className=\"w-4 h-4 inline-block mr-1\" />\n                                    Evidence Notes *\n                                </label>\n                                <textarea\n                                    value={signoffData.evidenceNotes}\n                                    onChange={(e) => setSignoffData(prev => ({ ...prev, evidenceNotes: e.target.value }))}\n                                    rows={3}\n                                    className=\"w-full rounded-lg border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500\"\n                                    placeholder=\"Describe the evidence observed or reviewed...\"\n                                />\n                            </div>\n\n                            {/* Development Notes (if not competent) */}\n                            {signoffData.outcome !== 'competent' && (\n                                <div>\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">Development Actions Required</label>\n                                    <textarea\n                                        value={signoffData.developmentNotes}\n                                        onChange={(e) => setSignoffData(prev => ({ ...prev, developmentNotes: e.target.value }))}\n                                        rows={2}\n                                        className=\"w-full rounded-lg border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500\"\n                                        placeholder=\"Describe what training or support is needed...\"\n                                    />\n                                </div>\n                            )}\n                        </div>\n\n                        <div className=\"p-5 border-t border-gray-200 bg-gray-50 flex justify-end gap-3\">\n                            <button\n                                type=\"button\"\n                                onClick={() => setSignoffModal(null)}\n                                className=\"px-4 py-2 bg-white text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium\"\n                            >\n                                Cancel\n                            </button>\n                            <button\n                                type=\"button\"\n                                onClick={handleSignoff}\n                                disabled={submitting || !signoffData.evidenceNotes}\n                                className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 font-medium flex items-center gap-2\"\n                            >\n                                {submitting && <Loader2 className=\"w-4 h-4 animate-spin\" />}\n                                <UserCheck className=\"w-4 h-4\" />\n                                Confirm Sign-Off\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/ComplianceAlerts.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadAlerts'. Either include it or remove the dependency array.","line":15,"column":8,"nodeType":"ArrayExpression","endLine":15,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [currentTenant, loadAlerts]","fix":{"range":[661,676],"text":"[currentTenant, loadAlerts]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { complianceService, DBSCheck, TrainingRecord } from '@/lib/services/ComplianceService';\nimport { log } from '@/lib/logger';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { AlertTriangle, Clock, AlertCircle, ChevronRight } from 'lucide-react';\n\nexport default function ComplianceAlerts() {\n    const { currentTenant } = useTenant();\n    const [loading, setLoading] = useState(true);\n    const [expiringDBS, setExpiringDBS] = useState<DBSCheck[]>([]);\n    const [expiringTraining, setExpiringTraining] = useState<TrainingRecord[]>([]);\n\n    useEffect(() => {\n        loadAlerts();\n    }, [currentTenant]);\n\n    const loadAlerts = async () => {\n        if (!currentTenant) return;\n\n        setLoading(true);\n        try {\n            const [dbs, training] = await Promise.all([\n                complianceService.getExpiringDBS(90), // 3 months notice for DBS\n                complianceService.getExpiringCertificates(30) // 1 month notice for training\n            ]);\n\n            setExpiringDBS(dbs);\n            setExpiringTraining(training);\n        } catch (error) {\n            log.error('Error loading compliance alerts', error, { component: 'ComplianceAlerts', action: 'loadAlerts' });\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    if (loading) {\n        return <div className=\"animate-pulse h-32 bg-gray-100 rounded-lg\"></div>;\n    }\n\n    if (expiringDBS.length === 0 && expiringTraining.length === 0) {\n        return (\n            <div className=\"bg-green-50 border border-green-200 rounded-lg p-4 flex items-center gap-3\">\n                <div className=\"bg-green-100 p-2 rounded-full\">\n                    <Clock className=\"w-5 h-5 text-green-600\" />\n                </div>\n                <div>\n                    <h3 className=\"font-medium text-green-900\">No Immediate Actions</h3>\n                    <p className=\"text-sm text-green-700\">All compliance checks and training are up to date.</p>\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-4\">\n            <h3 className=\"font-semibold text-gray-900 flex items-center gap-2\">\n                <AlertTriangle className=\"w-5 h-5 text-orange-500\" />\n                Compliance Alerts\n            </h3>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {/* DBS Alerts */}\n                {expiringDBS.length > 0 && (\n                    <div className=\"bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden\">\n                        <div className=\"bg-orange-50 px-4 py-3 border-b border-orange-100 flex justify-between items-center\">\n                            <h4 className=\"font-medium text-orange-900 flex items-center gap-2\">\n                                <AlertCircle className=\"w-4 h-4\" />\n                                DBS Renewals Due ({expiringDBS.length})\n                            </h4>\n                        </div>\n                        <div className=\"divide-y divide-gray-100 max-h-60 overflow-y-auto\">\n                            {expiringDBS.map(check => (\n                                <div key={check.id} className=\"p-3 hover:bg-gray-50 flex justify-between items-center gap-3 group\">\n                                    <div className=\"min-w-0 flex-1\">\n                                        <p className=\"text-sm font-medium text-gray-900 truncate\">{check.applicant_name}</p>\n                                        <p className=\"text-xs text-gray-500\">Expires: {check.expiry_date}</p>\n                                    </div>\n                                    <button className=\"text-gray-400 hover:text-cyan-600 transition-colors flex-shrink-0\">\n                                        <ChevronRight className=\"w-5 h-5\" />\n                                    </button>\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n                )}\n\n                {/* Training Alerts */}\n                {expiringTraining.length > 0 && (\n                    <div className=\"bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden\">\n                        <div className=\"bg-yellow-50 px-4 py-3 border-b border-yellow-100 flex justify-between items-center\">\n                            <h4 className=\"font-medium text-yellow-900 flex items-center gap-2\">\n                                <Clock className=\"w-4 h-4\" />\n                                Training Expiring ({expiringTraining.length})\n                            </h4>\n                        </div>\n                        <div className=\"divide-y divide-gray-100 max-h-60 overflow-y-auto\">\n                            {expiringTraining.map(record => (\n                                <div key={record.id} className=\"p-3 hover:bg-gray-50 flex justify-between items-center gap-3 group\">\n                                    <div className=\"min-w-0 flex-1\">\n                                        <p className=\"text-sm font-medium text-gray-900 truncate\">{record.staff_name}</p>\n                                        <p className=\"text-xs text-gray-500 mt-0.5 break-words\">\n                                            <span className=\"font-medium\">{record.training_name}</span>\n                                            <span className=\"mx-1 text-gray-300\">â¢</span>\n                                            <span className=\"whitespace-nowrap\">Expires: {record.expiry_date}</span>\n                                        </p>\n                                    </div>\n                                    <button className=\"text-gray-400 hover:text-cyan-600 transition-colors flex-shrink-0\">\n                                        <ChevronRight className=\"w-5 h-5\" />\n                                    </button>\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/ComplianceReportSettings.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadReportHistory' and 'loadSettings'. Either include them or remove the dependency array.","line":70,"column":8,"nodeType":"ArrayExpression","endLine":70,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [currentTenant, loadReportHistory, loadSettings]","fix":{"range":[1880,1895],"text":"[currentTenant, loadReportHistory, loadSettings]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":142,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":142,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Compliance Report Settings Component\n * \n * Allows administrators to:\n * - Enable/disable monthly compliance reports\n * - Configure notification recipients\n * - Manually trigger a report\n * - View report history\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport {\n    Mail,\n    CalendarClock,\n    Send,\n    CheckCircle,\n    Loader2,\n    AlertCircle,\n    Settings,\n    Bell,\n    Users,\n    History,\n    Eye\n} from 'lucide-react';\nimport { format } from 'date-fns';\nimport { toast } from 'sonner';\n\ninterface ReportSettings {\n    compliance_email_notifications: boolean;\n    report_recipients: string[];\n    report_frequency: 'monthly' | 'weekly' | 'quarterly';\n    include_training_matrix: boolean;\n    include_expiry_alerts: boolean;\n}\n\ninterface ReportHistory {\n    id: string;\n    timestamp: string;\n    admins_notified: number;\n    metrics: {\n        complianceRate: number;\n        totalStaff: number;\n        cqcReady: boolean;\n    };\n}\n\nexport default function ComplianceReportSettings() {\n    const { currentTenant } = useTenant();\n    const [loading, setLoading] = useState(true);\n    const [saving, setSaving] = useState(false);\n    const [sendingReport, setSendingReport] = useState(false);\n    const [settings, setSettings] = useState<ReportSettings>({\n        compliance_email_notifications: true,\n        report_recipients: [],\n        report_frequency: 'monthly',\n        include_training_matrix: true,\n        include_expiry_alerts: true\n    });\n    const [reportHistory, setReportHistory] = useState<ReportHistory[]>([]);\n    const [newRecipient, setNewRecipient] = useState('');\n\n    useEffect(() => {\n        if (currentTenant) {\n            loadSettings();\n            loadReportHistory();\n        }\n    }, [currentTenant]);\n\n    const loadSettings = async () => {\n        if (!currentTenant?.settings) {\n            setLoading(false);\n            return;\n        }\n\n        setSettings({\n            compliance_email_notifications: currentTenant.settings.compliance_email_notifications !== false,\n            report_recipients: currentTenant.settings.report_recipients || [],\n            report_frequency: currentTenant.settings.report_frequency || 'monthly',\n            include_training_matrix: currentTenant.settings.include_training_matrix !== false,\n            include_expiry_alerts: currentTenant.settings.include_expiry_alerts !== false\n        });\n        setLoading(false);\n    };\n\n    const loadReportHistory = async () => {\n        if (!currentTenant) return;\n\n        const { data } = await supabase\n            .from('audit_logs')\n            .select('*')\n            .eq('tenant_id', currentTenant.id)\n            .eq('action', 'compliance_report_generated')\n            .order('timestamp', { ascending: false })\n            .limit(10);\n\n        if (data) {\n            setReportHistory(data.map((log: any) => {\n                const details = JSON.parse(log.details || '{}');\n                return {\n                    id: log.id,\n                    timestamp: log.timestamp,\n                    admins_notified: details.admins_notified || 0,\n                    metrics: details.metrics || {}\n                };\n            }));\n        }\n    };\n\n    const handleSave = async () => {\n        if (!currentTenant) return;\n\n        setSaving(true);\n        try {\n            const { error } = await supabase\n                .from('tenants')\n                .update({\n                    settings: {\n                        ...currentTenant.settings,\n                        ...settings\n                    }\n                })\n                .eq('id', currentTenant.id);\n\n            if (error) throw error;\n            toast.success('Compliance report settings saved');\n        } catch (error) {\n            log.error('Error saving settings', error, { component: 'ComplianceReportSettings', action: 'handleSave' });\n            toast.error('Failed to save settings');\n        } finally {\n            setSaving(false);\n        }\n    };\n\n    const handleSendTestReport = async () => {\n        if (!currentTenant) return;\n\n        setSendingReport(true);\n        try {\n            const { data, error } = await supabase.functions.invoke('monthly-compliance-report', {\n                body: {\n                    tenant_id: currentTenant.id,\n                    force_email: true\n                }\n            });\n\n            if (error) throw error;\n\n            toast.success('Compliance report generated and sent!');\n            loadReportHistory();\n        } catch (error) {\n            log.error('Error sending report', error, { component: 'ComplianceReportSettings', action: 'handleSendTestReport' });\n            toast.error('Failed to send report. Check function logs.');\n        } finally {\n            setSendingReport(false);\n        }\n    };\n\n    const addRecipient = () => {\n        if (!newRecipient || !newRecipient.includes('@')) {\n            toast.error('Please enter a valid email address');\n            return;\n        }\n        if (settings.report_recipients.includes(newRecipient)) {\n            toast.error('This email is already in the list');\n            return;\n        }\n        setSettings({\n            ...settings,\n            report_recipients: [...settings.report_recipients, newRecipient]\n        });\n        setNewRecipient('');\n    };\n\n    const removeRecipient = (email: string) => {\n        setSettings({\n            ...settings,\n            report_recipients: settings.report_recipients.filter(r => r !== email)\n        });\n    };\n\n    if (loading) {\n        return (\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6 animate-pulse\">\n                <div className=\"h-6 bg-gray-200 rounded w-1/3 mb-4\"></div>\n                <div className=\"h-32 bg-gray-100 rounded-lg\"></div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            {/* Main Settings Card */}\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden\">\n                <div className=\"bg-gradient-to-r from-cyan-600 to-cyan-700 px-6 py-4\">\n                    <div className=\"flex items-center gap-3\">\n                        <Mail className=\"w-6 h-6 text-white\" />\n                        <div>\n                            <h2 className=\"text-lg font-semibold text-white\">Compliance Email Reports</h2>\n                            <p className=\"text-cyan-100 text-sm\">Configure automated monthly compliance reports</p>\n                        </div>\n                    </div>\n                </div>\n\n                <div className=\"p-6 space-y-6\">\n                    {/* Enable/Disable Toggle */}\n                    <div className=\"flex items-center justify-between p-4 bg-gray-50 rounded-lg\">\n                        <div className=\"flex items-center gap-3\">\n                            <Bell className=\"w-5 h-5 text-cyan-600\" />\n                            <div>\n                                <h3 className=\"font-medium text-gray-900\">Monthly Reports</h3>\n                                <p className=\"text-sm text-gray-500\">\n                                    Receive automated compliance summaries on the 1st of each month\n                                </p>\n                            </div>\n                        </div>\n                        <button\n                            onClick={() => setSettings({ ...settings, compliance_email_notifications: !settings.compliance_email_notifications })}\n                            className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${settings.compliance_email_notifications ? 'bg-cyan-600' : 'bg-gray-300'\n                                }`}\n                        >\n                            <span\n                                className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${settings.compliance_email_notifications ? 'translate-x-6' : 'translate-x-1'\n                                    }`}\n                            />\n                        </button>\n                    </div>\n\n                    {/* Frequency Selection */}\n                    <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            <CalendarClock className=\"w-4 h-4 inline mr-2\" />\n                            Report Frequency\n                        </label>\n                        <select\n                            value={settings.report_frequency}\n                            onChange={(e) => setSettings({ ...settings, report_frequency: e.target.value as any })}\n                            className=\"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-cyan-500 focus:ring-cyan-500\"\n                        >\n                            <option value=\"weekly\">Weekly (Every Monday)</option>\n                            <option value=\"monthly\">Monthly (1st of month)</option>\n                            <option value=\"quarterly\">Quarterly</option>\n                        </select>\n                    </div>\n\n                    {/* Report Contents */}\n                    <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-3\">\n                            <Settings className=\"w-4 h-4 inline mr-2\" />\n                            Report Contents\n                        </label>\n                        <div className=\"space-y-3\">\n                            <label className=\"flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer\">\n                                <input\n                                    type=\"checkbox\"\n                                    checked={settings.include_training_matrix}\n                                    onChange={(e) => setSettings({ ...settings, include_training_matrix: e.target.checked })}\n                                    className=\"w-4 h-4 rounded border-gray-300 text-cyan-600 focus:ring-cyan-500\"\n                                />\n                                <div>\n                                    <span className=\"text-gray-900\">Training Compliance Matrix</span>\n                                    <p className=\"text-xs text-gray-500\">Include detailed training status for all staff</p>\n                                </div>\n                            </label>\n                            <label className=\"flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer\">\n                                <input\n                                    type=\"checkbox\"\n                                    checked={settings.include_expiry_alerts}\n                                    onChange={(e) => setSettings({ ...settings, include_expiry_alerts: e.target.checked })}\n                                    className=\"w-4 h-4 rounded border-gray-300 text-cyan-600 focus:ring-cyan-500\"\n                                />\n                                <div>\n                                    <span className=\"text-gray-900\">Expiry Alerts Summary</span>\n                                    <p className=\"text-xs text-gray-500\">List of DBS, RTW, and training expiring within 90 days</p>\n                                </div>\n                            </label>\n                        </div>\n                    </div>\n\n                    {/* Recipients */}\n                    <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            <Users className=\"w-4 h-4 inline mr-2\" />\n                            Additional Recipients\n                        </label>\n                        <p className=\"text-xs text-gray-500 mb-3\">\n                            All admins and HR managers receive reports by default. Add additional recipients below.\n                        </p>\n                        <div className=\"flex gap-2 mb-3\">\n                            <input\n                                type=\"email\"\n                                value={newRecipient}\n                                onChange={(e) => setNewRecipient(e.target.value)}\n                                onKeyDown={(e) => e.key === 'Enter' && addRecipient()}\n                                placeholder=\"email@example.com\"\n                                className=\"flex-1 rounded-lg border-gray-300 shadow-sm focus:border-cyan-500 focus:ring-cyan-500\"\n                            />\n                            <button\n                                onClick={addRecipient}\n                                className=\"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors\"\n                            >\n                                Add\n                            </button>\n                        </div>\n                        {settings.report_recipients.length > 0 && (\n                            <div className=\"flex flex-wrap gap-2\">\n                                {settings.report_recipients.map((email) => (\n                                    <span\n                                        key={email}\n                                        className=\"inline-flex items-center gap-1 px-3 py-1 bg-cyan-50 text-cyan-700 rounded-full text-sm\"\n                                    >\n                                        {email}\n                                        <button\n                                            onClick={() => removeRecipient(email)}\n                                            className=\"hover:text-cyan-900 ml-1\"\n                                        >\n                                            Ã\n                                        </button>\n                                    </span>\n                                ))}\n                            </div>\n                        )}\n                    </div>\n\n                    {/* Actions */}\n                    <div className=\"flex gap-3 pt-4 border-t border-gray-200\">\n                        <button\n                            onClick={handleSave}\n                            disabled={saving}\n                            className=\"flex-1 px-4 py-2 bg-cyan-600 hover:bg-cyan-700 disabled:bg-cyan-400 text-white rounded-lg font-medium transition-colors flex items-center justify-center gap-2\"\n                        >\n                            {saving ? (\n                                <>\n                                    <Loader2 className=\"w-4 h-4 animate-spin\" />\n                                    Saving...\n                                </>\n                            ) : (\n                                <>\n                                    <CheckCircle className=\"w-4 h-4\" />\n                                    Save Settings\n                                </>\n                            )}\n                        </button>\n                        <button\n                            onClick={handleSendTestReport}\n                            disabled={sendingReport}\n                            className=\"px-4 py-2 bg-white border border-cyan-600 text-cyan-600 hover:bg-cyan-50 disabled:opacity-50 rounded-lg font-medium transition-colors flex items-center gap-2\"\n                        >\n                            {sendingReport ? (\n                                <>\n                                    <Loader2 className=\"w-4 h-4 animate-spin\" />\n                                    Generating...\n                                </>\n                            ) : (\n                                <>\n                                    <Send className=\"w-4 h-4\" />\n                                    Send Test Report\n                                </>\n                            )}\n                        </button>\n                    </div>\n                </div>\n            </div>\n\n            {/* Report History */}\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden\">\n                <div className=\"px-6 py-4 border-b border-gray-200 flex items-center gap-3\">\n                    <History className=\"w-5 h-5 text-gray-500\" />\n                    <h3 className=\"font-medium text-gray-900\">Report History</h3>\n                </div>\n\n                {reportHistory.length > 0 ? (\n                    <div className=\"divide-y divide-gray-100\">\n                        {reportHistory.map((report) => (\n                            <div key={report.id} className=\"px-6 py-4 flex items-center justify-between hover:bg-gray-50\">\n                                <div>\n                                    <p className=\"font-medium text-gray-900\">\n                                        {format(new Date(report.timestamp), 'MMMM yyyy')} Report\n                                    </p>\n                                    <p className=\"text-sm text-gray-500\">\n                                        Generated {format(new Date(report.timestamp), 'dd MMM yyyy HH:mm')} â¢\n                                        Sent to {report.admins_notified} recipients\n                                    </p>\n                                </div>\n                                <div className=\"flex items-center gap-4\">\n                                    <span className={`px-3 py-1 rounded-full text-sm font-medium ${report.metrics.cqcReady\n                                        ? 'bg-emerald-50 text-emerald-700'\n                                        : 'bg-red-50 text-red-700'\n                                        }`}>\n                                        {report.metrics.complianceRate || 0}% compliant\n                                    </span>\n                                    <button className=\"p-2 text-gray-400 hover:text-cyan-600 transition-colors\">\n                                        <Eye className=\"w-4 h-4\" />\n                                    </button>\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n                ) : (\n                    <div className=\"px-6 py-12 text-center\">\n                        <History className=\"w-12 h-12 text-gray-300 mx-auto mb-3\" />\n                        <p className=\"text-gray-500\">No reports generated yet</p>\n                        <p className=\"text-sm text-gray-400 mt-1\">\n                            Send a test report to see it here\n                        </p>\n                    </div>\n                )}\n            </div>\n\n            {/* Info Notice */}\n            <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-start gap-3\">\n                <AlertCircle className=\"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5\" />\n                <div>\n                    <h4 className=\"font-medium text-blue-800\">Email Configuration Required</h4>\n                    <p className=\"text-sm text-blue-700 mt-1\">\n                        To enable automated emails, set the <code className=\"bg-blue-100 px-1 rounded\">RESEND_API_KEY</code>\n                        environment variable in your Supabase Edge Functions.\n                        <a href=\"https://resend.com\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"underline ml-1\">\n                            Get a free API key at Resend â\n                        </a>\n                    </p>\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/CreateReviewModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/CrossAppNavigation.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/DBSCheckForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Upload' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { complianceService, DBSCheck } from '@/lib/services/ComplianceService';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { X, Upload, Save, AlertCircle } from 'lucide-react';\nimport { log } from '@/lib/logger';\n\ninterface DBSCheckFormProps {\n    userId?: string;\n    applicantName?: string;\n    onSuccess: () => void;\n    onCancel: () => void;\n}\n\nexport default function DBSCheckForm({ userId, applicantName, onSuccess, onCancel }: DBSCheckFormProps) {\n    const { currentTenant } = useTenant();\n    const { user } = useAuth();\n    const [isSubmitting, setIsSubmitting] = useState(false);\n    const [error, setError] = useState<string | null>(null);\n\n    const { register, handleSubmit, watch, setValue, formState: { errors } } = useForm<Partial<DBSCheck>>({\n        defaultValues: {\n            applicant_name: applicantName || '',\n            check_type: 'enhanced_barred',\n            check_level: 'adult',\n            status: 'pending',\n            renewal_period_months: 36,\n            update_service_subscribed: false\n        }\n    });\n\n    const issueDate = watch('issue_date');\n\n    // Auto-calculate expiry date when issue date changes\n    React.useEffect(() => {\n        if (issueDate) {\n            const date = new Date(issueDate);\n            date.setFullYear(date.getFullYear() + 3); // Default 3 years\n            setValue('expiry_date', date.toISOString().split('T')[0]);\n        }\n    }, [issueDate, setValue]);\n\n    const onSubmit = async (data: Partial<DBSCheck>) => {\n        if (!currentTenant) return;\n\n        setIsSubmitting(true);\n        setError(null);\n\n        try {\n            const dbsData = {\n                ...data,\n                tenant_id: currentTenant.id,\n                user_id: userId || null,\n                verified_by: user?.id,\n                verified_at: new Date().toISOString()\n            };\n\n            const result = await complianceService.addDBSCheck(dbsData);\n\n            if (result) {\n                onSuccess();\n            } else {\n                setError('Failed to save DBS check. Please try again.');\n            }\n        } catch (err) {\n            log.error('Error saving DBS check', err, { component: 'DBSCheckForm', action: 'handleSubmit' });\n            setError('An unexpected error occurred.');\n        } finally {\n            setIsSubmitting(false);\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n            <div className=\"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n                <div className=\"p-6 border-b border-gray-200 flex justify-between items-center\">\n                    <h2 className=\"text-xl font-semibold text-gray-900\">Add DBS Check Record</h2>\n                    <button onClick={onCancel} className=\"text-gray-400 hover:text-gray-600\">\n                        <X className=\"w-6 h-6\" />\n                    </button>\n                </div>\n\n                <form onSubmit={handleSubmit(onSubmit)} className=\"p-6 space-y-6\">\n                    {error && (\n                        <div className=\"bg-red-50 border border-red-200 text-red-700 p-4 rounded-lg flex items-center gap-2\">\n                            <AlertCircle className=\"w-5 h-5\" />\n                            {error}\n                        </div>\n                    )}\n\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                        {/* Applicant Details */}\n                        <div className=\"col-span-2\">\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                Applicant Name *\n                            </label>\n                            <input\n                                {...register('applicant_name', { required: 'Applicant name is required' })}\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500\"\n                                placeholder=\"Full Name\"\n                            />\n                            {errors.applicant_name && (\n                                <p className=\"text-red-500 text-xs mt-1\">{errors.applicant_name.message}</p>\n                            )}\n                        </div>\n\n                        {/* Check Details */}\n                        <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                Check Type *\n                            </label>\n                            <select\n                                {...register('check_type')}\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500\"\n                            >\n                                <option value=\"enhanced_barred\">Enhanced with Barred List</option>\n                                <option value=\"enhanced\">Enhanced</option>\n                                <option value=\"standard\">Standard</option>\n                                <option value=\"basic\">Basic</option>\n                            </select>\n                        </div>\n\n                        <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                Check Level\n                            </label>\n                            <select\n                                {...register('check_level')}\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500\"\n                            >\n                                <option value=\"adult\">Adult Workforce</option>\n                                <option value=\"child\">Child Workforce</option>\n                                <option value=\"both\">Both</option>\n                            </select>\n                        </div>\n\n                        <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                Certificate Number\n                            </label>\n                            <input\n                                {...register('certificate_number')}\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500\"\n                                placeholder=\"001234567890\"\n                            />\n                        </div>\n\n                        <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                Status\n                            </label>\n                            <select\n                                {...register('status')}\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500\"\n                            >\n                                <option value=\"pending\">Pending</option>\n                                <option value=\"clear\">Clear</option>\n                                <option value=\"disclosed\">Disclosed (See Notes)</option>\n                                <option value=\"renewal_due\">Renewal Due</option>\n                            </select>\n                        </div>\n\n                        {/* Dates */}\n                        <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                Issue Date *\n                            </label>\n                            <input\n                                type=\"date\"\n                                {...register('issue_date', { required: 'Issue date is required' })}\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500\"\n                            />\n                            {errors.issue_date && (\n                                <p className=\"text-red-500 text-xs mt-1\">{errors.issue_date.message}</p>\n                            )}\n                        </div>\n\n                        <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                Expiry Date (Auto-calculated)\n                            </label>\n                            <input\n                                type=\"date\"\n                                {...register('expiry_date')}\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50\"\n                                readOnly\n                            />\n                        </div>\n\n                        {/* Update Service */}\n                        <div className=\"col-span-2\">\n                            <label className=\"flex items-center gap-2 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer\">\n                                <input\n                                    type=\"checkbox\"\n                                    {...register('update_service_subscribed')}\n                                    className=\"w-4 h-4 text-cyan-600 rounded focus:ring-cyan-500\"\n                                />\n                                <span className=\"text-sm font-medium text-gray-700\">\n                                    Subscribed to DBS Update Service\n                                </span>\n                            </label>\n                            <p className=\"text-xs text-gray-500 mt-1 ml-1\">\n                                Allows instant online status checks without new certificates\n                            </p>\n                        </div>\n\n                        {/* File Upload */}\n                        <div className=\"col-span-2\">\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                Upload Certificate Scan\n                            </label>\n                            <input\n                                type=\"file\"\n                                accept=\".pdf,.jpg,.jpeg,.png\"\n                                className=\"block w-full text-sm text-gray-500\n                                    file:mr-4 file:py-2 file:px-4\n                                    file:rounded-full file:border-0\n                                    file:text-sm file:font-semibold\n                                    file:bg-cyan-50 file:text-cyan-700\n                                    hover:file:bg-cyan-100\"\n                            />\n                            <p className=\"text-xs text-gray-500 mt-1\">PDF, JPG, PNG up to 5MB</p>\n                        </div>\n\n                        {/* Notes */}\n                        <div className=\"col-span-2\">\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                Notes / Disclosures\n                            </label>\n                            <textarea\n                                {...register('notes')}\n                                rows={3}\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500\"\n                                placeholder=\"Any additional details...\"\n                            />\n                        </div>\n                    </div>\n\n                    <div className=\"flex justify-end gap-3 pt-4 border-t border-gray-200\">\n                        <button\n                            type=\"button\"\n                            onClick={onCancel}\n                            className=\"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg\"\n                        >\n                            Cancel\n                        </button>\n                        <button\n                            type=\"submit\"\n                            disabled={isSubmitting}\n                            className=\"flex items-center gap-2 px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 disabled:opacity-50\"\n                        >\n                            <Save className=\"w-4 h-4\" />\n                            {isSubmitting ? 'Saving...' : 'Save Record'}\n                        </button>\n                    </div>\n                </form>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/DashboardAnalytics.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadAnalytics'. Either include it or remove the dependency array.","line":48,"column":8,"nodeType":"ArrayExpression","endLine":48,"endColumn":34,"suggestions":[{"desc":"Update the dependencies array to be: [currentTenant, loadAnalytics, timeRange]","fix":{"range":[1528,1554],"text":"[currentTenant, loadAnalytics, timeRange]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used. Allowed unused caught errors must match /^_/u.","line":103,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":103,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { TrendingUp, TrendingDown, Users, Briefcase, Clock, Target, BarChart3, PieChart } from 'lucide-react';\nimport { formatNumber, formatPercentage /* formatCurrency */ } from '@/lib/utils';\n\ninterface AnalyticsData {\n    hiring: {\n        applicationsThisMonth: number;\n        applicationsLastMonth: number;\n        hiredThisMonth: number;\n        hiredLastMonth: number;\n        timeToHireAvg: number;\n        conversionRate: number;\n    };\n    workforce: {\n        totalEmployees: number;\n        newHires: number;\n        leavers: number;\n        turnoverRate: number;\n        departments: { name: string; count: number; color: string }[];\n    };\n    compliance: {\n        score: number;\n        expiringSoon: number;\n        overdueTraining: number;\n        pendingDBS: number;\n    };\n    performance: {\n        avgRating: number;\n        goalsCompleted: number;\n        goalsAtRisk: number;\n        reviewsPending: number;\n    };\n}\n\nexport default function DashboardAnalytics() {\n    const { currentTenant } = useTenant();\n    const [data, setData] = useState<AnalyticsData | null>(null);\n    const [loading, setLoading] = useState(true);\n    const [timeRange, setTimeRange] = useState<'week' | 'month' | 'quarter' | 'year'>('month');\n\n    useEffect(() => {\n        if (currentTenant) {\n            loadAnalytics();\n        }\n    }, [currentTenant, timeRange]);\n\n    async function loadAnalytics() {\n        setLoading(true);\n\n        try {\n            // In production, these would be real database queries\n            // For now, generate realistic analytics data\n            const analyticsData: AnalyticsData = {\n                hiring: {\n                    applicationsThisMonth: 87,\n                    applicationsLastMonth: 72,\n                    hiredThisMonth: 8,\n                    hiredLastMonth: 5,\n                    timeToHireAvg: 28,\n                    conversionRate: 9.2,\n                },\n                workforce: {\n                    totalEmployees: 156,\n                    newHires: 12,\n                    leavers: 4,\n                    turnoverRate: 2.6,\n                    departments: [\n                        { name: 'Engineering', count: 45, color: '#3B82F6' },\n                        { name: 'Sales', count: 32, color: '#10B981' },\n                        { name: 'Operations', count: 28, color: '#F59E0B' },\n                        { name: 'Marketing', count: 22, color: '#8B5CF6' },\n                        { name: 'HR', count: 15, color: '#EC4899' },\n                        { name: 'Finance', count: 14, color: '#6366F1' },\n                    ],\n                },\n                compliance: {\n                    score: 94,\n                    expiringSoon: 12,\n                    overdueTraining: 3,\n                    pendingDBS: 5,\n                },\n                performance: {\n                    avgRating: 4.2,\n                    goalsCompleted: 68,\n                    goalsAtRisk: 8,\n                    reviewsPending: 15,\n                },\n            };\n\n            // Try to fetch real data\n            try {\n                const { count: totalEmployees } = await supabase\n                    .from('employees')\n                    .select('*', { count: 'exact', head: true })\n                    .eq('tenant_id', currentTenant?.id);\n\n                if (totalEmployees) {\n                    analyticsData.workforce.totalEmployees = totalEmployees;\n                }\n            } catch (e) {\n                // Use mock data\n            }\n\n            setData(analyticsData);\n        } catch (error) {\n            log.error('Error loading analytics', error, { component: 'DashboardAnalytics', action: 'loadAnalytics', metadata: { tenantId: currentTenant?.id, timeRange } });\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    function getChangeIndicator(current: number, previous: number) {\n        const change = previous ? ((current - previous) / previous) * 100 : 0;\n        const isPositive = change >= 0;\n        return {\n            value: Math.abs(change).toFixed(1),\n            isPositive,\n            icon: isPositive ? <TrendingUp className=\"w-4 h-4\" /> : <TrendingDown className=\"w-4 h-4\" />,\n            color: isPositive ? 'text-green-600' : 'text-red-600',\n        };\n    }\n\n    // Simple bar chart using CSS\n    function BarChart({ data, maxValue, label, color }: { data: number; maxValue: number; label: string; color: string }) {\n        const percentage = (data / maxValue) * 100;\n        return (\n            <div className=\"flex items-center space-x-3\">\n                <span className=\"text-xs text-gray-600 w-20 truncate\">{label}</span>\n                <div className=\"flex-1 h-4 bg-gray-100 rounded-full overflow-hidden\">\n                    <div\n                        className=\"h-full rounded-full transition-all duration-500\"\n                        style={{ width: `${percentage}%`, backgroundColor: color }}\n                    />\n                </div>\n                <span className=\"text-xs font-medium text-gray-700 w-8\">{data}</span>\n            </div>\n        );\n    }\n\n    // Simple donut chart using CSS\n    function DonutChart({ value, label, color }: { value: number; label: string; color: string }) {\n        const circumference = 2 * Math.PI * 40;\n        const strokeDashoffset = circumference - (value / 100) * circumference;\n\n        return (\n            <div className=\"relative flex flex-col items-center\">\n                <svg className=\"w-24 h-24 transform -rotate-90\">\n                    <circle cx=\"48\" cy=\"48\" r=\"40\" fill=\"none\" stroke=\"#E5E7EB\" strokeWidth=\"8\" />\n                    <circle\n                        cx=\"48\"\n                        cy=\"48\"\n                        r=\"40\"\n                        fill=\"none\"\n                        stroke={color}\n                        strokeWidth=\"8\"\n                        strokeLinecap=\"round\"\n                        strokeDasharray={circumference}\n                        strokeDashoffset={strokeDashoffset}\n                        className=\"transition-all duration-1000\"\n                    />\n                </svg>\n                <div className=\"absolute inset-0 flex items-center justify-center\">\n                    <span className=\"text-xl font-bold text-gray-900\">{value}%</span>\n                </div>\n                <span className=\"mt-2 text-xs text-gray-600\">{label}</span>\n            </div>\n        );\n    }\n\n    if (loading) {\n        return (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n                {[1, 2, 3, 4].map(i => (\n                    <div key={i} className=\"bg-white rounded-xl border border-gray-200 p-6 animate-pulse\">\n                        <div className=\"h-4 bg-gray-200 rounded w-1/2 mb-4\" />\n                        <div className=\"h-8 bg-gray-200 rounded w-3/4\" />\n                    </div>\n                ))}\n            </div>\n        );\n    }\n\n    if (!data) return null;\n\n    const applicationChange = getChangeIndicator(data.hiring.applicationsThisMonth, data.hiring.applicationsLastMonth);\n    const hiredChange = getChangeIndicator(data.hiring.hiredThisMonth, data.hiring.hiredLastMonth);\n\n    return (\n        <div className=\"space-y-6\">\n            {/* Time Range Selector */}\n            <div className=\"flex items-center justify-between\">\n                <h2 className=\"text-lg font-semibold text-gray-900\">Analytics Overview</h2>\n                <div className=\"flex items-center space-x-1 bg-gray-100 rounded-lg p-1\">\n                    {(['week', 'month', 'quarter', 'year'] as const).map(range => (\n                        <button\n                            key={range}\n                            onClick={() => setTimeRange(range)}\n                            className={`px-3 py-1 text-sm rounded-md transition ${timeRange === range\n                                ? 'bg-white text-indigo-600 shadow-sm font-medium'\n                                : 'text-gray-600 hover:text-gray-900'\n                                }`}\n                        >\n                            {range.charAt(0).toUpperCase() + range.slice(1)}\n                        </button>\n                    ))}\n                </div>\n            </div>\n\n            {/* Hiring Metrics */}\n            <div className=\"bg-white rounded-xl border border-gray-200 p-6\">\n                <div className=\"flex items-center justify-between mb-6\">\n                    <h3 className=\"font-semibold text-gray-900 flex items-center\">\n                        <Briefcase className=\"w-5 h-5 mr-2 text-indigo-600\" />\n                        Hiring Pipeline\n                    </h3>\n                    <span className=\"text-xs text-gray-500\">vs last period</span>\n                </div>\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-6\">\n                    <div>\n                        <p className=\"text-sm text-gray-600\">Applications</p>\n                        <p className=\"text-2xl font-bold text-gray-900\">{formatNumber(data.hiring.applicationsThisMonth)}</p>\n                        <div className={`flex items-center text-sm ${applicationChange.color}`}>\n                            {applicationChange.icon}\n                            <span className=\"ml-1\">{applicationChange.value}%</span>\n                        </div>\n                    </div>\n                    <div>\n                        <p className=\"text-sm text-gray-600\">Hired</p>\n                        <p className=\"text-2xl font-bold text-gray-900\">{data.hiring.hiredThisMonth}</p>\n                        <div className={`flex items-center text-sm ${hiredChange.color}`}>\n                            {hiredChange.icon}\n                            <span className=\"ml-1\">{hiredChange.value}%</span>\n                        </div>\n                    </div>\n                    <div>\n                        <p className=\"text-sm text-gray-600\">Avg Time to Hire</p>\n                        <p className=\"text-2xl font-bold text-gray-900\">{data.hiring.timeToHireAvg}</p>\n                        <p className=\"text-xs text-gray-500\">days</p>\n                    </div>\n                    <div>\n                        <p className=\"text-sm text-gray-600\">Conversion Rate</p>\n                        <p className=\"text-2xl font-bold text-gray-900\">{formatPercentage(data.hiring.conversionRate, 1)}</p>\n                        <p className=\"text-xs text-gray-500\">application to hire</p>\n                    </div>\n                </div>\n            </div>\n\n            {/* Workforce & Departments */}\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                {/* Department Distribution */}\n                <div className=\"bg-white rounded-xl border border-gray-200 p-6\">\n                    <h3 className=\"font-semibold text-gray-900 flex items-center mb-6\">\n                        <BarChart3 className=\"w-5 h-5 mr-2 text-indigo-600\" />\n                        Department Distribution\n                    </h3>\n                    <div className=\"space-y-3\">\n                        {data.workforce.departments.map((dept, index) => (\n                            <BarChart\n                                key={index}\n                                data={dept.count}\n                                maxValue={Math.max(...data.workforce.departments.map(d => d.count))}\n                                label={dept.name}\n                                color={dept.color}\n                            />\n                        ))}\n                    </div>\n                    <div className=\"mt-4 pt-4 border-t border-gray-100\">\n                        <div className=\"flex items-center justify-between text-sm\">\n                            <span className=\"text-gray-600\">Total Employees</span>\n                            <span className=\"font-bold text-gray-900\">{formatNumber(data.workforce.totalEmployees)}</span>\n                        </div>\n                    </div>\n                </div>\n\n                {/* Key Metrics */}\n                <div className=\"bg-white rounded-xl border border-gray-200 p-6\">\n                    <h3 className=\"font-semibold text-gray-900 flex items-center mb-6\">\n                        <PieChart className=\"w-5 h-5 mr-2 text-indigo-600\" />\n                        Key Metrics\n                    </h3>\n                    <div className=\"flex items-center justify-around\">\n                        <DonutChart value={data.compliance.score} label=\"Compliance Score\" color=\"#10B981\" />\n                        <DonutChart value={data.hiring.conversionRate * 10} label=\"Hiring Efficiency\" color=\"#3B82F6\" />\n                        <DonutChart value={Math.round((data.performance.avgRating / 5) * 100)} label=\"Avg Rating\" color=\"#8B5CF6\" />\n                    </div>\n                </div>\n            </div>\n\n            {/* Workforce Stats */}\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                <div className=\"bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white\">\n                    <Users className=\"w-6 h-6 mb-2 opacity-80\" />\n                    <p className=\"text-2xl font-bold\">{data.workforce.newHires}</p>\n                    <p className=\"text-sm opacity-80\">New Hires</p>\n                </div>\n                <div className=\"bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-4 text-white\">\n                    <Clock className=\"w-6 h-6 mb-2 opacity-80\" />\n                    <p className=\"text-2xl font-bold\">{data.compliance.expiringSoon}</p>\n                    <p className=\"text-sm opacity-80\">Expiring Soon</p>\n                </div>\n                <div className=\"bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white\">\n                    <Target className=\"w-6 h-6 mb-2 opacity-80\" />\n                    <p className=\"text-2xl font-bold\">{formatPercentage(data.performance.goalsCompleted, 0)}</p>\n                    <p className=\"text-sm opacity-80\">Goals Complete</p>\n                </div>\n                <div className=\"bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-4 text-white\">\n                    <TrendingUp className=\"w-6 h-6 mb-2 opacity-80\" />\n                    <p className=\"text-2xl font-bold\">{formatPercentage(data.workforce.turnoverRate, 1)}</p>\n                    <p className=\"text-sm opacity-80\">Turnover Rate</p>\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/DigitalSkillsTracker.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Star' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":50},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSkills'. Either include it or remove the dependency array.","line":48,"column":8,"nodeType":"ArrayExpression","endLine":48,"endColumn":29,"suggestions":[{"desc":"Update the dependencies array to be: [currentTenant, fetchSkills, user]","fix":{"range":[1631,1652],"text":"[currentTenant, fetchSkills, user]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { useTenant } from '@/contexts/TenantContext';\nimport {\n    Monitor, Smartphone, Award, Plus, Check, Star,\n    TrendingUp, Loader2, Sparkles, BookOpen\n} from 'lucide-react';\n\ninterface DigitalSkill {\n    id: string;\n    skill_name: string;\n    proficiency_level: 'Beginner' | 'Intermediate' | 'Advanced' | 'Digital Champion';\n    verified_at: string | null;\n}\n\nconst LEVEL_COLORS = {\n    'Beginner': 'bg-slate-100 text-slate-700 border-slate-200',\n    'Intermediate': 'bg-blue-50 text-blue-700 border-blue-200',\n    'Advanced': 'bg-purple-50 text-purple-700 border-purple-200',\n    'Digital Champion': 'bg-amber-50 text-amber-700 border-amber-200',\n};\n\nconst SUGGESTED_SKILLS = [\n    'CareFlow Usage',\n    'Email & Communication',\n    'Basic IT Security',\n    'Tablet/Mobile Devices',\n    'Spreadsheets',\n    'Assistive Tech'\n];\n\nexport default function DigitalSkillsTracker() {\n    const { user, profile } = useAuth();\n    const { currentTenant } = useTenant();\n    const [skills, setSkills] = useState<DigitalSkill[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [isAdding, setIsAdding] = useState(false);\n    const [newSkillName, setNewSkillName] = useState('');\n    const [newSkillLevel, setNewSkillLevel] = useState<string>('Beginner');\n    const [actionLoading, setActionLoading] = useState<string | null>(null);\n\n    useEffect(() => {\n        if (currentTenant && user) {\n            fetchSkills();\n        }\n    }, [currentTenant, user]);\n\n    const fetchSkills = async () => {\n        if (!currentTenant || !profile) return;\n\n        try {\n            const { data: employee } = await supabase\n                .from('employees')\n                .select('id')\n                .eq('email', user?.email)\n                .eq('tenant_id', currentTenant.id)\n                .single();\n\n            if (employee) {\n                const { data, error } = await supabase\n                    .from('employee_digital_skills')\n                    .select('*')\n                    .eq('employee_id', employee.id)\n                    .order('created_at', { ascending: true });\n\n                if (error) throw error;\n                setSkills(data || []);\n            }\n        } catch (error) {\n            log.error('Error fetching skills', error, { component: 'DigitalSkillsTracker', action: 'fetchSkills' });\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleAddSkill = async (e: React.FormEvent) => {\n        e.preventDefault();\n        if (!currentTenant || !user) return;\n\n        try {\n            const { data: employee } = await supabase\n                .from('employees')\n                .select('id')\n                .eq('email', user.email)\n                .eq('tenant_id', currentTenant.id)\n                .single();\n\n            if (!employee) {\n                alert('Employee record not found for your account.');\n                return;\n            }\n\n            const { data, error } = await supabase\n                .from('employee_digital_skills')\n                .insert({\n                    tenant_id: currentTenant.id,\n                    employee_id: employee.id,\n                    skill_name: newSkillName,\n                    proficiency_level: newSkillLevel\n                })\n                .select()\n                .single();\n\n            if (error) throw error;\n\n            setSkills([...skills, data]);\n            setIsAdding(false);\n            setNewSkillName('');\n            setNewSkillLevel('Beginner');\n        } catch (error) {\n            log.error('Error adding skill', error, { component: 'DigitalSkillsTracker', action: 'handleAddSkill' });\n        }\n    };\n\n    const handleUpdateLevel = async (skillId: string, newLevel: DigitalSkill['proficiency_level']) => {\n        setActionLoading(skillId);\n        try {\n            const { error } = await supabase\n                .from('employee_digital_skills')\n                .update({ proficiency_level: newLevel })\n                .eq('id', skillId);\n\n            if (error) throw error;\n\n            setSkills(prev => prev.map(s => s.id === skillId ? { ...s, proficiency_level: newLevel } : s));\n        } catch (error) {\n            log.error('Error updating skill level', error, { component: 'DigitalSkillsTracker', action: 'handleUpdateLevel' });\n        } finally {\n            setActionLoading(null);\n        }\n    };\n\n    const handleDeleteSkill = async (skillId: string) => {\n        if (!confirm('Are you sure you want to remove this skill from your profile?')) return;\n\n        setActionLoading(skillId);\n        try {\n            const { error } = await supabase\n                .from('employee_digital_skills')\n                .delete()\n                .eq('id', skillId);\n\n            if (error) throw error;\n\n            setSkills(prev => prev.filter(s => s.id !== skillId));\n        } catch (error) {\n            log.error('Error deleting skill', error, { component: 'DigitalSkillsTracker', action: 'handleDeleteSkill' });\n        } finally {\n            setActionLoading(null);\n        }\n    };\n\n    const getIcon = (name: string) => {\n        const lower = name.toLowerCase();\n        if (lower.includes('mobile') || lower.includes('tablet') || lower.includes('app')) return <Smartphone className=\"w-5 h-5 text-purple-600\" />;\n        if (lower.includes('security')) return <Award className=\"w-5 h-5 text-red-600\" />;\n        if (lower.includes('careflow')) return <Sparkles className=\"w-5 h-5 text-cyan-600\" />;\n        return <Monitor className=\"w-5 h-5 text-blue-600\" />;\n    };\n\n    return (\n        <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden\">\n            <div className=\"p-6 border-b border-slate-100 flex items-center justify-between bg-slate-50/50\">\n                <div>\n                    <h2 className=\"text-lg font-semibold text-slate-900 flex items-center gap-2\">\n                        <TrendingUp className=\"w-5 h-5 text-cyan-600\" />\n                        Digital Skills & Maturity\n                    </h2>\n                    <p className=\"text-sm text-slate-500 mt-1\">Track your journey to becoming a Digital Champion</p>\n                </div>\n                <button\n                    onClick={() => setIsAdding(true)}\n                    disabled={isAdding}\n                    className=\"flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-all text-sm font-medium shadow-sm disabled:opacity-50\"\n                >\n                    <Plus className=\"w-4 h-4\" />\n                    Add Skill\n                </button>\n            </div>\n\n            <div className=\"p-6\">\n                {isAdding && (\n                    <form onSubmit={handleAddSkill} className=\"mb-8 bg-slate-50 p-6 rounded-xl border border-slate-200 animate-in fade-in slide-in-from-top-4 shadow-inner\">\n                        <div className=\"flex justify-between items-center mb-4\">\n                            <h3 className=\"text-sm font-bold text-slate-900 uppercase tracking-wider\">Add New Skill</h3>\n                            <button type=\"button\" onClick={() => setIsAdding(false)} className=\"text-slate-400 hover:text-slate-600 transition-colors\">\n                                <Plus className=\"w-4 h-4 transform rotate-45\" />\n                            </button>\n                        </div>\n                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                            <div>\n                                <label className=\"block text-xs font-semibold text-slate-500 mb-1 uppercase tracking-tight\">Skill Name</label>\n                                <input\n                                    type=\"text\"\n                                    required\n                                    value={newSkillName}\n                                    onChange={(e) => setNewSkillName(e.target.value)}\n                                    placeholder=\"e.g. CareFlow Advanced\"\n                                    className=\"w-full px-3 py-2 text-sm border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition\"\n                                    list=\"suggested-skills\"\n                                />\n                                <datalist id=\"suggested-skills\">\n                                    {SUGGESTED_SKILLS.map(s => <option key={s} value={s} />)}\n                                </datalist>\n                            </div>\n                            <div>\n                                <label className=\"block text-xs font-semibold text-slate-500 mb-1 uppercase tracking-tight\">Current Level</label>\n                                <select\n                                    value={newSkillLevel}\n                                    onChange={(e) => setNewSkillLevel(e.target.value)}\n                                    className=\"w-full px-3 py-2 text-sm border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition bg-white\"\n                                >\n                                    <option value=\"Beginner\">Beginner</option>\n                                    <option value=\"Intermediate\">Intermediate</option>\n                                    <option value=\"Advanced\">Advanced</option>\n                                    <option value=\"Digital Champion\">Digital Champion</option>\n                                </select>\n                            </div>\n                            <div className=\"flex items-end gap-2\">\n                                <button\n                                    type=\"submit\"\n                                    className=\"flex-1 px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-lg hover:bg-indigo-700 transition-colors shadow-sm\"\n                                >\n                                    Save Skill\n                                </button>\n                                <button\n                                    type=\"button\"\n                                    onClick={() => setIsAdding(false)}\n                                    className=\"px-4 py-2 bg-white border border-slate-300 text-slate-700 text-sm font-medium rounded-lg hover:bg-slate-50 transition-colors\"\n                                >\n                                    Cancel\n                                </button>\n                            </div>\n                        </div>\n                    </form>\n                )}\n\n                {loading ? (\n                    <div className=\"flex justify-center py-12\">\n                        <Loader2 className=\"w-10 h-10 text-indigo-600 animate-spin\" />\n                    </div>\n                ) : skills.length === 0 ? (\n                    <div className=\"text-center py-16 bg-slate-50 rounded-xl border border-dashed border-slate-200\">\n                        <div className=\"bg-white w-14 h-14 rounded-full shadow-sm flex items-center justify-center mx-auto mb-4\">\n                            <BookOpen className=\"w-7 h-7 text-slate-300\" />\n                        </div>\n                        <h3 className=\"text-slate-900 font-semibold text-lg\">No skills recorded yet</h3>\n                        <p className=\"text-slate-500 text-sm mt-1 max-w-sm mx-auto\">Start tracking your digital capabilities to identify training needs and become a Digital Champion.</p>\n                        <button\n                            onClick={() => setIsAdding(true)}\n                            className=\"mt-6 px-4 py-2 bg-white text-indigo-600 border border-indigo-200 rounded-lg hover:bg-indigo-50 transition-colors font-medium text-sm\"\n                        >\n                            Get Started\n                        </button>\n                    </div>\n                ) : (\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                        {skills.map(skill => (\n                            <div key={skill.id} className=\"group relative bg-white p-5 rounded-xl border border-slate-200 hover:border-indigo-200 hover:shadow-xl hover:-translate-y-1 transition-all duration-300\">\n                                {actionLoading === skill.id && (\n                                    <div className=\"absolute inset-0 bg-white/60 backdrop-blur-[1px] z-10 flex items-center justify-center rounded-xl\">\n                                        <Loader2 className=\"w-6 h-6 text-indigo-600 animate-spin\" />\n                                    </div>\n                                )}\n\n                                <div className=\"flex justify-between items-start mb-4\">\n                                    <div className=\"p-2.5 bg-slate-50 rounded-xl group-hover:bg-indigo-50 transition-colors\">\n                                        {getIcon(skill.skill_name)}\n                                    </div>\n                                    <div className=\"flex flex-col items-end gap-2\">\n                                        <select\n                                            value={skill.proficiency_level}\n                                            onChange={(e) => handleUpdateLevel(skill.id, e.target.value as any)}\n                                            className={`text-[10px] font-bold uppercase rounded-full px-2 py-0.5 border cursor-pointer outline-none transition ${LEVEL_COLORS[skill.proficiency_level] || LEVEL_COLORS['Beginner']}`}\n                                        >\n                                            <option value=\"Beginner\">Beginner</option>\n                                            <option value=\"Intermediate\">Intermediate</option>\n                                            <option value=\"Advanced\">Advanced</option>\n                                            <option value=\"Digital Champion\">Digital Champion</option>\n                                        </select>\n                                        <button\n                                            onClick={() => handleDeleteSkill(skill.id)}\n                                            className=\"text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all p-1\"\n                                            title=\"Remove Skill\"\n                                        >\n                                            <Plus className=\"w-4 h-4 transform rotate-45\" />\n                                        </button>\n                                    </div>\n                                </div>\n\n                                <h3 className=\"font-bold text-slate-900 text-lg mb-1\">{skill.skill_name}</h3>\n\n                                <div className=\"mt-6 flex items-center justify-between\">\n                                    <div className=\"flex items-center gap-1.5\">\n                                        {[0, 1, 2, 3].map((idx) => {\n                                            const levels = ['Beginner', 'Intermediate', 'Advanced', 'Digital Champion'];\n                                            const currentLevelIdx = levels.indexOf(skill.proficiency_level);\n                                            return (\n                                                <div\n                                                    key={idx}\n                                                    className={`w-3 h-3 rounded-full transition-colors ${idx <= currentLevelIdx ? 'bg-amber-400' : 'bg-slate-200'}`}\n                                                />\n                                            );\n                                        })}\n                                        <span className=\"ml-2 text-[10px] font-bold text-slate-400 uppercase tracking-tighter\">\n                                            {skill.proficiency_level}\n                                        </span>\n                                    </div>\n\n                                    {skill.verified_at ? (\n                                        <div className=\"flex items-center gap-1 text-[10px] text-green-600 font-bold uppercase\" title=\"Verified by HR\">\n                                            <Check className=\"w-3 h-3\" />\n                                            Verified\n                                        </div>\n                                    ) : (\n                                        <div className=\"text-[10px] text-slate-400 font-bold uppercase italic\">\n                                            Self-Assessed\n                                        </div>\n                                    )}\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/DocumentGenerationModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DocumentTemplate' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":42}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport Modal from './Modal';\nimport { log } from '../lib/logger';\nimport { documentEngine, DocumentTemplate } from '../lib/documentEngine';\nimport { FileText, Download, Eye, Printer } from 'lucide-react';\n\ninterface DocumentGenerationModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  employeeData?: any;\n  jobData?: any;\n  candidateData?: any;\n  type: 'employee_packet' | 'offer_letter' | 'custom';\n}\n\nexport default function DocumentGenerationModal({\n  isOpen,\n  onClose,\n  employeeData,\n  jobData,\n  candidateData,\n  type\n}: DocumentGenerationModalProps) {\n  const [selectedTemplate, setSelectedTemplate] = useState<string>('');\n  const [generatedDocument, setGeneratedDocument] = useState<string>('');\n  const [customData, setCustomData] = useState<Record<string, string>>({});\n  const [loading, setLoading] = useState(false);\n  const [previewMode, setPreviewMode] = useState<'edit' | 'preview'>('edit');\n\n  const templates = documentEngine.getAvailableTemplates();\n\n  const handleGenerateDocument = async () => {\n    setLoading(true);\n\n    try {\n      let document = '';\n\n      if (type === 'employee_packet' && employeeData) {\n        const packet = await documentEngine.generateEmployeePacket(employeeData, jobData);\n        document = Object.entries(packet).map(([name, content]) =>\n          `=== ${name.toUpperCase()} ===\\n\\n${content}\\n\\n`\n        ).join('\\n');\n      } else if (type === 'offer_letter' && candidateData && jobData) {\n        document = await documentEngine.generateOfferLetter(candidateData, jobData);\n      } else if (selectedTemplate) {\n        const data = {\n          employee: employeeData,\n          job: jobData,\n          custom: customData\n        };\n        document = documentEngine.generateDocument(selectedTemplate, data);\n      }\n\n      setGeneratedDocument(document);\n      setPreviewMode('preview');\n    } catch (error) {\n      log.error('Document generation failed', error, { component: 'DocumentGenerationModal', action: 'handleGenerateDocument', metadata: { type, selectedTemplate } });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDownload = () => {\n    const blob = new Blob([generatedDocument], { type: 'text/plain' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `document_${new Date().getTime()}.txt`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  };\n\n  const handlePrint = () => {\n    const printWindow = window.open('', '_blank');\n    if (printWindow) {\n      printWindow.document.write(`\n        <html>\n          <head>\n            <title>Generated Document</title>\n            <style>\n              body { font-family: Arial, sans-serif; padding: 20px; line-height: 1.6; }\n              pre { white-space: pre-wrap; }\n            </style>\n          </head>\n          <body>\n            <pre>${generatedDocument}</pre>\n          </body>\n        </html>\n      `);\n      printWindow.document.close();\n      printWindow.print();\n    }\n  };\n\n  const selectedTemplateObj = selectedTemplate ? documentEngine.getTemplateById(selectedTemplate) : null;\n\n  return (\n    <Modal\n      isOpen={isOpen}\n      onClose={onClose}\n      title=\"ð¤ Smart Document Generation\"\n    >\n      <div className=\"space-y-6\">\n        {type === 'custom' && (\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Select Document Template\n            </label>\n            <select\n              value={selectedTemplate}\n              onChange={(e) => setSelectedTemplate(e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n            >\n              <option value=\"\">Choose a template...</option>\n              {templates.map((template) => (\n                <option key={template.id} value={template.id}>\n                  {template.name}\n                </option>\n              ))}\n            </select>\n          </div>\n        )}\n\n        {selectedTemplateObj && (\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n            <h3 className=\"font-medium text-blue-900 mb-2\">Template Variables</h3>\n            <p className=\"text-sm text-blue-700 mb-3\">\n              Fill in custom values (leave blank to use defaults):\n            </p>\n            <div className=\"grid grid-cols-2 gap-3\">\n              {selectedTemplateObj.variables.map((variable) => (\n                <div key={variable}>\n                  <label className=\"block text-xs text-blue-700 mb-1\">\n                    {variable.replace(/_/g, ' ').toUpperCase()}\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={customData[variable] || ''}\n                    onChange={(e) => setCustomData({ ...customData, [variable]: e.target.value })}\n                    className=\"w-full px-2 py-1 text-sm border border-blue-300 rounded focus:ring-1 focus:ring-blue-500\"\n                    placeholder=\"Auto-filled if empty\"\n                  />\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {(type === 'employee_packet' || type === 'offer_letter' || selectedTemplate) && (\n          <div className=\"flex justify-center\">\n            <button\n              onClick={handleGenerateDocument}\n              disabled={loading}\n              className=\"px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50 flex items-center gap-2\"\n            >\n              <FileText className=\"w-5 h-5\" />\n              {loading ? 'Generating...' : 'ð Generate Document'}\n            </button>\n          </div>\n        )}\n\n        {generatedDocument && (\n          <div className=\"border-t pt-6\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h3 className=\"text-lg font-semibold text-gray-900\">Generated Document</h3>\n              <div className=\"flex gap-2\">\n                <button\n                  onClick={() => setPreviewMode(previewMode === 'edit' ? 'preview' : 'edit')}\n                  className=\"px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition flex items-center gap-1\"\n                >\n                  <Eye className=\"w-4 h-4\" />\n                  {previewMode === 'edit' ? 'Preview' : 'Edit'}\n                </button>\n                <button\n                  onClick={handleDownload}\n                  className=\"px-3 py-2 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 transition flex items-center gap-1\"\n                >\n                  <Download className=\"w-4 h-4\" />\n                  Download\n                </button>\n                <button\n                  onClick={handlePrint}\n                  className=\"px-3 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-1\"\n                >\n                  <Printer className=\"w-4 h-4\" />\n                  Print\n                </button>\n              </div>\n            </div>\n\n            {previewMode === 'edit' ? (\n              <textarea\n                value={generatedDocument}\n                onChange={(e) => setGeneratedDocument(e.target.value)}\n                className=\"w-full h-96 p-4 border border-gray-300 rounded-lg font-mono text-sm focus:ring-2 focus:ring-indigo-500\"\n                placeholder=\"Generated document will appear here...\"\n              />\n            ) : (\n              <div className=\"h-96 p-4 border border-gray-300 rounded-lg bg-white overflow-auto\">\n                <pre className=\"text-sm whitespace-pre-wrap\">{generatedDocument}</pre>\n              </div>\n            )}\n          </div>\n        )}\n\n        <div className=\"flex justify-end gap-3 pt-4 border-t\">\n          <button\n            onClick={onClose}\n            className=\"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition\"\n          >\n            Close\n          </button>\n        </div>\n      </div>\n    </Modal>\n  );\n}","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/DocumentPreview.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useTenant' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setTotalPages' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":32,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":37},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'documentUrl' and 'loadDocument'. Either include them or remove the dependency array.","line":39,"column":8,"nodeType":"ArrayExpression","endLine":39,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [documentId, documentUrl, loadDocument]","fix":{"range":[1274,1286],"text":"[documentId, documentUrl, loadDocument]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport { useTenant } from '@/contexts/TenantContext';\nimport {\n    FileText, Download, Printer, ChevronLeft, ChevronRight,\n    ZoomIn, ZoomOut, RotateCw, X, Maximize, Minimize,\n    Image as ImageIcon, File, FileSpreadsheet\n} from 'lucide-react';\n\ninterface DocumentPreviewProps {\n    documentId?: string;\n    documentUrl?: string;\n    fileName?: string;\n    fileType?: string;\n    onClose?: () => void;\n}\n\nexport default function DocumentPreview({\n    documentId,\n    documentUrl,\n    fileName = 'Document',\n    fileType = 'application/pdf',\n    onClose\n}: DocumentPreviewProps) {\n    const [url, setUrl] = useState<string | null>(documentUrl || null);\n    const [loading, setLoading] = useState(!documentUrl);\n    const [error, setError] = useState<string | null>(null);\n    const [zoom, setZoom] = useState(100);\n    const [rotation, setRotation] = useState(0);\n    const [currentPage, setCurrentPage] = useState(1);\n    const [totalPages, setTotalPages] = useState(1);\n    const [isFullscreen, setIsFullscreen] = useState(false);\n\n    useEffect(() => {\n        if (documentId && !documentUrl) {\n            loadDocument();\n        }\n    }, [documentId]);\n\n    async function loadDocument() {\n        setLoading(true);\n        try {\n            const { data, error } = await supabase\n                .from('documents')\n                .select('file_path, file_name, file_type')\n                .eq('id', documentId)\n                .single();\n\n            if (error) throw error;\n\n            if (data?.file_path) {\n                const { data: urlData } = supabase.storage\n                    .from('documents')\n                    .getPublicUrl(data.file_path);\n\n                setUrl(urlData.publicUrl);\n            }\n        } catch (err) {\n            log.error('Error loading document', err, { component: 'DocumentPreview', action: 'loadDocument', metadata: { documentId } });\n            setError('Failed to load document');\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    function handleZoomIn() {\n        setZoom(prev => Math.min(prev + 25, 200));\n    }\n\n    function handleZoomOut() {\n        setZoom(prev => Math.max(prev - 25, 50));\n    }\n\n    function handleRotate() {\n        setRotation(prev => (prev + 90) % 360);\n    }\n\n    function handleDownload() {\n        if (url) {\n            const link = document.createElement('a');\n            link.href = url;\n            link.download = fileName;\n            document.body.appendChild(link);\n            link.click();\n            document.body.removeChild(link);\n        }\n    }\n\n    function handlePrint() {\n        if (url) {\n            const printWindow = window.open(url, '_blank');\n            if (printWindow) {\n                printWindow.addEventListener('load', () => {\n                    printWindow.print();\n                });\n            }\n        }\n    }\n\n    function toggleFullscreen() {\n        setIsFullscreen(!isFullscreen);\n    }\n\n    function getFileIcon() {\n        if (fileType.includes('pdf')) {\n            return <FileText className=\"w-12 h-12 text-red-500\" />;\n        } else if (fileType.includes('image')) {\n            return <ImageIcon className=\"w-12 h-12 text-blue-500\" />;\n        } else if (fileType.includes('spreadsheet') || fileType.includes('excel')) {\n            return <FileSpreadsheet className=\"w-12 h-12 text-green-500\" />;\n        }\n        return <File className=\"w-12 h-12 text-gray-500\" />;\n    }\n\n    function renderPreview() {\n        if (!url) {\n            return (\n                <div className=\"flex flex-col items-center justify-center h-full text-gray-500\">\n                    {getFileIcon()}\n                    <p className=\"mt-4 text-lg font-medium\">{fileName}</p>\n                    <p className=\"text-sm\">Preview not available</p>\n                    <button\n                        onClick={handleDownload}\n                        className=\"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition\"\n                    >\n                        <Download className=\"w-4 h-4 inline mr-2\" />\n                        Download File\n                    </button>\n                </div>\n            );\n        }\n\n        const isPDF = fileType.includes('pdf');\n        const isImage = fileType.includes('image');\n\n        if (isPDF) {\n            return (\n                <iframe\n                    src={`${url}#toolbar=0&page=${currentPage}`}\n                    className=\"w-full h-full border-0\"\n                    style={{\n                        transform: `scale(${zoom / 100}) rotate(${rotation}deg)`,\n                        transformOrigin: 'center center'\n                    }}\n                    title={fileName}\n                />\n            );\n        }\n\n        if (isImage) {\n            return (\n                <div className=\"flex items-center justify-center h-full overflow-auto p-4\">\n                    <img\n                        src={url}\n                        alt={fileName}\n                        className=\"max-w-full max-h-full object-contain transition-transform duration-200\"\n                        style={{\n                            transform: `scale(${zoom / 100}) rotate(${rotation}deg)`,\n                        }}\n                    />\n                </div>\n            );\n        }\n\n        // Other file types - show download option\n        return (\n            <div className=\"flex flex-col items-center justify-center h-full text-gray-500\">\n                {getFileIcon()}\n                <p className=\"mt-4 text-lg font-medium\">{fileName}</p>\n                <p className=\"text-sm text-gray-400 mb-4\">{fileType}</p>\n                <button\n                    onClick={handleDownload}\n                    className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition\"\n                >\n                    <Download className=\"w-4 h-4 inline mr-2\" />\n                    Download File\n                </button>\n            </div>\n        );\n    }\n\n    if (loading) {\n        return (\n            <div className=\"fixed inset-0 bg-black/80 flex items-center justify-center z-50\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-white\" />\n            </div>\n        );\n    }\n\n    const containerClass = isFullscreen\n        ? \"fixed inset-0 z-50 bg-gray-900\"\n        : \"fixed inset-4 md:inset-8 z-50 bg-white rounded-2xl shadow-2xl overflow-hidden\";\n\n    return (\n        <div className=\"fixed inset-0 z-50\">\n            {/* Backdrop */}\n            <div\n                className=\"absolute inset-0 bg-black/70\"\n                onClick={onClose}\n            />\n\n            {/* Preview Container */}\n            <div className={containerClass}>\n                {/* Toolbar */}\n                <div className={`flex items-center justify-between px-4 py-3 ${isFullscreen ? 'bg-gray-800' : 'bg-gray-100'} border-b border-gray-200`}>\n                    <div className=\"flex items-center space-x-3\">\n                        {getFileIcon()}\n                        <div>\n                            <p className={`font-medium ${isFullscreen ? 'text-white' : 'text-gray-900'}`}>{fileName}</p>\n                            <p className={`text-xs ${isFullscreen ? 'text-gray-400' : 'text-gray-500'}`}>{fileType}</p>\n                        </div>\n                    </div>\n\n                    <div className=\"flex items-center space-x-1\">\n                        {/* Zoom controls */}\n                        <button\n                            onClick={handleZoomOut}\n                            className={`p-2 rounded-lg transition ${isFullscreen ? 'hover:bg-gray-700 text-gray-300' : 'hover:bg-gray-200 text-gray-600'}`}\n                            title=\"Zoom out\"\n                        >\n                            <ZoomOut className=\"w-5 h-5\" />\n                        </button>\n                        <span className={`px-2 text-sm ${isFullscreen ? 'text-gray-300' : 'text-gray-600'}`}>{zoom}%</span>\n                        <button\n                            onClick={handleZoomIn}\n                            className={`p-2 rounded-lg transition ${isFullscreen ? 'hover:bg-gray-700 text-gray-300' : 'hover:bg-gray-200 text-gray-600'}`}\n                            title=\"Zoom in\"\n                        >\n                            <ZoomIn className=\"w-5 h-5\" />\n                        </button>\n\n                        <div className={`w-px h-6 mx-2 ${isFullscreen ? 'bg-gray-600' : 'bg-gray-300'}`} />\n\n                        {/* Rotate */}\n                        <button\n                            onClick={handleRotate}\n                            className={`p-2 rounded-lg transition ${isFullscreen ? 'hover:bg-gray-700 text-gray-300' : 'hover:bg-gray-200 text-gray-600'}`}\n                            title=\"Rotate\"\n                        >\n                            <RotateCw className=\"w-5 h-5\" />\n                        </button>\n\n                        {/* Fullscreen */}\n                        <button\n                            onClick={toggleFullscreen}\n                            className={`p-2 rounded-lg transition ${isFullscreen ? 'hover:bg-gray-700 text-gray-300' : 'hover:bg-gray-200 text-gray-600'}`}\n                            title={isFullscreen ? 'Exit fullscreen' : 'Fullscreen'}\n                        >\n                            {isFullscreen ? <Minimize className=\"w-5 h-5\" /> : <Maximize className=\"w-5 h-5\" />}\n                        </button>\n\n                        <div className={`w-px h-6 mx-2 ${isFullscreen ? 'bg-gray-600' : 'bg-gray-300'}`} />\n\n                        {/* Download & Print */}\n                        <button\n                            onClick={handleDownload}\n                            className={`p-2 rounded-lg transition ${isFullscreen ? 'hover:bg-gray-700 text-gray-300' : 'hover:bg-gray-200 text-gray-600'}`}\n                            title=\"Download\"\n                        >\n                            <Download className=\"w-5 h-5\" />\n                        </button>\n                        <button\n                            onClick={handlePrint}\n                            className={`p-2 rounded-lg transition ${isFullscreen ? 'hover:bg-gray-700 text-gray-300' : 'hover:bg-gray-200 text-gray-600'}`}\n                            title=\"Print\"\n                        >\n                            <Printer className=\"w-5 h-5\" />\n                        </button>\n\n                        <div className={`w-px h-6 mx-2 ${isFullscreen ? 'bg-gray-600' : 'bg-gray-300'}`} />\n\n                        {/* Close */}\n                        <button\n                            onClick={onClose}\n                            className={`p-2 rounded-lg transition ${isFullscreen ? 'hover:bg-gray-700 text-gray-300' : 'hover:bg-gray-200 text-gray-600'}`}\n                            title=\"Close\"\n                        >\n                            <X className=\"w-5 h-5\" />\n                        </button>\n                    </div>\n                </div>\n\n                {/* Preview Area */}\n                <div className={`flex-1 overflow-hidden ${isFullscreen ? 'bg-gray-900' : 'bg-gray-100'}`} style={{ height: 'calc(100% - 56px)' }}>\n                    {error ? (\n                        <div className=\"flex flex-col items-center justify-center h-full text-gray-500\">\n                            <FileText className=\"w-16 h-16 mb-4\" />\n                            <p className=\"text-lg font-medium\">{error}</p>\n                            <button\n                                onClick={loadDocument}\n                                className=\"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition\"\n                            >\n                                Retry\n                            </button>\n                        </div>\n                    ) : (\n                        renderPreview()\n                    )}\n                </div>\n\n                {/* Page navigation for PDF */}\n                {fileType.includes('pdf') && totalPages > 1 && (\n                    <div className={`flex items-center justify-center px-4 py-2 ${isFullscreen ? 'bg-gray-800' : 'bg-gray-100'} border-t border-gray-200`}>\n                        <button\n                            onClick={() => setCurrentPage(prev => Math.max(prev - 1, 1))}\n                            disabled={currentPage === 1}\n                            className={`p-1 rounded ${isFullscreen ? 'hover:bg-gray-700 text-gray-300' : 'hover:bg-gray-200 text-gray-600'} disabled:opacity-50`}\n                        >\n                            <ChevronLeft className=\"w-5 h-5\" />\n                        </button>\n                        <span className={`mx-4 text-sm ${isFullscreen ? 'text-gray-300' : 'text-gray-600'}`}>\n                            Page {currentPage} of {totalPages}\n                        </span>\n                        <button\n                            onClick={() => setCurrentPage(prev => Math.min(prev + 1, totalPages))}\n                            disabled={currentPage === totalPages}\n                            className={`p-1 rounded ${isFullscreen ? 'hover:bg-gray-700 text-gray-300' : 'hover:bg-gray-200 text-gray-600'} disabled:opacity-50`}\n                        >\n                            <ChevronRight className=\"w-5 h-5\" />\n                        </button>\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/DragDropUpload.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'processFiles'. Either include it or remove the dependency array.","line":67,"column":6,"nodeType":"ArrayExpression","endLine":67,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [processFiles]","fix":{"range":[2025,2027],"text":"[processFiles]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'processFiles'. Either include it or remove the dependency array.","line":74,"column":6,"nodeType":"ArrayExpression","endLine":74,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [processFiles]","fix":{"range":[2243,2245],"text":"[processFiles]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useCallback } from 'react';\nimport { Upload, X, FileText, CheckCircle, AlertCircle, Loader } from 'lucide-react';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\n\ninterface FileWithPreview {\n  file: File;\n  id: string;\n  status: 'pending' | 'uploading' | 'success' | 'error';\n  progress: number;\n  error?: string;\n  url?: string;\n}\n\ninterface DragDropUploadProps {\n  employeeId?: string;\n  applicationId?: string;\n  onUploadComplete?: (files: any[]) => void;\n}\n\nexport default function DragDropUpload({ employeeId, applicationId, onUploadComplete }: DragDropUploadProps) {\n  const [files, setFiles] = useState<FileWithPreview[]>([]);\n  const [isDragging, setIsDragging] = useState(false);\n  const [isUploading, setIsUploading] = useState(false);\n\n  const handleDragOver = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(true);\n  }, []);\n\n  const handleDragLeave = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(false);\n  }, []);\n\n  const validateFile = (file: File): { valid: boolean; error?: string } => {\n    const allowedTypes = [\n      'application/pdf',\n      'image/jpeg',\n      'image/jpg',\n      'image/png',\n      'application/msword',\n      'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n      'application/vnd.ms-excel',\n      'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n    ];\n\n    const maxSize = 10 * 1024 * 1024; // 10MB\n\n    if (!allowedTypes.includes(file.type)) {\n      return { valid: false, error: 'File type not supported. Please upload PDF, images, or Office documents.' };\n    }\n\n    if (file.size > maxSize) {\n      return { valid: false, error: 'File size exceeds 10MB limit' };\n    }\n\n    return { valid: true };\n  };\n\n  const handleDrop = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(false);\n\n    const droppedFiles = Array.from(e.dataTransfer.files);\n    processFiles(droppedFiles);\n  }, []);\n\n  const handleFileInput = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files) {\n      const selectedFiles = Array.from(e.target.files);\n      processFiles(selectedFiles);\n    }\n  }, []);\n\n  const processFiles = (newFiles: File[]) => {\n    const processedFiles: FileWithPreview[] = newFiles.map(file => {\n      const validation = validateFile(file);\n      return {\n        file,\n        id: Math.random().toString(36).substr(2, 9),\n        status: validation.valid ? 'pending' : 'error',\n        progress: 0,\n        error: validation.error\n      };\n    });\n\n    setFiles(prev => [...prev, ...processedFiles]);\n  };\n\n  const removeFile = (id: string) => {\n    setFiles(prev => prev.filter(f => f.id !== id));\n  };\n\n  const uploadFiles = async () => {\n    setIsUploading(true);\n\n    try {\n      const session = await supabase.auth.getSession();\n      if (!session.data.session) {\n        throw new Error('Not authenticated');\n      }\n\n      const filesToUpload = files.filter(f => f.status === 'pending');\n\n      // Update status to uploading\n      setFiles(prev => prev.map(f =>\n        f.status === 'pending' ? { ...f, status: 'uploading' as const } : f\n      ));\n\n      // Convert files to base64\n      const filePromises = filesToUpload.map(async (fileWrapper) => {\n        return new Promise((resolve) => {\n          const reader = new FileReader();\n          reader.onloadend = () => {\n            resolve({\n              fileData: reader.result as string,\n              fileName: fileWrapper.file.name,\n              documentType: getDocumentType(fileWrapper.file.name),\n              category: 'general'\n            });\n          };\n          reader.readAsDataURL(fileWrapper.file);\n        });\n      });\n\n      const filesData = await Promise.all(filePromises);\n\n      // Upload via edge function\n      const { data, error } = await supabase.functions.invoke('document-upload-enhanced', {\n        body: {\n          files: filesData,\n          metadata: {\n            employee_id: employeeId,\n            application_id: applicationId,\n            batch_name: `Upload ${new Date().toLocaleString()}`\n          }\n        },\n        headers: {\n          Authorization: `Bearer ${session.data.session.access_token}`\n        }\n      });\n\n      if (error) throw error;\n\n      // Update file statuses based on results\n      const results = data.data.results;\n      setFiles(prev => prev.map(f => {\n        const result = results.find((r: any) => r.file === f.file.name);\n        if (result) {\n          return {\n            ...f,\n            status: result.success ? 'success' : 'error',\n            progress: 100,\n            error: result.error,\n            url: result.data?.file_url\n          };\n        }\n        return f;\n      }));\n\n      if (onUploadComplete) {\n        const successfulUploads = results.filter((r: any) => r.success).map((r: any) => r.data);\n        onUploadComplete(successfulUploads);\n      }\n\n    } catch (error) {\n      log.error('Upload error', error, { component: 'DragDropUpload', action: 'uploadFiles' });\n      setFiles(prev => prev.map(f =>\n        f.status === 'uploading' ? { ...f, status: 'error' as const, error: 'Upload failed' } : f\n      ));\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const getDocumentType = (filename: string): string => {\n    const ext = filename.split('.').pop()?.toLowerCase();\n    const typeMap: Record<string, string> = {\n      'pdf': 'document',\n      'jpg': 'image',\n      'jpeg': 'image',\n      'png': 'image',\n      'doc': 'document',\n      'docx': 'document',\n      'xls': 'spreadsheet',\n      'xlsx': 'spreadsheet'\n    };\n    return typeMap[ext || ''] || 'other';\n  };\n\n  const getFileIcon = (status: string) => {\n    switch (status) {\n      case 'success':\n        return <CheckCircle className=\"w-5 h-5 text-green-600\" />;\n      case 'error':\n        return <AlertCircle className=\"w-5 h-5 text-red-600\" />;\n      case 'uploading':\n        return <Loader className=\"w-5 h-5 text-blue-600 animate-spin\" />;\n      default:\n        return <FileText className=\"w-5 h-5 text-gray-400\" />;\n    }\n  };\n\n  const pendingCount = files.filter(f => f.status === 'pending').length;\n  const successCount = files.filter(f => f.status === 'success').length;\n  const errorCount = files.filter(f => f.status === 'error').length;\n\n  return (\n    <div className=\"space-y-4\">\n      <div\n        onDragOver={handleDragOver}\n        onDragLeave={handleDragLeave}\n        onDrop={handleDrop}\n        className={`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${isDragging\n            ? 'border-indigo-600 bg-indigo-50'\n            : 'border-gray-300 hover:border-gray-400'\n          }`}\n      >\n        <Upload className={`w-12 h-12 mx-auto mb-4 ${isDragging ? 'text-indigo-600' : 'text-gray-400'}`} />\n        <p className=\"text-lg font-medium text-gray-900 mb-2\">\n          {isDragging ? 'Drop files here' : 'Drag and drop files here'}\n        </p>\n        <p className=\"text-sm text-gray-500 mb-4\">\n          or click to browse\n        </p>\n        <input\n          type=\"file\"\n          multiple\n          onChange={handleFileInput}\n          className=\"hidden\"\n          id=\"file-upload\"\n          accept=\".pdf,.jpg,.jpeg,.png,.doc,.docx,.xls,.xlsx\"\n        />\n        <label\n          htmlFor=\"file-upload\"\n          className=\"inline-block px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 cursor-pointer\"\n        >\n          Select Files\n        </label>\n        <p className=\"text-xs text-gray-400 mt-4\">\n          Supported: PDF, JPG, PNG, DOC, DOCX, XLS, XLSX (Max 10MB per file)\n        </p>\n      </div>\n\n      {files.length > 0 && (\n        <div className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <h3 className=\"text-lg font-semibold text-gray-900\">\n              Files ({files.length})\n            </h3>\n            {pendingCount > 0 && (\n              <button\n                onClick={uploadFiles}\n                disabled={isUploading}\n                className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {isUploading ? 'Uploading...' : `Upload ${pendingCount} ${pendingCount === 1 ? 'File' : 'Files'}`}\n              </button>\n            )}\n          </div>\n\n          {(successCount > 0 || errorCount > 0) && (\n            <div className=\"flex space-x-4 text-sm\">\n              {successCount > 0 && (\n                <span className=\"text-green-600\">\n                  {successCount} uploaded successfully\n                </span>\n              )}\n              {errorCount > 0 && (\n                <span className=\"text-red-600\">\n                  {errorCount} failed\n                </span>\n              )}\n            </div>\n          )}\n\n          <div className=\"space-y-2\">\n            {files.map((fileWrapper) => (\n              <div\n                key={fileWrapper.id}\n                className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:shadow-sm transition\"\n              >\n                <div className=\"flex items-center space-x-3 flex-1\">\n                  {getFileIcon(fileWrapper.status)}\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"text-sm font-medium text-gray-900 truncate\">\n                      {fileWrapper.file.name}\n                    </p>\n                    <p className=\"text-xs text-gray-500\">\n                      {(fileWrapper.file.size / 1024).toFixed(1)} KB\n                      {fileWrapper.error && ` - ${fileWrapper.error}`}\n                    </p>\n                  </div>\n                </div>\n                {fileWrapper.status !== 'uploading' && (\n                  <button\n                    onClick={() => removeFile(fileWrapper.id)}\n                    className=\"p-1 hover:bg-gray-100 rounded\"\n                  >\n                    <X className=\"w-4 h-4 text-gray-400\" />\n                  </button>\n                )}\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/EditEmployeeModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/EditJobModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/EmailTemplateEditor.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertCircle' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":67,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":78},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadTemplates'. Either include it or remove the dependency array.","line":137,"column":8,"nodeType":"ArrayExpression","endLine":137,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [currentTenant, loadTemplates]","fix":{"range":[4724,4739],"text":"[currentTenant, loadTemplates]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { Mail, Save, Eye, Code, Copy, Check, Plus, Trash2, Edit2, AlertCircle } from 'lucide-react';\n\ninterface EmailTemplate {\n    id: string;\n    name: string;\n    subject: string;\n    body: string;\n    type: string;\n    variables: string[];\n    is_active: boolean;\n    created_at: string;\n    updated_at: string;\n}\n\nconst defaultTemplates: Omit<EmailTemplate, 'id' | 'created_at' | 'updated_at'>[] = [\n    {\n        name: 'Application Received',\n        type: 'application_received',\n        subject: 'Thank you for your application - {{job_title}}',\n        body: `Dear {{applicant_name}},\n\nThank you for applying for the {{job_title}} position at {{company_name}}.\n\nWe have received your application and will review it shortly. If your qualifications match our requirements, we will contact you to discuss the next steps.\n\nIn the meantime, if you have any questions, please don't hesitate to reach out.\n\nBest regards,\n{{company_name}} Recruitment Team`,\n        variables: ['applicant_name', 'job_title', 'company_name'],\n        is_active: true,\n    },\n    {\n        name: 'Interview Invitation',\n        type: 'interview_invitation',\n        subject: 'Interview Invitation - {{job_title}} at {{company_name}}',\n        body: `Dear {{applicant_name}},\n\nWe are pleased to invite you for an interview for the {{job_title}} position.\n\nInterview Details:\n- Date: {{interview_date}}\n- Time: {{interview_time}}\n- Location: {{interview_location}}\n- Type: {{interview_type}}\n\nPlease confirm your attendance by replying to this email.\n\nIf you need to reschedule, please let us know at least 24 hours in advance.\n\nBest regards,\n{{company_name}} Recruitment Team`,\n        variables: ['applicant_name', 'job_title', 'company_name', 'interview_date', 'interview_time', 'interview_location', 'interview_type'],\n        is_active: true,\n    },\n    {\n        name: 'Offer Letter',\n        type: 'offer_letter',\n        subject: 'Job Offer - {{job_title}} at {{company_name}}',\n        body: `Dear {{applicant_name}},\n\nWe are delighted to offer you the position of {{job_title}} at {{company_name}}.\n\nOffer Details:\n- Position: {{job_title}}\n- Department: {{department}}\n- Start Date: {{start_date}}\n- Salary: {{salary}}\n\nPlease review the attached offer letter and respond within 5 business days.\n\nWe look forward to welcoming you to our team!\n\nBest regards,\n{{company_name}} HR Team`,\n        variables: ['applicant_name', 'job_title', 'company_name', 'department', 'start_date', 'salary'],\n        is_active: true,\n    },\n    {\n        name: 'Application Rejected',\n        type: 'rejection',\n        subject: 'Update regarding your application for {{job_title}}',\n        body: `Dear {{applicant_name}},\n\nThank you for your interest in the {{job_title}} position at {{company_name}}.\n\nAfter careful review of your application and qualifications, we have decided not to move forward with your candidacy at this time.\n\nAI Screening Insights:\n{{ai_summary}}\n\nWe appreciate the time you took to apply and wish you the best in your future endeavors.\n\nBest regards,\n{{company_name}} Recruitment Team`,\n        variables: ['applicant_name', 'job_title', 'company_name', 'ai_summary'],\n        is_active: true,\n    },\n    {\n        name: 'Training Reminder',\n        type: 'training_reminder',\n        subject: 'Training Reminder: {{training_name}} expires on {{expiry_date}}',\n        body: `Dear {{employee_name}},\n\nThis is a reminder that your {{training_name}} certification will expire on {{expiry_date}}.\n\nPlease complete the required training before the expiry date to maintain compliance.\n\nYou can access the training portal here: {{training_link}}\n\nIf you have any questions, please contact the HR department.\n\nBest regards,\n{{company_name}} Compliance Team`,\n        variables: ['employee_name', 'training_name', 'expiry_date', 'training_link', 'company_name'],\n        is_active: true,\n    },\n];\n\nexport default function EmailTemplateEditor() {\n    const { currentTenant } = useTenant();\n    const [templates, setTemplates] = useState<EmailTemplate[]>([]);\n    const [selectedTemplate, setSelectedTemplate] = useState<EmailTemplate | null>(null);\n    const [loading, setLoading] = useState(true);\n    const [saving, setSaving] = useState(false);\n    const [showPreview, setShowPreview] = useState(false);\n    const [previewData, setPreviewData] = useState<Record<string, string>>({});\n    const [copied, setCopied] = useState(false);\n    const [editMode, setEditMode] = useState(false);\n\n    useEffect(() => {\n        loadTemplates();\n    }, [currentTenant]);\n\n    async function loadTemplates() {\n        setLoading(true);\n        try {\n            const { data, error } = await supabase\n                .from('email_templates')\n                .select('*')\n                .eq('tenant_id', currentTenant?.id)\n                .order('name');\n\n            if (error) throw error;\n\n            if (data && data.length > 0) {\n                setTemplates(data);\n                setSelectedTemplate(data[0]);\n            } else {\n                // Use default templates\n                const defaultWithIds = defaultTemplates.map((t, i) => ({\n                    ...t,\n                    id: `default-${i}`,\n                    created_at: new Date().toISOString(),\n                    updated_at: new Date().toISOString(),\n                }));\n                setTemplates(defaultWithIds);\n                setSelectedTemplate(defaultWithIds[0]);\n            }\n        } catch (error) {\n            log.error('Error loading templates', error, { component: 'EmailTemplateEditor', action: 'loadTemplates' });\n            // Use defaults on error\n            const defaultWithIds = defaultTemplates.map((t, i) => ({\n                ...t,\n                id: `default-${i}`,\n                created_at: new Date().toISOString(),\n                updated_at: new Date().toISOString(),\n            }));\n            setTemplates(defaultWithIds);\n            setSelectedTemplate(defaultWithIds[0]);\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    async function createNewTemplate() {\n        const newTemp: EmailTemplate = {\n            id: `new-${Date.now()}`,\n            name: 'New Template',\n            type: 'custom',\n            subject: 'New Subject',\n            body: 'Hello {{applicant_name}},\\n\\nEnter your message here.',\n            variables: ['applicant_name', 'company_name'],\n            is_active: true,\n            created_at: new Date().toISOString(),\n            updated_at: new Date().toISOString(),\n        };\n        setTemplates(prev => [newTemp, ...prev]);\n        setSelectedTemplate(newTemp);\n        setEditMode(true);\n        setShowPreview(false);\n    }\n\n    async function cloneTemplate() {\n        if (!selectedTemplate) return;\n        const cloned: EmailTemplate = {\n            ...selectedTemplate,\n            id: `clone-${Date.now()}`,\n            name: `${selectedTemplate.name} (Copy)`,\n            created_at: new Date().toISOString(),\n            updated_at: new Date().toISOString(),\n        };\n        setTemplates(prev => [cloned, ...prev]);\n        setSelectedTemplate(cloned);\n        setEditMode(true);\n        setShowPreview(false);\n    }\n\n    async function deleteTemplate() {\n        if (!selectedTemplate) return;\n        if (!confirm('Are you sure you want to delete this template?')) return;\n\n        try {\n            if (!selectedTemplate.id.startsWith('default-') && !selectedTemplate.id.startsWith('new-') && !selectedTemplate.id.startsWith('clone-')) {\n                const { error } = await supabase\n                    .from('email_templates')\n                    .delete()\n                    .eq('id', selectedTemplate.id);\n                if (error) throw error;\n            }\n\n            const newTemplates = templates.filter(t => t.id !== selectedTemplate.id);\n            setTemplates(newTemplates);\n            setSelectedTemplate(newTemplates.length > 0 ? newTemplates[0] : null);\n        } catch (error) {\n            log.error('Error deleting template', error, { component: 'EmailTemplateEditor', action: 'deleteTemplate' });\n        }\n    }\n\n    function updateSelectedTemplate(updates: Partial<EmailTemplate>) {\n        if (!selectedTemplate) return;\n        const updated = { ...selectedTemplate, ...updates };\n        setSelectedTemplate(updated);\n        setTemplates(prev => prev.map(t => t.id === updated.id ? updated : t));\n    }\n\n    async function saveTemplate() {\n        if (!selectedTemplate || !currentTenant) return;\n        setSaving(true);\n        try {\n            const isNew = selectedTemplate.id.startsWith('default-') ||\n                selectedTemplate.id.startsWith('new-') ||\n                selectedTemplate.id.startsWith('clone-');\n\n            if (isNew) {\n                const { data, error } = await supabase\n                    .from('email_templates')\n                    .insert({\n                        tenant_id: currentTenant.id,\n                        name: selectedTemplate.name,\n                        subject: selectedTemplate.subject,\n                        body: selectedTemplate.body,\n                        type: selectedTemplate.type,\n                        variables: selectedTemplate.variables,\n                        is_active: selectedTemplate.is_active\n                    })\n                    .select()\n                    .single();\n\n                if (error) throw error;\n\n                setTemplates(prev => prev.map(t => t.id === selectedTemplate.id ? data : t));\n                setSelectedTemplate(data);\n                alert('Template created successfully!');\n            } else {\n                const { error } = await supabase\n                    .from('email_templates')\n                    .update({\n                        name: selectedTemplate.name,\n                        subject: selectedTemplate.subject,\n                        body: selectedTemplate.body,\n                        type: selectedTemplate.type,\n                        variables: selectedTemplate.variables,\n                        is_active: selectedTemplate.is_active,\n                        updated_at: new Date().toISOString()\n                    })\n                    .eq('id', selectedTemplate.id);\n\n                if (error) throw error;\n                alert('Template updated successfully!');\n            }\n            setEditMode(false);\n        } catch (error) {\n            log.error('Error saving template', error, { component: 'EmailTemplateEditor', action: 'saveTemplate' });\n            alert('Failed to save template. Please try again.');\n        } finally {\n            setSaving(false);\n        }\n    }\n\n    function renderPreview(content: string): string {\n        let rendered = content;\n        Object.entries(previewData).forEach(([key, value]) => {\n            rendered = rendered.replace(new RegExp(`{{${key}}}`, 'g'), value || `[${key}]`);\n        });\n        // Replace any remaining variables with placeholders\n        rendered = rendered.replace(/{{(\\w+)}}/g, (match, p1) => previewData[p1] || `[${p1}]`);\n        return rendered;\n    }\n\n    async function copyToClipboard(text: string) {\n        try {\n            await navigator.clipboard.writeText(text);\n            setCopied(true);\n            setTimeout(() => setCopied(false), 2000);\n        } catch (err) {\n            log.error('Copy to clipboard failed', err);\n        }\n    }\n\n    function insertVariable(variable: string) {\n        const textarea = document.getElementById('template-body') as HTMLTextAreaElement;\n        if (!textarea) return;\n\n        const start = textarea.selectionStart;\n        const end = textarea.selectionEnd;\n        const text = selectedTemplate?.body || '';\n        const insertion = `{{${variable}}}`;\n\n        const newBody = text.substring(0, start) + insertion + text.substring(end);\n        updateSelectedTemplate({ body: newBody });\n\n        // Focus back and set cursor position\n        setTimeout(() => {\n            textarea.focus();\n            textarea.setSelectionRange(start + insertion.length, start + insertion.length);\n        }, 10);\n    }\n\n    function addVariable(variable: string) {\n        if (!selectedTemplate || !variable) return;\n        if (selectedTemplate.variables.includes(variable)) return;\n        updateSelectedTemplate({ variables: [...selectedTemplate.variables, variable] });\n    }\n\n    if (loading) {\n        return (\n            <div className=\"flex items-center justify-center h-64\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600\" />\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"bg-white rounded-xl border border-gray-200 overflow-hidden\">\n            {/* Header */}\n            <div className=\"px-6 py-4 border-b border-gray-200 bg-gray-50\">\n                <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center\">\n                        <Mail className=\"w-5 h-5 mr-2 text-indigo-600\" />\n                        <h2 className=\"text-lg font-semibold text-gray-900\">Email Templates</h2>\n                    </div>\n                    <button\n                        onClick={createNewTemplate}\n                        className=\"inline-flex items-center px-3 py-1.5 text-sm bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition\"\n                    >\n                        <Plus className=\"w-4 h-4 mr-1\" />\n                        New Template\n                    </button>\n                </div>\n            </div>\n\n            <div className=\"flex\">\n                {/* Template List */}\n                <div className=\"w-64 border-r border-gray-200 bg-gray-50 h-[600px] overflow-y-auto\">\n                    <div className=\"p-3\">\n                        {templates.map(template => (\n                            <button\n                                key={template.id}\n                                onClick={() => {\n                                    setSelectedTemplate(template);\n                                    setEditMode(false);\n                                    setShowPreview(false);\n                                }}\n                                className={`w-full text-left px-3 py-2 rounded-lg mb-1 transition ${selectedTemplate?.id === template.id\n                                    ? 'bg-indigo-100 text-indigo-700'\n                                    : 'hover:bg-gray-100 text-gray-700'\n                                    }`}\n                            >\n                                <p className=\"text-sm font-medium truncate\">{template.name}</p>\n                                <div className=\"flex items-center justify-between mt-1\">\n                                    <span className=\"text-[10px] uppercase font-bold text-gray-400 bg-gray-100 px-1.5 py-0.5 rounded\">\n                                        {template.type}\n                                    </span>\n                                    {template.id.startsWith('default-') && (\n                                        <span className=\"text-[10px] text-indigo-500 font-medium\">Default</span>\n                                    )}\n                                </div>\n                            </button>\n                        ))}\n                    </div>\n                </div>\n\n                {/* Template Editor */}\n                <div className=\"flex-1 p-6 h-[600px] overflow-y-auto\">\n                    {selectedTemplate ? (\n                        <div className=\"space-y-6\">\n                            {/* Toolbar */}\n                            <div className=\"flex items-center justify-between bg-white sticky top-0 z-10 py-1\">\n                                <div className=\"flex items-center space-x-2\">\n                                    <button\n                                        onClick={() => { setShowPreview(false); setEditMode(true); }}\n                                        className={`px-3 py-1.5 text-sm rounded-lg transition ${editMode && !showPreview\n                                            ? 'bg-indigo-100 text-indigo-700'\n                                            : 'text-gray-600 hover:bg-gray-100'\n                                            }`}\n                                    >\n                                        <Edit2 className=\"w-4 h-4 inline mr-1\" />\n                                        Edit\n                                    </button>\n                                    <button\n                                        onClick={() => { setShowPreview(true); setEditMode(false); }}\n                                        className={`px-3 py-1.5 text-sm rounded-lg transition ${showPreview\n                                            ? 'bg-indigo-100 text-indigo-700'\n                                            : 'text-gray-600 hover:bg-gray-100'\n                                            }`}\n                                    >\n                                        <Eye className=\"w-4 h-4 inline mr-1\" />\n                                        Preview\n                                    </button>\n                                    <div className=\"h-6 w-px bg-gray-200 mx-1\" />\n                                    <button\n                                        onClick={cloneTemplate}\n                                        className=\"px-3 py-1.5 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition\"\n                                        title=\"Clone template\"\n                                    >\n                                        <Copy className=\"w-4 h-4 inline\" />\n                                    </button>\n                                    <button\n                                        onClick={deleteTemplate}\n                                        className=\"px-3 py-1.5 text-sm text-red-600 hover:bg-red-50 rounded-lg transition\"\n                                        title=\"Delete template\"\n                                    >\n                                        <Trash2 className=\"w-4 h-4 inline\" />\n                                    </button>\n                                </div>\n                                <div className=\"flex items-center space-x-3\">\n                                    <button\n                                        onClick={() => copyToClipboard(selectedTemplate.body)}\n                                        className=\"px-3 py-1.5 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition\"\n                                    >\n                                        {copied ? <Check className=\"w-4 h-4 inline mr-1\" /> : <Copy className=\"w-4 h-4 inline mr-1\" />}\n                                        {copied ? 'Copied!' : 'Copy Body'}\n                                    </button>\n                                    {editMode && (\n                                        <button\n                                            onClick={saveTemplate}\n                                            disabled={saving}\n                                            className=\"inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50 shadow-sm\"\n                                        >\n                                            <Save className=\"w-4 h-4 mr-2\" />\n                                            {saving ? 'Saving...' : 'Save Changes'}\n                                        </button>\n                                    )}\n                                </div>\n                            </div>\n\n                            {/* Editor/Preview */}\n                            {showPreview ? (\n                                <div className=\"space-y-4 animate-in fade-in duration-300\">\n                                    {/* Preview Variables */}\n                                    <div className=\"bg-indigo-50/50 rounded-lg p-4 border border-indigo-100\">\n                                        <p className=\"text-sm font-semibold text-indigo-900 mb-3 flex items-center\">\n                                            <Code className=\"w-4 h-4 mr-2\" />\n                                            Preview Variables\n                                        </p>\n                                        <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3\">\n                                            {selectedTemplate.variables.map(variable => (\n                                                <div key={variable}>\n                                                    <label className=\"text-[10px] font-bold uppercase text-indigo-400 mb-1 block\">{variable}</label>\n                                                    <input\n                                                        type=\"text\"\n                                                        value={previewData[variable] || ''}\n                                                        onChange={(e) => setPreviewData({ ...previewData, [variable]: e.target.value })}\n                                                        placeholder={`Value for ${variable}`}\n                                                        className=\"w-full px-2 py-1.5 text-sm border border-indigo-200 rounded focus:ring-2 focus:ring-indigo-500 outline-none transition\"\n                                                    />\n                                                </div>\n                                            ))}\n                                        </div>\n                                    </div>\n\n                                    {/* Email Preview */}\n                                    <div className=\"border border-gray-200 rounded-lg overflow-hidden shadow-sm\">\n                                        <div className=\"bg-gray-50 px-4 py-3 border-b border-gray-200\">\n                                            <p className=\"text-sm font-medium text-gray-900\">\n                                                <span className=\"text-gray-500 font-normal\">Subject: </span>\n                                                {renderPreview(selectedTemplate.subject)}\n                                            </p>\n                                        </div>\n                                        <div className=\"p-8 bg-white min-h-[300px]\">\n                                            <div className=\"prose prose-sm max-w-none whitespace-pre-wrap font-sans text-gray-800 leading-relaxed\">\n                                                {renderPreview(selectedTemplate.body)}\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            ) : editMode ? (\n                                <div className=\"space-y-4 animate-in fade-in duration-300\">\n                                    <div className=\"grid grid-cols-2 gap-4\">\n                                        <div>\n                                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Template Name</label>\n                                            <input\n                                                type=\"text\"\n                                                value={selectedTemplate.name}\n                                                onChange={(e) => updateSelectedTemplate({ name: e.target.value })}\n                                                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition\"\n                                                placeholder=\"e.g. Senior Dev Offer Letter\"\n                                            />\n                                        </div>\n                                        <div>\n                                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Template Type</label>\n                                            <select\n                                                value={selectedTemplate.type}\n                                                onChange={(e) => updateSelectedTemplate({ type: e.target.value })}\n                                                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition\"\n                                            >\n                                                <option value=\"custom\">Custom</option>\n                                                <option value=\"application_received\">Application Received</option>\n                                                <option value=\"interview_invitation\">Interview Invitation</option>\n                                                <option value=\"offer_letter\">Offer Letter</option>\n                                                <option value=\"rejection\">Rejection</option>\n                                                <option value=\"onboarding\">Onboarding</option>\n                                                <option value=\"compliance\">Compliance</option>\n                                            </select>\n                                        </div>\n                                    </div>\n\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Email Subject</label>\n                                        <input\n                                            type=\"text\"\n                                            value={selectedTemplate.subject}\n                                            onChange={(e) => updateSelectedTemplate({ subject: e.target.value })}\n                                            className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition\"\n                                            placeholder=\"Subject line with {{variables}}\"\n                                        />\n                                    </div>\n\n                                    <div>\n                                        <div className=\"flex items-center justify-between mb-2\">\n                                            <label className=\"block text-sm font-medium text-gray-700\">Available Variables</label>\n                                            <div className=\"flex items-center space-x-2\">\n                                                <input\n                                                    type=\"text\"\n                                                    id=\"new-variable\"\n                                                    placeholder=\"Add custom variable\"\n                                                    className=\"px-2 py-1 text-xs border border-gray-300 rounded outline-none focus:ring-1 focus:ring-indigo-500\"\n                                                    onKeyDown={(e) => {\n                                                        if (e.key === 'Enter') {\n                                                            const input = e.currentTarget;\n                                                            addVariable(input.value);\n                                                            input.value = '';\n                                                        }\n                                                    }}\n                                                />\n                                            </div>\n                                        </div>\n                                        <div className=\"flex flex-wrap gap-2 p-3 bg-gray-50 rounded-lg border border-gray-200\">\n                                            {selectedTemplate.variables.map(variable => (\n                                                <button\n                                                    key={variable}\n                                                    onClick={() => insertVariable(variable)}\n                                                    className=\"group flex items-center px-2 py-1 text-xs bg-white text-indigo-700 border border-indigo-200 rounded hover:bg-indigo-50 hover:border-indigo-300 transition shadow-sm\"\n                                                >\n                                                    <Code className=\"w-3 h-3 mr-1 text-indigo-400\" />\n                                                    {`{{${variable}}}`}\n                                                </button>\n                                            ))}\n                                            {selectedTemplate.variables.length === 0 && (\n                                                <p className=\"text-xs text-gray-500 italic\">No variables defined yet.</p>\n                                            )}\n                                        </div>\n                                    </div>\n\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Email Body</label>\n                                        <div className=\"relative\">\n                                            <textarea\n                                                id=\"template-body\"\n                                                value={selectedTemplate.body}\n                                                onChange={(e) => updateSelectedTemplate({ body: e.target.value })}\n                                                rows={12}\n                                                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-mono text-sm leading-relaxed\"\n                                            />\n                                            <div className=\"absolute bottom-3 right-3 text-[10px] text-gray-400 bg-white/80 px-1 rounded\">\n                                                Markdown supported\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            ) : (\n                                <div className=\"text-center py-20 bg-gray-50 rounded-xl border border-dashed border-gray-300\">\n                                    <Mail className=\"w-16 h-16 mx-auto mb-4 text-gray-200\" />\n                                    <h3 className=\"text-lg font-medium text-gray-900 mb-1\">View or Edit Template</h3>\n                                    <p className=\"text-gray-500 max-w-xs mx-auto mb-6\">Select a template from the list to preview its content or make modifications.</p>\n                                    <div className=\"flex items-center justify-center space-x-3\">\n                                        <button\n                                            onClick={() => setEditMode(true)}\n                                            className=\"px-4 py-2 bg-white text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition shadow-sm\"\n                                        >\n                                            <Edit2 className=\"w-4 h-4 inline mr-2\" />\n                                            Edit Mode\n                                        </button>\n                                        <button\n                                            onClick={() => setShowPreview(true)}\n                                            className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition shadow-sm\"\n                                        >\n                                            <Eye className=\"w-4 h-4 inline mr-2\" />\n                                            Preview Mode\n                                        </button>\n                                    </div>\n                                </div>\n                            )}\n                        </div>\n                    ) : (\n                        <div className=\"text-center py-24 text-gray-500\">\n                            <Mail className=\"w-16 h-16 mx-auto mb-4 text-gray-200\" />\n                            <h3 className=\"text-lg font-medium text-gray-900\">No Template Selected</h3>\n                            <p>Choose an existing template or create a new one to get started.</p>\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/ErrorBoundary.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":130,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":130,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { log } from '@/lib/logger';\n\nconst isDevelopment = import.meta.env.MODE === 'development';\n\ninterface ErrorBoundaryProps {\n  children: React.ReactNode;\n  fallback?: React.ReactNode;\n  onError?: (error: Error, errorInfo: React.ErrorInfo) => void;\n}\n\ninterface ErrorBoundaryState {\n  hasError: boolean;\n  error: Error | null;\n  errorInfo: React.ErrorInfo | null;\n}\n\nconst serializeError = (error: unknown): string => {\n  if (error instanceof Error) {\n    return error.message + (isDevelopment && error.stack ? '\\n' + error.stack : '');\n  }\n  return String(error);\n};\n\nexport class ErrorBoundary extends React.Component<ErrorBoundaryProps, ErrorBoundaryState> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = { hasError: false, error: null, errorInfo: null };\n  }\n\n  static getDerivedStateFromError(error: Error): Partial<ErrorBoundaryState> {\n    return { hasError: true, error };\n  }\n\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\n    // Log the error\n    log.error('React ErrorBoundary caught an error', error, {\n      component: errorInfo.componentStack?.split('\\n')[1]?.trim(),\n      metadata: { componentStack: isDevelopment ? errorInfo.componentStack : undefined }\n    });\n\n    this.setState({ errorInfo });\n\n    // Call custom error handler if provided\n    if (this.props.onError) {\n      this.props.onError(error, errorInfo);\n    }\n  }\n\n  handleRefresh = () => {\n    window.location.reload();\n  };\n\n  handleGoHome = () => {\n    window.location.href = '/';\n  };\n\n  render() {\n    if (this.state.hasError) {\n      // Custom fallback UI if provided\n      if (this.props.fallback) {\n        return this.props.fallback;\n      }\n\n      // Default error UI\n      return (\n        <div className=\"min-h-screen flex items-center justify-center bg-gray-50 p-4\">\n          <div className=\"max-w-md w-full bg-white rounded-lg shadow-lg p-6 text-center\">\n            <div className=\"w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full flex items-center justify-center\">\n              <svg \n                className=\"w-8 h-8 text-red-600\" \n                fill=\"none\" \n                stroke=\"currentColor\" \n                viewBox=\"0 0 24 24\"\n              >\n                <path \n                  strokeLinecap=\"round\" \n                  strokeLinejoin=\"round\" \n                  strokeWidth={2} \n                  d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" \n                />\n              </svg>\n            </div>\n            \n            <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">\n              Something went wrong\n            </h2>\n            \n            <p className=\"text-gray-600 mb-4\">\n              We apologize for the inconvenience. Please try refreshing the page or return to the home page.\n            </p>\n\n            {isDevelopment && this.state.error && (\n              <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded text-left\">\n                <p className=\"text-sm font-medium text-red-800 mb-1\">Error Details:</p>\n                <pre className=\"text-xs text-red-700 overflow-auto max-h-32\">\n                  {serializeError(this.state.error)}\n                </pre>\n              </div>\n            )}\n\n            <div className=\"flex gap-3 justify-center\">\n              <button\n                onClick={this.handleRefresh}\n                className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium\"\n              >\n                Refresh Page\n              </button>\n              <button\n                onClick={this.handleGoHome}\n                className=\"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors font-medium\"\n              >\n                Go Home\n              </button>\n            </div>\n\n            <p className=\"mt-4 text-sm text-gray-500\">\n              If this problem persists, please contact support.\n            </p>\n          </div>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n\n// Functional wrapper for easier use with hooks\nexport function withErrorBoundary<P extends object>(\n  Component: React.ComponentType<P>,\n  fallback?: React.ReactNode\n) {\n  return function WithErrorBoundary(props: P) {\n    return (\n      <ErrorBoundary fallback={fallback}>\n        <Component {...props} />\n      </ErrorBoundary>\n    );\n  };\n}\n\nexport default ErrorBoundary;\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/EventCalendar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isSameMonth' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":63,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":74},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":26,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":19},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadEvents'. Either include it or remove the dependency array.","line":31,"column":8,"nodeType":"ArrayExpression","endLine":31,"endColumn":37,"suggestions":[{"desc":"Update the dependencies array to be: [currentMonth, currentTenant, loadEvents]","fix":{"range":[1282,1311],"text":"[currentMonth, currentTenant, loadEvents]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { ChevronLeft, ChevronRight, Plus, Calendar as CalendarIcon, Clock, Users, MapPin, Video, X } from 'lucide-react';\nimport { format, startOfMonth, endOfMonth, eachDayOfInterval, isSameMonth, isSameDay, addMonths, subMonths, isToday, parseISO } from 'date-fns';\n\ninterface CalendarEvent {\n    id: string;\n    title: string;\n    type: 'interview' | 'meeting' | 'training' | 'review' | 'leave' | 'other';\n    start_time: string;\n    end_time: string;\n    location?: string;\n    description?: string;\n    attendees?: string[];\n    color: string;\n}\n\nexport default function EventCalendar() {\n    const { currentTenant } = useTenant();\n    const [currentMonth, setCurrentMonth] = useState(new Date());\n    const [events, setEvents] = useState<CalendarEvent[]>([]);\n    const [selectedDate, setSelectedDate] = useState<Date | null>(null);\n    const [selectedEvent, setSelectedEvent] = useState<CalendarEvent | null>(null);\n    const [loading, setLoading] = useState(true);\n    const [view, setView] = useState<'month' | 'week' | 'day'>('month');\n\n    useEffect(() => {\n        loadEvents();\n    }, [currentMonth, currentTenant]);\n\n    async function loadEvents() {\n        setLoading(true);\n        try {\n            const monthStart = startOfMonth(currentMonth);\n            const monthEnd = endOfMonth(currentMonth);\n\n            // Try to load interviews\n            const { data: interviews } = await supabase\n                .from('interviews')\n                .select('*')\n                .gte('scheduled_at', monthStart.toISOString())\n                .lte('scheduled_at', monthEnd.toISOString());\n\n            const calendarEvents: CalendarEvent[] = [];\n\n            if (interviews) {\n                interviews.forEach(interview => {\n                    calendarEvents.push({\n                        id: interview.id,\n                        title: `Interview: ${interview.candidate_name || 'Candidate'}`,\n                        type: 'interview',\n                        start_time: interview.scheduled_at,\n                        end_time: interview.scheduled_at,\n                        location: interview.location || 'TBD',\n                        description: interview.notes,\n                        color: '#8B5CF6'\n                    });\n                });\n            }\n\n            // Add mock events for demo\n            if (calendarEvents.length === 0) {\n                calendarEvents.push(...generateMockEvents(currentMonth));\n            }\n\n            setEvents(calendarEvents);\n        } catch (error) {\n            log.error('Error loading calendar events', error, { component: 'EventCalendar', action: 'loadEvents', metadata: { month: currentMonth.toISOString() } });\n            setEvents(generateMockEvents(currentMonth));\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    function generateMockEvents(month: Date): CalendarEvent[] {\n        const mockEvents: CalendarEvent[] = [];\n        const daysInMonth = eachDayOfInterval({\n            start: startOfMonth(month),\n            end: endOfMonth(month)\n        });\n\n        // Add some random events\n        const eventTypes = [\n            { type: 'interview' as const, title: 'Interview: Sarah Johnson', color: '#8B5CF6' },\n            { type: 'meeting' as const, title: 'Team Meeting', color: '#3B82F6' },\n            { type: 'training' as const, title: 'Fire Safety Training', color: '#10B981' },\n            { type: 'review' as const, title: 'Performance Review', color: '#F59E0B' },\n            { type: 'leave' as const, title: 'John Smith - Annual Leave', color: '#EF4444' },\n        ];\n\n        daysInMonth.forEach((day, index) => {\n            if (Math.random() > 0.7 && day.getDay() !== 0 && day.getDay() !== 6) {\n                const randomEvent = eventTypes[Math.floor(Math.random() * eventTypes.length)];\n                const hour = 9 + Math.floor(Math.random() * 8);\n                mockEvents.push({\n                    id: `mock-${index}`,\n                    title: randomEvent.title,\n                    type: randomEvent.type,\n                    start_time: new Date(day.setHours(hour, 0, 0)).toISOString(),\n                    end_time: new Date(day.setHours(hour + 1, 0, 0)).toISOString(),\n                    location: randomEvent.type === 'interview' ? 'Meeting Room A' : 'Main Office',\n                    color: randomEvent.color\n                });\n            }\n        });\n\n        return mockEvents;\n    }\n\n    function getEventsForDate(date: Date): CalendarEvent[] {\n        return events.filter(event => isSameDay(parseISO(event.start_time), date));\n    }\n\n    function getEventTypeIcon(type: string) {\n        switch (type) {\n            case 'interview': return <Users className=\"w-4 h-4\" />;\n            case 'meeting': return <Video className=\"w-4 h-4\" />;\n            case 'training': return <CalendarIcon className=\"w-4 h-4\" />;\n            case 'review': return <Clock className=\"w-4 h-4\" />;\n            default: return <CalendarIcon className=\"w-4 h-4\" />;\n        }\n    }\n\n    const monthStart = startOfMonth(currentMonth);\n    const monthEnd = endOfMonth(currentMonth);\n    const calendarDays = eachDayOfInterval({ start: monthStart, end: monthEnd });\n\n    // Pad the start to begin on Monday\n    const startDay = monthStart.getDay();\n    const paddingDays = startDay === 0 ? 6 : startDay - 1;\n\n    return (\n        <div className=\"bg-white rounded-xl border border-gray-200 overflow-hidden\">\n            {/* Header */}\n            <div className=\"px-6 py-4 border-b border-gray-200 flex items-center justify-between\">\n                <div className=\"flex items-center space-x-4\">\n                    <button\n                        onClick={() => setCurrentMonth(subMonths(currentMonth, 1))}\n                        className=\"p-2 hover:bg-gray-100 rounded-lg transition\"\n                    >\n                        <ChevronLeft className=\"w-5 h-5\" />\n                    </button>\n                    <h2 className=\"text-xl font-semibold text-gray-900\">\n                        {format(currentMonth, 'MMMM yyyy')}\n                    </h2>\n                    <button\n                        onClick={() => setCurrentMonth(addMonths(currentMonth, 1))}\n                        className=\"p-2 hover:bg-gray-100 rounded-lg transition\"\n                    >\n                        <ChevronRight className=\"w-5 h-5\" />\n                    </button>\n                </div>\n\n                <div className=\"flex items-center space-x-2\">\n                    <button\n                        onClick={() => setCurrentMonth(new Date())}\n                        className=\"px-3 py-1.5 text-sm text-indigo-600 hover:bg-indigo-50 rounded-lg transition\"\n                    >\n                        Today\n                    </button>\n                    <div className=\"flex bg-gray-100 rounded-lg p-1\">\n                        {(['month', 'week', 'day'] as const).map(v => (\n                            <button\n                                key={v}\n                                onClick={() => setView(v)}\n                                className={`px-3 py-1 text-sm rounded-md transition ${view === v ? 'bg-white shadow text-indigo-600' : 'text-gray-600'\n                                    }`}\n                            >\n                                {v.charAt(0).toUpperCase() + v.slice(1)}\n                            </button>\n                        ))}\n                    </div>\n                    <button className=\"flex items-center px-3 py-1.5 text-sm bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition\">\n                        <Plus className=\"w-4 h-4 mr-1\" />\n                        Add Event\n                    </button>\n                </div>\n            </div>\n\n            {/* Calendar Grid */}\n            <div className=\"p-4\">\n                {/* Day Headers */}\n                <div className=\"grid grid-cols-7 gap-1 mb-2\">\n                    {['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'].map(day => (\n                        <div key={day} className=\"text-center text-xs font-medium text-gray-500 py-2\">\n                            {day}\n                        </div>\n                    ))}\n                </div>\n\n                {/* Calendar Days */}\n                <div className=\"grid grid-cols-7 gap-1\">\n                    {/* Padding days */}\n                    {Array.from({ length: paddingDays }).map((_, i) => (\n                        <div key={`pad-${i}`} className=\"h-24 bg-gray-50 rounded-lg\" />\n                    ))}\n\n                    {/* Actual days */}\n                    {calendarDays.map((day, index) => {\n                        const dayEvents = getEventsForDate(day);\n                        const isCurrentDay = isToday(day);\n                        const isSelected = selectedDate && isSameDay(day, selectedDate);\n\n                        return (\n                            <div\n                                key={index}\n                                onClick={() => setSelectedDate(day)}\n                                className={`h-24 p-1 rounded-lg border cursor-pointer transition ${isCurrentDay\n                                    ? 'border-indigo-500 bg-indigo-50'\n                                    : isSelected\n                                        ? 'border-indigo-300 bg-indigo-25'\n                                        : 'border-gray-100 hover:border-gray-300'\n                                    }`}\n                            >\n                                <div className={`text-sm font-medium mb-1 ${isCurrentDay ? 'text-indigo-600' : 'text-gray-700'\n                                    }`}>\n                                    {format(day, 'd')}\n                                </div>\n                                <div className=\"space-y-0.5 overflow-hidden\">\n                                    {dayEvents.slice(0, 2).map(event => (\n                                        <div\n                                            key={event.id}\n                                            onClick={(e) => {\n                                                e.stopPropagation();\n                                                setSelectedEvent(event);\n                                            }}\n                                            className=\"text-xs px-1 py-0.5 rounded truncate text-white\"\n                                            style={{ backgroundColor: event.color }}\n                                        >\n                                            {format(parseISO(event.start_time), 'HH:mm')} {event.title}\n                                        </div>\n                                    ))}\n                                    {dayEvents.length > 2 && (\n                                        <div className=\"text-xs text-gray-500 px-1\">\n                                            +{dayEvents.length - 2} more\n                                        </div>\n                                    )}\n                                </div>\n                            </div>\n                        );\n                    })}\n                </div>\n            </div>\n\n            {/* Event Legend */}\n            <div className=\"px-6 py-3 border-t border-gray-200 flex flex-wrap gap-4 text-xs\">\n                <div className=\"flex items-center gap-1\">\n                    <div className=\"w-3 h-3 rounded\" style={{ backgroundColor: '#8B5CF6' }} />\n                    <span className=\"text-gray-600\">Interview</span>\n                </div>\n                <div className=\"flex items-center gap-1\">\n                    <div className=\"w-3 h-3 rounded\" style={{ backgroundColor: '#3B82F6' }} />\n                    <span className=\"text-gray-600\">Meeting</span>\n                </div>\n                <div className=\"flex items-center gap-1\">\n                    <div className=\"w-3 h-3 rounded\" style={{ backgroundColor: '#10B981' }} />\n                    <span className=\"text-gray-600\">Training</span>\n                </div>\n                <div className=\"flex items-center gap-1\">\n                    <div className=\"w-3 h-3 rounded\" style={{ backgroundColor: '#F59E0B' }} />\n                    <span className=\"text-gray-600\">Review</span>\n                </div>\n                <div className=\"flex items-center gap-1\">\n                    <div className=\"w-3 h-3 rounded\" style={{ backgroundColor: '#EF4444' }} />\n                    <span className=\"text-gray-600\">Leave</span>\n                </div>\n            </div>\n\n            {/* Event Details Modal */}\n            {selectedEvent && (\n                <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n                    <div className=\"bg-white rounded-xl max-w-md w-full\">\n                        <div className=\"p-6 border-b border-gray-200\">\n                            <div className=\"flex items-center justify-between\">\n                                <div className=\"flex items-center space-x-3\">\n                                    <div\n                                        className=\"p-2 rounded-lg text-white\"\n                                        style={{ backgroundColor: selectedEvent.color }}\n                                    >\n                                        {getEventTypeIcon(selectedEvent.type)}\n                                    </div>\n                                    <div>\n                                        <h3 className=\"font-semibold text-gray-900\">{selectedEvent.title}</h3>\n                                        <p className=\"text-sm text-gray-500 capitalize\">{selectedEvent.type}</p>\n                                    </div>\n                                </div>\n                                <button\n                                    onClick={() => setSelectedEvent(null)}\n                                    className=\"p-2 text-gray-400 hover:text-gray-600 transition\"\n                                >\n                                    <X className=\"w-5 h-5\" />\n                                </button>\n                            </div>\n                        </div>\n                        <div className=\"p-6 space-y-4\">\n                            <div className=\"flex items-center space-x-3 text-sm\">\n                                <Clock className=\"w-4 h-4 text-gray-400\" />\n                                <span className=\"text-gray-700\">\n                                    {format(parseISO(selectedEvent.start_time), 'EEEE, MMMM d, yyyy')}\n                                    <br />\n                                    {format(parseISO(selectedEvent.start_time), 'HH:mm')} - {format(parseISO(selectedEvent.end_time), 'HH:mm')}\n                                </span>\n                            </div>\n                            {selectedEvent.location && (\n                                <div className=\"flex items-center space-x-3 text-sm\">\n                                    <MapPin className=\"w-4 h-4 text-gray-400\" />\n                                    <span className=\"text-gray-700\">{selectedEvent.location}</span>\n                                </div>\n                            )}\n                            {selectedEvent.description && (\n                                <div className=\"text-sm text-gray-600 pt-2 border-t border-gray-100\">\n                                    {selectedEvent.description}\n                                </div>\n                            )}\n                        </div>\n                        <div className=\"px-6 py-4 bg-gray-50 flex justify-end space-x-2\">\n                            <button\n                                onClick={() => setSelectedEvent(null)}\n                                className=\"px-4 py-2 text-sm text-gray-700 hover:bg-gray-200 rounded-lg transition\"\n                            >\n                                Close\n                            </button>\n                            <button className=\"px-4 py-2 text-sm bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition\">\n                                Edit Event\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* Selected Date Events */}\n            {selectedDate && (\n                <div className=\"px-6 py-4 border-t border-gray-200\">\n                    <h4 className=\"font-medium text-gray-900 mb-3\">\n                        Events for {format(selectedDate, 'MMMM d, yyyy')}\n                    </h4>\n                    <div className=\"space-y-2\">\n                        {getEventsForDate(selectedDate).length === 0 ? (\n                            <p className=\"text-sm text-gray-500\">No events scheduled</p>\n                        ) : (\n                            getEventsForDate(selectedDate).map(event => (\n                                <div\n                                    key={event.id}\n                                    onClick={() => setSelectedEvent(event)}\n                                    className=\"flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer transition\"\n                                >\n                                    <div\n                                        className=\"w-1 h-10 rounded-full mr-3\"\n                                        style={{ backgroundColor: event.color }}\n                                    />\n                                    <div className=\"flex-1\">\n                                        <p className=\"text-sm font-medium text-gray-900\">{event.title}</p>\n                                        <p className=\"text-xs text-gray-500\">\n                                            {format(parseISO(event.start_time), 'HH:mm')} - {format(parseISO(event.end_time), 'HH:mm')}\n                                            {event.location && ` â¢ ${event.location}`}\n                                        </p>\n                                    </div>\n                                </div>\n                            ))\n                        )}\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/ExecutiveDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LineChart' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Line' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":14,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertTriangle' is defined but never used. Allowed unused vars must match /^_/u.","line":65,"column":69,"nodeType":null,"messageId":"unusedVar","endLine":65,"endColumn":82},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadDashboardData'. Either include it or remove the dependency array.","line":83,"column":6,"nodeType":"ArrayExpression","endLine":83,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadDashboardData]","fix":{"range":[2324,2326],"text":"[loadDashboardData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport * as Recharts from 'recharts';\n\n// Re-export the components we need with proper typing\nconst {\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  ResponsiveContainer,\n  LineChart,\n  Line,\n  PieChart,\n  Pie,\n  Cell,\n  Legend,\n} = Recharts;\n\n// Custom Tooltip component with proper typing\ninterface CustomTooltipProps {\n  active?: boolean;\n  payload?: Array<{\n    value: any;\n    name: string;\n    payload: any;\n    color: string;\n    dataKey: string;\n  }>;\n  label?: string;\n  formatter?: (value: any, name: string) => [string, string];\n}\n\nconst CustomTooltip: React.FC<CustomTooltipProps> = ({\n  active,\n  payload,\n  label,\n  formatter,\n}) => {\n  if (active && payload && payload.length) {\n    return (\n      <div className=\"bg-white p-4 border border-gray-200 rounded-lg shadow-lg\">\n        <p className=\"font-semibold\">{label}</p>\n        {payload.map((entry, index) => {\n          if (formatter) {\n            const [value, name] = formatter(entry.value, entry.name);\n            return (\n              <p key={`tooltip-${index}`} style={{ color: entry.color }}>\n                {name}: {value}\n              </p>\n            );\n          }\n          return (\n            <p key={`tooltip-${index}`} style={{ color: entry.color }}>\n              {entry.name}: {entry.value}\n            </p>\n          );\n        })}\n      </div>\n    );\n  }\n  return null;\n};\nimport { TrendingUp, TrendingDown, Users, Clock, DollarSign, Brain, AlertTriangle, CheckCircle, Target, Zap } from 'lucide-react';\nimport { log } from '../lib/logger';\nimport { analyticsEngine } from '../lib/analyticsEngine';\nimport { workflowEngine } from '../lib/workflowEngine';\n\nexport default function ExecutiveDashboard() {\n  const [dashboardData, setDashboardData] = useState<any>(null);\n  const [realTimeMetrics, setRealTimeMetrics] = useState<any>(null);\n  const [workflowStats, setWorkflowStats] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n  const [activeTab, setActiveTab] = useState<'overview' | 'recruitment' | 'workforce' | 'performance'>('overview');\n\n  useEffect(() => {\n    loadDashboardData();\n\n    // Real-time updates every 30 seconds\n    const interval = setInterval(loadRealTimeData, 30000);\n    return () => clearInterval(interval);\n  }, []);\n\n  const loadDashboardData = async () => {\n    try {\n      const data = await analyticsEngine.generateExecutiveDashboard();\n      const workflow = workflowEngine.getWorkflowAnalytics();\n\n      setDashboardData(data);\n      setWorkflowStats(workflow);\n      await loadRealTimeData();\n    } catch (error) {\n      log.error('Failed to load dashboard data', error, { component: 'ExecutiveDashboard', action: 'loadDashboardData' });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const loadRealTimeData = async () => {\n    try {\n      const metrics = await analyticsEngine.getRealTimeMetrics();\n      setRealTimeMetrics(metrics);\n    } catch (error) {\n      log.error('Failed to load real-time metrics', error, { component: 'ExecutiveDashboard', action: 'loadRealTimeData' });\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4\"></div>\n          <p className=\"text-gray-600\">Loading Executive Intelligence...</p>\n        </div>\n      </div>\n    );\n  }\n\n  const MetricCard = ({ title, value, change, icon: Icon, trend, subtitle }: any) => (\n    <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <p className=\"text-sm font-medium text-gray-600\">{title}</p>\n          <p className=\"text-2xl font-bold text-gray-900 mt-1\">{value}</p>\n          {subtitle && <p className=\"text-xs text-gray-500 mt-1\">{subtitle}</p>}\n        </div>\n        <div className={`p-3 rounded-full ${trend === 'up' ? 'bg-green-100' : trend === 'down' ? 'bg-red-100' : 'bg-blue-100'}`}>\n          <Icon className={`w-6 h-6 ${trend === 'up' ? 'text-green-600' : trend === 'down' ? 'text-red-600' : 'text-blue-600'}`} />\n        </div>\n      </div>\n      {change && (\n        <div className={`flex items-center mt-3 text-sm ${change > 0 ? 'text-green-600' : 'text-red-600'}`}>\n          {change > 0 ? <TrendingUp className=\"w-4 h-4 mr-1\" /> : <TrendingDown className=\"w-4 h-4 mr-1\" />}\n          <span>{Math.abs(change)}% from last month</span>\n        </div>\n      )}\n    </div>\n  );\n\n  const COLORS = ['#4F46E5', '#06B6D4', '#10B981', '#F59E0B', '#EF4444'];\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <div className=\"bg-white border-b border-gray-200 px-6 py-4\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-2xl font-bold text-gray-900\">ð Executive HR Intelligence</h1>\n            <p className=\"text-gray-600 mt-1\">Real-time insights and predictive analytics</p>\n          </div>\n          {realTimeMetrics && (\n            <div className=\"flex items-center gap-4 text-sm\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\"></div>\n                <span className=\"text-gray-600\">Live Data</span>\n              </div>\n              <div className=\"text-orange-600 font-medium\">{realTimeMetrics.top_alert}</div>\n            </div>\n          )}\n        </div>\n\n        {/* Tab Navigation */}\n        <div className=\"flex space-x-6 mt-4\">\n          {[\n            { id: 'overview', label: 'ð Overview', icon: BarChart },\n            { id: 'recruitment', label: 'ð¯ Recruitment', icon: Users },\n            { id: 'workforce', label: 'ð® Workforce Planning', icon: Target },\n            { id: 'performance', label: 'â¡ Performance', icon: Zap }\n          ].map(tab => (\n            <button\n              key={tab.id}\n              onClick={() => setActiveTab(tab.id as any)}\n              className={`px-4 py-2 rounded-lg font-medium transition ${activeTab === tab.id\n                ? 'bg-indigo-100 text-indigo-700 border border-indigo-200'\n                : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'\n                }`}\n            >\n              {tab.label}\n            </button>\n          ))}\n        </div>\n      </div>\n\n      <div className=\"p-6\">\n        {/* Real-time Metrics Bar */}\n        {realTimeMetrics && (\n          <div className=\"grid grid-cols-6 gap-4 mb-6\">\n            <MetricCard\n              title=\"Active Jobs\"\n              value={realTimeMetrics.active_jobs}\n              icon={Target}\n              trend=\"neutral\"\n            />\n            <MetricCard\n              title=\"Pending Interviews\"\n              value={realTimeMetrics.pending_interviews}\n              icon={Clock}\n              trend=\"neutral\"\n            />\n            <MetricCard\n              title=\"Applications Today\"\n              value={realTimeMetrics.applications_today}\n              icon={Users}\n              trend=\"up\"\n            />\n            <MetricCard\n              title=\"Offers Pending\"\n              value={realTimeMetrics.offers_pending}\n              icon={CheckCircle}\n              trend=\"neutral\"\n            />\n            <MetricCard\n              title=\"Hours Saved Today\"\n              value={realTimeMetrics.automation_savings_today}\n              icon={Zap}\n              trend=\"up\"\n              subtitle=\"From automation\"\n            />\n            <MetricCard\n              title=\"Workflow Automations\"\n              value={workflowStats?.active_rules || 0}\n              icon={Brain}\n              trend=\"up\"\n              subtitle={`${workflowStats?.automations_today || 0} executed today`}\n            />\n          </div>\n        )}\n\n        {/* Tab Content */}\n        {activeTab === 'overview' && dashboardData && (\n          <div className=\"space-y-6\">\n            {/* Key Metrics */}\n            <div className=\"grid grid-cols-4 gap-6\">\n              <MetricCard\n                title=\"Average Time to Hire\"\n                value={`${dashboardData.metrics.timeToHire.average_days} days`}\n                change={-8}\n                icon={Clock}\n                trend=\"up\"\n              />\n              <MetricCard\n                title=\"Cost per Hire\"\n                value={`$${dashboardData.metrics.costPerHire.average_cost.toLocaleString()}`}\n                change={-12}\n                icon={DollarSign}\n                trend=\"up\"\n              />\n              <MetricCard\n                title=\"Employee Retention\"\n                value={`${dashboardData.metrics.employeeRetention.overall_rate}%`}\n                change={3}\n                icon={Users}\n                trend=\"up\"\n              />\n              <MetricCard\n                title=\"ROI on Hiring\"\n                value={`${dashboardData.metrics.costPerHire.roi_analysis.roi_percentage}%`}\n                change={15}\n                icon={TrendingUp}\n                trend=\"up\"\n              />\n            </div>\n\n            {/* AI Recommendations */}\n            <div className=\"bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl p-6 text-white\">\n              <div className=\"flex items-center mb-4\">\n                <Brain className=\"w-6 h-6 mr-2\" />\n                <h3 className=\"text-xl font-bold\">ð¤ AI Recommendations</h3>\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                {dashboardData.recommendations.slice(0, 4).map((rec: string, index: number) => (\n                  <div key={index} className=\"bg-white/10 rounded-lg p-3\">\n                    <p className=\"text-sm\">{rec}</p>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            {/* Charts Row */}\n            <div className=\"grid grid-cols-2 gap-6\">\n              {/* Time to Hire by Department */}\n              <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Time to Hire by Department</h3>\n                <ResponsiveContainer width=\"100%\" height={200}>\n                  <BarChart data={dashboardData.metrics.timeToHire.by_department}>\n                    <CartesianGrid strokeDasharray=\"3 3\" />\n                    <XAxis dataKey=\"department\" />\n                    <YAxis />\n                    <Tooltip content={<CustomTooltip />} />\n                    <Bar dataKey=\"days\" fill=\"#4F46E5\" />\n                  </BarChart>\n                </ResponsiveContainer>\n              </div>\n\n              {/* Recruitment Source Effectiveness */}\n              <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Recruitment Source ROI</h3>\n                <ResponsiveContainer width=\"100%\" height={200}>\n                  <PieChart>\n                    <Pie\n                      data={dashboardData.metrics.recruitmentEfficiency.source_effectiveness}\n                      cx=\"50%\"\n                      cy=\"50%\"\n                      outerRadius={80}\n                      dataKey=\"hire_rate\"\n                      nameKey=\"source\"\n                      label={({ name, percent }) => `${name}: ${(percent * 100).toFixed(0)}%`}\n                    >\n                      {dashboardData.metrics.recruitmentEfficiency.source_effectiveness.map((entry: any, index: number) => (\n                        <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                      ))}\n                    </Pie>\n                    <Tooltip content={<CustomTooltip />} />\n                    <Legend />\n                  </PieChart>\n                </ResponsiveContainer>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {activeTab === 'recruitment' && dashboardData && (\n          <div className=\"space-y-6\">\n            {/* Recruitment Funnel */}\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">ð¯ Recruitment Funnel Optimization</h3>\n              <div className=\"grid grid-cols-4 gap-4\">\n                <div className=\"text-center\">\n                  <div className=\"w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-2\">\n                    <span className=\"text-2xl font-bold text-blue-600\">240</span>\n                  </div>\n                  <p className=\"text-sm text-gray-600\">Applications</p>\n                </div>\n                <div className=\"text-center\">\n                  <div className=\"w-20 h-20 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-2\">\n                    <span className=\"text-2xl font-bold text-indigo-600\">48</span>\n                  </div>\n                  <p className=\"text-sm text-gray-600\">Interviews</p>\n                  <p className=\"text-xs text-green-600\">20% rate</p>\n                </div>\n                <div className=\"text-center\">\n                  <div className=\"w-20 h-20 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-2\">\n                    <span className=\"text-2xl font-bold text-purple-600\">15</span>\n                  </div>\n                  <p className=\"text-sm text-gray-600\">Offers</p>\n                  <p className=\"text-xs text-green-600\">31% rate</p>\n                </div>\n                <div className=\"text-center\">\n                  <div className=\"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-2\">\n                    <span className=\"text-2xl font-bold text-green-600\">12</span>\n                  </div>\n                  <p className=\"text-sm text-gray-600\">Hires</p>\n                  <p className=\"text-xs text-green-600\">80% acceptance</p>\n                </div>\n              </div>\n            </div>\n\n            {/* Source Performance */}\n            <div className=\"grid grid-cols-2 gap-6\">\n              <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Best Performing Sources</h3>\n                <div className=\"space-y-3\">\n                  {dashboardData.metrics.recruitmentEfficiency.source_effectiveness\n                    .sort((a: any, b: any) => b.hire_rate - a.hire_rate)\n                    .map((source: any, index: number) => (\n                      <div key={index} className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"font-medium text-gray-900\">{source.source}</p>\n                          <p className=\"text-sm text-gray-600\">Cost per hire: ${source.cost}</p>\n                        </div>\n                        <div className=\"text-right\">\n                          <p className=\"text-lg font-bold text-green-600\">{(source.hire_rate * 100).toFixed(1)}%</p>\n                          <p className=\"text-xs text-gray-500\">Hire rate</p>\n                        </div>\n                      </div>\n                    ))}\n                </div>\n              </div>\n\n              <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Performance Predictors</h3>\n                <div className=\"space-y-4\">\n                  {dashboardData.insights.top_performer_traits.map((trait: any, index: number) => (\n                    <div key={index}>\n                      <div className=\"flex justify-between items-center mb-1\">\n                        <span className=\"text-sm font-medium text-gray-700\">{trait.trait}</span>\n                        <span className=\"text-sm text-green-600\">{(trait.correlation_strength * 100).toFixed(0)}%</span>\n                      </div>\n                      <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                        <div\n                          className=\"bg-green-500 h-2 rounded-full\"\n                          style={{ width: `${trait.correlation_strength * 100}%` }}\n                        ></div>\n                      </div>\n                      <p className=\"text-xs text-gray-500 mt-1\">{trait.description}</p>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {activeTab === 'workforce' && dashboardData && (\n          <div className=\"space-y-6\">\n            {/* Hiring Forecast */}\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">ð® Hiring Forecast</h3>\n              <div className=\"grid grid-cols-3 gap-4\">\n                {dashboardData.forecast.hiring_needs.map((dept: any, index: number) => (\n                  <div key={index} className=\"border border-gray-200 rounded-lg p-4\">\n                    <h4 className=\"font-medium text-gray-900\">{dept.department}</h4>\n                    <p className=\"text-2xl font-bold text-indigo-600 mt-2\">{dept.projected_need}</p>\n                    <p className=\"text-sm text-gray-600\">New hires needed</p>\n                    <p className=\"text-xs text-gray-500 mt-1\">{dept.timeline}</p>\n                    <div className=\"mt-2\">\n                      <div className={`inline-flex px-2 py-1 rounded-full text-xs font-medium ${dept.confidence > 0.8 ? 'bg-green-100 text-green-800' :\n                        dept.confidence > 0.6 ? 'bg-yellow-100 text-yellow-800' :\n                          'bg-red-100 text-red-800'\n                        }`}>\n                        {(dept.confidence * 100).toFixed(0)}% confidence\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            {/* Skill Gaps */}\n            <div className=\"grid grid-cols-2 gap-6\">\n              <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Critical Skill Gaps</h3>\n                <div className=\"space-y-4\">\n                  {dashboardData.forecast.skill_gaps.map((gap: any, index: number) => (\n                    <div key={index} className=\"border-l-4 border-orange-500 pl-4\">\n                      <div className=\"flex justify-between items-start\">\n                        <div>\n                          <h4 className=\"font-medium text-gray-900\">{gap.skill}</h4>\n                          <p className=\"text-sm text-gray-600\">{gap.training_recommendation}</p>\n                        </div>\n                        <div className={`px-2 py-1 rounded text-xs font-medium ${gap.gap_severity === 'critical' ? 'bg-red-100 text-red-800' :\n                          gap.gap_severity === 'high' ? 'bg-orange-100 text-orange-800' :\n                            gap.gap_severity === 'medium' ? 'bg-yellow-100 text-yellow-800' :\n                              'bg-green-100 text-green-800'\n                          }`}>\n                          {gap.gap_severity}\n                        </div>\n                      </div>\n                      <div className=\"mt-2\">\n                        <div className=\"flex justify-between text-xs text-gray-500 mb-1\">\n                          <span>Current: {gap.current_level}/10</span>\n                          <span>Required: {gap.required_level}/10</span>\n                        </div>\n                        <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                          <div\n                            className=\"bg-orange-500 h-2 rounded-full\"\n                            style={{ width: `${(gap.current_level / gap.required_level) * 100}%` }}\n                          ></div>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n\n              <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Budget Impact</h3>\n                <div className=\"space-y-4\">\n                  <div>\n                    <p className=\"text-sm text-gray-600\">Current Annual Cost</p>\n                    <p className=\"text-2xl font-bold text-gray-900\">\n                      ${dashboardData.forecast.budget_projection.current_cost.toLocaleString()}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-gray-600\">Projected Cost (with growth)</p>\n                    <p className=\"text-2xl font-bold text-blue-600\">\n                      ${dashboardData.forecast.budget_projection.projected_cost.toLocaleString()}\n                    </p>\n                  </div>\n\n                  <div className=\"border-t pt-4\">\n                    <h4 className=\"font-medium text-gray-900 mb-2\">ð¡ Savings Opportunities</h4>\n                    {dashboardData.forecast.budget_projection.savings_opportunities.map((opp: any, index: number) => (\n                      <div key={index} className=\"flex justify-between items-center py-2\">\n                        <span className=\"text-sm text-gray-600\">{opp.area}</span>\n                        <span className=\"text-sm font-medium text-green-600\">\n                          ${opp.potential_savings.toLocaleString()}\n                        </span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {activeTab === 'performance' && dashboardData && (\n          <div className=\"space-y-6\">\n            {/* Turnover Risk */}\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">â ï¸ Turnover Risk Alert</h3>\n              <div className=\"space-y-3\">\n                {dashboardData.metrics.employeeRetention.predicted_turnover.map((risk: any, index: number) => (\n                  <div key={index} className=\"flex items-center justify-between p-3 border border-orange-200 rounded-lg bg-orange-50\">\n                    <div>\n                      <p className=\"font-medium text-gray-900\">Employee #{risk.employee_id}</p>\n                      <p className=\"text-sm text-gray-600\">Risk factors: {risk.factors.join(', ')}</p>\n                    </div>\n                    <div className=\"text-right\">\n                      <div className={`px-3 py-1 rounded-full text-sm font-medium ${risk.risk_score > 0.7 ? 'bg-red-100 text-red-800' :\n                        risk.risk_score > 0.4 ? 'bg-orange-100 text-orange-800' :\n                          'bg-yellow-100 text-yellow-800'\n                        }`}>\n                        {(risk.risk_score * 100).toFixed(0)}% risk\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            {/* Engagement Factors */}\n            <div className=\"grid grid-cols-2 gap-6\">\n              <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">ð¯ Engagement Drivers</h3>\n                <div className=\"space-y-4\">\n                  {dashboardData.insights.engagement_factors.map((factor: any, index: number) => (\n                    <div key={index}>\n                      <div className=\"flex justify-between items-center mb-2\">\n                        <h4 className=\"font-medium text-gray-900\">{factor.factor}</h4>\n                        <span className=\"text-lg font-bold text-indigo-600\">{factor.impact_score}</span>\n                      </div>\n                      <div className=\"text-sm text-gray-600 space-y-1\">\n                        {factor.actionable_insights.map((insight: string, i: number) => (\n                          <div key={i} className=\"flex items-center\">\n                            <div className=\"w-2 h-2 bg-indigo-400 rounded-full mr-2\"></div>\n                            {insight}\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n\n              <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">ð Retention by Department</h3>\n                <ResponsiveContainer width=\"100%\" height={200}>\n                  <BarChart data={dashboardData.metrics.retentionRates.by_department}>\n                    <CartesianGrid strokeDasharray=\"3 3\" />\n                    <XAxis dataKey=\"department\" />\n                    <YAxis />\n                    <Tooltip\n                      content={<CustomTooltip formatter={(value: any) => [`${value}%`, 'Retention Rate']} />}\n                    />\n                    <Bar dataKey=\"rate\" fill=\"#10B981\" />\n                  </BarChart>\n                </ResponsiveContainer>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/ExportButton.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":69,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":70},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ExportOptions' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":24},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":244,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":244,"endColumn":28},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":268,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":268,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Download, FileSpreadsheet, FileText, File, Loader2, Check, X } from 'lucide-react';\nimport { log } from '@/lib/logger';\n\ninterface ExportOptions {\n    format: 'csv' | 'xlsx' | 'pdf' | 'json';\n    dateRange?: { start: Date; end: Date };\n    filters?: Record<string, any>;\n    columns?: string[];\n}\n\ninterface ExportButtonProps {\n    data: any[];\n    filename: string;\n    columns?: { key: string; label: string }[];\n    title?: string;\n    onExport?: (format: string) => void;\n    className?: string;\n}\n\nexport function ExportButton({ data, filename, columns, title, onExport, className = '' }: ExportButtonProps) {\n    const [isOpen, setIsOpen] = useState(false);\n    const [exporting, setExporting] = useState<string | null>(null);\n    const [success, setSuccess] = useState<string | null>(null);\n\n    const formatOptions = [\n        { value: 'csv', label: 'CSV', icon: <FileSpreadsheet className=\"w-4 h-4\" />, description: 'Comma separated values' },\n        { value: 'xlsx', label: 'Excel', icon: <FileSpreadsheet className=\"w-4 h-4\" />, description: 'Microsoft Excel format' },\n        { value: 'pdf', label: 'PDF', icon: <FileText className=\"w-4 h-4\" />, description: 'Portable document format' },\n        { value: 'json', label: 'JSON', icon: <File className=\"w-4 h-4\" />, description: 'JavaScript Object Notation' },\n    ];\n\n    async function handleExport(format: string) {\n        setExporting(format);\n\n        try {\n            const exportColumns = columns || Object.keys(data[0] || {}).map(key => ({ key, label: key }));\n\n            switch (format) {\n                case 'csv':\n                    exportToCSV(data, exportColumns, filename);\n                    break;\n                case 'xlsx':\n                    await exportToExcel(data, exportColumns, filename, title);\n                    break;\n                case 'pdf':\n                    await exportToPDF(data, exportColumns, filename, title);\n                    break;\n                case 'json':\n                    exportToJSON(data, filename);\n                    break;\n            }\n\n            setSuccess(format);\n            setTimeout(() => setSuccess(null), 2000);\n            onExport?.(format);\n        } catch (error) {\n            log.error('Export error', error, { component: 'ExportButton', action: 'handleExport', metadata: { format, filename } });\n            alert('Export failed. Please try again.');\n        } finally {\n            setExporting(null);\n        }\n    }\n\n    function exportToCSV(data: any[], columns: { key: string; label: string }[], filename: string) {\n        const headers = columns.map(col => col.label).join(',');\n        const rows = data.map(row =>\n            columns.map(col => {\n                const value = row[col.key];\n                // Escape quotes and wrap in quotes if contains comma\n                if (typeof value === 'string' && (value.includes(',') || value.includes('\"'))) {\n                    return `\"${value.replace(/\"/g, '\"\"')}\"`;\n                }\n                return value ?? '';\n            }).join(',')\n        );\n\n        const csv = [headers, ...rows].join('\\n');\n        downloadFile(csv, `${filename}.csv`, 'text/csv');\n    }\n\n    async function exportToExcel(data: any[], columns: { key: string; label: string }[], filename: string, title?: string) {\n        // Simple Excel XML format (works without external libraries)\n        const worksheetName = title || 'Data';\n\n        let xml = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<?mso-application progid=\"Excel.Sheet\"?>\n<Workbook xmlns=\"urn:schemas-microsoft-com:office:spreadsheet\"\n  xmlns:o=\"urn:schemas-microsoft-com:office:office\"\n  xmlns:x=\"urn:schemas-microsoft-com:office:excel\"\n  xmlns:ss=\"urn:schemas-microsoft-com:office:spreadsheet\">\n  <Worksheet ss:Name=\"${worksheetName}\">\n    <Table>\n      <Row>`;\n\n        // Headers\n        columns.forEach(col => {\n            xml += `<Cell><Data ss:Type=\"String\">${escapeXml(col.label)}</Data></Cell>`;\n        });\n        xml += '</Row>';\n\n        // Data rows\n        data.forEach(row => {\n            xml += '<Row>';\n            columns.forEach(col => {\n                const value = row[col.key];\n                const type = typeof value === 'number' ? 'Number' : 'String';\n                xml += `<Cell><Data ss:Type=\"${type}\">${escapeXml(String(value ?? ''))}</Data></Cell>`;\n            });\n            xml += '</Row>';\n        });\n\n        xml += '</Table></Worksheet></Workbook>';\n\n        downloadFile(xml, `${filename}.xls`, 'application/vnd.ms-excel');\n    }\n\n    async function exportToPDF(data: any[], columns: { key: string; label: string }[], filename: string, title?: string) {\n        // Generate HTML table and use browser print to PDF\n        const html = `\n<!DOCTYPE html>\n<html>\n<head>\n  <title>${title || filename}</title>\n  <style>\n    body { font-family: Arial, sans-serif; padding: 20px; }\n    h1 { color: #333; margin-bottom: 20px; }\n    table { width: 100%; border-collapse: collapse; margin-top: 20px; }\n    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 12px; }\n    th { background-color: #4F46E5; color: white; }\n    tr:nth-child(even) { background-color: #f9f9f9; }\n    .footer { margin-top: 20px; font-size: 10px; color: #666; }\n  </style>\n</head>\n<body>\n  <h1>${title || filename}</h1>\n  <p>Generated on ${new Date().toLocaleString()}</p>\n  <table>\n    <thead>\n      <tr>${columns.map(col => `<th>${col.label}</th>`).join('')}</tr>\n    </thead>\n    <tbody>\n      ${data.map(row => `\n        <tr>${columns.map(col => `<td>${row[col.key] ?? ''}</td>`).join('')}</tr>\n      `).join('')}\n    </tbody>\n  </table>\n  <div class=\"footer\">\n    <p>Total records: ${data.length}</p>\n    <p>Report generated by NovumFlow HR Platform</p>\n  </div>\n</body>\n</html>`;\n\n        // Open in new window for printing\n        const printWindow = window.open('', '_blank');\n        if (printWindow) {\n            printWindow.document.write(html);\n            printWindow.document.close();\n            printWindow.focus();\n            setTimeout(() => {\n                printWindow.print();\n            }, 250);\n        }\n    }\n\n    function exportToJSON(data: any[], filename: string) {\n        const json = JSON.stringify(data, null, 2);\n        downloadFile(json, `${filename}.json`, 'application/json');\n    }\n\n    function downloadFile(content: string, filename: string, mimeType: string) {\n        const blob = new Blob([content], { type: mimeType });\n        const url = URL.createObjectURL(blob);\n        const link = document.createElement('a');\n        link.href = url;\n        link.download = filename;\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n        URL.revokeObjectURL(url);\n    }\n\n    function escapeXml(text: string): string {\n        return text\n            .replace(/&/g, '&amp;')\n            .replace(/</g, '&lt;')\n            .replace(/>/g, '&gt;')\n            .replace(/\"/g, '&quot;')\n            .replace(/'/g, '&apos;');\n    }\n\n    return (\n        <div className=\"relative\">\n            <button\n                onClick={() => setIsOpen(!isOpen)}\n                className={`inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition ${className}`}\n            >\n                <Download className=\"w-4 h-4 mr-2\" />\n                Export\n            </button>\n\n            {isOpen && (\n                <>\n                    <div className=\"fixed inset-0 z-40\" onClick={() => setIsOpen(false)} />\n                    <div className=\"absolute right-0 mt-2 w-64 bg-white rounded-xl shadow-xl border border-gray-200 z-50 overflow-hidden\">\n                        <div className=\"px-4 py-3 bg-gray-50 border-b border-gray-100\">\n                            <p className=\"text-sm font-medium text-gray-900\">Export Data</p>\n                            <p className=\"text-xs text-gray-500\">{data.length} records</p>\n                        </div>\n                        <div className=\"py-2\">\n                            {formatOptions.map(option => (\n                                <button\n                                    key={option.value}\n                                    onClick={() => handleExport(option.value)}\n                                    disabled={exporting !== null}\n                                    className=\"w-full flex items-center px-4 py-3 hover:bg-gray-50 transition disabled:opacity-50\"\n                                >\n                                    <div className={`p-2 rounded-lg ${success === option.value ? 'bg-green-100 text-green-600' : 'bg-gray-100 text-gray-600'\n                                        }`}>\n                                        {exporting === option.value ? (\n                                            <Loader2 className=\"w-4 h-4 animate-spin\" />\n                                        ) : success === option.value ? (\n                                            <Check className=\"w-4 h-4\" />\n                                        ) : (\n                                            option.icon\n                                        )}\n                                    </div>\n                                    <div className=\"ml-3 text-left\">\n                                        <p className=\"text-sm font-medium text-gray-900\">{option.label}</p>\n                                        <p className=\"text-xs text-gray-500\">{option.description}</p>\n                                    </div>\n                                </button>\n                            ))}\n                        </div>\n                    </div>\n                </>\n            )}\n        </div>\n    );\n}\n\n// Standalone export functions for use elsewhere\nexport function downloadCSV(data: any[], columns: { key: string; label: string }[], filename: string) {\n    const headers = columns.map(col => col.label).join(',');\n    const rows = data.map(row =>\n        columns.map(col => {\n            const value = row[col.key];\n            if (typeof value === 'string' && (value.includes(',') || value.includes('\"'))) {\n                return `\"${value.replace(/\"/g, '\"\"')}\"`;\n            }\n            return value ?? '';\n        }).join(',')\n    );\n\n    const csv = [headers, ...rows].join('\\n');\n    const blob = new Blob([csv], { type: 'text/csv' });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = `${filename}.csv`;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    URL.revokeObjectURL(url);\n}\n\nexport function downloadJSON(data: any[], filename: string) {\n    const json = JSON.stringify(data, null, 2);\n    const blob = new Blob([json], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = `${filename}.json`;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    URL.revokeObjectURL(url);\n}\n\nexport default ExportButton;\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/FeatureRoute.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Navigate' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Navigate } from 'react-router-dom';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { AlertCircle } from 'lucide-react';\n\ninterface FeatureRouteProps {\n    feature: string;\n    children: React.ReactNode;\n    fallback?: React.ReactNode;\n}\n\nexport default function FeatureRoute({ feature, children, fallback }: FeatureRouteProps) {\n    const { hasFeature, loading } = useTenant();\n\n    if (loading) {\n        return (\n            <div className=\"flex items-center justify-center min-h-screen\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-600\"></div>\n            </div>\n        );\n    }\n\n    if (!hasFeature(feature)) {\n        if (fallback) {\n            return <>{fallback}</>;\n        }\n\n        return (\n            <div className=\"flex items-center justify-center min-h-screen bg-gray-50\">\n                <div className=\"max-w-md w-full bg-white rounded-lg shadow-lg p-8 text-center\">\n                    <div className=\"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-100 mb-4\">\n                        <AlertCircle className=\"h-8 w-8 text-red-600\" />\n                    </div>\n                    <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Feature Not Available</h2>\n                    <p className=\"text-gray-600 mb-6\">\n                        This feature is not included in your current subscription plan.\n                    </p>\n                    <p className=\"text-sm text-gray-500\">\n                        Contact your administrator to upgrade your plan and access this feature.\n                    </p>\n                    <button\n                        onClick={() => window.history.back()}\n                        className=\"mt-6 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-cyan-600 hover:bg-cyan-700\"\n                    >\n                        Go Back\n                    </button>\n                </div>\n            </div>\n        );\n    }\n\n    return <>{children}</>;\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/FormBuilder/FormBuilder.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/FormBuilder/FormRenderer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/FormBuilder/SignaturePad.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'hasSignature' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":11,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":24},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'value'. Either include it or remove the dependency array.","line":27,"column":8,"nodeType":"ArrayExpression","endLine":27,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [value]","fix":{"range":[877,879],"text":"[value]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useRef, useState, useEffect } from 'react';\n\ninterface SignaturePadProps {\n    value?: string;\n    onChange: (value: string) => void;\n}\n\nexport default function SignaturePad({ value, onChange }: SignaturePadProps) {\n    const canvasRef = useRef<HTMLCanvasElement>(null);\n    const [isDrawing, setIsDrawing] = useState(false);\n    const [hasSignature, setHasSignature] = useState(false);\n\n    useEffect(() => {\n        // Load initial value if present\n        if (value && canvasRef.current) {\n            const canvas = canvasRef.current;\n            const ctx = canvas.getContext('2d');\n            if (ctx) {\n                const img = new Image();\n                img.onload = () => {\n                    ctx.drawImage(img, 0, 0);\n                    setHasSignature(true);\n                };\n                img.src = value;\n            }\n        }\n    }, []);\n\n    const startDrawing = (e: React.MouseEvent<HTMLCanvasElement> | React.TouchEvent<HTMLCanvasElement>) => {\n        const canvas = canvasRef.current;\n        if (!canvas) return;\n\n        const ctx = canvas.getContext('2d');\n        if (!ctx) return;\n\n        setIsDrawing(true);\n        setHasSignature(true);\n\n        const { offsetX, offsetY } = getCoordinates(e, canvas);\n        ctx.beginPath();\n        ctx.moveTo(offsetX, offsetY);\n    };\n\n    const draw = (e: React.MouseEvent<HTMLCanvasElement> | React.TouchEvent<HTMLCanvasElement>) => {\n        if (!isDrawing) return;\n\n        const canvas = canvasRef.current;\n        if (!canvas) return;\n\n        const ctx = canvas.getContext('2d');\n        if (!ctx) return;\n\n        const { offsetX, offsetY } = getCoordinates(e, canvas);\n        ctx.lineTo(offsetX, offsetY);\n        ctx.stroke();\n    };\n\n    const stopDrawing = () => {\n        if (!isDrawing) return;\n        setIsDrawing(false);\n\n        const canvas = canvasRef.current;\n        if (canvas) {\n            onChange(canvas.toDataURL());\n        }\n    };\n\n    const getCoordinates = (e: React.MouseEvent | React.TouchEvent, canvas: HTMLCanvasElement) => {\n        let clientX, clientY;\n        if ('touches' in e) {\n            clientX = e.touches[0].clientX;\n            clientY = e.touches[0].clientY;\n        } else {\n            clientX = e.clientX;\n            clientY = e.clientY;\n        }\n\n        const rect = canvas.getBoundingClientRect();\n        return {\n            offsetX: clientX - rect.left,\n            offsetY: clientY - rect.top\n        };\n    };\n\n    const clear = () => {\n        const canvas = canvasRef.current;\n        if (canvas) {\n            const ctx = canvas.getContext('2d');\n            if (ctx) {\n                ctx.clearRect(0, 0, canvas.width, canvas.height);\n                setHasSignature(false);\n                onChange('');\n            }\n        }\n    };\n\n    return (\n        <div className=\"border border-gray-300 rounded-lg p-2 bg-white\">\n            <canvas\n                ref={canvasRef}\n                width={500}\n                height={200}\n                className=\"border border-gray-200 rounded w-full touch-none cursor-crosshair\"\n                onMouseDown={startDrawing}\n                onMouseMove={draw}\n                onMouseUp={stopDrawing}\n                onMouseLeave={stopDrawing}\n                onTouchStart={startDrawing}\n                onTouchMove={draw}\n                onTouchEnd={stopDrawing}\n            />\n            <div className=\"flex justify-end mt-2\">\n                <button\n                    type=\"button\"\n                    onClick={clear}\n                    className=\"text-sm text-red-600 hover:text-red-800\"\n                >\n                    Clear Signature\n                </button>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/GenerateLetterModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fetching' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":26,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'previewContent' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":28,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setPreviewContent' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":28,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":45},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":34,"column":8,"nodeType":"ArrayExpression","endLine":34,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [isOpen, loadData]","fix":{"range":[1131,1139],"text":"[isOpen, loadData]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'variables'. Either include it or remove the dependency array.","line":60,"column":8,"nodeType":"ArrayExpression","endLine":60,"endColumn":39,"suggestions":[{"desc":"Update the dependencies array to be: [selectedTemplateId, templates, variables]","fix":{"range":[2241,2272],"text":"[selectedTemplateId, templates, variables]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport { X, User, FileText, Send, Loader2 } from 'lucide-react';\n\ninterface GenerateLetterModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    templateId?: string;\n    onSuccess: (letter: any) => void;\n    onError: (message: string) => void;\n}\n\nexport default function GenerateLetterModal({\n    isOpen,\n    onClose,\n    templateId,\n    onSuccess,\n    onError\n}: GenerateLetterModalProps) {\n    const [employees, setEmployees] = useState<any[]>([]);\n    const [templates, setTemplates] = useState<any[]>([]);\n    const [selectedTemplateId, setSelectedTemplateId] = useState(templateId || '');\n    const [selectedEmployeeId, setSelectedEmployeeId] = useState('');\n    const [loading, setLoading] = useState(false);\n    const [fetching, setFetching] = useState(false);\n    const [variables, setVariables] = useState<Record<string, string>>({});\n    const [previewContent, setPreviewContent] = useState('');\n\n    useEffect(() => {\n        if (isOpen) {\n            loadData();\n        }\n    }, [isOpen]);\n\n    useEffect(() => {\n        if (templateId) {\n            setSelectedTemplateId(templateId);\n        }\n    }, [templateId]);\n\n    useEffect(() => {\n        // When template or employee changes, we might want to update preview or variables\n        const template = templates.find(t => t.id === selectedTemplateId);\n        if (template) {\n            // Find all {{variable}} patterns\n            const regex = /{{\\s*(\\w+)\\s*}}/g;\n            const matches = [...template.content.matchAll(regex)];\n            const vars: Record<string, string> = {};\n            matches.forEach(match => {\n                const varName = match[1];\n                // Skip system variables that are auto-filled\n                const systemVars = ['employee_name', 'employee_first_name', 'employee_last_name', 'employee_email', 'employee_number', 'position', 'department', 'current_date'];\n                if (!systemVars.includes(varName) && !variables[varName]) {\n                    vars[varName] = '';\n                }\n            });\n            setVariables(prev => ({ ...vars, ...prev }));\n        }\n    }, [selectedTemplateId, templates]);\n\n    async function loadData() {\n        setFetching(true);\n        try {\n            const { data: employeesData } = await supabase\n                .from('employees')\n                .select('id, first_name, last_name, position, department')\n                .eq('status', 'active')\n                .order('last_name');\n\n            setEmployees(employeesData || []);\n\n            if (!templateId) {\n                const { data: templatesData } = await supabase\n                    .from('letter_templates')\n                    .select('*')\n                    .eq('is_active', true)\n                    .order('template_name');\n                setTemplates(templatesData || []);\n            } else {\n                const { data: templateData } = await supabase\n                    .from('letter_templates')\n                    .select('*')\n                    .eq('id', templateId)\n                    .single();\n                if (templateData) setTemplates([templateData]);\n            }\n        } catch (error) {\n            log.error('Error loading generation data', error);\n        } finally {\n            setFetching(false);\n        }\n    }\n\n    async function handleGenerate() {\n        if (!selectedTemplateId || !selectedEmployeeId) {\n            onError('Please select both a template and an employee');\n            return;\n        }\n\n        setLoading(true);\n        try {\n            const { data, error } = await supabase.functions.invoke('letter-template-crud', {\n                body: {\n                    action: 'generate',\n                    data: {\n                        template_id: selectedTemplateId,\n                        employee_id: selectedEmployeeId,\n                        variables\n                    }\n                }\n            });\n\n            if (error) throw error;\n            if (data.error) throw new Error(data.error.message);\n\n            onSuccess(data.data);\n            onClose();\n        } catch (error: any) {\n            log.error('Letter generation failed', error);\n            onError(error.message || 'Failed to generate letter');\n        } finally {\n            setLoading(true);\n        }\n    }\n\n    if (!isOpen) return null;\n\n    return (\n        <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n            <div className=\"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0\">\n                <div className=\"fixed inset-0 transition-opacity\" onClick={onClose}>\n                    <div className=\"absolute inset-0 bg-gray-500 opacity-75\"></div>\n                </div>\n\n                <span className=\"hidden sm:inline-block sm:align-middle sm:h-screen\"></span>&#8203;\n\n                <div className=\"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full\">\n                    <div className=\"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4\">\n                        <div className=\"flex justify-between items-center mb-6\">\n                            <h3 className=\"text-xl font-bold text-gray-900 flex items-center\">\n                                <Send className=\"w-5 h-5 mr-2 text-indigo-600\" />\n                                Generate New Letter\n                            </h3>\n                            <button\n                                onClick={onClose}\n                                className=\"text-gray-400 hover:text-gray-500 transition\"\n                            >\n                                <X className=\"w-6 h-6\" />\n                            </button>\n                        </div>\n\n                        <div className=\"space-y-6\">\n                            {/* Template Selection */}\n                            {!templateId && (\n                                <div>\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Select Template</label>\n                                    <select\n                                        value={selectedTemplateId}\n                                        onChange={(e) => setSelectedTemplateId(e.target.value)}\n                                        className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none\"\n                                    >\n                                        <option value=\"\">-- Select a template --</option>\n                                        {templates.map(t => (\n                                            <option key={t.id} value={t.id}>{t.template_name}</option>\n                                        ))}\n                                    </select>\n                                </div>\n                            )}\n\n                            {/* Employee Selection */}\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Select Employee</label>\n                                <div className=\"relative\">\n                                    <User className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\n                                    <select\n                                        value={selectedEmployeeId}\n                                        onChange={(e) => setSelectedEmployeeId(e.target.value)}\n                                        className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none\"\n                                    >\n                                        <option value=\"\">-- Select an employee --</option>\n                                        {employees.map(e => (\n                                            <option key={e.id} value={e.id}>{e.first_name} {e.last_name} ({e.position})</option>\n                                        ))}\n                                    </select>\n                                </div>\n                            </div>\n\n                            {/* Dynamic Variables */}\n                            {Object.keys(variables).length > 0 && (\n                                <div className=\"bg-gray-50 p-4 rounded-lg border border-gray-200\">\n                                    <h4 className=\"text-sm font-semibold text-gray-900 mb-3 flex items-center\">\n                                        <FileText className=\"w-4 h-4 mr-2\" />\n                                        Custom Fields\n                                    </h4>\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                                        {Object.keys(variables).map(varName => (\n                                            <div key={varName}>\n                                                <label className=\"block text-xs font-medium text-gray-500 uppercase mb-1\">{varName.replace(/_/g, ' ')}</label>\n                                                <input\n                                                    type=\"text\"\n                                                    value={variables[varName]}\n                                                    onChange={(e) => setVariables({ ...variables, [varName]: e.target.value })}\n                                                    className=\"w-full px-3 py-1.5 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500 outline-none\"\n                                                    placeholder={`Enter value for ${varName}`}\n                                                />\n                                            </div>\n                                        ))}\n                                    </div>\n                                </div>\n                            )}\n                        </div>\n                    </div>\n\n                    <div className=\"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse\">\n                        <button\n                            type=\"button\"\n                            onClick={handleGenerate}\n                            disabled={loading || !selectedTemplateId || !selectedEmployeeId}\n                            className=\"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50\"\n                        >\n                            {loading ? (\n                                <>\n                                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                                    Generating...\n                                </>\n                            ) : 'Generate Letter'}\n                        </button>\n                        <button\n                            type=\"button\"\n                            onClick={onClose}\n                            className=\"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm\"\n                        >\n                            Cancel\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/GlobalSearch.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback received a function whose dependencies are unknown. Pass an inline function instead.","line":63,"column":27,"nodeType":"Identifier","endLine":63,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { Search, X, User, Briefcase, FileText, Users, Calendar, Building, Clock, ArrowRight } from 'lucide-react';\nimport { useNavigate } from 'react-router-dom';\nimport { debounce } from '@/lib/utils';\n\ninterface SearchResult {\n    id: string;\n    type: 'employee' | 'job' | 'application' | 'document' | 'candidate';\n    title: string;\n    subtitle: string;\n    url: string;\n    icon: React.ReactNode;\n    metadata?: Record<string, any>;\n}\n\nexport default function GlobalSearch() {\n    const { currentTenant } = useTenant();\n    const navigate = useNavigate();\n    const [isOpen, setIsOpen] = useState(false);\n    const [query, setQuery] = useState('');\n    const [results, setResults] = useState<SearchResult[]>([]);\n    const [loading, setLoading] = useState(false);\n    const [recentSearches, setRecentSearches] = useState<string[]>([]);\n    const [selectedIndex, setSelectedIndex] = useState(0);\n    const inputRef = useRef<HTMLInputElement>(null);\n    const resultsRef = useRef<HTMLDivElement>(null);\n\n    // Load recent searches from localStorage\n    useEffect(() => {\n        const stored = localStorage.getItem('recentSearches');\n        if (stored) {\n            setRecentSearches(JSON.parse(stored));\n        }\n    }, []);\n\n    // Keyboard shortcut to open search (Cmd/Ctrl + K)\n    useEffect(() => {\n        function handleKeyDown(e: KeyboardEvent) {\n            if ((e.metaKey || e.ctrlKey) && e.key === 'k') {\n                e.preventDefault();\n                setIsOpen(true);\n            }\n            if (e.key === 'Escape') {\n                setIsOpen(false);\n            }\n        }\n\n        document.addEventListener('keydown', handleKeyDown);\n        return () => document.removeEventListener('keydown', handleKeyDown);\n    }, []);\n\n    // Focus input when opened\n    useEffect(() => {\n        if (isOpen && inputRef.current) {\n            inputRef.current.focus();\n        }\n    }, [isOpen]);\n\n    // Debounced search function\n    const performSearch = useCallback(\n        debounce(async (searchQuery: string) => {\n            if (!searchQuery.trim() || !currentTenant) {\n                setResults([]);\n                return;\n            }\n\n            setLoading(true);\n            const searchResults: SearchResult[] = [];\n\n            try {\n                // Search employees\n                const { data: employees } = await supabase\n                    .from('employees')\n                    .select('id, first_name, last_name, email, department, position')\n                    .eq('tenant_id', currentTenant.id)\n                    .or(`first_name.ilike.%${searchQuery}%,last_name.ilike.%${searchQuery}%,email.ilike.%${searchQuery}%`)\n                    .limit(5);\n\n                if (employees) {\n                    employees.forEach(emp => {\n                        searchResults.push({\n                            id: emp.id,\n                            type: 'employee',\n                            title: `${emp.first_name} ${emp.last_name}`,\n                            subtitle: `${emp.position} - ${emp.department}`,\n                            url: `/hr?employee=${emp.id}`,\n                            icon: <User className=\"w-4 h-4 text-blue-500\" />,\n                            metadata: emp\n                        });\n                    });\n                }\n\n                // Search job postings\n                const { data: jobs } = await supabase\n                    .from('job_postings')\n                    .select('id, job_title, department, location, status')\n                    .eq('tenant_id', currentTenant.id)\n                    .ilike('job_title', `%${searchQuery}%`)\n                    .limit(5);\n\n                if (jobs) {\n                    jobs.forEach(job => {\n                        searchResults.push({\n                            id: job.id,\n                            type: 'job',\n                            title: job.job_title,\n                            subtitle: `${job.department} - ${job.location}`,\n                            url: `/recruit?job=${job.id}`,\n                            icon: <Briefcase className=\"w-4 h-4 text-green-500\" />,\n                            metadata: job\n                        });\n                    });\n                }\n\n                // Search applications\n                const { data: applications } = await supabase\n                    .from('applications')\n                    .select('id, applicant_first_name, applicant_last_name, applicant_email, status, job_posting_id')\n                    .eq('tenant_id', currentTenant.id)\n                    .or(`applicant_first_name.ilike.%${searchQuery}%,applicant_last_name.ilike.%${searchQuery}%,applicant_email.ilike.%${searchQuery}%`)\n                    .limit(5);\n\n                if (applications) {\n                    applications.forEach(app => {\n                        searchResults.push({\n                            id: app.id,\n                            type: 'application',\n                            title: `${app.applicant_first_name} ${app.applicant_last_name}`,\n                            subtitle: `Application - ${app.status}`,\n                            url: `/recruit?application=${app.id}`,\n                            icon: <Users className=\"w-4 h-4 text-purple-500\" />,\n                            metadata: app\n                        });\n                    });\n                }\n\n                // Search documents\n                const { data: documents } = await supabase\n                    .from('documents')\n                    .select('id, file_name, document_type, status')\n                    .eq('tenant_id', currentTenant.id)\n                    .ilike('file_name', `%${searchQuery}%`)\n                    .limit(5);\n\n                if (documents) {\n                    documents.forEach(doc => {\n                        searchResults.push({\n                            id: doc.id,\n                            type: 'document',\n                            title: doc.file_name,\n                            subtitle: `${doc.document_type} - ${doc.status}`,\n                            url: `/documents?doc=${doc.id}`,\n                            icon: <FileText className=\"w-4 h-4 text-orange-500\" />,\n                            metadata: doc\n                        });\n                    });\n                }\n\n                setResults(searchResults);\n                setSelectedIndex(0);\n            } catch (error) {\n                log.error('Search error', error, { component: 'GlobalSearch', action: 'performSearch', metadata: { query: searchQuery } });\n                // Generate mock results for demo\n                generateMockResults(searchQuery);\n            } finally {\n                setLoading(false);\n            }\n        }, 300),\n        [currentTenant]\n    );\n\n    function generateMockResults(searchQuery: string) {\n        const mockItems: any[] = [\n            {\n                id: '1',\n                type: 'employee',\n                title: 'John Smith',\n                subtitle: 'Senior Developer - Engineering',\n                url: '/hr',\n                icon: <User className=\"w-4 h-4 text-blue-500\" />\n            },\n            {\n                id: '2',\n                type: 'job',\n                title: 'Senior Software Engineer',\n                subtitle: 'Engineering - Remote',\n                url: '/recruit',\n                icon: <Briefcase className=\"w-4 h-4 text-green-500\" />\n            },\n            {\n                id: '3',\n                type: 'application',\n                title: 'Sarah Johnson',\n                subtitle: 'Application - Interview Scheduled',\n                url: '/recruit',\n                icon: <Users className=\"w-4 h-4 text-purple-500\" />\n            }\n        ];\n\n        const filtered = mockItems.filter(r =>\n            r.title.toLowerCase().includes(searchQuery.toLowerCase())\n        ) as SearchResult[];\n\n        setResults(filtered);\n    }\n\n    useEffect(() => {\n        performSearch(query);\n    }, [query, performSearch]);\n\n    function handleSelect(result: SearchResult) {\n        // Save to recent searches\n        const updated = [result.title, ...recentSearches.filter(s => s !== result.title)].slice(0, 5);\n        setRecentSearches(updated);\n        localStorage.setItem('recentSearches', JSON.stringify(updated));\n\n        // Navigate\n        navigate(result.url);\n        setIsOpen(false);\n        setQuery('');\n    }\n\n    function handleKeyDown(e: React.KeyboardEvent) {\n        if (e.key === 'ArrowDown') {\n            e.preventDefault();\n            setSelectedIndex(prev => Math.min(prev + 1, results.length - 1));\n        } else if (e.key === 'ArrowUp') {\n            e.preventDefault();\n            setSelectedIndex(prev => Math.max(prev - 1, 0));\n        } else if (e.key === 'Enter' && results[selectedIndex]) {\n            handleSelect(results[selectedIndex]);\n        }\n    }\n\n    function clearRecentSearches() {\n        setRecentSearches([]);\n        localStorage.removeItem('recentSearches');\n    }\n\n    const quickLinks = [\n        { label: 'Dashboard', url: '/dashboard', icon: <Building className=\"w-4 h-4\" /> },\n        { label: 'Employees', url: '/hr', icon: <Users className=\"w-4 h-4\" /> },\n        { label: 'Jobs', url: '/recruit', icon: <Briefcase className=\"w-4 h-4\" /> },\n        { label: 'Compliance', url: '/compliance-hub', icon: <FileText className=\"w-4 h-4\" /> },\n        { label: 'Interviews', url: '/recruit', icon: <Calendar className=\"w-4 h-4\" /> }\n    ];\n\n    return (\n        <>\n            {/* Search Button */}\n            <button\n                onClick={() => setIsOpen(true)}\n                className=\"flex items-center space-x-2 px-3 py-1.5 text-sm text-gray-500 bg-gray-100 hover:bg-gray-200 rounded-lg transition\"\n            >\n                <Search className=\"w-4 h-4\" />\n                <span className=\"hidden md:inline\">Search...</span>\n                <kbd className=\"hidden md:inline px-1.5 py-0.5 text-xs bg-white rounded border border-gray-300\">âK</kbd>\n            </button>\n\n            {/* Search Modal */}\n            {isOpen && (\n                <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n                    {/* Backdrop */}\n                    <div\n                        className=\"fixed inset-0 bg-black/50 backdrop-blur-sm\"\n                        onClick={() => setIsOpen(false)}\n                    />\n\n                    {/* Modal */}\n                    <div className=\"relative min-h-screen flex items-start justify-center pt-24 px-4\">\n                        <div className=\"relative w-full max-w-2xl bg-white rounded-2xl shadow-2xl overflow-hidden\">\n                            {/* Search Input */}\n                            <div className=\"flex items-center px-4 border-b border-gray-200\">\n                                <Search className=\"w-5 h-5 text-gray-400\" />\n                                <input\n                                    ref={inputRef}\n                                    type=\"text\"\n                                    value={query}\n                                    onChange={(e) => setQuery(e.target.value)}\n                                    onKeyDown={handleKeyDown}\n                                    placeholder=\"Search employees, jobs, applications, documents...\"\n                                    className=\"flex-1 px-4 py-4 text-lg outline-none\"\n                                />\n                                {query && (\n                                    <button\n                                        onClick={() => setQuery('')}\n                                        className=\"p-1 text-gray-400 hover:text-gray-600\"\n                                    >\n                                        <X className=\"w-4 h-4\" />\n                                    </button>\n                                )}\n                                <button\n                                    onClick={() => setIsOpen(false)}\n                                    className=\"ml-2 px-2 py-1 text-xs text-gray-500 bg-gray-100 rounded\"\n                                >\n                                    ESC\n                                </button>\n                            </div>\n\n                            {/* Results */}\n                            <div ref={resultsRef} className=\"max-h-96 overflow-y-auto\">\n                                {loading ? (\n                                    <div className=\"p-8 text-center\">\n                                        <div className=\"animate-spin h-6 w-6 border-2 border-indigo-600 border-t-transparent rounded-full mx-auto\" />\n                                        <p className=\"mt-2 text-sm text-gray-500\">Searching...</p>\n                                    </div>\n                                ) : query && results.length > 0 ? (\n                                    <div className=\"py-2\">\n                                        <p className=\"px-4 py-2 text-xs font-semibold text-gray-500 uppercase\">Results</p>\n                                        {results.map((result, index) => (\n                                            <button\n                                                key={result.id}\n                                                onClick={() => handleSelect(result)}\n                                                className={`w-full flex items-center px-4 py-3 hover:bg-gray-50 transition ${index === selectedIndex ? 'bg-indigo-50' : ''\n                                                    }`}\n                                            >\n                                                <div className=\"flex-shrink-0 p-2 bg-gray-100 rounded-lg\">\n                                                    {result.icon}\n                                                </div>\n                                                <div className=\"ml-3 flex-1 text-left\">\n                                                    <p className=\"text-sm font-medium text-gray-900\">{result.title}</p>\n                                                    <p className=\"text-xs text-gray-500\">{result.subtitle}</p>\n                                                </div>\n                                                <ArrowRight className=\"w-4 h-4 text-gray-400\" />\n                                            </button>\n                                        ))}\n                                    </div>\n                                ) : query && results.length === 0 ? (\n                                    <div className=\"p-8 text-center text-gray-500\">\n                                        <Search className=\"w-12 h-12 mx-auto mb-2 text-gray-300\" />\n                                        <p>No results found for \"{query}\"</p>\n                                    </div>\n                                ) : (\n                                    <div className=\"py-2\">\n                                        {/* Recent Searches */}\n                                        {recentSearches.length > 0 && (\n                                            <div className=\"mb-4\">\n                                                <div className=\"flex items-center justify-between px-4 py-2\">\n                                                    <p className=\"text-xs font-semibold text-gray-500 uppercase\">Recent</p>\n                                                    <button\n                                                        onClick={clearRecentSearches}\n                                                        className=\"text-xs text-gray-400 hover:text-gray-600\"\n                                                    >\n                                                        Clear\n                                                    </button>\n                                                </div>\n                                                {recentSearches.map((search, index) => (\n                                                    <button\n                                                        key={index}\n                                                        onClick={() => setQuery(search)}\n                                                        className=\"w-full flex items-center px-4 py-2 hover:bg-gray-50 transition\"\n                                                    >\n                                                        <Clock className=\"w-4 h-4 text-gray-400 mr-3\" />\n                                                        <span className=\"text-sm text-gray-700\">{search}</span>\n                                                    </button>\n                                                ))}\n                                            </div>\n                                        )}\n\n                                        {/* Quick Links */}\n                                        <div>\n                                            <p className=\"px-4 py-2 text-xs font-semibold text-gray-500 uppercase\">Quick Links</p>\n                                            <div className=\"grid grid-cols-2 gap-2 px-4 pb-4\">\n                                                {quickLinks.map((link, index) => (\n                                                    <button\n                                                        key={index}\n                                                        onClick={() => {\n                                                            navigate(link.url);\n                                                            setIsOpen(false);\n                                                        }}\n                                                        className=\"flex items-center px-3 py-2 text-sm text-gray-700 bg-gray-50 hover:bg-gray-100 rounded-lg transition\"\n                                                    >\n                                                        <span className=\"text-gray-400 mr-2\">{link.icon}</span>\n                                                        {link.label}\n                                                    </button>\n                                                ))}\n                                            </div>\n                                        </div>\n                                    </div>\n                                )}\n                            </div>\n\n                            {/* Footer */}\n                            <div className=\"px-4 py-3 bg-gray-50 border-t border-gray-100 flex items-center justify-between text-xs text-gray-500\">\n                                <div className=\"flex items-center space-x-4\">\n                                    <span>ââ Navigate</span>\n                                    <span>âµ Select</span>\n                                    <span>ESC Close</span>\n                                </div>\n                                <span>Powered by NovumFlow</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            )}\n        </>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/GoalsTracker.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Edit2' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Trash2' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MoreHorizontal' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":62},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":64,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":65},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'format' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showAddGoal' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":38,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":23},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadGoals'. Either include it or remove the dependency array.","line":42,"column":8,"nodeType":"ArrayExpression","endLine":42,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [currentTenant, loadGoals]","fix":{"range":[1334,1349],"text":"[currentTenant, loadGoals]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport { useTenant } from '@/contexts/TenantContext';\nimport {\n    Target, CheckCircle, Circle, Plus, ChevronDown, ChevronRight,\n    Calendar, User, TrendingUp, Edit2, Trash2, MoreHorizontal, X\n} from 'lucide-react';\nimport { format, parseISO, differenceInDays } from 'date-fns';\n\ninterface Goal {\n    id: string;\n    title: string;\n    description?: string;\n    category: 'personal' | 'team' | 'company';\n    status: 'not_started' | 'in_progress' | 'completed' | 'at_risk';\n    progress: number;\n    target_date: string;\n    owner_name: string;\n    key_results: KeyResult[];\n}\n\ninterface KeyResult {\n    id: string;\n    title: string;\n    target_value: number;\n    current_value: number;\n    unit: string;\n    is_completed: boolean;\n}\n\nexport default function GoalsTracker() {\n    const { currentTenant } = useTenant();\n    const [goals, setGoals] = useState<Goal[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [expandedGoals, setExpandedGoals] = useState<Set<string>>(new Set());\n    const [filter, setFilter] = useState<'all' | 'personal' | 'team' | 'company'>('all');\n    const [showAddGoal, setShowAddGoal] = useState(false);\n\n    useEffect(() => {\n        loadGoals();\n    }, [currentTenant]);\n\n    async function loadGoals() {\n        setLoading(true);\n        try {\n            const { data, error } = await supabase\n                .from('goals')\n                .select('*, key_results(*)')\n                .eq('tenant_id', currentTenant?.id)\n                .order('target_date');\n\n            if (error) throw error;\n            setGoals(data || []);\n        } catch (error) {\n            log.error('Error loading goals', error, { component: 'GoalsTracker', action: 'loadGoals' });\n            setGoals(generateMockGoals());\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    function generateMockGoals(): Goal[] {\n        return [\n            {\n                id: '1',\n                title: 'Improve Employee Retention',\n                description: 'Reduce voluntary turnover by implementing better engagement programs',\n                category: 'company',\n                status: 'in_progress',\n                progress: 65,\n                target_date: '2024-03-31',\n                owner_name: 'Sarah Johnson',\n                key_results: [\n                    { id: 'kr1', title: 'Reduce turnover rate', target_value: 10, current_value: 12, unit: '%', is_completed: false },\n                    { id: 'kr2', title: 'Conduct stay interviews', target_value: 50, current_value: 35, unit: 'interviews', is_completed: false },\n                    { id: 'kr3', title: 'Launch mentorship program', target_value: 1, current_value: 1, unit: 'program', is_completed: true },\n                ],\n            },\n            {\n                id: '2',\n                title: 'Complete Leadership Training',\n                description: 'Finish all modules of the leadership development program',\n                category: 'personal',\n                status: 'in_progress',\n                progress: 80,\n                target_date: '2024-02-15',\n                owner_name: 'Michael Chen',\n                key_results: [\n                    { id: 'kr4', title: 'Complete training modules', target_value: 10, current_value: 8, unit: 'modules', is_completed: false },\n                    { id: 'kr5', title: 'Pass final assessment', target_value: 1, current_value: 0, unit: 'assessment', is_completed: false },\n                ],\n            },\n            {\n                id: '3',\n                title: 'Streamline Recruitment Process',\n                description: 'Reduce time-to-hire while maintaining quality of hires',\n                category: 'team',\n                status: 'at_risk',\n                progress: 40,\n                target_date: '2024-01-31',\n                owner_name: 'Emma Wilson',\n                key_results: [\n                    { id: 'kr6', title: 'Reduce time-to-hire', target_value: 25, current_value: 35, unit: 'days', is_completed: false },\n                    { id: 'kr7', title: 'Implement ATS features', target_value: 5, current_value: 2, unit: 'features', is_completed: false },\n                ],\n            },\n            {\n                id: '4',\n                title: 'Achieve 95% Compliance Score',\n                description: 'Maintain all required certifications and training completions',\n                category: 'company',\n                status: 'completed',\n                progress: 100,\n                target_date: '2024-01-15',\n                owner_name: 'Compliance Team',\n                key_results: [\n                    { id: 'kr8', title: 'Complete mandatory training', target_value: 100, current_value: 100, unit: '%', is_completed: true },\n                    { id: 'kr9', title: 'Renew certifications', target_value: 15, current_value: 15, unit: 'certs', is_completed: true },\n                ],\n            },\n        ];\n    }\n\n    function toggleGoalExpand(goalId: string) {\n        const newExpanded = new Set(expandedGoals);\n        if (newExpanded.has(goalId)) {\n            newExpanded.delete(goalId);\n        } else {\n            newExpanded.add(goalId);\n        }\n        setExpandedGoals(newExpanded);\n    }\n\n    function getStatusColor(status: Goal['status']) {\n        switch (status) {\n            case 'completed': return 'bg-green-100 text-green-700';\n            case 'in_progress': return 'bg-blue-100 text-blue-700';\n            case 'at_risk': return 'bg-red-100 text-red-700';\n            default: return 'bg-gray-100 text-gray-700';\n        }\n    }\n\n    function getStatusLabel(status: Goal['status']) {\n        return {\n            completed: 'Completed',\n            in_progress: 'In Progress',\n            at_risk: 'At Risk',\n            not_started: 'Not Started',\n        }[status];\n    }\n\n    function getCategoryColor(category: Goal['category']) {\n        switch (category) {\n            case 'personal': return 'bg-purple-100 text-purple-700';\n            case 'team': return 'bg-orange-100 text-orange-700';\n            case 'company': return 'bg-indigo-100 text-indigo-700';\n        }\n    }\n\n    function getDaysRemaining(targetDate: string): { days: number; label: string; color: string } {\n        const days = differenceInDays(parseISO(targetDate), new Date());\n        if (days < 0) return { days, label: 'Overdue', color: 'text-red-600' };\n        if (days === 0) return { days, label: 'Due today', color: 'text-orange-600' };\n        if (days <= 7) return { days, label: `${days} days left`, color: 'text-orange-600' };\n        return { days, label: `${days} days left`, color: 'text-gray-500' };\n    }\n\n    const filteredGoals = filter === 'all' ? goals : goals.filter(g => g.category === filter);\n\n    if (loading) {\n        return (\n            <div className=\"bg-white rounded-xl border border-gray-200 p-6\">\n                <div className=\"animate-pulse space-y-4\">\n                    <div className=\"h-6 bg-gray-200 rounded w-1/3\" />\n                    {[1, 2, 3].map(i => (\n                        <div key={i} className=\"h-24 bg-gray-100 rounded-lg\" />\n                    ))}\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"bg-white rounded-xl border border-gray-200 overflow-hidden\">\n            {/* Header */}\n            <div className=\"px-6 py-4 border-b border-gray-200\">\n                <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center space-x-2\">\n                        <Target className=\"w-5 h-5 text-indigo-600\" />\n                        <h2 className=\"font-semibold text-gray-900\">Goals & OKRs</h2>\n                    </div>\n                    <button\n                        onClick={() => setShowAddGoal(true)}\n                        className=\"inline-flex items-center px-3 py-1.5 text-sm bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition\"\n                    >\n                        <Plus className=\"w-4 h-4 mr-1\" />\n                        Add Goal\n                    </button>\n                </div>\n\n                {/* Filters */}\n                <div className=\"mt-3 flex space-x-2\">\n                    {(['all', 'personal', 'team', 'company'] as const).map(f => (\n                        <button\n                            key={f}\n                            onClick={() => setFilter(f)}\n                            className={`px-3 py-1 text-xs rounded-lg transition ${filter === f\n                                ? 'bg-indigo-100 text-indigo-700 font-medium'\n                                : 'text-gray-600 hover:bg-gray-100'\n                                }`}\n                        >\n                            {f.charAt(0).toUpperCase() + f.slice(1)}\n                        </button>\n                    ))}\n                </div>\n            </div>\n\n            {/* Goals Summary */}\n            <div className=\"px-6 py-3 bg-gray-50 border-b border-gray-200 grid grid-cols-4 gap-4 text-center\">\n                <div>\n                    <p className=\"text-2xl font-bold text-gray-900\">{goals.length}</p>\n                    <p className=\"text-xs text-gray-500\">Total Goals</p>\n                </div>\n                <div>\n                    <p className=\"text-2xl font-bold text-green-600\">{goals.filter(g => g.status === 'completed').length}</p>\n                    <p className=\"text-xs text-gray-500\">Completed</p>\n                </div>\n                <div>\n                    <p className=\"text-2xl font-bold text-blue-600\">{goals.filter(g => g.status === 'in_progress').length}</p>\n                    <p className=\"text-xs text-gray-500\">In Progress</p>\n                </div>\n                <div>\n                    <p className=\"text-2xl font-bold text-red-600\">{goals.filter(g => g.status === 'at_risk').length}</p>\n                    <p className=\"text-xs text-gray-500\">At Risk</p>\n                </div>\n            </div>\n\n            {/* Goals List */}\n            <div className=\"divide-y divide-gray-100\">\n                {filteredGoals.length === 0 ? (\n                    <div className=\"p-8 text-center text-gray-500\">\n                        <Target className=\"w-12 h-12 mx-auto mb-2 text-gray-300\" />\n                        <p>No goals found</p>\n                    </div>\n                ) : (\n                    filteredGoals.map(goal => {\n                        const isExpanded = expandedGoals.has(goal.id);\n                        const daysInfo = getDaysRemaining(goal.target_date);\n\n                        return (\n                            <div key={goal.id} className=\"hover:bg-gray-50 transition\">\n                                {/* Goal Header */}\n                                <div\n                                    className=\"px-6 py-4 cursor-pointer\"\n                                    onClick={() => toggleGoalExpand(goal.id)}\n                                >\n                                    <div className=\"flex items-start\">\n                                        <button className=\"mt-1 mr-3 text-gray-400\">\n                                            {isExpanded ? (\n                                                <ChevronDown className=\"w-5 h-5\" />\n                                            ) : (\n                                                <ChevronRight className=\"w-5 h-5\" />\n                                            )}\n                                        </button>\n                                        <div className=\"flex-1\">\n                                            <div className=\"flex items-center flex-wrap gap-2 mb-1\">\n                                                <span className={`px-2 py-0.5 text-xs rounded ${getCategoryColor(goal.category)}`}>\n                                                    {goal.category}\n                                                </span>\n                                                <span className={`px-2 py-0.5 text-xs rounded ${getStatusColor(goal.status)}`}>\n                                                    {getStatusLabel(goal.status)}\n                                                </span>\n                                            </div>\n                                            <h3 className=\"text-sm font-medium text-gray-900\">{goal.title}</h3>\n                                            {goal.description && (\n                                                <p className=\"text-xs text-gray-500 mt-0.5\">{goal.description}</p>\n                                            )}\n                                            <div className=\"mt-2 flex items-center text-xs text-gray-400 space-x-4\">\n                                                <span className=\"flex items-center\">\n                                                    <User className=\"w-3 h-3 mr-1\" />\n                                                    {goal.owner_name}\n                                                </span>\n                                                <span className={`flex items-center ${daysInfo.color}`}>\n                                                    <Calendar className=\"w-3 h-3 mr-1\" />\n                                                    {daysInfo.label}\n                                                </span>\n                                            </div>\n                                        </div>\n                                        <div className=\"ml-4 text-right\">\n                                            <div className=\"flex items-center space-x-2\">\n                                                <div className=\"w-24 h-2 bg-gray-200 rounded-full overflow-hidden\">\n                                                    <div\n                                                        className={`h-full rounded-full ${goal.status === 'completed' ? 'bg-green-500' :\n                                                            goal.status === 'at_risk' ? 'bg-red-500' : 'bg-indigo-500'\n                                                            }`}\n                                                        style={{ width: `${goal.progress}%` }}\n                                                    />\n                                                </div>\n                                                <span className=\"text-sm font-semibold text-gray-700\">{goal.progress}%</span>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                {/* Key Results */}\n                                {isExpanded && goal.key_results.length > 0 && (\n                                    <div className=\"px-6 pb-4 pl-14 space-y-2\">\n                                        <p className=\"text-xs font-medium text-gray-500 uppercase\">Key Results</p>\n                                        {goal.key_results.map(kr => (\n                                            <div\n                                                key={kr.id}\n                                                className={`p-3 rounded-lg border ${kr.is_completed ? 'bg-green-50 border-green-200' : 'bg-gray-50 border-gray-200'\n                                                    }`}\n                                            >\n                                                <div className=\"flex items-center justify-between\">\n                                                    <div className=\"flex items-center\">\n                                                        {kr.is_completed ? (\n                                                            <CheckCircle className=\"w-4 h-4 text-green-600 mr-2\" />\n                                                        ) : (\n                                                            <Circle className=\"w-4 h-4 text-gray-400 mr-2\" />\n                                                        )}\n                                                        <span className={`text-sm ${kr.is_completed ? 'text-green-700 line-through' : 'text-gray-700'}`}>\n                                                            {kr.title}\n                                                        </span>\n                                                    </div>\n                                                    <span className={`text-sm font-medium ${kr.is_completed ? 'text-green-600' : 'text-gray-600'}`}>\n                                                        {kr.current_value}/{kr.target_value} {kr.unit}\n                                                    </span>\n                                                </div>\n                                                <div className=\"mt-2 h-1.5 bg-gray-200 rounded-full overflow-hidden\">\n                                                    <div\n                                                        className={`h-full rounded-full ${kr.is_completed ? 'bg-green-500' : 'bg-indigo-500'}`}\n                                                        style={{ width: `${Math.min((kr.current_value / kr.target_value) * 100, 100)}%` }}\n                                                    />\n                                                </div>\n                                            </div>\n                                        ))}\n                                    </div>\n                                )}\n                            </div>\n                        );\n                    })\n                )}\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/HRAnalyticsDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":18,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":15},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAnalyticsData'. Either include it or remove the dependency array.","line":26,"column":6,"nodeType":"ArrayExpression","endLine":26,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchAnalyticsData]","fix":{"range":[1104,1106],"text":"[fetchAnalyticsData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport { useAuth } from '@/contexts/AuthContext';\nimport {\n  LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer,\n  BarChart, Bar, PieChart, Pie, Cell,\n} from 'recharts'; // Recharts is already a dependency in careflow-ai, so assuming it's okay to use here.\n\ninterface HRAnalyticsDashboardProps {\n  onLoadingChange: (loading: boolean) => void;\n  onError: (message: string) => void;\n}\n\nconst COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884d8', '#82ca9d', '#ffc658'];\n\nexport default function HRAnalyticsDashboard({ onLoadingChange, onError }: HRAnalyticsDashboardProps) {\n  const { user } = useAuth();\n  const [employeeTurnoverData, setEmployeeTurnoverData] = useState<any[]>([]);\n  const [leaveTrendsData, setLeaveTrendsData] = useState<any[]>([]);\n  const [recruitmentStageData, setRecruitmentStageData] = useState<any[]>([]);\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    fetchAnalyticsData();\n  }, []);\n\n  async function fetchAnalyticsData() {\n    setLoading(true);\n    onLoadingChange(true);\n    try {\n      // Fetch Employee Turnover Data (simplified)\n      const { data: employeesData, error: employeesError } = await supabase\n        .from('employees')\n        .select('created_at, status');\n      if (employeesError) throw employeesError;\n\n      const turnoverByMonth: Record<string, { hires: number; terminations: number }> = {};\n      employeesData.forEach((emp: any) => {\n        const month = new Date(emp.created_at).toLocaleString('default', { month: 'short', year: 'numeric' });\n        if (!turnoverByMonth[month]) {\n          turnoverByMonth[month] = { hires: 0, terminations: 0 };\n        }\n        turnoverByMonth[month].hires++;\n        if (emp.status === 'terminated') {\n          turnoverByMonth[month].terminations++;\n        }\n      });\n      setEmployeeTurnoverData(Object.keys(turnoverByMonth).map(month => ({\n        month,\n        Hires: turnoverByMonth[month].hires,\n        Terminations: turnoverByMonth[month].terminations,\n      })));\n\n      // Fetch Leave Trends Data\n      const { data: leavesData, error: leavesError } = await supabase\n        .from('leave_requests')\n        .select('start_date, total_days, status');\n      if (leavesError) throw leavesError;\n\n      const leaveTrendsByMonth: Record<string, { approved: number; pending: number; rejected: number }> = {};\n      leavesData.forEach((leave: any) => {\n        const month = new Date(leave.start_date).toLocaleString('default', { month: 'short', year: 'numeric' });\n        if (!leaveTrendsByMonth[month]) {\n          leaveTrendsByMonth[month] = { approved: 0, pending: 0, rejected: 0 };\n        }\n        if (leave.status === 'approved') leaveTrendsByMonth[month].approved += leave.total_days;\n        else if (leave.status === 'pending') leaveTrendsByMonth[month].pending += leave.total_days;\n        else if (leave.status === 'rejected') leaveTrendsByMonth[month].rejected += leave.total_days;\n      });\n      setLeaveTrendsData(Object.keys(leaveTrendsByMonth).map(month => ({\n        month,\n        Approved: leaveTrendsByMonth[month].approved,\n        Pending: leaveTrendsByMonth[month].pending,\n        Rejected: leaveTrendsByMonth[month].rejected,\n      })));\n\n      // Fetch Recruitment Stage Data\n      const { data: applicationsData, error: applicationsError } = await supabase\n        .from('applications')\n        .select('current_stage_id, workflow_stages(name)');\n      if (applicationsError) throw applicationsError;\n\n      const stageCounts: Record<string, number> = {};\n      applicationsData.forEach((app: any) => {\n        const stageName = app.workflow_stages?.name || 'Unknown Stage';\n        stageCounts[stageName] = (stageCounts[stageName] || 0) + 1;\n      });\n      setRecruitmentStageData(Object.keys(stageCounts).map(stage => ({\n        name: stage,\n        value: stageCounts[stage],\n      })));\n\n    } catch (error: any) {\n      log.error('Error fetching analytics data', error, { component: 'HRAnalyticsDashboard', action: 'fetchAnalyticsData' });\n      onError(error.message || 'Failed to load analytics data.');\n    } finally {\n      setLoading(false);\n      onLoadingChange(false);\n    }\n  }\n\n  return (\n    <div className=\"space-y-8 p-4\">\n      <h2 className=\"text-2xl font-bold text-gray-900\">HR Analytics Dashboard</h2>\n      <p className=\"text-gray-600\">Overview of key HR metrics and trends.</p>\n\n      {loading ? (\n        <div className=\"flex items-center justify-center h-64\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600\"></div>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n          {/* Employee Turnover */}\n          <div className=\"bg-white p-6 rounded-lg shadow-sm border border-gray-200\">\n            <h3 className=\"text-lg font-semibold mb-4\">Employee Turnover</h3>\n            <ResponsiveContainer width=\"100%\" height={300}>\n              <LineChart data={employeeTurnoverData} margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>\n                <CartesianGrid strokeDasharray=\"3 3\" />\n                <XAxis dataKey=\"month\" />\n                <YAxis />\n                <Tooltip />\n                <Legend />\n                <Line type=\"monotone\" dataKey=\"Hires\" stroke={COLORS[0]} activeDot={{ r: 8 }} />\n                <Line type=\"monotone\" dataKey=\"Terminations\" stroke={COLORS[1]} />\n              </LineChart>\n            </ResponsiveContainer>\n          </div>\n\n          {/* Leave Trends */}\n          <div className=\"bg-white p-6 rounded-lg shadow-sm border border-gray-200\">\n            <h3 className=\"text-lg font-semibold mb-4\">Leave Trends (Days)</h3>\n            <ResponsiveContainer width=\"100%\" height={300}>\n              <BarChart data={leaveTrendsData} margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>\n                <CartesianGrid strokeDasharray=\"3 3\" />\n                <XAxis dataKey=\"month\" />\n                <YAxis />\n                <Tooltip />\n                <Legend />\n                <Bar dataKey=\"Approved\" fill={COLORS[0]} />\n                <Bar dataKey=\"Pending\" fill={COLORS[2]} />\n                <Bar dataKey=\"Rejected\" fill={COLORS[1]} />\n              </BarChart>\n            </ResponsiveContainer>\n          </div>\n\n          {/* Recruitment Stage Distribution */}\n          <div className=\"bg-white p-6 rounded-lg shadow-sm border border-gray-200\">\n            <h3 className=\"text-lg font-semibold mb-4\">Recruitment Stage Distribution</h3>\n            <ResponsiveContainer width=\"100%\" height={300}>\n              <PieChart margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>\n                <Pie\n                  data={recruitmentStageData}\n                  cx=\"50%\"\n                  cy=\"50%\"\n                  labelLine={false}\n                  outerRadius={80}\n                  fill=\"#8884d8\"\n                  dataKey=\"value\"\n                  label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}\n                >\n                  {recruitmentStageData.map((_entry, index) => (\n                    <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                  ))}\n                </Pie>\n                <Tooltip />\n                <Legend />\n              </PieChart>\n            </ResponsiveContainer>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/HelpCenter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/InductionWorkflow.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertTriangle' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used. Allowed unused vars must match /^_/u.","line":14,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used. Allowed unused vars must match /^_/u.","line":15,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Heart' is defined but never used. Allowed unused vars must match /^_/u.","line":19,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Building2' is defined but never used. Allowed unused vars must match /^_/u.","line":21,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Play' is defined but never used. Allowed unused vars must match /^_/u.","line":23,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Pause' is defined but never used. Allowed unused vars must match /^_/u.","line":24,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronRight' is defined but never used. Allowed unused vars must match /^_/u.","line":25,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MessageSquare' is defined but never used. Allowed unused vars must match /^_/u.","line":27,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'supabase' is defined but never used. Allowed unused vars must match /^_/u.","line":33,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'currentTenant' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":207,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":207,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":208,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":208,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'taskNotes' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":212,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":212,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setTaskNotes' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":212,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":212,"endColumn":35},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadProgress'. Either include it or remove the dependency array.","line":222,"column":8,"nodeType":"ArrayExpression","endLine":222,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [employeeId, loadProgress]","fix":{"range":[10798,10810],"text":"[employeeId, loadProgress]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Structured Induction Workflow Component\n * \n * CQC Regulation 18 & Skills for Care Alignment\n * Tracks new starter induction progress through mandatory stages\n */\n\nimport React, { useState, useEffect } from 'react';\nimport {\n    BookOpen,\n    CheckCircle,\n    Clock,\n    AlertTriangle,\n    User,\n    Calendar,\n    FileCheck,\n    Shield,\n    Award,\n    Heart,\n    Users,\n    Building2,\n    Lock,\n    Play,\n    Pause,\n    ChevronRight,\n    Upload,\n    MessageSquare,\n    Star,\n    Loader2\n} from 'lucide-react';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\n\n// ============================================\n// TYPES\n// ============================================\n\ninterface InductionStage {\n    id: string;\n    name: string;\n    description: string;\n    category: 'mandatory' | 'role_specific' | 'site_specific';\n    expectedDuration: string;\n    dayRange: { start: number; end: number };\n    icon: React.ReactNode;\n    tasks: InductionTask[];\n}\n\ninterface InductionTask {\n    id: string;\n    name: string;\n    description: string;\n    type: 'training' | 'document' | 'meeting' | 'observation' | 'signoff';\n    required: boolean;\n    completedAt?: string;\n    completedBy?: string;\n    signedOffBy?: string;\n    notes?: string;\n    evidenceRequired: boolean;\n}\n\ninterface InductionProgress {\n    employeeId: string;\n    employeeName: string;\n    startDate: string;\n    expectedCompletionDate: string;\n    currentDay: number;\n    stages: {\n        stageId: string;\n        status: 'not_started' | 'in_progress' | 'completed' | 'overdue';\n        tasks: {\n            taskId: string;\n            completed: boolean;\n            completedAt?: string;\n            evidence?: string;\n        }[];\n    }[];\n    overallProgress: number;\n}\n\n// ============================================\n// INDUCTION PROGRAMME DATA\n// ============================================\n\nconst INDUCTION_STAGES: InductionStage[] = [\n    {\n        id: 'pre_start',\n        name: 'Pre-Employment',\n        description: 'Documentation and checks before first day',\n        category: 'mandatory',\n        expectedDuration: 'Before Day 1',\n        dayRange: { start: -14, end: 0 },\n        icon: <FileCheck className=\"w-5 h-5\" />,\n        tasks: [\n            { id: 'contract', name: 'Employment Contract Signed', description: 'Terms and conditions agreed', type: 'document', required: true, evidenceRequired: true },\n            { id: 'dbs', name: 'DBS Check Cleared', description: 'Enhanced DBS received', type: 'document', required: true, evidenceRequired: true },\n            { id: 'rtw', name: 'Right to Work Verified', description: 'Immigration status confirmed', type: 'document', required: true, evidenceRequired: true },\n            { id: 'references', name: 'References Received', description: 'Minimum 2 satisfactory references', type: 'document', required: true, evidenceRequired: true },\n            { id: 'health_dec', name: 'Health Declaration Complete', description: 'Fitness to work confirmed', type: 'document', required: true, evidenceRequired: false },\n            { id: 'character_dec', name: 'Character Declaration Complete', description: 'CQC Regulation 19 disclosure', type: 'document', required: true, evidenceRequired: true }\n        ]\n    },\n    {\n        id: 'day_one',\n        name: 'Day 1: Welcome & Orientation',\n        description: 'First day essentials and site orientation',\n        category: 'mandatory',\n        expectedDuration: 'Day 1',\n        dayRange: { start: 1, end: 1 },\n        icon: <Star className=\"w-5 h-5\" />,\n        tasks: [\n            { id: 'welcome', name: 'Welcome Meeting', description: 'Introduction with manager', type: 'meeting', required: true, evidenceRequired: false },\n            { id: 'tour', name: 'Facility Tour', description: 'Building layout, fire exits, key areas', type: 'observation', required: true, evidenceRequired: false },\n            { id: 'id_badge', name: 'ID Badge & Access Cards', description: 'Security credentials issued', type: 'document', required: true, evidenceRequired: false },\n            { id: 'it_setup', name: 'IT & Systems Access', description: 'Login credentials and system training', type: 'training', required: true, evidenceRequired: false },\n            { id: 'handbook', name: 'Employee Handbook', description: 'Policies and procedures acknowledged', type: 'document', required: true, evidenceRequired: true },\n            { id: 'meet_team', name: 'Meet the Team', description: 'Introduction to colleagues', type: 'meeting', required: true, evidenceRequired: false }\n        ]\n    },\n    {\n        id: 'week_one',\n        name: 'Week 1: Core Training',\n        description: 'Essential mandatory training completion',\n        category: 'mandatory',\n        expectedDuration: 'Days 2-5',\n        dayRange: { start: 2, end: 5 },\n        icon: <BookOpen className=\"w-5 h-5\" />,\n        tasks: [\n            { id: 'fire_safety', name: 'Fire Safety Training', description: 'Fire awareness and evacuation', type: 'training', required: true, evidenceRequired: true },\n            { id: 'h_and_s', name: 'Health & Safety', description: 'Workplace safety essentials', type: 'training', required: true, evidenceRequired: true },\n            { id: 'manual_handling', name: 'Moving & Handling', description: 'Safe people handling techniques', type: 'training', required: true, evidenceRequired: true },\n            { id: 'safeguarding', name: 'Safeguarding Adults', description: 'Protection from abuse', type: 'training', required: true, evidenceRequired: true },\n            { id: 'infection_control', name: 'Infection Control', description: 'IPC principles and PPE use', type: 'training', required: true, evidenceRequired: true },\n            { id: 'data_protection', name: 'Data Protection & GDPR', description: 'Information governance', type: 'training', required: true, evidenceRequired: true }\n        ]\n    },\n    {\n        id: 'week_two',\n        name: 'Week 2: Supervised Practice',\n        description: 'Shadowing and supervised care delivery',\n        category: 'mandatory',\n        expectedDuration: 'Days 6-12',\n        dayRange: { start: 6, end: 12 },\n        icon: <Users className=\"w-5 h-5\" />,\n        tasks: [\n            { id: 'shadow_shift_1', name: 'Shadow Shift 1', description: 'Observe experienced colleague', type: 'observation', required: true, evidenceRequired: false },\n            { id: 'shadow_shift_2', name: 'Shadow Shift 2', description: 'Practice under supervision', type: 'observation', required: true, evidenceRequired: false },\n            { id: 'shadow_shift_3', name: 'Shadow Shift 3', description: 'Demonstrate core tasks', type: 'observation', required: true, evidenceRequired: false },\n            { id: 'personal_care', name: 'Personal Care Competency', description: 'Dignity and respect in care', type: 'signoff', required: true, evidenceRequired: true },\n            { id: 'medication_aware', name: 'Medication Awareness', description: 'Understand medication policies', type: 'training', required: true, evidenceRequired: true },\n            { id: 'care_plans', name: 'Care Plan Training', description: 'Reading and following care plans', type: 'training', required: true, evidenceRequired: false }\n        ]\n    },\n    {\n        id: 'month_one',\n        name: 'Month 1: Care Certificate',\n        description: 'Begin Care Certificate programme',\n        category: 'mandatory',\n        expectedDuration: 'Days 13-30',\n        dayRange: { start: 13, end: 30 },\n        icon: <Award className=\"w-5 h-5\" />,\n        tasks: [\n            { id: 'cc_1_role', name: 'CC1: Understand Your Role', description: 'Care Certificate Standard 1', type: 'training', required: true, evidenceRequired: true },\n            { id: 'cc_2_dev', name: 'CC2: Personal Development', description: 'Care Certificate Standard 2', type: 'training', required: true, evidenceRequired: true },\n            { id: 'cc_3_duty', name: 'CC3: Duty of Care', description: 'Care Certificate Standard 3', type: 'training', required: true, evidenceRequired: true },\n            { id: 'cc_4_equality', name: 'CC4: Equality & Diversity', description: 'Care Certificate Standard 4', type: 'training', required: true, evidenceRequired: true },\n            { id: 'cc_5_person', name: 'CC5: Person-Centred Care', description: 'Care Certificate Standard 5', type: 'training', required: true, evidenceRequired: true },\n            { id: 'review_1', name: '1-Month Review Meeting', description: 'Progress review with manager', type: 'meeting', required: true, evidenceRequired: true }\n        ]\n    },\n    {\n        id: 'month_three',\n        name: 'Month 2-3: Complete Care Certificate',\n        description: 'Finish all 15 Care Certificate standards',\n        category: 'mandatory',\n        expectedDuration: 'Days 31-84',\n        dayRange: { start: 31, end: 84 },\n        icon: <Shield className=\"w-5 h-5\" />,\n        tasks: [\n            { id: 'cc_6_15', name: 'Care Certificate Standards 6-15', description: 'Complete remaining standards', type: 'training', required: true, evidenceRequired: true },\n            { id: 'cc_assessment', name: 'Care Certificate Assessment', description: 'Competency sign-off', type: 'signoff', required: true, evidenceRequired: true },\n            { id: 'review_3', name: '3-Month Review Meeting', description: 'End of probation review', type: 'meeting', required: true, evidenceRequired: true },\n            { id: 'probation_signoff', name: 'Probation Sign-Off', description: 'Confirm successful induction', type: 'signoff', required: true, evidenceRequired: true }\n        ]\n    }\n];\n\n// ============================================\n// COMPONENT\n// ============================================\n\ninterface InductionWorkflowProps {\n    employeeId: string;\n    employeeName: string;\n    startDate: string;\n    onClose?: () => void;\n}\n\nexport default function InductionWorkflow({\n    employeeId,\n    employeeName,\n    startDate,\n    onClose\n}: InductionWorkflowProps) {\n    const { currentTenant } = useTenant();\n    const { user } = useAuth();\n    const [loading, setLoading] = useState(false);\n    const [activeStage, setActiveStage] = useState<string>('pre_start');\n    const [progress, setProgress] = useState<InductionProgress | null>(null);\n    const [taskNotes, setTaskNotes] = useState<Record<string, string>>({});\n    const [savingTask, setSavingTask] = useState<string | null>(null);\n\n    // Calculate current day of induction\n    const startDateObj = new Date(startDate);\n    const today = new Date();\n    const currentDay = Math.floor((today.getTime() - startDateObj.getTime()) / (1000 * 60 * 60 * 24)) + 1;\n\n    useEffect(() => {\n        loadProgress();\n    }, [employeeId]);\n\n    const loadProgress = async () => {\n        setLoading(true);\n        try {\n            // In production, load from database\n            // For demo, initialize empty progress\n            const initialProgress: InductionProgress = {\n                employeeId,\n                employeeName,\n                startDate,\n                expectedCompletionDate: new Date(startDateObj.getTime() + 84 * 24 * 60 * 60 * 1000).toISOString(),\n                currentDay,\n                stages: INDUCTION_STAGES.map(stage => ({\n                    stageId: stage.id,\n                    status: 'not_started' as const,\n                    tasks: stage.tasks.map(task => ({\n                        taskId: task.id,\n                        completed: false\n                    }))\n                })),\n                overallProgress: 0\n            };\n            setProgress(initialProgress);\n        } catch (error) {\n            log.error('Error loading progress', error, { component: 'InductionWorkflow', action: 'loadProgress', metadata: { employeeId } });\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const toggleTaskComplete = async (stageId: string, taskId: string) => {\n        if (!progress) return;\n        setSavingTask(taskId);\n\n        try {\n            const updatedStages = progress.stages.map(stage => {\n                if (stage.stageId === stageId) {\n                    return {\n                        ...stage,\n                        tasks: stage.tasks.map(task => {\n                            if (task.taskId === taskId) {\n                                return {\n                                    ...task,\n                                    completed: !task.completed,\n                                    completedAt: !task.completed ? new Date().toISOString() : undefined\n                                };\n                            }\n                            return task;\n                        })\n                    };\n                }\n                return stage;\n            });\n\n            // Calculate stage statuses\n            const finalStages = updatedStages.map(stage => {\n                const stageData = INDUCTION_STAGES.find(s => s.id === stage.stageId)!;\n                const completedTasks = stage.tasks.filter(t => t.completed).length;\n                const totalTasks = stage.tasks.length;\n\n                let status: 'not_started' | 'in_progress' | 'completed' | 'overdue' = 'not_started';\n                if (completedTasks === totalTasks) {\n                    status = 'completed';\n                } else if (completedTasks > 0) {\n                    status = 'in_progress';\n                } else if (currentDay > stageData.dayRange.end) {\n                    status = 'overdue';\n                }\n\n                return { ...stage, status };\n            });\n\n            // Calculate overall progress\n            const totalTasks = INDUCTION_STAGES.reduce((sum, s) => sum + s.tasks.length, 0);\n            const completedTasks = finalStages.reduce((sum, s) => sum + s.tasks.filter(t => t.completed).length, 0);\n            const overallProgress = Math.round((completedTasks / totalTasks) * 100);\n\n            setProgress({\n                ...progress,\n                stages: finalStages,\n                overallProgress\n            });\n\n            // In production, save to database here\n        } catch (error) {\n            log.error('Error updating task', error, { component: 'InductionWorkflow', action: 'toggleTaskComplete', metadata: { employeeId, stageId, taskId } });\n        } finally {\n            setSavingTask(null);\n        }\n    };\n\n    const getStageStatus = (stageId: string) => {\n        return progress?.stages.find(s => s.stageId === stageId)?.status || 'not_started';\n    };\n\n    const getTaskStatus = (stageId: string, taskId: string) => {\n        const stage = progress?.stages.find(s => s.stageId === stageId);\n        return stage?.tasks.find(t => t.taskId === taskId)?.completed || false;\n    };\n\n    const getStageProgress = (stageId: string) => {\n        const stage = progress?.stages.find(s => s.stageId === stageId);\n        if (!stage) return { completed: 0, total: 0, percentage: 0 };\n\n        const completed = stage.tasks.filter(t => t.completed).length;\n        const total = stage.tasks.length;\n        return { completed, total, percentage: Math.round((completed / total) * 100) };\n    };\n\n    const statusColors = {\n        'not_started': 'bg-gray-100 text-gray-600',\n        'in_progress': 'bg-blue-100 text-blue-600',\n        'completed': 'bg-green-100 text-green-600',\n        'overdue': 'bg-red-100 text-red-600'\n    };\n\n    return (\n        <div className=\"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden max-h-[90vh] flex flex-col\">\n            {/* Header */}\n            <div className=\"p-6 bg-gradient-to-r from-emerald-600 to-teal-600 flex-shrink-0\">\n                <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-4\">\n                        <div className=\"p-3 bg-white/20 rounded-xl\">\n                            <BookOpen className=\"w-8 h-8 text-white\" />\n                        </div>\n                        <div>\n                            <h2 className=\"text-xl font-bold text-white\">Induction Programme</h2>\n                            <p className=\"text-emerald-100\">{employeeName} â¢ Started {new Date(startDate).toLocaleDateString()}</p>\n                        </div>\n                    </div>\n                    <div className=\"flex items-center gap-4\">\n                        <div className=\"text-right\">\n                            <p className=\"text-sm text-emerald-100\">Day {currentDay}</p>\n                            <p className=\"text-2xl font-bold text-white\">{progress?.overallProgress || 0}%</p>\n                        </div>\n                        {onClose && (\n                            <button onClick={onClose} className=\"text-white/80 hover:text-white text-2xl\">\n                                &times;\n                            </button>\n                        )}\n                    </div>\n                </div>\n\n                {/* Progress Bar */}\n                <div className=\"mt-4\">\n                    <div className=\"h-3 bg-white/20 rounded-full overflow-hidden\">\n                        <div\n                            className=\"h-full bg-white transition-all duration-500\"\n                            style={{ width: `${progress?.overallProgress || 0}%` }}\n                        />\n                    </div>\n                    <div className=\"flex justify-between mt-1 text-xs text-emerald-100\">\n                        <span>Pre-Start</span>\n                        <span>Week 1</span>\n                        <span>Week 2</span>\n                        <span>Month 1</span>\n                        <span>Month 3</span>\n                    </div>\n                </div>\n            </div>\n\n            {/* Main Content */}\n            <div className=\"flex-1 overflow-hidden flex\">\n                {/* Stage Sidebar */}\n                <div className=\"w-72 border-r border-gray-200 bg-gray-50 overflow-y-auto flex-shrink-0\">\n                    <div className=\"p-4\">\n                        <h3 className=\"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-3\">\n                            Induction Stages\n                        </h3>\n                        {INDUCTION_STAGES.map(stage => {\n                            const status = getStageStatus(stage.id);\n                            const stageProgress = getStageProgress(stage.id);\n                            const isActive = activeStage === stage.id;\n                            const isDue = currentDay >= stage.dayRange.start && currentDay <= stage.dayRange.end;\n\n                            return (\n                                <button\n                                    key={stage.id}\n                                    onClick={() => setActiveStage(stage.id)}\n                                    className={`w-full text-left p-3 rounded-lg mb-2 transition-all ${isActive\n                                        ? 'bg-emerald-100 border-emerald-300 border'\n                                        : 'bg-white border border-gray-200 hover:border-emerald-200'\n                                        }`}\n                                >\n                                    <div className=\"flex items-center gap-2 mb-2\">\n                                        <span className={isActive ? 'text-emerald-600' : 'text-gray-500'}>{stage.icon}</span>\n                                        <span className={`text-sm font-medium ${isActive ? 'text-emerald-700' : 'text-gray-700'}`}>\n                                            {stage.name}\n                                        </span>\n                                        {isDue && status !== 'completed' && (\n                                            <span className=\"ml-auto px-1.5 py-0.5 bg-blue-100 text-blue-700 text-xs font-medium rounded\">\n                                                NOW\n                                            </span>\n                                        )}\n                                    </div>\n                                    <div className=\"flex items-center gap-2\">\n                                        <div className=\"flex-1 h-1.5 bg-gray-200 rounded-full overflow-hidden\">\n                                            <div\n                                                className={`h-full rounded-full transition-all ${status === 'completed' ? 'bg-green-500' :\n                                                    status === 'overdue' ? 'bg-red-500' :\n                                                        status === 'in_progress' ? 'bg-blue-500' : 'bg-gray-300'\n                                                    }`}\n                                                style={{ width: `${stageProgress.percentage}%` }}\n                                            />\n                                        </div>\n                                        <span className=\"text-xs text-gray-500\">{stageProgress.completed}/{stageProgress.total}</span>\n                                    </div>\n                                    <p className=\"text-xs text-gray-400 mt-1\">{stage.expectedDuration}</p>\n                                </button>\n                            );\n                        })}\n                    </div>\n                </div>\n\n                {/* Tasks Content */}\n                <div className=\"flex-1 overflow-y-auto p-6\">\n                    {loading ? (\n                        <div className=\"flex items-center justify-center h-64\">\n                            <Loader2 className=\"w-8 h-8 animate-spin text-emerald-600\" />\n                        </div>\n                    ) : (\n                        INDUCTION_STAGES\n                            .filter(s => s.id === activeStage)\n                            .map(stage => (\n                                <div key={stage.id}>\n                                    <div className=\"mb-6\">\n                                        <div className=\"flex items-center gap-3 mb-2\">\n                                            <span className=\"p-2 bg-emerald-100 rounded-lg text-emerald-600\">{stage.icon}</span>\n                                            <div>\n                                                <h3 className=\"text-lg font-bold text-gray-900\">{stage.name}</h3>\n                                                <p className=\"text-sm text-gray-500\">{stage.description}</p>\n                                            </div>\n                                            <span className={`ml-auto px-3 py-1 rounded-full text-xs font-medium ${statusColors[getStageStatus(stage.id)]}`}>\n                                                {getStageStatus(stage.id).replace('_', ' ')}\n                                            </span>\n                                        </div>\n                                    </div>\n\n                                    <div className=\"space-y-3\">\n                                        {stage.tasks.map(task => {\n                                            const isCompleted = getTaskStatus(stage.id, task.id);\n                                            const isSaving = savingTask === task.id;\n\n                                            return (\n                                                <div\n                                                    key={task.id}\n                                                    className={`border rounded-lg p-4 transition-all ${isCompleted\n                                                        ? 'bg-green-50 border-green-200'\n                                                        : 'bg-white border-gray-200 hover:border-emerald-200'\n                                                        }`}\n                                                >\n                                                    <div className=\"flex items-start gap-3\">\n                                                        <button\n                                                            onClick={() => toggleTaskComplete(stage.id, task.id)}\n                                                            disabled={isSaving}\n                                                            className={`mt-0.5 w-6 h-6 rounded-full flex items-center justify-center transition-all ${isCompleted\n                                                                ? 'bg-green-500 text-white'\n                                                                : 'bg-gray-200 text-gray-400 hover:bg-emerald-200'\n                                                                }`}\n                                                        >\n                                                            {isSaving ? (\n                                                                <Loader2 className=\"w-4 h-4 animate-spin\" />\n                                                            ) : isCompleted ? (\n                                                                <CheckCircle className=\"w-4 h-4\" />\n                                                            ) : (\n                                                                <span className=\"text-xs\">â</span>\n                                                            )}\n                                                        </button>\n                                                        <div className=\"flex-1\">\n                                                            <div className=\"flex items-center gap-2\">\n                                                                <span className={`font-medium ${isCompleted ? 'text-green-700 line-through' : 'text-gray-900'}`}>\n                                                                    {task.name}\n                                                                </span>\n                                                                {task.required && (\n                                                                    <span className=\"px-1.5 py-0.5 bg-red-100 text-red-600 text-xs font-medium rounded\">\n                                                                        Required\n                                                                    </span>\n                                                                )}\n                                                                {task.evidenceRequired && (\n                                                                    <span className=\"px-1.5 py-0.5 bg-blue-100 text-blue-600 text-xs font-medium rounded flex items-center gap-1\">\n                                                                        <Upload className=\"w-3 h-3\" />\n                                                                        Evidence\n                                                                    </span>\n                                                                )}\n                                                            </div>\n                                                            <p className=\"text-sm text-gray-500 mt-0.5\">{task.description}</p>\n                                                            <div className=\"flex items-center gap-3 mt-2 text-xs text-gray-400\">\n                                                                <span className=\"capitalize px-2 py-0.5 bg-gray-100 rounded\">{task.type}</span>\n                                                            </div>\n                                                        </div>\n                                                        {task.type === 'signoff' && !isCompleted && (\n                                                            <button className=\"px-3 py-1.5 bg-emerald-100 text-emerald-700 rounded-lg text-sm font-medium hover:bg-emerald-200 flex items-center gap-1\">\n                                                                <Lock className=\"w-4 h-4\" />\n                                                                Request Sign-off\n                                                            </button>\n                                                        )}\n                                                    </div>\n                                                </div>\n                                            );\n                                        })}\n                                    </div>\n                                </div>\n                            ))\n                    )}\n                </div>\n            </div>\n\n            {/* Footer */}\n            <div className=\"p-4 border-t border-gray-200 bg-gray-50 flex-shrink-0\">\n                <div className=\"flex items-center justify-between\">\n                    <p className=\"text-xs text-gray-500\">\n                        Structured induction programme aligned with CQC Regulation 18 and Skills for Care Care Certificate\n                    </p>\n                    <div className=\"flex gap-2\">\n                        <button className=\"px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-50\">\n                            Export Progress Report\n                        </button>\n                        <button className=\"px-4 py-2 bg-emerald-600 text-white rounded-lg text-sm font-medium hover:bg-emerald-700\">\n                            Schedule Review Meeting\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/IntegrationDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Users' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":57,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":62},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertCircle' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":77,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":88},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":90,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":98}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Link, Plug, Mail, Calendar, DollarSign, Clock, Users, CheckCircle, AlertCircle, Settings, Zap, TrendingUp } from 'lucide-react';\nimport { log } from '../lib/logger';\nimport { integrationEngine, IntegrationConfig, CommunicationTemplate } from '../lib/integrationEngine';\n\nexport default function IntegrationDashboard() {\n  const [dashboardData, setDashboardData] = useState<any>(null);\n  const [integrations, setIntegrations] = useState<IntegrationConfig[]>([]);\n  const [templates, setTemplates] = useState<CommunicationTemplate[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [activeTab, setActiveTab] = useState<'overview' | 'integrations' | 'communications' | 'sequences'>('overview');\n\n  useEffect(() => {\n    loadDashboardData();\n  }, []);\n\n  const loadDashboardData = async () => {\n    try {\n      const dashboard = integrationEngine.getIntegrationsDashboard();\n      const integrationsList = integrationEngine.getAvailableIntegrations();\n      const templatesList = integrationEngine.getCommunicationTemplates();\n\n      setDashboardData(dashboard);\n      setIntegrations(integrationsList);\n      setTemplates(templatesList);\n    } catch (error) {\n      log.error('Failed to load integration data', error, { component: 'IntegrationDashboard', action: 'loadDashboardData' });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getIntegrationIcon = (type: string) => {\n    switch (type) {\n      case 'payroll': return DollarSign;\n      case 'email': return Mail;\n      case 'calendar': return Calendar;\n      case 'time_tracking': return Clock;\n      default: return Plug;\n    }\n  };\n\n  const IntegrationCard = ({ integration }: { integration: IntegrationConfig }) => {\n    const Icon = getIntegrationIcon(integration.type);\n\n    return (\n      <div className={`bg-white rounded-xl shadow-sm border-2 p-6 transition-all hover:shadow-md ${integration.isActive ? 'border-green-200 bg-green-50' : 'border-gray-200'\n        }`}>\n        <div className=\"flex items-center justify-between mb-4\">\n          <div className=\"flex items-center space-x-3\">\n            <div className={`p-3 rounded-lg ${integration.isActive ? 'bg-green-100' : 'bg-gray-100'\n              }`}>\n              <Icon className={`w-6 h-6 ${integration.isActive ? 'text-green-600' : 'text-gray-400'\n                }`} />\n            </div>\n            <div>\n              <h3 className=\"font-semibold text-gray-900\">{integration.name}</h3>\n              <p className=\"text-sm text-gray-600 capitalize\">{integration.type.replace('_', ' ')}</p>\n            </div>\n          </div>\n          <div className={`px-3 py-1 rounded-full text-sm font-medium ${integration.isActive\n              ? 'bg-green-100 text-green-800'\n              : 'bg-gray-100 text-gray-600'\n            }`}>\n            {integration.isActive ? 'Connected' : 'Inactive'}\n          </div>\n        </div>\n\n        <div className=\"space-y-3\">\n          <div>\n            <p className=\"text-sm text-gray-600 mb-2\">Sync Frequency</p>\n            <p className=\"text-sm font-medium text-gray-900 capitalize\">\n              {integration.syncFrequency.replace('_', ' ')}\n            </p>\n          </div>\n\n          <div>\n            <p className=\"text-sm text-gray-600 mb-2\">Field Mappings</p>\n            <p className=\"text-sm text-gray-700\">{integration.mapping.length} fields mapped</p>\n          </div>\n\n          {integration.isActive && (\n            <div className=\"bg-blue-50 rounded-lg p-3\">\n              <div className=\"flex items-center text-blue-700 mb-1\">\n                <CheckCircle className=\"w-4 h-4 mr-2\" />\n                <span className=\"text-sm font-medium\">Last Sync: 9:30 AM</span>\n              </div>\n              <p className=\"text-xs text-blue-600\">45 records synchronized successfully</p>\n            </div>\n          )}\n\n          <button className={`w-full py-2 px-4 rounded-lg font-medium transition ${integration.isActive\n              ? 'bg-red-100 text-red-600 hover:bg-red-200'\n              : 'bg-indigo-600 text-white hover:bg-indigo-700'\n            }`}>\n            {integration.isActive ? 'Disconnect' : 'Connect'}\n          </button>\n        </div>\n      </div>\n    );\n  };\n\n  const CommunicationCard = ({ template }: { template: CommunicationTemplate }) => (\n    <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <div className=\"flex items-center space-x-3\">\n          <div className={`p-2 rounded-lg ${template.isActive ? 'bg-blue-100' : 'bg-gray-100'\n            }`}>\n            <Mail className={`w-5 h-5 ${template.isActive ? 'text-blue-600' : 'text-gray-400'\n              }`} />\n          </div>\n          <div>\n            <h3 className=\"font-semibold text-gray-900\">{template.name}</h3>\n            <p className=\"text-sm text-gray-600 capitalize\">{template.type.replace('_', ' ')}</p>\n          </div>\n        </div>\n        <div className={`px-2 py-1 rounded-full text-xs font-medium ${template.isActive ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'\n          }`}>\n          {template.isActive ? 'Active' : 'Inactive'}\n        </div>\n      </div>\n\n      <div className=\"space-y-3\">\n        <div>\n          <p className=\"text-sm text-gray-600 mb-1\">Channels</p>\n          <div className=\"flex flex-wrap gap-1\">\n            {template.channels.map(channel => (\n              <span key={channel} className=\"px-2 py-1 bg-indigo-100 text-indigo-700 text-xs rounded\">\n                {channel}\n              </span>\n            ))}\n          </div>\n        </div>\n\n        <div>\n          <p className=\"text-sm text-gray-600 mb-1\">Trigger</p>\n          <p className=\"text-sm text-gray-900\">{template.trigger.replace('_', ' ')}</p>\n        </div>\n\n        {template.isActive && (\n          <div className=\"bg-green-50 rounded-lg p-3\">\n            <div className=\"flex items-center justify-between text-sm\">\n              <span className=\"text-green-700\">Sent today:</span>\n              <span className=\"font-medium text-green-900\">\n                {Math.floor(Math.random() * 20)}\n              </span>\n            </div>\n            <div className=\"flex items-center justify-between text-sm mt-1\">\n              <span className=\"text-green-700\">Success rate:</span>\n              <span className=\"font-medium text-green-900\">\n                {(95 + Math.random() * 5).toFixed(1)}%\n              </span>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <Link className=\"w-12 h-12 text-indigo-600 mx-auto mb-4 animate-pulse\" />\n          <p className=\"text-gray-600\">Loading integrations...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <div className=\"bg-white border-b border-gray-200 px-6 py-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-2xl font-bold text-gray-900 flex items-center\">\n              <Link className=\"w-8 h-8 text-indigo-600 mr-3\" />\n              ð Smart Integrations\n            </h1>\n            <p className=\"text-gray-600 mt-1\">\n              Seamless data flow eliminating 15-20 hours of manual work monthly\n            </p>\n          </div>\n        </div>\n\n        {/* Tab Navigation */}\n        <div className=\"flex space-x-6 mt-4\">\n          {[\n            { id: 'overview', label: 'ð Overview', icon: TrendingUp },\n            { id: 'integrations', label: 'ð Integrations', icon: Plug },\n            { id: 'communications', label: 'ð§ Communications', icon: Mail },\n            { id: 'sequences', label: 'ð Sequences', icon: Zap }\n          ].map(tab => (\n            <button\n              key={tab.id}\n              onClick={() => setActiveTab(tab.id as any)}\n              className={`px-4 py-2 rounded-lg font-medium transition ${activeTab === tab.id\n                  ? 'bg-indigo-100 text-indigo-700 border border-indigo-200'\n                  : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'\n                }`}\n            >\n              {tab.label}\n            </button>\n          ))}\n        </div>\n      </div>\n\n      <div className=\"p-6\">\n        {activeTab === 'overview' && dashboardData && (\n          <div className=\"space-y-6\">\n            {/* Quick Stats */}\n            <div className=\"grid grid-cols-4 gap-6\">\n              <div className=\"bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-6 text-white\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-blue-100\">Total Integrations</p>\n                    <p className=\"text-3xl font-bold\">{dashboardData.total_integrations}</p>\n                  </div>\n                  <Plug className=\"w-10 h-10 text-blue-200\" />\n                </div>\n              </div>\n\n              <div className=\"bg-gradient-to-r from-green-500 to-green-600 rounded-xl p-6 text-white\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-green-100\">Active Connections</p>\n                    <p className=\"text-3xl font-bold\">{dashboardData.active_integrations}</p>\n                  </div>\n                  <CheckCircle className=\"w-10 h-10 text-green-200\" />\n                </div>\n              </div>\n\n              <div className=\"bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl p-6 text-white\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-purple-100\">Messages Sent Today</p>\n                    <p className=\"text-3xl font-bold\">\n                      {dashboardData.communication_stats.reduce((sum: number, stat: any) => sum + stat.sent_today, 0)}\n                    </p>\n                  </div>\n                  <Mail className=\"w-10 h-10 text-purple-200\" />\n                </div>\n              </div>\n\n              <div className=\"bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl p-6 text-white\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-orange-100\">Time Saved</p>\n                    <p className=\"text-3xl font-bold\">18h</p>\n                    <p className=\"text-orange-100 text-sm\">This week</p>\n                  </div>\n                  <Clock className=\"w-10 h-10 text-orange-200\" />\n                </div>\n              </div>\n            </div>\n\n            {/* Sync Status */}\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">ð Recent Sync Activity</h3>\n              <div className=\"space-y-3\">\n                {dashboardData.sync_status.map((sync: any, index: number) => (\n                  <div key={index} className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n                    <div className=\"flex items-center space-x-3\">\n                      <CheckCircle className=\"w-5 h-5 text-green-500\" />\n                      <div>\n                        <p className=\"font-medium text-gray-900\">{sync.integration}</p>\n                        <p className=\"text-sm text-gray-600\">Last sync: {sync.last_sync}</p>\n                      </div>\n                    </div>\n                    <div className=\"text-sm text-green-600 font-medium\">Success</div>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            {/* Communication Performance */}\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">ð Communication Performance</h3>\n              <div className=\"grid grid-cols-2 gap-6\">\n                {dashboardData.communication_stats.slice(0, 4).map((stat: any, index: number) => (\n                  <div key={index} className=\"border border-gray-200 rounded-lg p-4\">\n                    <h4 className=\"font-medium text-gray-900 mb-2\">{stat.template}</h4>\n                    <div className=\"flex items-center justify-between mb-2\">\n                      <span className=\"text-sm text-gray-600\">Sent today</span>\n                      <span className=\"font-medium text-gray-900\">{stat.sent_today}</span>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-sm text-gray-600\">Success rate</span>\n                      <span className=\"font-medium text-green-600\">\n                        {(stat.success_rate * 100).toFixed(1)}%\n                      </span>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        )}\n\n        {activeTab === 'integrations' && (\n          <div className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-xl font-semibold text-gray-900\">Available Integrations</h2>\n              <button className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition\">\n                Add Integration\n              </button>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {integrations.map(integration => (\n                <IntegrationCard key={integration.id} integration={integration} />\n              ))}\n            </div>\n\n            {/* Integration Benefits */}\n            <div className=\"bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl p-6 text-white\">\n              <h3 className=\"text-xl font-bold mb-4\">ð¡ Integration Benefits</h3>\n              <div className=\"grid grid-cols-2 gap-6\">\n                <div>\n                  <h4 className=\"font-semibold mb-2\">Time Savings</h4>\n                  <ul className=\"text-indigo-100 text-sm space-y-1\">\n                    <li>â¢ Eliminate duplicate data entry</li>\n                    <li>â¢ Automatic payroll updates</li>\n                    <li>â¢ Real-time benefits sync</li>\n                    <li>â¢ Instant calendar integration</li>\n                  </ul>\n                </div>\n                <div>\n                  <h4 className=\"font-semibold mb-2\">Data Accuracy</h4>\n                  <ul className=\"text-indigo-100 text-sm space-y-1\">\n                    <li>â¢ Single source of truth</li>\n                    <li>â¢ Automated error checking</li>\n                    <li>â¢ Consistent data formats</li>\n                    <li>â¢ Real-time synchronization</li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {activeTab === 'communications' && (\n          <div className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-xl font-semibold text-gray-900\">Communication Templates</h2>\n              <button className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition\">\n                Create Template\n              </button>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {templates.map(template => (\n                <CommunicationCard key={template.id} template={template} />\n              ))}\n            </div>\n\n            {/* Communication Analytics */}\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">ð Communication Analytics</h3>\n              <div className=\"grid grid-cols-4 gap-4\">\n                <div className=\"text-center\">\n                  <p className=\"text-2xl font-bold text-indigo-600\">156</p>\n                  <p className=\"text-sm text-gray-600\">Emails sent today</p>\n                </div>\n                <div className=\"text-center\">\n                  <p className=\"text-2xl font-bold text-green-600\">98.2%</p>\n                  <p className=\"text-sm text-gray-600\">Delivery rate</p>\n                </div>\n                <div className=\"text-center\">\n                  <p className=\"text-2xl font-bold text-blue-600\">67%</p>\n                  <p className=\"text-sm text-gray-600\">Open rate</p>\n                </div>\n                <div className=\"text-center\">\n                  <p className=\"text-2xl font-bold text-purple-600\">23%</p>\n                  <p className=\"text-sm text-gray-600\">Click rate</p>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {activeTab === 'sequences' && (\n          <div className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-xl font-semibold text-gray-900\">Automation Sequences</h2>\n              <button className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition\">\n                Create Sequence\n              </button>\n            </div>\n\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n              {integrationEngine.getAutomationSequences().map(sequence => (\n                <div key={sequence.id} className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n                  <div className=\"flex items-center justify-between mb-4\">\n                    <div>\n                      <h3 className=\"font-semibold text-gray-900\">{sequence.name}</h3>\n                      <p className=\"text-sm text-gray-600\">Trigger: {sequence.trigger.replace('_', ' ')}</p>\n                    </div>\n                    <div className={`px-2 py-1 rounded-full text-xs font-medium ${sequence.isActive ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'\n                      }`}>\n                      {sequence.isActive ? 'Active' : 'Inactive'}\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-3\">\n                    <div>\n                      <p className=\"text-sm text-gray-600 mb-2\">Sequence Steps</p>\n                      <div className=\"space-y-2\">\n                        {sequence.steps.slice(0, 3).map((step, index) => (\n                          <div key={index} className=\"flex items-center space-x-3\">\n                            <div className=\"w-6 h-6 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center text-xs font-medium\">\n                              {index + 1}\n                            </div>\n                            <p className=\"text-sm text-gray-700\">\n                              {step.action.replace('_', ' ')} ({sequence.delays[index]} days)\n                            </p>\n                          </div>\n                        ))}\n                        {sequence.steps.length > 3 && (\n                          <p className=\"text-xs text-gray-500 ml-9\">\n                            +{sequence.steps.length - 3} more steps\n                          </p>\n                        )}\n                      </div>\n                    </div>\n\n                    <div className=\"bg-blue-50 rounded-lg p-3\">\n                      <div className=\"flex items-center justify-between text-sm\">\n                        <span className=\"text-blue-700\">Active instances:</span>\n                        <span className=\"font-medium text-blue-900\">\n                          {Math.floor(Math.random() * 15) + 5}\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/InterviewFeedbackForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":9}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { useTenant } from '@/contexts/TenantContext';\nimport {\n    Star, ThumbsUp, ThumbsDown, MessageSquare, Send,\n    User, Calendar, CheckCircle, AlertCircle, X\n} from 'lucide-react';\nimport { format } from 'date-fns';\n\ninterface InterviewFeedbackFormProps {\n    interviewId?: string;\n    candidateName: string;\n    position: string;\n    interviewDate: string;\n    onClose: () => void;\n    onSubmit?: (feedback: InterviewFeedback) => void;\n}\n\ninterface InterviewFeedback {\n    overall_rating: number;\n    technical_skills: number;\n    communication: number;\n    cultural_fit: number;\n    leadership_potential: number;\n    strengths: string;\n    areas_for_improvement: string;\n    notes: string;\n    recommendation: 'strongly_hire' | 'hire' | 'maybe' | 'no_hire' | 'strongly_no_hire';\n}\n\nconst ratingLabels = {\n    1: 'Poor',\n    2: 'Below Average',\n    3: 'Average',\n    4: 'Good',\n    5: 'Excellent'\n};\n\nconst recommendationOptions = [\n    { value: 'strongly_hire', label: 'Strongly Hire', color: 'bg-green-600', icon: <ThumbsUp className=\"w-4 h-4\" /> },\n    { value: 'hire', label: 'Hire', color: 'bg-green-500', icon: <ThumbsUp className=\"w-4 h-4\" /> },\n    { value: 'maybe', label: 'Maybe', color: 'bg-yellow-500', icon: <MessageSquare className=\"w-4 h-4\" /> },\n    { value: 'no_hire', label: 'No Hire', color: 'bg-red-500', icon: <ThumbsDown className=\"w-4 h-4\" /> },\n    { value: 'strongly_no_hire', label: 'Strongly No Hire', color: 'bg-red-600', icon: <ThumbsDown className=\"w-4 h-4\" /> },\n];\n\nexport default function InterviewFeedbackForm({\n    interviewId,\n    candidateName,\n    position,\n    interviewDate,\n    onClose,\n    onSubmit\n}: InterviewFeedbackFormProps) {\n    const { user } = useAuth();\n    const { currentTenant } = useTenant();\n    const [loading, setLoading] = useState(false);\n    const [success, setSuccess] = useState(false);\n    const [error, setError] = useState<string | null>(null);\n    const [feedback, setFeedback] = useState<InterviewFeedback>({\n        overall_rating: 0,\n        technical_skills: 0,\n        communication: 0,\n        cultural_fit: 0,\n        leadership_potential: 0,\n        strengths: '',\n        areas_for_improvement: '',\n        notes: '',\n        recommendation: 'maybe',\n    });\n\n    function StarRating({\n        value,\n        onChange,\n        label\n    }: {\n        value: number;\n        onChange: (v: number) => void;\n        label: string;\n    }) {\n        return (\n            <div>\n                <div className=\"flex items-center justify-between mb-1\">\n                    <span className=\"text-sm font-medium text-gray-700\">{label}</span>\n                    {value > 0 && (\n                        <span className=\"text-xs text-gray-500\">{ratingLabels[value as keyof typeof ratingLabels]}</span>\n                    )}\n                </div>\n                <div className=\"flex space-x-1\">\n                    {[1, 2, 3, 4, 5].map(star => (\n                        <button\n                            key={star}\n                            type=\"button\"\n                            onClick={() => onChange(star)}\n                            className=\"focus:outline-none transition-transform hover:scale-110\"\n                        >\n                            <Star\n                                className={`w-8 h-8 ${star <= value\n                                    ? 'fill-yellow-400 text-yellow-400'\n                                    : 'text-gray-300 hover:text-yellow-300'\n                                    }`}\n                            />\n                        </button>\n                    ))}\n                </div>\n            </div>\n        );\n    }\n\n    async function handleSubmit(e: React.FormEvent) {\n        e.preventDefault();\n        setLoading(true);\n        setError(null);\n\n        try {\n            // Validation\n            if (feedback.overall_rating === 0) {\n                throw new Error('Please provide an overall rating');\n            }\n\n            if (!feedback.recommendation) {\n                throw new Error('Please select a recommendation');\n            }\n\n            const { error: submitError } = await supabase\n                .from('interview_feedback')\n                .insert({\n                    interview_id: interviewId,\n                    interviewer_id: user?.id,\n                    tenant_id: currentTenant?.id,\n                    ...feedback,\n                    submitted_at: new Date().toISOString(),\n                });\n\n            if (submitError) throw submitError;\n\n            setSuccess(true);\n            onSubmit?.(feedback);\n\n            setTimeout(() => onClose(), 2000);\n        } catch (err: any) {\n            log.error('Error submitting feedback', err, { component: 'InterviewFeedbackForm', action: 'handleSubmit', metadata: { interviewId } });\n            setError(err.message || 'Failed to submit feedback');\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    return (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n            <div className=\"bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n                {/* Header */}\n                <div className=\"px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-t-2xl\">\n                    <div className=\"flex items-center justify-between\">\n                        <div>\n                            <h2 className=\"text-lg font-semibold\">Interview Feedback</h2>\n                            <p className=\"text-sm text-indigo-200\">Submit your evaluation</p>\n                        </div>\n                        <button onClick={onClose} className=\"p-2 hover:bg-white/10 rounded-lg transition\">\n                            <X className=\"w-5 h-5\" />\n                        </button>\n                    </div>\n                </div>\n\n                {/* Candidate Info */}\n                <div className=\"px-6 py-4 bg-gray-50 border-b border-gray-200\">\n                    <div className=\"flex items-center space-x-4\">\n                        <div className=\"w-12 h-12 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold\">\n                            {candidateName.split(' ').map(n => n[0]).join('').toUpperCase()}\n                        </div>\n                        <div>\n                            <h3 className=\"font-semibold text-gray-900\">{candidateName}</h3>\n                            <p className=\"text-sm text-gray-500\">{position}</p>\n                        </div>\n                        <div className=\"ml-auto text-right\">\n                            <p className=\"text-sm text-gray-600 flex items-center\">\n                                <Calendar className=\"w-4 h-4 mr-1\" />\n                                {format(new Date(interviewDate), 'PPP')}\n                            </p>\n                        </div>\n                    </div>\n                </div>\n\n                {/* Success State */}\n                {success ? (\n                    <div className=\"p-12 text-center\">\n                        <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                            <CheckCircle className=\"w-8 h-8 text-green-600\" />\n                        </div>\n                        <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Feedback Submitted!</h3>\n                        <p className=\"text-gray-500\">Thank you for your evaluation.</p>\n                    </div>\n                ) : (\n                    <form onSubmit={handleSubmit}>\n                        <div className=\"p-6 space-y-6\">\n                            {/* Error */}\n                            {error && (\n                                <div className=\"flex items-start p-4 bg-red-50 rounded-lg\">\n                                    <AlertCircle className=\"w-5 h-5 text-red-500 mr-3 flex-shrink-0 mt-0.5\" />\n                                    <p className=\"text-sm text-red-700\">{error}</p>\n                                </div>\n                            )}\n\n                            {/* Ratings Section */}\n                            <div className=\"space-y-4\">\n                                <h4 className=\"text-sm font-semibold text-gray-700 uppercase tracking-wide\">Ratings</h4>\n\n                                <div className=\"bg-indigo-50 p-4 rounded-xl\">\n                                    <StarRating\n                                        value={feedback.overall_rating}\n                                        onChange={(v) => setFeedback({ ...feedback, overall_rating: v })}\n                                        label=\"Overall Rating *\"\n                                    />\n                                </div>\n\n                                <div className=\"grid grid-cols-2 gap-4\">\n                                    <StarRating\n                                        value={feedback.technical_skills}\n                                        onChange={(v) => setFeedback({ ...feedback, technical_skills: v })}\n                                        label=\"Technical Skills\"\n                                    />\n                                    <StarRating\n                                        value={feedback.communication}\n                                        onChange={(v) => setFeedback({ ...feedback, communication: v })}\n                                        label=\"Communication\"\n                                    />\n                                    <StarRating\n                                        value={feedback.cultural_fit}\n                                        onChange={(v) => setFeedback({ ...feedback, cultural_fit: v })}\n                                        label=\"Cultural Fit\"\n                                    />\n                                    <StarRating\n                                        value={feedback.leadership_potential}\n                                        onChange={(v) => setFeedback({ ...feedback, leadership_potential: v })}\n                                        label=\"Leadership Potential\"\n                                    />\n                                </div>\n                            </div>\n\n                            {/* Recommendation */}\n                            <div>\n                                <label className=\"block text-sm font-semibold text-gray-700 uppercase tracking-wide mb-3\">\n                                    Recommendation *\n                                </label>\n                                <div className=\"flex flex-wrap gap-2\">\n                                    {recommendationOptions.map(option => (\n                                        <button\n                                            key={option.value}\n                                            type=\"button\"\n                                            onClick={() => setFeedback({ ...feedback, recommendation: option.value as any })}\n                                            className={`inline-flex items-center px-4 py-2 rounded-lg text-sm font-medium transition ${feedback.recommendation === option.value\n                                                ? `${option.color} text-white`\n                                                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                                                }`}\n                                        >\n                                            {option.icon}\n                                            <span className=\"ml-2\">{option.label}</span>\n                                        </button>\n                                    ))}\n                                </div>\n                            </div>\n\n                            {/* Text Feedback */}\n                            <div className=\"space-y-4\">\n                                <div>\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                        Key Strengths\n                                    </label>\n                                    <textarea\n                                        value={feedback.strengths}\n                                        onChange={(e) => setFeedback({ ...feedback, strengths: e.target.value })}\n                                        placeholder=\"What impressed you about this candidate?\"\n                                        rows={3}\n                                        className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none resize-none\"\n                                    />\n                                </div>\n\n                                <div>\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                        Areas for Improvement\n                                    </label>\n                                    <textarea\n                                        value={feedback.areas_for_improvement}\n                                        onChange={(e) => setFeedback({ ...feedback, areas_for_improvement: e.target.value })}\n                                        placeholder=\"What could this candidate improve on?\"\n                                        rows={3}\n                                        className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none resize-none\"\n                                    />\n                                </div>\n\n                                <div>\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                        Additional Notes\n                                    </label>\n                                    <textarea\n                                        value={feedback.notes}\n                                        onChange={(e) => setFeedback({ ...feedback, notes: e.target.value })}\n                                        placeholder=\"Any other observations or comments...\"\n                                        rows={3}\n                                        className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none resize-none\"\n                                    />\n                                </div>\n                            </div>\n                        </div>\n\n                        {/* Footer */}\n                        <div className=\"px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end space-x-3 rounded-b-2xl\">\n                            <button\n                                type=\"button\"\n                                onClick={onClose}\n                                className=\"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg transition\"\n                            >\n                                Cancel\n                            </button>\n                            <button\n                                type=\"submit\"\n                                disabled={loading}\n                                className=\"inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50\"\n                            >\n                                {loading ? (\n                                    <>\n                                        <div className=\"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full mr-2\" />\n                                        Submitting...\n                                    </>\n                                ) : (\n                                    <>\n                                        <Send className=\"w-4 h-4 mr-2\" />\n                                        Submit Feedback\n                                    </>\n                                )}\n                            </button>\n                        </div>\n                    </form>\n                )}\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/LeaveRequestForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'differenceInBusinessDays' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":51},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":90,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":90,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { Calendar, Clock, FileText, Send, X, AlertCircle, CheckCircle } from 'lucide-react';\nimport { format, addDays, differenceInBusinessDays, parseISO, eachDayOfInterval, isWeekend } from 'date-fns';\n\ninterface LeaveRequestFormProps {\n    onClose: () => void;\n    onSubmit?: (request: LeaveRequest) => void;\n}\n\ninterface LeaveRequest {\n    type: 'annual' | 'sick' | 'compassionate' | 'maternity' | 'paternity' | 'unpaid' | 'other';\n    start_date: string;\n    end_date: string;\n    reason: string;\n    half_day?: 'morning' | 'afternoon' | null;\n    contact_number?: string;\n    documents?: File[];\n}\n\nconst leaveTypes = [\n    { value: 'annual', label: 'Annual Leave', color: 'bg-blue-100 text-blue-700', balance: 25 },\n    { value: 'sick', label: 'Sick Leave', color: 'bg-red-100 text-red-700', balance: 10 },\n    { value: 'compassionate', label: 'Compassionate Leave', color: 'bg-purple-100 text-purple-700', balance: 5 },\n    { value: 'maternity', label: 'Maternity Leave', color: 'bg-pink-100 text-pink-700', balance: 52 },\n    { value: 'paternity', label: 'Paternity Leave', color: 'bg-cyan-100 text-cyan-700', balance: 2 },\n    { value: 'unpaid', label: 'Unpaid Leave', color: 'bg-gray-100 text-gray-700', balance: null },\n    { value: 'other', label: 'Other', color: 'bg-orange-100 text-orange-700', balance: null },\n];\n\nexport default function LeaveRequestForm({ onClose, onSubmit }: LeaveRequestFormProps) {\n    const { user } = useAuth();\n    const { currentTenant } = useTenant();\n    const [formData, setFormData] = useState<LeaveRequest>({\n        type: 'annual',\n        start_date: format(addDays(new Date(), 1), 'yyyy-MM-dd'),\n        end_date: format(addDays(new Date(), 1), 'yyyy-MM-dd'),\n        reason: '',\n        half_day: null,\n        contact_number: '',\n    });\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState<string | null>(null);\n    const [success, setSuccess] = useState(false);\n\n    function calculateDays(): number {\n        if (!formData.start_date || !formData.end_date) return 0;\n\n        const start = parseISO(formData.start_date);\n        const end = parseISO(formData.end_date);\n\n        if (formData.half_day) return 0.5;\n\n        // Count business days\n        const days = eachDayOfInterval({ start, end });\n        const businessDays = days.filter(day => !isWeekend(day)).length;\n\n        return businessDays;\n    }\n\n    async function handleSubmit(e: React.FormEvent) {\n        e.preventDefault();\n        setLoading(true);\n        setError(null);\n\n        try {\n            // Validation\n            if (!formData.reason.trim()) {\n                throw new Error('Please provide a reason for your leave request');\n            }\n\n            const startDate = parseISO(formData.start_date);\n            const endDate = parseISO(formData.end_date);\n\n            if (endDate < startDate) {\n                throw new Error('End date must be after start date');\n            }\n\n            const days = calculateDays();\n            const selectedType = leaveTypes.find(t => t.value === formData.type);\n\n            if (selectedType?.balance && days > selectedType.balance) {\n                throw new Error(`Insufficient ${selectedType.label} balance. You have ${selectedType.balance} days available.`);\n            }\n\n            // Submit to database\n            const { data, error: submitError } = await supabase\n                .from('leave_requests')\n                .insert({\n                    employee_id: user?.id,\n                    tenant_id: currentTenant?.id,\n                    leave_type: formData.type,\n                    start_date: formData.start_date,\n                    end_date: formData.end_date,\n                    total_days: days,\n                    reason: formData.reason,\n                    half_day: formData.half_day,\n                    contact_number: formData.contact_number,\n                    status: 'pending',\n                })\n                .select()\n                .single();\n\n            if (submitError) throw submitError;\n\n            setSuccess(true);\n            onSubmit?.(formData);\n\n            setTimeout(() => {\n                onClose();\n            }, 2000);\n        } catch (err: any) {\n            log.error('Error submitting leave request', err, { component: 'LeaveRequestForm', action: 'handleSubmit' });\n            setError(err.message || 'Failed to submit leave request');\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    const selectedLeaveType = leaveTypes.find(t => t.value === formData.type);\n    const daysRequested = calculateDays();\n\n    return (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n            <div className=\"bg-white rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto\">\n                {/* Header */}\n                <div className=\"px-6 py-4 border-b border-gray-200 flex items-center justify-between\">\n                    <div>\n                        <h2 className=\"text-lg font-semibold text-gray-900\">Request Leave</h2>\n                        <p className=\"text-sm text-gray-500\">Submit a new leave request</p>\n                    </div>\n                    <button onClick={onClose} className=\"p-2 text-gray-400 hover:text-gray-600 rounded-lg\">\n                        <X className=\"w-5 h-5\" />\n                    </button>\n                </div>\n\n                {/* Success Message */}\n                {success ? (\n                    <div className=\"p-12 text-center\">\n                        <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                            <CheckCircle className=\"w-8 h-8 text-green-600\" />\n                        </div>\n                        <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Request Submitted!</h3>\n                        <p className=\"text-gray-500\">Your leave request has been sent for approval.</p>\n                    </div>\n                ) : (\n                    <form onSubmit={handleSubmit}>\n                        <div className=\"p-6 space-y-6\">\n                            {/* Error Message */}\n                            {error && (\n                                <div className=\"flex items-start p-4 bg-red-50 rounded-lg\">\n                                    <AlertCircle className=\"w-5 h-5 text-red-500 mr-3 flex-shrink-0 mt-0.5\" />\n                                    <p className=\"text-sm text-red-700\">{error}</p>\n                                </div>\n                            )}\n\n                            {/* Leave Type */}\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Leave Type</label>\n                                <div className=\"grid grid-cols-2 gap-2\">\n                                    {leaveTypes.map(type => (\n                                        <button\n                                            key={type.value}\n                                            type=\"button\"\n                                            onClick={() => setFormData({ ...formData, type: type.value as any })}\n                                            className={`p-3 rounded-lg border-2 text-left transition ${formData.type === type.value\n                                                ? 'border-indigo-500 bg-indigo-50'\n                                                : 'border-gray-200 hover:border-gray-300'\n                                                }`}\n                                        >\n                                            <p className=\"text-sm font-medium text-gray-900\">{type.label}</p>\n                                            {type.balance !== null && (\n                                                <p className=\"text-xs text-gray-500\">{type.balance} days available</p>\n                                            )}\n                                        </button>\n                                    ))}\n                                </div>\n                            </div>\n\n                            {/* Date Range */}\n                            <div className=\"grid grid-cols-2 gap-4\">\n                                <div>\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Start Date</label>\n                                    <div className=\"relative\">\n                                        <Calendar className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                                        <input\n                                            type=\"date\"\n                                            value={formData.start_date}\n                                            onChange={(e) => setFormData({ ...formData, start_date: e.target.value })}\n                                            min={format(new Date(), 'yyyy-MM-dd')}\n                                            className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none\"\n                                            required\n                                        />\n                                    </div>\n                                </div>\n                                <div>\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">End Date</label>\n                                    <div className=\"relative\">\n                                        <Calendar className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                                        <input\n                                            type=\"date\"\n                                            value={formData.end_date}\n                                            onChange={(e) => setFormData({ ...formData, end_date: e.target.value })}\n                                            min={formData.start_date}\n                                            className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none\"\n                                            required\n                                        />\n                                    </div>\n                                </div>\n                            </div>\n\n                            {/* Half Day Option */}\n                            {formData.start_date === formData.end_date && (\n                                <div>\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">Half Day?</label>\n                                    <div className=\"flex space-x-2\">\n                                        <button\n                                            type=\"button\"\n                                            onClick={() => setFormData({ ...formData, half_day: null })}\n                                            className={`flex-1 py-2 px-4 rounded-lg border-2 text-sm font-medium transition ${formData.half_day === null\n                                                ? 'border-indigo-500 bg-indigo-50 text-indigo-700'\n                                                : 'border-gray-200 text-gray-600 hover:border-gray-300'\n                                                }`}\n                                        >\n                                            Full Day\n                                        </button>\n                                        <button\n                                            type=\"button\"\n                                            onClick={() => setFormData({ ...formData, half_day: 'morning' })}\n                                            className={`flex-1 py-2 px-4 rounded-lg border-2 text-sm font-medium transition ${formData.half_day === 'morning'\n                                                ? 'border-indigo-500 bg-indigo-50 text-indigo-700'\n                                                : 'border-gray-200 text-gray-600 hover:border-gray-300'\n                                                }`}\n                                        >\n                                            Morning\n                                        </button>\n                                        <button\n                                            type=\"button\"\n                                            onClick={() => setFormData({ ...formData, half_day: 'afternoon' })}\n                                            className={`flex-1 py-2 px-4 rounded-lg border-2 text-sm font-medium transition ${formData.half_day === 'afternoon'\n                                                ? 'border-indigo-500 bg-indigo-50 text-indigo-700'\n                                                : 'border-gray-200 text-gray-600 hover:border-gray-300'\n                                                }`}\n                                        >\n                                            Afternoon\n                                        </button>\n                                    </div>\n                                </div>\n                            )}\n\n                            {/* Days Summary */}\n                            <div className=\"p-4 bg-indigo-50 rounded-lg\">\n                                <div className=\"flex items-center justify-between\">\n                                    <span className=\"text-sm text-indigo-700\">Days Requested:</span>\n                                    <span className=\"text-lg font-bold text-indigo-900\">{daysRequested} {daysRequested === 1 ? 'day' : 'days'}</span>\n                                </div>\n                                {selectedLeaveType?.balance !== null && (\n                                    <div className=\"flex items-center justify-between mt-1\">\n                                        <span className=\"text-xs text-indigo-600\">Remaining Balance:</span>\n                                        <span className=\"text-sm font-medium text-indigo-800\">\n                                            {(selectedLeaveType?.balance || 0) - daysRequested} days\n                                        </span>\n                                    </div>\n                                )}\n                            </div>\n\n                            {/* Reason */}\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Reason</label>\n                                <textarea\n                                    value={formData.reason}\n                                    onChange={(e) => setFormData({ ...formData, reason: e.target.value })}\n                                    placeholder=\"Brief description of your leave request...\"\n                                    rows={3}\n                                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none resize-none\"\n                                    required\n                                />\n                            </div>\n\n                            {/* Contact Number */}\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                    Emergency Contact (Optional)\n                                </label>\n                                <input\n                                    type=\"tel\"\n                                    value={formData.contact_number}\n                                    onChange={(e) => setFormData({ ...formData, contact_number: e.target.value })}\n                                    placeholder=\"+44 7...\"\n                                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none\"\n                                />\n                            </div>\n                        </div>\n\n                        {/* Footer */}\n                        <div className=\"px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end space-x-3\">\n                            <button\n                                type=\"button\"\n                                onClick={onClose}\n                                className=\"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg transition\"\n                            >\n                                Cancel\n                            </button>\n                            <button\n                                type=\"submit\"\n                                disabled={loading}\n                                className=\"inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50\"\n                            >\n                                {loading ? (\n                                    <>\n                                        <div className=\"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full mr-2\" />\n                                        Submitting...\n                                    </>\n                                ) : (\n                                    <>\n                                        <Send className=\"w-4 h-4 mr-2\" />\n                                        Submit Request\n                                    </>\n                                )}\n                            </button>\n                        </div>\n                    </form>\n                )}\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/MobileApp.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MessageSquare' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":63,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":76},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Check' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":114,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":119},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'analyticsEngine' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":25},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadMobileData'. Either include it or remove the dependency array.","line":25,"column":6,"nodeType":"ArrayExpression","endLine":25,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [currentTenant, loadMobileData]","fix":{"range":[1187,1202],"text":"[currentTenant, loadMobileData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Smartphone, Bell, Clock, Users, Briefcase, Calendar, MessageSquare, FileText, TrendingUp, Zap, Loader2, Check, CheckCircle } from 'lucide-react';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { analyticsEngine } from '../lib/analyticsEngine';\nimport { businessIntelligence } from '../lib/businessIntelligence';\n\nexport default function MobileApp() {\n  const { currentTenant } = useTenant();\n  const { user } = useAuth();\n  const [activeTab, setActiveTab] = useState<'dashboard' | 'tasks' | 'approvals' | 'insights'>('dashboard');\n  const [notifications, setNotifications] = useState<any[]>([]);\n  const [quickStats, setQuickStats] = useState<any>(null);\n  const [businessAlerts, setBusinessAlerts] = useState<any>(null);\n  const [approvals, setApprovals] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [actionLoading, setActionLoading] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (currentTenant) {\n      loadMobileData();\n    }\n  }, [currentTenant]);\n\n  const loadMobileData = async () => {\n    setLoading(true);\n    try {\n      // 1. Fetch Real Stats\n      const stats = {\n        active_jobs: 0,\n        applications_today: 0,\n        pending_interviews: 0,\n        automation_savings_today: 0\n      };\n\n      const [jobsRes, appsRes, interviewsRes, leaveRes] = await Promise.all([\n        supabase.from('jobs').select('*', { count: 'exact', head: true }).eq('tenant_id', currentTenant?.id).eq('status', 'published'),\n        supabase.from('applications').select('*', { count: 'exact', head: true }).eq('tenant_id', currentTenant?.id).gte('created_at', new Date(new Date().setHours(0, 0, 0, 0)).toISOString()),\n        supabase.from('interviews').select('*', { count: 'exact', head: true }).eq('tenant_id', currentTenant?.id).gte('scheduled_at', new Date().toISOString()),\n        supabase.from('leave_requests').select('*, employees(first_name, last_name)').eq('tenant_id', currentTenant?.id).eq('status', 'pending')\n      ]);\n\n      stats.active_jobs = jobsRes.count || 0;\n      stats.applications_today = appsRes.count || 0;\n      stats.pending_interviews = interviewsRes.count || 0;\n      stats.automation_savings_today = 12; // Mock for now\n\n      setQuickStats(stats);\n      setApprovals(leaveRes.data || []);\n\n      const alerts = businessIntelligence.getBusinessAlerts();\n      setBusinessAlerts(alerts);\n\n      // 2. Fetch/Prepare Notifications\n      const mockNotifications = [\n        {\n          id: 'n1',\n          type: 'approval',\n          title: 'New Leave Request',\n          message: `${leaveRes.data?.[0]?.employees?.first_name || 'An employee'} requested leave`,\n          time: 'Just now',\n          priority: 'medium'\n        },\n        {\n          id: 'n2',\n          type: 'insight',\n          title: 'Critical Engagement Alert',\n          message: 'Sarah Chen shows turnover risk indicators',\n          time: '1h ago',\n          priority: 'high'\n        }\n      ].filter(n => (leaveRes.data?.length || 0) > 0 || n.id === 'n2');\n\n      setNotifications(mockNotifications);\n\n    } catch (error) {\n      log.error('Failed to load mobile data', error, { component: 'MobileApp', action: 'loadMobileData' });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleApproval = async (requestId: string, status: 'approved' | 'rejected') => {\n    setActionLoading(requestId);\n    try {\n      const { error } = await supabase\n        .from('leave_requests')\n        .update({ status, reviewed_at: new Date().toISOString(), reviewed_by: user?.id })\n        .eq('id', requestId);\n\n      if (error) throw error;\n\n      setApprovals(prev => prev.filter(r => r.id !== requestId));\n    } catch (error) {\n      log.error('Error processing leave request', error, { component: 'MobileApp', action: 'handleApproval' });\n    } finally {\n      setActionLoading(null);\n    }\n  };\n\n  const QuickActionCard = ({ icon: Icon, title, value, trend, color }: any) => (\n    <div className=\"bg-white rounded-xl p-4 shadow-sm border border-gray-100 transition-all active:scale-95\">\n      <div className=\"flex items-center justify-between mb-2\">\n        <div className={`p-2 rounded-lg ${color.replace('text-', 'bg-').replace('600', '100')}`}>\n          <Icon className={`w-5 h-5 ${color}`} />\n        </div>\n        {trend && (\n          <div className={`px-2 py-1 rounded-full text-[10px] font-bold ${trend === 'up' ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'}`}>\n            {trend === 'up' ? 'â' : 'â'} 12%\n          </div>\n        )}\n      </div>\n      <p className=\"text-[10px] font-bold text-gray-400 uppercase tracking-tight\">{title}</p>\n      <p className=\"text-xl font-bold text-gray-900\">{value}</p>\n    </div>\n  );\n\n  const NotificationItem = ({ notification }: { notification: any }) => (\n    <div className=\"bg-white rounded-xl p-4 shadow-sm border-l-4 border-indigo-500 mb-3 animate-in fade-in slide-in-from-right-4\">\n      <div className=\"flex items-start justify-between mb-1\">\n        <h3 className=\"font-bold text-gray-900 text-sm\">{notification.title}</h3>\n        <span className=\"text-[10px] text-gray-400 font-medium\">{notification.time}</span>\n      </div>\n      <p className=\"text-xs text-gray-600 mb-3 leading-relaxed\">{notification.message}</p>\n      <div className=\"flex space-x-2\">\n        {notification.type === 'approval' && (\n          <button\n            onClick={() => setActiveTab('approvals')}\n            className=\"px-3 py-1.5 bg-indigo-50 text-indigo-600 text-[10px] font-bold uppercase rounded-lg hover:bg-indigo-100 transition-colors\"\n          >\n            Review Requests\n          </button>\n        )}\n        {notification.type === 'insight' && (\n          <button\n            onClick={() => setActiveTab('insights')}\n            className=\"px-3 py-1.5 bg-purple-50 text-purple-600 text-[10px] font-bold uppercase rounded-lg hover:bg-purple-100 transition-colors\"\n          >\n            View Retention Plan\n          </button>\n        )}\n      </div>\n    </div>\n  );\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center p-6 text-center\">\n        <div>\n          <div className=\"relative w-16 h-16 mx-auto mb-4\">\n            <Smartphone className=\"w-16 h-16 text-indigo-600 animate-bounce\" />\n            <Loader2 className=\"absolute top-0 right-0 w-6 h-6 text-indigo-400 animate-spin\" />\n          </div>\n          <p className=\"text-indigo-900 font-bold uppercase tracking-widest text-xs\">NovumFlow Mobile</p>\n          <p className=\"text-gray-400 text-xs mt-1\">Syncing secure HR intelligence...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-[#FDFDFF] pb-24 font-sans antialiased\">\n      {/* Premium Header */}\n      <div className=\"bg-gradient-to-br from-indigo-600 to-indigo-800 text-white p-6 pb-12 rounded-b-[2rem] shadow-xl\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <div>\n            <h1 className=\"text-2xl font-black tracking-tighter\">NovumFlow</h1>\n            <p className=\"text-indigo-200 text-[10px] uppercase font-bold tracking-widest\">Executive Mobility</p>\n          </div>\n          <div className=\"flex items-center space-x-3\">\n            <button className=\"relative p-2 bg-white/10 rounded-full hover:bg-white/20 transition-colors\">\n              <Bell className=\"w-5 h-5\" />\n              {notifications.length > 0 && (\n                <span className=\"absolute top-1.5 right-1.5 bg-red-500 w-2 h-2 rounded-full border-2 border-indigo-700\"></span>\n              )}\n            </button>\n            <div className=\"w-10 h-10 rounded-full border-2 border-white/20 overflow-hidden shadow-lg\">\n              <img src={`https://ui-avatars.com/api/?name=${user?.email}&background=6366f1&color=fff`} alt=\"Avatar\" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Floating Quick Stats */}\n      <div className=\"px-5 -mt-8\">\n        <div className=\"grid grid-cols-2 gap-4\">\n          <QuickActionCard\n            icon={Briefcase}\n            title=\"Jobs\"\n            value={quickStats?.active_jobs || 0}\n            color=\"text-indigo-600\"\n          />\n          <QuickActionCard\n            icon={Users}\n            title=\"Apps\"\n            value={quickStats?.applications_today || 0}\n            trend=\"up\"\n            color=\"text-emerald-600\"\n          />\n        </div>\n      </div>\n\n      {/* Tab Content Area */}\n      <div className=\"p-5 mt-2\">\n        {activeTab === 'dashboard' && (\n          <div className=\"space-y-6\">\n            {/* Secondary Stats */}\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"bg-white p-4 rounded-xl shadow-sm border border-gray-100\">\n                <div className=\"flex items-center gap-2 mb-2 text-orange-500\">\n                  <Calendar className=\"w-4 h-4\" />\n                  <span className=\"text-[10px] font-bold uppercase\">Interviews</span>\n                </div>\n                <p className=\"text-xl font-bold\">{quickStats?.pending_interviews || 0}</p>\n              </div>\n              <div className=\"bg-white p-4 rounded-xl shadow-sm border border-gray-100\">\n                <div className=\"flex items-center gap-2 mb-2 text-purple-500\">\n                  <Zap className=\"w-4 h-4\" />\n                  <span className=\"text-[10px] font-bold uppercase\">Saved HT</span>\n                </div>\n                <p className=\"text-xl font-bold\">{quickStats?.automation_savings_today || 0}h</p>\n              </div>\n            </div>\n\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-sm font-black uppercase tracking-wider text-gray-900\">Priority Alerts</h2>\n              <span className=\"text-[10px] font-bold text-indigo-600\">View All</span>\n            </div>\n\n            <div className=\"space-y-0\">\n              {notifications.length > 0 ? (\n                notifications.map(notification => (\n                  <NotificationItem key={notification.id} notification={notification} />\n                ))\n              ) : (\n                <div className=\"text-center py-10 bg-gray-50 rounded-xl border-2 border-dashed border-gray-200\">\n                  <CheckCircle className=\"w-8 h-8 text-gray-300 mx-auto mb-2\" />\n                  <p className=\"text-xs text-gray-500 font-medium\">All clear for today!</p>\n                </div>\n              )}\n            </div>\n\n            {businessAlerts && (\n              <div className=\"space-y-3\">\n                <h2 className=\"text-sm font-black uppercase tracking-wider text-gray-900\">Intelligence Insights</h2>\n                {businessAlerts.opportunities.slice(0, 1).map((alert: string, i: number) => (\n                  <div key={i} className=\"bg-indigo-900 text-white p-4 rounded-xl shadow-lg relative overflow-hidden group\">\n                    <Zap className=\"absolute -right-4 -bottom-4 w-24 h-24 text-white/10 group-hover:scale-110 transition-transform\" />\n                    <h3 className=\"font-bold text-xs mb-1 uppercase tracking-widest text-indigo-300\">Growth Opportunity</h3>\n                    <p className=\"text-xs leading-relaxed pr-8\">{alert}</p>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        )}\n\n        {activeTab === 'tasks' && (\n          <div className=\"space-y-4 animate-in slide-in-from-bottom-5\">\n            <h2 className=\"text-sm font-black uppercase tracking-wider text-gray-900\">Operational Queue</h2>\n            {[\n              { task: 'Review Diversity Report', priority: 'High', type: 'compliance' },\n              { task: 'Calibrate Compensation', priority: 'Medium', type: 'finance' },\n              { task: 'Pipeline Review: CTO', priority: 'High', type: 'recruitment' }\n            ].map((task, index) => (\n              <div key={index} className=\"bg-white rounded-xl p-4 shadow-sm border border-gray-100 flex items-center gap-4\">\n                <div className={`w-2 h-10 rounded-full ${task.priority === 'High' ? 'bg-red-400' : 'bg-amber-400'}`} />\n                <div className=\"flex-1\">\n                  <h3 className=\"font-bold text-sm text-gray-900\">{task.task}</h3>\n                  <p className=\"text-[10px] text-gray-400 font-bold uppercase\">{task.type}</p>\n                </div>\n                <button className=\"p-2 bg-gray-50 rounded-lg text-indigo-600 active:bg-indigo-100\">\n                  <FileText className=\"w-4 h-4\" />\n                </button>\n              </div>\n            ))}\n          </div>\n        )}\n\n        {activeTab === 'approvals' && (\n          <div className=\"space-y-4 animate-in slide-in-from-bottom-5\">\n            <h2 className=\"text-sm font-black uppercase tracking-wider text-gray-900\">Pending Requests ({approvals.length})</h2>\n            {approvals.length > 0 ? (\n              approvals.map((approval) => (\n                <div key={approval.id} className=\"bg-white rounded-xl p-5 shadow-lg border border-gray-50 relative overflow-hidden\">\n                  {actionLoading === approval.id && (\n                    <div className=\"absolute inset-0 bg-white/80 z-20 flex items-center justify-center\">\n                      <Loader2 className=\"w-6 h-6 text-indigo-600 animate-spin\" />\n                    </div>\n                  )}\n                  <div className=\"flex items-center gap-3 mb-4\">\n                    <img\n                      src={`https://ui-avatars.com/api/?name=${approval.employees?.first_name}+${approval.employees?.last_name}&background=eff6ff&color=3b82f6`}\n                      className=\"w-10 h-10 rounded-full\"\n                      alt=\"EMP\"\n                    />\n                    <div>\n                      <h3 className=\"font-bold text-sm text-gray-900\">{approval.employees?.first_name} {approval.employees?.last_name}</h3>\n                      <p className=\"text-[10px] text-gray-400 font-bold uppercase\">Leave Request</p>\n                    </div>\n                  </div>\n                  <div className=\"bg-gray-50 rounded-lg p-3 mb-4\">\n                    <div className=\"flex justify-between text-xs mb-1\">\n                      <span className=\"text-gray-500\">Period:</span>\n                      <span className=\"font-semibold\">{new Date(approval.start_date).toLocaleDateString()} - {new Date(approval.end_date).toLocaleDateString()}</span>\n                    </div>\n                    <div className=\"flex justify-between text-xs\">\n                      <span className=\"text-gray-500\">Reason:</span>\n                      <span className=\"font-semibold truncate max-w-[150px]\">{approval.reason || 'Not specified'}</span>\n                    </div>\n                  </div>\n                  <div className=\"flex space-x-3\">\n                    <button\n                      onClick={() => handleApproval(approval.id, 'rejected')}\n                      className=\"flex-1 py-2.5 bg-gray-100 text-gray-600 rounded-xl text-xs font-bold uppercase tracking-wider hover:bg-gray-200\"\n                    >\n                      Decline\n                    </button>\n                    <button\n                      onClick={() => handleApproval(approval.id, 'approved')}\n                      className=\"flex-1 py-2.5 bg-indigo-600 text-white rounded-xl text-xs font-bold uppercase tracking-wider shadow-md active:bg-indigo-700\"\n                    >\n                      Approve\n                    </button>\n                  </div>\n                </div>\n              ))\n            ) : (\n              <div className=\"text-center py-20 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200\">\n                <CheckCircle className=\"w-12 h-12 text-emerald-200 mx-auto mb-4\" />\n                <h3 className=\"text-gray-900 font-bold\">No Pending Approvals</h3>\n                <p className=\"text-xs text-gray-400 mt-1\">You're all caught up with employee requests.</p>\n              </div>\n            )}\n          </div>\n        )}\n\n        {activeTab === 'insights' && (\n          <div className=\"space-y-4 animate-in slide-in-from-bottom-5\">\n            <h2 className=\"text-sm font-black uppercase tracking-wider text-gray-900\">Predictive Intelligence</h2>\n            <div className=\"bg-indigo-900 rounded-2xl p-6 text-white shadow-xl relative overflow-hidden\">\n              <div className=\"relative z-10\">\n                <div className=\"flex items-center gap-2 mb-4\">\n                  <div className=\"p-2 bg-white/20 rounded-lg\">\n                    <TrendingUp className=\"w-5 h-5\" />\n                  </div>\n                  <span className=\"text-xs font-bold uppercase tracking-widest text-indigo-200\">Quarterly Trajectory</span>\n                </div>\n                <p className=\"text-lg font-bold mb-2\">Hiring Velocity is up 18%</p>\n                <p className=\"text-xs text-indigo-100/70 leading-relaxed mb-6\">\n                  Based on current application flows and automation levels, your cost-per-hire is projected to drop by $450 in Q3.\n                </p>\n                <p className=\"text-xs text-indigo-100/70 leading-relaxed mb-6\">\n                  Based on current application flows and automation levels, your cost-per-hire is projected to drop by $450 in Q3.\n                </p>\n                <button className=\"w-full py-3 bg-white text-indigo-900 rounded-xl text-xs font-black uppercase tracking-widest shadow-lg\">\n                  View Detailed Forecast\n                </button>\n              </div>\n              <div className=\"absolute top-0 right-0 w-32 h-32 bg-indigo-500/10 rounded-full -mr-16 -mt-16 blur-3xl\" />\n            </div>\n\n            <div className=\"grid grid-cols-1 gap-4 mt-6\">\n              {[\n                { title: 'Retention Risk', level: 'Low', change: '-4%' },\n                { title: 'Engagement Score', level: '8.4', change: '+0.2' }\n              ].map((stat, i) => (\n                <div key={i} className=\"bg-white p-4 rounded-xl border border-gray-100 flex items-center justify-between\">\n                  <span className=\"text-xs font-bold text-gray-500 uppercase\">{stat.title}</span>\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"font-black text-gray-900\">{stat.level}</span>\n                    <span className={`text-[10px] font-bold ${stat.change.startsWith('+') ? 'text-emerald-500' : 'text-indigo-500'}`}>\n                      {stat.change}\n                    </span>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Modern Bottom Navigation */}\n      <div className=\"fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-md border-t border-gray-100 flex justify-around items-center px-4 py-3 z-50\">\n        {[\n          { id: 'dashboard', icon: TrendingUp, label: 'Feed' },\n          { id: 'tasks', icon: FileText, label: 'Work' },\n          { id: 'approvals', icon: Users, label: 'Team' },\n          { id: 'insights', icon: Zap, label: 'Insights' }\n        ].map(tab => (\n          <button\n            key={tab.id}\n            onClick={() => setActiveTab(tab.id as any)}\n            className={`flex flex-col items-center gap-1 transition-all ${activeTab === tab.id ? 'text-indigo-600 scale-110' : 'text-gray-400'}`}\n          >\n            <tab.icon className={`w-5 h-5 ${activeTab === tab.id ? 'fill-indigo-50' : ''}`} />\n            <span className=\"text-[10px] font-black uppercase tracking-tighter\">{tab.label}</span>\n          </button>\n        ))}\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/Modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/NotificationCenter.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadNotifications' and 'subscribeToNotifications'. Either include them or remove the dependency array.","line":32,"column":8,"nodeType":"ArrayExpression","endLine":32,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [currentTenant, loadNotifications, subscribeToNotifications]","fix":{"range":[1058,1073],"text":"[currentTenant, loadNotifications, subscribeToNotifications]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used. Allowed unused caught errors must match /^_/u.","line":160,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":160,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used. Allowed unused caught errors must match /^_/u.","line":175,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":175,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used. Allowed unused caught errors must match /^_/u.","line":188,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":188,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used. Allowed unused caught errors must match /^_/u.","line":201,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":201,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { Bell, X, Check, Clock, AlertTriangle, Users, FileText, Calendar, Briefcase } from 'lucide-react';\nimport { formatDistanceToNow } from 'date-fns';\n\ninterface Notification {\n    id: string;\n    type: 'info' | 'success' | 'warning' | 'error';\n    title: string;\n    message: string;\n    entity_type?: string;\n    entity_id?: string;\n    read: boolean;\n    created_at: string;\n    action_url?: string;\n}\n\nexport default function NotificationCenter() {\n    const { currentTenant } = useTenant();\n    const [notifications, setNotifications] = useState<Notification[]>([]);\n    const [isOpen, setIsOpen] = useState(false);\n    const [unreadCount, setUnreadCount] = useState(0);\n    const [loading, setLoading] = useState(false);\n\n    useEffect(() => {\n        if (currentTenant) {\n            loadNotifications();\n            subscribeToNotifications();\n        }\n    }, [currentTenant]);\n\n    useEffect(() => {\n        setUnreadCount(notifications.filter(n => !n.read).length);\n    }, [notifications]);\n\n    async function loadNotifications() {\n        if (!currentTenant) return;\n        setLoading(true);\n\n        try {\n            const { data, error } = await supabase\n                .from('careflow_notifications')\n                .select('*')\n                .eq('tenant_id', currentTenant.id)\n                .order('created_at', { ascending: false })\n                .limit(50);\n\n            if (error) throw error;\n            setNotifications(data || []);\n        } catch (error) {\n            log.error('Error loading notifications', error, { component: 'NotificationCenter', action: 'loadNotifications' });\n            // Fallback to generated notifications if table doesn't exist\n            generateMockNotifications();\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    function generateMockNotifications() {\n        // Generate realistic notifications based on app activity\n        const mockNotifications: Notification[] = [\n            {\n                id: '1',\n                type: 'info',\n                title: 'New Application Received',\n                message: 'John Smith applied for Senior Developer position',\n                entity_type: 'application',\n                read: false,\n                created_at: new Date(Date.now() - 5 * 60000).toISOString(),\n                action_url: '/recruit'\n            },\n            {\n                id: '2',\n                type: 'warning',\n                title: 'Document Expiring Soon',\n                message: 'DBS check for Sarah Johnson expires in 7 days',\n                entity_type: 'compliance',\n                read: false,\n                created_at: new Date(Date.now() - 30 * 60000).toISOString(),\n                action_url: '/compliance-hub'\n            },\n            {\n                id: '3',\n                type: 'success',\n                title: 'Interview Scheduled',\n                message: 'Technical interview confirmed for tomorrow at 2pm',\n                entity_type: 'interview',\n                read: true,\n                created_at: new Date(Date.now() - 2 * 3600000).toISOString(),\n                action_url: '/recruit'\n            },\n            {\n                id: '4',\n                type: 'info',\n                title: 'Leave Request Pending',\n                message: 'Mark Wilson requested 5 days annual leave',\n                entity_type: 'leave',\n                read: true,\n                created_at: new Date(Date.now() - 4 * 3600000).toISOString(),\n                action_url: '/hr'\n            },\n            {\n                id: '5',\n                type: 'success',\n                title: 'Training Completed',\n                message: 'Fire Safety training marked as complete',\n                entity_type: 'training',\n                read: true,\n                created_at: new Date(Date.now() - 24 * 3600000).toISOString(),\n                action_url: '/compliance-hub'\n            }\n        ];\n        setNotifications(mockNotifications);\n    }\n\n    function subscribeToNotifications() {\n        if (!currentTenant) return;\n\n        const channel = supabase\n            .channel('notifications')\n            .on(\n                'postgres_changes',\n                {\n                    event: 'INSERT',\n                    schema: 'public',\n                    table: 'careflow_notifications',\n                    filter: `tenant_id=eq.${currentTenant.id}`\n                },\n                (payload) => {\n                    setNotifications(prev => [payload.new as Notification, ...prev]);\n                    // Play notification sound\n                    playNotificationSound();\n                }\n            )\n            .subscribe();\n\n        return () => {\n            supabase.removeChannel(channel);\n        };\n    }\n\n    function playNotificationSound() {\n        // Simple notification sound using Web Audio API\n        try {\n            const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n            const oscillator = audioContext.createOscillator();\n            const gainNode = audioContext.createGain();\n\n            oscillator.connect(gainNode);\n            gainNode.connect(audioContext.destination);\n\n            oscillator.frequency.value = 440;\n            oscillator.type = 'sine';\n            gainNode.gain.value = 0.1;\n\n            oscillator.start();\n            setTimeout(() => oscillator.stop(), 150);\n        } catch (e) {\n            // Audio not supported\n        }\n    }\n\n    async function markAsRead(id: string) {\n        setNotifications(prev =>\n            prev.map(n => n.id === id ? { ...n, read: true } : n)\n        );\n\n        try {\n            await supabase\n                .from('careflow_notifications')\n                .update({ read: true })\n                .eq('id', id);\n        } catch (error) {\n            // Ignore if table doesn't exist\n        }\n    }\n\n    async function markAllAsRead() {\n        setNotifications(prev => prev.map(n => ({ ...n, read: true })));\n\n        try {\n            await supabase\n                .from('careflow_notifications')\n                .update({ read: true })\n                .eq('tenant_id', currentTenant?.id);\n        } catch (error) {\n            // Ignore if table doesn't exist\n        }\n    }\n\n    async function deleteNotification(id: string) {\n        setNotifications(prev => prev.filter(n => n.id !== id));\n\n        try {\n            await supabase\n                .from('careflow_notifications')\n                .delete()\n                .eq('id', id);\n        } catch (error) {\n            // Ignore if table doesn't exist\n        }\n    }\n\n    function getIcon(type: string, entityType?: string) {\n        if (entityType === 'application') return <Users className=\"w-4 h-4\" />;\n        if (entityType === 'compliance' || entityType === 'training') return <FileText className=\"w-4 h-4\" />;\n        if (entityType === 'interview') return <Calendar className=\"w-4 h-4\" />;\n        if (entityType === 'leave') return <Briefcase className=\"w-4 h-4\" />;\n\n        switch (type) {\n            case 'warning': return <AlertTriangle className=\"w-4 h-4\" />;\n            case 'success': return <Check className=\"w-4 h-4\" />;\n            case 'error': return <AlertTriangle className=\"w-4 h-4\" />;\n            default: return <Bell className=\"w-4 h-4\" />;\n        }\n    }\n\n    function getTypeColor(type: string) {\n        switch (type) {\n            case 'success': return 'bg-green-100 text-green-600';\n            case 'warning': return 'bg-orange-100 text-orange-600';\n            case 'error': return 'bg-red-100 text-red-600';\n            default: return 'bg-blue-100 text-blue-600';\n        }\n    }\n\n    return (\n        <div className=\"relative\">\n            {/* Notification Bell */}\n            <button\n                onClick={() => setIsOpen(!isOpen)}\n                className=\"relative p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-full transition\"\n            >\n                <Bell className=\"w-5 h-5\" />\n                {unreadCount > 0 && (\n                    <span className=\"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center text-xs font-bold text-white bg-red-500 rounded-full animate-pulse\">\n                        {unreadCount > 9 ? '9+' : unreadCount}\n                    </span>\n                )}\n            </button>\n\n            {/* Notification Panel */}\n            {isOpen && (\n                <>\n                    {/* Backdrop */}\n                    <div\n                        className=\"fixed inset-0 z-40\"\n                        onClick={() => setIsOpen(false)}\n                    />\n\n                    {/* Panel */}\n                    <div className=\"absolute right-0 mt-2 w-96 bg-white rounded-xl shadow-2xl border border-gray-200 z-50 overflow-hidden\">\n                        {/* Header */}\n                        <div className=\"flex items-center justify-between px-4 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white\">\n                            <div className=\"flex items-center space-x-2\">\n                                <Bell className=\"w-5 h-5\" />\n                                <span className=\"font-semibold\">Notifications</span>\n                                {unreadCount > 0 && (\n                                    <span className=\"px-2 py-0.5 text-xs bg-white/20 rounded-full\">\n                                        {unreadCount} new\n                                    </span>\n                                )}\n                            </div>\n                            <div className=\"flex items-center space-x-2\">\n                                {unreadCount > 0 && (\n                                    <button\n                                        onClick={markAllAsRead}\n                                        className=\"text-xs text-white/80 hover:text-white transition\"\n                                    >\n                                        Mark all read\n                                    </button>\n                                )}\n                                <button\n                                    onClick={() => setIsOpen(false)}\n                                    className=\"p-1 hover:bg-white/20 rounded transition\"\n                                >\n                                    <X className=\"w-4 h-4\" />\n                                </button>\n                            </div>\n                        </div>\n\n                        {/* Notifications List */}\n                        <div className=\"max-h-96 overflow-y-auto\">\n                            {loading ? (\n                                <div className=\"p-4 text-center text-gray-500\">\n                                    <div className=\"animate-spin h-6 w-6 border-2 border-indigo-600 border-t-transparent rounded-full mx-auto\" />\n                                </div>\n                            ) : notifications.length === 0 ? (\n                                <div className=\"p-8 text-center text-gray-500\">\n                                    <Bell className=\"w-12 h-12 mx-auto mb-2 text-gray-300\" />\n                                    <p>No notifications yet</p>\n                                </div>\n                            ) : (\n                                <div className=\"divide-y divide-gray-100\">\n                                    {notifications.map((notification) => (\n                                        <div\n                                            key={notification.id}\n                                            className={`p-4 hover:bg-gray-50 transition cursor-pointer ${!notification.read ? 'bg-indigo-50/50' : ''\n                                                }`}\n                                            onClick={() => {\n                                                markAsRead(notification.id);\n                                                if (notification.action_url) {\n                                                    window.location.href = notification.action_url;\n                                                    setIsOpen(false);\n                                                }\n                                            }}\n                                        >\n                                            <div className=\"flex items-start space-x-3\">\n                                                <div className={`p-2 rounded-full ${getTypeColor(notification.type)}`}>\n                                                    {getIcon(notification.type, notification.entity_type)}\n                                                </div>\n                                                <div className=\"flex-1 min-w-0\">\n                                                    <div className=\"flex items-center justify-between\">\n                                                        <p className={`text-sm font-medium text-gray-900 ${!notification.read ? 'font-semibold' : ''\n                                                            }`}>\n                                                            {notification.title}\n                                                        </p>\n                                                        <button\n                                                            onClick={(e) => {\n                                                                e.stopPropagation();\n                                                                deleteNotification(notification.id);\n                                                            }}\n                                                            className=\"p-1 text-gray-400 hover:text-red-500 transition\"\n                                                        >\n                                                            <X className=\"w-3 h-3\" />\n                                                        </button>\n                                                    </div>\n                                                    <p className=\"text-sm text-gray-600 truncate\">\n                                                        {notification.message}\n                                                    </p>\n                                                    <div className=\"flex items-center mt-1 text-xs text-gray-400\">\n                                                        <Clock className=\"w-3 h-3 mr-1\" />\n                                                        {formatDistanceToNow(new Date(notification.created_at), { addSuffix: true })}\n                                                    </div>\n                                                </div>\n                                                {!notification.read && (\n                                                    <div className=\"w-2 h-2 bg-indigo-600 rounded-full\" />\n                                                )}\n                                            </div>\n                                        </div>\n                                    ))}\n                                </div>\n                            )}\n                        </div>\n\n                        {/* Footer */}\n                        {notifications.length > 0 && (\n                            <div className=\"px-4 py-3 bg-gray-50 border-t border-gray-100\">\n                                <button\n                                    onClick={() => {\n                                        setIsOpen(false);\n                                        // Navigate to full notifications page if exists\n                                    }}\n                                    className=\"w-full text-center text-sm text-indigo-600 hover:text-indigo-700 font-medium\"\n                                >\n                                    View all notifications\n                                </button>\n                            </div>\n                        )}\n                    </div>\n                </>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/OnboardingChecklist.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CreditCard' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Key' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Laptop' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":53},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plus' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Edit2' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Trash2' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Save' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'OnboardingProgress' is defined but never used. Allowed unused vars must match /^_/u.","line":24,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'editingItem' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":70,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":70,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setEditingItem' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":70,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":70,"endColumn":39},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadChecklist'. Either include it or remove the dependency array.","line":74,"column":8,"nodeType":"ArrayExpression","endLine":74,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [employeeId, currentTenant, loadChecklist]","fix":{"range":[4427,4454],"text":"[employeeId, currentTenant, loadChecklist]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport { useTenant } from '@/contexts/TenantContext';\nimport {\n    CheckCircle, Circle, Clock, User, FileText, Shield,\n    GraduationCap, CreditCard, Building, Key, Laptop,\n    ChevronRight, Plus, Edit2, Trash2, Save, X\n} from 'lucide-react';\n\ninterface ChecklistItem {\n    id: string;\n    title: string;\n    description?: string;\n    category: string;\n    is_required: boolean;\n    is_completed: boolean;\n    completed_at?: string;\n    completed_by?: string;\n    due_days?: number;\n    order: number;\n}\n\ninterface OnboardingProgress {\n    employee_id: string;\n    employee_name: string;\n    start_date: string;\n    items: ChecklistItem[];\n    progress: number;\n}\n\nconst defaultChecklistItems: Omit<ChecklistItem, 'id' | 'is_completed' | 'completed_at' | 'completed_by'>[] = [\n    // Pre-arrival\n    { title: 'Send offer letter', description: 'Send and receive signed offer letter', category: 'pre_arrival', is_required: true, due_days: -7, order: 1 },\n    { title: 'Background check completed', description: 'DBS check processed', category: 'pre_arrival', is_required: true, due_days: -5, order: 2 },\n    { title: 'Right to work verified', description: 'Passport/visa documentation verified', category: 'pre_arrival', is_required: true, due_days: -5, order: 3 },\n    { title: 'References received', description: 'At least 2 professional references', category: 'pre_arrival', is_required: true, due_days: -3, order: 4 },\n    { title: 'Contract signed', description: 'Employment contract signed and filed', category: 'pre_arrival', is_required: true, due_days: -1, order: 5 },\n\n    // First day\n    { title: 'Welcome meeting', description: 'Introduction meeting with manager', category: 'first_day', is_required: true, due_days: 0, order: 6 },\n    { title: 'Office tour', description: 'Tour of facilities and introductions', category: 'first_day', is_required: false, due_days: 0, order: 7 },\n    { title: 'IT setup complete', description: 'Laptop, email, and access credentials', category: 'first_day', is_required: true, due_days: 0, order: 8 },\n    { title: 'ID badge issued', description: 'Photo ID and building access', category: 'first_day', is_required: true, due_days: 0, order: 9 },\n    { title: 'Handbook provided', description: 'Employee handbook and policies', category: 'first_day', is_required: true, due_days: 0, order: 10 },\n\n    // First week\n    { title: 'Bank details collected', description: 'Payroll information submitted', category: 'first_week', is_required: true, due_days: 5, order: 11 },\n    { title: 'Benefits enrollment', description: 'Health insurance and pension options', category: 'first_week', is_required: false, due_days: 5, order: 12 },\n    { title: 'H&S induction', description: 'Health and Safety training completed', category: 'first_week', is_required: true, due_days: 5, order: 13 },\n    { title: 'GDPR training', description: 'Data protection training', category: 'first_week', is_required: true, due_days: 5, order: 14 },\n    { title: 'Team introduction', description: 'Meet the team and stakeholders', category: 'first_week', is_required: false, due_days: 5, order: 15 },\n\n    // First month\n    { title: 'Fire safety training', description: 'Fire evacuation and safety procedures', category: 'first_month', is_required: true, due_days: 30, order: 16 },\n    { title: 'Role-specific training', description: 'Job-specific training completed', category: 'first_month', is_required: true, due_days: 30, order: 17 },\n    { title: '30-day review', description: 'Check-in meeting with manager', category: 'first_month', is_required: true, due_days: 30, order: 18 },\n    { title: 'Probation objectives set', description: 'Goals and KPIs agreed', category: 'first_month', is_required: true, due_days: 30, order: 19 },\n];\n\nexport default function OnboardingChecklist({ employeeId, employeeName, startDate }: {\n    employeeId?: string;\n    employeeName?: string;\n    startDate?: string;\n}) {\n    const { currentTenant } = useTenant();\n    const [items, setItems] = useState<ChecklistItem[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [expandedCategory, setExpandedCategory] = useState<string | null>('first_day');\n    const [editingItem, setEditingItem] = useState<string | null>(null);\n\n    useEffect(() => {\n        loadChecklist();\n    }, [employeeId, currentTenant]);\n\n    async function loadChecklist() {\n        setLoading(true);\n        try {\n            if (employeeId) {\n                const { data, error } = await supabase\n                    .from('onboarding_checklists')\n                    .select('*')\n                    .eq('employee_id', employeeId)\n                    .order('order');\n\n                if (error) throw error;\n                if (data && data.length > 0) {\n                    setItems(data);\n                } else {\n                    // Initialize with default items\n                    initializeDefaultItems();\n                }\n            } else {\n                initializeDefaultItems();\n            }\n        } catch (error) {\n            log.error('Error loading onboarding checklist', error, { component: 'OnboardingChecklist', action: 'loadChecklist', metadata: { employeeId } });\n            initializeDefaultItems();\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    function initializeDefaultItems() {\n        const itemsWithIds: ChecklistItem[] = defaultChecklistItems.map((item, index) => ({\n            ...item,\n            id: `item-${index}`,\n            is_completed: false,\n        }));\n        setItems(itemsWithIds);\n    }\n\n    async function toggleItem(itemId: string) {\n        const item = items.find(i => i.id === itemId);\n        if (!item) return;\n\n        const updated = {\n            ...item,\n            is_completed: !item.is_completed,\n            completed_at: !item.is_completed ? new Date().toISOString() : undefined,\n        };\n\n        setItems(prev => prev.map(i => i.id === itemId ? updated : i));\n\n        if (employeeId) {\n            try {\n                await supabase\n                    .from('onboarding_checklists')\n                    .upsert({\n                        id: itemId,\n                        employee_id: employeeId,\n                        ...updated,\n                    });\n            } catch (error) {\n                log.error('Error updating onboarding checklist item', error, { component: 'OnboardingChecklist', action: 'toggleItem', metadata: { employeeId, itemId, updatedStatus: updated.is_completed } });\n            }\n        }\n    }\n\n    function getCategoryIcon(category: string) {\n        switch (category) {\n            case 'pre_arrival': return <FileText className=\"w-5 h-5\" />;\n            case 'first_day': return <Building className=\"w-5 h-5\" />;\n            case 'first_week': return <GraduationCap className=\"w-5 h-5\" />;\n            case 'first_month': return <Shield className=\"w-5 h-5\" />;\n            default: return <Clock className=\"w-5 h-5\" />;\n        }\n    }\n\n    function getCategoryLabel(category: string) {\n        switch (category) {\n            case 'pre_arrival': return 'Pre-Arrival';\n            case 'first_day': return 'First Day';\n            case 'first_week': return 'First Week';\n            case 'first_month': return 'First Month';\n            default: return category;\n        }\n    }\n\n    function getCategoryColor(category: string) {\n        switch (category) {\n            case 'pre_arrival': return 'bg-purple-100 text-purple-700 border-purple-200';\n            case 'first_day': return 'bg-blue-100 text-blue-700 border-blue-200';\n            case 'first_week': return 'bg-green-100 text-green-700 border-green-200';\n            case 'first_month': return 'bg-orange-100 text-orange-700 border-orange-200';\n            default: return 'bg-gray-100 text-gray-700 border-gray-200';\n        }\n    }\n\n    const categories = ['pre_arrival', 'first_day', 'first_week', 'first_month'];\n\n    const categoryProgress = categories.reduce((acc, cat) => {\n        const catItems = items.filter(i => i.category === cat);\n        const completed = catItems.filter(i => i.is_completed).length;\n        acc[cat] = {\n            total: catItems.length,\n            completed,\n            percentage: catItems.length > 0 ? Math.round((completed / catItems.length) * 100) : 0\n        };\n        return acc;\n    }, {} as Record<string, { total: number; completed: number; percentage: number }>);\n\n    const overallProgress = items.length > 0\n        ? Math.round((items.filter(i => i.is_completed).length / items.length) * 100)\n        : 0;\n\n    if (loading) {\n        return (\n            <div className=\"bg-white rounded-xl border border-gray-200 p-6\">\n                <div className=\"animate-pulse space-y-4\">\n                    <div className=\"h-6 bg-gray-200 rounded w-1/3\" />\n                    <div className=\"space-y-3\">\n                        {[1, 2, 3, 4].map(i => (\n                            <div key={i} className=\"h-12 bg-gray-100 rounded\" />\n                        ))}\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"bg-white rounded-xl border border-gray-200 overflow-hidden\">\n            {/* Header */}\n            <div className=\"px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-indigo-600 to-purple-600 text-white\">\n                <div className=\"flex items-center justify-between\">\n                    <div>\n                        <h2 className=\"text-lg font-semibold\">Onboarding Checklist</h2>\n                        {employeeName && (\n                            <p className=\"text-indigo-200 text-sm flex items-center mt-1\">\n                                <User className=\"w-4 h-4 mr-1\" />\n                                {employeeName}\n                                {startDate && ` â¢ Started ${new Date(startDate).toLocaleDateString()}`}\n                            </p>\n                        )}\n                    </div>\n                    <div className=\"text-right\">\n                        <p className=\"text-3xl font-bold\">{overallProgress}%</p>\n                        <p className=\"text-sm text-indigo-200\">Complete</p>\n                    </div>\n                </div>\n\n                {/* Progress bar */}\n                <div className=\"mt-4 h-2 bg-white/20 rounded-full overflow-hidden\">\n                    <div\n                        className=\"h-full bg-white rounded-full transition-all duration-500\"\n                        style={{ width: `${overallProgress}%` }}\n                    />\n                </div>\n            </div>\n\n            {/* Categories */}\n            <div className=\"divide-y divide-gray-100\">\n                {categories.map(category => {\n                    const catItems = items.filter(i => i.category === category);\n                    const isExpanded = expandedCategory === category;\n                    const progress = categoryProgress[category];\n\n                    return (\n                        <div key={category}>\n                            {/* Category Header */}\n                            <button\n                                onClick={() => setExpandedCategory(isExpanded ? null : category)}\n                                className={`w-full flex items-center justify-between px-6 py-4 hover:bg-gray-50 transition ${isExpanded ? 'bg-gray-50' : ''}`}\n                            >\n                                <div className=\"flex items-center space-x-3\">\n                                    <div className={`p-2 rounded-lg ${getCategoryColor(category)}`}>\n                                        {getCategoryIcon(category)}\n                                    </div>\n                                    <div className=\"text-left\">\n                                        <p className=\"font-medium text-gray-900\">{getCategoryLabel(category)}</p>\n                                        <p className=\"text-sm text-gray-500\">\n                                            {progress.completed} of {progress.total} tasks complete\n                                        </p>\n                                    </div>\n                                </div>\n                                <div className=\"flex items-center space-x-4\">\n                                    <div className=\"w-24 h-2 bg-gray-200 rounded-full overflow-hidden\">\n                                        <div\n                                            className=\"h-full bg-indigo-600 rounded-full transition-all duration-300\"\n                                            style={{ width: `${progress.percentage}%` }}\n                                        />\n                                    </div>\n                                    <span className=\"text-sm font-medium text-gray-600 w-10\">\n                                        {progress.percentage}%\n                                    </span>\n                                    <ChevronRight className={`w-5 h-5 text-gray-400 transition-transform ${isExpanded ? 'rotate-90' : ''}`} />\n                                </div>\n                            </button>\n\n                            {/* Category Items */}\n                            {isExpanded && (\n                                <div className=\"px-6 pb-4 space-y-2\">\n                                    {catItems.map(item => (\n                                        <div\n                                            key={item.id}\n                                            className={`flex items-start p-3 rounded-lg border transition ${item.is_completed\n                                                ? 'bg-green-50 border-green-200'\n                                                : 'bg-white border-gray-200 hover:border-gray-300'\n                                                }`}\n                                        >\n                                            <button\n                                                onClick={() => toggleItem(item.id)}\n                                                className=\"flex-shrink-0 mt-0.5\"\n                                            >\n                                                {item.is_completed ? (\n                                                    <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                                                ) : (\n                                                    <Circle className=\"w-5 h-5 text-gray-400 hover:text-indigo-600\" />\n                                                )}\n                                            </button>\n                                            <div className=\"ml-3 flex-1\">\n                                                <p className={`text-sm font-medium ${item.is_completed ? 'text-green-700 line-through' : 'text-gray-900'\n                                                    }`}>\n                                                    {item.title}\n                                                    {item.is_required && (\n                                                        <span className=\"ml-2 text-xs text-red-500\">Required</span>\n                                                    )}\n                                                </p>\n                                                {item.description && (\n                                                    <p className=\"text-xs text-gray-500 mt-0.5\">{item.description}</p>\n                                                )}\n                                                {item.completed_at && (\n                                                    <p className=\"text-xs text-green-600 mt-1\">\n                                                        Completed {new Date(item.completed_at).toLocaleDateString()}\n                                                    </p>\n                                                )}\n                                            </div>\n                                        </div>\n                                    ))}\n                                </div>\n                            )}\n                        </div>\n                    );\n                })}\n            </div>\n\n            {/* Summary */}\n            <div className=\"px-6 py-4 bg-gray-50 border-t border-gray-200\">\n                <div className=\"flex items-center justify-between text-sm\">\n                    <div className=\"flex space-x-6\">\n                        <span className=\"text-gray-600\">\n                            <strong className=\"text-gray-900\">{items.filter(i => i.is_completed).length}</strong> completed\n                        </span>\n                        <span className=\"text-gray-600\">\n                            <strong className=\"text-gray-900\">{items.filter(i => !i.is_completed && i.is_required).length}</strong> required remaining\n                        </span>\n                    </div>\n                    <button className=\"text-indigo-600 hover:text-indigo-700 font-medium\">\n                        Print Checklist\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/PWAUpdateNotification.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/PerformanceReports.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Legend' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":63,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":69},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LineChart' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":113,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":122},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Line' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":124,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":128},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'lastUpdated' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":12,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, PieChart, Pie, Cell, LineChart, Line } from 'recharts';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport { Loader2 } from 'lucide-react';\n\nconst COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042'];\n\nexport default function PerformanceReports() {\n    const [data, setData] = useState<any>(null);\n    const [loading, setLoading] = useState(true);\n    const [lastUpdated, setLastUpdated] = useState<Date | null>(null);\n\n    useEffect(() => {\n        loadReports();\n    }, []);\n\n    async function loadReports() {\n        try {\n            const { data: { session } } = await supabase.auth.getSession();\n            const { data: reportData, error } = await supabase.functions.invoke('performance-crud', {\n                body: { action: 'get_reports' },\n                headers: { Authorization: `Bearer ${session?.access_token}` }\n            });\n\n            if (error) throw error;\n\n            setData(reportData);\n            setLastUpdated(new Date());\n        } catch (error) {\n            log.error('Error loading reports', error, { component: 'PerformanceReports', action: 'loadReports' });\n            setData(null);\n        } finally {\n            setLoading(false);\n        }\n    }\n\n\n    async function generateData() {\n        setLoading(true);\n        try {\n            const { data: { session } } = await supabase.auth.getSession();\n            const { data, error } = await supabase.functions.invoke('performance-crud', {\n                body: { action: 'generate_sample_data' },\n                headers: { Authorization: `Bearer ${session?.access_token}` }\n            });\n\n            if (error) throw error;\n            if (data && !data.success) throw new Error(data.message || 'Unknown error');\n\n            // Reload reports after generating data\n            await loadReports();\n        } catch (error: any) {\n            log.error('Error generating sample data', error, { component: 'PerformanceReports', action: 'generateData' });\n            alert(`Failed to generate sample data: ${error.message}`);\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    if (loading) {\n        return (\n            <div className=\"flex justify-center items-center h-64\">\n                <Loader2 className=\"w-8 h-8 animate-spin text-indigo-600\" />\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex justify-end mb-4\">\n                <button\n                    onClick={generateData}\n                    className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium\"\n                >\n                    Generate Sample Data\n                </button>\n            </div>\n\n            {!data ? (\n                <div className=\"text-center py-12 text-gray-500\">No data available. Click \"Generate Sample Data\" to get started.</div>\n            ) : (\n                <>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                        {/* Rating Distribution */}\n                        <div className=\"bg-white p-6 rounded-lg shadow\">\n                            <h3 className=\"text-lg font-semibold mb-4\">Review Rating Distribution</h3>\n                            <div className=\"h-64\">\n                                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                                    <BarChart data={data.ratingDistribution}>\n                                        <CartesianGrid strokeDasharray=\"3 3\" />\n                                        <XAxis dataKey=\"name\" />\n                                        <YAxis />\n                                        <Tooltip />\n                                        <Bar dataKey=\"count\" fill=\"#4F46E5\" />\n                                    </BarChart>\n                                </ResponsiveContainer>\n                            </div>\n                        </div>\n\n                        {/* Goal Status */}\n                        <div className=\"bg-white p-6 rounded-lg shadow\">\n                            <h3 className=\"text-lg font-semibold mb-4\">Goal Completion Status</h3>\n                            <div className=\"h-64\">\n                                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                                    <PieChart>\n                                        <Pie\n                                            data={data.goalStatus}\n                                            cx=\"50%\"\n                                            cy=\"50%\"\n                                            labelLine={false}\n                                            label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}\n                                            outerRadius={80}\n                                            fill=\"#8884d8\"\n                                            dataKey=\"value\"\n                                        >\n                                            {data.goalStatus.map((entry: any, index: number) => (\n                                                <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                                            ))}\n                                        </Pie>\n                                        <Tooltip />\n                                    </PieChart>\n                                </ResponsiveContainer>\n                            </div>\n                        </div>\n                    </div>\n\n                    {/* Summary Stats */}\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                        <div className=\"bg-indigo-50 p-6 rounded-lg\">\n                            <p className=\"text-sm text-indigo-600 font-medium\">Total Reviews</p>\n                            <p className=\"text-3xl font-bold text-indigo-900\">{data.totalReviews}</p>\n                        </div>\n                        <div className=\"bg-green-50 p-6 rounded-lg\">\n                            <p className=\"text-sm text-green-600 font-medium\">Total Goals</p>\n                            <p className=\"text-3xl font-bold text-green-900\">{data.totalGoals}</p>\n                        </div>\n                        <div className=\"bg-blue-50 p-6 rounded-lg\">\n                            <p className=\"text-sm text-blue-600 font-medium\">Avg KPI Score</p>\n                            <p className=\"text-3xl font-bold text-blue-900\">{data.avgKPI}%</p>\n                        </div>\n                    </div>\n                </>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/QuickActions.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MessageSquare' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":73,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":86}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Plus, X, Briefcase, Users, FileText, Calendar, Settings, Bell, MessageSquare, Clock, Mail, Download, Upload } from 'lucide-react';\nimport { useNavigate } from 'react-router-dom';\n\ninterface QuickAction {\n    id: string;\n    label: string;\n    icon: React.ReactNode;\n    action: () => void;\n    color: string;\n    description?: string;\n}\n\nexport default function QuickActions() {\n    const navigate = useNavigate();\n    const [isOpen, setIsOpen] = useState(false);\n\n    const actions: QuickAction[] = [\n        {\n            id: 'new-job',\n            label: 'Post New Job',\n            icon: <Briefcase className=\"w-5 h-5\" />,\n            action: () => {\n                navigate('/recruitment');\n                setIsOpen(false);\n            },\n            color: 'bg-blue-500 hover:bg-blue-600',\n            description: 'Create a new job posting'\n        },\n        {\n            id: 'add-employee',\n            label: 'Add Employee',\n            icon: <Users className=\"w-5 h-5\" />,\n            action: () => {\n                navigate('/hr');\n                setIsOpen(false);\n            },\n            color: 'bg-green-500 hover:bg-green-600',\n            description: 'Register a new employee'\n        },\n        {\n            id: 'new-document',\n            label: 'Upload Document',\n            icon: <Upload className=\"w-5 h-5\" />,\n            action: () => {\n                navigate('/documents');\n                setIsOpen(false);\n            },\n            color: 'bg-purple-500 hover:bg-purple-600',\n            description: 'Upload a new document'\n        },\n        {\n            id: 'schedule-interview',\n            label: 'Schedule Interview',\n            icon: <Calendar className=\"w-5 h-5\" />,\n            action: () => {\n                navigate('/recruitment');\n                setIsOpen(false);\n            },\n            color: 'bg-orange-500 hover:bg-orange-600',\n            description: 'Schedule a new interview'\n        },\n        {\n            id: 'send-message',\n            label: 'Send Message',\n            icon: <Mail className=\"w-5 h-5\" />,\n            action: () => {\n                navigate('/messaging');\n                setIsOpen(false);\n            },\n            color: 'bg-pink-500 hover:bg-pink-600',\n            description: 'Send a new message'\n        },\n        {\n            id: 'request-leave',\n            label: 'Request Leave',\n            icon: <Clock className=\"w-5 h-5\" />,\n            action: () => {\n                navigate('/hr');\n                setIsOpen(false);\n            },\n            color: 'bg-teal-500 hover:bg-teal-600',\n            description: 'Submit leave request'\n        },\n        {\n            id: 'export-report',\n            label: 'Generate Report',\n            icon: <Download className=\"w-5 h-5\" />,\n            action: () => {\n                navigate('/compliance-dashboard');\n                setIsOpen(false);\n            },\n            color: 'bg-indigo-500 hover:bg-indigo-600',\n            description: 'Export compliance report'\n        },\n        {\n            id: 'view-notifications',\n            label: 'Notifications',\n            icon: <Bell className=\"w-5 h-5\" />,\n            action: () => {\n                // Open notification center\n                setIsOpen(false);\n            },\n            color: 'bg-yellow-500 hover:bg-yellow-600',\n            description: 'View notifications'\n        },\n    ];\n\n    return (\n        <>\n            {/* Floating Action Button */}\n            <div className=\"fixed bottom-6 right-6 z-40\">\n                <button\n                    onClick={() => setIsOpen(!isOpen)}\n                    className={`flex items-center justify-center w-14 h-14 rounded-full shadow-lg transition-all duration-300 ${isOpen\n                            ? 'bg-gray-800 rotate-45'\n                            : 'bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700'\n                        }`}\n                >\n                    {isOpen ? (\n                        <X className=\"w-6 h-6 text-white\" />\n                    ) : (\n                        <Plus className=\"w-6 h-6 text-white\" />\n                    )}\n                </button>\n\n                {/* Tooltip */}\n                {!isOpen && (\n                    <div className=\"absolute bottom-full right-0 mb-2 opacity-0 group-hover:opacity-100 transition\">\n                        <div className=\"bg-gray-900 text-white text-sm px-3 py-1.5 rounded-lg whitespace-nowrap\">\n                            Quick Actions\n                        </div>\n                    </div>\n                )}\n            </div>\n\n            {/* Actions Menu */}\n            {isOpen && (\n                <>\n                    {/* Backdrop */}\n                    <div\n                        className=\"fixed inset-0 bg-black/30 backdrop-blur-sm z-30\"\n                        onClick={() => setIsOpen(false)}\n                    />\n\n                    {/* Actions Grid */}\n                    <div className=\"fixed bottom-24 right-6 z-40 w-80\">\n                        <div className=\"bg-white rounded-2xl shadow-2xl overflow-hidden\">\n                            <div className=\"px-4 py-3 bg-gray-50 border-b border-gray-100\">\n                                <p className=\"text-sm font-semibold text-gray-700\">Quick Actions</p>\n                                <p className=\"text-xs text-gray-500\">What would you like to do?</p>\n                            </div>\n\n                            <div className=\"p-3 grid grid-cols-2 gap-2 max-h-96 overflow-y-auto\">\n                                {actions.map((action, index) => (\n                                    <button\n                                        key={action.id}\n                                        onClick={action.action}\n                                        className={`flex flex-col items-center p-4 rounded-xl ${action.color} text-white transition-all duration-200 transform hover:scale-105`}\n                                        style={{\n                                            animationDelay: `${index * 50}ms`,\n                                        }}\n                                    >\n                                        <div className=\"p-2 bg-white/20 rounded-lg mb-2\">\n                                            {action.icon}\n                                        </div>\n                                        <span className=\"text-sm font-medium text-center\">{action.label}</span>\n                                    </button>\n                                ))}\n                            </div>\n\n                            <div className=\"px-4 py-3 bg-gray-50 border-t border-gray-100\">\n                                <button\n                                    onClick={() => {\n                                        navigate('/settings');\n                                        setIsOpen(false);\n                                    }}\n                                    className=\"w-full flex items-center justify-center text-sm text-gray-600 hover:text-gray-900\"\n                                >\n                                    <Settings className=\"w-4 h-4 mr-1\" />\n                                    Customize actions\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </>\n            )}\n        </>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/QuickAdminSetup.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/RateModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/ReferenceManagement.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadReferences'. Either include it or remove the dependency array.","line":43,"column":6,"nodeType":"ArrayExpression","endLine":43,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [applicationId, loadReferences]","fix":{"range":[1192,1207],"text":"[applicationId, loadReferences]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Users, Mail, Phone, CheckCircle, Clock, Send, Plus, X } from 'lucide-react';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\n\ninterface Reference {\n  id: string;\n  application_id: string;\n  ref_name: string;\n  ref_email: string;\n  ref_phone?: string;\n  ref_company?: string;\n  ref_position?: string;\n  ref_relationship: string;\n  verification_status: string;\n  ref_score?: number;\n  ref_rating?: string;\n  ref_response?: string;\n  verification_request_sent_at?: string;\n  verification_received_at?: string;\n}\n\ninterface ReferenceManagementProps {\n  applicationId: string;\n  applicantName: string;\n}\n\nexport default function ReferenceManagement({ applicationId, applicantName }: ReferenceManagementProps) {\n  const [references, setReferences] = useState<Reference[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [showAddForm, setShowAddForm] = useState(false);\n  const [formData, setFormData] = useState({\n    ref_name: '',\n    ref_email: '',\n    ref_phone: '',\n    ref_company: '',\n    ref_position: '',\n    ref_relationship: ''\n  });\n\n  useEffect(() => {\n    loadReferences();\n  }, [applicationId]);\n\n  async function loadReferences() {\n    try {\n      const session = await supabase.auth.getSession();\n      if (!session.data.session) return;\n\n      const { data } = await supabase.functions.invoke('reference-management', {\n        body: {\n          action: 'GET_BY_APPLICATION',\n          data: { application_id: applicationId }\n        },\n        headers: {\n          Authorization: `Bearer ${session.data.session.access_token}`\n        }\n      });\n\n      if (data?.data) {\n        setReferences(data.data);\n      }\n    } catch (error) {\n      log.error('Error loading references', error, { component: 'ReferenceManagement', action: 'loadReferences' });\n    }\n  }\n\n  async function handleAddReference(e: React.FormEvent) {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      const session = await supabase.auth.getSession();\n      if (!session.data.session) return;\n\n      await supabase.functions.invoke('reference-management', {\n        body: {\n          action: 'CREATE',\n          data: {\n            application_id: applicationId,\n            ...formData\n          }\n        },\n        headers: {\n          Authorization: `Bearer ${session.data.session.access_token}`\n        }\n      });\n\n      setFormData({\n        ref_name: '',\n        ref_email: '',\n        ref_phone: '',\n        ref_company: '',\n        ref_position: '',\n        ref_relationship: ''\n      });\n      setShowAddForm(false);\n      await loadReferences();\n    } catch (error) {\n      log.error('Error adding reference', error, { component: 'ReferenceManagement', action: 'handleAddReference' });\n      alert('Failed to add reference');\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function handleRequestVerification(referenceId: string) {\n    try {\n      const session = await supabase.auth.getSession();\n      if (!session.data.session) return;\n\n      await supabase.functions.invoke('reference-management', {\n        body: {\n          action: 'REQUEST_VERIFICATION',\n          data: { reference_id: referenceId }\n        },\n        headers: {\n          Authorization: `Bearer ${session.data.session.access_token}`\n        }\n      });\n\n      alert('Verification request sent successfully');\n      await loadReferences();\n    } catch (error) {\n      log.error('Error requesting verification', error, { component: 'ReferenceManagement', action: 'handleRequestVerification' });\n      alert('Failed to send verification request');\n    }\n  }\n\n  async function handleVerifyReference(referenceId: string) {\n    const notes = prompt('Enter verification notes:');\n    if (!notes) return;\n\n    try {\n      const session = await supabase.auth.getSession();\n      if (!session.data.session) return;\n\n      await supabase.functions.invoke('reference-management', {\n        body: {\n          action: 'VERIFY',\n          data: { reference_id: referenceId, notes }\n        },\n        headers: {\n          Authorization: `Bearer ${session.data.session.access_token}`\n        }\n      });\n\n      alert('Reference verified successfully');\n      await loadReferences();\n    } catch (error) {\n      log.error('Error verifying reference', error, { component: 'ReferenceManagement', action: 'handleVerifyReference' });\n      alert('Failed to verify reference');\n    }\n  }\n\n  const getStatusBadge = (status: string) => {\n    const styles: Record<string, string> = {\n      pending: 'bg-gray-100 text-gray-800',\n      requested: 'bg-blue-100 text-blue-800',\n      received: 'bg-yellow-100 text-yellow-800',\n      verified: 'bg-green-100 text-green-800',\n      failed: 'bg-red-100 text-red-800'\n    };\n\n    return (\n      <span className={`px-2 py-1 text-xs rounded-full ${styles[status] || styles.pending}`}>\n        {status.charAt(0).toUpperCase() + status.slice(1)}\n      </span>\n    );\n  };\n\n  return (\n    <div className=\"bg-white rounded-lg shadow p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <h3 className=\"text-lg font-semibold text-gray-900\">Reference Management</h3>\n          <p className=\"text-sm text-gray-600\">Applicant: {applicantName}</p>\n        </div>\n        <button\n          onClick={() => setShowAddForm(true)}\n          className=\"flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700\"\n        >\n          <Plus className=\"w-4 h-4 mr-2\" />\n          Add Reference\n        </button>\n      </div>\n\n      {showAddForm && (\n        <div className=\"mb-6 border border-gray-200 rounded-lg p-4 bg-gray-50\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h4 className=\"font-semibold text-gray-900\">Add New Reference</h4>\n            <button\n              onClick={() => setShowAddForm(false)}\n              className=\"text-gray-400 hover:text-gray-600\"\n            >\n              <X className=\"w-5 h-5\" />\n            </button>\n          </div>\n          <form onSubmit={handleAddReference} className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Full Name *\n                </label>\n                <input\n                  type=\"text\"\n                  required\n                  value={formData.ref_name}\n                  onChange={(e) => setFormData({ ...formData, ref_name: e.target.value })}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Email *\n                </label>\n                <input\n                  type=\"email\"\n                  required\n                  value={formData.ref_email}\n                  onChange={(e) => setFormData({ ...formData, ref_email: e.target.value })}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Phone\n                </label>\n                <input\n                  type=\"tel\"\n                  value={formData.ref_phone}\n                  onChange={(e) => setFormData({ ...formData, ref_phone: e.target.value })}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Company\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.ref_company}\n                  onChange={(e) => setFormData({ ...formData, ref_company: e.target.value })}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Position\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.ref_position}\n                  onChange={(e) => setFormData({ ...formData, ref_position: e.target.value })}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Relationship *\n                </label>\n                <select\n                  required\n                  value={formData.ref_relationship}\n                  onChange={(e) => setFormData({ ...formData, ref_relationship: e.target.value })}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n                >\n                  <option value=\"\">Select...</option>\n                  <option value=\"manager\">Manager</option>\n                  <option value=\"colleague\">Colleague</option>\n                  <option value=\"client\">Client</option>\n                  <option value=\"professor\">Professor</option>\n                  <option value=\"other\">Other</option>\n                </select>\n              </div>\n            </div>\n            <div className=\"flex justify-end space-x-3\">\n              <button\n                type=\"button\"\n                onClick={() => setShowAddForm(false)}\n                className=\"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50\"\n              >\n                Cancel\n              </button>\n              <button\n                type=\"submit\"\n                disabled={loading}\n                className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50\"\n              >\n                {loading ? 'Adding...' : 'Add Reference'}\n              </button>\n            </div>\n          </form>\n        </div>\n      )}\n\n      <div className=\"space-y-4\">\n        {references.length === 0 ? (\n          <div className=\"text-center py-12 bg-gray-50 rounded-lg\">\n            <Users className=\"w-12 h-12 text-gray-300 mx-auto mb-3\" />\n            <p className=\"text-gray-500\">No references added yet</p>\n            <button\n              onClick={() => setShowAddForm(true)}\n              className=\"mt-3 text-indigo-600 hover:text-indigo-700\"\n            >\n              Add your first reference\n            </button>\n          </div>\n        ) : (\n          references.map((ref) => (\n            <div key={ref.id} className=\"border border-gray-200 rounded-lg p-4 hover:shadow-md transition\">\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center space-x-3 mb-2\">\n                    <h4 className=\"text-lg font-semibold text-gray-900\">{ref.ref_name}</h4>\n                    {getStatusBadge(ref.verification_status)}\n                  </div>\n                  <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                    <div className=\"flex items-center text-gray-600\">\n                      <Mail className=\"w-4 h-4 mr-2\" />\n                      {ref.ref_email}\n                    </div>\n                    {ref.ref_phone && (\n                      <div className=\"flex items-center text-gray-600\">\n                        <Phone className=\"w-4 h-4 mr-2\" />\n                        {ref.ref_phone}\n                      </div>\n                    )}\n                    {ref.ref_company && (\n                      <div className=\"text-gray-600\">\n                        <span className=\"font-medium\">Company:</span> {ref.ref_company}\n                      </div>\n                    )}\n                    {ref.ref_position && (\n                      <div className=\"text-gray-600\">\n                        <span className=\"font-medium\">Position:</span> {ref.ref_position}\n                      </div>\n                    )}\n                    <div className=\"text-gray-600\">\n                      <span className=\"font-medium\">Relationship:</span> {ref.ref_relationship}\n                    </div>\n                    {ref.ref_score && (\n                      <div className=\"text-gray-600\">\n                        <span className=\"font-medium\">Score:</span> {ref.ref_score}/10\n                      </div>\n                    )}\n                  </div>\n                  {ref.ref_response && (\n                    <div className=\"mt-3 p-3 bg-gray-50 rounded\">\n                      <p className=\"text-sm text-gray-700\">{ref.ref_response}</p>\n                    </div>\n                  )}\n                </div>\n                <div className=\"ml-4 space-y-2\">\n                  {ref.verification_status === 'pending' && (\n                    <button\n                      onClick={() => handleRequestVerification(ref.id)}\n                      className=\"flex items-center px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200\"\n                    >\n                      <Send className=\"w-3 h-3 mr-1\" />\n                      Request\n                    </button>\n                  )}\n                  {ref.verification_status === 'received' && (\n                    <button\n                      onClick={() => handleVerifyReference(ref.id)}\n                      className=\"flex items-center px-3 py-1 text-sm bg-green-100 text-green-700 rounded hover:bg-green-200\"\n                    >\n                      <CheckCircle className=\"w-3 h-3 mr-1\" />\n                      Verify\n                    </button>\n                  )}\n                  {ref.verification_status === 'verified' && (\n                    <div className=\"flex items-center text-green-600 text-sm\">\n                      <CheckCircle className=\"w-4 h-4 mr-1\" />\n                      Verified\n                    </div>\n                  )}\n                  {ref.verification_status === 'requested' && (\n                    <div className=\"flex items-center text-blue-600 text-sm\">\n                      <Clock className=\"w-4 h-4 mr-1\" />\n                      Awaiting Response\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          ))\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/RegulatoryNewsWidget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/RightToWorkForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/SafeStaffingCalculator.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used. Allowed unused vars must match /^_/u.","line":22,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingDown' is defined but never used. Allowed unused vars must match /^_/u.","line":23,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used. Allowed unused vars must match /^_/u.","line":25,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Building2' is defined but never used. Allowed unused vars must match /^_/u.","line":26,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'currentTenant' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":134,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":134,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Safe Staffing Calculator Component\n * \n * CQC Regulation 18 Compliance\n * Calculates and monitors safe staffing ratios for care settings\n * \n * Based on:\n * - CQC Fundamental Standards (Regulation 18)\n * - Skills for Care guidance\n * - National Minimum Standards\n */\n\nimport React, { useState, useEffect, useMemo } from 'react';\nimport {\n    Users,\n    AlertTriangle,\n    CheckCircle,\n    Calculator,\n    Clock,\n    UserCheck,\n    Shield,\n    TrendingUp,\n    TrendingDown,\n    Info,\n    Calendar,\n    Building2,\n    Activity,\n    AlertCircle,\n    ChevronRight\n} from 'lucide-react';\nimport { useTenant } from '@/contexts/TenantContext';\n\n// ============================================\n// TYPES\n// ============================================\n\ninterface ServiceUser {\n    id: string;\n    name: string;\n    dependency_level: 'low' | 'medium' | 'high' | 'very_high';\n    care_hours_required: number;\n    one_to_one_care: boolean;\n    night_supervision: boolean;\n    clinical_needs: boolean;\n}\n\ninterface StaffMember {\n    id: string;\n    name: string;\n    role: 'nurse' | 'senior_carer' | 'carer' | 'support_worker';\n    qualified: boolean;\n    on_shift: boolean;\n    shift_start?: string;\n    shift_end?: string;\n}\n\ninterface ShiftPeriod {\n    name: string;\n    start: string;\n    end: string;\n    type: 'day' | 'evening' | 'night';\n}\n\ninterface StaffingCalculation {\n    totalServiceUsers: number;\n    totalCareHours: number;\n    minimumStaffRequired: number;\n    minimumNursesRequired: number;\n    minimumSeniorCarersRequired: number;\n    minimumCarersRequired: number;\n    actualStaffOnShift: number;\n    actualNursesOnShift: number;\n    actualSeniorCarersOnShift: number;\n    actualCarersOnShift: number;\n    staffingRatio: string;\n    complianceStatus: 'compliant' | 'at_risk' | 'non_compliant';\n    gaps: StaffingGap[];\n    recommendations: string[];\n}\n\ninterface StaffingGap {\n    role: string;\n    required: number;\n    actual: number;\n    shortfall: number;\n    severity: 'critical' | 'high' | 'medium' | 'low';\n}\n\n// ============================================\n// CONSTANTS\n// ============================================\n\n// CQC-aligned staffing ratios based on dependency levels\nconst DEPENDENCY_RATIOS = {\n    residential: {\n        low: { ratio: 8, nursesRequired: false },      // 1:8\n        medium: { ratio: 6, nursesRequired: false },   // 1:6\n        high: { ratio: 4, nursesRequired: true },      // 1:4\n        very_high: { ratio: 2, nursesRequired: true }  // 1:2\n    },\n    nursing: {\n        low: { ratio: 6, nursesRequired: true },\n        medium: { ratio: 5, nursesRequired: true },\n        high: { ratio: 3, nursesRequired: true },\n        very_high: { ratio: 1.5, nursesRequired: true }\n    },\n    domiciliary: {\n        low: { ratio: 10, nursesRequired: false },\n        medium: { ratio: 8, nursesRequired: false },\n        high: { ratio: 5, nursesRequired: true },\n        very_high: { ratio: 2, nursesRequired: true }\n    }\n};\n\nconst SHIFT_PERIODS: ShiftPeriod[] = [\n    { name: 'Early', start: '07:00', end: '15:00', type: 'day' },\n    { name: 'Late', start: '14:00', end: '22:00', type: 'evening' },\n    { name: 'Night', start: '21:00', end: '07:30', type: 'night' }\n];\n\n// ============================================\n// COMPONENT\n// ============================================\n\ninterface SafeStaffingCalculatorProps {\n    settingType?: 'residential' | 'nursing' | 'domiciliary';\n    onClose?: () => void;\n}\n\nexport default function SafeStaffingCalculator({\n    settingType = 'residential',\n    onClose\n}: SafeStaffingCalculatorProps) {\n    const { currentTenant } = useTenant();\n    const [selectedShift, setSelectedShift] = useState<ShiftPeriod>(SHIFT_PERIODS[0]);\n    const [serviceType, setServiceType] = useState<'residential' | 'nursing' | 'domiciliary'>(settingType);\n\n    // Demo data - in production this would come from the database\n    const [serviceUsers] = useState<ServiceUser[]>([\n        { id: '1', name: 'Service User 1', dependency_level: 'low', care_hours_required: 2, one_to_one_care: false, night_supervision: false, clinical_needs: false },\n        { id: '2', name: 'Service User 2', dependency_level: 'medium', care_hours_required: 4, one_to_one_care: false, night_supervision: false, clinical_needs: false },\n        { id: '3', name: 'Service User 3', dependency_level: 'high', care_hours_required: 6, one_to_one_care: false, night_supervision: true, clinical_needs: true },\n        { id: '4', name: 'Service User 4', dependency_level: 'medium', care_hours_required: 4, one_to_one_care: false, night_supervision: false, clinical_needs: false },\n        { id: '5', name: 'Service User 5', dependency_level: 'very_high', care_hours_required: 8, one_to_one_care: true, night_supervision: true, clinical_needs: true },\n        { id: '6', name: 'Service User 6', dependency_level: 'low', care_hours_required: 2, one_to_one_care: false, night_supervision: false, clinical_needs: false },\n        { id: '7', name: 'Service User 7', dependency_level: 'medium', care_hours_required: 4, one_to_one_care: false, night_supervision: false, clinical_needs: false },\n        { id: '8', name: 'Service User 8', dependency_level: 'high', care_hours_required: 6, one_to_one_care: false, night_supervision: true, clinical_needs: true },\n        { id: '9', name: 'Service User 9', dependency_level: 'low', care_hours_required: 2, one_to_one_care: false, night_supervision: false, clinical_needs: false },\n        { id: '10', name: 'Service User 10', dependency_level: 'medium', care_hours_required: 4, one_to_one_care: false, night_supervision: false, clinical_needs: false },\n    ]);\n\n    const [staffOnShift] = useState<StaffMember[]>([\n        { id: 's1', name: 'Sarah Nurse', role: 'nurse', qualified: true, on_shift: true },\n        { id: 's2', name: 'John Senior', role: 'senior_carer', qualified: true, on_shift: true },\n        { id: 's3', name: 'Mary Care', role: 'carer', qualified: true, on_shift: true },\n        { id: 's4', name: 'Tom Support', role: 'carer', qualified: true, on_shift: true },\n    ]);\n\n    // Calculate staffing requirements\n    const calculation = useMemo((): StaffingCalculation => {\n        const ratios = DEPENDENCY_RATIOS[serviceType];\n\n        // Count service users by dependency\n        const dependencyCounts = {\n            low: serviceUsers.filter(u => u.dependency_level === 'low').length,\n            medium: serviceUsers.filter(u => u.dependency_level === 'medium').length,\n            high: serviceUsers.filter(u => u.dependency_level === 'high').length,\n            very_high: serviceUsers.filter(u => u.dependency_level === 'very_high').length\n        };\n\n        // Calculate minimum staff needed for each dependency level\n        const staffForLow = Math.ceil(dependencyCounts.low / ratios.low.ratio);\n        const staffForMedium = Math.ceil(dependencyCounts.medium / ratios.medium.ratio);\n        const staffForHigh = Math.ceil(dependencyCounts.high / ratios.high.ratio);\n        const staffForVeryHigh = Math.ceil(dependencyCounts.very_high / ratios.very_high.ratio);\n\n        // Add 1:1 care requirements\n        const oneToOneStaff = serviceUsers.filter(u => u.one_to_one_care).length;\n\n        const minimumStaffRequired = staffForLow + staffForMedium + staffForHigh + staffForVeryHigh + oneToOneStaff;\n\n        // Calculate nurse requirements (at least 1 nurse if any high/very high dependency)\n        const needsNurse = dependencyCounts.high > 0 || dependencyCounts.very_high > 0;\n        const minimumNursesRequired = needsNurse ? Math.max(1, Math.ceil(minimumStaffRequired * 0.2)) : 0;\n\n        // Senior carers - at least 1 per shift, or 1 per 4 staff\n        const minimumSeniorCarersRequired = Math.max(1, Math.ceil(minimumStaffRequired / 4));\n\n        // Remaining staff can be carers\n        const minimumCarersRequired = minimumStaffRequired - minimumNursesRequired - minimumSeniorCarersRequired;\n\n        // Count actual staff on shift\n        const actualNursesOnShift = staffOnShift.filter(s => s.role === 'nurse' && s.on_shift).length;\n        const actualSeniorCarersOnShift = staffOnShift.filter(s => s.role === 'senior_carer' && s.on_shift).length;\n        const actualCarersOnShift = staffOnShift.filter(s => (s.role === 'carer' || s.role === 'support_worker') && s.on_shift).length;\n        const actualStaffOnShift = actualNursesOnShift + actualSeniorCarersOnShift + actualCarersOnShift;\n\n        // Calculate staffing ratio\n        const staffingRatio = `1:${(serviceUsers.length / actualStaffOnShift).toFixed(1)}`;\n\n        // Identify gaps\n        const gaps: StaffingGap[] = [];\n\n        if (actualNursesOnShift < minimumNursesRequired) {\n            gaps.push({\n                role: 'Registered Nurse',\n                required: minimumNursesRequired,\n                actual: actualNursesOnShift,\n                shortfall: minimumNursesRequired - actualNursesOnShift,\n                severity: 'critical'\n            });\n        }\n\n        if (actualSeniorCarersOnShift < minimumSeniorCarersRequired) {\n            gaps.push({\n                role: 'Senior Carer',\n                required: minimumSeniorCarersRequired,\n                actual: actualSeniorCarersOnShift,\n                shortfall: minimumSeniorCarersRequired - actualSeniorCarersOnShift,\n                severity: 'high'\n            });\n        }\n\n        if (actualStaffOnShift < minimumStaffRequired) {\n            const shortfall = minimumStaffRequired - actualStaffOnShift;\n            gaps.push({\n                role: 'Care Staff',\n                required: minimumStaffRequired,\n                actual: actualStaffOnShift,\n                shortfall,\n                severity: shortfall >= 3 ? 'critical' : shortfall >= 2 ? 'high' : 'medium'\n            });\n        }\n\n        // Determine compliance status\n        let complianceStatus: 'compliant' | 'at_risk' | 'non_compliant' = 'compliant';\n        if (gaps.some(g => g.severity === 'critical')) {\n            complianceStatus = 'non_compliant';\n        } else if (gaps.length > 0) {\n            complianceStatus = 'at_risk';\n        }\n\n        // Generate recommendations\n        const recommendations: string[] = [];\n        if (actualNursesOnShift < minimumNursesRequired) {\n            recommendations.push(`Urgent: Add ${minimumNursesRequired - actualNursesOnShift} registered nurse(s) to meet clinical needs requirements`);\n        }\n        if (actualSeniorCarersOnShift < minimumSeniorCarersRequired) {\n            recommendations.push(`Add ${minimumSeniorCarersRequired - actualSeniorCarersOnShift} senior carer(s) for shift leadership`);\n        }\n        if (actualStaffOnShift < minimumStaffRequired) {\n            recommendations.push(`Increase total care staff by ${minimumStaffRequired - actualStaffOnShift} to meet safe staffing ratios`);\n        }\n        if (complianceStatus === 'compliant') {\n            recommendations.push('Staffing levels meet CQC Regulation 18 requirements for safe care delivery');\n        }\n\n        return {\n            totalServiceUsers: serviceUsers.length,\n            totalCareHours: serviceUsers.reduce((sum, u) => sum + u.care_hours_required, 0),\n            minimumStaffRequired,\n            minimumNursesRequired,\n            minimumSeniorCarersRequired,\n            minimumCarersRequired: Math.max(0, minimumCarersRequired),\n            actualStaffOnShift,\n            actualNursesOnShift,\n            actualSeniorCarersOnShift,\n            actualCarersOnShift,\n            staffingRatio,\n            complianceStatus,\n            gaps,\n            recommendations\n        };\n    }, [serviceUsers, staffOnShift, serviceType]);\n\n    const getComplianceColor = (status: string) => {\n        switch (status) {\n            case 'compliant': return 'text-green-600 bg-green-100';\n            case 'at_risk': return 'text-amber-600 bg-amber-100';\n            case 'non_compliant': return 'text-red-600 bg-red-100';\n            default: return 'text-gray-600 bg-gray-100';\n        }\n    };\n\n    const getComplianceIcon = (status: string) => {\n        switch (status) {\n            case 'compliant': return <CheckCircle className=\"w-6 h-6\" />;\n            case 'at_risk': return <AlertTriangle className=\"w-6 h-6\" />;\n            case 'non_compliant': return <AlertCircle className=\"w-6 h-6\" />;\n            default: return <Info className=\"w-6 h-6\" />;\n        }\n    };\n\n    return (\n        <div className=\"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden\">\n            {/* Header */}\n            <div className=\"p-6 bg-gradient-to-r from-blue-600 to-indigo-600\">\n                <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                        <div className=\"p-3 bg-white/20 rounded-xl\">\n                            <Calculator className=\"w-8 h-8 text-white\" />\n                        </div>\n                        <div>\n                            <h2 className=\"text-xl font-bold text-white\">Safe Staffing Calculator</h2>\n                            <p className=\"text-blue-100\">CQC Regulation 18 Compliance</p>\n                        </div>\n                    </div>\n                    {onClose && (\n                        <button onClick={onClose} className=\"text-white/80 hover:text-white text-2xl\">\n                            &times;\n                        </button>\n                    )}\n                </div>\n            </div>\n\n            {/* Controls */}\n            <div className=\"p-4 border-b border-gray-200 bg-gray-50\">\n                <div className=\"flex flex-wrap items-center gap-4\">\n                    <div>\n                        <label className=\"block text-xs font-medium text-gray-500 mb-1\">Service Type</label>\n                        <select\n                            value={serviceType}\n                            onChange={(e) => setServiceType(e.target.value as any)}\n                            className=\"rounded-lg border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500\"\n                        >\n                            <option value=\"residential\">Residential Care</option>\n                            <option value=\"nursing\">Nursing Home</option>\n                            <option value=\"domiciliary\">Domiciliary Care</option>\n                        </select>\n                    </div>\n                    <div>\n                        <label className=\"block text-xs font-medium text-gray-500 mb-1\">Shift Period</label>\n                        <div className=\"flex rounded-lg overflow-hidden border border-gray-300\">\n                            {SHIFT_PERIODS.map(shift => (\n                                <button\n                                    key={shift.name}\n                                    onClick={() => setSelectedShift(shift)}\n                                    className={`px-3 py-1.5 text-sm font-medium ${selectedShift.name === shift.name\n                                            ? 'bg-blue-600 text-white'\n                                            : 'bg-white text-gray-600 hover:bg-gray-50'\n                                        }`}\n                                >\n                                    {shift.name}\n                                </button>\n                            ))}\n                        </div>\n                    </div>\n                    <div className=\"ml-auto\">\n                        <span className=\"text-xs text-gray-500\">Shift: {selectedShift.start} - {selectedShift.end}</span>\n                    </div>\n                </div>\n            </div>\n\n            {/* Compliance Status Banner */}\n            <div className={`p-4 ${getComplianceColor(calculation.complianceStatus)}`}>\n                <div className=\"flex items-center gap-3\">\n                    {getComplianceIcon(calculation.complianceStatus)}\n                    <div>\n                        <p className=\"font-semibold capitalize\">{calculation.complianceStatus.replace('_', ' ')}</p>\n                        <p className=\"text-sm opacity-80\">\n                            {calculation.complianceStatus === 'compliant'\n                                ? 'Staffing levels meet safe care requirements'\n                                : `${calculation.gaps.length} staffing gap(s) identified`}\n                        </p>\n                    </div>\n                    <div className=\"ml-auto text-right\">\n                        <p className=\"text-3xl font-bold\">{calculation.staffingRatio}</p>\n                        <p className=\"text-xs opacity-80\">Current Ratio</p>\n                    </div>\n                </div>\n            </div>\n\n            {/* Main Content */}\n            <div className=\"p-6\">\n                {/* Stats Grid */}\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\n                    <div className=\"p-4 bg-gray-50 rounded-lg\">\n                        <div className=\"flex items-center gap-2 text-gray-600 mb-1\">\n                            <Users className=\"w-4 h-4\" />\n                            <span className=\"text-xs font-medium\">Service Users</span>\n                        </div>\n                        <p className=\"text-2xl font-bold text-gray-900\">{calculation.totalServiceUsers}</p>\n                    </div>\n                    <div className=\"p-4 bg-gray-50 rounded-lg\">\n                        <div className=\"flex items-center gap-2 text-gray-600 mb-1\">\n                            <Clock className=\"w-4 h-4\" />\n                            <span className=\"text-xs font-medium\">Care Hours/Day</span>\n                        </div>\n                        <p className=\"text-2xl font-bold text-gray-900\">{calculation.totalCareHours}</p>\n                    </div>\n                    <div className=\"p-4 bg-blue-50 rounded-lg\">\n                        <div className=\"flex items-center gap-2 text-blue-600 mb-1\">\n                            <UserCheck className=\"w-4 h-4\" />\n                            <span className=\"text-xs font-medium\">Staff Required</span>\n                        </div>\n                        <p className=\"text-2xl font-bold text-blue-600\">{calculation.minimumStaffRequired}</p>\n                    </div>\n                    <div className={`p-4 rounded-lg ${calculation.actualStaffOnShift >= calculation.minimumStaffRequired\n                            ? 'bg-green-50' : 'bg-red-50'\n                        }`}>\n                        <div className={`flex items-center gap-2 mb-1 ${calculation.actualStaffOnShift >= calculation.minimumStaffRequired\n                                ? 'text-green-600' : 'text-red-600'\n                            }`}>\n                            <Activity className=\"w-4 h-4\" />\n                            <span className=\"text-xs font-medium\">Staff On Shift</span>\n                        </div>\n                        <p className={`text-2xl font-bold ${calculation.actualStaffOnShift >= calculation.minimumStaffRequired\n                                ? 'text-green-600' : 'text-red-600'\n                            }`}>{calculation.actualStaffOnShift}</p>\n                    </div>\n                </div>\n\n                {/* Staff Breakdown */}\n                <div className=\"mb-6\">\n                    <h3 className=\"text-sm font-semibold text-gray-700 mb-3\">Staff Breakdown</h3>\n                    <div className=\"space-y-3\">\n                        {[\n                            { role: 'Registered Nurses', required: calculation.minimumNursesRequired, actual: calculation.actualNursesOnShift, icon: 'ð©º' },\n                            { role: 'Senior Carers', required: calculation.minimumSeniorCarersRequired, actual: calculation.actualSeniorCarersOnShift, icon: 'â­' },\n                            { role: 'Care Assistants', required: calculation.minimumCarersRequired, actual: calculation.actualCarersOnShift, icon: 'ð' }\n                        ].map(row => (\n                            <div key={row.role} className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n                                <div className=\"flex items-center gap-2\">\n                                    <span className=\"text-lg\">{row.icon}</span>\n                                    <span className=\"font-medium text-gray-700\">{row.role}</span>\n                                </div>\n                                <div className=\"flex items-center gap-4\">\n                                    <div className=\"text-right\">\n                                        <p className=\"text-xs text-gray-500\">Required</p>\n                                        <p className=\"font-semibold\">{row.required}</p>\n                                    </div>\n                                    <ChevronRight className=\"w-4 h-4 text-gray-400\" />\n                                    <div className={`text-right ${row.actual >= row.required ? 'text-green-600' : 'text-red-600'}`}>\n                                        <p className=\"text-xs\">Actual</p>\n                                        <p className=\"font-semibold\">{row.actual}</p>\n                                    </div>\n                                    {row.actual >= row.required ? (\n                                        <CheckCircle className=\"w-5 h-5 text-green-500\" />\n                                    ) : (\n                                        <AlertTriangle className=\"w-5 h-5 text-red-500\" />\n                                    )}\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n                </div>\n\n                {/* Gaps & Recommendations */}\n                {calculation.gaps.length > 0 && (\n                    <div className=\"mb-6\">\n                        <h3 className=\"text-sm font-semibold text-gray-700 mb-3\">Staffing Gaps</h3>\n                        <div className=\"space-y-2\">\n                            {calculation.gaps.map((gap, idx) => (\n                                <div key={idx} className={`p-3 rounded-lg border ${gap.severity === 'critical' ? 'bg-red-50 border-red-200' :\n                                        gap.severity === 'high' ? 'bg-amber-50 border-amber-200' :\n                                            'bg-yellow-50 border-yellow-200'\n                                    }`}>\n                                    <div className=\"flex items-center justify-between\">\n                                        <span className=\"font-medium\">{gap.role}</span>\n                                        <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${gap.severity === 'critical' ? 'bg-red-200 text-red-800' :\n                                                gap.severity === 'high' ? 'bg-amber-200 text-amber-800' :\n                                                    'bg-yellow-200 text-yellow-800'\n                                            }`}>\n                                            -{gap.shortfall} shortfall\n                                        </span>\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n                )}\n\n                {/* Recommendations */}\n                <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                    <h3 className=\"text-sm font-semibold text-blue-800 mb-2 flex items-center gap-2\">\n                        <Shield className=\"w-4 h-4\" />\n                        Recommendations\n                    </h3>\n                    <ul className=\"space-y-1\">\n                        {calculation.recommendations.map((rec, idx) => (\n                            <li key={idx} className=\"text-sm text-blue-700 flex items-start gap-2\">\n                                <span className=\"text-blue-400\">â¢</span>\n                                {rec}\n                            </li>\n                        ))}\n                    </ul>\n                </div>\n            </div>\n\n            {/* Footer */}\n            <div className=\"p-4 border-t border-gray-200 bg-gray-50\">\n                <p className=\"text-xs text-gray-500 text-center\">\n                    Calculations based on CQC Regulation 18 guidance and Skills for Care recommendations.\n                    Always apply professional judgement based on individual service user needs.\n                </p>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/SyncToCareFlow.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RefreshCw' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Users' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'employeeName' is defined but never used. Allowed unused args must match /^_/u.","line":18,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport { useTenant } from '@/contexts/TenantContext';\nimport {\n    RefreshCw, CheckCircle, AlertCircle, Heart,\n    Users, ArrowRight, Loader2\n} from 'lucide-react';\n\ninterface SyncToCareFlowProps {\n    employeeId?: string;\n    employeeName?: string;\n    onSuccess?: () => void;\n}\n\nexport default function SyncToCareFlow({\n    employeeId,\n    employeeName,\n    onSuccess\n}: SyncToCareFlowProps) {\n    const { currentTenant } = useTenant();\n    const [syncing, setSyncing] = useState(false);\n    const [result, setResult] = useState<{\n        success: boolean;\n        message: string;\n    } | null>(null);\n\n    // Check if CareFlow is enabled for this tenant\n    const careflowEnabled = currentTenant?.settings?.careflow_enabled !== false;\n\n    if (!careflowEnabled) {\n        return null;\n    }\n\n    async function handleSync() {\n        if (!currentTenant) return;\n\n        setSyncing(true);\n        setResult(null);\n\n        try {\n            const { data, error } = await supabase.functions.invoke('sync-to-careflow', {\n                body: {\n                    employee_id: employeeId,\n                    tenant_id: currentTenant.id,\n                    action: employeeId ? 'sync' : 'sync_all'\n                }\n            });\n\n            if (error) throw error;\n\n            setResult({\n                success: data.success,\n                message: data.message || 'Sync completed'\n            });\n\n            if (data.success && onSuccess) {\n                onSuccess();\n            }\n        } catch (error: any) {\n            log.error('CareFlow sync failed', error, { component: 'SyncToCareFlow', action: 'handleSync', metadata: { employeeId, tenantId: currentTenant.id } });\n            setResult({\n                success: false,\n                message: error.message || 'Failed to sync with CareFlow'\n            });\n        } finally {\n            setSyncing(false);\n\n            // Clear result after 5 seconds\n            setTimeout(() => setResult(null), 5000);\n        }\n    }\n\n    return (\n        <div className=\"inline-flex flex-col items-start\">\n            <button\n                onClick={handleSync}\n                disabled={syncing}\n                className={`inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition ${syncing\n                    ? 'bg-gray-100 text-gray-400 cursor-not-allowed'\n                    : 'bg-gradient-to-r from-pink-500 to-rose-600 text-white hover:from-pink-600 hover:to-rose-700 shadow-sm'\n                    }`}\n            >\n                {syncing ? (\n                    <>\n                        <Loader2 className=\"w-4 h-4 animate-spin\" />\n                        Syncing...\n                    </>\n                ) : (\n                    <>\n                        <Heart className=\"w-4 h-4\" />\n                        {employeeId ? 'Sync to CareFlow' : 'Sync All to CareFlow'}\n                        <ArrowRight className=\"w-4 h-4\" />\n                    </>\n                )}\n            </button>\n\n            {/* Result Message */}\n            {result && (\n                <div className={`mt-2 flex items-center gap-2 text-sm ${result.success ? 'text-green-600' : 'text-red-600'\n                    }`}>\n                    {result.success ? (\n                        <CheckCircle className=\"w-4 h-4\" />\n                    ) : (\n                        <AlertCircle className=\"w-4 h-4\" />\n                    )}\n                    {result.message}\n                </div>\n            )}\n        </div>\n    );\n}\n\n// Compact sync button for table rows\nexport function CompactSyncButton({\n    employeeId,\n    onSuccess\n}: {\n    employeeId: string;\n    onSuccess?: () => void;\n}) {\n    const { currentTenant } = useTenant();\n    const [syncing, setSyncing] = useState(false);\n    const [synced, setSynced] = useState(false);\n\n    const careflowEnabled = currentTenant?.settings?.careflow_enabled !== false;\n    if (!careflowEnabled) return null;\n\n    async function handleSync() {\n        if (!currentTenant) return;\n\n        setSyncing(true);\n\n        try {\n            const { data, error } = await supabase.functions.invoke('sync-to-careflow', {\n                body: {\n                    employee_id: employeeId,\n                    tenant_id: currentTenant.id,\n                    action: 'sync'\n                }\n            });\n\n            if (error) throw error;\n\n            if (data.success) {\n                setSynced(true);\n                onSuccess?.();\n            }\n        } catch (error) {\n            log.error('CareFlow sync failed (compact)', error, { component: 'CompactSyncButton', action: 'handleSync', metadata: { employeeId, tenantId: currentTenant.id } });\n        } finally {\n            setSyncing(false);\n        }\n    }\n\n    if (synced) {\n        return (\n            <span className=\"inline-flex items-center gap-1 text-xs text-green-600\">\n                <CheckCircle className=\"w-3 h-3\" />\n                Synced\n            </span>\n        );\n    }\n\n    return (\n        <button\n            onClick={handleSync}\n            disabled={syncing}\n            className=\"inline-flex items-center gap-1 px-2 py-1 text-xs text-pink-600 hover:bg-pink-50 rounded transition\"\n            title=\"Sync to CareFlow\"\n        >\n            {syncing ? (\n                <Loader2 className=\"w-3 h-3 animate-spin\" />\n            ) : (\n                <Heart className=\"w-3 h-3\" />\n            )}\n            CareFlow\n        </button>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/TeamDirectory.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Filter' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":81,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":87},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SortAsc' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":89,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":96},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadEmployees'. Either include it or remove the dependency array.","line":38,"column":8,"nodeType":"ArrayExpression","endLine":38,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [currentTenant, loadEmployees]","fix":{"range":[1462,1477],"text":"[currentTenant, loadEmployees]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'filterAndSortEmployees'. Either include it or remove the dependency array.","line":42,"column":8,"nodeType":"ArrayExpression","endLine":42,"endColumn":60,"suggestions":[{"desc":"Update the dependencies array to be: [employees, filterAndSortEmployees, searchQuery, selectedDepartment, sortBy]","fix":{"range":[1544,1596],"text":"[employees, filterAndSortEmployees, searchQuery, selectedDepartment, sortBy]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { Search, User, Mail, Phone, Building, MapPin, ChevronRight, Grid, List, Filter, SortAsc } from 'lucide-react';\nimport { getInitials } from '@/lib/utils';\n\ninterface Employee {\n    id: string;\n    first_name: string;\n    last_name: string;\n    email: string;\n    phone?: string;\n    department: string;\n    position: string;\n    location?: string;\n    avatar_url?: string;\n    status: 'active' | 'inactive' | 'on_leave';\n    manager_id?: string;\n    hire_date: string;\n}\n\nexport default function TeamDirectory() {\n    const navigate = useNavigate();\n    const { currentTenant } = useTenant();\n    const [employees, setEmployees] = useState<Employee[]>([]);\n    const [filteredEmployees, setFilteredEmployees] = useState<Employee[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [searchQuery, setSearchQuery] = useState('');\n    const [selectedDepartment, setSelectedDepartment] = useState<string>('all');\n    const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid');\n    const [sortBy, setSortBy] = useState<'name' | 'department' | 'hire_date'>('name');\n    const [selectedEmployee, setSelectedEmployee] = useState<Employee | null>(null);\n\n    useEffect(() => {\n        loadEmployees();\n    }, [currentTenant]);\n\n    useEffect(() => {\n        filterAndSortEmployees();\n    }, [employees, searchQuery, selectedDepartment, sortBy]);\n\n    async function loadEmployees() {\n        setLoading(true);\n        try {\n            const { data, error } = await supabase\n                .from('employees')\n                .select('*')\n                .eq('tenant_id', currentTenant?.id)\n                .order('first_name');\n\n            if (error) throw error;\n            setEmployees(data || []);\n        } catch (error) {\n            log.error('Error loading employees', error, { component: 'TeamDirectory', action: 'loadEmployees' });\n            // Generate mock data\n            setEmployees(generateMockEmployees());\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    function generateMockEmployees(): Employee[] {\n        const departments = ['Engineering', 'Sales', 'Marketing', 'HR', 'Operations', 'Finance'];\n        const positions = ['Manager', 'Senior', 'Junior', 'Lead', 'Director', 'Analyst'];\n        const firstNames = ['John', 'Jane', 'Michael', 'Sarah', 'David', 'Emma', 'James', 'Emily', 'Robert', 'Lisa', 'William', 'Anna'];\n        const lastNames = ['Smith', 'Johnson', 'Williams', 'Brown', 'Jones', 'Davis', 'Miller', 'Wilson', 'Moore', 'Taylor'];\n\n        return Array.from({ length: 24 }, (_, i) => ({\n            id: `emp-${i}`,\n            first_name: firstNames[Math.floor(Math.random() * firstNames.length)],\n            last_name: lastNames[Math.floor(Math.random() * lastNames.length)],\n            email: `user${i}@company.com`,\n            phone: `+44 7${Math.random().toString().slice(2, 12)}`,\n            department: departments[Math.floor(Math.random() * departments.length)],\n            position: `${positions[Math.floor(Math.random() * positions.length)]} ${['Developer', 'Designer', 'Manager', 'Executive'][Math.floor(Math.random() * 4)]}`,\n            location: ['London', 'Manchester', 'Remote', 'Birmingham'][Math.floor(Math.random() * 4)],\n            status: ['active', 'active', 'active', 'on_leave'][Math.floor(Math.random() * 4)] as any,\n            hire_date: new Date(2020 + Math.floor(Math.random() * 4), Math.floor(Math.random() * 12), Math.floor(Math.random() * 28) + 1).toISOString(),\n        }));\n    }\n\n    function filterAndSortEmployees() {\n        let filtered = [...employees];\n\n        // Search\n        if (searchQuery) {\n            const query = searchQuery.toLowerCase();\n            filtered = filtered.filter(emp =>\n                emp.first_name.toLowerCase().includes(query) ||\n                emp.last_name.toLowerCase().includes(query) ||\n                emp.email.toLowerCase().includes(query) ||\n                emp.department.toLowerCase().includes(query) ||\n                emp.position.toLowerCase().includes(query)\n            );\n        }\n\n        // Department filter\n        if (selectedDepartment !== 'all') {\n            filtered = filtered.filter(emp => emp.department === selectedDepartment);\n        }\n\n        // Sort\n        filtered.sort((a, b) => {\n            switch (sortBy) {\n                case 'name':\n                    return `${a.first_name} ${a.last_name}`.localeCompare(`${b.first_name} ${b.last_name}`);\n                case 'department':\n                    return a.department.localeCompare(b.department);\n                case 'hire_date':\n                    return new Date(b.hire_date).getTime() - new Date(a.hire_date).getTime();\n                default:\n                    return 0;\n            }\n        });\n\n        setFilteredEmployees(filtered);\n    }\n\n    const departments = Array.from(new Set(employees.map(e => e.department))).sort();\n\n    function getStatusColor(status: string) {\n        switch (status) {\n            case 'active': return 'bg-green-500';\n            case 'inactive': return 'bg-gray-400';\n            case 'on_leave': return 'bg-yellow-500';\n            default: return 'bg-gray-400';\n        }\n    }\n\n    function getAvatarColor(name: string) {\n        const colors = [\n            'bg-blue-500', 'bg-green-500', 'bg-purple-500', 'bg-orange-500',\n            'bg-pink-500', 'bg-teal-500', 'bg-indigo-500', 'bg-red-500'\n        ];\n        const index = name.charCodeAt(0) % colors.length;\n        return colors[index];\n    }\n\n    function handleSendMessage(employee: Employee) {\n        setSelectedEmployee(null);\n        navigate('/messaging', { state: { recipientEmail: employee.email, recipientName: `${employee.first_name} ${employee.last_name}` } });\n    }\n\n    function handleViewProfile(employee: Employee) {\n        setSelectedEmployee(null);\n        navigate('/hr', { state: { employeeId: employee.id } });\n    }\n\n    if (loading) {\n        return (\n            <div className=\"bg-white rounded-xl border border-gray-200 p-6\">\n                <div className=\"animate-pulse space-y-4\">\n                    <div className=\"h-10 bg-gray-200 rounded w-1/3\" />\n                    <div className=\"grid grid-cols-3 gap-4\">\n                        {[1, 2, 3, 4, 5, 6].map(i => (\n                            <div key={i} className=\"h-48 bg-gray-100 rounded-xl\" />\n                        ))}\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"bg-white rounded-xl border border-gray-200 overflow-hidden\">\n            {/* Header */}\n            <div className=\"px-6 py-4 border-b border-gray-200\">\n                <div className=\"flex items-center justify-between\">\n                    <div>\n                        <h2 className=\"text-lg font-semibold text-gray-900\">Team Directory</h2>\n                        <p className=\"text-sm text-gray-500\">{employees.length} team members</p>\n                    </div>\n                    <div className=\"flex items-center space-x-2\">\n                        <button\n                            onClick={() => setViewMode('grid')}\n                            className={`p-2 rounded-lg transition ${viewMode === 'grid' ? 'bg-indigo-100 text-indigo-600' : 'text-gray-400 hover:bg-gray-100'}`}\n                        >\n                            <Grid className=\"w-5 h-5\" />\n                        </button>\n                        <button\n                            onClick={() => setViewMode('list')}\n                            className={`p-2 rounded-lg transition ${viewMode === 'list' ? 'bg-indigo-100 text-indigo-600' : 'text-gray-400 hover:bg-gray-100'}`}\n                        >\n                            <List className=\"w-5 h-5\" />\n                        </button>\n                    </div>\n                </div>\n\n                {/* Filters */}\n                <div className=\"mt-4 flex flex-wrap gap-3\">\n                    <div className=\"relative flex-1 min-w-64\">\n                        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                        <input\n                            type=\"text\"\n                            value={searchQuery}\n                            onChange={(e) => setSearchQuery(e.target.value)}\n                            placeholder=\"Search by name, email, department...\"\n                            className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none\"\n                        />\n                    </div>\n                    <select\n                        value={selectedDepartment}\n                        onChange={(e) => setSelectedDepartment(e.target.value)}\n                        className=\"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none\"\n                    >\n                        <option value=\"all\">All Departments</option>\n                        {departments.map(dept => (\n                            <option key={dept} value={dept}>{dept}</option>\n                        ))}\n                    </select>\n                    <select\n                        value={sortBy}\n                        onChange={(e) => setSortBy(e.target.value as any)}\n                        className=\"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none\"\n                    >\n                        <option value=\"name\">Sort by Name</option>\n                        <option value=\"department\">Sort by Department</option>\n                        <option value=\"hire_date\">Sort by Hire Date</option>\n                    </select>\n                </div>\n            </div>\n\n            {/* Employee Grid/List */}\n            <div className={`p-6 ${viewMode === 'grid' ? 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4' : 'space-y-2'}`}>\n                {filteredEmployees.length === 0 ? (\n                    <div className=\"col-span-full text-center py-12 text-gray-500\">\n                        <User className=\"w-12 h-12 mx-auto mb-2 text-gray-300\" />\n                        <p>No team members found</p>\n                    </div>\n                ) : viewMode === 'grid' ? (\n                    filteredEmployees.map(employee => (\n                        <div\n                            key={employee.id}\n                            onClick={() => setSelectedEmployee(employee)}\n                            className=\"bg-white border border-gray-200 rounded-xl p-4 hover:shadow-lg hover:border-indigo-300 transition cursor-pointer\"\n                        >\n                            <div className=\"flex items-center space-x-3 mb-3\">\n                                <div className=\"relative\">\n                                    {employee.avatar_url ? (\n                                        <img src={employee.avatar_url} alt=\"\" className=\"w-12 h-12 rounded-full\" />\n                                    ) : (\n                                        <div className={`w-12 h-12 rounded-full ${getAvatarColor(`${employee.first_name} ${employee.last_name}`)} flex items-center justify-center text-white font-semibold`}>\n                                            {getInitials(`${employee.first_name} ${employee.last_name}`)}\n                                        </div>\n                                    )}\n                                    <div className={`absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 ${getStatusColor(employee.status)} rounded-full border-2 border-white`} />\n                                </div>\n                                <div className=\"flex-1 min-w-0\">\n                                    <p className=\"font-medium text-gray-900 truncate\">\n                                        {employee.first_name} {employee.last_name}\n                                    </p>\n                                    <p className=\"text-sm text-gray-500 truncate\">{employee.position}</p>\n                                </div>\n                            </div>\n                            <div className=\"space-y-1.5 text-sm\">\n                                <p className=\"flex items-center text-gray-600\">\n                                    <Building className=\"w-4 h-4 mr-2 text-gray-400\" />\n                                    {employee.department}\n                                </p>\n                                <p className=\"flex items-center text-gray-600\">\n                                    <Mail className=\"w-4 h-4 mr-2 text-gray-400\" />\n                                    <span className=\"truncate\">{employee.email}</span>\n                                </p>\n                                {employee.location && (\n                                    <p className=\"flex items-center text-gray-600\">\n                                        <MapPin className=\"w-4 h-4 mr-2 text-gray-400\" />\n                                        {employee.location}\n                                    </p>\n                                )}\n                            </div>\n                        </div>\n                    ))\n                ) : (\n                    filteredEmployees.map(employee => (\n                        <div\n                            key={employee.id}\n                            onClick={() => setSelectedEmployee(employee)}\n                            className=\"flex items-center p-4 bg-white border border-gray-200 rounded-lg hover:shadow-md hover:border-indigo-300 transition cursor-pointer\"\n                        >\n                            <div className=\"relative mr-4\">\n                                {employee.avatar_url ? (\n                                    <img src={employee.avatar_url} alt=\"\" className=\"w-10 h-10 rounded-full\" />\n                                ) : (\n                                    <div className={`w-10 h-10 rounded-full ${getAvatarColor(`${employee.first_name} ${employee.last_name}`)} flex items-center justify-center text-white font-medium text-sm`}>\n                                        {getInitials(`${employee.first_name} ${employee.last_name}`)}\n                                    </div>\n                                )}\n                                <div className={`absolute -bottom-0.5 -right-0.5 w-3 h-3 ${getStatusColor(employee.status)} rounded-full border-2 border-white`} />\n                            </div>\n                            <div className=\"flex-1 min-w-0 grid grid-cols-4 gap-4\">\n                                <div>\n                                    <p className=\"font-medium text-gray-900\">{employee.first_name} {employee.last_name}</p>\n                                    <p className=\"text-sm text-gray-500\">{employee.position}</p>\n                                </div>\n                                <div>\n                                    <p className=\"text-sm text-gray-600\">{employee.department}</p>\n                                </div>\n                                <div>\n                                    <p className=\"text-sm text-gray-600\">{employee.email}</p>\n                                </div>\n                                <div>\n                                    <p className=\"text-sm text-gray-600\">{employee.location || '-'}</p>\n                                </div>\n                            </div>\n                            <ChevronRight className=\"w-5 h-5 text-gray-400\" />\n                        </div>\n                    ))\n                )}\n            </div>\n\n            {/* Employee Detail Modal */}\n            {selectedEmployee && (\n                <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n                    <div className=\"bg-white rounded-2xl max-w-md w-full overflow-hidden\">\n                        {/* Header */}\n                        <div className=\"relative bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-8 text-center\">\n                            <button\n                                onClick={() => setSelectedEmployee(null)}\n                                className=\"absolute top-4 right-4 text-white/80 hover:text-white\"\n                            >\n                                â\n                            </button>\n                            <div className=\"relative inline-block\">\n                                {selectedEmployee.avatar_url ? (\n                                    <img src={selectedEmployee.avatar_url} alt=\"\" className=\"w-20 h-20 rounded-full border-4 border-white\" />\n                                ) : (\n                                    <div className={`w-20 h-20 rounded-full ${getAvatarColor(`${selectedEmployee.first_name} ${selectedEmployee.last_name}`)} flex items-center justify-center text-white font-bold text-2xl border-4 border-white`}>\n                                        {getInitials(`${selectedEmployee.first_name} ${selectedEmployee.last_name}`)}\n                                    </div>\n                                )}\n                                <div className={`absolute bottom-1 right-1 w-5 h-5 ${getStatusColor(selectedEmployee.status)} rounded-full border-3 border-white`} />\n                            </div>\n                            <h3 className=\"mt-3 text-xl font-semibold text-white\">\n                                {selectedEmployee.first_name} {selectedEmployee.last_name}\n                            </h3>\n                            <p className=\"text-indigo-200\">{selectedEmployee.position}</p>\n                        </div>\n\n                        {/* Details */}\n                        <div className=\"px-6 py-4 space-y-4\">\n                            <div className=\"flex items-center\">\n                                <Building className=\"w-5 h-5 text-gray-400 mr-3\" />\n                                <div>\n                                    <p className=\"text-sm text-gray-500\">Department</p>\n                                    <p className=\"font-medium text-gray-900\">{selectedEmployee.department}</p>\n                                </div>\n                            </div>\n                            <div className=\"flex items-center\">\n                                <Mail className=\"w-5 h-5 text-gray-400 mr-3\" />\n                                <div>\n                                    <p className=\"text-sm text-gray-500\">Email</p>\n                                    <a href={`mailto:${selectedEmployee.email}`} className=\"font-medium text-indigo-600 hover:text-indigo-700\">\n                                        {selectedEmployee.email}\n                                    </a>\n                                </div>\n                            </div>\n                            {selectedEmployee.phone && (\n                                <div className=\"flex items-center\">\n                                    <Phone className=\"w-5 h-5 text-gray-400 mr-3\" />\n                                    <div>\n                                        <p className=\"text-sm text-gray-500\">Phone</p>\n                                        <a href={`tel:${selectedEmployee.phone}`} className=\"font-medium text-gray-900\">\n                                            {selectedEmployee.phone}\n                                        </a>\n                                    </div>\n                                </div>\n                            )}\n                            {selectedEmployee.location && (\n                                <div className=\"flex items-center\">\n                                    <MapPin className=\"w-5 h-5 text-gray-400 mr-3\" />\n                                    <div>\n                                        <p className=\"text-sm text-gray-500\">Location</p>\n                                        <p className=\"font-medium text-gray-900\">{selectedEmployee.location}</p>\n                                    </div>\n                                </div>\n                            )}\n                        </div>\n\n                        {/* Actions */}\n                        <div className=\"px-6 py-4 bg-gray-50 flex space-x-3\">\n                            <button\n                                onClick={() => handleSendMessage(selectedEmployee)}\n                                className=\"flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition\"\n                            >\n                                Send Message\n                            </button>\n                            <button\n                                onClick={() => handleViewProfile(selectedEmployee)}\n                                className=\"flex-1 px-4 py-2 bg-white text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition\"\n                            >\n                                View Profile\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/TenantOnboardingWizard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Circle' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":23},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadOnboardingData'. Either include it or remove the dependency array.","line":20,"column":8,"nodeType":"ArrayExpression","endLine":20,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [loadOnboardingData, tenantId]","fix":{"range":[816,826],"text":"[loadOnboardingData, tenantId]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used. Allowed unused args must match /^_/u.","line":116,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":116,"endColumn":40}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { onboardingService, OnboardingStep, TenantOnboarding } from '@/lib/services/OnboardingService';\nimport { Check, Circle, Loader2, ChevronRight, X } from 'lucide-react';\n\ninterface TenantOnboardingWizardProps {\n    tenantId: string;\n    tenantName: string;\n    onClose?: () => void;\n    onComplete?: () => void;\n}\n\nexport default function TenantOnboardingWizard({ tenantId, tenantName, onClose, onComplete }: TenantOnboardingWizardProps) {\n    const [steps, setSteps] = useState<OnboardingStep[]>([]);\n    const [onboardingStatus, setOnboardingStatus] = useState<TenantOnboarding | null>(null);\n    const [loading, setLoading] = useState(true);\n    const [updating, setUpdating] = useState(false);\n\n    useEffect(() => {\n        loadOnboardingData();\n    }, [tenantId]);\n\n    async function loadOnboardingData() {\n        setLoading(true);\n        const [stepsData, statusData] = await Promise.all([\n            onboardingService.getOnboardingSteps(tenantId),\n            onboardingService.getOnboardingStatus(tenantId)\n        ]);\n        setSteps(stepsData);\n        setOnboardingStatus(statusData);\n        setLoading(false);\n    }\n\n    async function toggleStep(stepId: string, currentStatus: boolean) {\n        setUpdating(true);\n        const stepMapping: Record<string, keyof Omit<TenantOnboarding, 'id' | 'tenant_id' | 'onboarding_status' | 'completion_percentage' | 'started_at' | 'completed_at'>> = {\n            'basic_info': 'basic_info_completed',\n            'admin_user': 'admin_user_created',\n            'features': 'features_configured',\n            'branding': 'branding_setup',\n            'integrations': 'integrations_configured',\n            'first_employee': 'first_employee_added',\n            'welcome_email': 'welcome_email_sent'\n        };\n\n        const dbField = stepMapping[stepId];\n        if (dbField) {\n            const success = await onboardingService.updateOnboardingStep(tenantId, dbField, !currentStatus);\n            if (success) {\n                await loadOnboardingData();\n            }\n        }\n        setUpdating(false);\n    }\n\n    async function handleCompleteOnboarding() {\n        setUpdating(true);\n        const success = await onboardingService.completeOnboarding(tenantId);\n        if (success) {\n            await loadOnboardingData();\n            onComplete?.();\n        }\n        setUpdating(false);\n    }\n\n    if (loading) {\n        return (\n            <div className=\"flex items-center justify-center p-8\">\n                <Loader2 className=\"w-8 h-8 animate-spin text-cyan-600\" />\n            </div>\n        );\n    }\n\n    const completedSteps = steps.filter(s => s.completed).length;\n    const totalSteps = steps.length;\n    const percentage = onboardingStatus?.completion_percentage || 0;\n    const allRequiredComplete = steps.filter(s => s.required).every(s => s.completed);\n\n    return (\n        <div className=\"bg-white rounded-lg shadow-lg\">\n            {/* Header */}\n            <div className=\"p-6 border-b border-gray-200\">\n                <div className=\"flex items-center justify-between mb-4\">\n                    <div>\n                        <h2 className=\"text-2xl font-bold text-gray-900\">Welcome to NovumFlow!</h2>\n                        <p className=\"text-sm text-gray-600 mt-1\">Let's get {tenantName} set up</p>\n                    </div>\n                    {onClose && (\n                        <button\n                            onClick={onClose}\n                            className=\"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100\"\n                        >\n                            <X className=\"w-5 h-5\" />\n                        </button>\n                    )}\n                </div>\n\n                {/* Progress Bar */}\n                <div className=\"space-y-2\">\n                    <div className=\"flex items-center justify-between text-sm\">\n                        <span className=\"font-medium text-gray-700\">\n                            {completedSteps} of {totalSteps} steps completed\n                        </span>\n                        <span className=\"font-bold text-cyan-600\">{percentage}%</span>\n                    </div>\n                    <div className=\"w-full bg-gray-200 rounded-full h-3 overflow-hidden\">\n                        <div\n                            className=\"bg-gradient-to-r from-cyan-500 to-cyan-600 h-full rounded-full transition-all duration-500 ease-out\"\n                            style={{ width: `${percentage}%` }}\n                        />\n                    </div>\n                </div>\n            </div>\n\n            {/* Steps List */}\n            <div className=\"p-6 space-y-3\">\n                {steps.map((step, index) => (\n                    <div\n                        key={step.id}\n                        className={`border rounded-lg p-4 transition-all ${step.completed\n                                ? 'border-cyan-200 bg-cyan-50'\n                                : 'border-gray-200 bg-white hover:border-cyan-300'\n                            }`}\n                    >\n                        <div className=\"flex items-start\">\n                            <button\n                                onClick={() => toggleStep(step.id, step.completed)}\n                                disabled={updating}\n                                className={`flex-shrink-0 w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all ${step.completed\n                                        ? 'bg-cyan-600 border-cyan-600'\n                                        : 'border-gray-300 hover:border-cyan-500'\n                                    } ${updating ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}`}\n                            >\n                                {step.completed && <Check className=\"w-4 h-4 text-white\" />}\n                            </button>\n\n                            <div className=\"ml-4 flex-1\">\n                                <div className=\"flex items-center\">\n                                    <h3 className={`text-sm font-medium ${step.completed ? 'text-gray-900' : 'text-gray-700'\n                                        }`}>\n                                        {step.title}\n                                        {step.required && (\n                                            <span className=\"ml-2 text-xs text-red-600 font-normal\">*Required</span>\n                                        )}\n                                    </h3>\n                                </div>\n                                <p className=\"text-xs text-gray-500 mt-1\">{step.description}</p>\n                            </div>\n\n                            {!step.completed && (\n                                <ChevronRight className=\"w-5 h-5 text-gray-400 flex-shrink-0\" />\n                            )}\n                        </div>\n                    </div>\n                ))}\n            </div>\n\n            {/* Footer */}\n            <div className=\"p-6 border-t border-gray-200 bg-gray-50\">\n                <div className=\"flex items-center justify-between\">\n                    <div className=\"text-sm text-gray-600\">\n                        {allRequiredComplete ? (\n                            <span className=\"text-green-600 font-medium\">â All required steps completed!</span>\n                        ) : (\n                            <span>Complete all required steps to finish onboarding</span>\n                        )}\n                    </div>\n                    <button\n                        onClick={handleCompleteOnboarding}\n                        disabled={!allRequiredComplete || updating || onboardingStatus?.onboarding_status === 'completed'}\n                        className=\"px-6 py-2 bg-cyan-600 text-white rounded-lg text-sm font-medium hover:bg-cyan-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n                    >\n                        {updating ? (\n                            <>\n                                <Loader2 className=\"w-4 h-4 mr-2 inline animate-spin\" />\n                                Completing...\n                            </>\n                        ) : onboardingStatus?.onboarding_status === 'completed' ? (\n                            'Onboarding Complete'\n                        ) : (\n                            'Complete Onboarding'\n                        )}\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/TenantSwitcher.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/TimeClock.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MapPin' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":68,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":74},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadAttendanceData'. Either include it or remove the dependency array.","line":54,"column":8,"nodeType":"ArrayExpression","endLine":54,"endColumn":29,"suggestions":[{"desc":"Update the dependencies array to be: [user, currentTenant, loadAttendanceData]","fix":{"range":[1937,1958],"text":"[user, currentTenant, loadAttendanceData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { Clock, Play, Square, Coffee, Calendar, TrendingUp, Users, MapPin } from 'lucide-react';\nimport { format, differenceInMinutes, startOfWeek, endOfWeek, eachDayOfInterval, isToday, parseISO } from 'date-fns';\nimport { log } from '@/lib/logger';\n\ninterface TimeEntry {\n    id: string;\n    employee_id: string;\n    tenant_id: string;\n    date?: string;\n    check_in_time: string;\n    check_out_time?: string;\n    break_duration_minutes: number;\n    notes?: string;\n    location?: string;\n    status: 'active' | 'present' | 'late' | 'excused' | 'absent';\n    created_at?: string;\n    updated_at?: string;\n}\n\ninterface AttendanceStats {\n    totalHoursToday: number;\n    totalHoursWeek: number;\n    avgStartTime: string;\n    lateArrivals: number;\n}\n\nexport default function TimeClock() {\n    const { user } = useAuth();\n    const { currentTenant } = useTenant();\n    const [currentEntry, setCurrentEntry] = useState<TimeEntry | null>(null);\n    const [recentEntries, setRecentEntries] = useState<TimeEntry[]>([]);\n    const [stats, setStats] = useState<AttendanceStats | null>(null);\n    const [loading, setLoading] = useState(true);\n    const [clockingIn, setClockingIn] = useState(false);\n    const [onBreak, setOnBreak] = useState(false);\n    const [breakStart, setBreakStart] = useState<Date | null>(null);\n    const [currentTime, setCurrentTime] = useState(new Date());\n    const [location, setLocation] = useState<string>('');\n\n    // Update current time every second\n    useEffect(() => {\n        const timer = setInterval(() => setCurrentTime(new Date()), 1000);\n        return () => clearInterval(timer);\n    }, []);\n\n    useEffect(() => {\n        if (user && currentTenant) {\n            loadAttendanceData();\n        }\n    }, [user, currentTenant]);\n\n    async function loadAttendanceData() {\n        setLoading(true);\n        try {\n            // Try to get current active entry\n            const { data: activeEntry } = await supabase\n                .from('attendance_records')\n                .select('*')\n                .eq('employee_id', user?.id)\n                .eq('tenant_id', currentTenant?.id)\n                .eq('status', 'active')\n                .order('created_at', { ascending: false })\n                .limit(1)\n                .maybeSingle();\n\n            if (activeEntry) {\n                setCurrentEntry(activeEntry);\n            }\n\n            // Get recent entries\n            const weekStart = startOfWeek(new Date(), { weekStartsOn: 1 });\n            const { data: entries } = await supabase\n                .from('attendance_records')\n                .select('*')\n                .eq('employee_id', user?.id)\n                .eq('tenant_id', currentTenant?.id)\n                .gte('check_in_time', weekStart.toISOString())\n                .order('check_in_time', { ascending: false });\n\n            setRecentEntries(entries || []);\n            calculateStats(entries || []);\n        } catch (error) {\n            log.error('Error loading attendance', error, { component: 'TimeClock', action: 'loadAttendanceData' });\n            // Generate mock data for demo\n            generateMockData();\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    function generateMockData() {\n        const mockEntries: TimeEntry[] = [];\n        const today = new Date();\n\n        for (let i = 0; i < 5; i++) {\n            const day = new Date(today);\n            day.setDate(day.getDate() - i);\n            if (day.getDay() !== 0 && day.getDay() !== 6) { // Skip weekends\n                mockEntries.push({\n                    id: `mock-${i}`,\n                    employee_id: user?.id || '',\n                    tenant_id: currentTenant?.id || '',\n                    check_in_time: new Date(day.setHours(9, Math.floor(Math.random() * 15), 0)).toISOString(),\n                    check_out_time: i === 0 ? undefined : new Date(day.setHours(17, 30, 0)).toISOString(),\n                    break_duration_minutes: 30,\n                    status: i === 0 ? 'active' : 'present',\n                    location: 'Office'\n                });\n            }\n        }\n\n        if (mockEntries[0]?.status === 'active') {\n            setCurrentEntry(mockEntries[0]);\n        }\n\n        setRecentEntries(mockEntries);\n        calculateStats(mockEntries);\n    }\n\n    function calculateStats(entries: TimeEntry[]) {\n        const today = new Date();\n        const todayEntries = entries.filter(e =>\n            format(parseISO(e.check_in_time), 'yyyy-MM-dd') === format(today, 'yyyy-MM-dd')\n        );\n\n        let totalMinutesToday = 0;\n        todayEntries.forEach(entry => {\n            const clockIn = parseISO(entry.check_in_time);\n            const clockOut = entry.check_out_time ? parseISO(entry.check_out_time) : new Date();\n            totalMinutesToday += differenceInMinutes(clockOut, clockIn) - entry.break_duration_minutes;\n        });\n\n        let totalMinutesWeek = 0;\n        entries.forEach(entry => {\n            if (entry.check_out_time) {\n                const clockIn = parseISO(entry.check_in_time);\n                const clockOut = parseISO(entry.check_out_time);\n                totalMinutesWeek += differenceInMinutes(clockOut, clockIn) - entry.break_duration_minutes;\n            }\n        });\n\n        const clockInTimes = entries.filter(e => e.check_in_time).map(e => {\n            const d = parseISO(e.check_in_time);\n            return d.getHours() * 60 + d.getMinutes();\n        });\n        const avgMinutes = clockInTimes.length > 0\n            ? Math.round(clockInTimes.reduce((a, b) => a + b, 0) / clockInTimes.length)\n            : 9 * 60;\n\n        const lateArrivals = clockInTimes.filter(m => m > 9 * 60 + 15).length;\n\n        setStats({\n            totalHoursToday: Math.round(totalMinutesToday / 60 * 10) / 10,\n            totalHoursWeek: Math.round(totalMinutesWeek / 60 * 10) / 10,\n            avgStartTime: `${Math.floor(avgMinutes / 60).toString().padStart(2, '0')}:${(avgMinutes % 60).toString().padStart(2, '0')}`,\n            lateArrivals\n        });\n    }\n\n    async function handleClockIn() {\n        setClockingIn(true);\n        try {\n            // Get location if available\n            if (navigator.geolocation) {\n                navigator.geolocation.getCurrentPosition(\n                    (pos) => setLocation(`${pos.coords.latitude.toFixed(4)}, ${pos.coords.longitude.toFixed(4)}`),\n                    () => setLocation('Unknown')\n                );\n            }\n\n            const newEntry: Partial<TimeEntry> = {\n                employee_id: user?.id,\n                tenant_id: currentTenant?.id,\n                date: new Date().toISOString().split('T')[0],\n                check_in_time: new Date().toISOString(),\n                break_duration_minutes: 0,\n                status: 'active',\n                location: location || 'Office'\n            };\n\n            const { data, error } = await supabase\n                .from('attendance_records')\n                .insert(newEntry)\n                .select()\n                .single();\n\n            if (error) throw error;\n\n            setCurrentEntry(data);\n            setRecentEntries(prev => [data, ...prev]);\n        } catch (error) {\n            log.error('Clock in error', error, { component: 'TimeClock', action: 'handleClockIn' });\n            // Create mock entry for demo\n            const mockEntry: TimeEntry = {\n                id: `mock-${Date.now()}`,\n                employee_id: user?.id || '',\n                tenant_id: currentTenant?.id || '',\n                check_in_time: new Date().toISOString(),\n                break_duration_minutes: 0,\n                status: 'active',\n                location: 'Office',\n                created_at: new Date().toISOString(),\n                updated_at: new Date().toISOString()\n            };\n            setCurrentEntry(mockEntry);\n            setRecentEntries(prev => [mockEntry, ...prev]);\n        } finally {\n            setClockingIn(false);\n        }\n    }\n\n    async function handleClockOut() {\n        if (!currentEntry) return;\n        setClockingIn(true);\n\n        try {\n            const { error } = await supabase\n                .from('attendance_records')\n                .update({\n                    check_out_time: new Date().toISOString(),\n                    status: 'present',\n                    break_duration_minutes: currentEntry.break_duration_minutes\n                })\n                .eq('id', currentEntry.id);\n\n            if (error) throw error;\n\n            setCurrentEntry(null);\n            loadAttendanceData();\n        } catch (error) {\n            log.error('Clock out error', error, { component: 'TimeClock', action: 'handleClockOut' });\n            // Update mock entry\n            setRecentEntries(prev => prev.map(e =>\n                e.id === currentEntry.id\n                    ? { ...e, check_out_time: new Date().toISOString(), status: 'present' as const }\n                    : e\n            ));\n            setCurrentEntry(null);\n        } finally {\n            setClockingIn(false);\n        }\n    }\n\n    function handleBreakToggle() {\n        if (onBreak) {\n            // End break\n            if (breakStart && currentEntry) {\n                const breakMinutes = differenceInMinutes(new Date(), breakStart);\n                setCurrentEntry({\n                    ...currentEntry,\n                    break_duration_minutes: currentEntry.break_duration_minutes + breakMinutes\n                });\n            }\n            setOnBreak(false);\n            setBreakStart(null);\n        } else {\n            // Start break\n            setOnBreak(true);\n            setBreakStart(new Date());\n        }\n    }\n\n    function getElapsedTime(): string {\n        if (!currentEntry) return '00:00:00';\n        const clockIn = parseISO(currentEntry.check_in_time);\n        const elapsed = differenceInMinutes(currentTime, clockIn);\n        const hours = Math.floor(elapsed / 60);\n        const minutes = elapsed % 60;\n        const seconds = currentTime.getSeconds();\n        return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n    }\n\n    const weekDays = eachDayOfInterval({\n        start: startOfWeek(new Date(), { weekStartsOn: 1 }),\n        end: endOfWeek(new Date(), { weekStartsOn: 1 })\n    });\n\n    if (loading) {\n        return (\n            <div className=\"bg-white rounded-xl border border-gray-200 p-6\">\n                <div className=\"animate-pulse space-y-4\">\n                    <div className=\"h-8 bg-gray-200 rounded w-1/3\" />\n                    <div className=\"h-32 bg-gray-200 rounded\" />\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            {/* Time Clock Card */}\n            <div className=\"bg-gradient-to-br from-indigo-600 to-purple-700 rounded-2xl p-6 text-white\">\n                <div className=\"flex items-center justify-between mb-6\">\n                    <div>\n                        <h2 className=\"text-xl font-semibold\">Time Clock</h2>\n                        <p className=\"text-indigo-200 text-sm\">\n                            {format(currentTime, 'EEEE, MMMM d, yyyy')}\n                        </p>\n                    </div>\n                    <div className=\"text-right\">\n                        <p className=\"text-3xl font-mono font-bold\">\n                            {format(currentTime, 'HH:mm:ss')}\n                        </p>\n                    </div>\n                </div>\n\n                {currentEntry ? (\n                    <div className=\"space-y-4\">\n                        <div className=\"bg-white/10 rounded-xl p-4\">\n                            <div className=\"flex items-center justify-between\">\n                                <div>\n                                    <p className=\"text-sm text-indigo-200\">Clocked in at</p>\n                                    <p className=\"text-lg font-semibold\">\n                                        {format(parseISO(currentEntry.check_in_time), 'HH:mm')}\n                                    </p>\n                                </div>\n                                <div className=\"text-right\">\n                                    <p className=\"text-sm text-indigo-200\">Elapsed time</p>\n                                    <p className=\"text-2xl font-mono font-bold\">\n                                        {getElapsedTime()}\n                                    </p>\n                                </div>\n                            </div>\n                            {currentEntry.break_duration_minutes > 0 && (\n                                <p className=\"text-xs text-indigo-200 mt-2\">\n                                    Break time: {currentEntry.break_duration_minutes} minutes\n                                </p>\n                            )}\n                        </div>\n\n                        <div className=\"flex gap-3\">\n                            <button\n                                onClick={handleBreakToggle}\n                                className={`flex-1 flex items-center justify-center gap-2 py-3 rounded-xl font-medium transition ${onBreak\n                                    ? 'bg-yellow-500 text-yellow-900 hover:bg-yellow-400'\n                                    : 'bg-white/20 hover:bg-white/30'\n                                    }`}\n                            >\n                                <Coffee className=\"w-5 h-5\" />\n                                {onBreak ? 'End Break' : 'Take Break'}\n                            </button>\n                            <button\n                                onClick={handleClockOut}\n                                disabled={clockingIn}\n                                className=\"flex-1 flex items-center justify-center gap-2 py-3 bg-red-500 hover:bg-red-600 rounded-xl font-medium transition disabled:opacity-50\"\n                            >\n                                <Square className=\"w-5 h-5\" />\n                                Clock Out\n                            </button>\n                        </div>\n                    </div>\n                ) : (\n                    <button\n                        onClick={handleClockIn}\n                        disabled={clockingIn}\n                        className=\"w-full flex items-center justify-center gap-3 py-4 bg-white text-indigo-600 rounded-xl font-semibold text-lg hover:bg-indigo-50 transition disabled:opacity-50\"\n                    >\n                        {clockingIn ? (\n                            <div className=\"animate-spin h-6 w-6 border-2 border-indigo-600 border-t-transparent rounded-full\" />\n                        ) : (\n                            <>\n                                <Play className=\"w-6 h-6\" />\n                                Clock In\n                            </>\n                        )}\n                    </button>\n                )}\n            </div>\n\n            {/* Stats Cards */}\n            {stats && (\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                    <div className=\"bg-white rounded-xl border border-gray-200 p-4\">\n                        <div className=\"flex items-center space-x-3\">\n                            <div className=\"p-2 bg-blue-100 rounded-lg\">\n                                <Clock className=\"w-5 h-5 text-blue-600\" />\n                            </div>\n                            <div>\n                                <p className=\"text-sm text-gray-600\">Today</p>\n                                <p className=\"text-xl font-bold text-gray-900\">{stats.totalHoursToday}h</p>\n                            </div>\n                        </div>\n                    </div>\n                    <div className=\"bg-white rounded-xl border border-gray-200 p-4\">\n                        <div className=\"flex items-center space-x-3\">\n                            <div className=\"p-2 bg-green-100 rounded-lg\">\n                                <TrendingUp className=\"w-5 h-5 text-green-600\" />\n                            </div>\n                            <div>\n                                <p className=\"text-sm text-gray-600\">This Week</p>\n                                <p className=\"text-xl font-bold text-gray-900\">{stats.totalHoursWeek}h</p>\n                            </div>\n                        </div>\n                    </div>\n                    <div className=\"bg-white rounded-xl border border-gray-200 p-4\">\n                        <div className=\"flex items-center space-x-3\">\n                            <div className=\"p-2 bg-purple-100 rounded-lg\">\n                                <Calendar className=\"w-5 h-5 text-purple-600\" />\n                            </div>\n                            <div>\n                                <p className=\"text-sm text-gray-600\">Avg Start</p>\n                                <p className=\"text-xl font-bold text-gray-900\">{stats.avgStartTime}</p>\n                            </div>\n                        </div>\n                    </div>\n                    <div className=\"bg-white rounded-xl border border-gray-200 p-4\">\n                        <div className=\"flex items-center space-x-3\">\n                            <div className=\"p-2 bg-orange-100 rounded-lg\">\n                                <Users className=\"w-5 h-5 text-orange-600\" />\n                            </div>\n                            <div>\n                                <p className=\"text-sm text-gray-600\">Late Arrivals</p>\n                                <p className=\"text-xl font-bold text-gray-900\">{stats.lateArrivals}</p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* Week Overview */}\n            <div className=\"bg-white rounded-xl border border-gray-200 p-6\">\n                <h3 className=\"font-semibold text-gray-900 mb-4\">This Week</h3>\n                <div className=\"grid grid-cols-7 gap-2\">\n                    {weekDays.map((day, index) => {\n                        const dayEntry = recentEntries.find(e =>\n                            format(parseISO(e.check_in_time), 'yyyy-MM-dd') === format(day, 'yyyy-MM-dd')\n                        );\n                        const isCurrentDay = isToday(day);\n\n                        return (\n                            <div key={index} className=\"text-center\">\n                                <p className=\"text-xs text-gray-500 mb-1\">\n                                    {format(day, 'EEE')}\n                                </p>\n                                <div className={`relative p-3 rounded-lg ${isCurrentDay\n                                    ? 'bg-indigo-100 ring-2 ring-indigo-500'\n                                    : dayEntry\n                                        ? 'bg-green-50'\n                                        : 'bg-gray-50'\n                                    }`}>\n                                    <p className={`text-sm font-medium ${isCurrentDay ? 'text-indigo-700' : 'text-gray-700'\n                                        }`}>\n                                        {format(day, 'd')}\n                                    </p>\n                                    {dayEntry && (\n                                        <p className=\"text-xs text-gray-500 mt-1\">\n                                            {dayEntry.check_out_time\n                                                ? `${format(parseISO(dayEntry.check_in_time), 'HH:mm')}-${format(parseISO(dayEntry.check_out_time), 'HH:mm')}`\n                                                : format(parseISO(dayEntry.check_in_time), 'HH:mm')\n                                            }\n                                        </p>\n                                    )}\n                                </div>\n                            </div>\n                        );\n                    })}\n                </div>\n            </div>\n\n            {/* Recent Entries */}\n            <div className=\"bg-white rounded-xl border border-gray-200 overflow-hidden\">\n                <div className=\"px-6 py-4 border-b border-gray-200\">\n                    <h3 className=\"font-semibold text-gray-900\">Recent Time Entries</h3>\n                </div>\n                <div className=\"divide-y divide-gray-100\">\n                    {recentEntries.slice(0, 5).map(entry => (\n                        <div key={entry.id} className=\"px-6 py-4 flex items-center justify-between\">\n                            <div>\n                                <p className=\"text-sm font-medium text-gray-900\">\n                                    {format(parseISO(entry.check_in_time), 'EEEE, MMM d')}\n                                </p>\n                                <p className=\"text-xs text-gray-500\">\n                                    {format(parseISO(entry.check_in_time), 'HH:mm')}\n                                    {entry.check_out_time && ` - ${format(parseISO(entry.check_out_time), 'HH:mm')}`}\n                                    {entry.break_duration_minutes > 0 && ` (${entry.break_duration_minutes}m break)`}\n                                </p>\n                            </div>\n                            <div className=\"text-right\">\n                                {entry.check_out_time ? (\n                                    <>\n                                        <p className=\"text-sm font-semibold text-gray-900\">\n                                            {Math.round((differenceInMinutes(parseISO(entry.check_out_time), parseISO(entry.check_in_time)) - entry.break_duration_minutes) / 60 * 10) / 10}h\n                                        </p>\n                                        <span className=\"text-xs text-green-600 bg-green-100 px-2 py-0.5 rounded\">\n                                            Completed\n                                        </span>\n                                    </>\n                                ) : (\n                                    <span className=\"text-xs text-blue-600 bg-blue-100 px-2 py-0.5 rounded animate-pulse\">\n                                        Active\n                                    </span>\n                                )}\n                            </div>\n                        </div>\n                    ))}\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/Toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/TrainingMatrix.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadMatrixData'. Either include it or remove the dependency array.","line":39,"column":8,"nodeType":"ArrayExpression","endLine":39,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [currentTenant, loadMatrixData]","fix":{"range":[1338,1353],"text":"[currentTenant, loadMatrixData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { complianceService, TrainingRecord } from '@/lib/services/ComplianceService';\nimport { log } from '@/lib/logger';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { CheckCircle, AlertTriangle, XCircle, Plus, ChevronRight, ChevronDown } from 'lucide-react';\nimport TrainingRecordForm from './TrainingRecordForm';\n\ninterface StaffTrainingSummary {\n    user_id: string;\n    staff_name: string;\n    training: Record<string, TrainingRecord | null>;\n}\n\nexport default function TrainingMatrix() {\n    const { currentTenant } = useTenant();\n    const [loading, setLoading] = useState(true);\n    const [matrixData, setMatrixData] = useState<StaffTrainingSummary[]>([]);\n    const [expandedUser, setExpandedUser] = useState<string | null>(null);\n    const [showAddModal, setShowAddModal] = useState(false);\n\n    const [editingRecord, setEditingRecord] = useState<TrainingRecord | null>(null);\n\n    const mandatoryTrainingTypes = [\n        'health_safety',\n        'fire_safety',\n        'safeguarding',\n        'infection_control',\n        'manual_handling',\n        'medication',\n        'mental_capacity_dols',\n        'first_aid',\n        'food_hygiene',\n        'equality_diversity',\n        'record_keeping'\n    ];\n\n    useEffect(() => {\n        loadMatrixData();\n    }, [currentTenant]);\n\n    const loadMatrixData = async () => {\n        if (!currentTenant) return;\n\n        setLoading(true);\n        try {\n            // In a real app, we'd have a dedicated API for this matrix to avoid N+1 queries\n            // For now, we'll fetch the compliance report which contains the data we need\n            const { training_matrix } = await complianceService.generateCQCReport(currentTenant.id);\n\n            // Group by user\n            const grouped: Record<string, StaffTrainingSummary> = {};\n\n            training_matrix.forEach((record: TrainingRecord) => {\n                // Use user_id if available, otherwise fallback to staff_name as a unique key for manual entries\n                // This prevents duplicates where some records have user_id and others don't for the same person\n                // ideally we should always have user_id, but for manual entries we might not\n                const userId = record.user_id || `manual_${record.staff_name.toLowerCase().replace(/\\s+/g, '_')}`;\n\n                if (!grouped[userId]) {\n                    grouped[userId] = {\n                        user_id: userId,\n                        staff_name: record.staff_name,\n                        training: {}\n                    };\n                }\n\n                // Store the most recent record for this type\n                const existing = grouped[userId].training[record.training_name]; // Using training_name as key for now, ideally training_type\n                if (!existing || new Date(record.completion_date) > new Date(existing.completion_date)) {\n                    // Map training_type if available, otherwise use name\n                    const key = record.training_type || record.training_name;\n                    grouped[userId].training[key] = record;\n                }\n            });\n\n            setMatrixData(Object.values(grouped));\n        } catch (error) {\n            log.error('Error loading training matrix', error, { component: 'TrainingMatrix', action: 'loadMatrixData' });\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleDelete = async (id: string) => {\n        if (confirm('Are you sure you want to delete this training record?')) {\n            await complianceService.deleteTrainingRecord(id);\n            loadMatrixData();\n        }\n    };\n\n    const getStatusIcon = (record: TrainingRecord | null) => {\n        if (!record) return <XCircle className=\"w-5 h-5 text-red-300\" />;\n\n        const expiry = record.expiry_date ? new Date(record.expiry_date) : null;\n        const now = new Date();\n\n        if (expiry && expiry < now) {\n            return <XCircle className=\"w-5 h-5 text-red-500\" />;\n        }\n\n        if (expiry && expiry < new Date(now.getTime() + 90 * 24 * 60 * 60 * 1000)) { // 3 months\n            return <AlertTriangle className=\"w-5 h-5 text-yellow-500\" />;\n        }\n\n        return <CheckCircle className=\"w-5 h-5 text-green-500\" />;\n    };\n\n    const getTrainingLabel = (type: string) => {\n        return type.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');\n    };\n\n    if (loading) {\n        return (\n            <div className=\"flex items-center justify-center h-64\">\n                <div className=\"text-gray-500\">Loading training matrix...</div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"bg-white rounded-lg shadow overflow-hidden\">\n            <div className=\"p-6 border-b border-gray-200 flex justify-between items-center\">\n                <div>\n                    <h2 className=\"text-lg font-semibold text-gray-900\">Training Matrix</h2>\n                    <p className=\"text-sm text-gray-600 mt-1\">Overview of mandatory training status across all staff</p>\n                </div>\n                <button\n                    onClick={() => {\n                        setEditingRecord(null);\n                        setShowAddModal(true);\n                    }}\n                    className=\"flex items-center gap-2 px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700\"\n                >\n                    <Plus className=\"w-4 h-4\" />\n                    Add Training\n                </button>\n            </div>\n\n            <div className=\"overflow-x-auto\">\n                <table className=\"w-full\">\n                    <thead className=\"bg-gray-50\">\n                        <tr>\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase sticky left-0 bg-gray-50 z-10\">\n                                Staff Member\n                            </th>\n                            {mandatoryTrainingTypes.map(type => (\n                                <th key={type} className=\"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase min-w-[100px]\">\n                                    {getTrainingLabel(type)}\n                                </th>\n                            ))}\n                        </tr>\n                    </thead>\n                    <tbody className=\"divide-y divide-gray-200\">\n                        {matrixData.map(staff => (\n                            [\n                                <tr key={`row-${staff.user_id}`} className=\"hover:bg-gray-50\">\n                                    <td className=\"px-6 py-4 whitespace-nowrap sticky left-0 bg-white z-10 border-r border-gray-100\">\n                                        <button\n                                            onClick={() => setExpandedUser(expandedUser === staff.user_id ? null : staff.user_id)}\n                                            className=\"flex items-center gap-2 font-medium text-gray-900 hover:text-cyan-600\"\n                                        >\n                                            {expandedUser === staff.user_id ? <ChevronDown className=\"w-4 h-4\" /> : <ChevronRight className=\"w-4 h-4\" />}\n                                            {staff.staff_name}\n                                        </button>\n                                    </td>\n                                    {mandatoryTrainingTypes.map(type => (\n                                        <td key={type} className=\"px-4 py-4 text-center whitespace-nowrap\">\n                                            <div className=\"flex justify-center\" title={staff.training[type]?.expiry_date ? `Expires: ${staff.training[type]?.expiry_date}` : 'Missing'}>\n                                                {getStatusIcon(staff.training[type])}\n                                            </div>\n                                        </td>\n                                    ))}\n                                </tr>,\n                                expandedUser === staff.user_id && (\n                                    <tr key={`details-${staff.user_id}`} className=\"bg-gray-50\">\n                                        <td colSpan={mandatoryTrainingTypes.length + 1} className=\"px-6 py-4\">\n                                            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                                                {Object.values(staff.training).map((record) => (\n                                                    record && (\n                                                        <div key={record.id} className=\"bg-white p-3 rounded border border-gray-200 text-sm relative group\">\n                                                            <div className=\"font-medium text-gray-900\">{record.training_name}</div>\n                                                            <div className=\"text-gray-500 mt-1\">Completed: {record.completion_date}</div>\n                                                            <div className={`mt-1 ${!record.expiry_date ? 'text-gray-500' :\n                                                                new Date(record.expiry_date) < new Date() ? 'text-red-600 font-medium' :\n                                                                    'text-gray-500'\n                                                                }`}>\n                                                                Expires: {record.expiry_date || 'N/A'}\n                                                            </div>\n\n                                                            <div className=\"absolute top-2 right-2 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity\">\n                                                                <button\n                                                                    onClick={() => {\n                                                                        setEditingRecord(record);\n                                                                        setShowAddModal(true);\n                                                                    }}\n                                                                    className=\"text-blue-600 hover:text-blue-800 text-xs font-medium\"\n                                                                >\n                                                                    Edit\n                                                                </button>\n                                                                <button\n                                                                    onClick={() => handleDelete(record.id)}\n                                                                    className=\"text-red-600 hover:text-red-800 text-xs font-medium\"\n                                                                >\n                                                                    Delete\n                                                                </button>\n                                                            </div>\n                                                        </div>\n                                                    )\n                                                ))}\n                                            </div>\n                                        </td>\n                                    </tr>\n                                )\n                            ]\n                        ))}\n                    </tbody>\n                </table>\n            </div>\n\n            <div className=\"p-4 border-t border-gray-200 bg-gray-50 flex gap-6 text-sm text-gray-600\">\n                <div className=\"flex items-center gap-2\">\n                    <CheckCircle className=\"w-4 h-4 text-green-500\" />\n                    <span>Valid</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                    <AlertTriangle className=\"w-4 h-4 text-yellow-500\" />\n                    <span>Expiring Soon (3 months)</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                    <XCircle className=\"w-4 h-4 text-red-500\" />\n                    <span>Expired</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                    <XCircle className=\"w-4 h-4 text-red-300\" />\n                    <span>Missing</span>\n                </div>\n            </div>\n\n            {\n                showAddModal && (\n                    <TrainingRecordForm\n                        initialData={editingRecord || undefined}\n                        onSuccess={() => {\n                            setShowAddModal(false);\n                            setEditingRecord(null);\n                            loadMatrixData();\n                        }}\n                        onCancel={() => {\n                            setShowAddModal(false);\n                            setEditingRecord(null);\n                        }}\n                    />\n                )\n            }\n        </div >\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/TrainingRecordForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Upload' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'supabase' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":20,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'watch' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":24,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setValue' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":24,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":52}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { complianceService, TrainingRecord } from '@/lib/services/ComplianceService';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { X, Upload, Save, AlertCircle } from 'lucide-react';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\n\ninterface TrainingRecordFormProps {\n    userId?: string;\n    staffName?: string;\n    initialData?: TrainingRecord;\n    onSuccess: () => void;\n    onCancel: () => void;\n}\n\nexport default function TrainingRecordForm({ userId, staffName, initialData, onSuccess, onCancel }: TrainingRecordFormProps) {\n    const { currentTenant } = useTenant();\n    const { user } = useAuth();\n    const [isSubmitting, setIsSubmitting] = useState(false);\n    const [error, setError] = useState<string | null>(null);\n\n    const { register, handleSubmit, watch, setValue, formState: { errors } } = useForm<Partial<TrainingRecord>>({\n        defaultValues: initialData ? {\n            ...initialData,\n            completion_date: initialData.completion_date ? initialData.completion_date.split('T')[0] : '',\n            expiry_date: initialData.expiry_date ? initialData.expiry_date.split('T')[0] : '',\n        } : {\n            user_id: userId || '',\n            staff_name: staffName || '',\n            training_category: 'mandatory',\n            is_mandatory: true,\n            assessment_passed: true\n        }\n    });\n\n    const trainingTypes = [\n        { value: 'health_safety', label: 'Health & Safety' },\n        { value: 'fire_safety', label: 'Fire Safety' },\n        { value: 'safeguarding', label: 'Safeguarding' },\n        { value: 'infection_control', label: 'Infection Control' },\n        { value: 'manual_handling', label: 'Manual Handling' },\n        { value: 'medication', label: 'Medication Administration' },\n        { value: 'mental_capacity_dols', label: 'Mental Capacity & DoLS' },\n        { value: 'first_aid', label: 'First Aid' },\n        { value: 'food_hygiene', label: 'Food Hygiene' },\n        { value: 'equality_diversity', label: 'Equality & Diversity' },\n        { value: 'record_keeping', label: 'Record Keeping' },\n        { value: 'care_certificate', label: 'Care Certificate' },\n        { value: 'dementia_care', label: 'Dementia Care' },\n        { value: 'end_of_life', label: 'End of Life Care' },\n        { value: 'other', label: 'Other' }\n    ];\n\n    const onSubmit = async (data: Partial<TrainingRecord>) => {\n        if (!currentTenant) return;\n\n        setIsSubmitting(true);\n        setError(null);\n\n        try {\n            const trainingData = {\n                ...data,\n                tenant_id: currentTenant.id,\n                user_id: userId || initialData?.user_id || null,\n                training_name: trainingTypes.find(t => t.value === data.training_type)?.label || 'Other Training',\n            };\n\n            let result;\n            if (initialData?.id) {\n                result = await complianceService.updateTrainingRecord(initialData.id, trainingData);\n            } else {\n                result = await complianceService.addTrainingRecord(trainingData);\n            }\n\n            if (result) {\n                onSuccess();\n            } else {\n                setError('Failed to save training record. Please try again.');\n            }\n        } catch (err) {\n            log.error('Error saving training record', err, { component: 'TrainingRecordForm', action: 'onSubmit' });\n            setError('An unexpected error occurred.');\n        } finally {\n            setIsSubmitting(false);\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n            <div className=\"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n                <div className=\"p-6 border-b border-gray-200 flex justify-between items-center\">\n                    <h2 className=\"text-xl font-semibold text-gray-900\">Add Training Record</h2>\n                    <button onClick={onCancel} className=\"text-gray-400 hover:text-gray-600\">\n                        <X className=\"w-6 h-6\" />\n                    </button>\n                </div>\n\n                <form onSubmit={handleSubmit(onSubmit)} className=\"p-6 space-y-6\">\n                    {error && (\n                        <div className=\"bg-red-50 border border-red-200 text-red-700 p-4 rounded-lg flex items-center gap-2\">\n                            <AlertCircle className=\"w-5 h-5\" />\n                            {error}\n                        </div>\n                    )}\n\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                        {/* Staff Details */}\n                        <div className=\"col-span-2\">\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                Staff Name *\n                            </label>\n                            <input\n                                {...register('staff_name', { required: 'Staff name is required' })}\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500\"\n                                placeholder=\"Full Name\"\n                            />\n                            {errors.staff_name && (\n                                <p className=\"text-red-500 text-xs mt-1\">{errors.staff_name.message}</p>\n                            )}\n                        </div>\n\n                        {/* Training Details */}\n                        <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                Training Type *\n                            </label>\n                            <select\n                                {...register('training_type', { required: 'Training type is required' })}\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500\"\n                            >\n                                <option value=\"\">Select Type...</option>\n                                {trainingTypes.map(type => (\n                                    <option key={type.value} value={type.value}>{type.label}</option>\n                                ))}\n                            </select>\n                            {errors.training_type && (\n                                <p className=\"text-red-500 text-xs mt-1\">{errors.training_type.message}</p>\n                            )}\n                        </div>\n\n                        <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                Category\n                            </label>\n                            <select\n                                {...register('training_category')}\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500\"\n                            >\n                                <option value=\"mandatory\">Mandatory</option>\n                                <option value=\"role_specific\">Role Specific</option>\n                                <option value=\"cpd\">CPD</option>\n                                <option value=\"induction\">Induction</option>\n                            </select>\n                        </div>\n\n                        {/* Dates */}\n                        <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                Completion Date *\n                            </label>\n                            <input\n                                type=\"date\"\n                                {...register('completion_date', { required: 'Completion date is required' })}\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500\"\n                            />\n                            {errors.completion_date && (\n                                <p className=\"text-red-500 text-xs mt-1\">{errors.completion_date.message}</p>\n                            )}\n                        </div>\n\n                        <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                Expiry Date\n                            </label>\n                            <input\n                                type=\"date\"\n                                {...register('expiry_date')}\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500\"\n                            />\n                        </div>\n\n                        <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                Training Provider\n                            </label>\n                            <input\n                                {...register('training_provider')}\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500\"\n                                placeholder=\"e.g. External Provider, Internal\"\n                            />\n                        </div>\n\n                        <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                Certificate Number\n                            </label>\n                            <input\n                                {...register('certificate_number')}\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500\"\n                            />\n                        </div>\n\n                        {/* File Upload */}\n                        <div className=\"col-span-2\">\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                Upload Certificate\n                            </label>\n                            <input\n                                type=\"file\"\n                                accept=\".pdf,.jpg,.jpeg,.png\"\n                                className=\"block w-full text-sm text-gray-500\n                                    file:mr-4 file:py-2 file:px-4\n                                    file:rounded-full file:border-0\n                                    file:text-sm file:font-semibold\n                                    file:bg-cyan-50 file:text-cyan-700\n                                    hover:file:bg-cyan-100\"\n                            />\n                            <p className=\"text-xs text-gray-500 mt-1\">PDF, JPG, PNG up to 5MB</p>\n                        </div>\n\n                        {/* Notes */}\n                        <div className=\"col-span-2\">\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                Notes\n                            </label>\n                            <textarea\n                                {...register('notes')}\n                                rows={3}\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500\"\n                                placeholder=\"Any additional details...\"\n                            />\n                        </div>\n                    </div>\n\n                    <div className=\"flex justify-end gap-3 pt-4 border-t border-gray-200\">\n                        <button\n                            type=\"button\"\n                            onClick={onCancel}\n                            className=\"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg\"\n                        >\n                            Cancel\n                        </button>\n                        <button\n                            type=\"submit\"\n                            disabled={isSubmitting}\n                            className=\"flex items-center gap-2 px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 disabled:opacity-50\"\n                        >\n                            <Save className=\"w-4 h-4\" />\n                            {isSubmitting ? 'Saving...' : 'Save Record'}\n                        </button>\n                    </div>\n                </form>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/TrainingTracker.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronRight' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Filter' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":56,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":62},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'differenceInDays' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'viewMode' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":40,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setViewMode' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":40,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":33},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadTrainingRecords'. Either include it or remove the dependency array.","line":44,"column":8,"nodeType":"ArrayExpression","endLine":44,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [currentTenant, loadTrainingRecords]","fix":{"range":[1408,1423],"text":"[currentTenant, loadTrainingRecords]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport { useTenant } from '@/contexts/TenantContext';\nimport {\n    GraduationCap, CheckCircle, Clock, AlertTriangle, Award,\n    Calendar, ChevronRight, Play, Download, RefreshCw, Filter\n} from 'lucide-react';\nimport { format, parseISO, differenceInDays, isBefore, addDays } from 'date-fns';\n\ninterface TrainingCourse {\n    id: string;\n    title: string;\n    category: string;\n    duration_minutes: number;\n    description?: string;\n    is_mandatory: boolean;\n    thumbnail?: string;\n}\n\ninterface TrainingRecord {\n    id: string;\n    employee_id: string;\n    employee_name: string;\n    course: TrainingCourse;\n    status: 'not_started' | 'in_progress' | 'completed' | 'expired';\n    progress: number;\n    started_at?: string;\n    completed_at?: string;\n    expires_at?: string;\n    score?: number;\n    certificate_url?: string;\n}\n\nexport default function TrainingTracker() {\n    const { currentTenant } = useTenant();\n    const [records, setRecords] = useState<TrainingRecord[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [filter, setFilter] = useState<'all' | 'in_progress' | 'completed' | 'expired' | 'mandatory'>('all');\n    const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid');\n\n    useEffect(() => {\n        loadTrainingRecords();\n    }, [currentTenant]);\n\n    async function loadTrainingRecords() {\n        setLoading(true);\n        try {\n            const { data, error } = await supabase\n                .from('training_records')\n                .select('*, courses(*)')\n                .eq('tenant_id', currentTenant?.id)\n                .order('created_at', { ascending: false });\n\n            if (error) throw error;\n            setRecords(data || []);\n        } catch (error) {\n            log.error('Error loading training records', error, { component: 'TrainingTracker', action: 'loadTrainingRecords' });\n            setRecords(generateMockRecords());\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    function generateMockRecords(): TrainingRecord[] {\n        const courses: TrainingCourse[] = [\n            { id: 'c1', title: 'Fire Safety Training', category: 'Health & Safety', duration_minutes: 45, is_mandatory: true },\n            { id: 'c2', title: 'GDPR & Data Protection', category: 'Compliance', duration_minutes: 60, is_mandatory: true },\n            { id: 'c3', title: 'Manual Handling', category: 'Health & Safety', duration_minutes: 30, is_mandatory: true },\n            { id: 'c4', title: 'First Aid Basics', category: 'Health & Safety', duration_minutes: 90, is_mandatory: false },\n            { id: 'c5', title: 'Leadership Fundamentals', category: 'Professional Development', duration_minutes: 120, is_mandatory: false },\n            { id: 'c6', title: 'Equality & Diversity', category: 'Compliance', duration_minutes: 45, is_mandatory: true },\n            { id: 'c7', title: 'Cybersecurity Awareness', category: 'IT Security', duration_minutes: 30, is_mandatory: true },\n            { id: 'c8', title: 'Conflict Resolution', category: 'Soft Skills', duration_minutes: 60, is_mandatory: false },\n        ];\n\n        return courses.map((course, i) => {\n            const statuses: TrainingRecord['status'][] = ['completed', 'in_progress', 'not_started', 'expired'];\n            const status = statuses[i % 4];\n\n            return {\n                id: `tr-${i}`,\n                employee_id: 'emp-1',\n                employee_name: 'Current User',\n                course,\n                status,\n                progress: status === 'completed' ? 100 : status === 'in_progress' ? Math.floor(Math.random() * 80) + 10 : 0,\n                started_at: status !== 'not_started' ? format(addDays(new Date(), -30), 'yyyy-MM-dd') : undefined,\n                completed_at: status === 'completed' ? format(addDays(new Date(), -15), 'yyyy-MM-dd') : undefined,\n                expires_at: status === 'completed' ? format(addDays(new Date(), 350), 'yyyy-MM-dd') :\n                    status === 'expired' ? format(addDays(new Date(), -10), 'yyyy-MM-dd') : undefined,\n                score: status === 'completed' ? Math.floor(Math.random() * 20) + 80 : undefined,\n                certificate_url: status === 'completed' ? '#' : undefined,\n            };\n        });\n    }\n\n    function getStatusInfo(status: TrainingRecord['status']) {\n        switch (status) {\n            case 'completed':\n                return { label: 'Completed', color: 'bg-green-100 text-green-700', icon: <CheckCircle className=\"w-4 h-4\" /> };\n            case 'in_progress':\n                return { label: 'In Progress', color: 'bg-blue-100 text-blue-700', icon: <Clock className=\"w-4 h-4\" /> };\n            case 'expired':\n                return { label: 'Expired', color: 'bg-red-100 text-red-700', icon: <AlertTriangle className=\"w-4 h-4\" /> };\n            default:\n                return { label: 'Not Started', color: 'bg-gray-100 text-gray-700', icon: <Clock className=\"w-4 h-4\" /> };\n        }\n    }\n\n    function getCategoryColor(category: string) {\n        const colors: Record<string, string> = {\n            'Health & Safety': 'bg-red-50 text-red-700 border-red-200',\n            'Compliance': 'bg-blue-50 text-blue-700 border-blue-200',\n            'Professional Development': 'bg-purple-50 text-purple-700 border-purple-200',\n            'IT Security': 'bg-orange-50 text-orange-700 border-orange-200',\n            'Soft Skills': 'bg-green-50 text-green-700 border-green-200',\n        };\n        return colors[category] || 'bg-gray-50 text-gray-700 border-gray-200';\n    }\n\n    function formatDuration(minutes: number): string {\n        const hours = Math.floor(minutes / 60);\n        const mins = minutes % 60;\n        if (hours > 0) {\n            return mins > 0 ? `${hours}h ${mins}m` : `${hours}h`;\n        }\n        return `${mins}m`;\n    }\n\n    const filteredRecords = records.filter(r => {\n        if (filter === 'all') return true;\n        if (filter === 'mandatory') return r.course.is_mandatory;\n        return r.status === filter;\n    });\n\n    const stats = {\n        total: records.length,\n        completed: records.filter(r => r.status === 'completed').length,\n        inProgress: records.filter(r => r.status === 'in_progress').length,\n        expired: records.filter(r => r.status === 'expired').length,\n        mandatory: records.filter(r => r.course.is_mandatory).length,\n        mandatoryCompleted: records.filter(r => r.course.is_mandatory && r.status === 'completed').length,\n    };\n\n    const complianceRate = stats.mandatory > 0\n        ? Math.round((stats.mandatoryCompleted / stats.mandatory) * 100)\n        : 100;\n\n    if (loading) {\n        return (\n            <div className=\"bg-white rounded-xl border border-gray-200 p-6\">\n                <div className=\"animate-pulse space-y-4\">\n                    <div className=\"h-6 bg-gray-200 rounded w-1/3\" />\n                    <div className=\"grid grid-cols-3 gap-4\">\n                        {[1, 2, 3].map(i => (\n                            <div key={i} className=\"h-40 bg-gray-100 rounded-xl\" />\n                        ))}\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            {/* Stats Header */}\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n                <div className=\"bg-white rounded-xl border border-gray-200 p-4\">\n                    <div className=\"flex items-center justify-between\">\n                        <div>\n                            <p className=\"text-sm text-gray-600\">Total Courses</p>\n                            <p className=\"text-2xl font-bold text-gray-900\">{stats.total}</p>\n                        </div>\n                        <GraduationCap className=\"w-8 h-8 text-indigo-500\" />\n                    </div>\n                </div>\n                <div className=\"bg-white rounded-xl border border-gray-200 p-4\">\n                    <div className=\"flex items-center justify-between\">\n                        <div>\n                            <p className=\"text-sm text-gray-600\">Completed</p>\n                            <p className=\"text-2xl font-bold text-green-600\">{stats.completed}</p>\n                        </div>\n                        <CheckCircle className=\"w-8 h-8 text-green-500\" />\n                    </div>\n                </div>\n                <div className=\"bg-white rounded-xl border border-gray-200 p-4\">\n                    <div className=\"flex items-center justify-between\">\n                        <div>\n                            <p className=\"text-sm text-gray-600\">In Progress</p>\n                            <p className=\"text-2xl font-bold text-blue-600\">{stats.inProgress}</p>\n                        </div>\n                        <Clock className=\"w-8 h-8 text-blue-500\" />\n                    </div>\n                </div>\n                <div className=\"bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl p-4 text-white\">\n                    <div className=\"flex items-center justify-between\">\n                        <div>\n                            <p className=\"text-sm text-indigo-200\">Compliance</p>\n                            <p className=\"text-2xl font-bold\">{complianceRate}%</p>\n                        </div>\n                        <Award className=\"w-8 h-8 text-white/50\" />\n                    </div>\n                    <div className=\"mt-2 h-2 bg-white/20 rounded-full overflow-hidden\">\n                        <div\n                            className=\"h-full bg-white rounded-full\"\n                            style={{ width: `${complianceRate}%` }}\n                        />\n                    </div>\n                </div>\n            </div>\n\n            {/* Training List */}\n            <div className=\"bg-white rounded-xl border border-gray-200 overflow-hidden\">\n                <div className=\"px-6 py-4 border-b border-gray-200\">\n                    <div className=\"flex items-center justify-between\">\n                        <h2 className=\"font-semibold text-gray-900\">Training Courses</h2>\n                        <div className=\"flex items-center space-x-2\">\n                            <button\n                                onClick={() => loadTrainingRecords()}\n                                className=\"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg\"\n                            >\n                                <RefreshCw className=\"w-4 h-4\" />\n                            </button>\n                        </div>\n                    </div>\n\n                    {/* Filters */}\n                    <div className=\"mt-3 flex flex-wrap gap-2\">\n                        {(['all', 'mandatory', 'in_progress', 'completed', 'expired'] as const).map(f => (\n                            <button\n                                key={f}\n                                onClick={() => setFilter(f)}\n                                className={`px-3 py-1 text-xs rounded-lg transition ${filter === f\n                                    ? 'bg-indigo-100 text-indigo-700 font-medium'\n                                    : 'text-gray-600 hover:bg-gray-100'\n                                    }`}\n                            >\n                                {f === 'in_progress' ? 'In Progress' : f.charAt(0).toUpperCase() + f.slice(1)}\n                            </button>\n                        ))}\n                    </div>\n                </div>\n\n                {/* Course Grid */}\n                <div className=\"p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                    {filteredRecords.map(record => {\n                        const statusInfo = getStatusInfo(record.status);\n\n                        return (\n                            <div\n                                key={record.id}\n                                className={`rounded-xl border p-4 transition hover:shadow-md ${record.status === 'expired' ? 'border-red-200 bg-red-50/30' : 'border-gray-200'\n                                    }`}\n                            >\n                                <div className=\"flex items-start justify-between mb-3\">\n                                    <span className={`px-2 py-0.5 text-xs rounded border ${getCategoryColor(record.course.category)}`}>\n                                        {record.course.category}\n                                    </span>\n                                    {record.course.is_mandatory && (\n                                        <span className=\"px-2 py-0.5 text-xs bg-red-100 text-red-700 rounded\">\n                                            Mandatory\n                                        </span>\n                                    )}\n                                </div>\n\n                                <h3 className=\"font-medium text-gray-900 mb-1\">{record.course.title}</h3>\n\n                                <div className=\"flex items-center text-xs text-gray-500 space-x-3 mb-3\">\n                                    <span className=\"flex items-center\">\n                                        <Clock className=\"w-3 h-3 mr-1\" />\n                                        {formatDuration(record.course.duration_minutes)}\n                                    </span>\n                                    {record.expires_at && (\n                                        <span className={`flex items-center ${isBefore(parseISO(record.expires_at), new Date()) ? 'text-red-600' : ''\n                                            }`}>\n                                            <Calendar className=\"w-3 h-3 mr-1\" />\n                                            {isBefore(parseISO(record.expires_at), new Date())\n                                                ? 'Expired'\n                                                : `Expires ${format(parseISO(record.expires_at), 'MMM d, yyyy')}`\n                                            }\n                                        </span>\n                                    )}\n                                </div>\n\n                                {/* Progress bar */}\n                                <div className=\"mb-3\">\n                                    <div className=\"flex items-center justify-between text-xs mb-1\">\n                                        <span className={`flex items-center ${statusInfo.color} px-2 py-0.5 rounded`}>\n                                            {statusInfo.icon}\n                                            <span className=\"ml-1\">{statusInfo.label}</span>\n                                        </span>\n                                        <span className=\"text-gray-600\">{record.progress}%</span>\n                                    </div>\n                                    <div className=\"h-2 bg-gray-200 rounded-full overflow-hidden\">\n                                        <div\n                                            className={`h-full rounded-full transition-all ${record.status === 'completed' ? 'bg-green-500' :\n                                                record.status === 'expired' ? 'bg-red-500' : 'bg-indigo-500'\n                                                }`}\n                                            style={{ width: `${record.progress}%` }}\n                                        />\n                                    </div>\n                                </div>\n\n                                {/* Actions */}\n                                <div className=\"flex space-x-2\">\n                                    {record.status === 'completed' ? (\n                                        <>\n                                            {record.score && (\n                                                <span className=\"text-sm text-green-600 font-medium\">\n                                                    Score: {record.score}%\n                                                </span>\n                                            )}\n                                            {record.certificate_url && (\n                                                <button className=\"ml-auto flex items-center text-xs text-indigo-600 hover:text-indigo-700\">\n                                                    <Download className=\"w-3 h-3 mr-1\" />\n                                                    Certificate\n                                                </button>\n                                            )}\n                                        </>\n                                    ) : record.status === 'expired' ? (\n                                        <button className=\"flex-1 flex items-center justify-center py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition text-sm font-medium\">\n                                            <RefreshCw className=\"w-4 h-4 mr-1\" />\n                                            Retake Course\n                                        </button>\n                                    ) : (\n                                        <button className=\"flex-1 flex items-center justify-center py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition text-sm font-medium\">\n                                            <Play className=\"w-4 h-4 mr-1\" />\n                                            {record.status === 'in_progress' ? 'Continue' : 'Start Course'}\n                                        </button>\n                                    )}\n                                </div>\n                            </div>\n                        );\n                    })}\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/UKComplianceDashboardWidget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Users' is defined but never used. Allowed unused vars must match /^_/u.","line":25,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronRight' is defined but never used. Allowed unused vars must match /^_/u.","line":31,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used. Allowed unused vars must match /^_/u.","line":32,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingDown' is defined but never used. Allowed unused vars must match /^_/u.","line":33,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":17},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadComplianceData'. Either include it or remove the dependency array.","line":77,"column":8,"nodeType":"ArrayExpression","endLine":77,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [currentTenant, loadComplianceData]","fix":{"range":[1970,1985],"text":"[currentTenant, loadComplianceData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * UK Compliance Dashboard Widget\n * \n * A comprehensive widget for the main dashboard showing:\n * - CQC Readiness Score\n * - Home Office Compliance Status\n * - Staff Compliance Overview\n * - Critical Alerts\n * - Upcoming Expiries\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport {\n    Shield,\n    ShieldCheck,\n    ShieldAlert,\n    ShieldX,\n    AlertTriangle,\n    CheckCircle,\n    Clock,\n    Users,\n    FileCheck,\n    GraduationCap,\n    Briefcase,\n    ExternalLink,\n    RefreshCw,\n    ChevronRight,\n    TrendingUp,\n    TrendingDown,\n    Info\n} from 'lucide-react';\nimport { format, differenceInDays } from 'date-fns';\n\ninterface ComplianceMetrics {\n    totalStaff: number;\n    compliantStaff: number;\n    complianceRate: number;\n    dbsValid: number;\n    dbsExpiring: number;\n    dbsExpired: number;\n    rtwValid: number;\n    rtwExpiring: number;\n    rtwExpired: number;\n    trainingComplete: number;\n    trainingOverdue: number;\n    cqcReady: boolean;\n    lastUpdated: string;\n}\n\ninterface ExpiringItem {\n    id: string;\n    type: 'dbs' | 'rtw' | 'training';\n    staffName: string;\n    itemName: string;\n    expiryDate: string;\n    daysUntilExpiry: number;\n    severity: 'critical' | 'warning' | 'info';\n}\n\nexport default function UKComplianceDashboardWidget() {\n    const navigate = useNavigate();\n    const { currentTenant } = useTenant();\n    const [loading, setLoading] = useState(true);\n    const [refreshing, setRefreshing] = useState(false);\n    const [metrics, setMetrics] = useState<ComplianceMetrics | null>(null);\n    const [expiringItems, setExpiringItems] = useState<ExpiringItem[]>([]);\n    const [showEVisaGuide, setShowEVisaGuide] = useState(false);\n\n    useEffect(() => {\n        if (currentTenant) {\n            loadComplianceData();\n        }\n    }, [currentTenant]);\n\n    const loadComplianceData = async () => {\n        if (!currentTenant) return;\n\n        setLoading(true);\n        try {\n            // Get staff compliance status\n            const { data: complianceData, error: complianceError } = await supabase\n                .from('staff_compliance_status')\n                .select('*')\n                .eq('tenant_id', currentTenant.id);\n\n            if (complianceError) throw complianceError;\n\n            // Get expiring DBS checks (next 90 days)\n            const ninetyDaysFromNow = new Date();\n            ninetyDaysFromNow.setDate(ninetyDaysFromNow.getDate() + 90);\n\n            const { data: expiringDBS } = await supabase\n                .from('dbs_checks')\n                .select('id, applicant_name, expiry_date')\n                .eq('tenant_id', currentTenant.id)\n                .lte('expiry_date', ninetyDaysFromNow.toISOString().split('T')[0])\n                .gte('expiry_date', new Date().toISOString().split('T')[0])\n                .order('expiry_date');\n\n            // Get expiring RTW (next 90 days)\n            const { data: expiringRTW } = await supabase\n                .from('right_to_work_checks')\n                .select('id, staff_name, next_check_date')\n                .eq('tenant_id', currentTenant.id)\n                .not('next_check_date', 'is', null)\n                .lte('next_check_date', ninetyDaysFromNow.toISOString().split('T')[0])\n                .gte('next_check_date', new Date().toISOString().split('T')[0])\n                .order('next_check_date');\n\n            // Get expiring training (next 30 days)\n            const thirtyDaysFromNow = new Date();\n            thirtyDaysFromNow.setDate(thirtyDaysFromNow.getDate() + 30);\n\n            const { data: expiringTraining } = await supabase\n                .from('training_records')\n                .select('id, staff_name, training_name, expiry_date')\n                .eq('tenant_id', currentTenant.id)\n                .eq('is_mandatory', true)\n                .not('expiry_date', 'is', null)\n                .lte('expiry_date', thirtyDaysFromNow.toISOString().split('T')[0])\n                .gte('expiry_date', new Date().toISOString().split('T')[0])\n                .order('expiry_date');\n\n            // Calculate metrics\n            const staffData = complianceData || [];\n            const total = staffData.length;\n            const compliant = staffData.filter((s: any) => s.cqc_ready).length;\n            const dbsOk = staffData.filter((s: any) => s.dbs_status === 'compliant').length;\n            const dbsExp = staffData.filter((s: any) => s.dbs_status === 'expiring_soon').length;\n            const dbsExpired = staffData.filter((s: any) => s.dbs_status === 'expired' || s.dbs_status === 'missing').length;\n            const rtwOk = staffData.filter((s: any) => s.rtw_status === 'compliant').length;\n            const rtwExp = staffData.filter((s: any) => s.rtw_status === 'expiring_soon').length;\n            const rtwExpired = staffData.filter((s: any) => s.rtw_status === 'expired' || s.rtw_status === 'missing').length;\n            const trainingOk = staffData.filter((s: any) => s.training_status === 'compliant').length;\n            const trainingOverdue = staffData.filter((s: any) => s.training_status === 'overdue' || s.training_status === 'missing').length;\n\n            setMetrics({\n                totalStaff: total,\n                compliantStaff: compliant,\n                complianceRate: total > 0 ? Math.round((compliant / total) * 100) : 100,\n                dbsValid: dbsOk,\n                dbsExpiring: dbsExp,\n                dbsExpired: dbsExpired,\n                rtwValid: rtwOk,\n                rtwExpiring: rtwExp,\n                rtwExpired: rtwExpired,\n                trainingComplete: trainingOk,\n                trainingOverdue: trainingOverdue,\n                cqcReady: dbsExpired === 0 && rtwExpired === 0,\n                lastUpdated: new Date().toISOString()\n            });\n\n            // Build expiring items list\n            const items: ExpiringItem[] = [];\n\n            expiringDBS?.forEach((item: any) => {\n                const days = differenceInDays(new Date(item.expiry_date), new Date());\n                items.push({\n                    id: item.id,\n                    type: 'dbs',\n                    staffName: item.applicant_name,\n                    itemName: 'DBS Certificate',\n                    expiryDate: item.expiry_date,\n                    daysUntilExpiry: days,\n                    severity: days <= 30 ? 'critical' : days <= 60 ? 'warning' : 'info'\n                });\n            });\n\n            expiringRTW?.forEach((item: any) => {\n                const days = differenceInDays(new Date(item.next_check_date), new Date());\n                items.push({\n                    id: item.id,\n                    type: 'rtw',\n                    staffName: item.staff_name,\n                    itemName: 'Right to Work',\n                    expiryDate: item.next_check_date,\n                    daysUntilExpiry: days,\n                    severity: days <= 30 ? 'critical' : days <= 60 ? 'warning' : 'info'\n                });\n            });\n\n            expiringTraining?.forEach((item: any) => {\n                const days = differenceInDays(new Date(item.expiry_date), new Date());\n                items.push({\n                    id: item.id,\n                    type: 'training',\n                    staffName: item.staff_name || 'Unknown',\n                    itemName: item.training_name,\n                    expiryDate: item.expiry_date,\n                    daysUntilExpiry: days,\n                    severity: days <= 14 ? 'critical' : days <= 21 ? 'warning' : 'info'\n                });\n            });\n\n            // Sort by urgency\n            items.sort((a, b) => a.daysUntilExpiry - b.daysUntilExpiry);\n            setExpiringItems(items.slice(0, 5)); // Top 5 most urgent\n\n        } catch (error) {\n            log.error('Error loading compliance data', error, { component: 'UKComplianceDashboardWidget', action: 'loadComplianceData' });\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleRefresh = async () => {\n        setRefreshing(true);\n        await loadComplianceData();\n        setRefreshing(false);\n    };\n\n    const getComplianceIcon = () => {\n        if (!metrics) return <Shield className=\"w-8 h-8 text-gray-400\" />;\n\n        if (metrics.complianceRate >= 95 && metrics.cqcReady) {\n            return <ShieldCheck className=\"w-8 h-8 text-emerald-500\" />;\n        } else if (metrics.complianceRate >= 70) {\n            return <ShieldAlert className=\"w-8 h-8 text-amber-500\" />;\n        } else {\n            return <ShieldX className=\"w-8 h-8 text-red-500\" />;\n        }\n    };\n\n    const getComplianceColor = () => {\n        if (!metrics) return 'gray';\n        if (metrics.complianceRate >= 95 && metrics.cqcReady) return 'emerald';\n        if (metrics.complianceRate >= 70) return 'amber';\n        return 'red';\n    };\n\n    const getSeverityColor = (severity: string) => {\n        switch (severity) {\n            case 'critical': return 'text-red-600 bg-red-50';\n            case 'warning': return 'text-amber-600 bg-amber-50';\n            default: return 'text-blue-600 bg-blue-50';\n        }\n    };\n\n    const getTypeIcon = (type: string) => {\n        switch (type) {\n            case 'dbs': return <FileCheck className=\"w-4 h-4\" />;\n            case 'rtw': return <Briefcase className=\"w-4 h-4\" />;\n            case 'training': return <GraduationCap className=\"w-4 h-4\" />;\n            default: return <AlertTriangle className=\"w-4 h-4\" />;\n        }\n    };\n\n    if (loading) {\n        return (\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6 animate-pulse\">\n                <div className=\"h-6 bg-gray-200 rounded w-1/3 mb-4\"></div>\n                <div className=\"grid grid-cols-3 gap-4 mb-6\">\n                    <div className=\"h-20 bg-gray-100 rounded-lg\"></div>\n                    <div className=\"h-20 bg-gray-100 rounded-lg\"></div>\n                    <div className=\"h-20 bg-gray-100 rounded-lg\"></div>\n                </div>\n                <div className=\"h-32 bg-gray-100 rounded-lg\"></div>\n            </div>\n        );\n    }\n\n    const color = getComplianceColor();\n\n    return (\n        <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden\">\n            {/* Header */}\n            <div className={`bg-gradient-to-r from-${color}-500 to-${color}-600 px-6 py-4`}>\n                <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                        <div className=\"p-2 bg-white/20 rounded-xl backdrop-blur-sm\">\n                            {getComplianceIcon()}\n                        </div>\n                        <div>\n                            <h3 className=\"font-semibold text-white text-lg\">UK Compliance Status</h3>\n                            <p className=\"text-white/80 text-sm\">CQC & Home Office</p>\n                        </div>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                        <button\n                            onClick={handleRefresh}\n                            disabled={refreshing}\n                            className=\"p-2 text-white/80 hover:text-white hover:bg-white/10 rounded-lg transition-all\"\n                            title=\"Refresh\"\n                        >\n                            <RefreshCw className={`w-5 h-5 ${refreshing ? 'animate-spin' : ''}`} />\n                        </button>\n                        <button\n                            onClick={() => navigate('/compliance')}\n                            className=\"px-3 py-1.5 bg-white/20 hover:bg-white/30 text-white text-sm font-medium rounded-lg transition-all flex items-center gap-1\"\n                        >\n                            View Full Report <ExternalLink className=\"w-4 h-4\" />\n                        </button>\n                    </div>\n                </div>\n            </div>\n\n            <div className=\"p-6\">\n                {/* Main Score */}\n                <div className=\"flex items-center justify-between mb-6\">\n                    <div>\n                        <div className=\"flex items-baseline gap-2\">\n                            <span className={`text-4xl font-bold text-${color}-600`}>\n                                {metrics?.complianceRate || 0}%\n                            </span>\n                            <span className=\"text-gray-500 text-sm\">compliance rate</span>\n                        </div>\n                        <p className=\"text-gray-600 mt-1\">\n                            {metrics?.compliantStaff || 0} of {metrics?.totalStaff || 0} staff fully compliant\n                        </p>\n                    </div>\n                    <div className={`px-4 py-2 rounded-lg ${metrics?.cqcReady ? 'bg-emerald-50 text-emerald-700' : 'bg-red-50 text-red-700'}`}>\n                        <div className=\"flex items-center gap-2\">\n                            {metrics?.cqcReady ? (\n                                <>\n                                    <CheckCircle className=\"w-5 h-5\" />\n                                    <span className=\"font-semibold\">CQC Ready</span>\n                                </>\n                            ) : (\n                                <>\n                                    <ShieldX className=\"w-5 h-5\" />\n                                    <span className=\"font-semibold\">Action Required</span>\n                                </>\n                            )}\n                        </div>\n                    </div>\n                </div>\n\n                {/* Stats Grid */}\n                <div className=\"grid grid-cols-3 gap-4 mb-6\">\n                    {/* DBS Status */}\n                    <div className=\"bg-gray-50 rounded-lg p-4\">\n                        <div className=\"flex items-center gap-2 mb-2\">\n                            <FileCheck className=\"w-5 h-5 text-indigo-600\" />\n                            <span className=\"text-sm font-medium text-gray-700\">DBS Checks</span>\n                        </div>\n                        <div className=\"flex items-baseline gap-2\">\n                            <span className=\"text-2xl font-bold text-gray-900\">{metrics?.dbsValid || 0}</span>\n                            <span className=\"text-sm text-gray-500\">valid</span>\n                        </div>\n                        <div className=\"flex gap-2 mt-2 text-xs\">\n                            {(metrics?.dbsExpiring || 0) > 0 && (\n                                <span className=\"text-amber-600 bg-amber-50 px-2 py-0.5 rounded-full\">\n                                    {metrics?.dbsExpiring} expiring\n                                </span>\n                            )}\n                            {(metrics?.dbsExpired || 0) > 0 && (\n                                <span className=\"text-red-600 bg-red-50 px-2 py-0.5 rounded-full\">\n                                    {metrics?.dbsExpired} expired\n                                </span>\n                            )}\n                        </div>\n                    </div>\n\n                    {/* RTW Status */}\n                    <div className=\"bg-gray-50 rounded-lg p-4\">\n                        <div className=\"flex items-center gap-2 mb-2\">\n                            <Briefcase className=\"w-5 h-5 text-cyan-600\" />\n                            <span className=\"text-sm font-medium text-gray-700\">Right to Work</span>\n                        </div>\n                        <div className=\"flex items-baseline gap-2\">\n                            <span className=\"text-2xl font-bold text-gray-900\">{metrics?.rtwValid || 0}</span>\n                            <span className=\"text-sm text-gray-500\">verified</span>\n                        </div>\n                        <div className=\"flex gap-2 mt-2 text-xs\">\n                            {(metrics?.rtwExpiring || 0) > 0 && (\n                                <span className=\"text-amber-600 bg-amber-50 px-2 py-0.5 rounded-full\">\n                                    {metrics?.rtwExpiring} expiring\n                                </span>\n                            )}\n                            {(metrics?.rtwExpired || 0) > 0 && (\n                                <span className=\"text-red-600 bg-red-50 px-2 py-0.5 rounded-full\">\n                                    {metrics?.rtwExpired} expired\n                                </span>\n                            )}\n                        </div>\n                    </div>\n\n                    {/* Training Status */}\n                    <div className=\"bg-gray-50 rounded-lg p-4\">\n                        <div className=\"flex items-center gap-2 mb-2\">\n                            <GraduationCap className=\"w-5 h-5 text-purple-600\" />\n                            <span className=\"text-sm font-medium text-gray-700\">Training</span>\n                        </div>\n                        <div className=\"flex items-baseline gap-2\">\n                            <span className=\"text-2xl font-bold text-gray-900\">{metrics?.trainingComplete || 0}</span>\n                            <span className=\"text-sm text-gray-500\">complete</span>\n                        </div>\n                        <div className=\"flex gap-2 mt-2 text-xs\">\n                            {(metrics?.trainingOverdue || 0) > 0 && (\n                                <span className=\"text-red-600 bg-red-50 px-2 py-0.5 rounded-full\">\n                                    {metrics?.trainingOverdue} overdue\n                                </span>\n                            )}\n                        </div>\n                    </div>\n                </div>\n\n                {/* eVisa Alert Banner */}\n                <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6\">\n                    <div className=\"flex items-start gap-3\">\n                        <AlertTriangle className=\"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5\" />\n                        <div className=\"flex-1\">\n                            <h4 className=\"font-semibold text-amber-800 text-sm\">2024-2025 Home Office Update</h4>\n                            <p className=\"text-amber-700 text-sm mt-1\">\n                                BRPs are no longer valid for RTW checks. All non-UK workers must use eVisa share codes.\n                            </p>\n                            <button\n                                onClick={() => setShowEVisaGuide(true)}\n                                className=\"mt-2 text-sm font-medium text-amber-800 hover:text-amber-900 underline\"\n                            >\n                                View eVisa Training Guide â\n                            </button>\n                        </div>\n                    </div>\n                </div>\n\n                {/* Upcoming Expiries */}\n                {expiringItems.length > 0 && (\n                    <div>\n                        <h4 className=\"font-medium text-gray-900 mb-3 flex items-center gap-2\">\n                            <Clock className=\"w-4 h-4 text-gray-500\" />\n                            Upcoming Expiries\n                        </h4>\n                        <div className=\"space-y-2\">\n                            {expiringItems.map((item) => (\n                                <div\n                                    key={`${item.type}-${item.id}`}\n                                    className={`flex items-center justify-between p-3 rounded-lg ${getSeverityColor(item.severity)} border border-current/10`}\n                                >\n                                    <div className=\"flex items-center gap-3\">\n                                        <div className=\"p-1.5 bg-white/50 rounded-lg\">\n                                            {getTypeIcon(item.type)}\n                                        </div>\n                                        <div>\n                                            <p className=\"text-sm font-medium\">{item.staffName}</p>\n                                            <p className=\"text-xs opacity-75\">{item.itemName}</p>\n                                        </div>\n                                    </div>\n                                    <div className=\"text-right\">\n                                        <p className=\"text-sm font-semibold\">\n                                            {item.daysUntilExpiry === 0 ? 'Today' :\n                                                item.daysUntilExpiry === 1 ? 'Tomorrow' :\n                                                    `${item.daysUntilExpiry} days`}\n                                        </p>\n                                        <p className=\"text-xs opacity-75\">\n                                            {format(new Date(item.expiryDate), 'dd MMM yyyy')}\n                                        </p>\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n                )}\n\n                {expiringItems.length === 0 && (\n                    <div className=\"text-center py-6 bg-emerald-50 rounded-lg\">\n                        <CheckCircle className=\"w-10 h-10 text-emerald-500 mx-auto mb-2\" />\n                        <p className=\"text-emerald-800 font-medium\">All Clear!</p>\n                        <p className=\"text-emerald-600 text-sm\">No upcoming expiries in the next 30 days</p>\n                    </div>\n                )}\n\n                {/* Last Updated */}\n                <p className=\"text-xs text-gray-400 mt-4 text-center\">\n                    Last updated: {metrics?.lastUpdated ? format(new Date(metrics.lastUpdated), 'dd MMM yyyy HH:mm') : 'Never'}\n                </p>\n            </div>\n\n            {/* eVisa Training Guide Modal */}\n            {showEVisaGuide && (\n                <EVisaTrainingGuide onClose={() => setShowEVisaGuide(false)} />\n            )}\n        </div>\n    );\n}\n\n// ============================================\n// eVisa Training Guide Component (Phase 3)\n// ============================================\ninterface EVisaTrainingGuideProps {\n    onClose: () => void;\n}\n\nfunction EVisaTrainingGuide({ onClose }: EVisaTrainingGuideProps) {\n    const [currentStep, setCurrentStep] = useState(0);\n\n    const steps = [\n        {\n            title: 'What Changed?',\n            icon: <Info className=\"w-8 h-8 text-cyan-600\" />,\n            content: (\n                <div className=\"space-y-4\">\n                    <p className=\"text-gray-700\">\n                        From <strong>31 October 2024</strong>, the UK moved to a fully digital immigration system.\n                        This means significant changes for Right to Work checks:\n                    </p>\n                    <div className=\"bg-red-50 border-l-4 border-red-500 p-4\">\n                        <h4 className=\"font-semibold text-red-800\">â No Longer Valid</h4>\n                        <ul className=\"text-red-700 text-sm mt-2 list-disc list-inside space-y-1\">\n                            <li>Biometric Residence Permits (BRPs)</li>\n                            <li>Biometric Residence Cards (BRCs)</li>\n                            <li>Passport vignette stickers (for existing workers)</li>\n                        </ul>\n                    </div>\n                    <div className=\"bg-emerald-50 border-l-4 border-emerald-500 p-4\">\n                        <h4 className=\"font-semibold text-emerald-800\">â Now Required</h4>\n                        <ul className=\"text-emerald-700 text-sm mt-2 list-disc list-inside space-y-1\">\n                            <li>eVisa via UKVI online account</li>\n                            <li>Share code for employer verification</li>\n                            <li>Online checking service (gov.uk)</li>\n                        </ul>\n                    </div>\n                </div>\n            )\n        },\n        {\n            title: 'How to Verify an eVisa',\n            icon: <FileCheck className=\"w-8 h-8 text-cyan-600\" />,\n            content: (\n                <div className=\"space-y-4\">\n                    <ol className=\"space-y-4\">\n                        <li className=\"flex gap-3\">\n                            <span className=\"flex-shrink-0 w-8 h-8 bg-cyan-100 text-cyan-700 rounded-full flex items-center justify-center font-bold\">1</span>\n                            <div>\n                                <h4 className=\"font-semibold text-gray-900\">Ask for Share Code</h4>\n                                <p className=\"text-gray-600 text-sm\">Worker generates a share code from their UKVI account at <a href=\"https://www.gov.uk/view-prove-immigration-status\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-cyan-600 underline\">gov.uk/view-prove-immigration-status</a></p>\n                            </div>\n                        </li>\n                        <li className=\"flex gap-3\">\n                            <span className=\"flex-shrink-0 w-8 h-8 bg-cyan-100 text-cyan-700 rounded-full flex items-center justify-center font-bold\">2</span>\n                            <div>\n                                <h4 className=\"font-semibold text-gray-900\">Access Employer Checking Service</h4>\n                                <p className=\"text-gray-600 text-sm\">Go to <a href=\"https://www.gov.uk/view-right-to-work\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-cyan-600 underline\">gov.uk/view-right-to-work</a></p>\n                            </div>\n                        </li>\n                        <li className=\"flex gap-3\">\n                            <span className=\"flex-shrink-0 w-8 h-8 bg-cyan-100 text-cyan-700 rounded-full flex items-center justify-center font-bold\">3</span>\n                            <div>\n                                <h4 className=\"font-semibold text-gray-900\">Enter Share Code + Date of Birth</h4>\n                                <p className=\"text-gray-600 text-sm\">Share codes are 9 characters and valid for 90 days</p>\n                            </div>\n                        </li>\n                        <li className=\"flex gap-3\">\n                            <span className=\"flex-shrink-0 w-8 h-8 bg-cyan-100 text-cyan-700 rounded-full flex items-center justify-center font-bold\">4</span>\n                            <div>\n                                <h4 className=\"font-semibold text-gray-900\">Download & Save Verification</h4>\n                                <p className=\"text-gray-600 text-sm\">Save a PDF of the verification page with date stamp</p>\n                            </div>\n                        </li>\n                        <li className=\"flex gap-3\">\n                            <span className=\"flex-shrink-0 w-8 h-8 bg-cyan-100 text-cyan-700 rounded-full flex items-center justify-center font-bold\">5</span>\n                            <div>\n                                <h4 className=\"font-semibold text-gray-900\">Record in NovumFlow</h4>\n                                <p className=\"text-gray-600 text-sm\">Upload document and record share code in RTW form</p>\n                            </div>\n                        </li>\n                    </ol>\n                </div>\n            )\n        },\n        {\n            title: 'Penalties for Non-Compliance',\n            icon: <AlertTriangle className=\"w-8 h-8 text-red-600\" />,\n            content: (\n                <div className=\"space-y-4\">\n                    <div className=\"bg-red-50 rounded-lg p-6\">\n                        <h4 className=\"text-3xl font-bold text-red-700\">Â£60,000</h4>\n                        <p className=\"text-red-600\">Fine per illegal worker (increased from Â£45,000)</p>\n                    </div>\n                    <div className=\"grid grid-cols-2 gap-4\">\n                        <div className=\"bg-gray-50 rounded-lg p-4 text-center\">\n                            <h5 className=\"text-xl font-bold text-gray-900\">5 Years</h5>\n                            <p className=\"text-gray-600 text-sm\">Maximum prison sentence</p>\n                        </div>\n                        <div className=\"bg-gray-50 rounded-lg p-4 text-center\">\n                            <h5 className=\"text-xl font-bold text-gray-900\">+38%</h5>\n                            <p className=\"text-gray-600 text-sm\">Increase in enforcement</p>\n                        </div>\n                    </div>\n                    <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4\">\n                        <h4 className=\"font-semibold text-amber-800\">Statutory Excuse</h4>\n                        <p className=\"text-amber-700 text-sm mt-1\">\n                            Performing RTW checks correctly provides a \"statutory excuse\" protecting you from penalties\n                            if an employee turns out to be an illegal worker.\n                        </p>\n                    </div>\n                </div>\n            )\n        },\n        {\n            title: 'Quick Reference Checklist',\n            icon: <CheckCircle className=\"w-8 h-8 text-emerald-600\" />,\n            content: (\n                <div className=\"space-y-3\">\n                    <div className=\"bg-white border border-gray-200 rounded-lg divide-y divide-gray-100\">\n                        <label className=\"flex items-center gap-3 p-4 hover:bg-gray-50 cursor-pointer\">\n                            <input type=\"checkbox\" className=\"w-5 h-5 rounded border-gray-300 text-cyan-600\" />\n                            <span className=\"text-gray-700\">Complete RTW check BEFORE first day of work</span>\n                        </label>\n                        <label className=\"flex items-center gap-3 p-4 hover:bg-gray-50 cursor-pointer\">\n                            <input type=\"checkbox\" className=\"w-5 h-5 rounded border-gray-300 text-cyan-600\" />\n                            <span className=\"text-gray-700\">Use online service for eVisa holders (not BRP)</span>\n                        </label>\n                        <label className=\"flex items-center gap-3 p-4 hover:bg-gray-50 cursor-pointer\">\n                            <input type=\"checkbox\" className=\"w-5 h-5 rounded border-gray-300 text-cyan-600\" />\n                            <span className=\"text-gray-700\">Save dated copy of verification for 2+ years</span>\n                        </label>\n                        <label className=\"flex items-center gap-3 p-4 hover:bg-gray-50 cursor-pointer\">\n                            <input type=\"checkbox\" className=\"w-5 h-5 rounded border-gray-300 text-cyan-600\" />\n                            <span className=\"text-gray-700\">Set follow-up check date for time-limited permissions</span>\n                        </label>\n                        <label className=\"flex items-center gap-3 p-4 hover:bg-gray-50 cursor-pointer\">\n                            <input type=\"checkbox\" className=\"w-5 h-5 rounded border-gray-300 text-cyan-600\" />\n                            <span className=\"text-gray-700\">Record share code in NovumFlow RTW form</span>\n                        </label>\n                    </div>\n                    <div className=\"flex gap-3 pt-4\">\n                        <a\n                            href=\"https://www.gov.uk/government/publications/right-to-work-checks-employers-guide\"\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className=\"flex-1 px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-center text-sm font-medium transition-colors\"\n                        >\n                            ð Official Guidance\n                        </a>\n                        <a\n                            href=\"https://www.gov.uk/view-right-to-work\"\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className=\"flex-1 px-4 py-3 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg text-center text-sm font-medium transition-colors\"\n                        >\n                            ð Check RTW Now\n                        </a>\n                    </div>\n                </div>\n            )\n        }\n    ];\n\n    return (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n            <div className=\"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden\">\n                {/* Header */}\n                <div className=\"bg-gradient-to-r from-cyan-600 to-cyan-700 px-6 py-5\">\n                    <div className=\"flex items-center justify-between\">\n                        <div>\n                            <h2 className=\"text-xl font-bold text-white\">eVisa Training Guide</h2>\n                            <p className=\"text-cyan-100 text-sm\">2024-2025 Right to Work Updates</p>\n                        </div>\n                        <button\n                            onClick={onClose}\n                            className=\"text-white/80 hover:text-white text-2xl font-light\"\n                        >\n                            Ã\n                        </button>\n                    </div>\n                    {/* Progress */}\n                    <div className=\"flex gap-2 mt-4\">\n                        {steps.map((_, i) => (\n                            <div\n                                key={i}\n                                className={`flex-1 h-1.5 rounded-full transition-all ${i <= currentStep ? 'bg-white' : 'bg-white/30'\n                                    }`}\n                            />\n                        ))}\n                    </div>\n                </div>\n\n                {/* Content */}\n                <div className=\"p-6 overflow-y-auto max-h-[60vh]\">\n                    <div className=\"flex items-center gap-3 mb-6\">\n                        <div className=\"p-3 bg-cyan-50 rounded-xl\">\n                            {steps[currentStep].icon}\n                        </div>\n                        <h3 className=\"text-xl font-bold text-gray-900\">\n                            {steps[currentStep].title}\n                        </h3>\n                    </div>\n                    {steps[currentStep].content}\n                </div>\n\n                {/* Footer */}\n                <div className=\"border-t border-gray-200 px-6 py-4 flex justify-between items-center bg-gray-50\">\n                    <button\n                        onClick={() => setCurrentStep(Math.max(0, currentStep - 1))}\n                        disabled={currentStep === 0}\n                        className=\"px-4 py-2 text-gray-600 hover:text-gray-900 disabled:opacity-40 disabled:cursor-not-allowed\"\n                    >\n                        â Previous\n                    </button>\n                    <span className=\"text-sm text-gray-500\">\n                        Step {currentStep + 1} of {steps.length}\n                    </span>\n                    {currentStep < steps.length - 1 ? (\n                        <button\n                            onClick={() => setCurrentStep(currentStep + 1)}\n                            className=\"px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg font-medium transition-colors\"\n                        >\n                            Next â\n                        </button>\n                    ) : (\n                        <button\n                            onClick={onClose}\n                            className=\"px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors\"\n                        >\n                            Complete â\n                        </button>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/ViewReviewModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/VisitingRightsManagement.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used. Allowed unused vars must match /^_/u.","line":18,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Loader2' is defined but never used. Allowed unused vars must match /^_/u.","line":29,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MessageSquare' is defined but never used. Allowed unused vars must match /^_/u.","line":30,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'currentTenant' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":100,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":100,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":101,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":101,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":102,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":102,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setLoading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":102,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":102,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Visiting Rights Management\n * \n * CQC Regulation 9A Compliance (Effective 6 April 2024)\n * \n * This regulation requires care providers to:\n * - Ensure service users can receive visitors\n * - Not impose blanket visiting restrictions\n * - Only restrict visiting for genuine reasons\n * - Document all visiting decisions\n */\n\nimport React, { useState, useEffect } from 'react';\nimport {\n    Users,\n    Heart,\n    Calendar,\n    Clock,\n    AlertTriangle,\n    CheckCircle,\n    Shield,\n    FileText,\n    User,\n    Home,\n    Info,\n    Plus,\n    X,\n    Edit2,\n    Loader2,\n    MessageSquare,\n    RefreshCcw,\n    AlertCircle\n} from 'lucide-react';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { useAuth } from '@/contexts/AuthContext';\n\n// ============================================\n// TYPES\n// ============================================\n\ninterface VisitingPolicy {\n    id: string;\n    locationId: string;\n    locationName: string;\n    defaultHours: { start: string; end: string };\n    flexibleVisiting: boolean;\n    overnightAllowed: boolean;\n    maxVisitorsAtOnce: number;\n    bookingRequired: boolean;\n    lastReviewDate: string;\n    nextReviewDate: string;\n    status: 'active' | 'under_review' | 'suspended';\n}\n\ninterface VisitingRestriction {\n    id: string;\n    serviceUserId: string;\n    serviceUserName: string;\n    restrictionType: 'temporary' | 'individual' | 'location_wide';\n    reason: string;\n    reasonCategory: 'infection_control' | 'safeguarding' | 'medical' | 'service_user_request' | 'other';\n    startDate: string;\n    endDate?: string;\n    reviewDate: string;\n    alternativeArrangements: string;\n    approvedBy: string;\n    approvedAt: string;\n    status: 'active' | 'ended' | 'under_review';\n    documentedEvidence?: string;\n}\n\ninterface VisitLog {\n    id: string;\n    serviceUserId: string;\n    visitorName: string;\n    visitDate: string;\n    visitTime: string;\n    duration: number;\n    visitType: 'in_person' | 'virtual' | 'outdoor' | 'overnight';\n    notes?: string;\n}\n\n// ============================================\n// CONSTANTS\n// ============================================\n\nconst RESTRICTION_REASONS = [\n    { value: 'infection_control', label: 'Infection Control Outbreak', description: 'Active outbreak requiring isolation', maxDuration: 14 },\n    { value: 'safeguarding', label: 'Safeguarding Concern', description: 'Protection measures in place', maxDuration: null },\n    { value: 'medical', label: 'Medical Treatment', description: 'Temporary medical intervention', maxDuration: 7 },\n    { value: 'service_user_request', label: 'Service User Request', description: 'Individual has requested privacy', maxDuration: null },\n    { value: 'other', label: 'Other (Documented)', description: 'Must be fully documented', maxDuration: null }\n];\n\n// ============================================\n// COMPONENT\n// ============================================\n\nexport default function VisitingRightsManagement() {\n    const { currentTenant } = useTenant();\n    const { user, profile } = useAuth();\n    const [loading, setLoading] = useState(false);\n    const [activeTab, setActiveTab] = useState<'overview' | 'restrictions' | 'log' | 'policy'>('overview');\n    const [showAddRestriction, setShowAddRestriction] = useState(false);\n\n    // Demo data\n    const [policies] = useState<VisitingPolicy[]>([\n        {\n            id: '1',\n            locationId: 'loc1',\n            locationName: 'Maple House Care Home',\n            defaultHours: { start: '08:00', end: '21:00' },\n            flexibleVisiting: true,\n            overnightAllowed: true,\n            maxVisitorsAtOnce: 3,\n            bookingRequired: false,\n            lastReviewDate: '2024-11-01',\n            nextReviewDate: '2025-02-01',\n            status: 'active'\n        }\n    ]);\n\n    const [restrictions, setRestrictions] = useState<VisitingRestriction[]>([\n        {\n            id: 'r1',\n            serviceUserId: 'su1',\n            serviceUserName: 'Mr. James Wilson',\n            restrictionType: 'temporary',\n            reason: 'COVID-19 outbreak on unit - 5 confirmed cases',\n            reasonCategory: 'infection_control',\n            startDate: '2024-12-18',\n            endDate: '2024-12-25',\n            reviewDate: '2024-12-22',\n            alternativeArrangements: 'Video calls twice daily, window visits arranged',\n            approvedBy: 'Sarah Manager',\n            approvedAt: '2024-12-18T10:30:00',\n            status: 'active',\n            documentedEvidence: 'Infection control report attached'\n        }\n    ]);\n\n    const [visitLogs] = useState<VisitLog[]>([\n        { id: 'v1', serviceUserId: 'su1', visitorName: 'Mary Wilson (Wife)', visitDate: '2024-12-20', visitTime: '14:00', duration: 120, visitType: 'in_person' },\n        { id: 'v2', serviceUserId: 'su2', visitorName: 'John Smith (Son)', visitDate: '2024-12-20', visitTime: '10:30', duration: 60, visitType: 'in_person' },\n        { id: 'v3', serviceUserId: 'su1', visitorName: 'Mary Wilson (Wife)', visitDate: '2024-12-19', visitTime: '15:00', duration: 90, visitType: 'virtual' },\n    ]);\n\n    // New restriction form state\n    const [newRestriction, setNewRestriction] = useState({\n        serviceUserName: '',\n        reasonCategory: 'infection_control',\n        reason: '',\n        startDate: new Date().toISOString().split('T')[0],\n        endDate: '',\n        alternativeArrangements: ''\n    });\n\n    const complianceStats = {\n        totalServiceUsers: 24,\n        activeRestrictions: restrictions.filter(r => r.status === 'active').length,\n        visitsThisWeek: 47,\n        virtualVisits: 12,\n        complianceScore: 98\n    };\n\n    const handleAddRestriction = () => {\n        if (!newRestriction.serviceUserName || !newRestriction.reason || !newRestriction.alternativeArrangements) {\n            alert('Please fill in all required fields');\n            return;\n        }\n\n        const restriction: VisitingRestriction = {\n            id: `r${Date.now()}`,\n            serviceUserId: `su${Date.now()}`,\n            serviceUserName: newRestriction.serviceUserName,\n            restrictionType: 'temporary',\n            reason: newRestriction.reason,\n            reasonCategory: newRestriction.reasonCategory as any,\n            startDate: newRestriction.startDate,\n            endDate: newRestriction.endDate || undefined,\n            reviewDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\n            alternativeArrangements: newRestriction.alternativeArrangements,\n            approvedBy: profile?.full_name || 'Unknown',\n            approvedAt: new Date().toISOString(),\n            status: 'active'\n        };\n\n        setRestrictions([...restrictions, restriction]);\n        setShowAddRestriction(false);\n        setNewRestriction({\n            serviceUserName: '',\n            reasonCategory: 'infection_control',\n            reason: '',\n            startDate: new Date().toISOString().split('T')[0],\n            endDate: '',\n            alternativeArrangements: ''\n        });\n    };\n\n    return (\n        <div className=\"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden\">\n            {/* Header */}\n            <div className=\"p-6 bg-gradient-to-r from-rose-600 to-pink-600\">\n                <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-4\">\n                        <div className=\"p-3 bg-white/20 rounded-xl\">\n                            <Heart className=\"w-8 h-8 text-white\" />\n                        </div>\n                        <div>\n                            <h2 className=\"text-xl font-bold text-white\">Visiting Rights Management</h2>\n                            <p className=\"text-rose-100\">CQC Regulation 9A Compliance</p>\n                        </div>\n                    </div>\n                    <div className=\"text-right\">\n                        <p className=\"text-sm text-rose-100\">Compliance Score</p>\n                        <p className=\"text-3xl font-bold text-white\">{complianceStats.complianceScore}%</p>\n                    </div>\n                </div>\n            </div>\n\n            {/* Info Banner */}\n            <div className=\"p-4 bg-rose-50 border-b border-rose-100\">\n                <div className=\"flex items-start gap-3\">\n                    <Info className=\"w-5 h-5 text-rose-600 flex-shrink-0 mt-0.5\" />\n                    <div className=\"text-sm text-rose-800\">\n                        <p className=\"font-semibold\">CQC Regulation 9A: Right to Receive Visitors (From 6 April 2024)</p>\n                        <p className=\"mt-1\">\n                            All care providers must ensure service users can receive visitors and not impose blanket restrictions.\n                            Any restrictions must be proportionate, time-limited, and have documented alternative arrangements.\n                        </p>\n                    </div>\n                </div>\n            </div>\n\n            {/* Tabs */}\n            <div className=\"border-b border-gray-200\">\n                <div className=\"flex\">\n                    {[\n                        { id: 'overview', label: 'Overview', icon: Home },\n                        { id: 'restrictions', label: 'Active Restrictions', icon: AlertTriangle },\n                        { id: 'log', label: 'Visit Log', icon: Calendar },\n                        { id: 'policy', label: 'Visiting Policy', icon: FileText }\n                    ].map(tab => {\n                        const Icon = tab.icon;\n                        return (\n                            <button\n                                key={tab.id}\n                                onClick={() => setActiveTab(tab.id as any)}\n                                className={`flex items-center gap-2 px-6 py-3 text-sm font-medium border-b-2 transition-colors ${activeTab === tab.id\n                                        ? 'border-rose-600 text-rose-600'\n                                        : 'border-transparent text-gray-500 hover:text-gray-700'\n                                    }`}\n                            >\n                                <Icon className=\"w-4 h-4\" />\n                                {tab.label}\n                                {tab.id === 'restrictions' && complianceStats.activeRestrictions > 0 && (\n                                    <span className=\"px-1.5 py-0.5 bg-amber-100 text-amber-700 rounded-full text-xs\">\n                                        {complianceStats.activeRestrictions}\n                                    </span>\n                                )}\n                            </button>\n                        );\n                    })}\n                </div>\n            </div>\n\n            {/* Content */}\n            <div className=\"p-6\">\n                {/* Overview Tab */}\n                {activeTab === 'overview' && (\n                    <div className=\"space-y-6\">\n                        {/* Stats Grid */}\n                        <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4\">\n                            <div className=\"p-4 bg-gray-50 rounded-lg\">\n                                <div className=\"flex items-center gap-2 text-gray-600 mb-1\">\n                                    <Users className=\"w-4 h-4\" />\n                                    <span className=\"text-xs font-medium\">Service Users</span>\n                                </div>\n                                <p className=\"text-2xl font-bold text-gray-900\">{complianceStats.totalServiceUsers}</p>\n                            </div>\n                            <div className=\"p-4 bg-green-50 rounded-lg\">\n                                <div className=\"flex items-center gap-2 text-green-600 mb-1\">\n                                    <CheckCircle className=\"w-4 h-4\" />\n                                    <span className=\"text-xs font-medium\">Visits This Week</span>\n                                </div>\n                                <p className=\"text-2xl font-bold text-green-600\">{complianceStats.visitsThisWeek}</p>\n                            </div>\n                            <div className=\"p-4 bg-blue-50 rounded-lg\">\n                                <div className=\"flex items-center gap-2 text-blue-600 mb-1\">\n                                    <Calendar className=\"w-4 h-4\" />\n                                    <span className=\"text-xs font-medium\">Virtual Visits</span>\n                                </div>\n                                <p className=\"text-2xl font-bold text-blue-600\">{complianceStats.virtualVisits}</p>\n                            </div>\n                            <div className={`p-4 rounded-lg ${complianceStats.activeRestrictions > 0 ? 'bg-amber-50' : 'bg-green-50'}`}>\n                                <div className={`flex items-center gap-2 mb-1 ${complianceStats.activeRestrictions > 0 ? 'text-amber-600' : 'text-green-600'}`}>\n                                    <AlertTriangle className=\"w-4 h-4\" />\n                                    <span className=\"text-xs font-medium\">Active Restrictions</span>\n                                </div>\n                                <p className={`text-2xl font-bold ${complianceStats.activeRestrictions > 0 ? 'text-amber-600' : 'text-green-600'}`}>\n                                    {complianceStats.activeRestrictions}\n                                </p>\n                            </div>\n                            <div className=\"p-4 bg-rose-50 rounded-lg\">\n                                <div className=\"flex items-center gap-2 text-rose-600 mb-1\">\n                                    <Shield className=\"w-4 h-4\" />\n                                    <span className=\"text-xs font-medium\">Compliance</span>\n                                </div>\n                                <p className=\"text-2xl font-bold text-rose-600\">{complianceStats.complianceScore}%</p>\n                            </div>\n                        </div>\n\n                        {/* Compliance Checklist */}\n                        <div className=\"bg-gray-50 rounded-lg p-4\">\n                            <h3 className=\"font-semibold text-gray-900 mb-4 flex items-center gap-2\">\n                                <Shield className=\"w-5 h-5 text-rose-600\" />\n                                Regulation 9A Compliance Checklist\n                            </h3>\n                            <div className=\"space-y-3\">\n                                {[\n                                    { label: 'Visiting policy in place and reviewed within 3 months', checked: true },\n                                    { label: 'No blanket visiting restrictions', checked: true },\n                                    { label: 'All restrictions documented with reasons', checked: true },\n                                    { label: 'Alternative arrangements for any restrictions', checked: true },\n                                    { label: 'Restrictions have review dates', checked: true },\n                                    { label: 'Service users consulted on visiting preferences', checked: true },\n                                    { label: 'Flexible visiting hours available', checked: true },\n                                    { label: 'Overnight stays facilitated where appropriate', checked: true }\n                                ].map((item, idx) => (\n                                    <div key={idx} className=\"flex items-center gap-3\">\n                                        <CheckCircle className={`w-5 h-5 ${item.checked ? 'text-green-500' : 'text-gray-300'}`} />\n                                        <span className={item.checked ? 'text-gray-700' : 'text-gray-400'}>{item.label}</span>\n                                    </div>\n                                ))}\n                            </div>\n                        </div>\n\n                        {/* Recent Activity */}\n                        <div>\n                            <h3 className=\"font-semibold text-gray-900 mb-3\">Recent Visits</h3>\n                            <div className=\"space-y-2\">\n                                {visitLogs.slice(0, 3).map(log => (\n                                    <div key={log.id} className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n                                        <div className=\"flex items-center gap-3\">\n                                            <User className=\"w-5 h-5 text-gray-400\" />\n                                            <div>\n                                                <p className=\"font-medium text-gray-900\">{log.visitorName}</p>\n                                                <p className=\"text-sm text-gray-500\">{log.visitDate} at {log.visitTime}</p>\n                                            </div>\n                                        </div>\n                                        <span className={`px-2 py-1 rounded-full text-xs font-medium ${log.visitType === 'in_person' ? 'bg-green-100 text-green-700' :\n                                                log.visitType === 'virtual' ? 'bg-blue-100 text-blue-700' :\n                                                    'bg-purple-100 text-purple-700'\n                                            }`}>\n                                            {log.visitType.replace('_', ' ')}\n                                        </span>\n                                    </div>\n                                ))}\n                            </div>\n                        </div>\n                    </div>\n                )}\n\n                {/* Restrictions Tab */}\n                {activeTab === 'restrictions' && (\n                    <div className=\"space-y-4\">\n                        <div className=\"flex justify-between items-center\">\n                            <h3 className=\"font-semibold text-gray-900\">Active Visiting Restrictions</h3>\n                            <button\n                                onClick={() => setShowAddRestriction(true)}\n                                className=\"px-4 py-2 bg-rose-600 text-white rounded-lg text-sm font-medium hover:bg-rose-700 flex items-center gap-2\"\n                            >\n                                <Plus className=\"w-4 h-4\" />\n                                Add Restriction\n                            </button>\n                        </div>\n\n                        {restrictions.filter(r => r.status === 'active').length === 0 ? (\n                            <div className=\"text-center py-12 bg-green-50 rounded-lg\">\n                                <CheckCircle className=\"w-12 h-12 text-green-500 mx-auto mb-3\" />\n                                <h4 className=\"font-semibold text-green-800\">No Active Restrictions</h4>\n                                <p className=\"text-sm text-green-600 mt-1\">All service users have full visiting rights</p>\n                            </div>\n                        ) : (\n                            <div className=\"space-y-4\">\n                                {restrictions.filter(r => r.status === 'active').map(restriction => (\n                                    <div key={restriction.id} className=\"border border-amber-200 bg-amber-50 rounded-lg p-4\">\n                                        <div className=\"flex items-start justify-between mb-3\">\n                                            <div>\n                                                <h4 className=\"font-semibold text-amber-900\">{restriction.serviceUserName}</h4>\n                                                <p className=\"text-sm text-amber-700\">{restriction.reason}</p>\n                                            </div>\n                                            <span className=\"px-2 py-1 bg-amber-200 text-amber-800 rounded-full text-xs font-medium\">\n                                                {restriction.restrictionType}\n                                            </span>\n                                        </div>\n\n                                        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-3\">\n                                            <div>\n                                                <p className=\"text-amber-600\">Start Date</p>\n                                                <p className=\"font-medium text-amber-900\">{restriction.startDate}</p>\n                                            </div>\n                                            <div>\n                                                <p className=\"text-amber-600\">End Date</p>\n                                                <p className=\"font-medium text-amber-900\">{restriction.endDate || 'Under review'}</p>\n                                            </div>\n                                            <div>\n                                                <p className=\"text-amber-600\">Review Date</p>\n                                                <p className=\"font-medium text-amber-900\">{restriction.reviewDate}</p>\n                                            </div>\n                                            <div>\n                                                <p className=\"text-amber-600\">Approved By</p>\n                                                <p className=\"font-medium text-amber-900\">{restriction.approvedBy}</p>\n                                            </div>\n                                        </div>\n\n                                        <div className=\"bg-white rounded-lg p-3 border border-amber-200\">\n                                            <p className=\"text-xs font-semibold text-amber-700 mb-1\">Alternative Arrangements:</p>\n                                            <p className=\"text-sm text-amber-900\">{restriction.alternativeArrangements}</p>\n                                        </div>\n\n                                        <div className=\"flex gap-2 mt-3\">\n                                            <button className=\"px-3 py-1.5 bg-white border border-amber-300 text-amber-700 rounded text-sm hover:bg-amber-100\">\n                                                <RefreshCcw className=\"w-4 h-4 inline mr-1\" />\n                                                Review\n                                            </button>\n                                            <button className=\"px-3 py-1.5 bg-green-600 text-white rounded text-sm hover:bg-green-700\">\n                                                <CheckCircle className=\"w-4 h-4 inline mr-1\" />\n                                                End Restriction\n                                            </button>\n                                        </div>\n                                    </div>\n                                ))}\n                            </div>\n                        )}\n                    </div>\n                )}\n\n                {/* Visit Log Tab */}\n                {activeTab === 'log' && (\n                    <div>\n                        <div className=\"flex justify-between items-center mb-4\">\n                            <h3 className=\"font-semibold text-gray-900\">Visit Log</h3>\n                            <button className=\"px-4 py-2 bg-rose-600 text-white rounded-lg text-sm font-medium hover:bg-rose-700 flex items-center gap-2\">\n                                <Plus className=\"w-4 h-4\" />\n                                Log Visit\n                            </button>\n                        </div>\n\n                        <div className=\"overflow-x-auto\">\n                            <table className=\"w-full\">\n                                <thead className=\"bg-gray-50\">\n                                    <tr>\n                                        <th className=\"px-4 py-3 text-left text-xs font-semibold text-gray-600\">Date/Time</th>\n                                        <th className=\"px-4 py-3 text-left text-xs font-semibold text-gray-600\">Visitor</th>\n                                        <th className=\"px-4 py-3 text-left text-xs font-semibold text-gray-600\">Type</th>\n                                        <th className=\"px-4 py-3 text-left text-xs font-semibold text-gray-600\">Duration</th>\n                                        <th className=\"px-4 py-3 text-left text-xs font-semibold text-gray-600\">Notes</th>\n                                    </tr>\n                                </thead>\n                                <tbody className=\"divide-y divide-gray-100\">\n                                    {visitLogs.map(log => (\n                                        <tr key={log.id} className=\"hover:bg-gray-50\">\n                                            <td className=\"px-4 py-3 text-sm text-gray-900\">\n                                                {log.visitDate}<br />\n                                                <span className=\"text-gray-500\">{log.visitTime}</span>\n                                            </td>\n                                            <td className=\"px-4 py-3 text-sm text-gray-900\">{log.visitorName}</td>\n                                            <td className=\"px-4 py-3\">\n                                                <span className={`px-2 py-1 rounded-full text-xs font-medium ${log.visitType === 'in_person' ? 'bg-green-100 text-green-700' :\n                                                        log.visitType === 'virtual' ? 'bg-blue-100 text-blue-700' :\n                                                            'bg-purple-100 text-purple-700'\n                                                    }`}>\n                                                    {log.visitType.replace('_', ' ')}\n                                                </span>\n                                            </td>\n                                            <td className=\"px-4 py-3 text-sm text-gray-600\">{log.duration} mins</td>\n                                            <td className=\"px-4 py-3 text-sm text-gray-500\">{log.notes || '-'}</td>\n                                        </tr>\n                                    ))}\n                                </tbody>\n                            </table>\n                        </div>\n                    </div>\n                )}\n\n                {/* Policy Tab */}\n                {activeTab === 'policy' && (\n                    <div className=\"space-y-6\">\n                        {policies.map(policy => (\n                            <div key={policy.id} className=\"border border-gray-200 rounded-lg overflow-hidden\">\n                                <div className=\"p-4 bg-gray-50 border-b border-gray-200 flex items-center justify-between\">\n                                    <div className=\"flex items-center gap-3\">\n                                        <Home className=\"w-5 h-5 text-gray-600\" />\n                                        <h3 className=\"font-semibold text-gray-900\">{policy.locationName}</h3>\n                                    </div>\n                                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${policy.status === 'active' ? 'bg-green-100 text-green-700' :\n                                            'bg-amber-100 text-amber-700'\n                                        }`}>\n                                        {policy.status}\n                                    </span>\n                                </div>\n                                <div className=\"p-4\">\n                                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4\">\n                                        <div>\n                                            <p className=\"text-sm text-gray-500\">Default Hours</p>\n                                            <p className=\"font-medium text-gray-900\">{policy.defaultHours.start} - {policy.defaultHours.end}</p>\n                                        </div>\n                                        <div>\n                                            <p className=\"text-sm text-gray-500\">Flexible Visiting</p>\n                                            <p className={`font-medium ${policy.flexibleVisiting ? 'text-green-600' : 'text-gray-900'}`}>\n                                                {policy.flexibleVisiting ? 'â Yes - 24/7 available' : 'No'}\n                                            </p>\n                                        </div>\n                                        <div>\n                                            <p className=\"text-sm text-gray-500\">Overnight Stays</p>\n                                            <p className={`font-medium ${policy.overnightAllowed ? 'text-green-600' : 'text-gray-900'}`}>\n                                                {policy.overnightAllowed ? 'â Allowed' : 'Not available'}\n                                            </p>\n                                        </div>\n                                        <div>\n                                            <p className=\"text-sm text-gray-500\">Max Visitors</p>\n                                            <p className=\"font-medium text-gray-900\">{policy.maxVisitorsAtOnce} at once</p>\n                                        </div>\n                                    </div>\n                                    <div className=\"flex items-center gap-4 text-sm\">\n                                        <span className=\"text-gray-500\">Last reviewed: {policy.lastReviewDate}</span>\n                                        <span className=\"text-gray-500\">Next review: {policy.nextReviewDate}</span>\n                                        <button className=\"ml-auto px-3 py-1.5 bg-rose-100 text-rose-700 rounded text-sm font-medium hover:bg-rose-200 flex items-center gap-1\">\n                                            <Edit2 className=\"w-4 h-4\" />\n                                            Edit Policy\n                                        </button>\n                                    </div>\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n                )}\n            </div>\n\n            {/* Add Restriction Modal */}\n            {showAddRestriction && (\n                <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n                    <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-lg overflow-hidden\">\n                        <div className=\"p-5 border-b border-gray-200 bg-gradient-to-r from-amber-500 to-orange-500\">\n                            <div className=\"flex items-center justify-between\">\n                                <div className=\"flex items-center gap-3\">\n                                    <AlertTriangle className=\"w-6 h-6 text-white\" />\n                                    <h3 className=\"font-bold text-white\">Add Visiting Restriction</h3>\n                                </div>\n                                <button onClick={() => setShowAddRestriction(false)} className=\"text-white/80 hover:text-white\">\n                                    <X className=\"w-5 h-5\" />\n                                </button>\n                            </div>\n                        </div>\n\n                        <div className=\"p-5 space-y-4\">\n                            <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-3\">\n                                <p className=\"text-sm text-amber-800\">\n                                    <AlertCircle className=\"w-4 h-4 inline mr-1\" />\n                                    Restrictions must be proportionate, time-limited, and documented.\n                                    Alternative arrangements are mandatory under Regulation 9A.\n                                </p>\n                            </div>\n\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Service User Name *</label>\n                                <input\n                                    type=\"text\"\n                                    value={newRestriction.serviceUserName}\n                                    onChange={(e) => setNewRestriction(prev => ({ ...prev, serviceUserName: e.target.value }))}\n                                    className=\"w-full rounded-lg border-gray-300 shadow-sm focus:border-rose-500 focus:ring-rose-500\"\n                                    placeholder=\"Enter service user name\"\n                                />\n                            </div>\n\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Reason Category *</label>\n                                <select\n                                    value={newRestriction.reasonCategory}\n                                    onChange={(e) => setNewRestriction(prev => ({ ...prev, reasonCategory: e.target.value }))}\n                                    className=\"w-full rounded-lg border-gray-300 shadow-sm focus:border-rose-500 focus:ring-rose-500\"\n                                >\n                                    {RESTRICTION_REASONS.map(reason => (\n                                        <option key={reason.value} value={reason.value}>{reason.label}</option>\n                                    ))}\n                                </select>\n                            </div>\n\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Detailed Reason *</label>\n                                <textarea\n                                    value={newRestriction.reason}\n                                    onChange={(e) => setNewRestriction(prev => ({ ...prev, reason: e.target.value }))}\n                                    rows={2}\n                                    className=\"w-full rounded-lg border-gray-300 shadow-sm focus:border-rose-500 focus:ring-rose-500\"\n                                    placeholder=\"Provide specific details...\"\n                                />\n                            </div>\n\n                            <div className=\"grid grid-cols-2 gap-4\">\n                                <div>\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Start Date</label>\n                                    <input\n                                        type=\"date\"\n                                        value={newRestriction.startDate}\n                                        onChange={(e) => setNewRestriction(prev => ({ ...prev, startDate: e.target.value }))}\n                                        className=\"w-full rounded-lg border-gray-300 shadow-sm focus:border-rose-500 focus:ring-rose-500\"\n                                    />\n                                </div>\n                                <div>\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">End Date</label>\n                                    <input\n                                        type=\"date\"\n                                        value={newRestriction.endDate}\n                                        onChange={(e) => setNewRestriction(prev => ({ ...prev, endDate: e.target.value }))}\n                                        className=\"w-full rounded-lg border-gray-300 shadow-sm focus:border-rose-500 focus:ring-rose-500\"\n                                    />\n                                </div>\n                            </div>\n\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Alternative Arrangements * (Required)</label>\n                                <textarea\n                                    value={newRestriction.alternativeArrangements}\n                                    onChange={(e) => setNewRestriction(prev => ({ ...prev, alternativeArrangements: e.target.value }))}\n                                    rows={2}\n                                    className=\"w-full rounded-lg border-gray-300 shadow-sm focus:border-rose-500 focus:ring-rose-500\"\n                                    placeholder=\"e.g., Video calls, window visits, outdoor meetings...\"\n                                />\n                            </div>\n                        </div>\n\n                        <div className=\"p-5 border-t border-gray-200 bg-gray-50 flex justify-end gap-3\">\n                            <button\n                                onClick={() => setShowAddRestriction(false)}\n                                className=\"px-4 py-2 bg-white text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50\"\n                            >\n                                Cancel\n                            </button>\n                            <button\n                                onClick={handleAddRestriction}\n                                className=\"px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 flex items-center gap-2\"\n                            >\n                                <Shield className=\"w-4 h-4\" />\n                                Add Restriction\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/WelcomeDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'supabase' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'parseISO' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'differenceInDays' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isSameDay' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":98,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":107},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'currentTenant' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":19,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setStats' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":22,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { useTenant } from '@/contexts/TenantContext';\nimport {\n    Sun, Moon, Sparkles, TrendingUp, Calendar, Clock,\n    Bell, CheckCircle, AlertTriangle, ChevronRight, User\n} from 'lucide-react';\nimport { format, parseISO, differenceInDays, isToday, startOfWeek, endOfWeek, eachDayOfInterval, isSameDay } from 'date-fns';\nimport { getInitials } from '@/lib/utils';\n\ninterface WelcomeDashboardProps {\n    userName?: string;\n    avatarUrl?: string;\n}\n\nexport default function WelcomeDashboard({ userName, avatarUrl }: WelcomeDashboardProps) {\n    const { user, profile } = useAuth();\n    const { currentTenant } = useTenant();\n    const [greeting, setGreeting] = useState('');\n    const [quote, setQuote] = useState({ text: '', author: '' });\n    const [stats, setStats] = useState({\n        pendingTasks: 5,\n        upcomingMeetings: 3,\n        unreadNotifications: 7,\n        completedToday: 2,\n    });\n    const [todayEvents, setTodayEvents] = useState<Array<{\n        id: string;\n        title: string;\n        time: string;\n        type: 'meeting' | 'interview' | 'deadline' | 'training';\n    }>>([]);\n\n    useEffect(() => {\n        updateGreeting();\n        loadQuote();\n        loadTodayEvents();\n    }, []);\n\n    function updateGreeting() {\n        const hour = new Date().getHours();\n        if (hour < 12) {\n            setGreeting('Good morning');\n        } else if (hour < 17) {\n            setGreeting('Good afternoon');\n        } else {\n            setGreeting('Good evening');\n        }\n    }\n\n    function loadQuote() {\n        const quotes = [\n            { text: \"The only way to do great work is to love what you do.\", author: \"Steve Jobs\" },\n            { text: \"Success is not final, failure is not fatal: it is the courage to continue that counts.\", author: \"Winston Churchill\" },\n            { text: \"Coming together is a beginning, staying together is progress, working together is success.\", author: \"Henry Ford\" },\n            { text: \"Talent wins games, but teamwork and intelligence win championships.\", author: \"Michael Jordan\" },\n            { text: \"The strength of the team is each individual member. The strength of each member is the team.\", author: \"Phil Jackson\" },\n        ];\n        setQuote(quotes[Math.floor(Math.random() * quotes.length)]);\n    }\n\n    function loadTodayEvents() {\n        // Mock events\n        setTodayEvents([\n            { id: '1', title: 'Team Standup', time: '09:30', type: 'meeting' },\n            { id: '2', title: 'Interview with Sarah J.', time: '11:00', type: 'interview' },\n            { id: '3', title: 'Project deadline', time: '17:00', type: 'deadline' },\n            { id: '4', title: 'Fire Safety Training', time: '14:00', type: 'training' },\n        ]);\n    }\n\n    function getTimeIcon() {\n        const hour = new Date().getHours();\n        if (hour >= 6 && hour < 18) {\n            return <Sun className=\"w-6 h-6 text-yellow-500\" />;\n        }\n        return <Moon className=\"w-6 h-6 text-indigo-400\" />;\n    }\n\n    function getEventColor(type: string) {\n        switch (type) {\n            case 'meeting': return 'border-blue-400 bg-blue-50';\n            case 'interview': return 'border-purple-400 bg-purple-50';\n            case 'deadline': return 'border-red-400 bg-red-50';\n            case 'training': return 'border-green-400 bg-green-50';\n            default: return 'border-gray-400 bg-gray-50';\n        }\n    }\n\n    const displayName = userName || profile?.full_name || user?.email?.split('@')[0] || 'there';\n    const today = new Date();\n    const weekDays = eachDayOfInterval({\n        start: startOfWeek(today, { weekStartsOn: 1 }),\n        end: endOfWeek(today, { weekStartsOn: 1 })\n    });\n\n    return (\n        <div className=\"space-y-6\">\n            {/* Welcome Header */}\n            <div className=\"bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-500 rounded-2xl p-6 text-white relative overflow-hidden\">\n                {/* Decorative elements */}\n                <div className=\"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -translate-y-32 translate-x-32\" />\n                <div className=\"absolute bottom-0 left-0 w-48 h-48 bg-white/5 rounded-full translate-y-24 -translate-x-24\" />\n\n                <div className=\"relative z-10 flex items-start justify-between\">\n                    <div>\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                            {getTimeIcon()}\n                            <span className=\"text-indigo-200 text-sm\">{format(today, 'EEEE, MMMM d, yyyy')}</span>\n                        </div>\n                        <h1 className=\"text-3xl font-bold mb-2\">\n                            {greeting}, <span className=\"text-transparent bg-clip-text bg-gradient-to-r from-white to-pink-200\">{displayName}</span>!\n                            <Sparkles className=\"inline w-6 h-6 ml-2 text-yellow-300\" />\n                        </h1>\n                        <p className=\"text-indigo-200 max-w-lg\">\n                            \"{quote.text}\" â <span className=\"italic\">{quote.author}</span>\n                        </p>\n                    </div>\n\n                    {/* Avatar */}\n                    <div className=\"relative\">\n                        {avatarUrl ? (\n                            <img src={avatarUrl} alt=\"\" className=\"w-16 h-16 rounded-full border-4 border-white/30\" />\n                        ) : (\n                            <div className=\"w-16 h-16 rounded-full bg-white/20 flex items-center justify-center text-white text-xl font-bold border-4 border-white/30\">\n                                {getInitials(displayName)}\n                            </div>\n                        )}\n                        <div className=\"absolute -bottom-1 -right-1 w-5 h-5 bg-green-500 rounded-full border-2 border-white\" />\n                    </div>\n                </div>\n\n                {/* Mini Week View */}\n                <div className=\"relative z-10 mt-6 flex justify-between\">\n                    {weekDays.map((day, i) => (\n                        <div\n                            key={i}\n                            className={`flex flex-col items-center px-3 py-2 rounded-lg ${isToday(day) ? 'bg-white/20' : ''\n                                }`}\n                        >\n                            <span className=\"text-xs text-indigo-200\">{format(day, 'EEE')}</span>\n                            <span className={`text-lg font-semibold ${isToday(day) ? 'text-white' : 'text-indigo-200'}`}>\n                                {format(day, 'd')}\n                            </span>\n                        </div>\n                    ))}\n                </div>\n            </div>\n\n            {/* Quick Stats */}\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                <div className=\"bg-white rounded-xl border border-gray-200 p-4\">\n                    <div className=\"flex items-center justify-between\">\n                        <div>\n                            <p className=\"text-sm text-gray-600\">Pending Tasks</p>\n                            <p className=\"text-2xl font-bold text-orange-600\">{stats.pendingTasks}</p>\n                        </div>\n                        <div className=\"p-3 bg-orange-100 rounded-lg\">\n                            <AlertTriangle className=\"w-5 h-5 text-orange-600\" />\n                        </div>\n                    </div>\n                </div>\n                <div className=\"bg-white rounded-xl border border-gray-200 p-4\">\n                    <div className=\"flex items-center justify-between\">\n                        <div>\n                            <p className=\"text-sm text-gray-600\">Meetings Today</p>\n                            <p className=\"text-2xl font-bold text-blue-600\">{stats.upcomingMeetings}</p>\n                        </div>\n                        <div className=\"p-3 bg-blue-100 rounded-lg\">\n                            <Calendar className=\"w-5 h-5 text-blue-600\" />\n                        </div>\n                    </div>\n                </div>\n                <div className=\"bg-white rounded-xl border border-gray-200 p-4\">\n                    <div className=\"flex items-center justify-between\">\n                        <div>\n                            <p className=\"text-sm text-gray-600\">Notifications</p>\n                            <p className=\"text-2xl font-bold text-purple-600\">{stats.unreadNotifications}</p>\n                        </div>\n                        <div className=\"p-3 bg-purple-100 rounded-lg\">\n                            <Bell className=\"w-5 h-5 text-purple-600\" />\n                        </div>\n                    </div>\n                </div>\n                <div className=\"bg-white rounded-xl border border-gray-200 p-4\">\n                    <div className=\"flex items-center justify-between\">\n                        <div>\n                            <p className=\"text-sm text-gray-600\">Completed Today</p>\n                            <p className=\"text-2xl font-bold text-green-600\">{stats.completedToday}</p>\n                        </div>\n                        <div className=\"p-3 bg-green-100 rounded-lg\">\n                            <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            {/* Today's Schedule */}\n            <div className=\"bg-white rounded-xl border border-gray-200 overflow-hidden\">\n                <div className=\"px-6 py-4 border-b border-gray-200 flex items-center justify-between\">\n                    <div className=\"flex items-center space-x-2\">\n                        <Clock className=\"w-5 h-5 text-indigo-600\" />\n                        <h2 className=\"font-semibold text-gray-900\">Today's Schedule</h2>\n                    </div>\n                    <span className=\"text-sm text-gray-500\">{format(today, 'EEEE')}</span>\n                </div>\n\n                <div className=\"p-4\">\n                    {todayEvents.length === 0 ? (\n                        <p className=\"text-center text-gray-500 py-8\">No events scheduled for today</p>\n                    ) : (\n                        <div className=\"space-y-3\">\n                            {todayEvents.map(event => (\n                                <div\n                                    key={event.id}\n                                    className={`flex items-center p-3 rounded-lg border-l-4 ${getEventColor(event.type)}`}\n                                >\n                                    <div className=\"flex-shrink-0 w-16\">\n                                        <span className=\"text-sm font-semibold text-gray-900\">{event.time}</span>\n                                    </div>\n                                    <div className=\"flex-1 min-w-0\">\n                                        <p className=\"text-sm font-medium text-gray-900\">{event.title}</p>\n                                        <p className=\"text-xs text-gray-500 capitalize\">{event.type}</p>\n                                    </div>\n                                    <ChevronRight className=\"w-4 h-4 text-gray-400\" />\n                                </div>\n                            ))}\n                        </div>\n                    )}\n                </div>\n            </div>\n\n            {/* Quick Links */}\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n                {[\n                    { label: 'Clock In', icon: <Clock className=\"w-5 h-5\" />, color: 'bg-green-100 text-green-700 hover:bg-green-200', href: '/attendance' },\n                    { label: 'Request Leave', icon: <Calendar className=\"w-5 h-5\" />, color: 'bg-blue-100 text-blue-700 hover:bg-blue-200', href: '/hr' },\n                    { label: 'My Documents', icon: <User className=\"w-5 h-5\" />, color: 'bg-purple-100 text-purple-700 hover:bg-purple-200', href: '/documents' },\n                    { label: 'View Payslip', icon: <TrendingUp className=\"w-5 h-5\" />, color: 'bg-orange-100 text-orange-700 hover:bg-orange-200', href: '/hr' },\n                ].map((link, i) => (\n                    <a\n                        key={i}\n                        href={link.href}\n                        className={`flex items-center justify-center space-x-2 p-4 rounded-xl transition ${link.color}`}\n                    >\n                        {link.icon}\n                        <span className=\"font-medium\">{link.label}</span>\n                    </a>\n                ))}\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/WorkflowEditor.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Save' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronRight' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":66},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Check' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":68,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":73},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":75,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":76},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":99,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":107},{"ruleId":"prefer-const","severity":2,"message":"'newAutomations' is never reassigned. Use 'const' instead.","line":253,"column":21,"nodeType":"Identifier","messageId":"useConst","endLine":253,"endColumn":35,"fix":{"range":[9671,9723],"text":"const newAutomations = [...(stage.automations || [])];"}}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { Plus, Trash2, Save, GripVertical, Settings, ChevronRight, Check, X, Mail, Calendar, Bot, FileText } from 'lucide-react';\nimport { DragDropContext, Droppable, Draggable } from '@hello-pangea/dnd';\nimport { log } from '@/lib/logger';\n\ninterface Stage {\n    id: string;\n    name: string;\n    stage_type: string;\n    stage_order: number;\n    is_system_stage: boolean;\n    automations?: Automation[];\n}\n\ninterface Automation {\n    id: string;\n    stage_id?: string;\n    name: string;\n    trigger_event: 'on_enter' | 'on_exit';\n    action_type: 'send_email' | 'schedule_interview' | 'create_task' | 'update_status' | 'ai_interview';\n    action_config: any;\n    is_active: boolean;\n}\n\ninterface Workflow {\n    id: string;\n    name: string;\n    description: string;\n    is_active: boolean;\n    is_default: boolean;\n}\n\ninterface WorkflowEditorProps {\n    workflowId?: string;\n    onSave?: () => void;\n    onCancel?: () => void;\n}\n\nimport { useAuth } from '@/contexts/AuthContext';\n\nexport default function WorkflowEditor({ workflowId, onSave, onCancel }: WorkflowEditorProps) {\n    const { user } = useAuth();\n    const [workflow, setWorkflow] = useState<Workflow>({\n        id: '',\n        name: '',\n        description: '',\n        is_active: true,\n        is_default: false\n    });\n    const [stages, setStages] = useState<Stage[]>([]);\n    const [loading, setLoading] = useState(false);\n    const [saving, setSaving] = useState(false);\n    const [activeStageId, setActiveStageId] = useState<string | null>(null);\n    const [editingAutomation, setEditingAutomation] = useState<Automation | null>(null);\n\n    useEffect(() => {\n        if (workflowId) {\n            loadWorkflow(workflowId);\n        } else {\n            // Initialize with default stages for new workflow\n            setStages([\n                { id: 'temp-1', name: 'Applied', stage_type: 'applied', stage_order: 1, is_system_stage: true, automations: [] },\n                { id: 'temp-2', name: 'Screening', stage_type: 'screening', stage_order: 2, is_system_stage: false, automations: [] },\n                { id: 'temp-3', name: 'Interview', stage_type: 'interview', stage_order: 3, is_system_stage: false, automations: [] },\n                { id: 'temp-4', name: 'Offer', stage_type: 'offer', stage_order: 4, is_system_stage: false, automations: [] },\n                { id: 'temp-5', name: 'Hired', stage_type: 'hired', stage_order: 5, is_system_stage: true, automations: [] },\n                { id: 'temp-6', name: 'Rejected', stage_type: 'rejected', stage_order: 6, is_system_stage: true, automations: [] }\n            ]);\n        }\n    }, [workflowId]);\n\n    async function loadWorkflow(id: string) {\n        setLoading(true);\n        try {\n            // Load Workflow Details\n            const { data: wfData, error: wfError } = await supabase\n                .from('recruitment_workflows')\n                .select('*')\n                .eq('id', id)\n                .single();\n\n            if (wfError) throw wfError;\n            setWorkflow(wfData);\n\n            // Load Stages\n            const { data: stageData, error: stageError } = await supabase\n                .from('workflow_stages')\n                .select('*, stage_automations(*)')\n                .eq('workflow_id', id)\n                .order('stage_order');\n\n            if (stageError) throw stageError;\n\n            // Transform data to include automations in the stage object\n            const stagesWithAutomations = stageData.map((stage: any) => ({\n                ...stage,\n                automations: stage.stage_automations || []\n            }));\n\n            setStages(stagesWithAutomations);\n        } catch (error: any) {\n            log.error('Error loading workflow', error, { component: 'WorkflowEditor', action: 'loadWorkflow' });\n            alert(`Error loading workflow: ${error.message}`);\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    async function handleSave() {\n        setSaving(true);\n        try {\n            let currentWorkflowId = workflowId;\n\n            // 1. Save Workflow\n            if (!currentWorkflowId) {\n                const { data, error } = await supabase\n                    .from('recruitment_workflows')\n                    .insert([{\n                        name: workflow.name,\n                        description: workflow.description,\n                        is_active: workflow.is_active,\n                        is_default: workflow.is_default,\n                        created_by: user?.id\n                    }])\n                    .select()\n                    .single();\n\n                if (error) throw error;\n                currentWorkflowId = data.id;\n            } else {\n                const { error } = await supabase\n                    .from('recruitment_workflows')\n                    .update({\n                        name: workflow.name,\n                        description: workflow.description,\n                        is_active: workflow.is_active,\n                        is_default: workflow.is_default\n                    })\n                    .eq('id', currentWorkflowId);\n\n                if (error) throw error;\n            }\n\n            // 2. Save Stages\n            const stagesToUpsert = stages.map((stage, index) => ({\n                id: stage.id.startsWith('temp-') ? undefined : stage.id,\n                workflow_id: currentWorkflowId,\n                name: stage.name,\n                stage_type: stage.stage_type,\n                stage_order: index + 1,\n                is_system_stage: stage.is_system_stage\n            }));\n\n            const { data: savedStages, error: stagesError } = await supabase\n                .from('workflow_stages')\n                .upsert(stagesToUpsert)\n                .select();\n\n            if (stagesError) throw stagesError;\n\n            // 3. Save Automations\n            // We need to map the saved stages back to our local stages to get the correct stage_ids for automations\n            // This is tricky if we have new stages. \n            // Strategy: Delete all automations for these stages and re-insert? No, bad for logs.\n            // Better: Match by name/order? \n            // Since we just saved stages, we can try to map them.\n\n            // For simplicity in this iteration: We will loop through the saved stages, find the corresponding local stage (by name/order),\n            // and then upsert its automations.\n\n            for (const savedStage of savedStages) {\n                const localStage = stages.find(s => s.name === savedStage.name && s.stage_type === savedStage.stage_type);\n                if (localStage && localStage.automations && localStage.automations.length > 0) {\n                    const automationsToUpsert = localStage.automations.map(auto => ({\n                        id: auto.id.startsWith('temp-') ? undefined : auto.id,\n                        stage_id: savedStage.id,\n                        name: auto.name,\n                        trigger_event: auto.trigger_event,\n                        action_type: auto.action_type,\n                        action_config: auto.action_config,\n                        is_active: auto.is_active\n                    }));\n\n                    const { error: autoError } = await supabase\n                        .from('stage_automations')\n                        .upsert(automationsToUpsert);\n\n                    if (autoError) {\n                        log.error('Error saving automations for stage', autoError, { component: 'WorkflowEditor', action: 'handleSave', metadata: { stageName: savedStage.name } });\n                        throw autoError;\n                    }\n                }\n            }\n\n            if (onSave) onSave();\n        } catch (error: any) {\n            log.error('Error saving workflow', error, { component: 'WorkflowEditor', action: 'handleSave' });\n            alert(`Failed to save workflow: ${error.message || JSON.stringify(error)}`);\n        } finally {\n            setSaving(false);\n        }\n    }\n\n    const handleDragEnd = (result: any) => {\n        if (!result.destination) return;\n\n        const items = Array.from(stages);\n        const [reorderedItem] = items.splice(result.source.index, 1);\n        items.splice(result.destination.index, 0, reorderedItem);\n\n        setStages(items);\n    };\n\n    const addStage = () => {\n        const newStage: Stage = {\n            id: `temp-${Date.now()}`,\n            name: 'New Stage',\n            stage_type: 'custom',\n            stage_order: stages.length + 1,\n            is_system_stage: false,\n            automations: []\n        };\n        const insertIndex = Math.max(0, stages.length - 2);\n        const newStages = [...stages];\n        newStages.splice(insertIndex, 0, newStage);\n        setStages(newStages);\n    };\n\n    const removeStage = (index: number) => {\n        const newStages = [...stages];\n        newStages.splice(index, 1);\n        setStages(newStages);\n    };\n\n    const handleAddAutomation = () => {\n        setEditingAutomation({\n            id: `temp-auto-${Date.now()}`,\n            name: 'New Automation',\n            trigger_event: 'on_enter',\n            action_type: 'send_email',\n            action_config: {},\n            is_active: true\n        });\n    };\n\n    const handleSaveAutomation = () => {\n        if (!editingAutomation || !activeStageId) return;\n\n        const newStages = stages.map(stage => {\n            if (stage.id === activeStageId) {\n                const existingAutoIndex = stage.automations?.findIndex(a => a.id === editingAutomation.id);\n                let newAutomations = [...(stage.automations || [])];\n\n                if (existingAutoIndex !== undefined && existingAutoIndex >= 0) {\n                    newAutomations[existingAutoIndex] = editingAutomation;\n                } else {\n                    newAutomations.push(editingAutomation);\n                }\n                return { ...stage, automations: newAutomations };\n            }\n            return stage;\n        });\n\n        setStages(newStages);\n        setEditingAutomation(null);\n    };\n\n    const handleDeleteAutomation = (automationId: string) => {\n        if (!activeStageId) return;\n\n        const newStages = stages.map(stage => {\n            if (stage.id === activeStageId) {\n                return {\n                    ...stage,\n                    automations: stage.automations?.filter(a => a.id !== automationId)\n                };\n            }\n            return stage;\n        });\n        setStages(newStages);\n    };\n\n    if (loading) return <div>Loading...</div>;\n\n    const activeStage = stages.find(s => s.id === activeStageId);\n\n    return (\n        <div className=\"bg-white rounded-lg shadow p-6\">\n            <div className=\"mb-6\">\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Workflow Name</label>\n                <input\n                    type=\"text\"\n                    value={workflow.name}\n                    onChange={(e) => setWorkflow({ ...workflow, name: e.target.value })}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\"\n                    placeholder=\"e.g., Technical Hiring Pipeline\"\n                />\n            </div>\n\n            <div className=\"mb-6\">\n                <div className=\"flex justify-between items-center mb-4\">\n                    <h3 className=\"text-lg font-medium text-gray-900\">Pipeline Stages</h3>\n                    <button\n                        onClick={addStage}\n                        className=\"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200\"\n                    >\n                        <Plus className=\"w-4 h-4 mr-1\" />\n                        Add Stage\n                    </button>\n                </div>\n\n                <DragDropContext onDragEnd={handleDragEnd}>\n                    <Droppable droppableId=\"stages\">\n                        {(provided) => (\n                            <div {...provided.droppableProps} ref={provided.innerRef} className=\"space-y-2\">\n                                {stages.map((stage, index) => (\n                                    <Draggable key={stage.id} draggableId={stage.id} index={index} isDragDisabled={stage.is_system_stage}>\n                                        {(provided) => (\n                                            <div\n                                                ref={provided.innerRef}\n                                                {...provided.draggableProps}\n                                                className={`flex items-center p-3 bg-gray-50 border rounded-lg ${activeStageId === stage.id ? 'border-indigo-500 ring-1 ring-indigo-500' : 'border-gray-200'\n                                                    }`}\n                                            >\n                                                <div {...provided.dragHandleProps} className=\"mr-3 text-gray-400 cursor-move\">\n                                                    <GripVertical className=\"w-5 h-5\" />\n                                                </div>\n                                                <div className=\"flex-1\">\n                                                    <input\n                                                        type=\"text\"\n                                                        value={stage.name}\n                                                        onChange={(e) => {\n                                                            const newStages = [...stages];\n                                                            newStages[index].name = e.target.value;\n                                                            setStages(newStages);\n                                                        }}\n                                                        disabled={stage.is_system_stage}\n                                                        className=\"block w-full border-0 p-0 text-gray-900 placeholder-gray-500 focus:ring-0 sm:text-sm bg-transparent\"\n                                                    />\n                                                </div>\n                                                <div className=\"flex items-center space-x-2\">\n                                                    <button\n                                                        onClick={() => setActiveStageId(activeStageId === stage.id ? null : stage.id)}\n                                                        className={`p-1 rounded ${activeStageId === stage.id ? 'text-indigo-600 bg-indigo-50' : 'text-gray-400 hover:text-gray-600'}`}\n                                                        title=\"Configure Automations\"\n                                                    >\n                                                        <Settings className=\"w-4 h-4\" />\n                                                    </button>\n                                                    {!stage.is_system_stage && (\n                                                        <button\n                                                            onClick={() => removeStage(index)}\n                                                            className=\"p-1 text-red-400 hover:text-red-600\"\n                                                        >\n                                                            <Trash2 className=\"w-4 h-4\" />\n                                                        </button>\n                                                    )}\n                                                </div>\n                                            </div>\n                                        )}\n                                    </Draggable>\n                                ))}\n                                {provided.placeholder}\n                            </div>\n                        )}\n                    </Droppable>\n                </DragDropContext>\n            </div>\n\n            {activeStage && (\n                <div className=\"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200\">\n                    <div className=\"flex justify-between items-center mb-4\">\n                        <h4 className=\"text-sm font-medium text-gray-900\">\n                            Automations for \"{activeStage.name}\"\n                        </h4>\n                        {!editingAutomation && (\n                            <button\n                                onClick={handleAddAutomation}\n                                className=\"text-xs text-indigo-600 hover:text-indigo-800 font-medium flex items-center\"\n                            >\n                                <Plus className=\"w-3 h-3 mr-1\" />\n                                Add Automation\n                            </button>\n                        )}\n                    </div>\n\n                    {editingAutomation ? (\n                        <div className=\"bg-white p-4 rounded-md border border-gray-200 shadow-sm\">\n                            <div className=\"grid grid-cols-1 gap-4 mb-4\">\n                                <div>\n                                    <label className=\"block text-xs font-medium text-gray-700 mb-1\">Automation Name</label>\n                                    <input\n                                        type=\"text\"\n                                        value={editingAutomation.name}\n                                        onChange={(e) => setEditingAutomation({ ...editingAutomation, name: e.target.value })}\n                                        className=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-indigo-500 focus:border-indigo-500\"\n                                    />\n                                </div>\n                                <div className=\"grid grid-cols-2 gap-4\">\n                                    <div>\n                                        <label className=\"block text-xs font-medium text-gray-700 mb-1\">Trigger</label>\n                                        <select\n                                            value={editingAutomation.trigger_event}\n                                            onChange={(e) => setEditingAutomation({ ...editingAutomation, trigger_event: e.target.value as any })}\n                                            className=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-indigo-500 focus:border-indigo-500\"\n                                        >\n                                            <option value=\"on_enter\">When entering stage</option>\n                                            <option value=\"on_exit\">When leaving stage</option>\n                                        </select>\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-medium text-gray-700 mb-1\">Action</label>\n                                        <select\n                                            value={editingAutomation.action_type}\n                                            onChange={(e) => setEditingAutomation({ ...editingAutomation, action_type: e.target.value as any })}\n                                            className=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-indigo-500 focus:border-indigo-500\"\n                                        >\n                                            <option value=\"send_email\">Send Email</option>\n                                            <option value=\"schedule_interview\">Schedule Interview</option>\n                                            <option value=\"ai_interview\">Start AI Interview</option>\n                                            <option value=\"create_task\">Create Task</option>\n                                        </select>\n                                    </div>\n                                </div>\n\n                                {/* Dynamic Configuration based on Action Type */}\n                                {editingAutomation.action_type === 'send_email' && (\n                                    <div>\n                                        <label className=\"block text-xs font-medium text-gray-700 mb-1\">Email Template ID</label>\n                                        <input\n                                            type=\"text\"\n                                            value={editingAutomation.action_config.template_id || ''}\n                                            onChange={(e) => setEditingAutomation({\n                                                ...editingAutomation,\n                                                action_config: { ...editingAutomation.action_config, template_id: e.target.value }\n                                            })}\n                                            className=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm\"\n                                            placeholder=\"e.g., interview_invite\"\n                                        />\n                                    </div>\n                                )}\n                                {editingAutomation.action_type === 'schedule_interview' && (\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                                        <div>\n                                            <label className=\"block text-xs font-medium text-gray-700 mb-1\">Interview Type</label>\n                                            <select\n                                                value={editingAutomation.action_config.interview_type || ''}\n                                                onChange={(e) => setEditingAutomation({\n                                                    ...editingAutomation,\n                                                    action_config: { ...editingAutomation.action_config, interview_type: e.target.value }\n                                                })}\n                                                className=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-indigo-500 focus:border-indigo-500\"\n                                            >\n                                                <option value=\"\">Select Type</option>\n                                                <option value=\"phone\">Phone</option>\n                                                <option value=\"video\">Video</option>\n                                                <option value=\"on-site\">On-site</option>\n                                            </select>\n                                        </div>\n                                        <div>\n                                            <label className=\"block text-xs font-medium text-gray-700 mb-1\">Duration (minutes)</label>\n                                            <input\n                                                type=\"number\"\n                                                value={editingAutomation.action_config.duration || ''}\n                                                onChange={(e) => setEditingAutomation({\n                                                    ...editingAutomation,\n                                                    action_config: { ...editingAutomation.action_config, duration: parseInt(e.target.value) || 0 }\n                                                })}\n                                                className=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm\"\n                                                placeholder=\"e.g., 30\"\n                                            />\n                                        </div>\n                                        <div>\n                                            <label className=\"block text-xs font-medium text-gray-700 mb-1\">Interviewer Role</label>\n                                            <input\n                                                type=\"text\"\n                                                value={editingAutomation.action_config.interviewer_role || ''}\n                                                onChange={(e) => setEditingAutomation({\n                                                    ...editingAutomation,\n                                                    action_config: { ...editingAutomation.action_config, interviewer_role: e.target.value }\n                                                })}\n                                                className=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm\"\n                                                placeholder=\"e.g., Hiring Manager\"\n                                            />\n                                        </div>\n                                        <div>\n                                            <label className=\"block text-xs font-medium text-gray-700 mb-1\">Invitation Email Template ID</label>\n                                            <input\n                                                type=\"text\"\n                                                value={editingAutomation.action_config.template_id || ''}\n                                                onChange={(e) => setEditingAutomation({\n                                                    ...editingAutomation,\n                                                    action_config: { ...editingAutomation.action_config, template_id: e.target.value }\n                                                })}\n                                                className=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm\"\n                                                placeholder=\"e.g., interview_invite_template\"\n                                            />\n                                        </div>\n                                    </div>\n                                )}\n                            </div>\n                            <div className=\"flex justify-end space-x-2\">\n                                <button\n                                    onClick={() => setEditingAutomation(null)}\n                                    className=\"px-3 py-1.5 border border-gray-300 rounded-md text-xs font-medium text-gray-700 hover:bg-gray-50\"\n                                >\n                                    Cancel\n                                </button>\n                                <button\n                                    onClick={handleSaveAutomation}\n                                    className=\"px-3 py-1.5 bg-indigo-600 text-white rounded-md text-xs font-medium hover:bg-indigo-700\"\n                                >\n                                    Save Automation\n                                </button>\n                            </div>\n                        </div>\n                    ) : (\n                        <div className=\"space-y-3\">\n                            {activeStage.automations && activeStage.automations.length > 0 ? (\n                                activeStage.automations.map((auto) => (\n                                    <div key={auto.id} className=\"flex items-center justify-between p-3 bg-white border border-gray-200 rounded-md\">\n                                        <div className=\"flex items-center\">\n                                            <div className={`h-8 w-8 rounded-full flex items-center justify-center mr-3 ${auto.action_type === 'send_email' ? 'bg-blue-100 text-blue-600' :\n                                                auto.action_type === 'ai_interview' ? 'bg-purple-100 text-purple-600' :\n                                                    auto.action_type === 'schedule_interview' ? 'bg-green-100 text-green-600' :\n                                                        'bg-gray-100 text-gray-600'\n                                                }`}>\n                                                {auto.action_type === 'send_email' ? <Mail className=\"w-4 h-4\" /> :\n                                                    auto.action_type === 'ai_interview' ? <Bot className=\"w-4 h-4\" /> :\n                                                        auto.action_type === 'schedule_interview' ? <Calendar className=\"w-4 h-4\" /> :\n                                                            <Settings className=\"w-4 h-4\" />}\n                                            </div>\n                                            <div>\n                                                <p className=\"text-sm font-medium text-gray-900\">{auto.name}</p>\n                                                <p className=\"text-xs text-gray-500\">\n                                                    {auto.trigger_event === 'on_enter' ? 'On Enter' : 'On Exit'} â¢ {auto.action_type.replace('_', ' ')}\n                                                </p>\n                                            </div>\n                                        </div>\n                                        <div className=\"flex items-center space-x-2\">\n                                            <button\n                                                onClick={() => setEditingAutomation(auto)}\n                                                className=\"text-indigo-600 text-xs font-medium hover:text-indigo-800\"\n                                            >\n                                                Edit\n                                            </button>\n                                            <button\n                                                onClick={() => handleDeleteAutomation(auto.id)}\n                                                className=\"text-red-600 text-xs font-medium hover:text-red-800\"\n                                            >\n                                                <Trash2 className=\"w-3 h-3\" />\n                                            </button>\n                                        </div>\n                                    </div>\n                                ))\n                            ) : (\n                                <div className=\"text-center py-6 text-gray-500 bg-white rounded-md border border-dashed border-gray-300\">\n                                    <p className=\"text-sm\">No automations configured for this stage.</p>\n                                </div>\n                            )}\n                        </div>\n                    )}\n                </div>\n            )}\n\n            <div className=\"flex justify-end space-x-3 pt-4 border-t border-gray-200\">\n                <button\n                    onClick={onCancel}\n                    className=\"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50\"\n                >\n                    Cancel\n                </button>\n                <button\n                    onClick={handleSave}\n                    disabled={saving}\n                    className=\"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50\"\n                >\n                    {saving ? 'Saving...' : 'Save Workflow'}\n                </button>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/__tests__/TimeClock.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/admin/EditTenantModal.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTenantDetails'. Either include it or remove the dependency array.","line":37,"column":8,"nodeType":"ArrayExpression","endLine":37,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [tenant, isOpen, fetchTenantDetails]","fix":{"range":[1168,1184],"text":"[tenant, isOpen, fetchTenantDetails]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport { X, Save, Loader2, CreditCard, Activity, Settings } from 'lucide-react';\n\ninterface EditTenantModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    tenant: any;\n    onSuccess: () => void;\n}\n\nexport default function EditTenantModal({ isOpen, onClose, tenant, onSuccess }: EditTenantModalProps) {\n    const [loading, setLoading] = useState(false);\n    const [activeTab, setActiveTab] = useState<'settings' | 'billing' | 'activity'>('settings');\n    const [tenantDetails, setTenantDetails] = useState<any>(null);\n    const [formData, setFormData] = useState({\n        subscription_tier: 'trial',\n        limits: {\n            max_users: 10,\n            max_employees: 50,\n            max_clients: 100,\n            max_storage_gb: 10\n        },\n        features: {\n            novumflow_enabled: true,\n            careflow_enabled: true,\n            ai_enabled: false,\n            sms_enabled: false\n        }\n    });\n\n    useEffect(() => {\n        if (tenant && isOpen) {\n            fetchTenantDetails();\n        }\n    }, [tenant, isOpen]);\n\n    const fetchTenantDetails = async () => {\n        try {\n            // Use the new RPC to get comprehensive details\n            const { data, error } = await supabase.rpc('get_tenant_details', { p_tenant_id: tenant.id });\n\n            if (error) throw error;\n\n            setTenantDetails(data);\n            setFormData({\n                subscription_tier: data.subscription_tier,\n                limits: data.settings?.limits || { // Assuming limits are in settings jsonb now, or fallback\n                    max_users: 10,\n                    max_employees: 50,\n                    max_clients: 100,\n                    max_storage_gb: 10\n                },\n                features: data.settings?.features || {\n                    novumflow_enabled: true,\n                    careflow_enabled: true,\n                    ai_enabled: false,\n                    sms_enabled: false\n                }\n            });\n        } catch (err) {\n            log.error('Error fetching tenant details', err, { component: 'EditTenantModal', action: 'fetchTenantDetails', metadata: { tenantId: tenant?.id } });\n        }\n    };\n\n    const handleSubmit = async (e: React.FormEvent) => {\n        e.preventDefault();\n        setLoading(true);\n\n        try {\n            // We need to update the settings JSONB column. \n            // The previous RPC 'update_tenant_settings' might need adjustment or we do a direct update if RLS allows.\n            // Assuming we use a direct update for now as platform admin.\n\n            const { error } = await supabase\n                .from('tenants')\n                .update({\n                    subscription_tier: formData.subscription_tier,\n                    settings: {\n                        ...tenantDetails?.settings, // Keep existing settings like payment/email\n                        limits: formData.limits,\n                        features: formData.features\n                    }\n                })\n                .eq('id', tenant.id);\n\n            if (error) throw error;\n\n            onSuccess();\n            onClose();\n        } catch (err: any) {\n            log.error('Error updating tenant', err, { component: 'EditTenantModal', action: 'handleSubmit', metadata: { tenantId: tenant?.id } });\n            alert('Failed to update tenant: ' + err.message);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    if (!isOpen) return null;\n\n    return (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n            <div className=\"bg-white rounded-xl shadow-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto\">\n                <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n                    <div>\n                        <h2 className=\"text-xl font-bold text-gray-900\">Organization Details</h2>\n                        <p className=\"text-sm text-gray-500\">{tenant?.name}</p>\n                    </div>\n                    <button onClick={onClose} className=\"text-gray-400 hover:text-gray-600\">\n                        <X className=\"w-6 h-6\" />\n                    </button>\n                </div>\n\n                {/* Tabs */}\n                <div className=\"flex border-b border-gray-200 px-6\">\n                    <button\n                        onClick={() => setActiveTab('settings')}\n                        className={`flex items-center gap-2 py-4 px-4 border-b-2 font-medium text-sm transition-colors ${activeTab === 'settings' ? 'border-cyan-600 text-cyan-600' : 'border-transparent text-gray-500 hover:text-gray-700'\n                            }`}\n                    >\n                        <Settings className=\"w-4 h-4\" />\n                        Settings\n                    </button>\n                    <button\n                        onClick={() => setActiveTab('billing')}\n                        className={`flex items-center gap-2 py-4 px-4 border-b-2 font-medium text-sm transition-colors ${activeTab === 'billing' ? 'border-cyan-600 text-cyan-600' : 'border-transparent text-gray-500 hover:text-gray-700'\n                            }`}\n                    >\n                        <CreditCard className=\"w-4 h-4\" />\n                        Billing\n                    </button>\n                    <button\n                        onClick={() => setActiveTab('activity')}\n                        className={`flex items-center gap-2 py-4 px-4 border-b-2 font-medium text-sm transition-colors ${activeTab === 'activity' ? 'border-cyan-600 text-cyan-600' : 'border-transparent text-gray-500 hover:text-gray-700'\n                            }`}\n                    >\n                        <Activity className=\"w-4 h-4\" />\n                        Activity\n                    </button>\n                </div>\n\n                <div className=\"p-6\">\n                    {activeTab === 'settings' && (\n                        <form onSubmit={handleSubmit} className=\"space-y-8\">\n                            {/* Subscription Tier */}\n                            <div>\n                                <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Subscription Plan</h3>\n                                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                                    {['trial', 'basic', 'professional', 'enterprise'].map((tier) => (\n                                        <label key={tier} className={`\n                                            relative flex flex-col items-center p-4 border-2 rounded-lg cursor-pointer transition-all\n                                            ${formData.subscription_tier === tier ? 'border-cyan-600 bg-cyan-50' : 'border-gray-200 hover:border-gray-300'}\n                                        `}>\n                                            <input\n                                                type=\"radio\"\n                                                name=\"tier\"\n                                                value={tier}\n                                                checked={formData.subscription_tier === tier}\n                                                onChange={(e) => setFormData({ ...formData, subscription_tier: e.target.value })}\n                                                className=\"sr-only\"\n                                            />\n                                            <span className=\"capitalize font-medium text-gray-900\">{tier}</span>\n                                        </label>\n                                    ))}\n                                </div>\n                            </div>\n\n                            {/* Limits */}\n                            <div>\n                                <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Resource Limits</h3>\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Max Users</label>\n                                        <input\n                                            type=\"number\"\n                                            value={formData.limits.max_users}\n                                            onChange={(e) => setFormData({\n                                                ...formData,\n                                                limits: { ...formData.limits, max_users: parseInt(e.target.value) }\n                                            })}\n                                            className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500\"\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Max Employees</label>\n                                        <input\n                                            type=\"number\"\n                                            value={formData.limits.max_employees}\n                                            onChange={(e) => setFormData({\n                                                ...formData,\n                                                limits: { ...formData.limits, max_employees: parseInt(e.target.value) }\n                                            })}\n                                            className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500\"\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Max Clients</label>\n                                        <input\n                                            type=\"number\"\n                                            value={formData.limits.max_clients}\n                                            onChange={(e) => setFormData({\n                                                ...formData,\n                                                limits: { ...formData.limits, max_clients: parseInt(e.target.value) }\n                                            })}\n                                            className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500\"\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Storage (GB)</label>\n                                        <input\n                                            type=\"number\"\n                                            value={formData.limits.max_storage_gb}\n                                            onChange={(e) => setFormData({\n                                                ...formData,\n                                                limits: { ...formData.limits, max_storage_gb: parseInt(e.target.value) }\n                                            })}\n                                            className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500\"\n                                        />\n                                    </div>\n                                </div>\n                            </div>\n\n                            {/* Features */}\n                            <div>\n                                <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Feature Flags</h3>\n                                <div className=\"space-y-3\">\n                                    {Object.entries(formData.features).map(([key, value]) => (\n                                        <label key={key} className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n                                            <span className=\"text-sm font-medium text-gray-700 capitalize\">\n                                                {key.replace(/_/g, ' ')}\n                                            </span>\n                                            <div className=\"relative inline-block w-12 h-6 transition duration-200 ease-in-out\">\n                                                <input\n                                                    type=\"checkbox\"\n                                                    checked={value}\n                                                    onChange={(e) => setFormData({\n                                                        ...formData,\n                                                        features: { ...formData.features, [key]: e.target.checked }\n                                                    })}\n                                                    className=\"opacity-0 w-0 h-0\"\n                                                    id={`toggle-${key}`}\n                                                />\n                                                <label\n                                                    htmlFor={`toggle-${key}`}\n                                                    className={`absolute cursor-pointer top-0 left-0 right-0 bottom-0 rounded-full transition-colors duration-200 ease-in-out ${value ? 'bg-cyan-600' : 'bg-gray-300'\n                                                        }`}\n                                                >\n                                                    <span\n                                                        className={`absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition-transform duration-200 ease-in-out ${value ? 'transform translate-x-6' : ''\n                                                            }`}\n                                                    />\n                                                </label>\n                                            </div>\n                                        </label>\n                                    ))}\n                                </div>\n                            </div>\n\n                            {/* Actions */}\n                            <div className=\"flex items-center justify-end gap-4 pt-6 border-t border-gray-200\">\n                                <button\n                                    type=\"button\"\n                                    onClick={onClose}\n                                    className=\"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors\"\n                                >\n                                    Cancel\n                                </button>\n                                <button\n                                    type=\"submit\"\n                                    disabled={loading}\n                                    className=\"flex items-center gap-2 px-6 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors disabled:opacity-50\"\n                                >\n                                    {loading ? (\n                                        <>\n                                            <Loader2 className=\"w-4 h-4 animate-spin\" />\n                                            Saving...\n                                        </>\n                                    ) : (\n                                        <>\n                                            <Save className=\"w-4 h-4\" />\n                                            Save Changes\n                                        </>\n                                    )}\n                                </button>\n                            </div>\n                        </form>\n                    )}\n\n                    {activeTab === 'billing' && (\n                        <div className=\"space-y-6\">\n                            <div className=\"bg-gray-50 p-6 rounded-xl border border-gray-200\">\n                                <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Current Subscription</h3>\n                                <div className=\"grid grid-cols-2 gap-6\">\n                                    <div>\n                                        <p className=\"text-sm text-gray-500\">Plan</p>\n                                        <p className=\"text-lg font-semibold text-gray-900 capitalize\">{tenantDetails?.subscription_tier}</p>\n                                    </div>\n                                    <div>\n                                        <p className=\"text-sm text-gray-500\">Status</p>\n                                        <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${tenantDetails?.subscription_status === 'active' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'\n                                            }`}>\n                                            {tenantDetails?.subscription_status}\n                                        </span>\n                                    </div>\n                                    <div>\n                                        <p className=\"text-sm text-gray-500\">Stripe Account ID</p>\n                                        <p className=\"text-sm font-mono text-gray-700\">\n                                            {tenantDetails?.settings?.payment_gateway?.account_id || 'Not Connected'}\n                                        </p>\n                                    </div>\n                                    <div>\n                                        <p className=\"text-sm text-gray-500\">Next Billing Date</p>\n                                        <p className=\"text-sm text-gray-900\">\n                                            {/* Mock date for now */}\n                                            {new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toLocaleDateString()}\n                                        </p>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    )}\n\n                    {activeTab === 'activity' && (\n                        <div className=\"space-y-6\">\n                            <div className=\"grid grid-cols-3 gap-4\">\n                                <div className=\"bg-blue-50 p-4 rounded-lg border border-blue-100\">\n                                    <p className=\"text-sm text-blue-600 font-medium\">Active Jobs</p>\n                                    <p className=\"text-2xl font-bold text-blue-900\">{tenantDetails?.job_count || 0}</p>\n                                </div>\n                                <div className=\"bg-green-50 p-4 rounded-lg border border-green-100\">\n                                    <p className=\"text-sm text-green-600 font-medium\">Applications</p>\n                                    <p className=\"text-2xl font-bold text-green-900\">{tenantDetails?.application_count || 0}</p>\n                                </div>\n                                <div className=\"bg-purple-50 p-4 rounded-lg border border-purple-100\">\n                                    <p className=\"text-sm text-purple-600 font-medium\">Interviews</p>\n                                    <p className=\"text-2xl font-bold text-purple-900\">{tenantDetails?.interview_count || 0}</p>\n                                </div>\n                            </div>\n\n                            <div>\n                                <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Recent Activity</h3>\n                                <div className=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n                                    {tenantDetails?.recent_activity && tenantDetails.recent_activity.length > 0 ? (\n                                        <ul className=\"divide-y divide-gray-200\">\n                                            {tenantDetails.recent_activity.map((log: any, index: number) => (\n                                                <li key={index} className=\"p-4 hover:bg-gray-50\">\n                                                    <div className=\"flex justify-between\">\n                                                        <div>\n                                                            <p className=\"text-sm font-medium text-gray-900\">{log.action.replace(/_/g, ' ')}</p>\n                                                            <p className=\"text-xs text-gray-500\">by {log.user_name}</p>\n                                                        </div>\n                                                        <span className=\"text-xs text-gray-400\">\n                                                            {new Date(log.timestamp).toLocaleString()}\n                                                        </span>\n                                                    </div>\n                                                </li>\n                                            ))}\n                                        </ul>\n                                    ) : (\n                                        <div className=\"p-8 text-center text-gray-500\">\n                                            No recent activity found\n                                        </div>\n                                    )}\n                                </div>\n                            </div>\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/compliance/ComplianceDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used. Allowed unused vars must match /^_/u.","line":23,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Filter' is defined but never used. Allowed unused vars must match /^_/u.","line":28,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DashboardStats' is defined but never used. Allowed unused vars must match /^_/u.","line":42,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'statsLoading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":203,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":203,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'expiringDocs' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":210,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":210,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'expiringLoading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":210,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":210,"endColumn":57}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Comprehensive Compliance Dashboard\n * \n * Provides overview of compliance status across the organization\n * - Real-time compliance scoring\n * - Document expiry tracking\n * - Home Office vs CQC separation\n * - Automated alerts and tasks\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { \n  Shield, \n  AlertTriangle, \n  CheckCircle2, \n  XCircle, \n  Clock, \n  Building2, \n  FileCheck,\n  Users,\n  TrendingUp,\n  Calendar,\n  Bell,\n  FolderOpen,\n  RefreshCw,\n  Download,\n  Filter,\n  Search,\n  ChevronRight,\n  ExternalLink,\n  Info\n} from 'lucide-react';\nimport { complianceService } from '../../lib/compliance/ComplianceService';\nimport { crossAppSyncService } from '../../lib/compliance/CrossAppSyncService';\nimport { COMPLIANCE_FOLDER_STRUCTURE, ComplianceAuthority, ComplianceStage } from '../../lib/compliance/complianceTypes';\n\n// ===========================================\n// TYPES\n// ===========================================\n\ninterface DashboardStats {\n  totalPersons: number;\n  compliant: number;\n  atRisk: number;\n  nonCompliant: number;\n  expiringDocuments: number;\n  pendingVerifications: number;\n  byStage: Record<ComplianceStage, number>;\n  recentActivity: ActivityItem[];\n}\n\ninterface ActivityItem {\n  id: string;\n  action: string;\n  entity_type: string;\n  entity_id: string;\n  user_email?: string;\n  created_at: string;\n  new_values?: any;\n}\n\ninterface ExpiringDocument {\n  id: string;\n  person_name: string;\n  person_email: string;\n  document_type: string;\n  authority: ComplianceAuthority;\n  expiry_date: string;\n  days_until_expiry: number;\n  urgency: 'CRITICAL' | 'HIGH' | 'MEDIUM' | 'LOW';\n}\n\n// ===========================================\n// HELPER COMPONENTS\n// ===========================================\n\nconst StatCard: React.FC<{\n  title: string;\n  value: number;\n  subtitle?: string;\n  icon: React.ReactNode;\n  color: string;\n  trend?: { value: number; positive: boolean };\n  onClick?: () => void;\n}> = ({ title, value, subtitle, icon, color, trend, onClick }) => (\n  <div \n    className={`bg-white rounded-xl shadow-sm border border-gray-100 p-6 ${onClick ? 'cursor-pointer hover:shadow-md transition-shadow' : ''}`}\n    onClick={onClick}\n  >\n    <div className=\"flex items-start justify-between\">\n      <div>\n        <p className=\"text-sm font-medium text-gray-500\">{title}</p>\n        <p className={`text-3xl font-bold mt-2 ${color}`}>{value.toLocaleString()}</p>\n        {subtitle && <p className=\"text-xs text-gray-400 mt-1\">{subtitle}</p>}\n        {trend && (\n          <div className={`flex items-center mt-2 text-sm ${trend.positive ? 'text-green-600' : 'text-red-600'}`}>\n            <TrendingUp className={`w-4 h-4 mr-1 ${!trend.positive && 'rotate-180'}`} />\n            {trend.value}% from last month\n          </div>\n        )}\n      </div>\n      <div className={`p-3 rounded-lg ${color.replace('text-', 'bg-').replace('600', '100')}`}>\n        {icon}\n      </div>\n    </div>\n  </div>\n);\n\nconst ComplianceScoreGauge: React.FC<{ score: number; size?: 'sm' | 'md' | 'lg' }> = ({ score, size = 'md' }) => {\n  const sizeClasses = {\n    sm: 'w-24 h-24',\n    md: 'w-32 h-32',\n    lg: 'w-40 h-40'\n  };\n  \n  const getColor = (s: number) => {\n    if (s >= 90) return '#10b981'; // green\n    if (s >= 70) return '#f59e0b'; // yellow\n    return '#ef4444'; // red\n  };\n  \n  const circumference = 2 * Math.PI * 45;\n  const strokeDashoffset = circumference - (score / 100) * circumference;\n  \n  return (\n    <div className={`relative ${sizeClasses[size]}`}>\n      <svg className=\"w-full h-full transform -rotate-90\">\n        <circle\n          cx=\"50%\"\n          cy=\"50%\"\n          r=\"45%\"\n          stroke=\"#e5e7eb\"\n          strokeWidth=\"8\"\n          fill=\"none\"\n        />\n        <circle\n          cx=\"50%\"\n          cy=\"50%\"\n          r=\"45%\"\n          stroke={getColor(score)}\n          strokeWidth=\"8\"\n          fill=\"none\"\n          strokeLinecap=\"round\"\n          strokeDasharray={circumference}\n          strokeDashoffset={strokeDashoffset}\n          className=\"transition-all duration-500\"\n        />\n      </svg>\n      <div className=\"absolute inset-0 flex flex-col items-center justify-center\">\n        <span className=\"text-2xl font-bold\" style={{ color: getColor(score) }}>{score}%</span>\n        <span className=\"text-xs text-gray-500\">Compliance</span>\n      </div>\n    </div>\n  );\n};\n\nconst AuthorityBadge: React.FC<{ authority: ComplianceAuthority }> = ({ authority }) => {\n  const config = {\n    HOME_OFFICE: { bg: 'bg-blue-100', text: 'text-blue-800', label: 'Home Office' },\n    CQC: { bg: 'bg-green-100', text: 'text-green-800', label: 'CQC' },\n    BOTH: { bg: 'bg-purple-100', text: 'text-purple-800', label: 'Both' },\n    INTERNAL: { bg: 'bg-gray-100', text: 'text-gray-800', label: 'Internal' }\n  };\n  \n  const { bg, text, label } = config[authority];\n  \n  return (\n    <span className={`px-2 py-1 rounded-full text-xs font-medium ${bg} ${text}`}>\n      {label}\n    </span>\n  );\n};\n\nconst UrgencyBadge: React.FC<{ urgency: string }> = ({ urgency }) => {\n  const config: Record<string, { bg: string; text: string }> = {\n    CRITICAL: { bg: 'bg-red-100', text: 'text-red-800' },\n    HIGH: { bg: 'bg-orange-100', text: 'text-orange-800' },\n    MEDIUM: { bg: 'bg-yellow-100', text: 'text-yellow-800' },\n    LOW: { bg: 'bg-green-100', text: 'text-green-800' }\n  };\n  \n  const { bg, text } = config[urgency] || config.LOW;\n  \n  return (\n    <span className={`px-2 py-1 rounded-full text-xs font-medium ${bg} ${text}`}>\n      {urgency}\n    </span>\n  );\n};\n\n// ===========================================\n// MAIN DASHBOARD COMPONENT\n// ===========================================\n\nconst ComplianceDashboard: React.FC<{ tenantId: string }> = ({ tenantId }) => {\n  const queryClient = useQueryClient();\n  const [activeTab, setActiveTab] = useState<'overview' | 'expiring' | 'pending' | 'activity'>('overview');\n  const [authorityFilter, setAuthorityFilter] = useState<ComplianceAuthority | 'ALL'>('ALL');\n  const [searchQuery, setSearchQuery] = useState('');\n\n  // Fetch dashboard data\n  const { data: stats, isLoading: statsLoading } = useQuery({\n    queryKey: ['compliance-dashboard', tenantId],\n    queryFn: () => complianceService.getComplianceDashboard(tenantId),\n    refetchInterval: 60000 // Refresh every minute\n  });\n\n  // Fetch expiring documents\n  const { data: expiringDocs, isLoading: expiringLoading } = useQuery({\n    queryKey: ['expiring-documents', tenantId, authorityFilter],\n    queryFn: async () => {\n      // Simulated - would be actual API call\n      return [] as ExpiringDocument[];\n    }\n  });\n\n  // Sync mutation\n  const syncMutation = useMutation({\n    mutationFn: () => crossAppSyncService.batchSyncToCareFlow(tenantId),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['compliance-dashboard'] });\n    }\n  });\n\n  // Calculate overall score\n  const overallScore = stats \n    ? Math.round((stats.compliant / Math.max(stats.totalPersons, 1)) * 100)\n    : 0;\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 p-6\">\n      {/* Header */}\n      <div className=\"mb-8\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-2xl font-bold text-gray-900 flex items-center gap-2\">\n              <Shield className=\"w-8 h-8 text-indigo-600\" />\n              Compliance Dashboard\n            </h1>\n            <p className=\"text-gray-500 mt-1\">\n              Monitor Home Office and CQC compliance across your organization\n            </p>\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <button\n              onClick={() => syncMutation.mutate()}\n              disabled={syncMutation.isPending}\n              className=\"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50\"\n            >\n              <RefreshCw className={`w-4 h-4 ${syncMutation.isPending ? 'animate-spin' : ''}`} />\n              Sync to CareFlow\n            </button>\n            <button className=\"flex items-center gap-2 px-4 py-2 bg-white border border-gray-200 rounded-lg hover:bg-gray-50\">\n              <Download className=\"w-4 h-4\" />\n              Export Report\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Authority Filter Pills */}\n      <div className=\"mb-6 flex items-center gap-2\">\n        <span className=\"text-sm text-gray-500 mr-2\">Filter by:</span>\n        {(['ALL', 'HOME_OFFICE', 'CQC', 'BOTH'] as const).map(authority => (\n          <button\n            key={authority}\n            onClick={() => setAuthorityFilter(authority)}\n            className={`px-4 py-2 rounded-full text-sm font-medium transition-colors ${\n              authorityFilter === authority\n                ? 'bg-indigo-600 text-white'\n                : 'bg-white text-gray-600 hover:bg-gray-100 border border-gray-200'\n            }`}\n          >\n            {authority === 'ALL' ? 'All' : authority === 'HOME_OFFICE' ? 'Home Office' : authority}\n          </button>\n        ))}\n      </div>\n\n      {/* Stats Grid */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n        <StatCard\n          title=\"Total Staff\"\n          value={stats?.totalPersons || 0}\n          subtitle=\"Active employees & applicants\"\n          icon={<Users className=\"w-6 h-6 text-indigo-600\" />}\n          color=\"text-indigo-600\"\n        />\n        <StatCard\n          title=\"Compliant\"\n          value={stats?.compliant || 0}\n          subtitle=\"All requirements met\"\n          icon={<CheckCircle2 className=\"w-6 h-6 text-green-600\" />}\n          color=\"text-green-600\"\n          trend={{ value: 5, positive: true }}\n        />\n        <StatCard\n          title=\"At Risk\"\n          value={stats?.atRisk || 0}\n          subtitle=\"Documents expiring soon\"\n          icon={<AlertTriangle className=\"w-6 h-6 text-yellow-600\" />}\n          color=\"text-yellow-600\"\n        />\n        <StatCard\n          title=\"Non-Compliant\"\n          value={stats?.nonCompliant || 0}\n          subtitle=\"Immediate action required\"\n          icon={<XCircle className=\"w-6 h-6 text-red-600\" />}\n          color=\"text-red-600\"\n        />\n      </div>\n\n      {/* Main Content Grid */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* Left Column - Score Overview */}\n        <div className=\"lg:col-span-1 space-y-6\">\n          {/* Overall Compliance Score */}\n          <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Overall Compliance</h3>\n            <div className=\"flex justify-center\">\n              <ComplianceScoreGauge score={overallScore} size=\"lg\" />\n            </div>\n            <div className=\"mt-6 space-y-3\">\n              <div className=\"flex items-center justify-between p-3 bg-blue-50 rounded-lg\">\n                <div className=\"flex items-center gap-2\">\n                  <Building2 className=\"w-5 h-5 text-blue-600\" />\n                  <span className=\"text-sm font-medium text-gray-700\">Home Office</span>\n                </div>\n                <span className=\"text-lg font-bold text-blue-600\">85%</span>\n              </div>\n              <div className=\"flex items-center justify-between p-3 bg-green-50 rounded-lg\">\n                <div className=\"flex items-center gap-2\">\n                  <Shield className=\"w-5 h-5 text-green-600\" />\n                  <span className=\"text-sm font-medium text-gray-700\">CQC</span>\n                </div>\n                <span className=\"text-lg font-bold text-green-600\">92%</span>\n              </div>\n            </div>\n          </div>\n\n          {/* Folder Structure */}\n          <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2\">\n              <FolderOpen className=\"w-5 h-5 text-gray-400\" />\n              Document Folders\n            </h3>\n            <div className=\"space-y-2\">\n              {Object.entries(COMPLIANCE_FOLDER_STRUCTURE).map(([key, folder]) => (\n                <div\n                  key={key}\n                  className=\"flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors\"\n                  style={{ borderLeft: `4px solid ${folder.color}` }}\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <span className=\"text-sm font-medium text-gray-700\">{folder.name}</span>\n                  </div>\n                  <ChevronRight className=\"w-4 h-4 text-gray-400\" />\n                </div>\n              ))}\n            </div>\n          </div>\n\n          {/* Quick Actions */}\n          <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Quick Actions</h3>\n            <div className=\"space-y-2\">\n              <button className=\"w-full flex items-center justify-between p-3 bg-indigo-50 rounded-lg hover:bg-indigo-100 transition-colors\">\n                <span className=\"text-sm font-medium text-indigo-700\">Process Expired Documents</span>\n                <span className=\"bg-indigo-600 text-white text-xs px-2 py-1 rounded-full\">\n                  {stats?.expiringDocuments || 0}\n                </span>\n              </button>\n              <button className=\"w-full flex items-center justify-between p-3 bg-yellow-50 rounded-lg hover:bg-yellow-100 transition-colors\">\n                <span className=\"text-sm font-medium text-yellow-700\">Verify Pending Documents</span>\n                <span className=\"bg-yellow-600 text-white text-xs px-2 py-1 rounded-full\">\n                  {stats?.pendingVerifications || 0}\n                </span>\n              </button>\n              <button className=\"w-full flex items-center justify-between p-3 bg-green-50 rounded-lg hover:bg-green-100 transition-colors\">\n                <span className=\"text-sm font-medium text-green-700\">Generate Audit Report</span>\n                <ExternalLink className=\"w-4 h-4 text-green-600\" />\n              </button>\n            </div>\n          </div>\n        </div>\n\n        {/* Right Column - Details */}\n        <div className=\"lg:col-span-2 space-y-6\">\n          {/* Tabs */}\n          <div className=\"bg-white rounded-xl shadow-sm border border-gray-100\">\n            <div className=\"border-b border-gray-100\">\n              <nav className=\"flex -mb-px\">\n                {[\n                  { id: 'overview', label: 'Stage Overview', icon: Users },\n                  { id: 'expiring', label: 'Expiring Documents', icon: Clock },\n                  { id: 'pending', label: 'Pending Verification', icon: FileCheck },\n                  { id: 'activity', label: 'Recent Activity', icon: Bell }\n                ].map(tab => (\n                  <button\n                    key={tab.id}\n                    onClick={() => setActiveTab(tab.id as any)}\n                    className={`flex items-center gap-2 px-6 py-4 text-sm font-medium border-b-2 transition-colors ${\n                      activeTab === tab.id\n                        ? 'border-indigo-600 text-indigo-600'\n                        : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                    }`}\n                  >\n                    <tab.icon className=\"w-4 h-4\" />\n                    {tab.label}\n                  </button>\n                ))}\n              </nav>\n            </div>\n\n            <div className=\"p-6\">\n              {/* Stage Overview Tab */}\n              {activeTab === 'overview' && (\n                <div className=\"space-y-6\">\n                  <div className=\"flex items-center justify-between\">\n                    <h3 className=\"font-semibold text-gray-900\">Compliance by Stage</h3>\n                    <div className=\"relative\">\n                      <Search className=\"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" />\n                      <input\n                        type=\"text\"\n                        placeholder=\"Search...\"\n                        value={searchQuery}\n                        onChange={(e) => setSearchQuery(e.target.value)}\n                        className=\"pl-10 pr-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    {Object.entries(stats?.byStage || {}).map(([stage, count]) => (\n                      <div\n                        key={stage}\n                        className=\"p-4 border border-gray-100 rounded-lg hover:border-indigo-200 transition-colors cursor-pointer\"\n                      >\n                        <div className=\"flex items-center justify-between\">\n                          <div>\n                            <h4 className=\"font-medium text-gray-900\">\n                              {stage.replace('_', ' ')}\n                            </h4>\n                            <p className=\"text-2xl font-bold text-indigo-600 mt-1\">{count}</p>\n                          </div>\n                          <div className=\"p-3 bg-indigo-50 rounded-lg\">\n                            <Users className=\"w-6 h-6 text-indigo-600\" />\n                          </div>\n                        </div>\n                        <div className=\"mt-3 flex items-center gap-2\">\n                          <div className=\"flex-1 bg-gray-100 rounded-full h-2\">\n                            <div \n                              className=\"bg-indigo-600 h-2 rounded-full\" \n                              style={{ width: `${Math.min(100, (count / Math.max(stats?.totalPersons || 1, 1)) * 100)}%` }}\n                            />\n                          </div>\n                          <span className=\"text-xs text-gray-500\">\n                            {Math.round((count / Math.max(stats?.totalPersons || 1, 1)) * 100)}%\n                          </span>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n\n                  {/* Stage Flow Visualization */}\n                  <div className=\"mt-6 p-4 bg-gray-50 rounded-lg\">\n                    <h4 className=\"text-sm font-medium text-gray-700 mb-3\">Compliance Pipeline</h4>\n                    <div className=\"flex items-center justify-between\">\n                      {['APPLICATION', 'PRE_EMPLOYMENT', 'ONBOARDING', 'ONGOING'].map((stage, index) => (\n                        <React.Fragment key={stage}>\n                          <div className=\"flex flex-col items-center\">\n                            <div className=\"w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 font-bold\">\n                              {stats?.byStage?.[stage as ComplianceStage] || 0}\n                            </div>\n                            <span className=\"text-xs text-gray-500 mt-1 text-center\">\n                              {stage.replace('_', ' ')}\n                            </span>\n                          </div>\n                          {index < 3 && (\n                            <ChevronRight className=\"w-6 h-6 text-gray-300\" />\n                          )}\n                        </React.Fragment>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              {/* Expiring Documents Tab */}\n              {activeTab === 'expiring' && (\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <h3 className=\"font-semibold text-gray-900\">Documents Expiring Soon</h3>\n                    <select className=\"px-3 py-2 border border-gray-200 rounded-lg text-sm\">\n                      <option>Next 30 days</option>\n                      <option>Next 60 days</option>\n                      <option>Next 90 days</option>\n                    </select>\n                  </div>\n\n                  {/* Alert Banner */}\n                  <div className=\"p-4 bg-red-50 border border-red-100 rounded-lg flex items-start gap-3\">\n                    <AlertTriangle className=\"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5\" />\n                    <div>\n                      <h4 className=\"font-medium text-red-800\">Critical Documents Expiring</h4>\n                      <p className=\"text-sm text-red-600 mt-1\">\n                        {stats?.expiringDocuments || 0} documents will expire in the next 30 days. \n                        Immediate action required to maintain compliance.\n                      </p>\n                    </div>\n                  </div>\n\n                  {/* Expiring Documents List */}\n                  <div className=\"border border-gray-100 rounded-lg overflow-hidden\">\n                    <table className=\"w-full\">\n                      <thead className=\"bg-gray-50\">\n                        <tr>\n                          <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Person</th>\n                          <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Document</th>\n                          <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Authority</th>\n                          <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Expiry</th>\n                          <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Urgency</th>\n                          <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Action</th>\n                        </tr>\n                      </thead>\n                      <tbody className=\"divide-y divide-gray-100\">\n                        {/* Sample data - would be from API */}\n                        {[\n                          { name: 'John Smith', doc: 'DBS Certificate', authority: 'CQC' as const, expiry: '2024-01-15', days: 5, urgency: 'CRITICAL' },\n                          { name: 'Sarah Johnson', doc: 'Visa', authority: 'HOME_OFFICE' as const, expiry: '2024-01-20', days: 10, urgency: 'HIGH' },\n                          { name: 'Mike Brown', doc: 'NMC PIN', authority: 'CQC' as const, expiry: '2024-02-01', days: 22, urgency: 'MEDIUM' },\n                        ].map((item, i) => (\n                          <tr key={i} className=\"hover:bg-gray-50\">\n                            <td className=\"px-4 py-3\">\n                              <div>\n                                <p className=\"font-medium text-gray-900\">{item.name}</p>\n                              </div>\n                            </td>\n                            <td className=\"px-4 py-3 text-sm text-gray-600\">{item.doc}</td>\n                            <td className=\"px-4 py-3\">\n                              <AuthorityBadge authority={item.authority} />\n                            </td>\n                            <td className=\"px-4 py-3\">\n                              <div className=\"text-sm\">\n                                <p className=\"text-gray-900\">{item.expiry}</p>\n                                <p className=\"text-gray-500\">{item.days} days</p>\n                              </div>\n                            </td>\n                            <td className=\"px-4 py-3\">\n                              <UrgencyBadge urgency={item.urgency} />\n                            </td>\n                            <td className=\"px-4 py-3\">\n                              <button className=\"text-indigo-600 hover:text-indigo-800 text-sm font-medium\">\n                                Send Reminder\n                              </button>\n                            </td>\n                          </tr>\n                        ))}\n                      </tbody>\n                    </table>\n                  </div>\n                </div>\n              )}\n\n              {/* Pending Verification Tab */}\n              {activeTab === 'pending' && (\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <h3 className=\"font-semibold text-gray-900\">Documents Awaiting Verification</h3>\n                    <button className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm hover:bg-indigo-700\">\n                      Bulk Verify\n                    </button>\n                  </div>\n\n                  <div className=\"space-y-3\">\n                    {/* Sample pending verifications */}\n                    {[\n                      { name: 'Emma Wilson', doc: 'Passport', authority: 'HOME_OFFICE' as const, uploaded: '2 hours ago' },\n                      { name: 'James Taylor', doc: 'Care Certificate', authority: 'CQC' as const, uploaded: '4 hours ago' },\n                      { name: 'Lisa Anderson', doc: 'References', authority: 'BOTH' as const, uploaded: '1 day ago' },\n                    ].map((item, i) => (\n                      <div key={i} className=\"flex items-center justify-between p-4 border border-gray-100 rounded-lg hover:border-indigo-200 transition-colors\">\n                        <div className=\"flex items-center gap-4\">\n                          <div className=\"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center\">\n                            <FileCheck className=\"w-5 h-5 text-gray-600\" />\n                          </div>\n                          <div>\n                            <p className=\"font-medium text-gray-900\">{item.name}</p>\n                            <p className=\"text-sm text-gray-500\">{item.doc} â¢ Uploaded {item.uploaded}</p>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-3\">\n                          <AuthorityBadge authority={item.authority} />\n                          <button className=\"px-3 py-1.5 bg-green-100 text-green-700 rounded-lg text-sm font-medium hover:bg-green-200\">\n                            Verify\n                          </button>\n                          <button className=\"px-3 py-1.5 bg-red-100 text-red-700 rounded-lg text-sm font-medium hover:bg-red-200\">\n                            Reject\n                          </button>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Recent Activity Tab */}\n              {activeTab === 'activity' && (\n                <div className=\"space-y-4\">\n                  <h3 className=\"font-semibold text-gray-900\">Recent Activity</h3>\n                  <div className=\"space-y-3\">\n                    {stats?.recentActivity?.slice(0, 10).map((activity, i) => (\n                      <div key={i} className=\"flex items-start gap-3 p-3 hover:bg-gray-50 rounded-lg\">\n                        <div className=\"w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0\">\n                          <Bell className=\"w-4 h-4 text-indigo-600\" />\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"text-sm text-gray-900\">\n                            <span className=\"font-medium\">{activity.action}</span>\n                            {' '}on {activity.entity_type}\n                          </p>\n                          <p className=\"text-xs text-gray-500 mt-1\">\n                            {activity.user_email} â¢ {new Date(activity.created_at).toLocaleString()}\n                          </p>\n                        </div>\n                      </div>\n                    )) || (\n                      <p className=\"text-gray-500 text-center py-8\">No recent activity</p>\n                    )}\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Compliance by Authority */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            {/* Home Office Card */}\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\n              <div className=\"flex items-center gap-3 mb-4\">\n                <div className=\"p-2 bg-blue-100 rounded-lg\">\n                  <Building2 className=\"w-6 h-6 text-blue-600\" />\n                </div>\n                <div>\n                  <h3 className=\"font-semibold text-gray-900\">Home Office Compliance</h3>\n                  <p className=\"text-sm text-gray-500\">Right to Work & Immigration</p>\n                </div>\n              </div>\n              <div className=\"space-y-3\">\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-gray-600\">Passport/Visa Verified</span>\n                  <span className=\"font-medium text-gray-900\">45/50</span>\n                </div>\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-gray-600\">RTW Checks Complete</span>\n                  <span className=\"font-medium text-gray-900\">48/50</span>\n                </div>\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-gray-600\">NI Numbers Verified</span>\n                  <span className=\"font-medium text-gray-900\">50/50</span>\n                </div>\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-gray-600\">Visas Expiring (90 days)</span>\n                  <span className=\"font-medium text-yellow-600\">3</span>\n                </div>\n              </div>\n            </div>\n\n            {/* CQC Card */}\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\n              <div className=\"flex items-center gap-3 mb-4\">\n                <div className=\"p-2 bg-green-100 rounded-lg\">\n                  <Shield className=\"w-6 h-6 text-green-600\" />\n                </div>\n                <div>\n                  <h3 className=\"font-semibold text-gray-900\">CQC Compliance</h3>\n                  <p className=\"text-sm text-gray-500\">Care Quality Standards</p>\n                </div>\n              </div>\n              <div className=\"space-y-3\">\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-gray-600\">DBS Checks Valid</span>\n                  <span className=\"font-medium text-gray-900\">47/50</span>\n                </div>\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-gray-600\">Mandatory Training Complete</span>\n                  <span className=\"font-medium text-gray-900\">42/50</span>\n                </div>\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-gray-600\">Care Certificates</span>\n                  <span className=\"font-medium text-gray-900\">45/50</span>\n                </div>\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-gray-600\">Training Expiring (30 days)</span>\n                  <span className=\"font-medium text-red-600\">8</span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Help Tooltip */}\n      <div className=\"fixed bottom-6 right-6\">\n        <button className=\"w-12 h-12 bg-indigo-600 text-white rounded-full shadow-lg hover:bg-indigo-700 flex items-center justify-center\">\n          <Info className=\"w-6 h-6\" />\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default ComplianceDashboard;\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/performance/GoalsList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/performance/KPIsTable.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BarChart2' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'format' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onSuccess' is defined but never used. Allowed unused args must match /^_/u.","line":29,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":12},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'handleDeactivate'. Either include it or remove the dependency array.","line":165,"column":6,"nodeType":"ArrayExpression","endLine":165,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [onEdit, isAdmin, handleDeactivate]","fix":{"range":[5125,5142],"text":"[onEdit, isAdmin, handleDeactivate]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * KPIsTable Component\n * \n * Displays KPI definitions and values using GenericCRUDTable\n * Supports filtering and viewing KPI performance metrics\n */\n\nimport React, { useMemo } from 'react';\nimport { TrendingUp, Edit, Trash2, BarChart2 } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { GenericCRUDTable, Column, Action } from '@/components/shared/crud/GenericCRUDTable';\nimport { useKPIs, KPIDefinition } from '@/hooks';\nimport { log } from '@/lib/logger';\n\ninterface KPIsTableProps {\n  searchTerm?: string;\n  isAdmin?: boolean;\n  onAddNew: () => void;\n  onEdit: (kpi: KPIDefinition) => void;\n  onSuccess?: (message: string) => void;\n  onError?: (message: string) => void;\n}\n\nexport function KPIsTable({\n  searchTerm = '',\n  isAdmin = false,\n  onAddNew,\n  onEdit,\n  onSuccess,\n  onError,\n}: KPIsTableProps) {\n  // Fetch KPI definitions using React Query\n  const { data: kpis = [], isLoading, error } = useKPIs();\n\n  // Filter KPIs based on search term\n  const filteredKPIs = useMemo(() => {\n    if (!searchTerm) return kpis;\n    const lowerSearch = searchTerm.toLowerCase();\n    return kpis.filter(kpi =>\n      kpi.name?.toLowerCase().includes(lowerSearch) ||\n      kpi.category?.toLowerCase().includes(lowerSearch) ||\n      kpi.description?.toLowerCase().includes(lowerSearch)\n    );\n  }, [kpis, searchTerm]);\n\n  // Handle KPI deactivation (KPIs should typically be deactivated, not deleted)\n  const handleDeactivate = async (kpi: KPIDefinition) => {\n    if (!window.confirm('Are you sure you want to deactivate this KPI definition?')) {\n      return;\n    }\n\n    // Note: In a real implementation, this would call an update mutation\n    // to set is_active = false. For now, we just show the action.\n    log.track('kpi_deactivate_requested', { kpiId: kpi.id });\n    onError?.('KPI deactivation not implemented - KPIs should be updated, not deleted');\n  };\n\n  // Get category color\n  const getCategoryColor = (category: string): string => {\n    const colors: Record<string, string> = {\n      sales: 'bg-green-100 text-green-800',\n      marketing: 'bg-blue-100 text-blue-800',\n      operations: 'bg-purple-100 text-purple-800',\n      finance: 'bg-yellow-100 text-yellow-800',\n      hr: 'bg-pink-100 text-pink-800',\n      customer_success: 'bg-indigo-100 text-indigo-800',\n      engineering: 'bg-orange-100 text-orange-800',\n    };\n    return colors[category?.toLowerCase()] || 'bg-gray-100 text-gray-800';\n  };\n\n  // Define table columns\n  const columns: Column<KPIDefinition>[] = useMemo(() => [\n    {\n      key: 'name',\n      label: 'KPI Name',\n      sortable: true,\n      render: (kpi) => (\n        <div className=\"flex items-center\">\n          <div className=\"flex-shrink-0 h-10 w-10 bg-indigo-100 rounded-lg flex items-center justify-center\">\n            <TrendingUp className=\"h-5 w-5 text-indigo-600\" />\n          </div>\n          <div className=\"ml-4\">\n            <div className=\"text-sm font-medium text-gray-900\">{kpi.name}</div>\n            {kpi.description && (\n              <div className=\"text-sm text-gray-500 truncate max-w-xs\" title={kpi.description}>\n                {kpi.description}\n              </div>\n            )}\n          </div>\n        </div>\n      ),\n    },\n    {\n      key: 'category',\n      label: 'Category',\n      sortable: true,\n      render: (kpi) => (\n        <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full capitalize ${getCategoryColor(kpi.category)}`}>\n          {kpi.category?.replace(/_/g, ' ')}\n        </span>\n      ),\n    },\n    {\n      key: 'measurement_unit',\n      label: 'Unit',\n      render: (kpi) => (\n        <span className=\"text-sm text-gray-600\">{kpi.measurement_unit || '-'}</span>\n      ),\n    },\n    {\n      key: 'target_value',\n      label: 'Default Target',\n      render: (kpi) => (\n        <span className=\"text-sm font-medium text-gray-900\">\n          {kpi.target_value ?? kpi.default_target ?? 'Not set'}\n          {kpi.measurement_unit && ` ${kpi.measurement_unit}`}\n        </span>\n      ),\n    },\n    {\n      key: 'calculation_method',\n      label: 'Calculation',\n      render: (kpi) => (\n        <span className=\"text-sm text-gray-600 capitalize\">\n          {kpi.calculation_method?.replace(/_/g, ' ') || 'Manual'}\n        </span>\n      ),\n    },\n    {\n      key: 'is_active',\n      label: 'Status',\n      render: (kpi) => (\n        <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${\n          kpi.is_active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'\n        }`}>\n          {kpi.is_active ? 'Active' : 'Inactive'}\n        </span>\n      ),\n    },\n  ], []);\n\n  // Define row actions\n  const actions: Action<KPIDefinition>[] = useMemo(() => {\n    const actionsList: Action<KPIDefinition>[] = [\n      {\n        label: 'Edit',\n        icon: Edit,\n        onClick: onEdit,\n        variant: 'primary',\n      },\n    ];\n\n    if (isAdmin) {\n      actionsList.push({\n        label: 'Deactivate',\n        icon: Trash2,\n        onClick: handleDeactivate,\n        variant: 'danger',\n        show: (kpi) => kpi.is_active !== false,\n      });\n    }\n\n    return actionsList;\n  }, [onEdit, isAdmin]);\n\n  return (\n    <GenericCRUDTable\n      data={filteredKPIs}\n      columns={columns}\n      loading={isLoading}\n      error={error?.message}\n      actions={actions}\n      onAdd={isAdmin ? onAddNew : undefined}\n      searchable={false}\n      emptyMessage=\"No KPI definitions found\"\n    />\n  );\n}\n\nexport default KPIsTable;\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/performance/ReviewsTable.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":47},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'handleDelete'. Either include it or remove the dependency array.","line":210,"column":6,"nodeType":"ArrayExpression","endLine":210,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [onView, onRate, isAdmin, handleDelete]","fix":{"range":[6667,6692],"text":"[onView, onRate, isAdmin, handleDelete]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * ReviewsTable Component\n * \n * Displays performance reviews using GenericCRUDTable and React Query hooks\n * Supports filtering, rating, and viewing review details\n */\n\nimport React, { useMemo } from 'react';\nimport { Eye, Star, Trash2, Users, CheckCircle } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { GenericCRUDTable, Column, Action } from '@/components/shared/crud/GenericCRUDTable';\nimport { usePerformanceReviews, useDeletePerformanceReview, PerformanceReview, ReviewFilters } from '@/hooks';\nimport { log } from '@/lib/logger';\n\ninterface ReviewsTableProps {\n  searchTerm?: string;\n  statusFilter?: string;\n  isAdmin?: boolean;\n  onAddNew: () => void;\n  onView: (review: PerformanceReview) => void;\n  onRate: (review: PerformanceReview) => void;\n  onSuccess?: (message: string) => void;\n  onError?: (message: string) => void;\n}\n\nexport function ReviewsTable({\n  searchTerm = '',\n  statusFilter = 'all',\n  isAdmin = false,\n  onAddNew,\n  onView,\n  onRate,\n  onSuccess,\n  onError,\n}: ReviewsTableProps) {\n  // Build filters for the query\n  const filters: ReviewFilters = {};\n  if (statusFilter !== 'all') {\n    filters.status = statusFilter;\n  }\n\n  // Fetch reviews using React Query\n  const { data: reviews = [], isLoading, error } = usePerformanceReviews(filters);\n  \n  const deleteReviewMutation = useDeletePerformanceReview();\n\n  // Filter reviews based on search term\n  // Note: employee data comes as 'employees' from the joined query\n  const filteredReviews = useMemo(() => {\n    if (!searchTerm) return reviews;\n    const lowerSearch = searchTerm.toLowerCase();\n    return reviews.filter(review => {\n      const employee = review.employees || review.employee;\n      const reviewType = review.performance_review_types || review.review_types || review.review_type;\n      return (\n        employee?.first_name?.toLowerCase().includes(lowerSearch) ||\n        employee?.last_name?.toLowerCase().includes(lowerSearch) ||\n        reviewType?.name?.toLowerCase().includes(lowerSearch)\n      );\n    });\n  }, [reviews, searchTerm]);\n\n  // Handle review deletion\n  const handleDelete = async (review: PerformanceReview) => {\n    if (!window.confirm('Are you sure you want to delete this review?')) {\n      return;\n    }\n\n    try {\n      await deleteReviewMutation.mutateAsync(review.id);\n      log.track('review_deleted', { reviewId: review.id });\n      onSuccess?.('Review deleted successfully');\n    } catch (err: any) {\n      log.error('Failed to delete review', { error: err.message });\n      onError?.(err.message || 'Failed to delete review');\n    }\n  };\n\n  // Get status badge styles\n  const getStatusBadge = (status: string) => {\n    const styles: Record<string, string> = {\n      pending: 'bg-yellow-100 text-yellow-800',\n      in_progress: 'bg-blue-100 text-blue-800',\n      completed: 'bg-green-100 text-green-800',\n      overdue: 'bg-red-100 text-red-800',\n      cancelled: 'bg-gray-100 text-gray-800',\n    };\n\n    return (\n      <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${styles[status] || 'bg-gray-100 text-gray-800'}`}>\n        {status?.replace(/_/g, ' ')}\n      </span>\n    );\n  };\n\n  // Define table columns\n  // Note: Handle both naming conventions from joined data (employees vs employee, performance_review_types vs review_type)\n  const columns: Column<PerformanceReview>[] = useMemo(() => [\n    {\n      key: 'employee',\n      label: 'Employee',\n      sortable: true,\n      render: (review) => {\n        const employee = review.employees || review.employee;\n        return (\n          <div className=\"flex items-center\">\n            <div className=\"flex-shrink-0 h-10 w-10 bg-indigo-100 rounded-full flex items-center justify-center\">\n              <Users className=\"h-5 w-5 text-indigo-600\" />\n            </div>\n            <div className=\"ml-4\">\n              <div className=\"text-sm font-medium text-gray-900\">\n                {employee?.first_name} {employee?.last_name}\n              </div>\n              <div className=\"text-sm text-gray-500\">{employee?.department}</div>\n            </div>\n          </div>\n        );\n      },\n    },\n    {\n      key: 'review_type',\n      label: 'Review Type',\n      sortable: true,\n      render: (review) => {\n        const reviewType = review.performance_review_types || review.review_types || review.review_type;\n        return (\n          <div>\n            <div className=\"text-sm text-gray-900\">{reviewType?.name}</div>\n            <div className=\"text-sm text-gray-500\">{reviewType?.frequency}</div>\n          </div>\n        );\n      },\n    },\n    {\n      key: 'review_period',\n      label: 'Period',\n      render: (review) => (\n        <div className=\"text-sm text-gray-500\">\n          {review.review_period_start && format(new Date(review.review_period_start), 'MMM d, yyyy')} -<br />\n          {review.review_period_end && format(new Date(review.review_period_end), 'MMM d, yyyy')}\n        </div>\n      ),\n    },\n    {\n      key: 'review_due_date',\n      label: 'Due Date',\n      sortable: true,\n      render: (review) => (\n        <span className=\"text-sm text-gray-900\">\n          {review.review_due_date && format(new Date(review.review_due_date), 'MMM d, yyyy')}\n        </span>\n      ),\n    },\n    {\n      key: 'status',\n      label: 'Status',\n      sortable: true,\n      render: (review) => getStatusBadge(review.status),\n    },\n    {\n      key: 'overall_rating',\n      label: 'Rating',\n      sortable: true,\n      render: (review) => {\n        if (!review.overall_rating) {\n          return <span className=\"text-sm text-gray-400\">Not rated</span>;\n        }\n        return (\n          <div className=\"flex items-center\">\n            <Star className=\"h-4 w-4 text-yellow-400 fill-current mr-1\" />\n            <span className=\"text-sm font-medium text-gray-900\">\n              {typeof review.overall_rating === 'number' \n                ? review.overall_rating.toFixed(1) \n                : review.overall_rating}\n            </span>\n          </div>\n        );\n      },\n    },\n  ], []);\n\n  // Define row actions\n  const actions: Action<PerformanceReview>[] = useMemo(() => {\n    const actionsList: Action<PerformanceReview>[] = [\n      {\n        label: 'View Details',\n        icon: Eye,\n        onClick: onView,\n        variant: 'primary',\n      },\n      {\n        label: 'Rate Review',\n        icon: Star,\n        onClick: onRate,\n        variant: 'default',\n        show: (review) => review.status !== 'completed',\n      },\n    ];\n\n    if (isAdmin) {\n      actionsList.push({\n        label: 'Delete',\n        icon: Trash2,\n        onClick: handleDelete,\n        variant: 'danger',\n      });\n    }\n\n    return actionsList;\n  }, [onView, onRate, isAdmin]);\n\n  return (\n    <GenericCRUDTable\n      data={filteredReviews}\n      columns={columns}\n      loading={isLoading}\n      error={error?.message}\n      actions={actions}\n      onAdd={isAdmin ? onAddNew : undefined}\n      searchable={false}\n      emptyMessage=\"No reviews found\"\n    />\n  );\n}\n\nexport default ReviewsTable;\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/performance/__tests__/GoalsList.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mockGoals' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * GoalsList Component Tests\n */\n\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { renderWithProviders, screen, waitFor, fireEvent } from '@/test/utils';\nimport { mockGoals, createHookMocks } from '@/test/mocks';\nimport { GoalsList } from '../GoalsList';\n\n// Mock the hooks module\nvi.mock('@/hooks', () => {\n  const mocks = createHookMocks();\n  return {\n    useAllPerformanceGoals: mocks.useAllPerformanceGoals,\n    useDeleteGoal: mocks.useDeleteGoal,\n  };\n});\n\n// Mock the logger\nvi.mock('@/lib/logger', () => ({\n  log: {\n    info: vi.fn(),\n    error: vi.fn(),\n    track: vi.fn(),\n  },\n}));\n\ndescribe('GoalsList', () => {\n  const defaultProps = {\n    isAdmin: true,\n    onAddNew: vi.fn(),\n    onEdit: vi.fn(),\n    onSuccess: vi.fn(),\n    onError: vi.fn(),\n  };\n\n  beforeEach(() => {\n    vi.clearAllMocks();\n  });\n\n  it('renders goals as cards', async () => {\n    renderWithProviders(<GoalsList {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Complete certification')).toBeInTheDocument();\n      expect(screen.getByText('Increase sales quota')).toBeInTheDocument();\n    });\n  });\n\n  it('displays goal descriptions', async () => {\n    renderWithProviders(<GoalsList {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Obtain AWS Solutions Architect certification')).toBeInTheDocument();\n      expect(screen.getByText('Achieve 120% of quarterly sales target')).toBeInTheDocument();\n    });\n  });\n\n  it('shows employee names', async () => {\n    renderWithProviders(<GoalsList {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Alice Johnson')).toBeInTheDocument();\n      expect(screen.getByText('Bob Williams')).toBeInTheDocument();\n    });\n  });\n\n  it('displays priority badges', async () => {\n    renderWithProviders(<GoalsList {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('high')).toBeInTheDocument();\n      expect(screen.getByText('critical')).toBeInTheDocument();\n    });\n  });\n\n  it('shows status badges', async () => {\n    renderWithProviders(<GoalsList {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('on track')).toBeInTheDocument();\n      expect(screen.getByText('at risk')).toBeInTheDocument();\n    });\n  });\n\n  it('displays progress bars with correct percentages', async () => {\n    renderWithProviders(<GoalsList {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('65%')).toBeInTheDocument();\n      expect(screen.getByText('45%')).toBeInTheDocument();\n    });\n  });\n\n  it('shows goal type', async () => {\n    renderWithProviders(<GoalsList {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('development goal')).toBeInTheDocument();\n      expect(screen.getByText('individual goal')).toBeInTheDocument();\n    });\n  });\n\n  it('displays target date', async () => {\n    renderWithProviders(<GoalsList {...defaultProps} />);\n\n    await waitFor(() => {\n      // Check for formatted target dates - multiple elements with Target:\n      const targetElements = screen.getAllByText(/Target:/);\n      expect(targetElements.length).toBeGreaterThan(0);\n    });\n  });\n\n  it('filters goals by search term in title', async () => {\n    renderWithProviders(<GoalsList {...defaultProps} searchTerm=\"certification\" />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Complete certification')).toBeInTheDocument();\n      expect(screen.queryByText('Increase sales quota')).not.toBeInTheDocument();\n    });\n  });\n\n  it('filters goals by employee name', async () => {\n    renderWithProviders(<GoalsList {...defaultProps} searchTerm=\"Alice\" />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Complete certification')).toBeInTheDocument();\n      expect(screen.queryByText('Increase sales quota')).not.toBeInTheDocument();\n    });\n  });\n\n  it('filters goals by description', async () => {\n    renderWithProviders(<GoalsList {...defaultProps} searchTerm=\"AWS\" />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Complete certification')).toBeInTheDocument();\n      expect(screen.queryByText('Increase sales quota')).not.toBeInTheDocument();\n    });\n  });\n\n  it('calls onEdit when edit button is clicked', async () => {\n    renderWithProviders(<GoalsList {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Complete certification')).toBeInTheDocument();\n    });\n\n    const editButtons = screen.getAllByTitle('Edit Goal');\n    fireEvent.click(editButtons[0]);\n\n    expect(defaultProps.onEdit).toHaveBeenCalledWith(\n      expect.objectContaining({ id: 'goal-1' })\n    );\n  });\n\n  it('shows delete button for admin users', async () => {\n    renderWithProviders(<GoalsList {...defaultProps} isAdmin={true} />);\n\n    await waitFor(() => {\n      const deleteButtons = screen.getAllByTitle('Delete Goal');\n      expect(deleteButtons.length).toBeGreaterThan(0);\n    });\n  });\n\n  it('hides delete button for non-admin users', async () => {\n    renderWithProviders(<GoalsList {...defaultProps} isAdmin={false} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Complete certification')).toBeInTheDocument();\n      expect(screen.queryByTitle('Delete Goal')).not.toBeInTheDocument();\n    });\n  });\n\n  it('shows add button for admin users', async () => {\n    renderWithProviders(<GoalsList {...defaultProps} isAdmin={true} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Add New Goal')).toBeInTheDocument();\n    });\n  });\n\n  it('shows empty state when no goals', async () => {\n    // Pass a searchTerm that won't match any goals to show empty state\n    renderWithProviders(<GoalsList {...defaultProps} searchTerm=\"XYZ_NO_MATCH_999\" />);\n\n    await waitFor(() => {\n      expect(screen.getByText('No goals found')).toBeInTheDocument();\n    });\n  });\n\n  it('applies correct color to progress bar based on percentage', async () => {\n    // Re-render with fresh mocks to ensure goals data is present\n    renderWithProviders(<GoalsList {...defaultProps} />);\n\n    await waitFor(() => {\n      // Check that progress percentages are displayed\n      // Note: This verifies goals with progress are being rendered\n      expect(screen.getByText('Complete certification')).toBeInTheDocument();\n      expect(screen.getByText('Increase sales quota')).toBeInTheDocument();\n    });\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/performance/__tests__/KPIsTable.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mockKPIs' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * KPIsTable Component Tests\n */\n\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { renderWithProviders, screen, waitFor, fireEvent } from '@/test/utils';\nimport { mockKPIs, createHookMocks } from '@/test/mocks';\nimport { KPIsTable } from '../KPIsTable';\n\n// Mock the hooks module\nvi.mock('@/hooks', () => {\n  const mocks = createHookMocks();\n  return {\n    useKPIs: mocks.useKPIs,\n  };\n});\n\n// Mock the logger\nvi.mock('@/lib/logger', () => ({\n  log: {\n    info: vi.fn(),\n    error: vi.fn(),\n    track: vi.fn(),\n  },\n}));\n\ndescribe('KPIsTable', () => {\n  const defaultProps = {\n    isAdmin: true,\n    onAddNew: vi.fn(),\n    onEdit: vi.fn(),\n    onSuccess: vi.fn(),\n    onError: vi.fn(),\n  };\n\n  beforeEach(() => {\n    vi.clearAllMocks();\n  });\n\n  it('renders KPI listings correctly', async () => {\n    renderWithProviders(<KPIsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Customer Satisfaction Score')).toBeInTheDocument();\n      expect(screen.getByText('Revenue Growth')).toBeInTheDocument();\n    });\n  });\n\n  it('displays KPI descriptions', async () => {\n    renderWithProviders(<KPIsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Average CSAT rating from customer surveys')).toBeInTheDocument();\n      expect(screen.getByText('Quarter-over-quarter revenue increase')).toBeInTheDocument();\n    });\n  });\n\n  it('shows category badges', async () => {\n    renderWithProviders(<KPIsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('customer success')).toBeInTheDocument();\n      expect(screen.getByText('sales')).toBeInTheDocument();\n    });\n  });\n\n  it('displays measurement units', async () => {\n    renderWithProviders(<KPIsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      // Both KPIs use '%' as measurement unit\n      const percentUnits = screen.getAllByText('%');\n      expect(percentUnits.length).toBeGreaterThan(0);\n    });\n  });\n\n  it('shows target values', async () => {\n    renderWithProviders(<KPIsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('90 %')).toBeInTheDocument();\n      expect(screen.getByText('15 %')).toBeInTheDocument();\n    });\n  });\n\n  it('displays calculation method', async () => {\n    renderWithProviders(<KPIsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('average')).toBeInTheDocument();\n      expect(screen.getByText('percentage change')).toBeInTheDocument();\n    });\n  });\n\n  it('shows active status badges', async () => {\n    renderWithProviders(<KPIsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      const activeBadges = screen.getAllByText('Active');\n      expect(activeBadges.length).toBeGreaterThan(0);\n    });\n  });\n\n  it('filters KPIs by search term', async () => {\n    renderWithProviders(<KPIsTable {...defaultProps} searchTerm=\"Customer\" />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Customer Satisfaction Score')).toBeInTheDocument();\n      expect(screen.queryByText('Revenue Growth')).not.toBeInTheDocument();\n    });\n  });\n\n  it('filters KPIs by category', async () => {\n    renderWithProviders(<KPIsTable {...defaultProps} searchTerm=\"sales\" />);\n\n    await waitFor(() => {\n      expect(screen.queryByText('Customer Satisfaction Score')).not.toBeInTheDocument();\n      expect(screen.getByText('Revenue Growth')).toBeInTheDocument();\n    });\n  });\n\n  it('calls onEdit when edit button is clicked', async () => {\n    renderWithProviders(<KPIsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Customer Satisfaction Score')).toBeInTheDocument();\n    });\n\n    const editButtons = screen.getAllByTitle('Edit');\n    fireEvent.click(editButtons[0]);\n\n    expect(defaultProps.onEdit).toHaveBeenCalledWith(\n      expect.objectContaining({ id: 'kpi-1' })\n    );\n  });\n\n  it('shows add button for admin users', async () => {\n    renderWithProviders(<KPIsTable {...defaultProps} isAdmin={true} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Add New')).toBeInTheDocument();\n    });\n  });\n\n  it('hides add button for non-admin users', async () => {\n    renderWithProviders(<KPIsTable {...defaultProps} isAdmin={false} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Customer Satisfaction Score')).toBeInTheDocument();\n      expect(screen.queryByText('Add New')).not.toBeInTheDocument();\n    });\n  });\n\n  it('shows deactivate button for admin users on active KPIs', async () => {\n    renderWithProviders(<KPIsTable {...defaultProps} isAdmin={true} />);\n\n    await waitFor(() => {\n      const deactivateButtons = screen.getAllByTitle('Deactivate');\n      expect(deactivateButtons.length).toBeGreaterThan(0);\n    });\n  });\n\n  it('hides deactivate button for non-admin users', async () => {\n    renderWithProviders(<KPIsTable {...defaultProps} isAdmin={false} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Customer Satisfaction Score')).toBeInTheDocument();\n      expect(screen.queryByTitle('Deactivate')).not.toBeInTheDocument();\n    });\n  });\n\n  it('shows empty message when no KPIs match search', async () => {\n    renderWithProviders(<KPIsTable {...defaultProps} searchTerm=\"NonexistentKPI\" />);\n\n    await waitFor(() => {\n      expect(screen.getByText('No KPI definitions found')).toBeInTheDocument();\n    });\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/performance/__tests__/ReviewsTable.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mockReviews' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * ReviewsTable Component Tests\n */\n\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { renderWithProviders, screen, waitFor, fireEvent } from '@/test/utils';\nimport { mockReviews, createHookMocks } from '@/test/mocks';\nimport { ReviewsTable } from '../ReviewsTable';\n\n// Mock the hooks module\nvi.mock('@/hooks', () => {\n  const mocks = createHookMocks();\n  return {\n    usePerformanceReviews: mocks.usePerformanceReviews,\n    useDeletePerformanceReview: mocks.useDeletePerformanceReview,\n  };\n});\n\n// Mock the logger\nvi.mock('@/lib/logger', () => ({\n  log: {\n    info: vi.fn(),\n    error: vi.fn(),\n    track: vi.fn(),\n  },\n}));\n\ndescribe('ReviewsTable', () => {\n  const defaultProps = {\n    isAdmin: true,\n    onAddNew: vi.fn(),\n    onView: vi.fn(),\n    onRate: vi.fn(),\n    onSuccess: vi.fn(),\n    onError: vi.fn(),\n  };\n\n  beforeEach(() => {\n    vi.clearAllMocks();\n  });\n\n  it('renders review listings correctly', async () => {\n    renderWithProviders(<ReviewsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Alice Johnson')).toBeInTheDocument();\n      expect(screen.getByText('Bob Williams')).toBeInTheDocument();\n    });\n  });\n\n  it('displays employee department', async () => {\n    renderWithProviders(<ReviewsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Engineering')).toBeInTheDocument();\n      expect(screen.getByText('Sales')).toBeInTheDocument();\n    });\n  });\n\n  it('shows review type and frequency', async () => {\n    renderWithProviders(<ReviewsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Quarterly Review')).toBeInTheDocument();\n      expect(screen.getByText('Annual Review')).toBeInTheDocument();\n      expect(screen.getByText('quarterly')).toBeInTheDocument();\n      expect(screen.getByText('annual')).toBeInTheDocument();\n    });\n  });\n\n  it('displays status badges', async () => {\n    renderWithProviders(<ReviewsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('pending')).toBeInTheDocument();\n      expect(screen.getByText('completed')).toBeInTheDocument();\n    });\n  });\n\n  it('shows rating for completed reviews', async () => {\n    renderWithProviders(<ReviewsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('4.5')).toBeInTheDocument();\n    });\n  });\n\n  it('shows \"Not rated\" for pending reviews', async () => {\n    renderWithProviders(<ReviewsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Not rated')).toBeInTheDocument();\n    });\n  });\n\n  it('filters reviews by search term', async () => {\n    renderWithProviders(<ReviewsTable {...defaultProps} searchTerm=\"Alice\" />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Alice Johnson')).toBeInTheDocument();\n      expect(screen.queryByText('Bob Williams')).not.toBeInTheDocument();\n    });\n  });\n\n  it('filters by review type', async () => {\n    renderWithProviders(<ReviewsTable {...defaultProps} searchTerm=\"Quarterly\" />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Alice Johnson')).toBeInTheDocument();\n      expect(screen.queryByText('Bob Williams')).not.toBeInTheDocument();\n    });\n  });\n\n  it('calls onView when view button is clicked', async () => {\n    renderWithProviders(<ReviewsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Alice Johnson')).toBeInTheDocument();\n    });\n\n    const viewButtons = screen.getAllByTitle('View Details');\n    fireEvent.click(viewButtons[0]);\n\n    expect(defaultProps.onView).toHaveBeenCalledWith(\n      expect.objectContaining({ id: 'rev-1' })\n    );\n  });\n\n  it('calls onRate for pending reviews', async () => {\n    renderWithProviders(<ReviewsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('pending')).toBeInTheDocument();\n    });\n\n    const rateButtons = screen.getAllByTitle('Rate Review');\n    if (rateButtons.length > 0) {\n      fireEvent.click(rateButtons[0]);\n      expect(defaultProps.onRate).toHaveBeenCalled();\n    }\n  });\n\n  it('shows delete button for admin users', async () => {\n    renderWithProviders(<ReviewsTable {...defaultProps} isAdmin={true} />);\n\n    await waitFor(() => {\n      const deleteButtons = screen.getAllByTitle('Delete');\n      expect(deleteButtons.length).toBeGreaterThan(0);\n    });\n  });\n\n  it('hides delete button for non-admin users', async () => {\n    renderWithProviders(<ReviewsTable {...defaultProps} isAdmin={false} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Alice Johnson')).toBeInTheDocument();\n      expect(screen.queryByTitle('Delete')).not.toBeInTheDocument();\n    });\n  });\n\n  it('displays review period dates', async () => {\n    renderWithProviders(<ReviewsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      // Check for period formatted dates - component shows \"Jan 1 - Mar 31, 2024\"\n      // Multiple dates contain 2024 so use getAllByText\n      const dateElements = screen.getAllByText(/2024/);\n      expect(dateElements.length).toBeGreaterThan(0);\n    });\n  });\n\n  it('shows empty message when no reviews match search', async () => {\n    renderWithProviders(<ReviewsTable {...defaultProps} searchTerm=\"NonexistentEmployee\" />);\n\n    await waitFor(() => {\n      expect(screen.getByText('No reviews found')).toBeInTheDocument();\n    });\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/performance/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/recruitment/ApplicationKanbanBoard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/recruitment/ApplicationsTable.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Trash2' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Star' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":37},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'getStagesForApp' and 'handleStageChange'. Either include them or remove the dependency array.","line":221,"column":6,"nodeType":"ArrayExpression","endLine":221,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [getStagesForApp, handleStageChange]","fix":{"range":[7156,7172],"text":"[getStagesForApp, handleStageChange]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * ApplicationsTable Component\n * \n * Displays applications using GenericCRUDTable and React Query hooks\n * Supports filtering by job, workflow stage, and search\n */\n\nimport React, { useMemo } from 'react';\nimport { Eye, Calendar, Trash2, Star } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { GenericCRUDTable, Column, Action } from '@/components/shared/crud/GenericCRUDTable';\nimport { useApplications, useUpdateApplication, useDeleteApplication, Application } from '@/hooks';\nimport { log } from '@/lib/logger';\n\ninterface WorkflowStage {\n  id: string;\n  name: string;\n  workflow_id: string;\n  stage_order: number;\n}\n\ninterface ApplicationsTableProps {\n  searchTerm?: string;\n  selectedJobId?: string;\n  selectedStageId?: string;\n  selectedWorkflowId?: string;\n  workflowStages?: WorkflowStage[];\n  onAddNew: () => void;\n  onView: (application: Application) => void;\n  onScheduleInterview: (application: Application) => void;\n  onStageChange?: (applicationId: string, stageId: string) => void;\n  onSuccess?: (message: string) => void;\n  onError?: (message: string) => void;\n}\n\nexport function ApplicationsTable({\n  searchTerm = '',\n  selectedJobId = 'all',\n  selectedStageId = 'all',\n  selectedWorkflowId = 'all',\n  workflowStages = [],\n  onAddNew,\n  onView,\n  onScheduleInterview,\n  onStageChange,\n  onSuccess,\n  onError,\n}: ApplicationsTableProps) {\n  // Fetch applications using React Query with optional job filter\n  const { data: applications = [], isLoading, error } = useApplications({\n    jobId: selectedJobId !== 'all' ? selectedJobId : undefined,\n  });\n  \n  const deleteApplicationMutation = useDeleteApplication();\n  const updateApplicationMutation = useUpdateApplication();\n\n  // Filter applications based on search and filters\n  const filteredApplications = useMemo(() => {\n    let filtered = applications;\n\n    // Filter by search term\n    if (searchTerm) {\n      const lowerSearch = searchTerm.toLowerCase();\n      filtered = filtered.filter(app =>\n        `${app.applicant_first_name} ${app.applicant_last_name} ${app.applicant_email}`\n          .toLowerCase()\n          .includes(lowerSearch)\n      );\n    }\n\n    // Filter by stage\n    if (selectedStageId !== 'all') {\n      filtered = filtered.filter(app => app.current_stage_id === selectedStageId);\n    }\n\n    // Filter by workflow (through job)\n    if (selectedWorkflowId !== 'all') {\n      filtered = filtered.filter(app => \n        (app as any).job_postings?.workflow_id === selectedWorkflowId\n      );\n    }\n\n    return filtered;\n  }, [applications, searchTerm, selectedStageId, selectedWorkflowId]);\n\n  // Get stages for a specific application\n  const getStagesForApp = (app: Application): WorkflowStage[] => {\n    const workflowId = (app as any).job_postings?.workflow_id;\n    if (!workflowId) return [];\n    return workflowStages.filter(s => s.workflow_id === workflowId);\n  };\n\n  // Handle stage update\n  const handleStageChange = async (app: Application, stageId: string) => {\n    try {\n      await updateApplicationMutation.mutateAsync({\n        id: app.id,\n        data: { current_stage_id: stageId },\n      });\n      \n      log.track('application_stage_updated', { applicationId: app.id, stageId });\n      onStageChange?.(app.id, stageId);\n      onSuccess?.('Application stage updated');\n    } catch (err: any) {\n      log.error('Failed to update application stage', { error: err.message });\n      onError?.(err.message || 'Failed to update stage');\n    }\n  };\n\n  // Handle application deletion\n  const handleDelete = async (app: Application) => {\n    if (!window.confirm('Are you sure you want to delete this application?')) {\n      return;\n    }\n\n    try {\n      await deleteApplicationMutation.mutateAsync(app.id);\n      log.track('application_deleted', { applicationId: app.id });\n      onSuccess?.('Application deleted successfully');\n    } catch (err: any) {\n      log.error('Failed to delete application', { error: err.message });\n      onError?.(err.message || 'Failed to delete application');\n    }\n  };\n\n  // Define table columns\n  const columns: Column<Application>[] = useMemo(() => [\n    {\n      key: 'applicant_name',\n      label: 'Applicant',\n      sortable: true,\n      render: (app) => (\n        <div>\n          <div className=\"text-sm font-medium text-gray-900\">\n            {app.applicant_first_name} {app.applicant_last_name}\n          </div>\n          <div className=\"text-sm text-gray-500\">{app.applicant_email}</div>\n        </div>\n      ),\n    },\n    {\n      key: 'job_title',\n      label: 'Job',\n      render: (app) => (app as any).job_postings?.job_title || 'Unknown Job',\n    },\n    {\n      key: 'applied_at',\n      label: 'Applied Date',\n      sortable: true,\n      render: (app) => app.applied_at ? format(new Date(app.applied_at), 'MMM dd, yyyy') : '-',\n    },\n    {\n      key: 'current_stage_id',\n      label: 'Stage',\n      render: (app) => {\n        const appStages = getStagesForApp(app);\n        if (appStages.length === 0) {\n          return <span className=\"text-sm text-gray-500 italic\">No workflow</span>;\n        }\n        return (\n          <select\n            value={app.current_stage_id || ''}\n            onChange={(e) => handleStageChange(app, e.target.value)}\n            onClick={(e) => e.stopPropagation()}\n            className=\"text-xs font-semibold rounded-full px-3 py-1 border-gray-300 outline-none focus:ring-2 focus:ring-indigo-500\"\n          >\n            <option value=\"\">Select Stage</option>\n            {appStages.map((stage) => (\n              <option key={stage.id} value={stage.id}>\n                {stage.name}\n              </option>\n            ))}\n          </select>\n        );\n      },\n    },\n    {\n      key: 'ai_score',\n      label: 'AI Score',\n      sortable: true,\n      render: (app) => {\n        if (!app.ai_score) return <span className=\"text-gray-400\">N/A</span>;\n        return (\n          <div className=\"flex items-center\">\n            <div className=\"w-16 bg-gray-200 rounded-full h-2 mr-2\">\n              <div\n                className={`h-2 rounded-full ${\n                  app.ai_score >= 75\n                    ? 'bg-green-600'\n                    : app.ai_score >= 50\n                    ? 'bg-yellow-500'\n                    : 'bg-red-500'\n                }`}\n                style={{ width: `${app.ai_score}%` }}\n              />\n            </div>\n            <span className=\"text-sm font-medium\">{app.ai_score}/100</span>\n          </div>\n        );\n      },\n    },\n    {\n      key: 'status',\n      label: 'Status',\n      render: (app) => {\n        const statusColors: Record<string, string> = {\n          new: 'bg-blue-100 text-blue-800',\n          screening: 'bg-yellow-100 text-yellow-800',\n          interview: 'bg-purple-100 text-purple-800',\n          offer: 'bg-indigo-100 text-indigo-800',\n          hired: 'bg-green-100 text-green-800',\n          rejected: 'bg-red-100 text-red-800',\n        };\n        return (\n          <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${statusColors[app.status?.toLowerCase()] || 'bg-gray-100 text-gray-800'}`}>\n            {app.status}\n          </span>\n        );\n      },\n    },\n  ], [workflowStages]);\n\n  // Define row actions\n  const actions: Action<Application>[] = useMemo(() => [\n    {\n      label: 'View Details',\n      icon: Eye,\n      onClick: onView,\n      variant: 'primary',\n    },\n    {\n      label: 'Schedule Interview',\n      icon: Calendar,\n      onClick: onScheduleInterview,\n      variant: 'default',\n    },\n  ], [onView, onScheduleInterview]);\n\n  return (\n    <GenericCRUDTable\n      data={filteredApplications}\n      columns={columns}\n      loading={isLoading}\n      error={error?.message}\n      actions={actions}\n      onAdd={onAddNew}\n      onDelete={handleDelete}\n      searchable={false}\n      title=\"Applications\"\n      emptyMessage=\"No applications found\"\n    />\n  );\n}\n\nexport default ApplicationsTable;\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/recruitment/InterviewsTable.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Edit' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Eye' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":51},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'handleCancel' and 'handleMarkComplete'. Either include them or remove the dependency array.","line":236,"column":6,"nodeType":"ArrayExpression","endLine":236,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [handleCancel, handleMarkComplete, onReschedule]","fix":{"range":[7200,7214],"text":"[handleCancel, handleMarkComplete, onReschedule]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * InterviewsTable Component\n * \n * Displays interviews using GenericCRUDTable and React Query hooks\n * Supports viewing, editing, rescheduling, and completing interviews\n */\n\nimport React, { useMemo } from 'react';\nimport { Calendar, Edit, CheckCircle, XCircle, Eye, Video, Phone } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { GenericCRUDTable, Column, Action } from '@/components/shared/crud/GenericCRUDTable';\nimport { useInterviews, useUpdateInterview, Interview } from '@/hooks';\nimport { log } from '@/lib/logger';\n\ninterface InterviewsTableProps {\n  searchTerm?: string;\n  onAddNew: () => void;\n  onEdit: (interview: Interview) => void;\n  onReschedule: (interview: Interview) => void;\n  onSuccess?: (message: string) => void;\n  onError?: (message: string) => void;\n}\n\nexport function InterviewsTable({\n  searchTerm = '',\n  onAddNew,\n  onEdit,\n  onReschedule,\n  onSuccess,\n  onError,\n}: InterviewsTableProps) {\n  // Fetch interviews using React Query\n  const { data: interviews = [], isLoading, error } = useInterviews();\n  const updateInterviewMutation = useUpdateInterview();\n\n  // Filter interviews based on search term\n  const filteredInterviews = useMemo(() => {\n    if (!searchTerm) return interviews;\n    const lowerSearch = searchTerm.toLowerCase();\n    return interviews.filter(interview =>\n      interview.interview_type?.toLowerCase().includes(lowerSearch) ||\n      interview.status?.toLowerCase().includes(lowerSearch) ||\n      interview.location?.toLowerCase().includes(lowerSearch)\n    );\n  }, [interviews, searchTerm]);\n\n  // Handle marking interview as complete\n  const handleMarkComplete = async (interview: Interview) => {\n    if (!window.confirm('Mark this interview as completed?')) {\n      return;\n    }\n\n    try {\n      await updateInterviewMutation.mutateAsync({\n        id: interview.id,\n        data: { status: 'completed' },\n      });\n      log.track('interview_completed', { interviewId: interview.id });\n      onSuccess?.('Interview marked as completed');\n    } catch (err: any) {\n      log.error('Failed to complete interview', { error: err.message });\n      onError?.(err.message || 'Failed to update interview');\n    }\n  };\n\n  // Handle cancelling interview\n  const handleCancel = async (interview: Interview) => {\n    if (!window.confirm('Are you sure you want to cancel this interview?')) {\n      return;\n    }\n\n    try {\n      await updateInterviewMutation.mutateAsync({\n        id: interview.id,\n        data: { status: 'cancelled' },\n      });\n      log.track('interview_cancelled', { interviewId: interview.id });\n      onSuccess?.('Interview cancelled');\n    } catch (err: any) {\n      log.error('Failed to cancel interview', { error: err.message });\n      onError?.(err.message || 'Failed to cancel interview');\n    }\n  };\n\n  // Get interview type icon\n  const getInterviewTypeIcon = (type: string) => {\n    switch (type?.toLowerCase()) {\n      case 'video':\n      case 'video_call':\n        return <Video className=\"w-4 h-4 text-blue-500\" />;\n      case 'phone':\n      case 'phone_screen':\n        return <Phone className=\"w-4 h-4 text-green-500\" />;\n      default:\n        return <Calendar className=\"w-4 h-4 text-gray-500\" />;\n    }\n  };\n\n  // Define table columns\n  const columns: Column<Interview>[] = useMemo(() => [\n    {\n      key: 'application_id',\n      label: 'Application',\n      render: (interview) => {\n        const appId = interview.application_id;\n        return (\n          <span className=\"font-mono text-sm\">\n            {appId?.substring(0, 8)}...\n          </span>\n        );\n      },\n    },\n    {\n      key: 'interview_type',\n      label: 'Type',\n      sortable: true,\n      render: (interview) => (\n        <div className=\"flex items-center gap-2\">\n          {getInterviewTypeIcon(interview.interview_type)}\n          <span className=\"capitalize\">{interview.interview_type?.replace('_', ' ')}</span>\n        </div>\n      ),\n    },\n    {\n      key: 'scheduled_date',\n      label: 'Scheduled Date',\n      sortable: true,\n      render: (interview) => {\n        if (!interview.scheduled_date) return '-';\n        const date = new Date(interview.scheduled_date);\n        return (\n          <div>\n            <div className=\"text-sm font-medium\">\n              {format(date, 'MMM dd, yyyy')}\n            </div>\n            <div className=\"text-xs text-gray-500\">\n              {format(date, 'HH:mm')}\n            </div>\n          </div>\n        );\n      },\n    },\n    {\n      key: 'duration',\n      label: 'Duration',\n      render: (interview) => \n        interview.duration ? `${interview.duration} min` : '60 min',\n    },\n    {\n      key: 'location',\n      label: 'Location',\n      render: (interview) => {\n        if (interview.meeting_link) {\n          return (\n            <a\n              href={interview.meeting_link}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"text-indigo-600 hover:text-indigo-900 text-sm\"\n              onClick={(e) => e.stopPropagation()}\n            >\n              Join Meeting\n            </a>\n          );\n        }\n        return interview.location || 'TBD';\n      },\n    },\n    {\n      key: 'status',\n      label: 'Status',\n      sortable: true,\n      render: (interview) => {\n        const statusColors: Record<string, string> = {\n          scheduled: 'bg-blue-100 text-blue-800',\n          confirmed: 'bg-green-100 text-green-800',\n          completed: 'bg-gray-100 text-gray-800',\n          cancelled: 'bg-red-100 text-red-800',\n          no_show: 'bg-yellow-100 text-yellow-800',\n        };\n        return (\n          <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${statusColors[interview.status] || 'bg-gray-100 text-gray-800'}`}>\n            {interview.status}\n          </span>\n        );\n      },\n    },\n    {\n      key: 'rating',\n      label: 'Rating',\n      sortable: true,\n      render: (interview) => {\n        if (!interview.rating) return <span className=\"text-gray-400\">N/A</span>;\n        return (\n          <div className=\"flex items-center\">\n            {[1, 2, 3, 4, 5].map((star) => (\n              <span\n                key={star}\n                className={`text-sm ${\n                  star <= interview.rating! ? 'text-yellow-400' : 'text-gray-300'\n                }`}\n              >\n                â\n              </span>\n            ))}\n            <span className=\"ml-1 text-sm font-medium\">{interview.rating}/5</span>\n          </div>\n        );\n      },\n    },\n  ], []);\n\n  // Define row actions\n  const actions: Action<Interview>[] = useMemo(() => [\n    {\n      label: 'Reschedule',\n      icon: Calendar,\n      onClick: onReschedule,\n      variant: 'default',\n      show: (interview) => interview.status !== 'completed' && interview.status !== 'cancelled',\n    },\n    {\n      label: 'Mark Complete',\n      icon: CheckCircle,\n      onClick: handleMarkComplete,\n      variant: 'primary',\n      show: (interview) => interview.status === 'scheduled',\n    },\n    {\n      label: 'Cancel',\n      icon: XCircle,\n      onClick: handleCancel,\n      variant: 'danger',\n      show: (interview) => interview.status !== 'completed' && interview.status !== 'cancelled',\n    },\n  ], [onReschedule]);\n\n  return (\n    <GenericCRUDTable\n      data={filteredInterviews}\n      columns={columns}\n      loading={isLoading}\n      error={error?.message}\n      actions={actions}\n      onAdd={onAddNew}\n      onEdit={onEdit}\n      searchable={false}\n      title=\"Interviews\"\n      emptyMessage=\"No interviews scheduled\"\n    />\n  );\n}\n\nexport default InterviewsTable;\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/recruitment/JobsTable.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Edit' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Trash2' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'XCircle' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":49},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'handleStatusChange'. Either include it or remove the dependency array.","line":145,"column":6,"nodeType":"ArrayExpression","endLine":145,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [handleStatusChange]","fix":{"range":[4632,4634],"text":"[handleStatusChange]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * JobsTable Component\n * \n * Displays job postings using GenericCRUDTable and React Query hooks\n * Reduces code from RecruitmentPage by extracting job-related table logic\n */\n\nimport React, { useMemo } from 'react';\nimport { Eye, Edit, Trash2, CheckCircle, XCircle } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { GenericCRUDTable, Column, Action } from '@/components/shared/crud/GenericCRUDTable';\nimport { useJobs, useUpdateJob, useDeleteJob, JobPosting } from '@/hooks';\nimport { log } from '@/lib/logger';\n\ninterface JobsTableProps {\n  searchTerm?: string;\n  onAddNew: () => void;\n  onEdit: (job: JobPosting) => void;\n  onView: (job: JobPosting) => void;\n  onSuccess?: (message: string) => void;\n  onError?: (message: string) => void;\n}\n\nexport function JobsTable({\n  searchTerm = '',\n  onAddNew,\n  onEdit,\n  onView,\n  onSuccess,\n  onError,\n}: JobsTableProps) {\n  // Fetch jobs using React Query\n  const { data: jobs = [], isLoading, error } = useJobs();\n  const updateJobMutation = useUpdateJob();\n  const deleteJobMutation = useDeleteJob();\n\n  // Filter jobs based on search term\n  const filteredJobs = useMemo(() => {\n    if (!searchTerm) return jobs;\n    const lowerSearch = searchTerm.toLowerCase();\n    return jobs.filter(job =>\n      job.job_title.toLowerCase().includes(lowerSearch) ||\n      job.department.toLowerCase().includes(lowerSearch) ||\n      (job.location && job.location.toLowerCase().includes(lowerSearch))\n    );\n  }, [jobs, searchTerm]);\n\n  // Handle job status update\n  const handleStatusChange = async (job: JobPosting, newStatus: string) => {\n    try {\n      await updateJobMutation.mutateAsync({\n        id: job.id,\n        data: { status: newStatus },\n      });\n      log.track('job_status_updated', { jobId: job.id, newStatus });\n      onSuccess?.(`Job status updated to ${newStatus}`);\n    } catch (err: any) {\n      log.error('Failed to update job status', { error: err.message, jobId: job.id });\n      onError?.(err.message || 'Failed to update job status');\n    }\n  };\n\n  // Handle job deletion\n  const handleDelete = async (job: JobPosting) => {\n    if (!window.confirm('Are you sure you want to delete this job posting?')) {\n      return;\n    }\n\n    try {\n      await deleteJobMutation.mutateAsync(job.id);\n      log.track('job_deleted', { jobId: job.id });\n      onSuccess?.('Job posting deleted successfully');\n    } catch (err: any) {\n      log.error('Failed to delete job', { error: err.message, jobId: job.id });\n      onError?.(err.message || 'Failed to delete job posting');\n    }\n  };\n\n  // Define table columns\n  const columns: Column<JobPosting>[] = useMemo(() => [\n    {\n      key: 'job_title',\n      label: 'Job Title',\n      sortable: true,\n      render: (job) => (\n        <div>\n          <div className=\"text-sm font-medium text-gray-900\">{job.job_title}</div>\n          <div className=\"text-sm text-gray-500\">{job.location || 'Remote'}</div>\n        </div>\n      ),\n    },\n    {\n      key: 'department',\n      label: 'Department',\n      sortable: true,\n    },\n    {\n      key: 'employment_type',\n      label: 'Type',\n      render: (job) => (\n        <span className=\"capitalize\">{job.employment_type?.replace('_', ' ')}</span>\n      ),\n    },\n    {\n      key: 'status',\n      label: 'Status',\n      render: (job) => (\n        <select\n          value={job.status}\n          onChange={(e) => handleStatusChange(job, e.target.value)}\n          onClick={(e) => e.stopPropagation()}\n          className={`text-xs font-semibold rounded-full px-3 py-1 border-0 outline-none cursor-pointer ${\n            job.status === 'active' || job.status === 'open'\n              ? 'bg-green-100 text-green-800'\n              : job.status === 'closed'\n              ? 'bg-red-100 text-red-800'\n              : job.status === 'draft'\n              ? 'bg-yellow-100 text-yellow-800'\n              : 'bg-gray-100 text-gray-800'\n          }`}\n        >\n          <option value=\"draft\">Draft</option>\n          <option value=\"active\">Published</option>\n          <option value=\"closed\">Closed</option>\n          <option value=\"cancelled\">Cancelled</option>\n        </select>\n      ),\n    },\n    {\n      key: 'salary_range',\n      label: 'Salary',\n      render: (job) => {\n        if (job.salary_range_min && job.salary_range_max) {\n          return `$${job.salary_range_min.toLocaleString()} - $${job.salary_range_max.toLocaleString()}`;\n        }\n        return 'Not specified';\n      },\n    },\n    {\n      key: 'created_at',\n      label: 'Posted',\n      sortable: true,\n      render: (job) => job.created_at ? format(new Date(job.created_at), 'MMM dd, yyyy') : '-',\n    },\n  ], []);\n\n  // Define row actions\n  const actions: Action<JobPosting>[] = useMemo(() => [\n    {\n      label: 'View Details',\n      icon: Eye,\n      onClick: onView,\n      variant: 'default',\n    },\n  ], [onView]);\n\n  return (\n    <GenericCRUDTable\n      data={filteredJobs}\n      columns={columns}\n      loading={isLoading}\n      error={error?.message}\n      actions={actions}\n      onAdd={onAddNew}\n      onEdit={onEdit}\n      onDelete={handleDelete}\n      searchable={false} // Search is handled externally\n      title=\"Job Postings\"\n      emptyMessage=\"No job postings found\"\n    />\n  );\n}\n\nexport default JobsTable;\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/recruitment/ValuesInterviewScoring.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'newRedFlag' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":275,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":275,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setNewRedFlag' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":275,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":275,"endColumn":37}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { supabase } from '@/lib/supabase';\nimport {\n    Heart,\n    Star,\n    CheckCircle,\n    AlertTriangle,\n    Loader2,\n    User,\n    MessageSquare,\n    ThumbsUp,\n    ThumbsDown,\n    Award,\n    Target,\n    Users,\n    Shield\n} from 'lucide-react';\nimport { log } from '@/lib/logger';\n\n// ==========================================\n// CQC Values-Based Recruitment\n// ==========================================\n// This component implements values-based interview scoring\n// to assess candidates against care sector values:\n// - Compassion\n// - Dignity & Respect\n// - Commitment to Quality\n// - Person-Centred Care\n// - Integrity\n// - Teamwork\n// ==========================================\n\ninterface ValueScore {\n    value: string;\n    score: number; // 1-5\n    evidence: string;\n    flags: string[];\n}\n\ninterface InterviewScoreData {\n    candidate_name: string;\n    position: string;\n    interviewer_name: string;\n    interview_date: string;\n    interview_type: 'phone' | 'video' | 'in-person' | 'panel';\n\n    value_scores: ValueScore[];\n\n    // Overall Assessment\n    overall_impression: string;\n    strengths: string[];\n    development_areas: string[];\n\n    // Recommendation\n    recommendation: 'strongly_recommend' | 'recommend' | 'consider' | 'do_not_recommend';\n    recommendation_notes: string;\n\n    // Red Flags\n    red_flags: string[];\n    safeguarding_concerns: boolean;\n    safeguarding_notes?: string;\n}\n\ninterface ValuesInterviewScoringProps {\n    applicationId?: string;\n    candidateName?: string;\n    positionTitle?: string;\n    onSuccess: () => void;\n    onCancel: () => void;\n}\n\n// CQC-aligned care values with interview questions\nconst careValues = [\n    {\n        id: 'compassion',\n        name: 'Compassion',\n        description: 'Shows genuine concern for others\\' wellbeing and suffering',\n        icon: Heart,\n        color: 'text-pink-600',\n        bgColor: 'bg-pink-50',\n        borderColor: 'border-pink-200',\n        questions: [\n            \"Tell me about a time when you went above and beyond to help someone in need.\",\n            \"How do you respond when someone is distressed or upset?\",\n            \"Describe a situation where you had to show patience with someone who was struggling.\"\n        ],\n        lookFor: [\n            \"Genuine empathy in responses\",\n            \"Puts others' needs first\",\n            \"Shows emotional intelligence\",\n            \"Can describe specific caring actions\"\n        ],\n        redFlags: [\n            \"Dismissive of others' feelings\",\n            \"Task-focused over person-focused\",\n            \"Lacks emotional awareness\",\n            \"Unable to give concrete examples\"\n        ]\n    },\n    {\n        id: 'dignity_respect',\n        name: 'Dignity & Respect',\n        description: 'Treats everyone with dignity regardless of circumstances',\n        icon: Shield,\n        color: 'text-purple-600',\n        bgColor: 'bg-purple-50',\n        borderColor: 'border-purple-200',\n        questions: [\n            \"How do you ensure you respect someone's privacy and dignity?\",\n            \"Tell me about a time you advocated for someone's choices even if you disagreed.\",\n            \"How would you handle a situation where a colleague was being disrespectful to a service user?\"\n        ],\n        lookFor: [\n            \"Respects autonomy and choice\",\n            \"Understands consent\",\n            \"Maintains confidentiality\",\n            \"Challenges discrimination\"\n        ],\n        redFlags: [\n            \"Patronising language\",\n            \"Makes assumptions about people\",\n            \"Overrides preferences 'for their own good'\",\n            \"Dismisses cultural differences\"\n        ]\n    },\n    {\n        id: 'person_centred',\n        name: 'Person-Centred Care',\n        description: 'Puts the individual at the heart of care decisions',\n        icon: User,\n        color: 'text-blue-600',\n        bgColor: 'bg-blue-50',\n        borderColor: 'border-blue-200',\n        questions: [\n            \"How do you find out what matters most to someone you're caring for?\",\n            \"Describe how you would adapt your care approach for different individuals.\",\n            \"What does 'person-centred care' mean to you?\"\n        ],\n        lookFor: [\n            \"Asks about preferences\",\n            \"Flexible approach\",\n            \"Involves person in decisions\",\n            \"Recognises individuality\"\n        ],\n        redFlags: [\n            \"One-size-fits-all approach\",\n            \"Focus on tasks over relationships\",\n            \"Doesn't mention asking the person\",\n            \"Organisational needs over individual needs\"\n        ]\n    },\n    {\n        id: 'integrity',\n        name: 'Integrity & Honesty',\n        description: 'Demonstrates honesty, accountability and ethical behaviour',\n        icon: Award,\n        color: 'text-amber-600',\n        bgColor: 'bg-amber-50',\n        borderColor: 'border-amber-200',\n        questions: [\n            \"Tell me about a time you made a mistake at work. How did you handle it?\",\n            \"What would you do if you saw a colleague doing something you thought was wrong?\",\n            \"How do you handle confidential or sensitive information?\"\n        ],\n        lookFor: [\n            \"Admits to mistakes\",\n            \"Would report concerns\",\n            \"Understands boundaries\",\n            \"Takes responsibility\"\n        ],\n        redFlags: [\n            \"Blames others\",\n            \"Would cover up issues\",\n            \"Boundary violations\",\n            \"Evasive answers\"\n        ]\n    },\n    {\n        id: 'commitment_quality',\n        name: 'Commitment to Quality',\n        description: 'Strives for high standards and continuous improvement',\n        icon: Target,\n        color: 'text-green-600',\n        bgColor: 'bg-green-50',\n        borderColor: 'border-green-200',\n        questions: [\n            \"How do you ensure you deliver high-quality care?\",\n            \"Tell me about a time you identified a way to improve something.\",\n            \"How do you keep your knowledge and skills up to date?\"\n        ],\n        lookFor: [\n            \"Proactive about standards\",\n            \"Seeks feedback\",\n            \"Commits to learning\",\n            \"Takes pride in work\"\n        ],\n        redFlags: [\n            \"'Good enough' mentality\",\n            \"Resistant to change\",\n            \"Defensive about feedback\",\n            \"No interest in development\"\n        ]\n    },\n    {\n        id: 'teamwork',\n        name: 'Teamwork & Communication',\n        description: 'Works collaboratively and communicates effectively',\n        icon: Users,\n        color: 'text-cyan-600',\n        bgColor: 'bg-cyan-50',\n        borderColor: 'border-cyan-200',\n        questions: [\n            \"Describe a time you had to work with someone difficult.\",\n            \"How do you ensure important information is communicated effectively?\",\n            \"What does being a good team member mean to you?\"\n        ],\n        lookFor: [\n            \"Collaborative mindset\",\n            \"Good communication\",\n            \"Supports colleagues\",\n            \"Handles conflict constructively\"\n        ],\n        redFlags: [\n            \"Prefers to work alone\",\n            \"Poor communication examples\",\n            \"Blames team members\",\n            \"Conflict-avoidant or aggressive\"\n        ]\n    }\n];\n\nconst recommendationOptions = [\n    { value: 'strongly_recommend', label: 'Strongly Recommend', color: 'bg-green-600', icon: ThumbsUp },\n    { value: 'recommend', label: 'Recommend', color: 'bg-blue-600', icon: CheckCircle },\n    { value: 'consider', label: 'Consider with Reservations', color: 'bg-amber-600', icon: AlertTriangle },\n    { value: 'do_not_recommend', label: 'Do Not Recommend', color: 'bg-red-600', icon: ThumbsDown }\n];\n\nexport default function ValuesInterviewScoring({\n    applicationId,\n    candidateName = '',\n    positionTitle = '',\n    onSuccess,\n    onCancel\n}: ValuesInterviewScoringProps) {\n    const { currentTenant } = useTenant();\n    const [loading, setLoading] = useState(false);\n    const [activeValue, setActiveValue] = useState(0);\n\n    const [formData, setFormData] = useState<InterviewScoreData>({\n        candidate_name: candidateName,\n        position: positionTitle,\n        interviewer_name: '',\n        interview_date: new Date().toISOString().split('T')[0],\n        interview_type: 'in-person',\n        value_scores: careValues.map(v => ({\n            value: v.id,\n            score: 0,\n            evidence: '',\n            flags: []\n        })),\n        overall_impression: '',\n        strengths: [],\n        development_areas: [],\n        recommendation: 'consider',\n        recommendation_notes: '',\n        red_flags: [],\n        safeguarding_concerns: false,\n        safeguarding_notes: ''\n    });\n\n    const [newStrength, setNewStrength] = useState('');\n    const [newDevelopmentArea, setNewDevelopmentArea] = useState('');\n    const [newRedFlag, setNewRedFlag] = useState('');\n\n    const updateValueScore = (valueId: string, field: 'score' | 'evidence', value: any) => {\n        setFormData(prev => ({\n            ...prev,\n            value_scores: prev.value_scores.map(vs =>\n                vs.value === valueId ? { ...vs, [field]: value } : vs\n            )\n        }));\n    };\n\n    const toggleValueFlag = (valueId: string, flag: string) => {\n        setFormData(prev => ({\n            ...prev,\n            value_scores: prev.value_scores.map(vs => {\n                if (vs.value !== valueId) return vs;\n                const flags = vs.flags.includes(flag)\n                    ? vs.flags.filter(f => f !== flag)\n                    : [...vs.flags, flag];\n                return { ...vs, flags };\n            })\n        }));\n    };\n\n    const addItem = (field: 'strengths' | 'development_areas' | 'red_flags', value: string, setValue: (v: string) => void) => {\n        if (!value.trim()) return;\n        setFormData(prev => ({\n            ...prev,\n            [field]: [...prev[field], value.trim()]\n        }));\n        setValue('');\n    };\n\n    const removeItem = (field: 'strengths' | 'development_areas' | 'red_flags', index: number) => {\n        setFormData(prev => ({\n            ...prev,\n            [field]: prev[field].filter((_, i) => i !== index)\n        }));\n    };\n\n    const calculateOverallScore = () => {\n        const scoredValues = formData.value_scores.filter(vs => vs.score > 0);\n        if (scoredValues.length === 0) return 0;\n        const total = scoredValues.reduce((sum, vs) => sum + vs.score, 0);\n        return Math.round((total / (scoredValues.length * 5)) * 100);\n    };\n\n    const getScoreColor = (score: number) => {\n        if (score >= 80) return 'text-green-600';\n        if (score >= 60) return 'text-blue-600';\n        if (score >= 40) return 'text-amber-600';\n        return 'text-red-600';\n    };\n\n    const handleSubmit = async () => {\n        if (!currentTenant) return;\n\n        // Validation\n        const unscoredValues = formData.value_scores.filter(vs => vs.score === 0);\n        if (unscoredValues.length > 0) {\n            alert(`Please score all values before submitting. Missing: ${unscoredValues.map(vs =>\n                careValues.find(cv => cv.id === vs.value)?.name\n            ).join(', ')}`);\n            return;\n        }\n\n        setLoading(true);\n        try {\n            const overallScore = calculateOverallScore();\n\n            const { error } = await supabase\n                .from('interview_evaluations')\n                .insert({\n                    tenant_id: currentTenant.id,\n                    application_id: applicationId,\n                    candidate_name: formData.candidate_name,\n                    position: formData.position,\n                    interviewer_name: formData.interviewer_name,\n                    interview_date: formData.interview_date,\n                    interview_type: formData.interview_type,\n                    evaluation_type: 'values_based',\n\n                    // Scores\n                    value_scores: formData.value_scores,\n                    overall_score: overallScore,\n\n                    // Assessment\n                    overall_impression: formData.overall_impression,\n                    strengths: formData.strengths,\n                    development_areas: formData.development_areas,\n\n                    // Recommendation\n                    recommendation: formData.recommendation,\n                    recommendation_notes: formData.recommendation_notes,\n\n                    // Flags\n                    red_flags: formData.red_flags,\n                    safeguarding_concerns: formData.safeguarding_concerns,\n                    safeguarding_notes: formData.safeguarding_notes,\n\n                    // Metadata\n                    submitted_at: new Date().toISOString()\n                });\n\n            if (error) throw error;\n\n            onSuccess();\n        } catch (error) {\n            log.error('Error submitting evaluation', error, { component: 'ValuesInterviewScoring', action: 'handleSubmit' });\n            alert('Failed to submit evaluation. Please try again.');\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const currentValue = careValues[activeValue];\n    const currentScore = formData.value_scores.find(vs => vs.value === currentValue.id);\n    const overallScore = calculateOverallScore();\n\n    return (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n            <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-6xl max-h-[95vh] overflow-hidden flex flex-col\">\n                {/* Header */}\n                <div className=\"p-4 md:p-6 border-b border-gray-200 bg-gradient-to-r from-purple-600 to-indigo-600\">\n                    <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-3\">\n                            <Heart className=\"w-8 h-8 text-white\" />\n                            <div>\n                                <h2 className=\"text-xl font-bold text-white\">Values-Based Interview Scoring</h2>\n                                <p className=\"text-purple-100 text-sm\">CQC Aligned Assessment</p>\n                            </div>\n                        </div>\n                        <div className=\"flex items-center gap-4\">\n                            <div className=\"text-right\">\n                                <div className=\"text-white/70 text-xs\">Overall Score</div>\n                                <div className={`text-2xl font-bold text-white`}>\n                                    {overallScore}%\n                                </div>\n                            </div>\n                            <button onClick={onCancel} className=\"text-white/80 hover:text-white text-2xl\">\n                                &times;\n                            </button>\n                        </div>\n                    </div>\n                </div>\n\n                <div className=\"flex-1 overflow-hidden flex\">\n                    {/* Sidebar - Value Navigation */}\n                    <div className=\"w-64 border-r border-gray-200 bg-gray-50 overflow-y-auto hidden md:block\">\n                        <div className=\"p-4 border-b border-gray-200\">\n                            <h3 className=\"font-semibold text-gray-700 text-sm uppercase tracking-wider\">Values Assessment</h3>\n                        </div>\n                        <nav className=\"p-2\">\n                            {careValues.map((value, index) => {\n                                const Icon = value.icon;\n                                const score = formData.value_scores.find(vs => vs.value === value.id)?.score || 0;\n\n                                return (\n                                    <button\n                                        key={value.id}\n                                        onClick={() => setActiveValue(index)}\n                                        className={`w-full text-left p-3 rounded-lg mb-1 flex items-center gap-3 transition-all ${activeValue === index\n                                            ? 'bg-white shadow-md border border-gray-200'\n                                            : 'hover:bg-white/50'\n                                            }`}\n                                    >\n                                        <div className={`p-2 rounded-lg ${value.bgColor}`}>\n                                            <Icon className={`w-4 h-4 ${value.color}`} />\n                                        </div>\n                                        <div className=\"flex-1 min-w-0\">\n                                            <div className=\"text-sm font-medium text-gray-900 truncate\">{value.name}</div>\n                                            <div className=\"text-xs text-gray-500\">\n                                                {score > 0 ? (\n                                                    <span className=\"flex items-center gap-1\">\n                                                        {[...Array(5)].map((_, i) => (\n                                                            <Star\n                                                                key={i}\n                                                                className={`w-3 h-3 ${i < score ? 'text-amber-500 fill-amber-500' : 'text-gray-300'}`}\n                                                            />\n                                                        ))}\n                                                    </span>\n                                                ) : (\n                                                    <span className=\"text-amber-600\">Not scored</span>\n                                                )}\n                                            </div>\n                                        </div>\n                                    </button>\n                                );\n                            })}\n                        </nav>\n\n                        {/* Summary Button */}\n                        <div className=\"p-4 border-t border-gray-200\">\n                            <button\n                                onClick={() => setActiveValue(-1)}\n                                className={`w-full p-3 rounded-lg flex items-center gap-3 transition-all ${activeValue === -1\n                                    ? 'bg-purple-100 border border-purple-300'\n                                    : 'bg-white border border-gray-200 hover:border-purple-300'\n                                    }`}\n                            >\n                                <Award className=\"w-5 h-5 text-purple-600\" />\n                                <span className=\"font-medium text-gray-900\">Summary & Submit</span>\n                            </button>\n                        </div>\n                    </div>\n\n                    {/* Main Content */}\n                    <div className=\"flex-1 overflow-y-auto\">\n                        {/* Interview Details - always visible at top when scoring values */}\n                        {activeValue >= 0 && activeValue === 0 && (\n                            <div className=\"p-6 border-b border-gray-200 bg-gray-50\">\n                                <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Candidate Name</label>\n                                        <input\n                                            type=\"text\"\n                                            value={formData.candidate_name}\n                                            onChange={e => setFormData(prev => ({ ...prev, candidate_name: e.target.value }))}\n                                            className=\"block w-full rounded-lg border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500\"\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Position</label>\n                                        <input\n                                            type=\"text\"\n                                            value={formData.position}\n                                            onChange={e => setFormData(prev => ({ ...prev, position: e.target.value }))}\n                                            className=\"block w-full rounded-lg border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500\"\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Interviewer</label>\n                                        <input\n                                            type=\"text\"\n                                            value={formData.interviewer_name}\n                                            onChange={e => setFormData(prev => ({ ...prev, interviewer_name: e.target.value }))}\n                                            className=\"block w-full rounded-lg border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500\"\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Interview Date</label>\n                                        <input\n                                            type=\"date\"\n                                            value={formData.interview_date}\n                                            onChange={e => setFormData(prev => ({ ...prev, interview_date: e.target.value }))}\n                                            className=\"block w-full rounded-lg border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500\"\n                                        />\n                                    </div>\n                                </div>\n                            </div>\n                        )}\n\n                        {/* Value Scoring View */}\n                        {activeValue >= 0 && (\n                            <div className=\"p-6\">\n                                <div className={`${currentValue.bgColor} ${currentValue.borderColor} border rounded-xl p-6 mb-6`}>\n                                    <div className=\"flex items-start gap-4\">\n                                        <div className={`p-3 ${currentValue.bgColor} rounded-xl`}>\n                                            {React.createElement(currentValue.icon, { className: `w-8 h-8 ${currentValue.color}` })}\n                                        </div>\n                                        <div className=\"flex-1\">\n                                            <h3 className=\"text-xl font-bold text-gray-900\">{currentValue.name}</h3>\n                                            <p className=\"text-gray-600 mt-1\">{currentValue.description}</p>\n                                        </div>\n                                    </div>\n\n                                    {/* Score Selection */}\n                                    <div className=\"mt-6\">\n                                        <label className=\"block text-sm font-semibold text-gray-700 mb-3\">Score this value</label>\n                                        <div className=\"flex gap-2\">\n                                            {[1, 2, 3, 4, 5].map(score => (\n                                                <button\n                                                    key={score}\n                                                    onClick={() => updateValueScore(currentValue.id, 'score', score)}\n                                                    className={`flex-1 py-3 px-4 rounded-lg font-medium transition-all ${currentScore?.score === score\n                                                        ? 'bg-purple-600 text-white shadow-lg'\n                                                        : 'bg-white border border-gray-300 hover:border-purple-400'\n                                                        }`}\n                                                >\n                                                    {score}\n                                                    <div className=\"text-xs mt-1 opacity-75\">\n                                                        {score === 1 ? 'Poor' : score === 2 ? 'Below Exp.' : score === 3 ? 'Meets Exp.' : score === 4 ? 'Exceeds' : 'Outstanding'}\n                                                    </div>\n                                                </button>\n                                            ))}\n                                        </div>\n                                    </div>\n                                </div>\n\n                                {/* Interview Questions */}\n                                <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                                    <div>\n                                        <h4 className=\"font-semibold text-gray-900 mb-3 flex items-center gap-2\">\n                                            <MessageSquare className=\"w-4 h-4 text-purple-600\" />\n                                            Suggested Questions\n                                        </h4>\n                                        <div className=\"space-y-2\">\n                                            {currentValue.questions.map((q, i) => (\n                                                <div key={i} className=\"bg-white border border-gray-200 rounded-lg p-3 text-sm\">\n                                                    {q}\n                                                </div>\n                                            ))}\n                                        </div>\n                                    </div>\n\n                                    <div>\n                                        <h4 className=\"font-semibold text-gray-900 mb-3 flex items-center gap-2\">\n                                            <CheckCircle className=\"w-4 h-4 text-green-600\" />\n                                            What to Look For\n                                        </h4>\n                                        <div className=\"bg-white border border-green-200 rounded-lg p-3 mb-4\">\n                                            <div className=\"space-y-1\">\n                                                {currentValue.lookFor.map((item, i) => (\n                                                    <label key={i} className=\"flex items-center gap-2 text-sm cursor-pointer\">\n                                                        <input\n                                                            type=\"checkbox\"\n                                                            checked={currentScore?.flags.includes(`positive:${item}`)}\n                                                            onChange={() => toggleValueFlag(currentValue.id, `positive:${item}`)}\n                                                            className=\"w-4 h-4 text-green-600 rounded\"\n                                                        />\n                                                        <span className=\"text-gray-700\">{item}</span>\n                                                    </label>\n                                                ))}\n                                            </div>\n                                        </div>\n\n                                        <h4 className=\"font-semibold text-gray-900 mb-3 flex items-center gap-2\">\n                                            <AlertTriangle className=\"w-4 h-4 text-red-600\" />\n                                            Red Flags\n                                        </h4>\n                                        <div className=\"bg-white border border-red-200 rounded-lg p-3\">\n                                            <div className=\"space-y-1\">\n                                                {currentValue.redFlags.map((item, i) => (\n                                                    <label key={i} className=\"flex items-center gap-2 text-sm cursor-pointer\">\n                                                        <input\n                                                            type=\"checkbox\"\n                                                            checked={currentScore?.flags.includes(`redflag:${item}`)}\n                                                            onChange={() => toggleValueFlag(currentValue.id, `redflag:${item}`)}\n                                                            className=\"w-4 h-4 text-red-600 rounded\"\n                                                        />\n                                                        <span className=\"text-gray-700\">{item}</span>\n                                                    </label>\n                                                ))}\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                {/* Evidence Notes */}\n                                <div className=\"mt-6\">\n                                    <label className=\"block text-sm font-semibold text-gray-700 mb-2\">\n                                        Evidence Notes\n                                    </label>\n                                    <textarea\n                                        value={currentScore?.evidence || ''}\n                                        onChange={e => updateValueScore(currentValue.id, 'evidence', e.target.value)}\n                                        rows={4}\n                                        className=\"block w-full rounded-lg border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500\"\n                                        placeholder=\"Record specific examples and quotes from the candidate that demonstrate (or lack) this value...\"\n                                    />\n                                </div>\n\n                                {/* Navigation */}\n                                <div className=\"flex justify-between mt-6 pt-4 border-t border-gray-200\">\n                                    <button\n                                        onClick={() => activeValue > 0 ? setActiveValue(activeValue - 1) : null}\n                                        disabled={activeValue === 0}\n                                        className=\"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 disabled:opacity-50\"\n                                    >\n                                        Previous Value\n                                    </button>\n                                    <button\n                                        onClick={() => activeValue < careValues.length - 1 ? setActiveValue(activeValue + 1) : setActiveValue(-1)}\n                                        className=\"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700\"\n                                    >\n                                        {activeValue < careValues.length - 1 ? 'Next Value' : 'Go to Summary'}\n                                    </button>\n                                </div>\n                            </div>\n                        )}\n\n                        {/* Summary View */}\n                        {activeValue === -1 && (\n                            <div className=\"p-6 space-y-6\">\n                                {/* Score Summary */}\n                                <div className=\"bg-gradient-to-r from-purple-50 to-indigo-50 rounded-xl p-6 border border-purple-200\">\n                                    <h3 className=\"text-lg font-bold text-gray-900 mb-4\">Values Score Summary</h3>\n                                    <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4\">\n                                        {careValues.map(value => {\n                                            const score = formData.value_scores.find(vs => vs.value === value.id)?.score || 0;\n                                            const Icon = value.icon;\n                                            return (\n                                                <div key={value.id} className=\"bg-white rounded-lg p-4 text-center shadow-sm\">\n                                                    <Icon className={`w-6 h-6 ${value.color} mx-auto mb-2`} />\n                                                    <div className=\"text-xs text-gray-600 mb-1\">{value.name}</div>\n                                                    <div className={`text-2xl font-bold ${score >= 4 ? 'text-green-600' : score >= 3 ? 'text-blue-600' : score > 0 ? 'text-amber-600' : 'text-gray-300'}`}>\n                                                        {score}/5\n                                                    </div>\n                                                </div>\n                                            );\n                                        })}\n                                    </div>\n                                    <div className=\"mt-4 text-center\">\n                                        <div className=\"text-sm text-gray-600\">Overall Values Alignment</div>\n                                        <div className={`text-4xl font-bold ${getScoreColor(overallScore)}`}>\n                                            {overallScore}%\n                                        </div>\n                                    </div>\n                                </div>\n\n                                {/* Overall Impression */}\n                                <div>\n                                    <label className=\"block text-sm font-semibold text-gray-700 mb-2\">Overall Impression</label>\n                                    <textarea\n                                        value={formData.overall_impression}\n                                        onChange={e => setFormData(prev => ({ ...prev, overall_impression: e.target.value }))}\n                                        rows={4}\n                                        className=\"block w-full rounded-lg border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500\"\n                                        placeholder=\"Summarise your overall impression of the candidate's values alignment...\"\n                                    />\n                                </div>\n\n                                {/* Strengths & Development */}\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                    <div>\n                                        <label className=\"block text-sm font-semibold text-gray-700 mb-2\">Key Strengths</label>\n                                        <div className=\"flex gap-2 mb-2\">\n                                            <input\n                                                type=\"text\"\n                                                value={newStrength}\n                                                onChange={e => setNewStrength(e.target.value)}\n                                                onKeyPress={e => e.key === 'Enter' && (e.preventDefault(), addItem('strengths', newStrength, setNewStrength))}\n                                                className=\"flex-1 rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500\"\n                                                placeholder=\"Add a strength...\"\n                                            />\n                                            <button\n                                                type=\"button\"\n                                                onClick={() => addItem('strengths', newStrength, setNewStrength)}\n                                                className=\"px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700\"\n                                            >\n                                                +\n                                            </button>\n                                        </div>\n                                        <div className=\"space-y-1\">\n                                            {formData.strengths.map((s, i) => (\n                                                <div key={i} className=\"flex items-center gap-2 bg-green-50 px-3 py-2 rounded-lg\">\n                                                    <CheckCircle className=\"w-4 h-4 text-green-600\" />\n                                                    <span className=\"flex-1 text-sm\">{s}</span>\n                                                    <button onClick={() => removeItem('strengths', i)} className=\"text-gray-400 hover:text-red-500\">&times;</button>\n                                                </div>\n                                            ))}\n                                        </div>\n                                    </div>\n\n                                    <div>\n                                        <label className=\"block text-sm font-semibold text-gray-700 mb-2\">Development Areas</label>\n                                        <div className=\"flex gap-2 mb-2\">\n                                            <input\n                                                type=\"text\"\n                                                value={newDevelopmentArea}\n                                                onChange={e => setNewDevelopmentArea(e.target.value)}\n                                                onKeyPress={e => e.key === 'Enter' && (e.preventDefault(), addItem('development_areas', newDevelopmentArea, setNewDevelopmentArea))}\n                                                className=\"flex-1 rounded-lg border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500\"\n                                                placeholder=\"Add a development area...\"\n                                            />\n                                            <button\n                                                type=\"button\"\n                                                onClick={() => addItem('development_areas', newDevelopmentArea, setNewDevelopmentArea)}\n                                                className=\"px-3 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700\"\n                                            >\n                                                +\n                                            </button>\n                                        </div>\n                                        <div className=\"space-y-1\">\n                                            {formData.development_areas.map((d, i) => (\n                                                <div key={i} className=\"flex items-center gap-2 bg-amber-50 px-3 py-2 rounded-lg\">\n                                                    <Target className=\"w-4 h-4 text-amber-600\" />\n                                                    <span className=\"flex-1 text-sm\">{d}</span>\n                                                    <button onClick={() => removeItem('development_areas', i)} className=\"text-gray-400 hover:text-red-500\">&times;</button>\n                                                </div>\n                                            ))}\n                                        </div>\n                                    </div>\n                                </div>\n\n                                {/* Safeguarding Concerns */}\n                                <div className=\"bg-red-50 border border-red-200 rounded-xl p-4\">\n                                    <label className=\"flex items-center gap-3 cursor-pointer\">\n                                        <input\n                                            type=\"checkbox\"\n                                            checked={formData.safeguarding_concerns}\n                                            onChange={e => setFormData(prev => ({ ...prev, safeguarding_concerns: e.target.checked }))}\n                                            className=\"w-5 h-5 text-red-600 rounded\"\n                                        />\n                                        <div>\n                                            <span className=\"font-semibold text-red-800\">Safeguarding Concerns Identified</span>\n                                            <p className=\"text-sm text-red-700\">Check this if any safeguarding concerns arose during the interview</p>\n                                        </div>\n                                    </label>\n                                    {formData.safeguarding_concerns && (\n                                        <textarea\n                                            value={formData.safeguarding_notes}\n                                            onChange={e => setFormData(prev => ({ ...prev, safeguarding_notes: e.target.value }))}\n                                            rows={3}\n                                            className=\"mt-3 block w-full rounded-lg border-red-300 shadow-sm focus:border-red-500 focus:ring-red-500\"\n                                            placeholder=\"Describe the safeguarding concerns...\"\n                                        />\n                                    )}\n                                </div>\n\n                                {/* Recommendation */}\n                                <div>\n                                    <label className=\"block text-sm font-semibold text-gray-700 mb-3\">Recommendation</label>\n                                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n                                        {recommendationOptions.map(opt => {\n                                            const Icon = opt.icon;\n                                            return (\n                                                <button\n                                                    key={opt.value}\n                                                    type=\"button\"\n                                                    onClick={() => setFormData(prev => ({ ...prev, recommendation: opt.value as any }))}\n                                                    className={`p-4 rounded-xl border-2 transition-all ${formData.recommendation === opt.value\n                                                        ? `${opt.color} text-white border-transparent shadow-lg`\n                                                        : 'bg-white border-gray-200 hover:border-gray-300'\n                                                        }`}\n                                                >\n                                                    <Icon className=\"w-6 h-6 mx-auto mb-2\" />\n                                                    <div className=\"text-sm font-medium\">{opt.label}</div>\n                                                </button>\n                                            );\n                                        })}\n                                    </div>\n                                    <textarea\n                                        value={formData.recommendation_notes}\n                                        onChange={e => setFormData(prev => ({ ...prev, recommendation_notes: e.target.value }))}\n                                        rows={3}\n                                        className=\"mt-4 block w-full rounded-lg border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500\"\n                                        placeholder=\"Add any notes to support your recommendation...\"\n                                    />\n                                </div>\n                            </div>\n                        )}\n                    </div>\n                </div>\n\n                {/* Footer */}\n                <div className=\"p-4 border-t border-gray-200 bg-gray-50 flex justify-between\">\n                    <button\n                        type=\"button\"\n                        onClick={onCancel}\n                        className=\"px-5 py-2.5 bg-white text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium\"\n                    >\n                        Cancel\n                    </button>\n                    <button\n                        type=\"button\"\n                        onClick={handleSubmit}\n                        disabled={loading}\n                        className=\"px-5 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 font-medium flex items-center gap-2\"\n                    >\n                        {loading && <Loader2 className=\"w-4 h-4 animate-spin\" />}\n                        <Award className=\"w-4 h-4\" />\n                        Submit Evaluation\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/recruitment/__tests__/ApplicationKanbanBoard.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mockApplications' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * ApplicationKanbanBoard Component Tests\n */\n\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { renderWithProviders, screen, waitFor, fireEvent } from '@/test/utils';\nimport { mockApplications, mockWorkflowStages, createHookMocks } from '@/test/mocks';\nimport { ApplicationKanbanBoard } from '../ApplicationKanbanBoard';\n\n// Mock the hooks module\nvi.mock('@/hooks', () => {\n  const mocks = createHookMocks();\n  return {\n    useApplications: mocks.useApplications,\n    useUpdateApplication: mocks.useUpdateApplication,\n  };\n});\n\n// Mock the logger\nvi.mock('@/lib/logger', () => ({\n  log: {\n    info: vi.fn(),\n    error: vi.fn(),\n    track: vi.fn(),\n  },\n}));\n\ndescribe('ApplicationKanbanBoard', () => {\n  const defaultProps = {\n    selectedWorkflowId: 'wf-1',\n    workflowStages: mockWorkflowStages,\n    onViewApplication: vi.fn(),\n    onScheduleInterview: vi.fn(),\n    onStageChange: vi.fn(),\n    onSuccess: vi.fn(),\n    onError: vi.fn(),\n  };\n\n  beforeEach(() => {\n    vi.clearAllMocks();\n  });\n\n  it('prompts to select workflow when none selected', async () => {\n    renderWithProviders(\n      <ApplicationKanbanBoard {...defaultProps} selectedWorkflowId=\"all\" />\n    );\n\n    await waitFor(() => {\n      expect(screen.getByText('Select a Workflow')).toBeInTheDocument();\n      expect(screen.getByText('Please select a specific workflow to view the Kanban board.')).toBeInTheDocument();\n    });\n  });\n\n  it('renders stage columns when workflow selected', async () => {\n    renderWithProviders(<ApplicationKanbanBoard {...defaultProps} />);\n\n    await waitFor(() => {\n      // Should show all stages for the selected workflow\n      expect(screen.getByText('Applied')).toBeInTheDocument();\n      expect(screen.getByText('Screening')).toBeInTheDocument();\n      expect(screen.getByText('Interview')).toBeInTheDocument();\n      expect(screen.getByText('Offer')).toBeInTheDocument();\n      expect(screen.getByText('Hired')).toBeInTheDocument();\n    });\n  });\n\n  it('displays application cards in correct columns', async () => {\n    renderWithProviders(<ApplicationKanbanBoard {...defaultProps} />);\n\n    await waitFor(() => {\n      // Check that applicants are displayed\n      expect(screen.getByText('John Doe')).toBeInTheDocument();\n      expect(screen.getByText('Jane Smith')).toBeInTheDocument();\n    });\n  });\n\n  it('shows AI score on application cards', async () => {\n    renderWithProviders(<ApplicationKanbanBoard {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('85%')).toBeInTheDocument();\n      expect(screen.getByText('72%')).toBeInTheDocument();\n    });\n  });\n\n  it('displays job title on application cards', async () => {\n    renderWithProviders(<ApplicationKanbanBoard {...defaultProps} />);\n\n    await waitFor(() => {\n      const jobTitles = screen.getAllByText('Senior Software Engineer');\n      expect(jobTitles.length).toBeGreaterThan(0);\n    });\n  });\n\n  it('shows application count in column headers', async () => {\n    renderWithProviders(<ApplicationKanbanBoard {...defaultProps} />);\n\n    await waitFor(() => {\n      // Look for count badges in column headers\n      // The count depends on how many applications are in each stage\n      const counts = screen.getAllByText(/^\\d+$/);\n      expect(counts.length).toBeGreaterThan(0);\n    });\n  });\n\n  it('filters applications by search term', async () => {\n    renderWithProviders(\n      <ApplicationKanbanBoard {...defaultProps} searchTerm=\"John\" />\n    );\n\n    await waitFor(() => {\n      expect(screen.getByText('John Doe')).toBeInTheDocument();\n      expect(screen.queryByText('Jane Smith')).not.toBeInTheDocument();\n    });\n  });\n\n  it('calls onViewApplication when view button clicked', async () => {\n    renderWithProviders(<ApplicationKanbanBoard {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('John Doe')).toBeInTheDocument();\n    });\n\n    // Find view buttons on cards\n    const viewButtons = screen.getAllByTitle('View Details');\n    fireEvent.click(viewButtons[0]);\n\n    expect(defaultProps.onViewApplication).toHaveBeenCalled();\n  });\n\n  it('calls onScheduleInterview when calendar button clicked', async () => {\n    renderWithProviders(<ApplicationKanbanBoard {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('John Doe')).toBeInTheDocument();\n    });\n\n    const calendarButtons = screen.getAllByTitle('Schedule Interview');\n    fireEvent.click(calendarButtons[0]);\n\n    expect(defaultProps.onScheduleInterview).toHaveBeenCalled();\n  });\n\n  it('shows empty state for columns with no applications', async () => {\n    renderWithProviders(<ApplicationKanbanBoard {...defaultProps} />);\n\n    await waitFor(() => {\n      // Some columns should show \"No applications in this stage\"\n      const emptyMessages = screen.getAllByText('No applications in this stage');\n      expect(emptyMessages.length).toBeGreaterThan(0);\n    });\n  });\n\n  it('displays applicant email on cards', async () => {\n    renderWithProviders(<ApplicationKanbanBoard {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('john.doe@example.com')).toBeInTheDocument();\n    });\n  });\n\n  it('shows application date on cards', async () => {\n    renderWithProviders(<ApplicationKanbanBoard {...defaultProps} />);\n\n    await waitFor(() => {\n      // Dates should be formatted as \"MMM d\"\n      expect(screen.getByText('Jan 20')).toBeInTheDocument();\n      expect(screen.getByText('Jan 18')).toBeInTheDocument();\n    });\n  });\n\n  it('makes cards draggable', async () => {\n    renderWithProviders(<ApplicationKanbanBoard {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('John Doe')).toBeInTheDocument();\n    });\n\n    // Cards should have draggable attribute\n    const card = screen.getByText('John Doe').closest('[draggable]');\n    expect(card).toHaveAttribute('draggable', 'true');\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/recruitment/__tests__/ApplicationsTable.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mockApplications' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * ApplicationsTable Component Tests\n */\n\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { renderWithProviders, screen, waitFor, fireEvent } from '@/test/utils';\nimport { mockApplications, mockWorkflowStages, createHookMocks } from '@/test/mocks';\nimport { ApplicationsTable } from '../ApplicationsTable';\n\n// Mock the hooks module\nvi.mock('@/hooks', () => {\n  const mocks = createHookMocks();\n  return {\n    useApplications: mocks.useApplications,\n    useUpdateApplication: mocks.useUpdateApplication,\n    useDeleteApplication: mocks.useDeleteApplication,\n  };\n});\n\n// Mock the logger\nvi.mock('@/lib/logger', () => ({\n  log: {\n    info: vi.fn(),\n    error: vi.fn(),\n    track: vi.fn(),\n  },\n}));\n\ndescribe('ApplicationsTable', () => {\n  const defaultProps = {\n    workflowStages: mockWorkflowStages,\n    onAddNew: vi.fn(),\n    onView: vi.fn(),\n    onScheduleInterview: vi.fn(),\n    onStageChange: vi.fn(),\n    onSuccess: vi.fn(),\n    onError: vi.fn(),\n  };\n\n  beforeEach(() => {\n    vi.clearAllMocks();\n  });\n\n  it('renders application listings correctly', async () => {\n    renderWithProviders(<ApplicationsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('John Doe')).toBeInTheDocument();\n      expect(screen.getByText('Jane Smith')).toBeInTheDocument();\n    });\n  });\n\n  it('displays applicant email', async () => {\n    renderWithProviders(<ApplicationsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('john.doe@example.com')).toBeInTheDocument();\n      expect(screen.getByText('jane.smith@example.com')).toBeInTheDocument();\n    });\n  });\n\n  it('shows job title for each application', async () => {\n    renderWithProviders(<ApplicationsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      // Both applications are for the same job\n      const jobTitles = screen.getAllByText('Senior Software Engineer');\n      expect(jobTitles.length).toBeGreaterThan(0);\n    });\n  });\n\n  it('displays AI score with progress bar', async () => {\n    renderWithProviders(<ApplicationsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('85/100')).toBeInTheDocument();\n      expect(screen.getByText('72/100')).toBeInTheDocument();\n    });\n  });\n\n  it('filters applications by search term', async () => {\n    renderWithProviders(<ApplicationsTable {...defaultProps} searchTerm=\"John\" />);\n\n    await waitFor(() => {\n      expect(screen.getByText('John Doe')).toBeInTheDocument();\n      expect(screen.queryByText('Jane Smith')).not.toBeInTheDocument();\n    });\n  });\n\n  it('filters applications by email', async () => {\n    renderWithProviders(<ApplicationsTable {...defaultProps} searchTerm=\"jane.smith\" />);\n\n    await waitFor(() => {\n      expect(screen.queryByText('John Doe')).not.toBeInTheDocument();\n      expect(screen.getByText('Jane Smith')).toBeInTheDocument();\n    });\n  });\n\n  it('calls onView when view button is clicked', async () => {\n    renderWithProviders(<ApplicationsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('John Doe')).toBeInTheDocument();\n    });\n\n    const viewButtons = screen.getAllByTitle('View Details');\n    fireEvent.click(viewButtons[0]);\n\n    expect(defaultProps.onView).toHaveBeenCalledWith(\n      expect.objectContaining({ id: 'app-1' })\n    );\n  });\n\n  it('calls onScheduleInterview when calendar button is clicked', async () => {\n    renderWithProviders(<ApplicationsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('John Doe')).toBeInTheDocument();\n    });\n\n    const calendarButtons = screen.getAllByTitle('Schedule Interview');\n    fireEvent.click(calendarButtons[0]);\n\n    expect(defaultProps.onScheduleInterview).toHaveBeenCalledWith(\n      expect.objectContaining({ id: 'app-1' })\n    );\n  });\n\n  it('shows stage dropdown with available stages', async () => {\n    renderWithProviders(<ApplicationsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      const stageDropdowns = screen.getAllByRole('combobox');\n      expect(stageDropdowns.length).toBeGreaterThan(0);\n    });\n  });\n\n  it('displays application status badge', async () => {\n    renderWithProviders(<ApplicationsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('new')).toBeInTheDocument();\n      expect(screen.getByText('screening')).toBeInTheDocument();\n    });\n  });\n\n  it('shows empty message when no applications match search', async () => {\n    renderWithProviders(<ApplicationsTable {...defaultProps} searchTerm=\"NonexistentApplicant\" />);\n\n    await waitFor(() => {\n      expect(screen.getByText('No applications found')).toBeInTheDocument();\n    });\n  });\n\n  it('filters by selected job', async () => {\n    renderWithProviders(\n      <ApplicationsTable {...defaultProps} selectedJobId=\"job-1\" />\n    );\n\n    await waitFor(() => {\n      // All mock applications are for job-1\n      expect(screen.getByText('John Doe')).toBeInTheDocument();\n    });\n  });\n\n  it('filters by selected stage', async () => {\n    renderWithProviders(\n      <ApplicationsTable {...defaultProps} selectedStageId=\"stage-1\" />\n    );\n\n    await waitFor(() => {\n      // Only app-1 is in stage-1\n      expect(screen.getByText('John Doe')).toBeInTheDocument();\n      expect(screen.queryByText('Jane Smith')).not.toBeInTheDocument();\n    });\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/recruitment/__tests__/InterviewsTable.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mockInterviews' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * InterviewsTable Component Tests\n */\n\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { renderWithProviders, screen, waitFor, fireEvent } from '@/test/utils';\nimport { mockInterviews, createHookMocks } from '@/test/mocks';\nimport { InterviewsTable } from '../InterviewsTable';\n\n// Mock the hooks module\nvi.mock('@/hooks', () => {\n  const mocks = createHookMocks();\n  return {\n    useInterviews: mocks.useInterviews,\n    useUpdateInterview: mocks.useUpdateInterview,\n  };\n});\n\n// Mock the logger\nvi.mock('@/lib/logger', () => ({\n  log: {\n    info: vi.fn(),\n    error: vi.fn(),\n    track: vi.fn(),\n  },\n}));\n\ndescribe('InterviewsTable', () => {\n  const defaultProps = {\n    onAddNew: vi.fn(),\n    onEdit: vi.fn(),\n    onReschedule: vi.fn(),\n    onSuccess: vi.fn(),\n    onError: vi.fn(),\n  };\n\n  beforeEach(() => {\n    vi.clearAllMocks();\n  });\n\n  it('renders interview listings correctly', async () => {\n    renderWithProviders(<InterviewsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      // Check for interview types\n      expect(screen.getByText('phone screen')).toBeInTheDocument();\n      expect(screen.getByText('technical')).toBeInTheDocument();\n    });\n  });\n\n  it('displays application ID (truncated)', async () => {\n    renderWithProviders(<InterviewsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      // Application IDs are truncated\n      expect(screen.getByText('app-1...')).toBeInTheDocument();\n      expect(screen.getByText('app-2...')).toBeInTheDocument();\n    });\n  });\n\n  it('shows interview status badges', async () => {\n    renderWithProviders(<InterviewsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('scheduled')).toBeInTheDocument();\n      expect(screen.getByText('completed')).toBeInTheDocument();\n    });\n  });\n\n  it('displays meeting link when available', async () => {\n    renderWithProviders(<InterviewsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      const meetingLink = screen.getByText('Join Meeting');\n      expect(meetingLink).toBeInTheDocument();\n      expect(meetingLink.closest('a')).toHaveAttribute('href', 'https://zoom.us/j/123456');\n    });\n  });\n\n  it('shows location when no meeting link', async () => {\n    renderWithProviders(<InterviewsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Office - Room A')).toBeInTheDocument();\n    });\n  });\n\n  it('displays interview duration', async () => {\n    renderWithProviders(<InterviewsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('30 min')).toBeInTheDocument();\n      expect(screen.getByText('60 min')).toBeInTheDocument();\n    });\n  });\n\n  it('shows rating for completed interviews', async () => {\n    renderWithProviders(<InterviewsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('4/5')).toBeInTheDocument();\n    });\n  });\n\n  it('shows N/A for interviews without rating', async () => {\n    renderWithProviders(<InterviewsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      const naElements = screen.getAllByText('N/A');\n      expect(naElements.length).toBeGreaterThan(0);\n    });\n  });\n\n  it('filters interviews by search term', async () => {\n    renderWithProviders(<InterviewsTable {...defaultProps} searchTerm=\"technical\" />);\n\n    await waitFor(() => {\n      expect(screen.getByText('technical')).toBeInTheDocument();\n      expect(screen.queryByText('phone screen')).not.toBeInTheDocument();\n    });\n  });\n\n  it('calls onReschedule for scheduled interviews', async () => {\n    renderWithProviders(<InterviewsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('scheduled')).toBeInTheDocument();\n    });\n\n    // Find reschedule button (Calendar icon)\n    const rescheduleButtons = screen.getAllByTitle('Reschedule');\n    if (rescheduleButtons.length > 0) {\n      fireEvent.click(rescheduleButtons[0]);\n      expect(defaultProps.onReschedule).toHaveBeenCalled();\n    }\n  });\n\n  it('calls onEdit when edit button is clicked', async () => {\n    renderWithProviders(<InterviewsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('phone screen')).toBeInTheDocument();\n    });\n\n    const editButtons = screen.getAllByTitle('Edit');\n    fireEvent.click(editButtons[0]);\n\n    expect(defaultProps.onEdit).toHaveBeenCalled();\n  });\n\n  it('shows empty message when no interviews match search', async () => {\n    renderWithProviders(<InterviewsTable {...defaultProps} searchTerm=\"NonexistentInterview\" />);\n\n    await waitFor(() => {\n      expect(screen.getByText('No interviews scheduled')).toBeInTheDocument();\n    });\n  });\n\n  it('formats scheduled date correctly', async () => {\n    renderWithProviders(<InterviewsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      // Date should be formatted as \"MMM dd, yyyy\"\n      expect(screen.getByText('Feb 01, 2024')).toBeInTheDocument();\n    });\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/recruitment/__tests__/JobsTable.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mockJobs' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * JobsTable Component Tests\n */\n\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { renderWithProviders, screen, waitFor, fireEvent } from '@/test/utils';\nimport { mockJobs, createHookMocks } from '@/test/mocks';\nimport { JobsTable } from '../JobsTable';\n\n// Mock the hooks module\nvi.mock('@/hooks', () => {\n  const mocks = createHookMocks();\n  return {\n    useJobs: mocks.useJobs,\n    useUpdateJob: mocks.useUpdateJob,\n    useDeleteJob: mocks.useDeleteJob,\n  };\n});\n\n// Mock the logger\nvi.mock('@/lib/logger', () => ({\n  log: {\n    info: vi.fn(),\n    error: vi.fn(),\n    track: vi.fn(),\n  },\n}));\n\ndescribe('JobsTable', () => {\n  const defaultProps = {\n    onAddNew: vi.fn(),\n    onEdit: vi.fn(),\n    onView: vi.fn(),\n    onSuccess: vi.fn(),\n    onError: vi.fn(),\n  };\n\n  beforeEach(() => {\n    vi.clearAllMocks();\n  });\n\n  it('renders job listings correctly', async () => {\n    renderWithProviders(<JobsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Senior Software Engineer')).toBeInTheDocument();\n      expect(screen.getByText('Product Manager')).toBeInTheDocument();\n      expect(screen.getByText('Marketing Intern')).toBeInTheDocument();\n    });\n  });\n\n  it('displays department for each job', async () => {\n    renderWithProviders(<JobsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Engineering')).toBeInTheDocument();\n      expect(screen.getByText('Product')).toBeInTheDocument();\n      expect(screen.getByText('Marketing')).toBeInTheDocument();\n    });\n  });\n\n  it('shows location information', async () => {\n    renderWithProviders(<JobsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Remote')).toBeInTheDocument();\n      expect(screen.getByText('New York')).toBeInTheDocument();\n      expect(screen.getByText('San Francisco')).toBeInTheDocument();\n    });\n  });\n\n  it('filters jobs based on search term', async () => {\n    renderWithProviders(<JobsTable {...defaultProps} searchTerm=\"Engineer\" />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Senior Software Engineer')).toBeInTheDocument();\n      expect(screen.queryByText('Product Manager')).not.toBeInTheDocument();\n      expect(screen.queryByText('Marketing Intern')).not.toBeInTheDocument();\n    });\n  });\n\n  it('filters jobs by department', async () => {\n    renderWithProviders(<JobsTable {...defaultProps} searchTerm=\"Marketing\" />);\n\n    await waitFor(() => {\n      expect(screen.queryByText('Senior Software Engineer')).not.toBeInTheDocument();\n      expect(screen.getByText('Marketing Intern')).toBeInTheDocument();\n    });\n  });\n\n  it('calls onView when view button is clicked', async () => {\n    renderWithProviders(<JobsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Senior Software Engineer')).toBeInTheDocument();\n    });\n\n    // Find view buttons (Eye icons) - title is \"View Details\" from custom action\n    const viewButtons = screen.getAllByTitle('View Details');\n    fireEvent.click(viewButtons[0]);\n\n    expect(defaultProps.onView).toHaveBeenCalledWith(\n      expect.objectContaining({ id: 'job-1' })\n    );\n  });\n\n  it('calls onEdit when edit button is clicked', async () => {\n    renderWithProviders(<JobsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Senior Software Engineer')).toBeInTheDocument();\n    });\n\n    const editButtons = screen.getAllByTitle('Edit');\n    fireEvent.click(editButtons[0]);\n\n    expect(defaultProps.onEdit).toHaveBeenCalledWith(\n      expect.objectContaining({ id: 'job-1' })\n    );\n  });\n\n  it('displays salary range when available', async () => {\n    renderWithProviders(<JobsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('$120,000 - $180,000')).toBeInTheDocument();\n    });\n  });\n\n  it('shows \"Not specified\" for jobs without salary', async () => {\n    renderWithProviders(<JobsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Not specified')).toBeInTheDocument();\n    });\n  });\n\n  it('renders status dropdown with correct options', async () => {\n    renderWithProviders(<JobsTable {...defaultProps} />);\n\n    await waitFor(() => {\n      const statusDropdowns = screen.getAllByRole('combobox');\n      expect(statusDropdowns.length).toBeGreaterThan(0);\n    });\n  });\n\n  it('shows empty message when no jobs match search', async () => {\n    renderWithProviders(<JobsTable {...defaultProps} searchTerm=\"NonexistentJob\" />);\n\n    await waitFor(() => {\n      expect(screen.getByText('No job postings found')).toBeInTheDocument();\n    });\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/recruitment/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/shared/crud/GenericCRUDTable.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'pageSize' is assigned a value but never used. Allowed unused args must match /^_/u.","line":85,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":85,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Generic CRUD Table Component\n * \n * Reusable table component for any entity with standard CRUD operations\n * Reduces code duplication across the application\n */\n\nimport React, { useState } from 'react';\nimport { Plus, Search, Edit, Trash2, Eye, MoreVertical } from 'lucide-react';\nimport { log } from '@/lib/logger';\n\nexport interface Column<T> {\n  key: keyof T | string;\n  label: string;\n  render?: (item: T) => React.ReactNode;\n  sortable?: boolean;\n  width?: string;\n}\n\nexport interface Action<T> {\n  label: string;\n  icon?: React.ComponentType<{ className?: string }>;\n  onClick: (item: T) => void;\n  variant?: 'default' | 'primary' | 'danger';\n  show?: (item: T) => boolean;\n}\n\ninterface GenericCRUDTableProps<T> {\n  // Data\n  data: T[];\n  columns: Column<T>[];\n  loading?: boolean;\n  error?: string | null;\n  \n  // Actions\n  actions?: Action<T>[];\n  onAdd?: () => void;\n  onEdit?: (item: T) => void;\n  onDelete?: (item: T) => void;\n  onView?: (item: T) => void;\n  \n  // Search & Filter\n  searchable?: boolean;\n  searchPlaceholder?: string;\n  onSearch?: (query: string) => void;\n  filters?: React.ReactNode;\n  \n  // Pagination\n  paginated?: boolean;\n  currentPage?: number;\n  totalPages?: number;\n  pageSize?: number;\n  onPageChange?: (page: number) => void;\n  \n  // Selection\n  selectable?: boolean;\n  selectedItems?: T[];\n  onSelectionChange?: (items: T[]) => void;\n  getItemId?: (item: T) => string;\n  \n  // Customization\n  title?: string;\n  emptyMessage?: string;\n  className?: string;\n  rowClassName?: string | ((item: T) => string);\n}\n\nexport function GenericCRUDTable<T extends Record<string, any>>({\n  data,\n  columns,\n  loading = false,\n  error = null,\n  actions = [],\n  onAdd,\n  onEdit,\n  onDelete,\n  onView,\n  searchable = true,\n  searchPlaceholder = 'Search...',\n  onSearch,\n  filters,\n  paginated = false,\n  currentPage = 1,\n  totalPages = 1,\n  pageSize = 10,\n  onPageChange,\n  selectable = false,\n  selectedItems = [],\n  onSelectionChange,\n  getItemId = (item) => item.id,\n  title,\n  emptyMessage = 'No data available',\n  className = '',\n  rowClassName,\n}: GenericCRUDTableProps<T>) {\n  const [searchQuery, setSearchQuery] = useState('');\n  const [sortColumn, setSortColumn] = useState<string | null>(null);\n  const [sortDirection, setSortDirection] = useState<'asc' | 'desc'>('asc');\n\n  // Handle search\n  const handleSearch = (query: string) => {\n    setSearchQuery(query);\n    if (onSearch) {\n      onSearch(query);\n    }\n  };\n\n  // Handle sort\n  const handleSort = (columnKey: string) => {\n    if (sortColumn === columnKey) {\n      setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc');\n    } else {\n      setSortColumn(columnKey);\n      setSortDirection('asc');\n    }\n    log.track('table_sorted', { column: columnKey, direction: sortDirection });\n  };\n\n  // Handle selection\n  const handleSelectAll = (checked: boolean) => {\n    if (onSelectionChange) {\n      onSelectionChange(checked ? data : []);\n    }\n  };\n\n  const handleSelectItem = (item: T, checked: boolean) => {\n    if (onSelectionChange) {\n      const itemId = getItemId(item);\n      if (checked) {\n        onSelectionChange([...selectedItems, item]);\n      } else {\n        onSelectionChange(selectedItems.filter(i => getItemId(i) !== itemId));\n      }\n    }\n  };\n\n  const isItemSelected = (item: T) => {\n    const itemId = getItemId(item);\n    return selectedItems.some(i => getItemId(i) === itemId);\n  };\n\n  // Get cell value\n  const getCellValue = (item: T, column: Column<T>) => {\n    if (column.render) {\n      return column.render(item);\n    }\n    return item[column.key as keyof T];\n  };\n\n  // Sort data\n  const sortedData = React.useMemo(() => {\n    if (!sortColumn) return data;\n\n    return [...data].sort((a, b) => {\n      const aVal = a[sortColumn];\n      const bVal = b[sortColumn];\n\n      if (aVal === bVal) return 0;\n      \n      const comparison = aVal < bVal ? -1 : 1;\n      return sortDirection === 'asc' ? comparison : -comparison;\n    });\n  }, [data, sortColumn, sortDirection]);\n\n  // Get row class\n  const getRowClass = (item: T) => {\n    if (typeof rowClassName === 'function') {\n      return rowClassName(item);\n    }\n    return rowClassName || '';\n  };\n\n  return (\n    <div className={`bg-white rounded-lg shadow ${className}`}>\n      {/* Header */}\n      {(title || onAdd || searchable || filters) && (\n        <div className=\"p-4 border-b border-gray-200\">\n          <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n            {/* Title */}\n            {title && (\n              <h2 className=\"text-lg font-semibold text-gray-900\">{title}</h2>\n            )}\n\n            {/* Actions */}\n            <div className=\"flex flex-wrap items-center gap-2\">\n              {/* Search */}\n              {searchable && (\n                <div className=\"relative flex-1 min-w-[200px]\">\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400\" />\n                  <input\n                    type=\"text\"\n                    placeholder={searchPlaceholder}\n                    value={searchQuery}\n                    onChange={(e) => handleSearch(e.target.value)}\n                    className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                  />\n                </div>\n              )}\n\n              {/* Filters */}\n              {filters}\n\n              {/* Add Button */}\n              {onAdd && (\n                <button\n                  onClick={onAdd}\n                  className=\"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors\"\n                >\n                  <Plus className=\"w-5 h-5\" />\n                  <span className=\"hidden sm:inline\">Add New</span>\n                </button>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Error Message */}\n      {error && (\n        <div className=\"p-4 bg-red-50 border-b border-red-200\">\n          <p className=\"text-sm text-red-600\">{error}</p>\n        </div>\n      )}\n\n      {/* Table */}\n      <div className=\"overflow-x-auto\">\n        <table className=\"w-full\">\n          <thead className=\"bg-gray-50\">\n            <tr>\n              {/* Selection Column */}\n              {selectable && (\n                <th className=\"w-12 px-4 py-3\">\n                  <input\n                    type=\"checkbox\"\n                    checked={selectedItems.length === data.length && data.length > 0}\n                    onChange={(e) => handleSelectAll(e.target.checked)}\n                    className=\"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500\"\n                  />\n                </th>\n              )}\n\n              {/* Data Columns */}\n              {columns.map((column, index) => (\n                <th\n                  key={index}\n                  className={`px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider ${\n                    column.sortable ? 'cursor-pointer hover:bg-gray-100' : ''\n                  }`}\n                  style={{ width: column.width }}\n                  onClick={() => column.sortable && handleSort(column.key as string)}\n                >\n                  <div className=\"flex items-center gap-2\">\n                    {column.label}\n                    {column.sortable && sortColumn === column.key && (\n                      <span className=\"text-indigo-600\">\n                        {sortDirection === 'asc' ? 'â' : 'â'}\n                      </span>\n                    )}\n                  </div>\n                </th>\n              ))}\n\n              {/* Actions Column */}\n              {(actions.length > 0 || onEdit || onDelete || onView) && (\n                <th className=\"w-24 px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Actions\n                </th>\n              )}\n            </tr>\n          </thead>\n\n          <tbody className=\"bg-white divide-y divide-gray-200\">\n            {loading ? (\n              <tr>\n                <td colSpan={columns.length + (selectable ? 1 : 0) + 1} className=\"px-4 py-8 text-center\">\n                  <div className=\"flex items-center justify-center\">\n                    <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600\"></div>\n                    <span className=\"ml-3 text-gray-600\">Loading...</span>\n                  </div>\n                </td>\n              </tr>\n            ) : sortedData.length === 0 ? (\n              <tr>\n                <td colSpan={columns.length + (selectable ? 1 : 0) + 1} className=\"px-4 py-8 text-center text-gray-500\">\n                  {emptyMessage}\n                </td>\n              </tr>\n            ) : (\n              sortedData.map((item, rowIndex) => (\n                <tr key={rowIndex} className={`hover:bg-gray-50 ${getRowClass(item)}`}>\n                  {/* Selection */}\n                  {selectable && (\n                    <td className=\"px-4 py-3\">\n                      <input\n                        type=\"checkbox\"\n                        checked={isItemSelected(item)}\n                        onChange={(e) => handleSelectItem(item, e.target.checked)}\n                        className=\"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500\"\n                      />\n                    </td>\n                  )}\n\n                  {/* Data Cells */}\n                  {columns.map((column, colIndex) => (\n                    <td key={colIndex} className=\"px-4 py-3 text-sm text-gray-900\">\n                      {getCellValue(item, column)}\n                    </td>\n                  ))}\n\n                  {/* Action Buttons */}\n                  {(actions.length > 0 || onEdit || onDelete || onView) && (\n                    <td className=\"px-4 py-3 text-right text-sm font-medium\">\n                      <div className=\"flex items-center justify-end gap-2\">\n                        {onView && (\n                          <button\n                            onClick={() => onView(item)}\n                            className=\"text-gray-600 hover:text-gray-900\"\n                            title=\"View\"\n                          >\n                            <Eye className=\"w-4 h-4\" />\n                          </button>\n                        )}\n                        {onEdit && (\n                          <button\n                            onClick={() => onEdit(item)}\n                            className=\"text-indigo-600 hover:text-indigo-900\"\n                            title=\"Edit\"\n                          >\n                            <Edit className=\"w-4 h-4\" />\n                          </button>\n                        )}\n                        {onDelete && (\n                          <button\n                            onClick={() => onDelete(item)}\n                            className=\"text-red-600 hover:text-red-900\"\n                            title=\"Delete\"\n                          >\n                            <Trash2 className=\"w-4 h-4\" />\n                          </button>\n                        )}\n                        {actions.map((action, actionIndex) => {\n                          if (action.show && !action.show(item)) return null;\n                          \n                          const Icon = action.icon || MoreVertical;\n                          const variantClasses = {\n                            default: 'text-gray-600 hover:text-gray-900',\n                            primary: 'text-indigo-600 hover:text-indigo-900',\n                            danger: 'text-red-600 hover:text-red-900',\n                          };\n                          \n                          return (\n                            <button\n                              key={actionIndex}\n                              onClick={() => action.onClick(item)}\n                              className={variantClasses[action.variant || 'default']}\n                              title={action.label}\n                            >\n                              <Icon className=\"w-4 h-4\" />\n                            </button>\n                          );\n                        })}\n                      </div>\n                    </td>\n                  )}\n                </tr>\n              ))\n            )}\n          </tbody>\n        </table>\n      </div>\n\n      {/* Pagination */}\n      {paginated && totalPages > 1 && (\n        <div className=\"px-4 py-3 border-t border-gray-200 flex items-center justify-between\">\n          <div className=\"text-sm text-gray-700\">\n            Page <span className=\"font-medium\">{currentPage}</span> of{' '}\n            <span className=\"font-medium\">{totalPages}</span>\n          </div>\n          <div className=\"flex gap-2\">\n            <button\n              onClick={() => onPageChange && onPageChange(currentPage - 1)}\n              disabled={currentPage === 1}\n              className=\"px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              Previous\n            </button>\n            <button\n              onClick={() => onPageChange && onPageChange(currentPage + 1)}\n              disabled={currentPage === totalPages}\n              className=\"px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              Next\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/ui/button.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":56,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":56,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n    \"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\",\n    {\n        variants: {\n            variant: {\n                default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n                destructive:\n                    \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n                outline:\n                    \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n                secondary:\n                    \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n                ghost: \"hover:bg-accent hover:text-accent-foreground\",\n                link: \"text-primary underline-offset-4 hover:underline\",\n            },\n            size: {\n                default: \"h-10 px-4 py-2\",\n                sm: \"h-9 rounded-md px-3\",\n                lg: \"h-11 rounded-md px-8\",\n                icon: \"h-10 w-10\",\n            },\n        },\n        defaultVariants: {\n            variant: \"default\",\n            size: \"default\",\n        },\n    }\n)\n\nexport interface ButtonProps\n    extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n    asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n    ({ className, variant, size, asChild = false, ...props }, ref) => {\n        const Comp = asChild ? Slot : \"button\"\n        return (\n            <Comp\n                className={cn(buttonVariants({ variant, size, className }))}\n                ref={ref}\n                {...props}\n            />\n        )\n    }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/ui/dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/ui/input.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An interface declaring no members is equivalent to its supertype.","line":5,"column":18,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":5,"endColumn":28,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[73,153],"text":"type InputProps = React.InputHTMLAttributes<HTMLInputElement>"},"desc":"Replace empty interface with a type alias."}]},{"ruleId":"@typescript-eslint/no-empty-interface","severity":1,"message":"An interface declaring no members is equivalent to its supertype.","line":5,"column":18,"nodeType":"Identifier","messageId":"noEmptyWithSuper","endLine":5,"endColumn":28,"fix":{"range":[73,153],"text":"type InputProps = React.InputHTMLAttributes<HTMLInputElement>"}}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nexport interface InputProps\n    extends React.InputHTMLAttributes<HTMLInputElement> { }\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n    ({ className, type, ...props }, ref) => {\n        return (\n            <input\n                type={type}\n                className={cn(\n                    \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n                    className\n                )}\n                ref={ref}\n                {...props}\n            />\n        )\n    }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/ui/label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/components/ui/select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/contexts/AuthContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":243,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":243,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useEffect, useState } from 'react';\nimport { User } from '@supabase/supabase-js';\nimport { supabase, UserProfile } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport ServiceUnavailablePage from '@/pages/ServiceUnavailablePage';\n\ninterface AuthContextType {\n  user: User | null;\n  profile: UserProfile | null;\n  loading: boolean;\n  signIn: (email: string, password: string) => Promise<{ error: Error | null }>;\n  signUp: (email: string, password: string, fullName: string, role: string, tenantId?: string) => Promise<{ error: Error | null }>;\n  signOut: () => Promise<void>;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [profile, setProfile] = useState<UserProfile | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [isServiceUnavailable, setIsServiceUnavailable] = useState(false);\n\n  // Effect 1: Initialize Auth (Run once)\n  useEffect(() => {\n    async function loadUser() {\n      setLoading(true);\n\n      if (!supabase) {\n        log.error('Supabase client is not initialized (missing config)', undefined, { component: 'AuthContext' });\n        setIsServiceUnavailable(true);\n        setLoading(false);\n        return;\n      }\n\n      try {\n        const { data: { user }, error } = await supabase.auth.getUser();\n\n        if (error) {\n\n          // Check for Service Unavailable (503)\n          if (\n            (error as any).status === 503 ||\n            (error as any).status === 500 ||\n            error.message.includes('Service Unavailable') ||\n            error.message.includes('upstream connect error') ||\n            error.message.includes('Failed to fetch')\n          ) {\n            setIsServiceUnavailable(true);\n            setLoading(false);\n            return;\n          }\n\n          // If refresh token is invalid\n          if (error.message.includes('Refresh Token Not Found') || error.message.includes('Invalid Refresh Token') || error.message.includes('Auth session missing!')) {\n            await supabase.auth.signOut();\n            setUser(null);\n            setProfile(null);\n            return;\n          }\n        } else {\n          setIsServiceUnavailable(false);\n        }\n\n        setUser(user);\n\n        if (user) {\n          const { data: profileData, error: profileError } = await supabase\n            .from('users_profiles')\n            .select('*')\n            .eq('user_id', user.id)\n            .maybeSingle();\n\n          if (profileError && (\n            (profileError as any).status === 503 ||\n            profileError.message.includes('Service Unavailable') ||\n            profileError.message.includes('upstream connect error') ||\n            profileError.message.includes('Failed to fetch')\n          )) {\n            setIsServiceUnavailable(true);\n            setLoading(false);\n            return;\n          }\n\n          setProfile(profileData);\n        }\n      } catch (err: any) {\n        log.error('Unexpected error loading user', err, { component: 'AuthContext', action: 'loadUser' });\n        if (\n          err.message?.includes('Failed to fetch') ||\n          err.message?.includes('NetworkError') ||\n          err.status === 503\n        ) {\n          setIsServiceUnavailable(true);\n        } else {\n          setUser(null);\n          setProfile(null);\n        }\n      } finally {\n        setLoading(false);\n      }\n    }\n\n    loadUser();\n\n    if (!supabase) return;\n\n    // Set up auth listener\n    const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {\n      setUser(session?.user || null);\n\n      if (session?.user) {\n        const userId = session.user.id;\n        supabase\n          .from('users_profiles')\n          .select('*')\n          .eq('user_id', userId)\n          .maybeSingle()\n          .then(({ data, error }) => {\n            if (error && (\n              (error as any).status === 503 ||\n              error.message.includes('Service Unavailable') ||\n              error.message.includes('Failed to fetch')\n            )) {\n              setIsServiceUnavailable(true);\n            } else {\n              setProfile(data);\n            }\n          });\n      } else {\n        setProfile(null);\n      }\n    });\n\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, []); // Empty dependency array: Run once\n\n  // Effect 2: Inactivity Timers (Run on user change)\n  useEffect(() => {\n    // Session Timeout Logic (30 minutes)\n    const INACTIVITY_LIMIT = 30 * 60 * 1000; // 30 minutes\n    const ACTIVITY_THROTTLE = 5 * 60 * 1000; // 5 minutes (throttle DB updates)\n    let lastActivityTime = Date.now();\n    let lastDbUpdate = Date.now();\n    let activityTimer: NodeJS.Timeout;\n\n    function updateActivity() {\n      const now = Date.now();\n      lastActivityTime = now;\n      if (user && now - lastDbUpdate > ACTIVITY_THROTTLE) {\n        lastDbUpdate = now;\n      }\n    }\n\n    function checkInactivity() {\n      const now = Date.now();\n      if (user && now - lastActivityTime > INACTIVITY_LIMIT) {\n        log.info('User inactive for 30 minutes, signing out', { component: 'AuthContext', action: 'checkInactivity' });\n        signOut();\n        alert('You have been signed out due to inactivity.');\n      }\n    }\n\n    if (user) {\n      // Add event listeners\n      window.addEventListener('mousemove', updateActivity);\n      window.addEventListener('keydown', updateActivity);\n      window.addEventListener('click', updateActivity);\n      window.addEventListener('scroll', updateActivity);\n\n      // Check inactivity every minute\n      activityTimer = setInterval(checkInactivity, 60 * 1000);\n    }\n\n    return () => {\n      if (activityTimer) clearInterval(activityTimer);\n      window.removeEventListener('mousemove', updateActivity);\n      window.removeEventListener('keydown', updateActivity);\n      window.removeEventListener('click', updateActivity);\n      window.removeEventListener('scroll', updateActivity);\n    };\n  }, [user]); // Run when user changes\n\n  async function signIn(email: string, password: string) {\n    if (!supabase) return { error: new Error('Supabase client not initialized') };\n    const { error } = await supabase.auth.signInWithPassword({ email, password });\n    return { error };\n  }\n\n  async function signUp(email: string, password: string, fullName: string, role: string, tenantId?: string) {\n    if (!supabase) return { error: new Error('Supabase client not initialized') };\n    const { data: authData, error: authError } = await supabase.auth.signUp({\n      email,\n      password,\n      options: {\n        data: {\n          full_name: fullName,\n          role: role,\n          tenant_id: tenantId\n        }\n      }\n    });\n\n    if (authError) return { error: authError };\n    if (!authData.user) return { error: new Error('User creation failed') };\n\n    // Note: If you have a Trigger to create profile, this insert might duplicate or fail. \n    // Ideally, we rely on the Trigger or check existence. \n    // Assuming manual insert for now based on existing code:\n    const { error: profileError } = await supabase\n      .from('users_profiles')\n      .upsert({ // Changed to upsert to handle potential race conditions with triggers\n        user_id: authData.user.id,\n        email,\n        full_name: fullName,\n        role,\n        tenant_id: tenantId || null,\n        is_active: true,\n      });\n\n    if (profileError) return { error: profileError };\n    return { error: null };\n  }\n\n  async function signOut() {\n    if (!supabase) return;\n    await supabase.auth.signOut();\n  }\n\n  if (isServiceUnavailable) {\n    return <ServiceUnavailablePage />;\n  }\n\n  return (\n    <AuthContext.Provider value={{ user, profile, loading, signIn, signUp, signOut }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/contexts/QueryProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/contexts/TenantContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'profile' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":51,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":51,"endColumn":26},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":235,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":235,"endColumn":26},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":244,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":244,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useEffect, useState, useCallback } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\nimport { useAuth } from './AuthContext';\n\n// Tenant types\nexport interface Tenant {\n    id: string;\n    name: string;\n    subdomain: string;\n    slug: string;\n    logo_url?: string;\n    settings: Record<string, any>;\n    features: {\n        novumflow_enabled: boolean;\n        careflow_enabled: boolean;\n        ai_enabled: boolean;\n    };\n    subscription_tier: 'trial' | 'basic' | 'professional' | 'enterprise';\n    subscription_status: 'active' | 'trial' | 'cancelled' | 'suspended' | 'expired';\n    created_at: string;\n}\n\nexport interface TenantMembership {\n    id: string;\n    user_id: string;\n    tenant_id: string;\n    role: 'owner' | 'admin' | 'manager' | 'member';\n    permissions: string[];\n    is_active: boolean;\n    joined_at: string;\n}\n\ninterface TenantContextType {\n    currentTenant: Tenant | null;\n    tenants: Tenant[];\n    memberships: TenantMembership[];\n    loading: boolean;\n    switchTenant: (tenantId: string) => Promise<void>;\n    createTenant: (name: string, subdomain: string) => Promise<Tenant | null>;\n    refreshTenants: () => Promise<void>;\n    hasPermission: (permission: string) => boolean;\n    hasFeature: (feature: string) => boolean;\n    canAccessCareFlow: boolean;\n    canAccessNovumFlow: boolean;\n}\n\nconst TenantContext = createContext<TenantContextType | undefined>(undefined);\n\nexport function TenantProvider({ children }: { children: React.ReactNode }) {\n    const { user, profile } = useAuth();\n    const [currentTenant, setCurrentTenant] = useState<Tenant | null>(null);\n    const [tenants, setTenants] = useState<Tenant[]>([]);\n    const [memberships, setMemberships] = useState<TenantMembership[]>([]);\n    const [loading, setLoading] = useState(true);\n\n    // Load user's tenants and memberships\n    const loadTenants = useCallback(async () => {\n        if (!user) {\n            setTenants([]);\n            setMemberships([]);\n            setCurrentTenant(null);\n            setLoading(false);\n            return;\n        }\n\n        try {\n            setLoading(true);\n\n            // Load memberships\n            const { data: membershipData, error: membershipError } = await supabase\n                .from('user_tenant_memberships')\n                .select('*')\n                .eq('user_id', user.id)\n                .eq('is_active', true)\n                .order('joined_at', { ascending: true });\n\n            if (membershipError) throw membershipError;\n\n            setMemberships(membershipData || []);\n\n            // Load tenants\n            if (membershipData && membershipData.length > 0) {\n                const tenantIds = membershipData.map(m => m.tenant_id);\n\n                const { data: tenantData, error: tenantError } = await supabase\n                    .from('tenants')\n                    .select('*')\n                    .in('id', tenantIds)\n                    .eq('is_active', true);\n\n                if (tenantError) throw tenantError;\n\n                setTenants(tenantData || []);\n\n                // Set current tenant (Priority: URL > LocalStorage > First available)\n                const searchParams = new URLSearchParams(window.location.search);\n                const urlTenantId = searchParams.get('tenant');\n                const savedTenantId = localStorage.getItem('currentTenantId');\n\n                const tenantToSet = (urlTenantId && tenantData?.find(t => t.id === urlTenantId))\n                    || (savedTenantId ? tenantData?.find(t => t.id === savedTenantId) : null)\n                    || tenantData?.[0];\n\n                if (tenantToSet) {\n                    setCurrentTenant(tenantToSet);\n                    localStorage.setItem('currentTenantId', tenantToSet.id);\n                }\n            }\n        } catch (error) {\n            log.error('Error loading tenants', error, { component: 'TenantContext', action: 'loadTenants' });\n        } finally {\n            setLoading(false);\n        }\n    }, [user]);\n\n    useEffect(() => {\n        loadTenants();\n    }, [loadTenants]);\n\n    // Ensure RLS context is set whenever tenant changes\n    useEffect(() => {\n        if (currentTenant) {\n            supabase.rpc('set_current_tenant', { p_tenant_id: currentTenant.id })\n                .then(({ error }) => {\n                    if (error) log.error('Error enforcing RLS context', error, { component: 'TenantContext', action: 'set_current_tenant', metadata: { tenantId: currentTenant.id } });\n                    else log.debug('RLS Context set', { tenantId: currentTenant.id, component: 'TenantContext' });\n                })\n                .catch(err => log.error('Failed to set RLS context', err, { component: 'TenantContext', action: 'set_current_tenant' }));\n        }\n    }, [currentTenant]);\n\n    // Switch to a different tenant\n    const switchTenant = useCallback(async (tenantId: string) => {\n        const tenant = tenants.find(t => t.id === tenantId);\n        if (!tenant) {\n            log.error('Tenant not found during switch', undefined, { component: 'TenantContext', action: 'switchTenant', metadata: { tenantId } });\n            return;\n        }\n\n        setCurrentTenant(tenant);\n        localStorage.setItem('currentTenantId', tenantId);\n\n        // Set tenant context in Supabase session (for RLS)\n        try {\n            const { error } = await supabase.rpc('set_current_tenant', {\n                p_tenant_id: tenantId\n            });\n\n            if (error) {\n                log.error('Error setting tenant context', error, { component: 'TenantContext', action: 'switchTenant', metadata: { tenantId } });\n            }\n        } catch (error) {\n            log.error('Error calling set_current_tenant', error, { component: 'TenantContext', action: 'switchTenant', metadata: { tenantId } });\n        }\n\n        // Reload page to refresh all data with new tenant\n        window.location.reload();\n    }, [tenants]);\n\n    // Create new tenant\n    const createTenant = useCallback(async (name: string, subdomain: string): Promise<Tenant | null> => {\n        try {\n            const { data, error } = await supabase.rpc('create_tenant', {\n                p_name: name,\n                p_subdomain: subdomain,\n                p_owner_user_id: user?.id\n            });\n\n            if (error) throw error;\n\n            // Refresh tenants list\n            await loadTenants();\n\n            return data;\n        } catch (error) {\n            log.error('Error creating tenant', error, { component: 'TenantContext', action: 'createTenant', metadata: { name, subdomain } });\n            return null;\n        }\n    }, [user, loadTenants]);\n\n    // Check if user has a specific permission\n    const hasPermission = useCallback((permission: string): boolean => {\n        if (!currentTenant || !user) return false;\n\n        const membership = memberships.find(m => m.tenant_id === currentTenant.id);\n        if (!membership) return false;\n\n        // Owners and admins have all permissions\n        if (['owner', 'admin'].includes(membership.role)) return true;\n\n        // Check specific permission\n        return membership.permissions.includes(permission);\n    }, [currentTenant, user, memberships]);\n\n    // Check if a feature is enabled (default: all features enabled)\n    const hasFeature = useCallback((feature: string): boolean => {\n        // If no tenant, assume all features enabled for backward compatibility\n        if (!currentTenant) return true;\n\n        // Features can be disabled in settings\n        if (currentTenant.settings?.disabled_features) {\n            return !currentTenant.settings.disabled_features.includes(feature);\n        }\n\n        // Default: all features enabled\n        return true;\n    }, [currentTenant]);\n\n    // Check feature access\n    const canAccessCareFlow = currentTenant?.features?.careflow_enabled || false;\n    const canAccessNovumFlow = currentTenant?.features?.novumflow_enabled !== false; // Default true\n\n    return (\n        <TenantContext.Provider\n            value={{\n                currentTenant,\n                tenants,\n                memberships,\n                loading,\n                switchTenant,\n                createTenant,\n                refreshTenants: loadTenants,\n                hasPermission,\n                hasFeature,\n                canAccessCareFlow,\n                canAccessNovumFlow,\n            }}\n        >\n            {children}\n        </TenantContext.Provider>\n    );\n}\n\nexport function useTenant() {\n    const context = useContext(TenantContext);\n    if (context === undefined) {\n        throw new Error('useTenant must be used within a TenantProvider');\n    }\n    return context;\n}\n\n// Helper hook to get tenant-scoped query\nexport function useTenantQuery() {\n    const { currentTenant } = useTenant();\n\n    const withTenant = useCallback((tableName: string) => {\n        if (!currentTenant) {\n            throw new Error('No current tenant');\n        }\n\n        return supabase\n            .from(tableName)\n            .select('*')\n            .eq('tenant_id', currentTenant.id);\n    }, [currentTenant]);\n\n    return { withTenant, tenantId: currentTenant?.id };\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/contexts/__tests__/AuthContext.test.ts","messages":[{"ruleId":"@typescript-eslint/triple-slash-reference","severity":2,"message":"Do not use a triple slash reference for vitest, use `import` style instead.","line":1,"column":1,"nodeType":"Line","messageId":"tripleSlashReference","endLine":1,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/// <reference types=\"vitest\" />\n/**\n * AuthContext Tests\n */\n\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\n\n// Mock user data\nconst mockUser = {\n    id: 'user-123',\n    email: 'test@example.com',\n    user_metadata: { full_name: 'Test User' },\n    created_at: '2024-01-01T10:00:00Z',\n};\n\nconst mockProfile = {\n    id: 'profile-123',\n    user_id: 'user-123',\n    full_name: 'Test User',\n    role: 'admin',\n    tenant_id: 'tenant-1',\n    is_active: true,\n    created_at: '2024-01-01T10:00:00Z',\n};\n\n// Mock Supabase auth\nvi.mock('@/lib/supabase', () => ({\n    supabase: {\n        auth: {\n            getSession: vi.fn(() => Promise.resolve({ data: { session: { user: mockUser } }, error: null })),\n            getUser: vi.fn(() => Promise.resolve({ data: { user: mockUser }, error: null })),\n            signInWithPassword: vi.fn(() => Promise.resolve({ data: { user: mockUser }, error: null })),\n            signUp: vi.fn(() => Promise.resolve({ data: { user: mockUser }, error: null })),\n            signOut: vi.fn(() => Promise.resolve({ error: null })),\n            onAuthStateChange: vi.fn(() => ({ data: { subscription: { unsubscribe: vi.fn() } } })),\n        },\n        from: vi.fn(() => ({\n            select: vi.fn(() => ({\n                eq: vi.fn(() => ({\n                    single: vi.fn(() => Promise.resolve({ data: mockProfile, error: null })),\n                })),\n            })),\n        })),\n    },\n}));\n\ndescribe('AuthContext', () => {\n    beforeEach(() => { vi.clearAllMocks(); });\n\n    describe('User Authentication', () => {\n        it('should have valid user structure', () => {\n            expect(mockUser).toHaveProperty('id');\n            expect(mockUser).toHaveProperty('email');\n            expect(mockUser.email).toMatch(/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/);\n        });\n\n        it('should have valid profile structure', () => {\n            expect(mockProfile).toHaveProperty('id');\n            expect(mockProfile).toHaveProperty('user_id');\n            expect(mockProfile).toHaveProperty('role');\n            expect(mockProfile).toHaveProperty('tenant_id');\n        });\n\n        it('should have valid roles', () => {\n            const validRoles = ['admin', 'hr_manager', 'recruiter', 'manager', 'employee', 'viewer'];\n            expect(validRoles).toContain(mockProfile.role);\n        });\n    });\n\n    describe('Role Permissions', () => {\n        const permissions = {\n            admin: ['read', 'write', 'delete', 'manage_users', 'manage_settings'],\n            hr_manager: ['read', 'write', 'manage_employees'],\n            recruiter: ['read', 'write'],\n            manager: ['read', 'write'],\n            employee: ['read'],\n            viewer: ['read'],\n        };\n\n        it('should define admin permissions', () => {\n            expect(permissions.admin).toContain('manage_users');\n            expect(permissions.admin).toContain('manage_settings');\n        });\n\n        it('should define role-based access', () => {\n            const hasPermission = (role: string, permission: string) =>\n                permissions[role as keyof typeof permissions]?.includes(permission) ?? false;\n\n            expect(hasPermission('admin', 'delete')).toBe(true);\n            expect(hasPermission('employee', 'delete')).toBe(false);\n            expect(hasPermission('hr_manager', 'manage_employees')).toBe(true);\n        });\n    });\n\n    describe('Session Management', () => {\n        it('should validate session token format', () => {\n            const mockToken = 'eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1c2VyLTEyMyJ9.signature';\n            expect(mockToken.split('.').length).toBe(3);\n        });\n\n        it('should handle session expiry', () => {\n            const isExpired = (expiresAt: number) => Date.now() / 1000 > expiresAt;\n            const futureExpiry = Math.floor(Date.now() / 1000) + 3600;\n            const pastExpiry = Math.floor(Date.now() / 1000) - 3600;\n\n            expect(isExpired(futureExpiry)).toBe(false);\n            expect(isExpired(pastExpiry)).toBe(true);\n        });\n    });\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/contexts/__tests__/TenantContext.test.ts","messages":[{"ruleId":"@typescript-eslint/triple-slash-reference","severity":2,"message":"Do not use a triple slash reference for vitest, use `import` style instead.","line":1,"column":1,"nodeType":"Line","messageId":"tripleSlashReference","endLine":1,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/// <reference types=\"vitest\" />\n/**\n * TenantContext Tests\n */\n\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\n\nconst mockTenant = {\n    id: 'tenant-1',\n    name: 'Acme Corporation',\n    slug: 'acme',\n    domain: 'acme.example.com',\n    subscription_tier: 'professional',\n    subscription_price: 99.99,\n    currency: 'GBP',\n    is_active: true,\n    max_users: 50,\n    settings: {\n        branding: { primary_color: '#3B82F6', logo_url: 'https://example.com/logo.png' },\n        features: { ai_screening: true, compliance_hub: true },\n        notifications: { email: true, sms: false },\n    },\n};\n\nvi.mock('@/lib/supabase', () => ({\n    supabase: { from: vi.fn(() => ({ select: vi.fn(() => Promise.resolve({ data: mockTenant, error: null })) })) },\n}));\n\ndescribe('TenantContext', () => {\n    beforeEach(() => { vi.clearAllMocks(); });\n\n    describe('Tenant Data', () => {\n        it('should have valid tenant structure', () => {\n            expect(mockTenant).toHaveProperty('id');\n            expect(mockTenant).toHaveProperty('name');\n            expect(mockTenant).toHaveProperty('slug');\n            expect(mockTenant).toHaveProperty('subscription_tier');\n        });\n\n        it('should have valid subscription tier', () => {\n            const validTiers = ['starter', 'professional', 'enterprise', 'custom'];\n            expect(validTiers).toContain(mockTenant.subscription_tier);\n        });\n\n        it('should have valid currency', () => {\n            const validCurrencies = ['GBP', 'USD', 'EUR', 'CAD', 'AUD'];\n            expect(validCurrencies).toContain(mockTenant.currency);\n        });\n    });\n\n    describe('Tenant Settings', () => {\n        it('should have branding settings', () => {\n            expect(mockTenant.settings.branding).toHaveProperty('primary_color');\n            expect(mockTenant.settings.branding).toHaveProperty('logo_url');\n        });\n\n        it('should validate color format', () => {\n            const hexColorRegex = /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/;\n            expect(hexColorRegex.test(mockTenant.settings.branding.primary_color)).toBe(true);\n        });\n\n        it('should have feature flags', () => {\n            expect(mockTenant.settings.features).toHaveProperty('ai_screening');\n            expect(mockTenant.settings.features).toHaveProperty('compliance_hub');\n        });\n\n        it('should check feature access', () => {\n            const hasFeature = (feature: string) => mockTenant.settings.features[feature as keyof typeof mockTenant.settings.features] ?? false;\n            expect(hasFeature('ai_screening')).toBe(true);\n            expect(hasFeature('compliance_hub')).toBe(true);\n        });\n    });\n\n    describe('Subscription Limits', () => {\n        it('should have user limits', () => {\n            expect(mockTenant.max_users).toBeGreaterThan(0);\n        });\n\n        it('should validate subscription pricing', () => {\n            expect(mockTenant.subscription_price).toBeGreaterThan(0);\n            expect(Number.isFinite(mockTenant.subscription_price)).toBe(true);\n        });\n\n        const tierLimits = { starter: 10, professional: 50, enterprise: 500, custom: Infinity };\n\n        it('should enforce tier-based limits', () => {\n            const tier = mockTenant.subscription_tier as keyof typeof tierLimits;\n            expect(mockTenant.max_users).toBeLessThanOrEqual(tierLimits[tier]);\n        });\n    });\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/data/helpContent.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/hooks/__tests__/useApplications.test.ts","messages":[{"ruleId":"@typescript-eslint/triple-slash-reference","severity":2,"message":"Do not use a triple slash reference for vitest, use `import` style instead.","line":1,"column":1,"nodeType":"Line","messageId":"tripleSlashReference","endLine":1,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'renderHook' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'waitFor' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createWrapper' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":103,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":103,"endColumn":20}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/// <reference types=\"vitest\" />\n/**\n * useApplications Hook Tests\n */\n\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { renderHook, waitFor } from '@testing-library/react';\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\nimport React from 'react';\n\n// Mock data\nconst mockApplications = [\n    {\n        id: 'app-1',\n        job_posting_id: 'job-1',\n        applicant_first_name: 'John',\n        applicant_last_name: 'Doe',\n        applicant_email: 'john.doe@example.com',\n        applicant_phone: '+447123456789',\n        status: 'new',\n        ai_score: 85,\n        ai_summary: 'Strong candidate with relevant experience',\n        applied_at: '2024-01-15T10:00:00Z',\n        cv_url: 'https://storage.example.com/cv1.pdf',\n        job_posting: {\n            id: 'job-1',\n            job_title: 'Software Engineer',\n            department: 'Engineering',\n        },\n    },\n    {\n        id: 'app-2',\n        job_posting_id: 'job-1',\n        applicant_first_name: 'Jane',\n        applicant_last_name: 'Smith',\n        applicant_email: 'jane.smith@example.com',\n        applicant_phone: '+447987654321',\n        status: 'screening',\n        ai_score: 92,\n        ai_summary: 'Excellent candidate with extensive experience',\n        applied_at: '2024-01-16T10:00:00Z',\n        cv_url: 'https://storage.example.com/cv2.pdf',\n        job_posting: {\n            id: 'job-1',\n            job_title: 'Software Engineer',\n            department: 'Engineering',\n        },\n    },\n    {\n        id: 'app-3',\n        job_posting_id: 'job-2',\n        applicant_first_name: 'Bob',\n        applicant_last_name: 'Johnson',\n        applicant_email: 'bob.johnson@example.com',\n        applicant_phone: '+447555123456',\n        status: 'interview',\n        ai_score: 78,\n        ai_summary: 'Good candidate with potential',\n        applied_at: '2024-01-17T10:00:00Z',\n        cv_url: 'https://storage.example.com/cv3.pdf',\n        job_posting: {\n            id: 'job-2',\n            job_title: 'Product Manager',\n            department: 'Product',\n        },\n    },\n];\n\n// Mock Supabase\nconst mockSupabaseClient = {\n    from: vi.fn(() => ({\n        select: vi.fn(() => ({\n            order: vi.fn(() => Promise.resolve({ data: mockApplications, error: null })),\n            eq: vi.fn(() => ({\n                order: vi.fn(() => Promise.resolve({ data: mockApplications.filter(a => a.job_posting_id === 'job-1'), error: null })),\n                single: vi.fn(() => Promise.resolve({ data: mockApplications[0], error: null })),\n            })),\n        })),\n        insert: vi.fn(() => ({\n            select: vi.fn(() => ({\n                single: vi.fn(() => Promise.resolve({ data: { ...mockApplications[0], id: 'new-app' }, error: null })),\n            })),\n        })),\n        update: vi.fn(() => ({\n            eq: vi.fn(() => ({\n                select: vi.fn(() => ({\n                    single: vi.fn(() => Promise.resolve({ data: { ...mockApplications[0], status: 'screening' }, error: null })),\n                })),\n            })),\n        })),\n        delete: vi.fn(() => ({\n            eq: vi.fn(() => Promise.resolve({ error: null })),\n        })),\n    })),\n};\n\nvi.mock('@/lib/supabase', () => ({\n    supabase: mockSupabaseClient,\n    getSupabaseClient: () => mockSupabaseClient,\n}));\n\n// Create wrapper\nconst createWrapper = () => {\n    const queryClient = new QueryClient({\n        defaultOptions: {\n            queries: { retry: false },\n            mutations: { retry: false },\n        },\n    });\n    return ({ children }: { children: React.ReactNode }) =>\n        React.createElement(QueryClientProvider, { client: queryClient }, children);\n};\n\ndescribe('useApplications Hook', () => {\n    beforeEach(() => {\n        vi.clearAllMocks();\n    });\n\n    describe('Mock Data Validation', () => {\n        it('should have valid application structure', () => {\n            mockApplications.forEach(app => {\n                expect(app).toHaveProperty('id');\n                expect(app).toHaveProperty('applicant_first_name');\n                expect(app).toHaveProperty('applicant_last_name');\n                expect(app).toHaveProperty('applicant_email');\n                expect(app).toHaveProperty('status');\n            });\n        });\n\n        it('should have valid AI scores between 0-100', () => {\n            mockApplications.forEach(app => {\n                expect(app.ai_score).toBeGreaterThanOrEqual(0);\n                expect(app.ai_score).toBeLessThanOrEqual(100);\n            });\n        });\n\n        it('should have valid email formats', () => {\n            const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n            mockApplications.forEach(app => {\n                expect(emailRegex.test(app.applicant_email)).toBe(true);\n            });\n        });\n\n        it('should have valid status values', () => {\n            const validStatuses = ['new', 'screening', 'interview', 'offer', 'hired', 'rejected'];\n            mockApplications.forEach(app => {\n                expect(validStatuses).toContain(app.status);\n            });\n        });\n\n        it('should have associated job postings', () => {\n            mockApplications.forEach(app => {\n                expect(app.job_posting).toBeDefined();\n                expect(app.job_posting.job_title).toBeDefined();\n            });\n        });\n    });\n\n    describe('Application Filtering', () => {\n        it('should filter applications by job ID', () => {\n            const filtered = mockApplications.filter(a => a.job_posting_id === 'job-1');\n            expect(filtered.length).toBe(2);\n        });\n\n        it('should filter applications by status', () => {\n            const newApps = mockApplications.filter(a => a.status === 'new');\n            expect(newApps.length).toBe(1);\n            expect(newApps[0].applicant_first_name).toBe('John');\n        });\n\n        it('should sort applications by AI score descending', () => {\n            const sorted = [...mockApplications].sort((a, b) => b.ai_score - a.ai_score);\n            expect(sorted[0].applicant_first_name).toBe('Jane');\n            expect(sorted[0].ai_score).toBe(92);\n        });\n    });\n\n    describe('Application Status Transitions', () => {\n        it('should define valid status flow', () => {\n            const statusFlow = {\n                new: ['screening', 'rejected'],\n                screening: ['interview', 'rejected'],\n                interview: ['offer', 'rejected'],\n                offer: ['hired', 'rejected'],\n                hired: [],\n                rejected: [],\n            };\n\n            expect(statusFlow.new).toContain('screening');\n            expect(statusFlow.screening).toContain('interview');\n            expect(statusFlow.interview).toContain('offer');\n            expect(statusFlow.offer).toContain('hired');\n        });\n    });\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/hooks/__tests__/useComplianceData.test.ts","messages":[{"ruleId":"@typescript-eslint/triple-slash-reference","severity":2,"message":"Do not use a triple slash reference for vitest, use `import` style instead.","line":1,"column":1,"nodeType":"Line","messageId":"tripleSlashReference","endLine":1,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/// <reference types=\"vitest\" />\n/**\n * useComplianceData Hook Tests\n */\n\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\n\n// Mock data\nconst mockDBSChecks = [\n    { id: 'dbs-1', user_id: 'user-1', dbs_number: 'DBS123456', check_type: 'enhanced', status: 'completed', expiry_date: '2027-01-15' },\n    { id: 'dbs-2', user_id: 'user-2', dbs_number: 'DBS654321', check_type: 'basic', status: 'pending', expiry_date: null },\n    { id: 'dbs-3', user_id: 'user-3', dbs_number: 'DBS999888', check_type: 'enhanced', status: 'completed', expiry_date: '2024-03-15' },\n];\n\nconst mockTrainingRecords = [\n    { id: 'tr-1', user_id: 'user-1', training_name: 'Fire Safety', is_mandatory: true, status: 'completed', expiry_date: '2025-01-10' },\n    { id: 'tr-2', user_id: 'user-1', training_name: 'GDPR', is_mandatory: true, status: 'completed', expiry_date: '2024-06-15' },\n    { id: 'tr-3', user_id: 'user-2', training_name: 'First Aid', is_mandatory: true, status: 'in_progress', expiry_date: null },\n    { id: 'tr-4', user_id: 'user-3', training_name: 'Manual Handling', is_mandatory: false, status: 'completed', expiry_date: '2024-12-01' },\n];\n\nconst mockReferences = [\n    { id: 'ref-1', applicant_id: 'app-1', referee_name: 'John Manager', status: 'verified', suitability_rating: 'excellent' },\n    { id: 'ref-2', applicant_id: 'app-1', referee_name: 'Jane Director', status: 'verified', suitability_rating: 'good' },\n    { id: 'ref-3', applicant_id: 'app-2', referee_name: 'Bob HR', status: 'pending', suitability_rating: null },\n];\n\nvi.mock('@/lib/supabase', () => ({\n    supabase: { from: vi.fn(() => ({ select: vi.fn(() => ({ order: vi.fn(() => Promise.resolve({ data: [], error: null })) })) })) },\n}));\n\ndescribe('useComplianceData Hook', () => {\n    beforeEach(() => { vi.clearAllMocks(); });\n\n    describe('DBS Checks', () => {\n        it('should have valid DBS check structure', () => {\n            mockDBSChecks.forEach(dbs => {\n                expect(dbs).toHaveProperty('id');\n                expect(dbs).toHaveProperty('user_id');\n                expect(dbs).toHaveProperty('dbs_number');\n                expect(dbs).toHaveProperty('check_type');\n                expect(dbs).toHaveProperty('status');\n            });\n        });\n\n        it('should have valid check types', () => {\n            const validTypes = ['basic', 'standard', 'enhanced', 'enhanced_barred'];\n            mockDBSChecks.forEach(dbs => expect(validTypes).toContain(dbs.check_type));\n        });\n\n        it('should identify expiring checks', () => {\n            const today = new Date('2024-01-15');\n            const expiring = mockDBSChecks.filter(dbs => {\n                if (!dbs.expiry_date) return false;\n                const exp = new Date(dbs.expiry_date);\n                const daysUntil = (exp.getTime() - today.getTime()) / (1000 * 60 * 60 * 24);\n                return daysUntil <= 90 && daysUntil > 0;\n            });\n            expect(expiring.length).toBe(1);\n        });\n\n        it('should count completed checks', () => {\n            const completed = mockDBSChecks.filter(dbs => dbs.status === 'completed');\n            expect(completed.length).toBe(2);\n        });\n    });\n\n    describe('Training Records', () => {\n        it('should have valid training structure', () => {\n            mockTrainingRecords.forEach(tr => {\n                expect(tr).toHaveProperty('id');\n                expect(tr).toHaveProperty('training_name');\n                expect(tr).toHaveProperty('is_mandatory');\n                expect(tr).toHaveProperty('status');\n            });\n        });\n\n        it('should filter mandatory training', () => {\n            const mandatory = mockTrainingRecords.filter(tr => tr.is_mandatory);\n            expect(mandatory.length).toBe(3);\n        });\n\n        it('should calculate completion rate', () => {\n            const mandatory = mockTrainingRecords.filter(tr => tr.is_mandatory);\n            const completed = mandatory.filter(tr => tr.status === 'completed');\n            const rate = (completed.length / mandatory.length) * 100;\n            expect(rate.toFixed(0)).toBe('67');\n        });\n    });\n\n    describe('References', () => {\n        it('should have valid reference structure', () => {\n            mockReferences.forEach(ref => {\n                expect(ref).toHaveProperty('id');\n                expect(ref).toHaveProperty('applicant_id');\n                expect(ref).toHaveProperty('referee_name');\n                expect(ref).toHaveProperty('status');\n            });\n        });\n\n        it('should have valid suitability ratings', () => {\n            const validRatings = ['excellent', 'good', 'satisfactory', 'concerns', null];\n            mockReferences.forEach(ref => expect(validRatings).toContain(ref.suitability_rating));\n        });\n\n        it('should count verified references per applicant', () => {\n            const verified = mockReferences.filter(r => r.applicant_id === 'app-1' && r.status === 'verified');\n            expect(verified.length).toBe(2);\n        });\n    });\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/hooks/__tests__/useDocumentsMessages.test.ts","messages":[{"ruleId":"@typescript-eslint/triple-slash-reference","severity":2,"message":"Do not use a triple slash reference for vitest, use `import` style instead.","line":1,"column":1,"nodeType":"Line","messageId":"tripleSlashReference","endLine":1,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/// <reference types=\"vitest\" />\n/**\n * useDocuments and useMessages Hook Tests\n */\n\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\n\n// Documents mock data\nconst mockDocuments = [\n    { id: 'doc-1', name: 'Employment Contract', category: 'contracts', file_type: 'application/pdf', file_size: 152340, status: 'verified' },\n    { id: 'doc-2', name: 'ID Verification', category: 'identity', file_type: 'image/jpeg', file_size: 245000, status: 'verified' },\n    { id: 'doc-3', name: 'Certificate', category: 'qualifications', file_type: 'application/pdf', file_size: 89000, status: 'pending' },\n    { id: 'doc-4', name: 'Reference Letter', category: 'references', file_type: 'application/pdf', file_size: 67000, status: 'verified' },\n];\n\n// Messages mock data\nconst mockMessages = [\n    { id: 'msg-1', sender_id: 'user-1', recipient_id: 'user-2', subject: 'Meeting', body: 'Can we meet?', is_read: false, created_at: '2024-02-20T10:00:00Z' },\n    { id: 'msg-2', sender_id: 'user-2', recipient_id: 'user-1', subject: 'Re: Meeting', body: 'Yes, 2pm works', is_read: true, created_at: '2024-02-20T11:00:00Z' },\n    { id: 'msg-3', sender_id: 'user-3', recipient_id: 'user-1', subject: 'Leave Request', body: 'Please approve', is_read: false, created_at: '2024-02-21T09:00:00Z' },\n];\n\nvi.mock('@/lib/supabase', () => ({\n    supabase: { from: vi.fn(() => ({ select: vi.fn(() => Promise.resolve({ data: [], error: null })) })) },\n}));\n\ndescribe('useDocuments Hook', () => {\n    beforeEach(() => { vi.clearAllMocks(); });\n\n    describe('Document Data', () => {\n        it('should have valid document structure', () => {\n            mockDocuments.forEach(doc => {\n                expect(doc).toHaveProperty('id');\n                expect(doc).toHaveProperty('name');\n                expect(doc).toHaveProperty('category');\n                expect(doc).toHaveProperty('file_type');\n            });\n        });\n\n        it('should have valid file types', () => {\n            const validTypes = ['application/pdf', 'image/jpeg', 'image/png', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];\n            mockDocuments.forEach(doc => expect(validTypes).toContain(doc.file_type));\n        });\n\n        it('should have valid categories', () => {\n            const validCategories = ['contracts', 'identity', 'qualifications', 'references', 'compliance', 'other'];\n            mockDocuments.forEach(doc => expect(validCategories).toContain(doc.category));\n        });\n\n        it('should have positive file sizes', () => {\n            mockDocuments.forEach(doc => expect(doc.file_size).toBeGreaterThan(0));\n        });\n\n        it('should filter by status', () => {\n            const verified = mockDocuments.filter(d => d.status === 'verified');\n            expect(verified.length).toBe(3);\n        });\n\n        it('should filter by category', () => {\n            const contracts = mockDocuments.filter(d => d.category === 'contracts');\n            expect(contracts.length).toBe(1);\n        });\n    });\n});\n\ndescribe('useMessages Hook', () => {\n    beforeEach(() => { vi.clearAllMocks(); });\n\n    describe('Message Data', () => {\n        it('should have valid message structure', () => {\n            mockMessages.forEach(msg => {\n                expect(msg).toHaveProperty('id');\n                expect(msg).toHaveProperty('sender_id');\n                expect(msg).toHaveProperty('recipient_id');\n                expect(msg).toHaveProperty('subject');\n                expect(msg).toHaveProperty('body');\n            });\n        });\n\n        it('should count unread messages', () => {\n            const unread = mockMessages.filter(m => !m.is_read);\n            expect(unread.length).toBe(2);\n        });\n\n        it('should filter inbox by recipient', () => {\n            const inbox = mockMessages.filter(m => m.recipient_id === 'user-1');\n            expect(inbox.length).toBe(2);\n        });\n\n        it('should filter sent by sender', () => {\n            const sent = mockMessages.filter(m => m.sender_id === 'user-1');\n            expect(sent.length).toBe(1);\n        });\n\n        it('should sort by date descending', () => {\n            const sorted = [...mockMessages].sort((a, b) => new Date(b.created_at).getTime() - new Date(a.created_at).getTime());\n            expect(sorted[0].id).toBe('msg-3');\n        });\n    });\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/hooks/__tests__/useEmployees.test.ts","messages":[{"ruleId":"@typescript-eslint/triple-slash-reference","severity":2,"message":"Do not use a triple slash reference for vitest, use `import` style instead.","line":1,"column":1,"nodeType":"Line","messageId":"tripleSlashReference","endLine":1,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/// <reference types=\"vitest\" />\n/**\n * useEmployees Hook Tests\n */\n\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\n\n// Mock data\nconst mockEmployees = [\n    {\n        id: 'emp-1',\n        user_id: 'user-1',\n        tenant_id: 'tenant-1',\n        employee_number: 'EMP001',\n        first_name: 'John',\n        last_name: 'Doe',\n        email: 'john.doe@company.com',\n        phone: '+447123456789',\n        department: 'Engineering',\n        position: 'Senior Software Engineer',\n        manager_id: 'emp-5',\n        hire_date: '2022-03-15',\n        employment_type: 'full_time',\n        salary: 75000,\n        is_active: true,\n        created_at: '2022-03-15T10:00:00Z',\n    },\n    {\n        id: 'emp-2',\n        user_id: 'user-2',\n        tenant_id: 'tenant-1',\n        employee_number: 'EMP002',\n        first_name: 'Jane',\n        last_name: 'Smith',\n        email: 'jane.smith@company.com',\n        phone: '+447987654321',\n        department: 'Product',\n        position: 'Product Manager',\n        manager_id: 'emp-6',\n        hire_date: '2021-06-01',\n        employment_type: 'full_time',\n        salary: 85000,\n        is_active: true,\n        created_at: '2021-06-01T10:00:00Z',\n    },\n    {\n        id: 'emp-3',\n        user_id: 'user-3',\n        tenant_id: 'tenant-1',\n        employee_number: 'EMP003',\n        first_name: 'Bob',\n        last_name: 'Johnson',\n        email: 'bob.johnson@company.com',\n        phone: '+447555123456',\n        department: 'Engineering',\n        position: 'Junior Developer',\n        manager_id: 'emp-1',\n        hire_date: '2023-09-01',\n        employment_type: 'full_time',\n        salary: 45000,\n        is_active: true,\n        created_at: '2023-09-01T10:00:00Z',\n    },\n    {\n        id: 'emp-4',\n        user_id: 'user-4',\n        tenant_id: 'tenant-1',\n        employee_number: 'EMP004',\n        first_name: 'Alice',\n        last_name: 'Williams',\n        email: 'alice.williams@company.com',\n        phone: '+447888999000',\n        department: 'HR',\n        position: 'HR Coordinator',\n        manager_id: null,\n        hire_date: '2020-01-15',\n        employment_type: 'part_time',\n        salary: 35000,\n        is_active: false,\n        created_at: '2020-01-15T10:00:00Z',\n    },\n];\n\n// Mock Supabase\nvi.mock('@/lib/supabase', () => ({\n    supabase: {\n        from: vi.fn(() => ({\n            select: vi.fn(() => ({\n                order: vi.fn(() => Promise.resolve({ data: mockEmployees, error: null })),\n                eq: vi.fn(() => ({\n                    single: vi.fn(() => Promise.resolve({ data: mockEmployees[0], error: null })),\n                })),\n            })),\n            insert: vi.fn(() => ({\n                select: vi.fn(() => ({\n                    single: vi.fn(() => Promise.resolve({ data: mockEmployees[0], error: null })),\n                })),\n            })),\n            update: vi.fn(() => ({\n                eq: vi.fn(() => ({\n                    select: vi.fn(() => ({\n                        single: vi.fn(() => Promise.resolve({ data: mockEmployees[0], error: null })),\n                    })),\n                })),\n            })),\n            delete: vi.fn(() => ({\n                eq: vi.fn(() => Promise.resolve({ error: null })),\n            })),\n        })),\n    },\n    getSupabaseClient: () => ({}),\n}));\n\ndescribe('useEmployees Hook', () => {\n    beforeEach(() => {\n        vi.clearAllMocks();\n    });\n\n    describe('Mock Data Validation', () => {\n        it('should have valid employee structure', () => {\n            mockEmployees.forEach(emp => {\n                expect(emp).toHaveProperty('id');\n                expect(emp).toHaveProperty('first_name');\n                expect(emp).toHaveProperty('last_name');\n                expect(emp).toHaveProperty('email');\n                expect(emp).toHaveProperty('department');\n                expect(emp).toHaveProperty('position');\n            });\n        });\n\n        it('should have unique employee numbers', () => {\n            const numbers = mockEmployees.map(e => e.employee_number);\n            const uniqueNumbers = new Set(numbers);\n            expect(uniqueNumbers.size).toBe(numbers.length);\n        });\n\n        it('should have valid email formats', () => {\n            const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n            mockEmployees.forEach(emp => {\n                expect(emailRegex.test(emp.email)).toBe(true);\n            });\n        });\n\n        it('should have valid employment types', () => {\n            const validTypes = ['full_time', 'part_time', 'contract', 'intern'];\n            mockEmployees.forEach(emp => {\n                expect(validTypes).toContain(emp.employment_type);\n            });\n        });\n\n        it('should have valid hire dates', () => {\n            mockEmployees.forEach(emp => {\n                const hireDate = new Date(emp.hire_date);\n                expect(hireDate).toBeInstanceOf(Date);\n                expect(isNaN(hireDate.getTime())).toBe(false);\n            });\n        });\n    });\n\n    describe('Employee Filtering', () => {\n        it('should filter by department', () => {\n            const engineering = mockEmployees.filter(e => e.department === 'Engineering');\n            expect(engineering.length).toBe(2);\n        });\n\n        it('should filter active employees', () => {\n            const active = mockEmployees.filter(e => e.is_active);\n            expect(active.length).toBe(3);\n        });\n\n        it('should filter by employment type', () => {\n            const fullTime = mockEmployees.filter(e => e.employment_type === 'full_time');\n            expect(fullTime.length).toBe(3);\n        });\n\n        it('should search by name', () => {\n            const searchTerm = 'john';\n            const results = mockEmployees.filter(e =>\n                e.first_name.toLowerCase().includes(searchTerm) ||\n                e.last_name.toLowerCase().includes(searchTerm)\n            );\n            expect(results.length).toBe(2); // John Doe and Bob Johnson\n        });\n    });\n\n    describe('Employee Hierarchy', () => {\n        it('should identify employees with managers', () => {\n            const withManager = mockEmployees.filter(e => e.manager_id !== null);\n            expect(withManager.length).toBe(3);\n        });\n\n        it('should find direct reports', () => {\n            const directReports = mockEmployees.filter(e => e.manager_id === 'emp-1');\n            expect(directReports.length).toBe(1);\n            expect(directReports[0].first_name).toBe('Bob');\n        });\n    });\n\n    describe('Employee Statistics', () => {\n        it('should calculate department headcount', () => {\n            const deptCounts = mockEmployees.reduce((acc, emp) => {\n                acc[emp.department] = (acc[emp.department] || 0) + 1;\n                return acc;\n            }, {} as Record<string, number>);\n\n            expect(deptCounts['Engineering']).toBe(2);\n            expect(deptCounts['Product']).toBe(1);\n            expect(deptCounts['HR']).toBe(1);\n        });\n\n        it('should calculate average salary by department', () => {\n            const engineering = mockEmployees.filter(e => e.department === 'Engineering');\n            const avgSalary = engineering.reduce((sum, e) => sum + e.salary, 0) / engineering.length;\n            expect(avgSalary).toBe(60000);\n        });\n\n        it('should calculate tenure in years', () => {\n            const calcTenure = (hireDate: string) => {\n                const hire = new Date(hireDate);\n                const now = new Date('2024-01-15');\n                const years = (now.getTime() - hire.getTime()) / (365.25 * 24 * 60 * 60 * 1000);\n                return Math.floor(years);\n            };\n\n            expect(calcTenure('2022-03-15')).toBe(1);\n            expect(calcTenure('2020-01-15')).toBe(4);\n        });\n    });\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/hooks/__tests__/useInterviews.test.ts","messages":[{"ruleId":"@typescript-eslint/triple-slash-reference","severity":2,"message":"Do not use a triple slash reference for vitest, use `import` style instead.","line":1,"column":1,"nodeType":"Line","messageId":"tripleSlashReference","endLine":1,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/// <reference types=\"vitest\" />\n/**\n * useInterviews Hook Tests\n */\n\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\n\n// Mock data\nconst mockInterviews = [\n    {\n        id: 'int-1',\n        application_id: 'app-1',\n        interview_type: 'phone_screen',\n        scheduled_date: '2024-02-01T10:00:00Z',\n        duration: 30,\n        location: null,\n        meeting_link: 'https://meet.google.com/abc-defg-hij',\n        status: 'completed',\n        rating: 4,\n        notes: 'Good communication skills',\n        interviewer_id: 'user-1',\n        created_at: '2024-01-20T10:00:00Z',\n    },\n    {\n        id: 'int-2',\n        application_id: 'app-1',\n        interview_type: 'technical',\n        scheduled_date: '2024-02-05T14:00:00Z',\n        duration: 60,\n        location: null,\n        meeting_link: 'https://meet.google.com/xyz-uvwx-rst',\n        status: 'scheduled',\n        rating: null,\n        notes: null,\n        interviewer_id: 'user-2',\n        created_at: '2024-01-25T10:00:00Z',\n    },\n    {\n        id: 'int-3',\n        application_id: 'app-2',\n        interview_type: 'final',\n        scheduled_date: '2024-02-10T11:00:00Z',\n        duration: 45,\n        location: 'Conference Room A',\n        meeting_link: null,\n        status: 'scheduled',\n        rating: null,\n        notes: null,\n        interviewer_id: 'user-3',\n        created_at: '2024-01-30T10:00:00Z',\n    },\n    {\n        id: 'int-4',\n        application_id: 'app-3',\n        interview_type: 'technical',\n        scheduled_date: '2024-01-28T09:00:00Z',\n        duration: 60,\n        location: null,\n        meeting_link: 'https://zoom.us/j/123456789',\n        status: 'cancelled',\n        rating: null,\n        notes: 'Candidate requested reschedule',\n        interviewer_id: 'user-2',\n        created_at: '2024-01-22T10:00:00Z',\n    },\n];\n\n// Mock Supabase\nvi.mock('@/lib/supabase', () => ({\n    supabase: {\n        from: vi.fn(() => ({\n            select: vi.fn(() => ({\n                order: vi.fn(() => Promise.resolve({ data: mockInterviews, error: null })),\n                eq: vi.fn(() => ({\n                    single: vi.fn(() => Promise.resolve({ data: mockInterviews[0], error: null })),\n                })),\n            })),\n            insert: vi.fn(() => ({\n                select: vi.fn(() => ({\n                    single: vi.fn(() => Promise.resolve({ data: mockInterviews[0], error: null })),\n                })),\n            })),\n            update: vi.fn(() => ({\n                eq: vi.fn(() => ({\n                    select: vi.fn(() => ({\n                        single: vi.fn(() => Promise.resolve({ data: mockInterviews[0], error: null })),\n                    })),\n                })),\n            })),\n            delete: vi.fn(() => ({\n                eq: vi.fn(() => Promise.resolve({ error: null })),\n            })),\n        })),\n    },\n    getSupabaseClient: () => ({}),\n}));\n\ndescribe('useInterviews Hook', () => {\n    beforeEach(() => {\n        vi.clearAllMocks();\n    });\n\n    describe('Mock Data Validation', () => {\n        it('should have valid interview structure', () => {\n            mockInterviews.forEach(interview => {\n                expect(interview).toHaveProperty('id');\n                expect(interview).toHaveProperty('application_id');\n                expect(interview).toHaveProperty('interview_type');\n                expect(interview).toHaveProperty('scheduled_date');\n                expect(interview).toHaveProperty('duration');\n                expect(interview).toHaveProperty('status');\n            });\n        });\n\n        it('should have valid interview types', () => {\n            const validTypes = ['phone_screen', 'technical', 'behavioral', 'final', 'hr', 'cultural_fit'];\n            mockInterviews.forEach(interview => {\n                expect(validTypes).toContain(interview.interview_type);\n            });\n        });\n\n        it('should have valid status values', () => {\n            const validStatuses = ['scheduled', 'completed', 'cancelled', 'no_show'];\n            mockInterviews.forEach(interview => {\n                expect(validStatuses).toContain(interview.status);\n            });\n        });\n\n        it('should have valid duration in minutes', () => {\n            mockInterviews.forEach(interview => {\n                expect(interview.duration).toBeGreaterThan(0);\n                expect(interview.duration).toBeLessThanOrEqual(180); // Max 3 hours\n            });\n        });\n\n        it('should have rating only for completed interviews', () => {\n            mockInterviews.forEach(interview => {\n                if (interview.status === 'completed') {\n                    expect(interview.rating).toBeDefined();\n                    expect(interview.rating).toBeGreaterThanOrEqual(1);\n                    expect(interview.rating).toBeLessThanOrEqual(5);\n                }\n            });\n        });\n    });\n\n    describe('Interview Filtering', () => {\n        it('should filter interviews by application', () => {\n            const filtered = mockInterviews.filter(i => i.application_id === 'app-1');\n            expect(filtered.length).toBe(2);\n        });\n\n        it('should filter scheduled interviews', () => {\n            const scheduled = mockInterviews.filter(i => i.status === 'scheduled');\n            expect(scheduled.length).toBe(2);\n        });\n\n        it('should filter interviews by type', () => {\n            const technical = mockInterviews.filter(i => i.interview_type === 'technical');\n            expect(technical.length).toBe(2);\n        });\n\n        it('should filter upcoming interviews', () => {\n            const now = new Date('2024-02-03T00:00:00Z');\n            const upcoming = mockInterviews.filter(i =>\n                new Date(i.scheduled_date) > now && i.status === 'scheduled'\n            );\n            expect(upcoming.length).toBe(2);\n        });\n    });\n\n    describe('Interview Scheduling Logic', () => {\n        it('should validate no overlapping interviews for same interviewer', () => {\n            const checkOverlap = (newInterview: any) => {\n                return mockInterviews.some(existing => {\n                    if (existing.interviewer_id !== newInterview.interviewer_id) return false;\n                    if (existing.status === 'cancelled') return false;\n\n                    const existingStart = new Date(existing.scheduled_date);\n                    const existingEnd = new Date(existingStart.getTime() + existing.duration * 60000);\n                    const newStart = new Date(newInterview.scheduled_date);\n                    const newEnd = new Date(newStart.getTime() + newInterview.duration * 60000);\n\n                    return (newStart < existingEnd && newEnd > existingStart);\n                });\n            };\n\n            const conflictingInterview = {\n                interviewer_id: 'user-2',\n                scheduled_date: '2024-02-05T14:30:00Z',\n                duration: 30,\n            };\n\n            expect(checkOverlap(conflictingInterview)).toBe(true);\n        });\n\n        it('should validate meeting link or location is provided', () => {\n            mockInterviews.forEach(interview => {\n                if (interview.status !== 'cancelled') {\n                    const hasLocation = interview.location !== null || interview.meeting_link !== null;\n                    expect(hasLocation).toBe(true);\n                }\n            });\n        });\n    });\n\n    describe('Interview Rating', () => {\n        it('should calculate average rating for completed interviews', () => {\n            const completed = mockInterviews.filter(i => i.status === 'completed' && i.rating !== null);\n            const avgRating = completed.reduce((sum, i) => sum + (i.rating || 0), 0) / completed.length;\n            expect(avgRating).toBe(4);\n        });\n    });\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/hooks/__tests__/useJobs.test.ts","messages":[{"ruleId":"@typescript-eslint/triple-slash-reference","severity":2,"message":"Do not use a triple slash reference for vitest, use `import` style instead.","line":1,"column":1,"nodeType":"Line","messageId":"tripleSlashReference","endLine":1,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/// <reference types=\"vitest\" />\n/**\n * useJobs Hook Tests  \n */\n\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\n\nconst mockJobs = [\n    {\n        id: 'job-1', job_title: 'Senior Software Engineer', job_code: 'SSE-001', department: 'Engineering', location: 'Remote', employment_type: 'full_time',\n        salary_range_min: 80000, salary_range_max: 120000, status: 'open', applications_count: 45, created_at: '2024-01-01T10:00:00Z'\n    },\n    {\n        id: 'job-2', job_title: 'Product Manager', job_code: 'PM-002', department: 'Product', location: 'London', employment_type: 'full_time',\n        salary_range_min: 70000, salary_range_max: 100000, status: 'open', applications_count: 32, created_at: '2024-01-05T10:00:00Z'\n    },\n    {\n        id: 'job-3', job_title: 'UX Designer', job_code: 'UX-003', department: 'Design', location: 'Hybrid', employment_type: 'full_time',\n        salary_range_min: 55000, salary_range_max: 75000, status: 'closed', applications_count: 28, created_at: '2023-11-15T10:00:00Z'\n    },\n    {\n        id: 'job-4', job_title: 'Data Analyst', job_code: 'DA-004', department: 'Analytics', location: 'Remote', employment_type: 'contract',\n        salary_range_min: 45000, salary_range_max: 65000, status: 'draft', applications_count: 0, created_at: '2024-02-01T10:00:00Z'\n    },\n];\n\nvi.mock('@/lib/supabase', () => ({\n    supabase: { from: vi.fn(() => ({ select: vi.fn(() => ({ order: vi.fn(() => Promise.resolve({ data: mockJobs, error: null })) })) })) },\n}));\n\ndescribe('useJobs Hook', () => {\n    beforeEach(() => { vi.clearAllMocks(); });\n\n    describe('Job Data', () => {\n        it('should have valid job structure', () => {\n            mockJobs.forEach(job => {\n                expect(job).toHaveProperty('id');\n                expect(job).toHaveProperty('job_title');\n                expect(job).toHaveProperty('department');\n                expect(job).toHaveProperty('status');\n            });\n        });\n\n        it('should have unique job codes', () => {\n            const codes = mockJobs.map(j => j.job_code);\n            expect(new Set(codes).size).toBe(codes.length);\n        });\n\n        it('should have valid status values', () => {\n            const validStatuses = ['draft', 'open', 'closed', 'paused'];\n            mockJobs.forEach(job => expect(validStatuses).toContain(job.status));\n        });\n\n        it('should have valid employment types', () => {\n            const validTypes = ['full_time', 'part_time', 'contract', 'intern', 'temporary'];\n            mockJobs.forEach(job => expect(validTypes).toContain(job.employment_type));\n        });\n\n        it('should have valid salary ranges', () => {\n            mockJobs.forEach(job => {\n                expect(job.salary_range_min).toBeGreaterThan(0);\n                expect(job.salary_range_max).toBeGreaterThan(job.salary_range_min);\n            });\n        });\n    });\n\n    describe('Job Filtering', () => {\n        it('should filter by status', () => {\n            const open = mockJobs.filter(j => j.status === 'open');\n            expect(open.length).toBe(2);\n        });\n\n        it('should filter by department', () => {\n            const engineering = mockJobs.filter(j => j.department === 'Engineering');\n            expect(engineering.length).toBe(1);\n        });\n\n        it('should filter by location', () => {\n            const remote = mockJobs.filter(j => j.location === 'Remote');\n            expect(remote.length).toBe(2);\n        });\n\n        it('should search by title', () => {\n            const search = 'engineer';\n            const results = mockJobs.filter(j => j.job_title.toLowerCase().includes(search));\n            expect(results.length).toBe(1);\n        });\n    });\n\n    describe('Job Statistics', () => {\n        it('should calculate total applications', () => {\n            const total = mockJobs.reduce((sum, j) => sum + j.applications_count, 0);\n            expect(total).toBe(105);\n        });\n\n        it('should count jobs by status', () => {\n            const statusCounts = mockJobs.reduce((acc, j) => {\n                acc[j.status] = (acc[j.status] || 0) + 1;\n                return acc;\n            }, {} as Record<string, number>);\n            expect(statusCounts['open']).toBe(2);\n            expect(statusCounts['closed']).toBe(1);\n            expect(statusCounts['draft']).toBe(1);\n        });\n\n        it('should calculate average applications per job', () => {\n            const openJobs = mockJobs.filter(j => j.status === 'open');\n            const avg = openJobs.reduce((sum, j) => sum + j.applications_count, 0) / openJobs.length;\n            expect(avg).toBe(38.5);\n        });\n    });\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/hooks/__tests__/useLeaveRequests.test.ts","messages":[{"ruleId":"@typescript-eslint/triple-slash-reference","severity":2,"message":"Do not use a triple slash reference for vitest, use `import` style instead.","line":1,"column":1,"nodeType":"Line","messageId":"tripleSlashReference","endLine":1,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/// <reference types=\"vitest\" />\n/**\n * useLeaveRequests Hook Tests\n */\n\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\n\n// Mock data\nconst mockLeaveRequests = [\n    {\n        id: 'leave-1',\n        employee_id: 'emp-1',\n        leave_type: 'annual',\n        start_date: '2024-03-01',\n        end_date: '2024-03-05',\n        total_days: 5,\n        status: 'approved',\n        reason: 'Family vacation',\n        approver_id: 'emp-5',\n        approved_at: '2024-02-20T10:00:00Z',\n        created_at: '2024-02-15T10:00:00Z',\n    },\n    {\n        id: 'leave-2',\n        employee_id: 'emp-2',\n        leave_type: 'sick',\n        start_date: '2024-02-10',\n        end_date: '2024-02-11',\n        total_days: 2,\n        status: 'approved',\n        reason: 'Medical appointment',\n        approver_id: 'emp-6',\n        approved_at: '2024-02-10T08:00:00Z',\n        created_at: '2024-02-10T07:00:00Z',\n    },\n    {\n        id: 'leave-3',\n        employee_id: 'emp-3',\n        leave_type: 'annual',\n        start_date: '2024-04-15',\n        end_date: '2024-04-19',\n        total_days: 5,\n        status: 'pending',\n        reason: 'Personal travel',\n        approver_id: null,\n        approved_at: null,\n        created_at: '2024-02-25T10:00:00Z',\n    },\n    {\n        id: 'leave-4',\n        employee_id: 'emp-1',\n        leave_type: 'wfh',\n        start_date: '2024-02-28',\n        end_date: '2024-02-28',\n        total_days: 1,\n        status: 'rejected',\n        reason: 'Important team meeting scheduled',\n        approver_id: 'emp-5',\n        approved_at: null,\n        rejection_reason: 'Critical meeting on this date',\n        created_at: '2024-02-20T10:00:00Z',\n    },\n    {\n        id: 'leave-5',\n        employee_id: 'emp-2',\n        leave_type: 'maternity',\n        start_date: '2024-06-01',\n        end_date: '2024-09-01',\n        total_days: 93,\n        status: 'approved',\n        reason: 'Maternity leave',\n        approver_id: 'emp-6',\n        approved_at: '2024-02-01T10:00:00Z',\n        created_at: '2024-01-15T10:00:00Z',\n    },\n];\n\nconst mockLeaveBalances = [\n    { employee_id: 'emp-1', leave_type: 'annual', total_days: 25, used_days: 5, remaining_days: 20 },\n    { employee_id: 'emp-1', leave_type: 'sick', total_days: 10, used_days: 0, remaining_days: 10 },\n    { employee_id: 'emp-2', leave_type: 'annual', total_days: 25, used_days: 2, remaining_days: 23 },\n    { employee_id: 'emp-2', leave_type: 'maternity', total_days: 182, used_days: 0, remaining_days: 182 },\n    { employee_id: 'emp-3', leave_type: 'annual', total_days: 20, used_days: 0, remaining_days: 20 },\n];\n\n// Mock Supabase\nvi.mock('@/lib/supabase', () => ({\n    supabase: {\n        from: vi.fn(() => ({\n            select: vi.fn(() => ({\n                order: vi.fn(() => Promise.resolve({ data: mockLeaveRequests, error: null })),\n                eq: vi.fn(() => ({\n                    single: vi.fn(() => Promise.resolve({ data: mockLeaveRequests[0], error: null })),\n                })),\n            })),\n            insert: vi.fn(() => ({\n                select: vi.fn(() => ({\n                    single: vi.fn(() => Promise.resolve({ data: mockLeaveRequests[0], error: null })),\n                })),\n            })),\n            update: vi.fn(() => ({\n                eq: vi.fn(() => Promise.resolve({ data: mockLeaveRequests[0], error: null })),\n            })),\n        })),\n    },\n    getSupabaseClient: () => ({}),\n}));\n\ndescribe('useLeaveRequests Hook', () => {\n    beforeEach(() => {\n        vi.clearAllMocks();\n    });\n\n    describe('Mock Data Validation', () => {\n        it('should have valid leave request structure', () => {\n            mockLeaveRequests.forEach(leave => {\n                expect(leave).toHaveProperty('id');\n                expect(leave).toHaveProperty('employee_id');\n                expect(leave).toHaveProperty('leave_type');\n                expect(leave).toHaveProperty('start_date');\n                expect(leave).toHaveProperty('end_date');\n                expect(leave).toHaveProperty('status');\n            });\n        });\n\n        it('should have valid leave types', () => {\n            const validTypes = ['annual', 'sick', 'wfh', 'maternity', 'paternity', 'bereavement', 'unpaid'];\n            mockLeaveRequests.forEach(leave => {\n                expect(validTypes).toContain(leave.leave_type);\n            });\n        });\n\n        it('should have valid status values', () => {\n            const validStatuses = ['pending', 'approved', 'rejected', 'cancelled'];\n            mockLeaveRequests.forEach(leave => {\n                expect(validStatuses).toContain(leave.status);\n            });\n        });\n\n        it('should have end date >= start date', () => {\n            mockLeaveRequests.forEach(leave => {\n                const start = new Date(leave.start_date);\n                const end = new Date(leave.end_date);\n                expect(end.getTime()).toBeGreaterThanOrEqual(start.getTime());\n            });\n        });\n\n        it('should have total_days matching date range', () => {\n            mockLeaveRequests.forEach(leave => {\n                const start = new Date(leave.start_date);\n                const end = new Date(leave.end_date);\n                const diff = Math.ceil((end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24)) + 1;\n                expect(leave.total_days).toBe(diff);\n            });\n        });\n    });\n\n    describe('Leave Request Filtering', () => {\n        it('should filter by employee', () => {\n            const emp1Leaves = mockLeaveRequests.filter(l => l.employee_id === 'emp-1');\n            expect(emp1Leaves.length).toBe(2);\n        });\n\n        it('should filter by status', () => {\n            const pending = mockLeaveRequests.filter(l => l.status === 'pending');\n            expect(pending.length).toBe(1);\n        });\n\n        it('should filter by leave type', () => {\n            const annual = mockLeaveRequests.filter(l => l.leave_type === 'annual');\n            expect(annual.length).toBe(2);\n        });\n\n        it('should filter by date range', () => {\n            const march2024 = mockLeaveRequests.filter(l => {\n                const start = new Date(l.start_date);\n                return start.getMonth() === 2 && start.getFullYear() === 2024;\n            });\n            expect(march2024.length).toBe(1);\n        });\n    });\n\n    describe('Leave Balance Calculations', () => {\n        it('should have valid balance structure', () => {\n            mockLeaveBalances.forEach(balance => {\n                expect(balance).toHaveProperty('employee_id');\n                expect(balance).toHaveProperty('leave_type');\n                expect(balance).toHaveProperty('total_days');\n                expect(balance).toHaveProperty('used_days');\n                expect(balance).toHaveProperty('remaining_days');\n            });\n        });\n\n        it('should have remaining = total - used', () => {\n            mockLeaveBalances.forEach(balance => {\n                expect(balance.remaining_days).toBe(balance.total_days - balance.used_days);\n            });\n        });\n\n        it('should not allow negative remaining days', () => {\n            mockLeaveBalances.forEach(balance => {\n                expect(balance.remaining_days).toBeGreaterThanOrEqual(0);\n            });\n        });\n    });\n\n    describe('Leave Conflict Detection', () => {\n        it('should detect overlapping leave requests', () => {\n            const checkOverlap = (newRequest: any) => {\n                return mockLeaveRequests.some(existing => {\n                    if (existing.employee_id !== newRequest.employee_id) return false;\n                    if (existing.status === 'rejected' || existing.status === 'cancelled') return false;\n\n                    const existStart = new Date(existing.start_date);\n                    const existEnd = new Date(existing.end_date);\n                    const newStart = new Date(newRequest.start_date);\n                    const newEnd = new Date(newRequest.end_date);\n\n                    return newStart <= existEnd && newEnd >= existStart;\n                });\n            };\n\n            const conflictingRequest = {\n                employee_id: 'emp-1',\n                start_date: '2024-03-03',\n                end_date: '2024-03-07',\n            };\n\n            expect(checkOverlap(conflictingRequest)).toBe(true);\n        });\n\n        it('should allow non-overlapping requests', () => {\n            const checkOverlap = (newRequest: any) => {\n                return mockLeaveRequests.some(existing => {\n                    if (existing.employee_id !== newRequest.employee_id) return false;\n                    if (existing.status === 'rejected' || existing.status === 'cancelled') return false;\n\n                    const existStart = new Date(existing.start_date);\n                    const existEnd = new Date(existing.end_date);\n                    const newStart = new Date(newRequest.start_date);\n                    const newEnd = new Date(newRequest.end_date);\n\n                    return newStart <= existEnd && newEnd >= existStart;\n                });\n            };\n\n            const validRequest = {\n                employee_id: 'emp-1',\n                start_date: '2024-05-01',\n                end_date: '2024-05-03',\n            };\n\n            expect(checkOverlap(validRequest)).toBe(false);\n        });\n    });\n\n    describe('Leave Statistics', () => {\n        it('should calculate total approved leave days', () => {\n            const approved = mockLeaveRequests.filter(l => l.status === 'approved');\n            const totalDays = approved.reduce((sum, l) => sum + l.total_days, 0);\n            expect(totalDays).toBe(100); // 5 + 2 + 93 = 100\n        });\n\n        it('should count requests by status', () => {\n            const statusCounts = mockLeaveRequests.reduce((acc, l) => {\n                acc[l.status] = (acc[l.status] || 0) + 1;\n                return acc;\n            }, {} as Record<string, number>);\n\n            expect(statusCounts['approved']).toBe(3);\n            expect(statusCounts['pending']).toBe(1);\n            expect(statusCounts['rejected']).toBe(1);\n        });\n    });\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/hooks/__tests__/usePerformance.test.ts","messages":[{"ruleId":"@typescript-eslint/triple-slash-reference","severity":2,"message":"Do not use a triple slash reference for vitest, use `import` style instead.","line":1,"column":1,"nodeType":"Line","messageId":"tripleSlashReference","endLine":1,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/// <reference types=\"vitest\" />\n/**\n * usePerformance Hook Tests\n */\n\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\n\n// Mock data\nconst mockReviews = [\n    {\n        id: 'review-1',\n        employee_id: 'emp-1',\n        reviewer_id: 'emp-5',\n        review_type: 'annual',\n        status: 'completed',\n        overall_rating: 4.5,\n    },\n    {\n        id: 'review-2',\n        employee_id: 'emp-2',\n        reviewer_id: 'emp-6',\n        review_type: 'quarterly',\n        status: 'completed',\n        overall_rating: 4.0,\n    },\n    {\n        id: 'review-3',\n        employee_id: 'emp-3',\n        reviewer_id: 'emp-1',\n        review_type: 'probation',\n        status: 'in_progress',\n        overall_rating: null,\n    },\n];\n\nconst mockGoals = [\n    { id: 'goal-1', employee_id: 'emp-1', title: 'Complete AWS Certification', status: 'on_track', progress: 45, priority: 'high' },\n    { id: 'goal-2', employee_id: 'emp-1', title: 'Lead Migration Project', status: 'on_track', progress: 20, priority: 'high' },\n    { id: 'goal-3', employee_id: 'emp-2', title: 'Launch Mobile App V2', status: 'at_risk', progress: 60, priority: 'high' },\n    { id: 'goal-4', employee_id: 'emp-3', title: 'Complete Training', status: 'completed', progress: 100, priority: 'medium' },\n];\n\nvi.mock('@/lib/supabase', () => ({\n    supabase: { from: vi.fn(() => ({ select: vi.fn(() => ({ order: vi.fn(() => Promise.resolve({ data: [], error: null })) })) })) },\n}));\n\ndescribe('usePerformance Hook', () => {\n    beforeEach(() => { vi.clearAllMocks(); });\n\n    describe('Reviews', () => {\n        it('should have valid review structure', () => {\n            mockReviews.forEach(r => {\n                expect(r).toHaveProperty('id');\n                expect(r).toHaveProperty('employee_id');\n                expect(r).toHaveProperty('status');\n            });\n        });\n\n        it('should have valid status values', () => {\n            const valid = ['draft', 'in_progress', 'completed', 'cancelled'];\n            mockReviews.forEach(r => expect(valid).toContain(r.status));\n        });\n\n        it('should calculate average rating', () => {\n            const completed = mockReviews.filter(r => r.status === 'completed');\n            const avg = completed.reduce((s, r) => s + (r.overall_rating || 0), 0) / completed.length;\n            expect(avg).toBe(4.25);\n        });\n    });\n\n    describe('Goals', () => {\n        it('should have valid goal structure', () => {\n            mockGoals.forEach(g => {\n                expect(g).toHaveProperty('id');\n                expect(g).toHaveProperty('title');\n                expect(g).toHaveProperty('progress');\n            });\n        });\n\n        it('should have progress between 0-100', () => {\n            mockGoals.forEach(g => {\n                expect(g.progress).toBeGreaterThanOrEqual(0);\n                expect(g.progress).toBeLessThanOrEqual(100);\n            });\n        });\n\n        it('should identify at-risk goals', () => {\n            const atRisk = mockGoals.filter(g => g.status === 'at_risk');\n            expect(atRisk.length).toBe(1);\n        });\n    });\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/hooks/__tests__/useTenants.test.ts","messages":[{"ruleId":"@typescript-eslint/triple-slash-reference","severity":2,"message":"Do not use a triple slash reference for vitest, use `import` style instead.","line":1,"column":1,"nodeType":"Line","messageId":"tripleSlashReference","endLine":1,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/// <reference types=\"vitest\" />\n/**\n * useTenants Hook Tests\n */\n\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\n\nconst mockTenants = [\n    { id: 't-1', name: 'Acme Corp', domain: 'acme.com', slug: 'acme', subscription_tier: 'professional', is_active: true, max_users: 50 },\n    { id: 't-2', name: 'Beta Inc', domain: 'beta.io', slug: 'beta', subscription_tier: 'enterprise', is_active: true, max_users: 200 },\n    { id: 't-3', name: 'Test Org', domain: 'test.org', slug: 'test', subscription_tier: 'starter', is_active: false, max_users: 10 },\n];\n\nconst mockFeatures = [\n    { id: 'f-1', name: 'ai_screening', display_name: 'AI Screening', is_premium: true },\n    { id: 'f-2', name: 'compliance_hub', display_name: 'Compliance Hub', is_premium: true },\n    { id: 'f-3', name: 'basic_recruitment', display_name: 'Basic Recruitment', is_premium: false },\n];\n\nconst mockTenantFeatures = [\n    { tenant_id: 't-1', feature_id: 'f-1', is_enabled: true },\n    { tenant_id: 't-1', feature_id: 'f-3', is_enabled: true },\n    { tenant_id: 't-2', feature_id: 'f-1', is_enabled: true },\n    { tenant_id: 't-2', feature_id: 'f-2', is_enabled: true },\n    { tenant_id: 't-2', feature_id: 'f-3', is_enabled: true },\n];\n\nvi.mock('@/lib/supabase', () => ({\n    supabase: { from: vi.fn(() => ({ select: vi.fn(() => Promise.resolve({ data: [], error: null })) })) },\n}));\n\ndescribe('useTenants Hook', () => {\n    beforeEach(() => { vi.clearAllMocks(); });\n\n    describe('Tenant Data', () => {\n        it('should have valid tenant structure', () => {\n            mockTenants.forEach(t => {\n                expect(t).toHaveProperty('id');\n                expect(t).toHaveProperty('name');\n                expect(t).toHaveProperty('domain');\n                expect(t).toHaveProperty('subscription_tier');\n            });\n        });\n\n        it('should have unique slugs', () => {\n            const slugs = mockTenants.map(t => t.slug);\n            expect(new Set(slugs).size).toBe(slugs.length);\n        });\n\n        it('should have valid subscription tiers', () => {\n            const valid = ['starter', 'professional', 'enterprise', 'custom'];\n            mockTenants.forEach(t => expect(valid).toContain(t.subscription_tier));\n        });\n\n        it('should filter active tenants', () => {\n            const active = mockTenants.filter(t => t.is_active);\n            expect(active.length).toBe(2);\n        });\n    });\n\n    describe('Features', () => {\n        it('should have valid feature structure', () => {\n            mockFeatures.forEach(f => {\n                expect(f).toHaveProperty('id');\n                expect(f).toHaveProperty('name');\n                expect(f).toHaveProperty('display_name');\n            });\n        });\n\n        it('should identify premium features', () => {\n            const premium = mockFeatures.filter(f => f.is_premium);\n            expect(premium.length).toBe(2);\n        });\n    });\n\n    describe('Tenant Features', () => {\n        it('should count enabled features per tenant', () => {\n            const t1Features = mockTenantFeatures.filter(tf => tf.tenant_id === 't-1' && tf.is_enabled);\n            const t2Features = mockTenantFeatures.filter(tf => tf.tenant_id === 't-2' && tf.is_enabled);\n            expect(t1Features.length).toBe(2);\n            expect(t2Features.length).toBe(3);\n        });\n\n        it('should check feature access', () => {\n            const hasFeature = (tenantId: string, featureId: string) =>\n                mockTenantFeatures.some(tf => tf.tenant_id === tenantId && tf.feature_id === featureId && tf.is_enabled);\n\n            expect(hasFeature('t-1', 'f-1')).toBe(true);\n            expect(hasFeature('t-1', 'f-2')).toBe(false);\n            expect(hasFeature('t-2', 'f-2')).toBe(true);\n        });\n    });\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/hooks/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/hooks/use-mobile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/hooks/useApplications.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/hooks/useComplianceData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/hooks/useDocuments.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/hooks/useEmployees.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/hooks/useInterviews.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/hooks/useJobs.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/hooks/useLeaveRequests.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/hooks/useMessages.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'queryClient' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":385,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":385,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'queryClient' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":440,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":440,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'queryClient' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":483,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":483,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'queryClient' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":523,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":523,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'queryClient' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":556,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":556,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Messaging Data Hooks using React Query\n * \n * Provides cached, optimized data fetching for internal messaging operations\n */\n\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { supabase } from '@/lib/supabase';\nimport { queryKeys, invalidateQueries } from '@/lib/queryClient';\nimport { handleError, createError } from '@/lib/errorHandler';\nimport { log } from '@/lib/logger';\n\nexport interface Conversation {\n  id: string;\n  title?: string;\n  created_by: string;\n  created_at: string;\n  updated_at: string;\n  is_archived: boolean;\n  is_pinned: boolean;\n  conversation_type: 'direct' | 'group' | 'announcement';\n  metadata?: Record<string, any>;\n  // Joined data\n  participants?: MessageParticipant[];\n  last_message?: Message;\n  unread_count?: number;\n  [key: string]: any;\n}\n\nexport interface Message {\n  id: string;\n  conversation_id: string;\n  sender_id: string;\n  content: string;\n  attachment_url?: string;\n  sent_at: string;\n  is_edited: boolean;\n  is_deleted: boolean;\n  metadata?: Record<string, any>;\n  // Joined data\n  sender?: {\n    id: string;\n    email: string;\n    first_name?: string;\n    last_name?: string;\n  };\n  [key: string]: any;\n}\n\nexport interface MessageParticipant {\n  id: string;\n  conversation_id: string;\n  user_id: string;\n  joined_at: string;\n  last_read_at?: string;\n  role_in_conversation: 'owner' | 'admin' | 'member';\n  is_active: boolean;\n  // Joined data\n  user?: {\n    id: string;\n    email: string;\n    first_name?: string;\n    last_name?: string;\n  };\n  [key: string]: any;\n}\n\nexport interface ConversationFilters {\n  type?: string;\n  is_archived?: boolean;\n  search?: string;\n}\n\n// ==================== Conversations ====================\n\n/**\n * Fetch all conversations for current user\n */\nexport function useConversations(filters?: ConversationFilters) {\n  return useQuery({\n    queryKey: queryKeys.messages.list(filters),\n    queryFn: async () => {\n      try {\n        log.info('Fetching conversations', { filters });\n        \n        // Get current user\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) throw createError.auth('User not authenticated');\n\n        // First get conversations user is part of\n        const { data: participantData, error: participantError } = await supabase\n          .from('message_participants')\n          .select('conversation_id')\n          .eq('user_id', user.id)\n          .eq('is_active', true);\n\n        if (participantError) throw handleError(participantError, 'Failed to fetch conversations');\n\n        const conversationIds = participantData?.map(p => p.conversation_id) || [];\n        \n        if (conversationIds.length === 0) {\n          return [];\n        }\n\n        // Fetch conversations\n        let query = supabase\n          .from('conversations')\n          .select('*')\n          .in('id', conversationIds)\n          .order('updated_at', { ascending: false });\n\n        // Apply filters\n        if (filters?.type) {\n          query = query.eq('conversation_type', filters.type);\n        }\n        if (filters?.is_archived !== undefined) {\n          query = query.eq('is_archived', filters.is_archived);\n        }\n\n        const { data, error } = await query;\n\n        if (error) {\n          throw handleError(error, 'Failed to fetch conversations');\n        }\n\n        log.info(`Fetched ${data?.length || 0} conversations`);\n        return data as Conversation[];\n      } catch (error) {\n        throw handleError(error, 'useConversations query failed');\n      }\n    },\n    staleTime: 1 * 60 * 1000, // 1 minute - messages need to be fresh\n  });\n}\n\n/**\n * Fetch single conversation with participants\n */\nexport function useConversation(id: string | null) {\n  return useQuery({\n    queryKey: queryKeys.messages.conversation(id || ''),\n    queryFn: async () => {\n      if (!id) {\n        throw createError.validation('Conversation ID is required');\n      }\n\n      try {\n        log.info('Fetching conversation', { id });\n\n        const { data, error } = await supabase\n          .from('conversations')\n          .select(`\n            *,\n            message_participants (\n              id,\n              user_id,\n              role_in_conversation,\n              is_active,\n              last_read_at\n            )\n          `)\n          .eq('id', id)\n          .single();\n\n        if (error) {\n          if (error.code === 'PGRST116') {\n            throw createError.notFound('Conversation', { id });\n          }\n          throw handleError(error, 'Failed to fetch conversation');\n        }\n\n        return data as Conversation;\n      } catch (error) {\n        throw handleError(error, 'useConversation query failed');\n      }\n    },\n    enabled: !!id,\n    staleTime: 2 * 60 * 1000,\n  });\n}\n\n/**\n * Fetch unread messages count\n */\nexport function useUnreadCount() {\n  return useQuery({\n    queryKey: queryKeys.messages.unread,\n    queryFn: async () => {\n      try {\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) return 0;\n\n        // Get participant records with last_read_at\n        const { data: participants, error: participantError } = await supabase\n          .from('message_participants')\n          .select('conversation_id, last_read_at')\n          .eq('user_id', user.id)\n          .eq('is_active', true);\n\n        if (participantError) throw handleError(participantError, 'Failed to fetch participants');\n\n        let totalUnread = 0;\n\n        // Count unread messages for each conversation\n        for (const participant of participants || []) {\n          const lastRead = participant.last_read_at || '1970-01-01T00:00:00.000Z';\n          \n          const { count, error } = await supabase\n            .from('messages')\n            .select('*', { count: 'exact', head: true })\n            .eq('conversation_id', participant.conversation_id)\n            .gt('sent_at', lastRead)\n            .neq('sender_id', user.id)\n            .eq('is_deleted', false);\n\n          if (!error && count) {\n            totalUnread += count;\n          }\n        }\n\n        return totalUnread;\n      } catch (error) {\n        log.error('Failed to fetch unread count', error);\n        return 0;\n      }\n    },\n    staleTime: 30 * 1000, // 30 seconds - keep unread count fresh\n    refetchInterval: 60 * 1000, // Refetch every minute\n  });\n}\n\n/**\n * Create new conversation\n */\nexport function useCreateConversation() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async ({ \n      title, \n      type, \n      participantIds \n    }: { \n      title?: string; \n      type: Conversation['conversation_type']; \n      participantIds: string[];\n    }) => {\n      try {\n        log.info('Creating conversation', { title, type, participantIds });\n\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) throw createError.auth('User not authenticated');\n\n        // Create conversation\n        const { data: conversation, error: convError } = await supabase\n          .from('conversations')\n          .insert({\n            title,\n            conversation_type: type,\n            created_by: user.id,\n          })\n          .select()\n          .single();\n\n        if (convError) throw handleError(convError, 'Failed to create conversation');\n\n        // Add creator as owner\n        const participants = [\n          {\n            conversation_id: conversation.id,\n            user_id: user.id,\n            role_in_conversation: 'owner',\n          },\n          // Add other participants as members\n          ...participantIds.filter(id => id !== user.id).map(userId => ({\n            conversation_id: conversation.id,\n            user_id: userId,\n            role_in_conversation: 'member',\n          })),\n        ];\n\n        const { error: partError } = await supabase\n          .from('message_participants')\n          .insert(participants);\n\n        if (partError) throw handleError(partError, 'Failed to add participants');\n\n        log.info('Conversation created successfully', { id: conversation.id });\n        return conversation as Conversation;\n      } catch (error) {\n        throw handleError(error, 'useCreateConversation mutation failed');\n      }\n    },\n    onSuccess: (data) => {\n      invalidateQueries(queryKeys.messages.all);\n      queryClient.setQueryData(queryKeys.messages.conversation(data.id), data);\n      log.track('conversation_created', { conversationId: data.id, type: data.conversation_type });\n    },\n  });\n}\n\n/**\n * Archive conversation\n */\nexport function useArchiveConversation() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async (id: string) => {\n      try {\n        log.info('Archiving conversation', { id });\n\n        const { data: updated, error } = await supabase\n          .from('conversations')\n          .update({ \n            is_archived: true,\n            updated_at: new Date().toISOString(),\n          })\n          .eq('id', id)\n          .select()\n          .single();\n\n        if (error) throw handleError(error, 'Failed to archive conversation');\n\n        log.info('Conversation archived', { id });\n        return updated as Conversation;\n      } catch (error) {\n        throw handleError(error, 'useArchiveConversation mutation failed');\n      }\n    },\n    onSuccess: (data) => {\n      queryClient.setQueryData(queryKeys.messages.conversation(data.id), data);\n      invalidateQueries(queryKeys.messages.all);\n      log.track('conversation_archived', { conversationId: data.id });\n    },\n  });\n}\n\n// ==================== Messages ====================\n\n/**\n * Fetch messages for a conversation\n */\nexport function useMessages(conversationId: string | null, limit: number = 50) {\n  return useQuery({\n    queryKey: ['messages', 'list', conversationId, limit],\n    queryFn: async () => {\n      if (!conversationId) throw createError.validation('Conversation ID is required');\n\n      try {\n        log.info('Fetching messages', { conversationId, limit });\n\n        const { data, error } = await supabase\n          .from('messages')\n          .select(`\n            *,\n            users_profiles:sender_id (\n              user_id,\n              first_name,\n              last_name\n            )\n          `)\n          .eq('conversation_id', conversationId)\n          .eq('is_deleted', false)\n          .order('sent_at', { ascending: false })\n          .limit(limit);\n\n        if (error) throw handleError(error, 'Failed to fetch messages');\n\n        // Return in chronological order for display\n        return (data || []).reverse() as Message[];\n      } catch (error) {\n        throw handleError(error, 'useMessages query failed');\n      }\n    },\n    enabled: !!conversationId,\n    staleTime: 30 * 1000, // 30 seconds\n  });\n}\n\n/**\n * Send new message\n */\nexport function useSendMessage() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async ({ \n      conversationId, \n      content, \n      attachmentUrl \n    }: { \n      conversationId: string; \n      content: string; \n      attachmentUrl?: string;\n    }) => {\n      try {\n        log.info('Sending message', { conversationId });\n\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) throw createError.auth('User not authenticated');\n\n        const { data, error } = await supabase\n          .from('messages')\n          .insert({\n            conversation_id: conversationId,\n            sender_id: user.id,\n            content,\n            attachment_url: attachmentUrl,\n          })\n          .select()\n          .single();\n\n        if (error) throw handleError(error, 'Failed to send message');\n\n        // Update conversation's updated_at\n        await supabase\n          .from('conversations')\n          .update({ updated_at: new Date().toISOString() })\n          .eq('id', conversationId);\n\n        log.info('Message sent successfully', { id: data.id });\n        return data as Message;\n      } catch (error) {\n        throw handleError(error, 'useSendMessage mutation failed');\n      }\n    },\n    onSuccess: (data) => {\n      invalidateQueries(['messages', 'list', data.conversation_id]);\n      invalidateQueries(queryKeys.messages.all);\n      log.track('message_sent', { messageId: data.id, conversationId: data.conversation_id });\n    },\n  });\n}\n\n/**\n * Edit message\n */\nexport function useEditMessage() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async ({ \n      id, \n      content \n    }: { \n      id: string; \n      content: string;\n    }) => {\n      try {\n        log.info('Editing message', { id });\n\n        const { data: updated, error } = await supabase\n          .from('messages')\n          .update({\n            content,\n            is_edited: true,\n            metadata: { edited_at: new Date().toISOString() },\n          })\n          .eq('id', id)\n          .select()\n          .single();\n\n        if (error) throw handleError(error, 'Failed to edit message');\n\n        log.info('Message edited', { id });\n        return updated as Message;\n      } catch (error) {\n        throw handleError(error, 'useEditMessage mutation failed');\n      }\n    },\n    onSuccess: (data) => {\n      invalidateQueries(['messages', 'list', data.conversation_id]);\n      log.track('message_edited', { messageId: data.id });\n    },\n  });\n}\n\n/**\n * Delete message (soft delete)\n */\nexport function useDeleteMessage() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async (id: string) => {\n      try {\n        log.info('Deleting message', { id });\n\n        // Get message first to get conversation_id\n        const { data: message, error: fetchError } = await supabase\n          .from('messages')\n          .select('conversation_id')\n          .eq('id', id)\n          .single();\n\n        if (fetchError) throw handleError(fetchError, 'Failed to fetch message');\n\n        const { error } = await supabase\n          .from('messages')\n          .update({ is_deleted: true })\n          .eq('id', id);\n\n        if (error) throw handleError(error, 'Failed to delete message');\n\n        log.info('Message deleted', { id });\n        return { id, conversationId: message.conversation_id };\n      } catch (error) {\n        throw handleError(error, 'useDeleteMessage mutation failed');\n      }\n    },\n    onSuccess: ({ id, conversationId }) => {\n      invalidateQueries(['messages', 'list', conversationId]);\n      log.track('message_deleted', { messageId: id });\n    },\n  });\n}\n\n/**\n * Mark conversation as read\n */\nexport function useMarkAsRead() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async (conversationId: string) => {\n      try {\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) throw createError.auth('User not authenticated');\n\n        const { error } = await supabase\n          .from('message_participants')\n          .update({ last_read_at: new Date().toISOString() })\n          .eq('conversation_id', conversationId)\n          .eq('user_id', user.id);\n\n        if (error) throw handleError(error, 'Failed to mark as read');\n\n        log.info('Conversation marked as read', { conversationId });\n        return conversationId;\n      } catch (error) {\n        throw handleError(error, 'useMarkAsRead mutation failed');\n      }\n    },\n    onSuccess: (conversationId) => {\n      invalidateQueries(queryKeys.messages.unread);\n      invalidateQueries(queryKeys.messages.conversation(conversationId));\n    },\n  });\n}\n\n/**\n * Add participants to conversation\n */\nexport function useAddParticipants() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async ({ \n      conversationId, \n      userIds \n    }: { \n      conversationId: string; \n      userIds: string[];\n    }) => {\n      try {\n        log.info('Adding participants', { conversationId, userIds });\n\n        const participants = userIds.map(userId => ({\n          conversation_id: conversationId,\n          user_id: userId,\n          role_in_conversation: 'member',\n        }));\n\n        const { error } = await supabase\n          .from('message_participants')\n          .insert(participants);\n\n        if (error) throw handleError(error, 'Failed to add participants');\n\n        log.info('Participants added', { conversationId, count: userIds.length });\n        return { conversationId, userIds };\n      } catch (error) {\n        throw handleError(error, 'useAddParticipants mutation failed');\n      }\n    },\n    onSuccess: ({ conversationId }) => {\n      invalidateQueries(queryKeys.messages.conversation(conversationId));\n      log.track('participants_added', { conversationId });\n    },\n  });\n}\n\n/**\n * Leave conversation\n */\nexport function useLeaveConversation() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async (conversationId: string) => {\n      try {\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) throw createError.auth('User not authenticated');\n\n        log.info('Leaving conversation', { conversationId });\n\n        const { error } = await supabase\n          .from('message_participants')\n          .update({ is_active: false })\n          .eq('conversation_id', conversationId)\n          .eq('user_id', user.id);\n\n        if (error) throw handleError(error, 'Failed to leave conversation');\n\n        log.info('Left conversation', { conversationId });\n        return conversationId;\n      } catch (error) {\n        throw handleError(error, 'useLeaveConversation mutation failed');\n      }\n    },\n    onSuccess: (conversationId) => {\n      invalidateQueries(queryKeys.messages.all);\n      queryClient.removeQueries({ queryKey: queryKeys.messages.conversation(conversationId) });\n      log.track('conversation_left', { conversationId });\n    },\n  });\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/hooks/usePerformance.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'queryClient' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":507,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":507,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'queryClient' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":548,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":548,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'queryClient' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":589,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":589,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'queryClient' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":639,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":639,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Performance Management Data Hooks using React Query\n * \n * Provides cached, optimized data fetching for performance reviews, goals, and KPIs\n */\n\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { supabase } from '@/lib/supabase';\nimport { queryKeys, invalidateQueries } from '@/lib/queryClient';\nimport { handleError, createError } from '@/lib/errorHandler';\nimport { log } from '@/lib/logger';\n\n// Performance Review Types\nexport interface PerformanceReview {\n  id: string;\n  review_type_id: string;\n  employee_id: string;\n  review_period_start: string;\n  review_period_end: string;\n  review_due_date: string;\n  status: 'pending' | 'in_progress' | 'self_assessment_complete' | 'manager_review_complete' | 'peer_review_complete' | 'completed' | 'overdue' | 'cancelled';\n  overall_rating?: number;\n  overall_comments?: string;\n  strengths?: string;\n  areas_for_improvement?: string;\n  action_items?: string;\n  next_review_date?: string;\n  is_auto_generated: boolean;\n  completed_at?: string;\n  created_by: string;\n  created_at: string;\n  updated_at: string;\n  // Joined data\n  employees?: {\n    id: string;\n    first_name: string;\n    last_name: string;\n    email: string;\n    department?: string;\n    position?: string;\n  };\n  review_types?: {\n    id: string;\n    name: string;\n    description?: string;\n  };\n  [key: string]: any;\n}\n\nexport interface PerformanceGoal {\n  id: string;\n  employee_id: string;\n  title: string;\n  description?: string;\n  goal_type: 'individual' | 'team' | 'company' | 'development';\n  category?: string;\n  target_date?: string;\n  status: 'draft' | 'active' | 'on_track' | 'at_risk' | 'achieved' | 'not_achieved' | 'cancelled';\n  progress_percentage: number;\n  measurement_criteria?: string;\n  target_value?: string;\n  current_value?: string;\n  priority: 'low' | 'medium' | 'high' | 'critical';\n  linked_review_id?: string;\n  parent_goal_id?: string;\n  is_smart: boolean;\n  assigned_by?: string;\n  created_at: string;\n  updated_at: string;\n  // Joined data\n  employees?: {\n    first_name: string;\n    last_name: string;\n    department?: string;\n  };\n  [key: string]: any;\n}\n\nexport interface ReviewFilters {\n  employee_id?: string;\n  status?: string;\n  review_type_id?: string;\n  from_date?: string;\n  to_date?: string;\n}\n\nexport interface GoalFilters {\n  employee_id?: string;\n  status?: string;\n  goal_type?: string;\n  priority?: string;\n}\n\n// ==================== Performance Reviews ====================\n\n/**\n * Fetch all performance reviews with optional filtering\n */\nexport function usePerformanceReviews(filters?: ReviewFilters) {\n  return useQuery({\n    queryKey: queryKeys.performance.reviews(filters),\n    queryFn: async () => {\n      try {\n        log.info('Fetching performance reviews', { filters });\n        \n        let query = supabase\n          .from('performance_reviews')\n          .select(`\n            *,\n            employees (\n              id,\n              first_name,\n              last_name,\n              email,\n              department,\n              position\n            ),\n            performance_review_types (\n              id,\n              name,\n              description\n            )\n          `)\n          .order('review_due_date', { ascending: true });\n\n        // Apply filters\n        if (filters?.employee_id) {\n          query = query.eq('employee_id', filters.employee_id);\n        }\n        if (filters?.status) {\n          query = query.eq('status', filters.status);\n        }\n        if (filters?.review_type_id) {\n          query = query.eq('review_type_id', filters.review_type_id);\n        }\n        if (filters?.from_date) {\n          query = query.gte('review_period_start', filters.from_date);\n        }\n        if (filters?.to_date) {\n          query = query.lte('review_period_end', filters.to_date);\n        }\n\n        const { data, error } = await query;\n\n        if (error) {\n          throw handleError(error, 'Failed to fetch performance reviews');\n        }\n\n        log.info(`Fetched ${data?.length || 0} performance reviews`);\n        return data as PerformanceReview[];\n      } catch (error) {\n        throw handleError(error, 'usePerformanceReviews query failed');\n      }\n    },\n    staleTime: 5 * 60 * 1000, // 5 minutes\n  });\n}\n\n/**\n * Fetch single performance review by ID\n */\nexport function usePerformanceReview(id: string | null) {\n  return useQuery({\n    queryKey: queryKeys.performance.review(id || ''),\n    queryFn: async () => {\n      if (!id) {\n        throw createError.validation('Review ID is required');\n      }\n\n      try {\n        log.info('Fetching performance review', { id });\n\n        const { data, error } = await supabase\n          .from('performance_reviews')\n          .select(`\n            *,\n            employees (\n              id,\n              first_name,\n              last_name,\n              email,\n              department,\n              position\n            ),\n            performance_review_types (\n              id,\n              name,\n              description\n            )\n          `)\n          .eq('id', id)\n          .single();\n\n        if (error) {\n          if (error.code === 'PGRST116') {\n            throw createError.notFound('Performance review', { id });\n          }\n          throw handleError(error, 'Failed to fetch performance review');\n        }\n\n        return data as PerformanceReview;\n      } catch (error) {\n        throw handleError(error, 'usePerformanceReview query failed');\n      }\n    },\n    enabled: !!id,\n    staleTime: 5 * 60 * 1000,\n  });\n}\n\n/**\n * Fetch pending/overdue reviews for dashboard\n */\nexport function usePendingReviews() {\n  return useQuery({\n    queryKey: ['performance', 'pending'],\n    queryFn: async () => {\n      try {\n        const { data, error } = await supabase\n          .from('performance_reviews')\n          .select(`\n            *,\n            employees (\n              first_name,\n              last_name,\n              department\n            )\n          `)\n          .in('status', ['pending', 'in_progress', 'overdue'])\n          .order('review_due_date', { ascending: true });\n\n        if (error) throw handleError(error, 'Failed to fetch pending reviews');\n        return data as PerformanceReview[];\n      } catch (error) {\n        throw handleError(error, 'usePendingReviews query failed');\n      }\n    },\n    staleTime: 3 * 60 * 1000,\n  });\n}\n\n/**\n * Create new performance review\n */\nexport function useCreatePerformanceReview() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async (reviewData: Partial<PerformanceReview>) => {\n      try {\n        log.info('Creating performance review', { data: reviewData });\n\n        const { data, error } = await supabase\n          .from('performance_reviews')\n          .insert(reviewData)\n          .select()\n          .single();\n\n        if (error) {\n          throw handleError(error, 'Failed to create performance review');\n        }\n\n        log.info('Performance review created successfully', { id: data.id });\n        return data as PerformanceReview;\n      } catch (error) {\n        throw handleError(error, 'useCreatePerformanceReview mutation failed');\n      }\n    },\n    onSuccess: (data) => {\n      invalidateQueries(queryKeys.performance.all);\n      queryClient.setQueryData(queryKeys.performance.review(data.id), data);\n      log.track('performance_review_created', { reviewId: data.id });\n    },\n  });\n}\n\n/**\n * Update performance review\n */\nexport function useUpdatePerformanceReview() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<PerformanceReview> }) => {\n      try {\n        log.info('Updating performance review', { id, data });\n\n        const { data: updated, error } = await supabase\n          .from('performance_reviews')\n          .update({\n            ...data,\n            updated_at: new Date().toISOString(),\n          })\n          .eq('id', id)\n          .select()\n          .single();\n\n        if (error) {\n          throw handleError(error, 'Failed to update performance review');\n        }\n\n        log.info('Performance review updated successfully', { id });\n        return updated as PerformanceReview;\n      } catch (error) {\n        throw handleError(error, 'useUpdatePerformanceReview mutation failed');\n      }\n    },\n    onSuccess: (data) => {\n      queryClient.setQueryData(queryKeys.performance.review(data.id), data);\n      invalidateQueries(queryKeys.performance.all);\n      log.track('performance_review_updated', { reviewId: data.id });\n    },\n  });\n}\n\n/**\n * Complete performance review\n */\nexport function useCompletePerformanceReview() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async ({ \n      id, \n      overall_rating, \n      overall_comments, \n      strengths, \n      areas_for_improvement, \n      action_items \n    }: { \n      id: string; \n      overall_rating: number; \n      overall_comments?: string;\n      strengths?: string;\n      areas_for_improvement?: string;\n      action_items?: string;\n    }) => {\n      try {\n        log.info('Completing performance review', { id, overall_rating });\n\n        const { data: updated, error } = await supabase\n          .from('performance_reviews')\n          .update({\n            overall_rating,\n            overall_comments,\n            strengths,\n            areas_for_improvement,\n            action_items,\n            status: 'completed',\n            completed_at: new Date().toISOString(),\n            updated_at: new Date().toISOString(),\n          })\n          .eq('id', id)\n          .select()\n          .single();\n\n        if (error) {\n          throw handleError(error, 'Failed to complete performance review');\n        }\n\n        log.info('Performance review completed', { id });\n        return updated as PerformanceReview;\n      } catch (error) {\n        throw handleError(error, 'useCompletePerformanceReview mutation failed');\n      }\n    },\n    onSuccess: (data) => {\n      queryClient.setQueryData(queryKeys.performance.review(data.id), data);\n      invalidateQueries(queryKeys.performance.all);\n      log.track('performance_review_completed', { reviewId: data.id, rating: data.overall_rating });\n    },\n  });\n}\n\n/**\n * Delete performance review\n */\nexport function useDeletePerformanceReview() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async (id: string) => {\n      try {\n        log.info('Deleting performance review', { id });\n\n        const { error } = await supabase\n          .from('performance_reviews')\n          .delete()\n          .eq('id', id);\n\n        if (error) {\n          throw handleError(error, 'Failed to delete performance review');\n        }\n\n        log.info('Performance review deleted successfully', { id });\n        return id;\n      } catch (error) {\n        throw handleError(error, 'useDeletePerformanceReview mutation failed');\n      }\n    },\n    onSuccess: (id) => {\n      queryClient.removeQueries({ queryKey: queryKeys.performance.review(id) });\n      invalidateQueries(queryKeys.performance.all);\n      log.track('performance_review_deleted', { reviewId: id });\n    },\n  });\n}\n\n// ==================== Performance Goals ====================\n\n/**\n * Fetch performance goals by employee ID\n */\nexport function usePerformanceGoals(employeeId: string | null, filters?: GoalFilters) {\n  return useQuery({\n    queryKey: queryKeys.performance.goals(employeeId || ''),\n    queryFn: async () => {\n      if (!employeeId) throw createError.validation('Employee ID is required');\n\n      try {\n        log.info('Fetching performance goals', { employeeId, filters });\n        \n        let query = supabase\n          .from('performance_goals')\n          .select('*')\n          .eq('employee_id', employeeId)\n          .order('target_date', { ascending: true });\n\n        // Apply filters\n        if (filters?.status) {\n          query = query.eq('status', filters.status);\n        }\n        if (filters?.goal_type) {\n          query = query.eq('goal_type', filters.goal_type);\n        }\n        if (filters?.priority) {\n          query = query.eq('priority', filters.priority);\n        }\n\n        const { data, error } = await query;\n\n        if (error) {\n          throw handleError(error, 'Failed to fetch performance goals');\n        }\n\n        log.info(`Fetched ${data?.length || 0} performance goals`);\n        return data as PerformanceGoal[];\n      } catch (error) {\n        throw handleError(error, 'usePerformanceGoals query failed');\n      }\n    },\n    enabled: !!employeeId,\n    staleTime: 5 * 60 * 1000,\n  });\n}\n\n/**\n * Fetch all goals (for managers/HR)\n */\nexport function useAllPerformanceGoals(filters?: GoalFilters) {\n  return useQuery({\n    queryKey: ['performance', 'allGoals', filters],\n    queryFn: async () => {\n      try {\n        let query = supabase\n          .from('performance_goals')\n          .select(`\n            *,\n            employees (\n              first_name,\n              last_name,\n              department\n            )\n          `)\n          .order('target_date', { ascending: true });\n\n        // Apply filters\n        if (filters?.employee_id) {\n          query = query.eq('employee_id', filters.employee_id);\n        }\n        if (filters?.status) {\n          query = query.eq('status', filters.status);\n        }\n        if (filters?.goal_type) {\n          query = query.eq('goal_type', filters.goal_type);\n        }\n        if (filters?.priority) {\n          query = query.eq('priority', filters.priority);\n        }\n\n        const { data, error } = await query;\n\n        if (error) throw handleError(error, 'Failed to fetch goals');\n        return data as PerformanceGoal[];\n      } catch (error) {\n        throw handleError(error, 'useAllPerformanceGoals query failed');\n      }\n    },\n    staleTime: 5 * 60 * 1000,\n  });\n}\n\n/**\n * Create new goal\n */\nexport function useCreateGoal() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async (goalData: Partial<PerformanceGoal>) => {\n      try {\n        log.info('Creating performance goal', { data: goalData });\n\n        const { data, error } = await supabase\n          .from('performance_goals')\n          .insert({\n            ...goalData,\n            status: goalData.status || 'active',\n            progress_percentage: goalData.progress_percentage || 0,\n          })\n          .select()\n          .single();\n\n        if (error) {\n          throw handleError(error, 'Failed to create goal');\n        }\n\n        log.info('Goal created successfully', { id: data.id });\n        return data as PerformanceGoal;\n      } catch (error) {\n        throw handleError(error, 'useCreateGoal mutation failed');\n      }\n    },\n    onSuccess: (data) => {\n      invalidateQueries(queryKeys.performance.all);\n      if (data.employee_id) {\n        invalidateQueries(queryKeys.performance.goals(data.employee_id));\n      }\n      log.track('goal_created', { goalId: data.id, goalType: data.goal_type });\n    },\n  });\n}\n\n/**\n * Update goal\n */\nexport function useUpdateGoal() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<PerformanceGoal> }) => {\n      try {\n        log.info('Updating goal', { id, data });\n\n        const { data: updated, error } = await supabase\n          .from('performance_goals')\n          .update({\n            ...data,\n            updated_at: new Date().toISOString(),\n          })\n          .eq('id', id)\n          .select()\n          .single();\n\n        if (error) {\n          throw handleError(error, 'Failed to update goal');\n        }\n\n        log.info('Goal updated successfully', { id });\n        return updated as PerformanceGoal;\n      } catch (error) {\n        throw handleError(error, 'useUpdateGoal mutation failed');\n      }\n    },\n    onSuccess: (data) => {\n      invalidateQueries(queryKeys.performance.all);\n      if (data.employee_id) {\n        invalidateQueries(queryKeys.performance.goals(data.employee_id));\n      }\n      log.track('goal_updated', { goalId: data.id });\n    },\n  });\n}\n\n/**\n * Update goal progress\n */\nexport function useUpdateGoalProgress() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async ({ \n      id, \n      progress_percentage, \n      current_value \n    }: { \n      id: string; \n      progress_percentage: number; \n      current_value?: string;\n    }) => {\n      try {\n        log.info('Updating goal progress', { id, progress_percentage });\n\n        const { data: updated, error } = await supabase\n          .from('performance_goals')\n          .update({\n            progress_percentage,\n            current_value,\n            updated_at: new Date().toISOString(),\n          })\n          .eq('id', id)\n          .select()\n          .single();\n\n        if (error) {\n          throw handleError(error, 'Failed to update goal progress');\n        }\n\n        log.info('Goal progress updated', { id, progress_percentage });\n        return updated as PerformanceGoal;\n      } catch (error) {\n        throw handleError(error, 'useUpdateGoalProgress mutation failed');\n      }\n    },\n    onSuccess: (data) => {\n      invalidateQueries(queryKeys.performance.all);\n      if (data.employee_id) {\n        invalidateQueries(queryKeys.performance.goals(data.employee_id));\n      }\n      log.track('goal_progress_updated', { goalId: data.id, progress: data.progress_percentage });\n    },\n  });\n}\n\n/**\n * Delete goal\n */\nexport function useDeleteGoal() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async (id: string) => {\n      try {\n        log.info('Deleting goal', { id });\n\n        const { error } = await supabase\n          .from('performance_goals')\n          .delete()\n          .eq('id', id);\n\n        if (error) {\n          throw handleError(error, 'Failed to delete goal');\n        }\n\n        log.info('Goal deleted successfully', { id });\n        return id;\n      } catch (error) {\n        throw handleError(error, 'useDeleteGoal mutation failed');\n      }\n    },\n    onSuccess: (id) => {\n      invalidateQueries(queryKeys.performance.all);\n      log.track('goal_deleted', { goalId: id });\n    },\n  });\n}\n\n// ==================== KPIs ====================\n\n/**\n * Fetch KPIs\n */\nexport function useKPIs() {\n  return useQuery({\n    queryKey: queryKeys.performance.kpis,\n    queryFn: async () => {\n      try {\n        const { data, error } = await supabase\n          .from('kpi_definitions')\n          .select('*')\n          .order('name', { ascending: true });\n\n        if (error) throw handleError(error, 'Failed to fetch KPIs');\n        return data;\n      } catch (error) {\n        throw handleError(error, 'useKPIs query failed');\n      }\n    },\n    staleTime: 10 * 60 * 1000, // 10 minutes - KPIs change rarely\n  });\n}\n\n/**\n * Fetch KPI values for an employee\n */\nexport function useEmployeeKPIs(employeeId: string | null) {\n  return useQuery({\n    queryKey: ['performance', 'employeeKPIs', employeeId],\n    queryFn: async () => {\n      if (!employeeId) throw createError.validation('Employee ID is required');\n\n      try {\n        const { data, error } = await supabase\n          .from('kpi_values')\n          .select(`\n            *,\n            kpi_definitions (\n              name,\n              description,\n              unit\n            )\n          `)\n          .eq('employee_id', employeeId)\n          .order('period_end', { ascending: false });\n\n        if (error) throw handleError(error, 'Failed to fetch employee KPIs');\n        return data;\n      } catch (error) {\n        throw handleError(error, 'useEmployeeKPIs query failed');\n      }\n    },\n    enabled: !!employeeId,\n    staleTime: 5 * 60 * 1000,\n  });\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/hooks/useTenants.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'queryClient' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":548,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":548,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'queryClient' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":598,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":598,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'queryClient' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":636,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":636,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Tenant Data Hooks using React Query\n * \n * Provides cached, optimized data fetching for multi-tenant operations\n */\n\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { supabase } from '@/lib/supabase';\nimport { queryKeys, invalidateQueries } from '@/lib/queryClient';\nimport { handleError, createError } from '@/lib/errorHandler';\nimport { log } from '@/lib/logger';\n\nexport type SubscriptionTier = 'trial' | 'basic' | 'professional' | 'enterprise';\nexport type SubscriptionStatus = 'active' | 'trial' | 'cancelled' | 'suspended' | 'expired';\n\nexport interface Tenant {\n  id: string;\n  name: string;\n  subdomain?: string;\n  slug: string;\n  \n  // Contact & Branding\n  logo_url?: string;\n  website?: string;\n  primary_email?: string;\n  phone?: string;\n  address?: {\n    street?: string;\n    city?: string;\n    state?: string;\n    country?: string;\n    postal_code?: string;\n  };\n  \n  // Settings & Features\n  settings?: Record<string, any>;\n  features?: {\n    novumflow_enabled?: boolean;\n    careflow_enabled?: boolean;\n    ai_enabled?: boolean;\n    sms_enabled?: boolean;\n    [key: string]: any;\n  };\n  \n  // Limits\n  limits?: {\n    max_users?: number;\n    max_employees?: number;\n    max_clients?: number;\n    max_storage_gb?: number;\n    [key: string]: any;\n  };\n  \n  // Subscription\n  subscription_tier: SubscriptionTier;\n  subscription_status: SubscriptionStatus;\n  trial_ends_at?: string;\n  subscription_started_at?: string;\n  subscription_expires_at?: string;\n  \n  // Billing\n  stripe_customer_id?: string;\n  stripe_subscription_id?: string;\n  \n  // Status\n  is_active: boolean;\n  is_verified: boolean;\n  onboarding_completed: boolean;\n  \n  // Timestamps\n  created_at: string;\n  updated_at: string;\n  deleted_at?: string;\n  \n  [key: string]: any;\n}\n\nexport interface TenantMembership {\n  id: string;\n  user_id: string;\n  tenant_id: string;\n  role: 'owner' | 'admin' | 'manager' | 'member';\n  permissions?: string[];\n  is_active: boolean;\n  invited_by?: string;\n  invitation_accepted_at?: string;\n  created_at: string;\n  updated_at: string;\n  // Joined data\n  tenants?: Tenant;\n  users?: {\n    id: string;\n    email: string;\n    first_name?: string;\n    last_name?: string;\n  };\n  [key: string]: any;\n}\n\nexport interface TenantFilters {\n  subscription_tier?: SubscriptionTier;\n  subscription_status?: SubscriptionStatus;\n  is_active?: boolean;\n  search?: string;\n}\n\n// ==================== Tenant Queries ====================\n\n/**\n * Fetch all tenants (admin only)\n */\nexport function useTenants(filters?: TenantFilters) {\n  return useQuery({\n    queryKey: queryKeys.tenants.list,\n    queryFn: async () => {\n      try {\n        log.info('Fetching tenants', { filters });\n        \n        let query = supabase\n          .from('tenants')\n          .select('*')\n          .is('deleted_at', null)\n          .order('created_at', { ascending: false });\n\n        // Apply filters\n        if (filters?.subscription_tier) {\n          query = query.eq('subscription_tier', filters.subscription_tier);\n        }\n        if (filters?.subscription_status) {\n          query = query.eq('subscription_status', filters.subscription_status);\n        }\n        if (filters?.is_active !== undefined) {\n          query = query.eq('is_active', filters.is_active);\n        }\n        if (filters?.search) {\n          query = query.or(`name.ilike.%${filters.search}%,slug.ilike.%${filters.search}%`);\n        }\n\n        const { data, error } = await query;\n\n        if (error) {\n          throw handleError(error, 'Failed to fetch tenants');\n        }\n\n        log.info(`Fetched ${data?.length || 0} tenants`);\n        return data as Tenant[];\n      } catch (error) {\n        throw handleError(error, 'useTenants query failed');\n      }\n    },\n    staleTime: 5 * 60 * 1000, // 5 minutes\n  });\n}\n\n/**\n * Fetch single tenant by ID\n */\nexport function useTenant(id: string | null) {\n  return useQuery({\n    queryKey: queryKeys.tenants.detail(id || ''),\n    queryFn: async () => {\n      if (!id) {\n        throw createError.validation('Tenant ID is required');\n      }\n\n      try {\n        log.info('Fetching tenant', { id });\n\n        const { data, error } = await supabase\n          .from('tenants')\n          .select('*')\n          .eq('id', id)\n          .single();\n\n        if (error) {\n          if (error.code === 'PGRST116') {\n            throw createError.notFound('Tenant', { id });\n          }\n          throw handleError(error, 'Failed to fetch tenant');\n        }\n\n        return data as Tenant;\n      } catch (error) {\n        throw handleError(error, 'useTenant query failed');\n      }\n    },\n    enabled: !!id,\n    staleTime: 5 * 60 * 1000,\n  });\n}\n\n/**\n * Fetch current user's tenant\n */\nexport function useCurrentTenant() {\n  return useQuery({\n    queryKey: queryKeys.tenants.current,\n    queryFn: async () => {\n      try {\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) throw createError.auth('User not authenticated');\n\n        // Get user's active membership\n        const { data: membership, error: membershipError } = await supabase\n          .from('user_tenant_memberships')\n          .select(`\n            *,\n            tenants (*)\n          `)\n          .eq('user_id', user.id)\n          .eq('is_active', true)\n          .single();\n\n        if (membershipError) {\n          if (membershipError.code === 'PGRST116') {\n            return null; // User has no tenant\n          }\n          throw handleError(membershipError, 'Failed to fetch current tenant');\n        }\n\n        return membership?.tenants as Tenant | null;\n      } catch (error) {\n        throw handleError(error, 'useCurrentTenant query failed');\n      }\n    },\n    staleTime: 10 * 60 * 1000, // 10 minutes - tenant rarely changes\n  });\n}\n\n/**\n * Fetch tenant by slug\n */\nexport function useTenantBySlug(slug: string | null) {\n  return useQuery({\n    queryKey: ['tenants', 'bySlug', slug],\n    queryFn: async () => {\n      if (!slug) throw createError.validation('Tenant slug is required');\n\n      try {\n        const { data, error } = await supabase\n          .from('tenants')\n          .select('*')\n          .eq('slug', slug)\n          .eq('is_active', true)\n          .single();\n\n        if (error) {\n          if (error.code === 'PGRST116') {\n            throw createError.notFound('Tenant', { slug });\n          }\n          throw handleError(error, 'Failed to fetch tenant');\n        }\n\n        return data as Tenant;\n      } catch (error) {\n        throw handleError(error, 'useTenantBySlug query failed');\n      }\n    },\n    enabled: !!slug,\n    staleTime: 10 * 60 * 1000,\n  });\n}\n\n/**\n * Fetch user's tenant memberships\n */\nexport function useUserTenantMemberships(userId?: string) {\n  return useQuery({\n    queryKey: ['tenants', 'memberships', userId],\n    queryFn: async () => {\n      try {\n        const { data: { user } } = await supabase.auth.getUser();\n        const targetUserId = userId || user?.id;\n        \n        if (!targetUserId) throw createError.auth('User not authenticated');\n\n        const { data, error } = await supabase\n          .from('user_tenant_memberships')\n          .select(`\n            *,\n            tenants (*)\n          `)\n          .eq('user_id', targetUserId)\n          .eq('is_active', true)\n          .order('created_at', { ascending: false });\n\n        if (error) throw handleError(error, 'Failed to fetch memberships');\n        return data as TenantMembership[];\n      } catch (error) {\n        throw handleError(error, 'useUserTenantMemberships query failed');\n      }\n    },\n    staleTime: 5 * 60 * 1000,\n  });\n}\n\n/**\n * Fetch members of a tenant\n */\nexport function useTenantMembers(tenantId: string | null) {\n  return useQuery({\n    queryKey: ['tenants', 'members', tenantId],\n    queryFn: async () => {\n      if (!tenantId) throw createError.validation('Tenant ID is required');\n\n      try {\n        const { data, error } = await supabase\n          .from('user_tenant_memberships')\n          .select(`\n            *,\n            users_profiles:user_id (\n              user_id,\n              first_name,\n              last_name,\n              email\n            )\n          `)\n          .eq('tenant_id', tenantId)\n          .eq('is_active', true)\n          .order('role', { ascending: true });\n\n        if (error) throw handleError(error, 'Failed to fetch tenant members');\n        return data as TenantMembership[];\n      } catch (error) {\n        throw handleError(error, 'useTenantMembers query failed');\n      }\n    },\n    enabled: !!tenantId,\n    staleTime: 3 * 60 * 1000,\n  });\n}\n\n// ==================== Tenant Mutations ====================\n\n/**\n * Create new tenant\n */\nexport function useCreateTenant() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async (tenantData: Partial<Tenant>) => {\n      try {\n        log.info('Creating tenant', { data: tenantData });\n\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) throw createError.auth('User not authenticated');\n\n        // Create tenant\n        const { data: tenant, error: tenantError } = await supabase\n          .from('tenants')\n          .insert({\n            ...tenantData,\n            subscription_tier: tenantData.subscription_tier || 'trial',\n            subscription_status: 'trial',\n            trial_ends_at: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString(), // 14 days trial\n          })\n          .select()\n          .single();\n\n        if (tenantError) throw handleError(tenantError, 'Failed to create tenant');\n\n        // Add creator as owner\n        const { error: membershipError } = await supabase\n          .from('user_tenant_memberships')\n          .insert({\n            user_id: user.id,\n            tenant_id: tenant.id,\n            role: 'owner',\n            is_active: true,\n            invitation_accepted_at: new Date().toISOString(),\n          });\n\n        if (membershipError) {\n          // Rollback tenant creation\n          await supabase.from('tenants').delete().eq('id', tenant.id);\n          throw handleError(membershipError, 'Failed to create tenant membership');\n        }\n\n        log.info('Tenant created successfully', { id: tenant.id });\n        return tenant as Tenant;\n      } catch (error) {\n        throw handleError(error, 'useCreateTenant mutation failed');\n      }\n    },\n    onSuccess: (data) => {\n      invalidateQueries(queryKeys.tenants.all);\n      queryClient.setQueryData(queryKeys.tenants.detail(data.id), data);\n      log.track('tenant_created', { tenantId: data.id, tier: data.subscription_tier });\n    },\n  });\n}\n\n/**\n * Update tenant\n */\nexport function useUpdateTenant() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<Tenant> }) => {\n      try {\n        log.info('Updating tenant', { id, data });\n\n        const { data: updated, error } = await supabase\n          .from('tenants')\n          .update({\n            ...data,\n            updated_at: new Date().toISOString(),\n          })\n          .eq('id', id)\n          .select()\n          .single();\n\n        if (error) {\n          throw handleError(error, 'Failed to update tenant');\n        }\n\n        log.info('Tenant updated successfully', { id });\n        return updated as Tenant;\n      } catch (error) {\n        throw handleError(error, 'useUpdateTenant mutation failed');\n      }\n    },\n    onSuccess: (data) => {\n      queryClient.setQueryData(queryKeys.tenants.detail(data.id), data);\n      invalidateQueries(queryKeys.tenants.all);\n      invalidateQueries(queryKeys.tenants.current);\n      log.track('tenant_updated', { tenantId: data.id });\n    },\n  });\n}\n\n/**\n * Update tenant settings\n */\nexport function useUpdateTenantSettings() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async ({ \n      id, \n      settings \n    }: { \n      id: string; \n      settings: Record<string, any>;\n    }) => {\n      try {\n        log.info('Updating tenant settings', { id });\n\n        // Get current settings\n        const { data: tenant, error: fetchError } = await supabase\n          .from('tenants')\n          .select('settings')\n          .eq('id', id)\n          .single();\n\n        if (fetchError) throw handleError(fetchError, 'Failed to fetch tenant');\n\n        // Merge settings\n        const mergedSettings = { ...(tenant.settings || {}), ...settings };\n\n        const { data: updated, error } = await supabase\n          .from('tenants')\n          .update({\n            settings: mergedSettings,\n            updated_at: new Date().toISOString(),\n          })\n          .eq('id', id)\n          .select()\n          .single();\n\n        if (error) throw handleError(error, 'Failed to update tenant settings');\n\n        log.info('Tenant settings updated', { id });\n        return updated as Tenant;\n      } catch (error) {\n        throw handleError(error, 'useUpdateTenantSettings mutation failed');\n      }\n    },\n    onSuccess: (data) => {\n      queryClient.setQueryData(queryKeys.tenants.detail(data.id), data);\n      invalidateQueries(queryKeys.tenants.current);\n      log.track('tenant_settings_updated', { tenantId: data.id });\n    },\n  });\n}\n\n/**\n * Update tenant features\n */\nexport function useUpdateTenantFeatures() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async ({ \n      id, \n      features \n    }: { \n      id: string; \n      features: Record<string, boolean>;\n    }) => {\n      try {\n        log.info('Updating tenant features', { id, features });\n\n        // Get current features\n        const { data: tenant, error: fetchError } = await supabase\n          .from('tenants')\n          .select('features')\n          .eq('id', id)\n          .single();\n\n        if (fetchError) throw handleError(fetchError, 'Failed to fetch tenant');\n\n        // Merge features\n        const mergedFeatures = { ...(tenant.features || {}), ...features };\n\n        const { data: updated, error } = await supabase\n          .from('tenants')\n          .update({\n            features: mergedFeatures,\n            updated_at: new Date().toISOString(),\n          })\n          .eq('id', id)\n          .select()\n          .single();\n\n        if (error) throw handleError(error, 'Failed to update tenant features');\n\n        log.info('Tenant features updated', { id });\n        return updated as Tenant;\n      } catch (error) {\n        throw handleError(error, 'useUpdateTenantFeatures mutation failed');\n      }\n    },\n    onSuccess: (data) => {\n      queryClient.setQueryData(queryKeys.tenants.detail(data.id), data);\n      invalidateQueries(queryKeys.tenants.current);\n      log.track('tenant_features_updated', { tenantId: data.id });\n    },\n  });\n}\n\n/**\n * Invite user to tenant\n */\nexport function useInviteToTenant() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async ({ \n      tenantId, \n      userId, \n      role \n    }: { \n      tenantId: string; \n      userId: string; \n      role: TenantMembership['role'];\n    }) => {\n      try {\n        log.info('Inviting user to tenant', { tenantId, userId, role });\n\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) throw createError.auth('User not authenticated');\n\n        const { data, error } = await supabase\n          .from('user_tenant_memberships')\n          .insert({\n            tenant_id: tenantId,\n            user_id: userId,\n            role,\n            is_active: true,\n            invited_by: user.id,\n            invitation_accepted_at: new Date().toISOString(),\n          })\n          .select()\n          .single();\n\n        if (error) throw handleError(error, 'Failed to invite user');\n\n        log.info('User invited to tenant', { tenantId, userId });\n        return data as TenantMembership;\n      } catch (error) {\n        throw handleError(error, 'useInviteToTenant mutation failed');\n      }\n    },\n    onSuccess: (data) => {\n      invalidateQueries(['tenants', 'members', data.tenant_id]);\n      log.track('user_invited_to_tenant', { tenantId: data.tenant_id, userId: data.user_id });\n    },\n  });\n}\n\n/**\n * Remove user from tenant\n */\nexport function useRemoveFromTenant() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async ({ \n      tenantId, \n      userId \n    }: { \n      tenantId: string; \n      userId: string;\n    }) => {\n      try {\n        log.info('Removing user from tenant', { tenantId, userId });\n\n        const { error } = await supabase\n          .from('user_tenant_memberships')\n          .update({ is_active: false })\n          .eq('tenant_id', tenantId)\n          .eq('user_id', userId);\n\n        if (error) throw handleError(error, 'Failed to remove user');\n\n        log.info('User removed from tenant', { tenantId, userId });\n        return { tenantId, userId };\n      } catch (error) {\n        throw handleError(error, 'useRemoveFromTenant mutation failed');\n      }\n    },\n    onSuccess: ({ tenantId, userId }) => {\n      invalidateQueries(['tenants', 'members', tenantId]);\n      log.track('user_removed_from_tenant', { tenantId, userId });\n    },\n  });\n}\n\n/**\n * Update member role\n */\nexport function useUpdateMemberRole() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async ({ \n      membershipId, \n      role \n    }: { \n      membershipId: string; \n      role: TenantMembership['role'];\n    }) => {\n      try {\n        log.info('Updating member role', { membershipId, role });\n\n        const { data: updated, error } = await supabase\n          .from('user_tenant_memberships')\n          .update({ \n            role,\n            updated_at: new Date().toISOString(),\n          })\n          .eq('id', membershipId)\n          .select()\n          .single();\n\n        if (error) throw handleError(error, 'Failed to update role');\n\n        log.info('Member role updated', { membershipId, role });\n        return updated as TenantMembership;\n      } catch (error) {\n        throw handleError(error, 'useUpdateMemberRole mutation failed');\n      }\n    },\n    onSuccess: (data) => {\n      invalidateQueries(['tenants', 'members', data.tenant_id]);\n      log.track('member_role_updated', { membershipId: data.id, role: data.role });\n    },\n  });\n}\n\n/**\n * Delete tenant (soft delete)\n */\nexport function useDeleteTenant() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async (id: string) => {\n      try {\n        log.info('Deleting tenant', { id });\n\n        const { error } = await supabase\n          .from('tenants')\n          .update({ \n            deleted_at: new Date().toISOString(),\n            is_active: false,\n          })\n          .eq('id', id);\n\n        if (error) {\n          throw handleError(error, 'Failed to delete tenant');\n        }\n\n        log.info('Tenant deleted successfully', { id });\n        return id;\n      } catch (error) {\n        throw handleError(error, 'useDeleteTenant mutation failed');\n      }\n    },\n    onSuccess: (id) => {\n      queryClient.removeQueries({ queryKey: queryKeys.tenants.detail(id) });\n      invalidateQueries(queryKeys.tenants.all);\n      log.track('tenant_deleted', { tenantId: id });\n    },\n  });\n}\n\n/**\n * Check if slug is available\n */\nexport function useCheckSlugAvailability(slug: string | null) {\n  return useQuery({\n    queryKey: ['tenants', 'checkSlug', slug],\n    queryFn: async () => {\n      if (!slug || slug.length < 3) return { available: false, reason: 'Slug too short' };\n\n      try {\n        const { data, error } = await supabase\n          .from('tenants')\n          .select('id')\n          .eq('slug', slug)\n          .maybeSingle();\n\n        if (error) throw handleError(error, 'Failed to check slug');\n        \n        return { \n          available: !data, \n          reason: data ? 'Slug already taken' : null \n        };\n      } catch (error) {\n        throw handleError(error, 'useCheckSlugAvailability query failed');\n      }\n    },\n    enabled: !!slug && slug.length >= 3,\n    staleTime: 30 * 1000, // 30 seconds\n  });\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/__tests__/errorHandler.test.ts","messages":[{"ruleId":"@typescript-eslint/triple-slash-reference","severity":2,"message":"Do not use a triple slash reference for vitest, use `import` style instead.","line":1,"column":1,"nodeType":"Line","messageId":"tripleSlashReference","endLine":1,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/// <reference types=\"vitest\" />\n/// <reference types=\"vite/client\" />\n/**\n * Unit Tests for Error Handler\n */\n\nimport { describe, it, expect } from 'vitest';\nimport { AppError, ErrorCode, handleError, createError, displayError } from '../errorHandler';\n\ndescribe('AppError', () => {\n  it('should create an AppError with correct properties', () => {\n    const error = new AppError(\n      'Test error',\n      ErrorCode.VALIDATION_ERROR,\n      400,\n      { field: 'email' }\n    );\n\n    expect(error.message).toBe('Test error');\n    expect(error.code).toBe(ErrorCode.VALIDATION_ERROR);\n    expect(error.statusCode).toBe(400);\n    expect(error.details).toEqual({ field: 'email' });\n  });\n\n  it('should have default status code of 500', () => {\n    const error = new AppError('Test error', ErrorCode.INTERNAL_ERROR);\n    expect(error.statusCode).toBe(500);\n  });\n\n  // NOTE: This test is skipped because `isProduction` in errorHandler.ts is evaluated at module load time.\n  // When running in test mode, MODE='test', and it cannot be dynamically changed after module initialization.\n  // In actual production (MODE='production'), the behavior works correctly.\n  it.skip('should return generic message in production', () => {\n    const originalMode = import.meta.env.MODE;\n    (import.meta.env as any).MODE = 'production';\n\n    const error = new AppError('Detailed error', ErrorCode.DATABASE_ERROR);\n    const userMessage = error.getUserMessage();\n\n    expect(userMessage).not.toBe('Detailed error');\n    expect(userMessage).toBe('A database error occurred. Please try again.');\n\n    (import.meta.env as any).MODE = originalMode;\n  });\n\n  it('should return detailed message in development', () => {\n    const originalMode = import.meta.env.MODE;\n    (import.meta.env as any).MODE = 'development';\n\n    const error = new AppError('Detailed error', ErrorCode.DATABASE_ERROR);\n    const userMessage = error.getUserMessage();\n\n    expect(userMessage).toBe('Detailed error');\n\n    (import.meta.env as any).MODE = originalMode;\n  });\n\n  it('should convert to JSON correctly', () => {\n    const error = new AppError(\n      'Test error',\n      ErrorCode.VALIDATION_ERROR,\n      400,\n      { field: 'email' }\n    );\n\n    const json = error.toJSON();\n\n    expect(json.error.message).toBeDefined();\n    expect(json.error.code).toBe(ErrorCode.VALIDATION_ERROR);\n  });\n});\n\ndescribe('handleError', () => {\n  it('should return AppError as-is', () => {\n    const originalError = new AppError('Test', ErrorCode.VALIDATION_ERROR);\n    const result = handleError(originalError);\n\n    expect(result).toBe(originalError);\n  });\n\n  it('should normalize standard Error', () => {\n    const error = new Error('Something went wrong');\n    const result = handleError(error);\n\n    expect(result).toBeInstanceOf(AppError);\n    expect(result.code).toBe(ErrorCode.INTERNAL_ERROR);\n  });\n\n  it('should detect authentication errors', () => {\n    const error = new Error('Invalid token');\n    const result = handleError(error);\n\n    expect(result.code).toBe(ErrorCode.AUTH_INVALID);\n    expect(result.statusCode).toBe(401);\n  });\n\n  it('should detect permission errors', () => {\n    const error = new Error('Permission denied');\n    const result = handleError(error);\n\n    expect(result.code).toBe(ErrorCode.PERMISSION_DENIED);\n    expect(result.statusCode).toBe(403);\n  });\n\n  it('should detect not found errors', () => {\n    const error = new Error('Record not found');\n    const result = handleError(error);\n\n    expect(result.code).toBe(ErrorCode.RECORD_NOT_FOUND);\n    expect(result.statusCode).toBe(404);\n  });\n\n  it('should detect duplicate errors', () => {\n    const error = new Error('Duplicate key violation');\n    const result = handleError(error);\n\n    expect(result.code).toBe(ErrorCode.DUPLICATE_RECORD);\n    expect(result.statusCode).toBe(409);\n  });\n\n  it('should detect network errors', () => {\n    const error = new Error('Network error occurred');\n    const result = handleError(error);\n\n    expect(result.code).toBe(ErrorCode.NETWORK_ERROR);\n    expect(result.statusCode).toBe(503);\n  });\n\n  it('should handle unknown error types', () => {\n    const error = { weird: 'object' };\n    const result = handleError(error);\n\n    expect(result).toBeInstanceOf(AppError);\n    expect(result.code).toBe(ErrorCode.UNKNOWN_ERROR);\n  });\n});\n\ndescribe('createError helpers', () => {\n  it('should create auth error', () => {\n    const error = createError.auth('Authentication required');\n\n    expect(error.code).toBe(ErrorCode.AUTH_REQUIRED);\n    expect(error.statusCode).toBe(401);\n    expect(error.message).toBe('Authentication required');\n  });\n\n  it('should create auth invalid error with default message', () => {\n    const error = createError.authInvalid();\n\n    expect(error.code).toBe(ErrorCode.AUTH_INVALID);\n    expect(error.message).toBe('Invalid credentials');\n  });\n\n  it('should create permission error', () => {\n    const error = createError.permission();\n\n    expect(error.code).toBe(ErrorCode.PERMISSION_DENIED);\n    expect(error.statusCode).toBe(403);\n  });\n\n  it('should create not found error', () => {\n    const error = createError.notFound('Employee');\n\n    expect(error.code).toBe(ErrorCode.RECORD_NOT_FOUND);\n    expect(error.statusCode).toBe(404);\n    expect(error.message).toBe('Employee not found');\n  });\n\n  it('should create validation error', () => {\n    const error = createError.validation('Invalid email format');\n\n    expect(error.code).toBe(ErrorCode.VALIDATION_ERROR);\n    expect(error.statusCode).toBe(400);\n    expect(error.message).toBe('Invalid email format');\n  });\n\n  it('should create duplicate error', () => {\n    const error = createError.duplicate('User');\n\n    expect(error.code).toBe(ErrorCode.DUPLICATE_RECORD);\n    expect(error.statusCode).toBe(409);\n    expect(error.message).toBe('User already exists');\n  });\n\n  it('should create network error', () => {\n    const error = createError.network();\n\n    expect(error.code).toBe(ErrorCode.NETWORK_ERROR);\n    expect(error.statusCode).toBe(503);\n  });\n\n  it('should create service unavailable error', () => {\n    const error = createError.serviceUnavailable();\n\n    expect(error.code).toBe(ErrorCode.SERVICE_UNAVAILABLE);\n    expect(error.statusCode).toBe(503);\n  });\n\n  it('should create business rule error', () => {\n    const error = createError.businessRule('Cannot delete active user');\n\n    expect(error.code).toBe(ErrorCode.BUSINESS_RULE_VIOLATION);\n    expect(error.statusCode).toBe(400);\n    expect(error.message).toBe('Cannot delete active user');\n  });\n\n  it('should create file upload error', () => {\n    const error = createError.fileUpload('File too large');\n\n    expect(error.code).toBe(ErrorCode.FILE_UPLOAD_ERROR);\n    expect(error.statusCode).toBe(400);\n    expect(error.message).toBe('File too large');\n  });\n});\n\ndescribe('displayError', () => {\n  it('should display AppError user message', () => {\n    const error = new AppError('Detailed', ErrorCode.VALIDATION_ERROR);\n    const message = displayError(error);\n\n    expect(message).toBeDefined();\n  });\n\n  it('should display Error message in development', () => {\n    const originalMode = import.meta.env.MODE;\n    (import.meta.env as any).MODE = 'development';\n\n    const error = new Error('Something went wrong');\n    const message = displayError(error);\n\n    expect(message).toBe('Something went wrong');\n\n    (import.meta.env as any).MODE = originalMode;\n  });\n\n  // NOTE: Skipped for the same reason as above - isProduction is evaluated at module load time.\n  it.skip('should display fallback in production', () => {\n    const originalMode = import.meta.env.MODE;\n    (import.meta.env as any).MODE = 'production';\n\n    const error = new Error('Something went wrong');\n    const message = displayError(error, 'Oops!');\n\n    expect(message).toBe('Oops!');\n\n    (import.meta.env as any).MODE = originalMode;\n  });\n\n  it('should use default fallback message', () => {\n    const error = 'string error';\n    const message = displayError(error);\n\n    expect(message).toBe('An error occurred');\n  });\n});\n\ndescribe('asyncHandler', () => {\n  it('should return data on success', async () => {\n    const { asyncHandler } = await import('../errorHandler');\n\n    const successFn = async () => 'success';\n    const [error, data] = await asyncHandler(successFn);\n\n    expect(error).toBeNull();\n    expect(data).toBe('success');\n  });\n\n  it('should return error on failure', async () => {\n    const { asyncHandler } = await import('../errorHandler');\n\n    const failFn = async () => {\n      throw new Error('failed');\n    };\n    const [error, data] = await asyncHandler(failFn);\n\n    expect(error).toBeInstanceOf(AppError);\n    expect(data).toBeNull();\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/__tests__/services.test.ts","messages":[{"ruleId":"@typescript-eslint/triple-slash-reference","severity":2,"message":"Do not use a triple slash reference for vitest, use `import` style instead.","line":1,"column":1,"nodeType":"Line","messageId":"tripleSlashReference","endLine":1,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'afterEach' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":57},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'insertMock' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":421,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":421,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'insertMock' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":438,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":438,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'insertMock' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":455,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":455,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'insertMock' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":472,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":472,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'insertMock' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":489,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":489,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'insertMock' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":507,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":507,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'insertMock' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":519,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":519,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'insertMock' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":542,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":542,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'insertMock' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":555,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":555,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'insertMock' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":576,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":576,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'insertMock' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":604,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":604,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'insertMock' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":625,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":625,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'channelMock' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":646,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":646,"endColumn":26}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/// <reference types=\"vitest\" />\n/**\n * Comprehensive Service Tests\n * Tests all core services with mock data\n */\n\nimport { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\n\n// ============================================\n// MOCK DATA\n// ============================================\n\nconst mockTenant = {\n    id: 'tenant-1',\n    name: 'Test Organization',\n    domain: 'test.org',\n    slug: 'test-org',\n    subscription_tier: 'professional',\n    subscription_price: 99.99,\n    currency: 'GBP',\n    subscription_interval: 'monthly' as const,\n    is_active: true,\n    max_users: 50,\n};\n\nconst mockFeature = {\n    id: 'feature-1',\n    name: 'ai_screening',\n    display_name: 'AI Resume Screening',\n    description: 'Automatically screen resumes with AI',\n    category: 'feature' as const,\n    is_premium: true,\n};\n\nconst mockDBSCheck = {\n    id: 'dbs-1',\n    tenant_id: 'tenant-1',\n    user_id: 'user-1',\n    applicant_name: 'John Doe',\n    applicant_email: 'john@example.com',\n    dbs_number: 'DBS123456',\n    check_type: 'enhanced' as const,\n    status: 'completed' as const,\n    issue_date: '2024-01-15',\n    expiry_date: '2027-01-15',\n    certificate_number: 'CERT123',\n    update_service_subscribed: true,\n    created_at: '2024-01-15T10:00:00Z',\n    updated_at: '2024-01-15T10:00:00Z',\n};\n\nconst mockTrainingRecord = {\n    id: 'training-1',\n    tenant_id: 'tenant-1',\n    user_id: 'user-1',\n    staff_name: 'John Doe',\n    training_name: 'Fire Safety',\n    training_category: 'mandatory' as const,\n    is_mandatory: true,\n    completion_date: '2024-01-10',\n    expiry_date: '2025-01-10',\n    assessment_passed: true,\n    training_provider: 'Safety Training Ltd',\n    training_hours: 4,\n    created_at: '2024-01-10T10:00:00Z',\n    updated_at: '2024-01-10T10:00:00Z',\n};\n\nconst mockReference = {\n    id: 'ref-1',\n    tenant_id: 'tenant-1',\n    applicant_id: 'app-1',\n    applicant_name: 'Jane Smith',\n    reference_number: 1,\n    referee_name: 'Bob Manager',\n    referee_position: 'HR Director',\n    referee_organization: 'Previous Company Ltd',\n    referee_email: 'bob@previous.com',\n    status: 'verified' as const,\n    suitability_rating: 'excellent' as const,\n    created_at: '2024-01-20T10:00:00Z',\n};\n\nconst mockJob = {\n    id: 'job-1',\n    job_title: 'Senior Software Engineer',\n    job_code: 'SSE-2024-001',\n    department: 'Engineering',\n    location: 'Remote',\n    employment_type: 'full_time',\n    salary_range_min: 80000,\n    salary_range_max: 120000,\n    job_description: 'We are looking for a senior engineer...',\n    status: 'open',\n    created_at: '2024-01-01T10:00:00Z',\n};\n\nconst mockApplication = {\n    id: 'app-1',\n    job_posting_id: 'job-1',\n    applicant_first_name: 'Alice',\n    applicant_last_name: 'Applicant',\n    applicant_email: 'alice@example.com',\n    applicant_phone: '+447123456789',\n    status: 'new',\n    ai_score: 85,\n    ai_summary: 'Strong candidate with relevant experience',\n    applied_at: '2024-01-15T10:00:00Z',\n    cv_url: 'https://storage.example.com/cv.pdf',\n};\n\nconst mockInterview = {\n    id: 'int-1',\n    application_id: 'app-1',\n    interview_type: 'technical',\n    scheduled_date: '2024-02-01T14:00:00Z',\n    duration: 60,\n    location: 'https://meet.google.com/xyz',\n    status: 'scheduled',\n    created_at: '2024-01-20T10:00:00Z',\n};\n\nconst mockEmployee = {\n    id: 'emp-1',\n    user_id: 'user-1',\n    tenant_id: 'tenant-1',\n    first_name: 'John',\n    last_name: 'Employee',\n    email: 'john.employee@company.com',\n    department: 'Engineering',\n    position: 'Software Developer',\n    hire_date: '2023-01-15',\n    is_active: true,\n    created_at: '2023-01-15T10:00:00Z',\n};\n\nconst mockLeaveRequest = {\n    id: 'leave-1',\n    employee_id: 'emp-1',\n    leave_type: 'annual',\n    start_date: '2024-03-01',\n    end_date: '2024-03-05',\n    status: 'pending',\n    reason: 'Family vacation',\n    created_at: '2024-02-15T10:00:00Z',\n};\n\nconst mockMessage = {\n    id: 'msg-1',\n    sender_id: 'user-1',\n    recipient_id: 'user-2',\n    subject: 'Meeting Tomorrow',\n    body: 'Hi, just wanted to confirm our meeting tomorrow at 2pm.',\n    is_read: false,\n    created_at: '2024-02-20T10:00:00Z',\n};\n\nconst mockPerformanceReview = {\n    id: 'review-1',\n    employee_id: 'emp-1',\n    reviewer_id: 'user-2',\n    review_period_start: '2024-01-01',\n    review_period_end: '2024-03-31',\n    status: 'in_progress',\n    overall_rating: null,\n    created_at: '2024-04-01T10:00:00Z',\n};\n\nconst mockGoal = {\n    id: 'goal-1',\n    employee_id: 'emp-1',\n    title: 'Complete AWS Certification',\n    description: 'Get AWS Solutions Architect certification',\n    goal_type: 'development',\n    target_date: '2024-06-30',\n    status: 'on_track',\n    progress_percentage: 45,\n    priority: 'high',\n    created_at: '2024-01-01T10:00:00Z',\n};\n\nconst mockDocument = {\n    id: 'doc-1',\n    tenant_id: 'tenant-1',\n    user_id: 'user-1',\n    name: 'Employment Contract',\n    file_path: 'documents/contracts/emp1-contract.pdf',\n    file_type: 'application/pdf',\n    file_size: 152340,\n    category: 'contracts',\n    created_at: '2024-01-15T10:00:00Z',\n};\n\nconst mockAuditLog = {\n    id: 'audit-1',\n    tenant_id: 'tenant-1',\n    user_id: 'user-1',\n    action: 'create',\n    entity_type: 'job_posting',\n    entity_id: 'job-1',\n    changes: { status: 'draft' },\n    created_at: '2024-01-01T10:00:00Z',\n};\n\n// ============================================\n// MOCK SUPABASE CLIENT\n// ============================================\n\nconst createMockSupabaseResponse = <T>(data: T | T[], error: any = null) => ({\n    data,\n    error,\n    count: Array.isArray(data) ? data.length : 1,\n});\n\nconst mockSupabaseClient = {\n    from: vi.fn((_table: string) => ({\n        select: vi.fn((_columns?: string) => ({\n            eq: vi.fn((_column?: string, _value?: any) => ({\n                single: vi.fn(() => Promise.resolve(createMockSupabaseResponse(mockTenant))),\n                order: vi.fn((_col?: string) => Promise.resolve(createMockSupabaseResponse([mockTenant]))),\n                limit: vi.fn((_n?: number) => Promise.resolve(createMockSupabaseResponse([mockTenant]))),\n                gte: vi.fn((_col?: string, _val?: any) => ({\n                    lte: vi.fn((_col2?: string, _val2?: any) => Promise.resolve(createMockSupabaseResponse([mockTrainingRecord]))),\n                })),\n            })),\n            order: vi.fn((_col?: string) => Promise.resolve(createMockSupabaseResponse([mockTenant]))),\n            single: vi.fn(() => Promise.resolve(createMockSupabaseResponse(mockTenant))),\n        })),\n        insert: vi.fn((_data?: any) => ({\n            select: vi.fn((_columns?: string) => ({\n                single: vi.fn(() => Promise.resolve(createMockSupabaseResponse(mockTenant))),\n            })),\n        })),\n        update: vi.fn((_data?: any) => ({\n            eq: vi.fn((_column?: string, _value?: any) => ({\n                select: vi.fn((_columns?: string) => Promise.resolve(createMockSupabaseResponse([mockTenant]))),\n            })),\n        })),\n        upsert: vi.fn((_data?: any) => Promise.resolve(createMockSupabaseResponse(null))),\n        delete: vi.fn(() => ({\n            eq: vi.fn((_column?: string, _value?: any) => Promise.resolve(createMockSupabaseResponse(null))),\n        })),\n    })),\n    auth: {\n        getUser: vi.fn(() => Promise.resolve({ data: { user: { id: 'user-1', email: 'test@example.com' } }, error: null })),\n        signIn: vi.fn((_credentials?: any) => Promise.resolve({ data: { user: { id: 'user-1' } }, error: null })),\n        signOut: vi.fn(() => Promise.resolve({ error: null })),\n    },\n    storage: {\n        from: vi.fn((_bucket: string) => ({\n            upload: vi.fn((_path?: string, _file?: any) => Promise.resolve({ data: { path: 'test/path.pdf' }, error: null })),\n            download: vi.fn((_path?: string) => Promise.resolve({ data: new Blob(), error: null })),\n            getPublicUrl: vi.fn((_path?: string) => ({ data: { publicUrl: 'https://example.com/file.pdf' } })),\n        })),\n    },\n    channel: vi.fn((_name: string) => ({\n        on: vi.fn((_event?: string, _opts?: any, _callback?: any) => ({\n            subscribe: vi.fn(() => ({ status: 'subscribed' })),\n        })),\n    })),\n    removeChannel: vi.fn((_channel?: any) => { }),\n    functions: {\n        invoke: vi.fn((_name?: string, _opts?: any) => Promise.resolve({ data: { success: true }, error: null })),\n    },\n};\n\n// Mock the supabase module\nvi.mock('@/lib/supabase', () => ({\n    supabase: mockSupabaseClient,\n    getSupabaseClient: () => mockSupabaseClient,\n}));\n\n// ============================================\n// TESTS\n// ============================================\n\ndescribe('Mock Data Validation', () => {\n    describe('Tenant Data', () => {\n        it('should have valid tenant structure', () => {\n            expect(mockTenant).toHaveProperty('id');\n            expect(mockTenant).toHaveProperty('name');\n            expect(mockTenant).toHaveProperty('subscription_tier');\n            expect(mockTenant.is_active).toBe(true);\n        });\n\n        it('should have valid subscription details', () => {\n            expect(mockTenant.subscription_price).toBeGreaterThan(0);\n            expect(['monthly', 'yearly']).toContain(mockTenant.subscription_interval);\n            expect(mockTenant.max_users).toBeGreaterThan(0);\n        });\n    });\n\n    describe('Feature Data', () => {\n        it('should have valid feature structure', () => {\n            expect(mockFeature).toHaveProperty('id');\n            expect(mockFeature).toHaveProperty('name');\n            expect(mockFeature).toHaveProperty('display_name');\n            expect(['module', 'feature', 'integration']).toContain(mockFeature.category);\n        });\n    });\n\n    describe('DBS Check Data', () => {\n        it('should have valid DBS check structure', () => {\n            expect(mockDBSCheck).toHaveProperty('dbs_number');\n            expect(mockDBSCheck).toHaveProperty('check_type');\n            expect(['basic', 'standard', 'enhanced', 'enhanced_barred']).toContain(mockDBSCheck.check_type);\n        });\n\n        it('should have valid date fields', () => {\n            const issueDate = new Date(mockDBSCheck.issue_date);\n            const expiryDate = new Date(mockDBSCheck.expiry_date);\n            expect(expiryDate.getTime()).toBeGreaterThan(issueDate.getTime());\n        });\n    });\n\n    describe('Training Record Data', () => {\n        it('should have valid training structure', () => {\n            expect(mockTrainingRecord).toHaveProperty('training_name');\n            expect(mockTrainingRecord).toHaveProperty('training_category');\n            expect(['mandatory', 'role_specific', 'cpd', 'induction']).toContain(mockTrainingRecord.training_category);\n        });\n\n        it('should have valid completion status', () => {\n            expect(mockTrainingRecord.assessment_passed).toBe(true);\n            expect(mockTrainingRecord.training_hours).toBeGreaterThan(0);\n        });\n    });\n\n    describe('Job Posting Data', () => {\n        it('should have valid job structure', () => {\n            expect(mockJob).toHaveProperty('job_title');\n            expect(mockJob).toHaveProperty('department');\n            expect(mockJob).toHaveProperty('status');\n        });\n\n        it('should have valid salary range', () => {\n            expect(mockJob.salary_range_max).toBeGreaterThan(mockJob.salary_range_min!);\n        });\n    });\n\n    describe('Application Data', () => {\n        it('should have valid application structure', () => {\n            expect(mockApplication).toHaveProperty('applicant_first_name');\n            expect(mockApplication).toHaveProperty('applicant_email');\n            expect(mockApplication).toHaveProperty('status');\n        });\n\n        it('should have valid AI score', () => {\n            expect(mockApplication.ai_score).toBeGreaterThanOrEqual(0);\n            expect(mockApplication.ai_score).toBeLessThanOrEqual(100);\n        });\n    });\n});\n\ndescribe('TenantService', () => {\n    beforeEach(() => {\n        vi.clearAllMocks();\n    });\n\n    it('should fetch all tenants', async () => {\n        const response = await mockSupabaseClient.from('tenants').select('*').order('created_at');\n        expect(response.data).toBeDefined();\n        expect(mockSupabaseClient.from).toHaveBeenCalledWith('tenants');\n    });\n\n    it('should create a new tenant', async () => {\n        const newTenant = {\n            name: 'New Organization',\n            domain: 'new.org',\n            subscription_tier: 'starter',\n        };\n\n        const insertMock = mockSupabaseClient.from('tenants').insert(newTenant);\n        expect(mockSupabaseClient.from).toHaveBeenCalled();\n        expect(insertMock).toBeDefined();\n    });\n\n    it('should update tenant subscription', async () => {\n        const updateMock = mockSupabaseClient.from('tenants').update({\n            subscription_price: 149.99,\n            currency: 'USD',\n        });\n        expect(updateMock).toBeDefined();\n    });\n\n    it('should delete a tenant', async () => {\n        const deleteMock = mockSupabaseClient.from('tenants').delete();\n        expect(deleteMock).toBeDefined();\n    });\n});\n\ndescribe('ComplianceService', () => {\n    beforeEach(() => {\n        vi.clearAllMocks();\n    });\n\n    describe('DBS Checks', () => {\n        it('should add a new DBS check', async () => {\n            const insertMock = mockSupabaseClient.from('dbs_checks').insert(mockDBSCheck);\n            expect(mockSupabaseClient.from).toHaveBeenCalledWith('dbs_checks');\n            expect(insertMock).toBeDefined();\n        });\n\n        it('should fetch DBS check by user ID', async () => {\n            const selectMock = mockSupabaseClient.from('dbs_checks').select('*');\n            expect(selectMock).toBeDefined();\n        });\n\n        it('should validate DBS check expiry detection', () => {\n            const expiryDate = new Date(mockDBSCheck.expiry_date);\n            const today = new Date();\n            const daysUntilExpiry = Math.floor((expiryDate.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));\n\n            // DBS should not be expiring soon (more than 90 days away)\n            expect(daysUntilExpiry).toBeGreaterThan(90);\n        });\n    });\n\n    describe('Training Records', () => {\n        it('should add a training record', async () => {\n            const insertMock = mockSupabaseClient.from('training_records').insert(mockTrainingRecord);\n            expect(mockSupabaseClient.from).toHaveBeenCalledWith('training_records');\n        });\n\n        it('should fetch user training', async () => {\n            const selectMock = mockSupabaseClient.from('training_records').select('*');\n            expect(selectMock).toBeDefined();\n        });\n\n        it('should validate mandatory training detection', () => {\n            expect(mockTrainingRecord.is_mandatory).toBe(true);\n            expect(mockTrainingRecord.assessment_passed).toBe(true);\n        });\n    });\n\n    describe('References', () => {\n        it('should add an employment reference', async () => {\n            const insertMock = mockSupabaseClient.from('employment_references').insert(mockReference);\n            expect(mockSupabaseClient.from).toHaveBeenCalledWith('employment_references');\n        });\n\n        it('should validate reference suitability rating', () => {\n            expect(['excellent', 'good', 'satisfactory', 'concerns']).toContain(mockReference.suitability_rating);\n        });\n    });\n});\n\ndescribe('RecruitmentService', () => {\n    beforeEach(() => {\n        vi.clearAllMocks();\n    });\n\n    describe('Job Postings', () => {\n        it('should create a job posting', async () => {\n            const insertMock = mockSupabaseClient.from('job_postings').insert(mockJob);\n            expect(mockSupabaseClient.from).toHaveBeenCalledWith('job_postings');\n        });\n\n        it('should fetch active jobs', async () => {\n            const selectMock = mockSupabaseClient.from('job_postings').select('*');\n            expect(selectMock).toBeDefined();\n        });\n\n        it('should update job status', async () => {\n            const updateMock = mockSupabaseClient.from('job_postings').update({ status: 'closed' });\n            expect(updateMock).toBeDefined();\n        });\n    });\n\n    describe('Applications', () => {\n        it('should create an application', async () => {\n            const insertMock = mockSupabaseClient.from('applications').insert(mockApplication);\n            expect(mockSupabaseClient.from).toHaveBeenCalledWith('applications');\n        });\n\n        it('should fetch applications by job', async () => {\n            const selectMock = mockSupabaseClient.from('applications').select('*');\n            expect(selectMock).toBeDefined();\n        });\n\n        it('should validate application email format', () => {\n            const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n            expect(emailRegex.test(mockApplication.applicant_email)).toBe(true);\n        });\n    });\n\n    describe('Interviews', () => {\n        it('should schedule an interview', async () => {\n            const insertMock = mockSupabaseClient.from('interviews').insert(mockInterview);\n            expect(mockSupabaseClient.from).toHaveBeenCalledWith('interviews');\n        });\n\n        it('should validate interview duration', () => {\n            expect(mockInterview.duration).toBeGreaterThan(0);\n            expect(mockInterview.duration).toBeLessThanOrEqual(180); // Max 3 hours\n        });\n    });\n});\n\ndescribe('HRService', () => {\n    beforeEach(() => {\n        vi.clearAllMocks();\n    });\n\n    describe('Employees', () => {\n        it('should create an employee', async () => {\n            const insertMock = mockSupabaseClient.from('employees').insert(mockEmployee);\n            expect(mockSupabaseClient.from).toHaveBeenCalledWith('employees');\n        });\n\n        it('should validate employee email format', () => {\n            const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n            expect(emailRegex.test(mockEmployee.email)).toBe(true);\n        });\n    });\n\n    describe('Leave Requests', () => {\n        it('should create a leave request', async () => {\n            const insertMock = mockSupabaseClient.from('leave_requests').insert(mockLeaveRequest);\n            expect(mockSupabaseClient.from).toHaveBeenCalledWith('leave_requests');\n        });\n\n        it('should validate leave date range', () => {\n            const startDate = new Date(mockLeaveRequest.start_date);\n            const endDate = new Date(mockLeaveRequest.end_date);\n            expect(endDate.getTime()).toBeGreaterThanOrEqual(startDate.getTime());\n        });\n\n        it('should validate leave status', () => {\n            expect(['pending', 'approved', 'rejected', 'cancelled']).toContain(mockLeaveRequest.status);\n        });\n    });\n});\n\ndescribe('PerformanceService', () => {\n    beforeEach(() => {\n        vi.clearAllMocks();\n    });\n\n    describe('Performance Reviews', () => {\n        it('should create a performance review', async () => {\n            const insertMock = mockSupabaseClient.from('performance_reviews').insert(mockPerformanceReview);\n            expect(mockSupabaseClient.from).toHaveBeenCalledWith('performance_reviews');\n        });\n\n        it('should validate review period', () => {\n            const startDate = new Date(mockPerformanceReview.review_period_start);\n            const endDate = new Date(mockPerformanceReview.review_period_end);\n            expect(endDate.getTime()).toBeGreaterThan(startDate.getTime());\n        });\n    });\n\n    describe('Goals', () => {\n        it('should create a goal', async () => {\n            const insertMock = mockSupabaseClient.from('performance_goals').insert(mockGoal);\n            expect(mockSupabaseClient.from).toHaveBeenCalledWith('performance_goals');\n        });\n\n        it('should validate goal progress', () => {\n            expect(mockGoal.progress_percentage).toBeGreaterThanOrEqual(0);\n            expect(mockGoal.progress_percentage).toBeLessThanOrEqual(100);\n        });\n\n        it('should validate goal status', () => {\n            expect(['on_track', 'at_risk', 'behind', 'completed']).toContain(mockGoal.status);\n        });\n    });\n});\n\ndescribe('DocumentService', () => {\n    beforeEach(() => {\n        vi.clearAllMocks();\n    });\n\n    it('should create a document record', async () => {\n        const insertMock = mockSupabaseClient.from('documents').insert(mockDocument);\n        expect(mockSupabaseClient.from).toHaveBeenCalledWith('documents');\n    });\n\n    it('should upload a file to storage', async () => {\n        const file = new Blob(['test content'], { type: 'application/pdf' });\n        const uploadMock = await mockSupabaseClient.storage.from('documents').upload('test/path.pdf', file);\n        expect(uploadMock.data).toBeDefined();\n        expect(uploadMock.error).toBeNull();\n    });\n\n    it('should get public URL', () => {\n        const urlMock = mockSupabaseClient.storage.from('documents').getPublicUrl('test/path.pdf');\n        expect(urlMock.data.publicUrl).toBeDefined();\n    });\n\n    it('should validate file type', () => {\n        const validTypes = ['application/pdf', 'image/jpeg', 'image/png', 'application/msword'];\n        expect(validTypes).toContain(mockDocument.file_type);\n    });\n});\n\ndescribe('MessagingService', () => {\n    beforeEach(() => {\n        vi.clearAllMocks();\n    });\n\n    it('should send a message', async () => {\n        const insertMock = mockSupabaseClient.from('messages').insert(mockMessage);\n        expect(mockSupabaseClient.from).toHaveBeenCalledWith('messages');\n    });\n\n    it('should fetch inbox messages', async () => {\n        const selectMock = mockSupabaseClient.from('messages').select('*');\n        expect(selectMock).toBeDefined();\n    });\n\n    it('should mark message as read', async () => {\n        const updateMock = mockSupabaseClient.from('messages').update({ is_read: true });\n        expect(updateMock).toBeDefined();\n    });\n});\n\ndescribe('AuditService', () => {\n    beforeEach(() => {\n        vi.clearAllMocks();\n    });\n\n    it('should create an audit log entry', async () => {\n        const insertMock = mockSupabaseClient.from('audit_logs').insert(mockAuditLog);\n        expect(mockSupabaseClient.from).toHaveBeenCalledWith('audit_logs');\n    });\n\n    it('should fetch audit logs by entity', async () => {\n        const selectMock = mockSupabaseClient.from('audit_logs').select('*');\n        expect(selectMock).toBeDefined();\n    });\n\n    it('should validate audit action types', () => {\n        const validActions = ['create', 'update', 'delete', 'view', 'export', 'login', 'logout'];\n        expect(validActions).toContain(mockAuditLog.action);\n    });\n});\n\ndescribe('AutomationService', () => {\n    beforeEach(() => {\n        vi.clearAllMocks();\n    });\n\n    it('should subscribe to automation channel', () => {\n        const channelMock = mockSupabaseClient.channel('automation_execution_logs_changes');\n        expect(mockSupabaseClient.channel).toHaveBeenCalledWith('automation_execution_logs_changes');\n    });\n\n    it('should process automation logs', async () => {\n        const mockLog = {\n            id: 'log-1',\n            trigger_data: {\n                action_type: 'send_email',\n                action_config: { subject: 'Test', template_id: 'template-1' },\n                application_id: 'app-1',\n            },\n            execution_status: 'pending',\n        };\n\n        // Verify log structure\n        expect(mockLog.trigger_data).toHaveProperty('action_type');\n        expect(mockLog.trigger_data).toHaveProperty('action_config');\n    });\n});\n\ndescribe('Edge Functions', () => {\n    beforeEach(() => {\n        vi.clearAllMocks();\n    });\n\n    it('should invoke send-email function', async () => {\n        const result = await mockSupabaseClient.functions.invoke('send-email', {\n            body: {\n                to: 'test@example.com',\n                subject: 'Test Email',\n                html: '<p>Hello World</p>',\n            },\n        });\n        expect(result.error).toBeNull();\n        expect(result.data).toEqual({ success: true });\n    });\n\n    it('should invoke ai-screen-resume function', async () => {\n        const result = await mockSupabaseClient.functions.invoke('ai-screen-resume', {\n            body: {\n                application_id: 'app-1',\n            },\n        });\n        expect(result.error).toBeNull();\n    });\n\n    it('should invoke send-interview-invite function', async () => {\n        const result = await mockSupabaseClient.functions.invoke('send-interview-invite', {\n            body: {\n                candidateName: 'John Doe',\n                candidateEmail: 'john@example.com',\n                interviewType: 'technical',\n                scheduledDate: '2024-02-01',\n                scheduledTime: '14:00',\n                duration: 60,\n                location: 'https://meet.google.com/xyz',\n            },\n        });\n        expect(result.error).toBeNull();\n    });\n});\n\ndescribe('Authentication', () => {\n    beforeEach(() => {\n        vi.clearAllMocks();\n    });\n\n    it('should get current user', async () => {\n        const result = await mockSupabaseClient.auth.getUser();\n        expect(result.data.user).toBeDefined();\n        expect(result.data.user.id).toBe('user-1');\n    });\n\n    it('should sign out', async () => {\n        const result = await mockSupabaseClient.auth.signOut();\n        expect(result.error).toBeNull();\n    });\n});\n\ndescribe('Data Validation Utilities', () => {\n    describe('Email Validation', () => {\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n\n        it('should validate correct email formats', () => {\n            expect(emailRegex.test('user@example.com')).toBe(true);\n            expect(emailRegex.test('user.name@company.co.uk')).toBe(true);\n            expect(emailRegex.test('user+tag@example.org')).toBe(true);\n        });\n\n        it('should reject invalid email formats', () => {\n            expect(emailRegex.test('invalid')).toBe(false);\n            expect(emailRegex.test('invalid@')).toBe(false);\n            expect(emailRegex.test('@example.com')).toBe(false);\n            expect(emailRegex.test('user@.com')).toBe(false);\n        });\n    });\n\n    describe('Phone Validation', () => {\n        const phoneRegex = /^\\+?[\\d\\s-()]{10,}$/;\n\n        it('should validate correct phone formats', () => {\n            expect(phoneRegex.test('+447123456789')).toBe(true);\n            expect(phoneRegex.test('07123456789')).toBe(true);\n            expect(phoneRegex.test('+1 (555) 123-4567')).toBe(true);\n        });\n    });\n\n    describe('Date Range Validation', () => {\n        it('should validate date ranges', () => {\n            const isValidDateRange = (start: string, end: string) => {\n                return new Date(end).getTime() >= new Date(start).getTime();\n            };\n\n            expect(isValidDateRange('2024-01-01', '2024-12-31')).toBe(true);\n            expect(isValidDateRange('2024-01-01', '2024-01-01')).toBe(true);\n            expect(isValidDateRange('2024-12-31', '2024-01-01')).toBe(false);\n        });\n    });\n\n    describe('Percentage Validation', () => {\n        it('should validate percentage values', () => {\n            const isValidPercentage = (value: number) => value >= 0 && value <= 100;\n\n            expect(isValidPercentage(0)).toBe(true);\n            expect(isValidPercentage(50)).toBe(true);\n            expect(isValidPercentage(100)).toBe(true);\n            expect(isValidPercentage(-1)).toBe(false);\n            expect(isValidPercentage(101)).toBe(false);\n        });\n    });\n\n    describe('Currency Validation', () => {\n        it('should validate currency codes', () => {\n            const validCurrencies = ['GBP', 'USD', 'EUR', 'CAD', 'AUD'];\n            expect(validCurrencies).toContain('GBP');\n            expect(validCurrencies).toContain('USD');\n        });\n\n        it('should validate currency amounts', () => {\n            const isValidAmount = (amount: number) => amount >= 0 && Number.isFinite(amount);\n\n            expect(isValidAmount(99.99)).toBe(true);\n            expect(isValidAmount(0)).toBe(true);\n            expect(isValidAmount(-1)).toBe(false);\n            expect(isValidAmount(Infinity)).toBe(false);\n        });\n    });\n});\n\ndescribe('Integration Tests', () => {\n    beforeEach(() => {\n        vi.clearAllMocks();\n    });\n\n    describe('Recruitment Workflow', () => {\n        it('should complete full recruitment workflow', async () => {\n            // 1. Create job\n            const job = mockJob;\n            expect(job.status).toBe('open');\n\n            // 2. Receive application\n            const application = mockApplication;\n            expect(application.job_posting_id).toBe(job.id);\n\n            // 3. AI Screen resume\n            expect(application.ai_score).toBeGreaterThanOrEqual(0);\n\n            // 4. Schedule interview\n            const interview = mockInterview;\n            expect(interview.application_id).toBe(application.id);\n\n            // 5. Complete compliance checks\n            const dbs = mockDBSCheck;\n            expect(dbs.status).toBe('completed');\n\n            const reference = mockReference;\n            expect(reference.status).toBe('verified');\n        });\n    });\n\n    describe('Employee Onboarding Workflow', () => {\n        it('should complete employee onboarding', () => {\n            // 1. Create employee record\n            const employee = mockEmployee;\n            expect(employee.is_active).toBe(true);\n\n            // 2. Complete mandatory training\n            const training = mockTrainingRecord;\n            expect(training.assessment_passed).toBe(true);\n\n            // 3. Upload documents\n            const document = mockDocument;\n            expect(document.category).toBe('contracts');\n\n            // 4. Set up initial goals\n            const goal = mockGoal;\n            expect(goal.employee_id).toBe(employee.id);\n        });\n    });\n\n    describe('Performance Review Workflow', () => {\n        it('should complete performance review cycle', () => {\n            // 1. Create review\n            const review = mockPerformanceReview;\n            expect(review.status).toBe('in_progress');\n\n            // 2. Track goals\n            const goal = mockGoal;\n            expect(goal.progress_percentage).toBeLessThan(100);\n\n            // 3. Employee exists for review\n            const employee = mockEmployee;\n            expect(review.employee_id).toBe(employee.id);\n        });\n    });\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/aiScreening.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/analyticsEngine.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'candidateProfile' is defined but never used. Allowed unused args must match /^_/u.","line":419,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":419,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'jobRequirements' is defined but never used. Allowed unused args must match /^_/u.","line":419,"column":53,"nodeType":null,"messageId":"unusedVar","endLine":419,"endColumn":68}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Advanced Analytics & Business Intelligence Engine\n * Predictive analytics, workforce forecasting, performance optimization\n * Provides data-driven insights to prevent 6-figure hiring mistakes\n */\n\nexport interface HRMetrics {\n  timeToHire: {\n    average_days: number;\n    by_department: { department: string; days: number }[];\n    by_position: { position: string; days: number }[];\n    trend: 'improving' | 'declining' | 'stable';\n  };\n  costPerHire: {\n    average_cost: number;\n    breakdown: { category: string; cost: number }[];\n    roi_analysis: { investment: number; value: number; roi_percentage: number };\n  };\n  employeeRetention: {\n    overall_rate: number;\n    by_department: { department: string; rate: number }[];\n    turnover_cost: number;\n    predicted_turnover: { employee_id: string; risk_score: number; factors: string[] }[];\n  };\n  recruitmentEfficiency: {\n    applications_per_hire: number;\n    interview_to_offer_ratio: number;\n    offer_acceptance_rate: number;\n    source_effectiveness: { source: string; hire_rate: number; cost: number }[];\n  };\n  performanceCorrelations: {\n    hiring_source_vs_performance: { source: string; avg_performance: number }[];\n    interview_score_vs_performance: { correlation: number; reliability: string };\n    education_vs_performance: { level: string; avg_performance: number }[];\n  };\n}\n\nexport interface WorkforceForecast {\n  hiring_needs: {\n    department: string;\n    current_headcount: number;\n    projected_need: number;\n    timeline: string;\n    confidence: number;\n  }[];\n  budget_projection: {\n    current_cost: number;\n    projected_cost: number;\n    savings_opportunities: { area: string; potential_savings: number }[];\n  };\n  skill_gaps: {\n    skill: string;\n    current_level: number;\n    required_level: number;\n    gap_severity: 'low' | 'medium' | 'high' | 'critical';\n    training_recommendation: string;\n  }[];\n  succession_planning: {\n    position: string;\n    current_holder: string;\n    ready_successors: string[];\n    development_needed: string[];\n  }[];\n}\n\nexport interface PerformanceInsights {\n  top_performer_traits: {\n    trait: string;\n    correlation_strength: number;\n    description: string;\n  }[];\n  engagement_factors: {\n    factor: string;\n    impact_score: number;\n    actionable_insights: string[];\n  }[];\n  retention_strategies: {\n    risk_level: 'high' | 'medium' | 'low';\n    recommended_actions: string[];\n    expected_impact: number;\n  }[];\n}\n\nexport class AnalyticsEngine {\n  private historicalData: any[] = [];\n  private metrics: HRMetrics | null = null;\n\n  constructor() {\n    this.initializeSampleData();\n  }\n\n  private initializeSampleData() {\n    // This would normally come from your database\n    this.historicalData = [\n      {\n        date: '2024-01-01',\n        hires: 12,\n        applications: 240,\n        interviews: 48,\n        offers: 15,\n        cost_breakdown: { advertising: 5000, recruiter: 8000, tools: 2000 }\n      },\n      // More historical data...\n    ];\n  }\n\n  async generateExecutiveDashboard(): Promise<{\n    metrics: HRMetrics;\n    forecast: WorkforceForecast;\n    insights: PerformanceInsights;\n    recommendations: string[];\n  }> {\n    const metrics = await this.calculateMetrics();\n    const forecast = await this.generateForecast();\n    const insights = await this.generatePerformanceInsights();\n    const recommendations = this.generateRecommendations(metrics, forecast, insights);\n\n    return { metrics, forecast, insights, recommendations };\n  }\n\n  private async calculateMetrics(): Promise<HRMetrics> {\n    // Time to Hire Analysis\n    const timeToHire = {\n      average_days: 28,\n      by_department: [\n        { department: 'Engineering', days: 32 },\n        { department: 'Sales', days: 24 },\n        { department: 'Marketing', days: 26 },\n        { department: 'HR', days: 30 }\n      ],\n      by_position: [\n        { position: 'Senior Developer', days: 35 },\n        { position: 'Sales Rep', days: 22 },\n        { position: 'Marketing Manager', days: 28 }\n      ],\n      trend: 'improving' as const\n    };\n\n    // Cost per Hire Analysis\n    const costPerHire = {\n      average_cost: 4500,\n      breakdown: [\n        { category: 'Job Advertising', cost: 1500 },\n        { category: 'Recruiter Fees', cost: 2000 },\n        { category: 'Tools & Platforms', cost: 500 },\n        { category: 'Interview Process', cost: 500 }\n      ],\n      roi_analysis: { investment: 4500, value: 65000, roi_percentage: 1344 }\n    };\n\n    // Employee Retention Analysis\n    const employeeRetention = {\n      overall_rate: 87,\n      by_department: [\n        { department: 'Engineering', rate: 92 },\n        { department: 'Sales', rate: 78 },\n        { department: 'Marketing', rate: 85 },\n        { department: 'HR', rate: 94 }\n      ],\n      turnover_cost: 15000,\n      predicted_turnover: [\n        { employee_id: 'emp_001', risk_score: 0.8, factors: ['Low engagement', 'Salary below market', 'Limited growth'] },\n        { employee_id: 'emp_045', risk_score: 0.6, factors: ['Work-life balance concerns', 'Role mismatch'] }\n      ]\n    };\n\n    // Recruitment Efficiency\n    const recruitmentEfficiency = {\n      applications_per_hire: 20,\n      interview_to_offer_ratio: 0.31,\n      offer_acceptance_rate: 0.8,\n      source_effectiveness: [\n        { source: 'LinkedIn', hire_rate: 0.12, cost: 150 },\n        { source: 'Company Website', hire_rate: 0.18, cost: 50 },\n        { source: 'Referrals', hire_rate: 0.35, cost: 500 },\n        { source: 'Job Boards', hire_rate: 0.08, cost: 200 }\n      ]\n    };\n\n    // Performance Correlations\n    const performanceCorrelations = {\n      hiring_source_vs_performance: [\n        { source: 'Referrals', avg_performance: 4.2 },\n        { source: 'LinkedIn', avg_performance: 3.8 },\n        { source: 'Company Website', avg_performance: 3.9 },\n        { source: 'Job Boards', avg_performance: 3.4 }\n      ],\n      interview_score_vs_performance: { correlation: 0.73, reliability: 'High' },\n      education_vs_performance: [\n        { level: 'Bachelor', avg_performance: 3.7 },\n        { level: 'Master', avg_performance: 3.9 },\n        { level: 'PhD', avg_performance: 4.1 }\n      ]\n    };\n\n    return {\n      timeToHire,\n      costPerHire,\n      employeeRetention,\n      recruitmentEfficiency,\n      performanceCorrelations\n    };\n  }\n\n  private async generateForecast(): Promise<WorkforceForecast> {\n    const hiring_needs = [\n      {\n        department: 'Engineering',\n        current_headcount: 25,\n        projected_need: 8,\n        timeline: 'Next 6 months',\n        confidence: 0.85\n      },\n      {\n        department: 'Sales',\n        current_headcount: 15,\n        projected_need: 5,\n        timeline: 'Next 3 months',\n        confidence: 0.9\n      },\n      {\n        department: 'Marketing',\n        current_headcount: 8,\n        projected_need: 2,\n        timeline: 'Next 4 months',\n        confidence: 0.75\n      }\n    ];\n\n    const budget_projection = {\n      current_cost: 2400000, // Annual salary cost\n      projected_cost: 2850000,\n      savings_opportunities: [\n        { area: 'Referral program expansion', potential_savings: 25000 },\n        { area: 'Recruitment automation', potential_savings: 35000 },\n        { area: 'Retention improvements', potential_savings: 150000 }\n      ]\n    };\n\n    const skill_gaps = [\n      {\n        skill: 'Machine Learning',\n        current_level: 6,\n        required_level: 8,\n        gap_severity: 'high' as const,\n        training_recommendation: 'Advanced ML certification program'\n      },\n      {\n        skill: 'Cloud Architecture',\n        current_level: 7,\n        required_level: 9,\n        gap_severity: 'medium' as const,\n        training_recommendation: 'AWS/Azure architect certification'\n      },\n      {\n        skill: 'Data Analytics',\n        current_level: 5,\n        required_level: 7,\n        gap_severity: 'medium' as const,\n        training_recommendation: 'Data science bootcamp'\n      }\n    ];\n\n    const succession_planning = [\n      {\n        position: 'VP Engineering',\n        current_holder: 'John Smith',\n        ready_successors: ['Sarah Chen', 'Mike Johnson'],\n        development_needed: ['Leadership training', 'Business strategy']\n      },\n      {\n        position: 'Sales Director',\n        current_holder: 'Lisa Wang',\n        ready_successors: ['Tom Brown'],\n        development_needed: ['Team management', 'Strategic planning']\n      }\n    ];\n\n    return { hiring_needs, budget_projection, skill_gaps, succession_planning };\n  }\n\n  private async generatePerformanceInsights(): Promise<PerformanceInsights> {\n    const top_performer_traits = [\n      {\n        trait: 'Continuous Learning',\n        correlation_strength: 0.82,\n        description: 'Top performers spend 20% more time on skill development'\n      },\n      {\n        trait: 'Cross-functional Collaboration',\n        correlation_strength: 0.76,\n        description: 'High performers work with 3+ departments regularly'\n      },\n      {\n        trait: 'Proactive Communication',\n        correlation_strength: 0.71,\n        description: 'Top performers provide regular status updates without prompting'\n      }\n    ];\n\n    const engagement_factors = [\n      {\n        factor: 'Career Growth Opportunities',\n        impact_score: 9.2,\n        actionable_insights: [\n          'Create individual development plans',\n          'Implement mentorship programs',\n          'Offer stretch assignments'\n        ]\n      },\n      {\n        factor: 'Work-Life Balance',\n        impact_score: 8.8,\n        actionable_insights: [\n          'Flexible working arrangements',\n          'Mental health support',\n          'Vacation encouragement programs'\n        ]\n      },\n      {\n        factor: 'Recognition and Feedback',\n        impact_score: 8.5,\n        actionable_insights: [\n          'Implement peer recognition system',\n          'Regular one-on-one meetings',\n          'Public achievement celebrations'\n        ]\n      }\n    ];\n\n    const retention_strategies = [\n      {\n        risk_level: 'high' as const,\n        recommended_actions: [\n          'Immediate salary review and adjustment',\n          'Emergency retention bonus',\n          'Career path discussion',\n          'Role modification to match interests'\n        ],\n        expected_impact: 0.7\n      },\n      {\n        risk_level: 'medium' as const,\n        recommended_actions: [\n          'Enhanced professional development budget',\n          'Flexible work arrangements',\n          'Project variety increase',\n          'Mentorship opportunities'\n        ],\n        expected_impact: 0.5\n      }\n    ];\n\n    return { top_performer_traits, engagement_factors, retention_strategies };\n  }\n\n  private generateRecommendations(\n    metrics: HRMetrics,\n    forecast: WorkforceForecast,\n    insights: PerformanceInsights\n  ): string[] {\n    const recommendations = [];\n\n    // Time to hire recommendations\n    if (metrics.timeToHire.average_days > 30) {\n      recommendations.push('ð Implement AI screening to reduce time-to-hire by 40%');\n    }\n\n    // Cost optimization\n    if (metrics.costPerHire.average_cost > 4000) {\n      recommendations.push('ð° Focus on referral program - highest ROI recruitment source');\n    }\n\n    // Retention improvements\n    if (metrics.employeeRetention.overall_rate < 90) {\n      recommendations.push('ð¯ Address top turnover factors: career growth and compensation');\n    }\n\n    // Workforce planning\n    const criticalGaps = forecast.skill_gaps.filter(g => g.gap_severity === 'critical' || g.gap_severity === 'high');\n    if (criticalGaps.length > 0) {\n      recommendations.push(`ð Priority training needed for: ${criticalGaps.map(g => g.skill).join(', ')}`);\n    }\n\n    // Performance optimization\n    if (insights.top_performer_traits.length > 0) {\n      recommendations.push('â­ Hire for continuous learning mindset - strongest predictor of success');\n    }\n\n    // Budget optimization\n    const potentialSavings = forecast.budget_projection.savings_opportunities.reduce((sum, opp) => sum + opp.potential_savings, 0);\n    if (potentialSavings > 50000) {\n      recommendations.push(`ð¡ Potential annual savings of $${potentialSavings.toLocaleString()} through process improvements`);\n    }\n\n    return recommendations.slice(0, 6); // Top 6 recommendations\n  }\n\n  // Real-time analytics for dashboards\n  async getRealTimeMetrics(): Promise<{\n    active_jobs: number;\n    pending_interviews: number;\n    applications_today: number;\n    offers_pending: number;\n    automation_savings_today: number;\n    top_alert: string;\n  }> {\n    return {\n      active_jobs: 12,\n      pending_interviews: 8,\n      applications_today: 15,\n      offers_pending: 3,\n      automation_savings_today: 8.5, // hours saved\n      top_alert: 'â ï¸ 2 high-risk employees need retention action'\n    };\n  }\n\n  // Predictive analytics for specific scenarios\n  async predictHiringSuccess(candidateProfile: any, jobRequirements: any): Promise<{\n    success_probability: number;\n    risk_factors: string[];\n    success_factors: string[];\n    recommendation: string;\n  }> {\n    // This would use ML models in production\n    const success_probability = Math.random() * 0.4 + 0.6; // Mock 60-100% range\n    \n    return {\n      success_probability: Math.round(success_probability * 100),\n      risk_factors: ['Limited industry experience', 'Salary expectations above budget'],\n      success_factors: ['Strong technical skills', 'Excellent cultural fit', 'Growth mindset'],\n      recommendation: success_probability > 0.8 ? 'Strong hire - proceed with offer' : \n                    success_probability > 0.6 ? 'Good candidate - additional interview recommended' :\n                    'Proceed with caution - consider alternatives'\n    };\n  }\n\n  // Compliance risk assessment\n  async assessComplianceRisk(): Promise<{\n    overall_risk: 'low' | 'medium' | 'high';\n    risk_areas: { area: string; risk_level: string; action_required: string }[];\n    next_review_date: string;\n  }> {\n    return {\n      overall_risk: 'low',\n      risk_areas: [\n        {\n          area: 'Visa Documentation',\n          risk_level: 'medium',\n          action_required: '3 employees need visa renewal in next 60 days'\n        },\n        {\n          area: 'Training Certifications',\n          risk_level: 'low',\n          action_required: 'Safety training due for 5 employees next quarter'\n        }\n      ],\n      next_review_date: '2024-02-15'\n    };\n  }\n}\n\n// Singleton instance\nexport const analyticsEngine = new AnalyticsEngine();","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/businessIntelligence.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'initiative' is defined but never used. Allowed unused args must match /^_/u.","line":300,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":300,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Advanced Business Intelligence & Predictive Analytics Engine\n * Strategic workforce planning, cost optimization, performance insights\n * Prevents 6-figure hiring mistakes and optimizes business operations\n */\n\nexport interface BusinessMetrics {\n  roi_analysis: {\n    hr_investment: number;\n    cost_savings: number;\n    productivity_gains: number;\n    net_roi_percentage: number;\n    payback_period_months: number;\n  };\n  cost_optimization: {\n    current_hr_costs: number;\n    optimized_costs: number;\n    potential_savings: number;\n    optimization_areas: { area: string; savings: number; effort: string }[];\n  };\n  strategic_insights: {\n    market_position: string;\n    talent_competitiveness: number;\n    growth_readiness: number;\n    risk_factors: string[];\n    opportunities: string[];\n  };\n  predictive_forecasts: {\n    headcount_projection: { month: string; projected: number; confidence: number }[];\n    budget_forecast: { category: string; current: number; projected: number; variance: number }[];\n    turnover_predictions: { department: string; risk_level: string; predicted_turnover: number }[];\n  };\n}\n\nexport interface CompetitiveIntelligence {\n  market_benchmarks: {\n    avg_time_to_hire: number;\n    avg_cost_per_hire: number;\n    industry_retention_rate: number;\n    salary_competitiveness: number;\n  };\n  talent_market: {\n    demand_trends: { skill: string; demand_growth: number; supply_scarcity: number }[];\n    salary_trends: { position: string; market_rate: number; your_rate: number; gap: number }[];\n    competitor_analysis: { company: string; strengths: string[]; weaknesses: string[] }[];\n  };\n}\n\nexport interface StrategicRecommendations {\n  immediate_actions: { priority: 'high' | 'medium' | 'low'; action: string; impact: string; effort: string }[];\n  quarterly_goals: { goal: string; metrics: string[]; timeline: string }[];\n  annual_strategy: { initiative: string; budget_required: number; expected_roi: number }[];\n}\n\nexport class BusinessIntelligenceEngine {\n  private marketData: any = {};\n  private historicalTrends: any[] = [];\n\n  constructor() {\n    this.initializeMarketData();\n    this.initializeHistoricalTrends();\n  }\n\n  private initializeMarketData() {\n    this.marketData = {\n      industry_averages: {\n        time_to_hire: 31,\n        cost_per_hire: 4800,\n        retention_rate: 83,\n        employee_satisfaction: 7.2\n      },\n      salary_benchmarks: {\n        'Software Engineer': { min: 75000, max: 120000, avg: 95000 },\n        'Product Manager': { min: 85000, max: 140000, avg: 110000 },\n        'Data Scientist': { min: 80000, max: 130000, avg: 105000 },\n        'UX Designer': { min: 65000, max: 100000, avg: 80000 },\n        'Marketing Manager': { min: 70000, max: 115000, avg: 90000 }\n      },\n      skill_demand: {\n        'React': { demand_growth: 0.15, supply_scarcity: 0.7 },\n        'Python': { demand_growth: 0.12, supply_scarcity: 0.6 },\n        'AWS': { demand_growth: 0.20, supply_scarcity: 0.8 },\n        'Machine Learning': { demand_growth: 0.25, supply_scarcity: 0.9 },\n        'DevOps': { demand_growth: 0.18, supply_scarcity: 0.75 }\n      }\n    };\n  }\n\n  private initializeHistoricalTrends() {\n    this.historicalTrends = [\n      { month: '2024-01', hires: 12, cost: 54000, retention: 88 },\n      { month: '2024-02', hires: 8, cost: 38400, retention: 85 },\n      { month: '2024-03', hires: 15, cost: 67500, retention: 90 },\n      // More historical data would be loaded from database\n    ];\n  }\n\n  async generateBusinessIntelligence(): Promise<{\n    metrics: BusinessMetrics;\n    competitive: CompetitiveIntelligence;\n    recommendations: StrategicRecommendations;\n  }> {\n    const metrics = await this.calculateBusinessMetrics();\n    const competitive = await this.generateCompetitiveIntelligence();\n    const recommendations = await this.generateStrategicRecommendations();\n\n    return { metrics, competitive, recommendations };\n  }\n\n  private async calculateBusinessMetrics(): Promise<BusinessMetrics> {\n    // ROI Analysis\n    const roi_analysis = {\n      hr_investment: 150000, // Annual HR platform investment\n      cost_savings: 234000, // Annual savings from automation\n      productivity_gains: 180000, // Value of time savings\n      net_roi_percentage: 176, // (234000 + 180000 - 150000) / 150000 * 100\n      payback_period_months: 4.3 // Time to recover investment\n    };\n\n    // Cost Optimization\n    const cost_optimization = {\n      current_hr_costs: 480000,\n      optimized_costs: 345000,\n      potential_savings: 135000,\n      optimization_areas: [\n        { area: 'Recruitment Process Automation', savings: 45000, effort: 'Low' },\n        { area: 'Onboarding Digitization', savings: 28000, effort: 'Medium' },\n        { area: 'Performance Review Streamlining', savings: 32000, effort: 'Medium' },\n        { area: 'Compliance Automation', savings: 18000, effort: 'Low' },\n        { area: 'Data Integration Efficiency', savings: 12000, effort: 'High' }\n      ]\n    };\n\n    // Strategic Insights\n    const strategic_insights = {\n      market_position: 'Above Average',\n      talent_competitiveness: 0.78, // Score out of 1\n      growth_readiness: 0.85,\n      risk_factors: [\n        'Competitive talent market for technical roles',\n        'Rising salary expectations in key positions',\n        'Remote work expectations affecting location strategy'\n      ],\n      opportunities: [\n        'AI-powered recruitment for faster hiring',\n        'Skills-based hiring to expand talent pool',\n        'Employee referral program optimization',\n        'Predictive analytics for retention improvement'\n      ]\n    };\n\n    // Predictive Forecasts\n    const predictive_forecasts = {\n      headcount_projection: [\n        { month: '2024-02', projected: 105, confidence: 0.92 },\n        { month: '2024-03', projected: 112, confidence: 0.88 },\n        { month: '2024-04', projected: 118, confidence: 0.85 },\n        { month: '2024-05', projected: 125, confidence: 0.82 },\n        { month: '2024-06', projected: 130, confidence: 0.78 }\n      ],\n      budget_forecast: [\n        { category: 'Salaries', current: 2400000, projected: 2760000, variance: 0.15 },\n        { category: 'Benefits', current: 480000, projected: 528000, variance: 0.10 },\n        { category: 'Recruitment', current: 120000, projected: 96000, variance: -0.20 },\n        { category: 'Training', current: 80000, projected: 88000, variance: 0.10 },\n        { category: 'Tools & Systems', current: 60000, projected: 54000, variance: -0.10 }\n      ],\n      turnover_predictions: [\n        { department: 'Engineering', risk_level: 'Medium', predicted_turnover: 0.12 },\n        { department: 'Sales', risk_level: 'High', predicted_turnover: 0.18 },\n        { department: 'Marketing', risk_level: 'Low', predicted_turnover: 0.08 },\n        { department: 'Operations', risk_level: 'Medium', predicted_turnover: 0.10 }\n      ]\n    };\n\n    return { roi_analysis, cost_optimization, strategic_insights, predictive_forecasts };\n  }\n\n  private async generateCompetitiveIntelligence(): Promise<CompetitiveIntelligence> {\n    const market_benchmarks = {\n      avg_time_to_hire: this.marketData.industry_averages.time_to_hire,\n      avg_cost_per_hire: this.marketData.industry_averages.cost_per_hire,\n      industry_retention_rate: this.marketData.industry_averages.retention_rate,\n      salary_competitiveness: 0.92 // Your salaries vs market average\n    };\n\n    const talent_market = {\n      demand_trends: Object.entries(this.marketData.skill_demand).map(([skill, data]: [string, any]) => ({\n        skill,\n        demand_growth: data.demand_growth,\n        supply_scarcity: data.supply_scarcity\n      })),\n      salary_trends: Object.entries(this.marketData.salary_benchmarks).map(([position, data]: [string, any]) => ({\n        position,\n        market_rate: data.avg,\n        your_rate: data.avg * 0.92, // Assuming 8% below market\n        gap: (data.avg * 0.08) / data.avg\n      })),\n      competitor_analysis: [\n        {\n          company: 'TechCorp',\n          strengths: ['Higher salaries', 'Stock options', 'Remote-first culture'],\n          weaknesses: ['Slower hiring process', 'Limited career growth', 'Poor work-life balance']\n        },\n        {\n          company: 'InnovateLab',\n          strengths: ['Cutting-edge projects', 'Learning opportunities', 'Flexible schedules'],\n          weaknesses: ['Lower compensation', 'Startup uncertainty', 'Limited benefits']\n        }\n      ]\n    };\n\n    return { market_benchmarks, talent_market };\n  }\n\n  private async generateStrategicRecommendations(): Promise<StrategicRecommendations> {\n    const immediate_actions = [\n      {\n        priority: 'high' as const,\n        action: 'Implement AI resume screening for technical roles',\n        impact: '50% reduction in screening time, faster hiring for critical positions',\n        effort: 'Medium'\n      },\n      {\n        priority: 'high' as const,\n        action: 'Launch employee referral bonus program',\n        impact: '30% increase in quality hires, reduced cost per hire',\n        effort: 'Low'\n      },\n      {\n        priority: 'medium' as const,\n        action: 'Automate onboarding document generation',\n        impact: 'Save 5 hours per new hire, improved experience',\n        effort: 'Medium'\n      },\n      {\n        priority: 'medium' as const,\n        action: 'Implement predictive turnover alerts',\n        impact: 'Proactive retention, prevent costly departures',\n        effort: 'High'\n      },\n      {\n        priority: 'low' as const,\n        action: 'Optimize interview scheduling automation',\n        impact: 'Reduce coordination time by 60%',\n        effort: 'Low'\n      }\n    ];\n\n    const quarterly_goals = [\n      {\n        goal: 'Reduce average time-to-hire to 21 days',\n        metrics: ['Time from job posting to offer acceptance', 'Interview-to-decision time'],\n        timeline: 'Q2 2024'\n      },\n      {\n        goal: 'Achieve 90% employee retention rate',\n        metrics: ['Department retention rates', 'Exit interview feedback scores'],\n        timeline: 'Q2 2024'\n      },\n      {\n        goal: 'Implement comprehensive workforce analytics',\n        metrics: ['Dashboard utilization', 'Data-driven hiring decisions'],\n        timeline: 'Q3 2024'\n      },\n      {\n        goal: 'Launch skills-based hiring initiative',\n        metrics: ['Skills assessment adoption', 'Hire quality scores'],\n        timeline: 'Q3 2024'\n      }\n    ];\n\n    const annual_strategy = [\n      {\n        initiative: 'AI-Powered Talent Acquisition Platform',\n        budget_required: 75000,\n        expected_roi: 2.8\n      },\n      {\n        initiative: 'Employee Experience Optimization Program',\n        budget_required: 120000,\n        expected_roi: 3.2\n      },\n      {\n        initiative: 'Predictive Workforce Planning System',\n        budget_required: 95000,\n        expected_roi: 4.1\n      },\n      {\n        initiative: 'Integrated Learning & Development Platform',\n        budget_required: 150000,\n        expected_roi: 2.5\n      }\n    ];\n\n    return { immediate_actions, quarterly_goals, annual_strategy };\n  }\n\n  // Generate cost-benefit analysis for specific initiatives\n  async analyzeCostBenefit(initiative: string): Promise<{\n    costs: { category: string; amount: number; timeline: string }[];\n    benefits: { category: string; amount: number; timeline: string }[];\n    net_present_value: number;\n    break_even_months: number;\n    risk_factors: string[];\n  }> {\n    // This would be customized based on the specific initiative\n    return {\n      costs: [\n        { category: 'Software License', amount: 25000, timeline: 'Annual' },\n        { category: 'Implementation', amount: 40000, timeline: 'One-time' },\n        { category: 'Training', amount: 10000, timeline: 'One-time' }\n      ],\n      benefits: [\n        { category: 'Time Savings', amount: 85000, timeline: 'Annual' },\n        { category: 'Quality Improvement', amount: 45000, timeline: 'Annual' },\n        { category: 'Cost Reduction', amount: 30000, timeline: 'Annual' }\n      ],\n      net_present_value: 125000,\n      break_even_months: 7,\n      risk_factors: [\n        'User adoption challenges',\n        'Integration complexity',\n        'Market changes affecting ROI'\n      ]\n    };\n  }\n\n  // Generate executive summary report\n  async generateExecutiveSummary(): Promise<{\n    key_insights: string[];\n    financial_impact: { metric: string; value: string; trend: 'up' | 'down' | 'stable' }[];\n    strategic_priorities: string[];\n    next_actions: string[];\n  }> {\n    return {\n      key_insights: [\n        'HR automation has delivered 176% ROI in first year of implementation',\n        'Time-to-hire reduced by 35% through AI-powered screening and workflow automation',\n        'Employee retention improved to 87% through predictive analytics and proactive interventions',\n        'Annual cost savings of $234,000 achieved through process optimization and integration',\n        'Talent competitiveness score of 78% positions company well for growth phase'\n      ],\n      financial_impact: [\n        { metric: 'Cost per Hire', value: '$4,500', trend: 'down' },\n        { metric: 'HR Process Efficiency', value: '85%', trend: 'up' },\n        { metric: 'Employee Retention', value: '87%', trend: 'up' },\n        { metric: 'Time to Productivity', value: '23 days', trend: 'down' },\n        { metric: 'Automation Savings', value: '$234K', trend: 'up' }\n      ],\n      strategic_priorities: [\n        'Scale AI-powered recruitment to all departments',\n        'Implement comprehensive workforce planning system',\n        'Launch skills-based hiring initiative',\n        'Develop predictive turnover prevention program',\n        'Optimize employee experience through data insights'\n      ],\n      next_actions: [\n        'Approve budget for AI talent acquisition platform ($75K investment)',\n        'Launch Q2 employee referral program expansion',\n        'Implement predictive analytics for high-risk employee identification',\n        'Begin skills assessment integration for technical roles',\n        'Establish workforce planning committee for strategic growth'\n      ]\n    };\n  }\n\n  // Real-time business alerts\n  getBusinessAlerts(): {\n    critical: string[];\n    warnings: string[];\n    opportunities: string[];\n  } {\n    return {\n      critical: [\n        'â ï¸ Sales department turnover risk increased to 18% - immediate intervention needed',\n        'ð¨ Time-to-hire for senior engineers exceeded 45 days - process review required'\n      ],\n      warnings: [\n        'â¡ Q2 hiring budget 78% utilized with 2 months remaining',\n        'ð Employee satisfaction scores dropped 0.3 points in engineering'\n      ],\n      opportunities: [\n        'ð¯ Referral program generated 3 qualified candidates this week - expand program',\n        'ð¡ AI screening identified 2 exceptional candidates outside normal criteria',\n        'ð Market salary data suggests 15% competitive advantage in current offers'\n      ]\n    };\n  }\n}\n\n// Singleton instance\nexport const businessIntelligence = new BusinessIntelligenceEngine();","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/competencies/competencyTypes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/compliance/AutomatedWorkflowEngine.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'COMPLIANCE_AUTOMATIONS' is defined but never used. Allowed unused vars must match /^_/u.","line":15,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ComplianceAuthority' is defined but never used. Allowed unused vars must match /^_/u.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ComplianceStage' is defined but never used. Allowed unused vars must match /^_/u.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Automated Compliance Workflow Engine\n * \n * Handles all automated compliance processes:\n * - Document expiry monitoring and alerts\n * - Automatic stage progression\n * - Reference chasing\n * - Training renewal scheduling\n * - Escalation procedures\n * - Bulk processing of compliance tasks\n */\n\nimport { supabase } from '../supabase';\nimport {\n  COMPLIANCE_AUTOMATIONS,\n  ComplianceAuthority,\n  ComplianceStage,\n  UrgencyLevel\n} from './complianceTypes';\nimport { complianceService } from './ComplianceService';\nimport { log } from '../logger';\n\n// ===========================================\n// TYPES\n// ===========================================\n\nexport interface WorkflowTask {\n  id: string;\n  type: WorkflowTaskType;\n  entityId: string;\n  entityType: string;\n  tenantId: string;\n  urgency: UrgencyLevel;\n  status: 'pending' | 'in_progress' | 'completed' | 'failed' | 'cancelled';\n  scheduledAt: Date;\n  executedAt?: Date;\n  result?: any;\n  error?: string;\n  retryCount: number;\n  maxRetries: number;\n}\n\nexport type WorkflowTaskType =\n  | 'expiry_check'\n  | 'expiry_reminder'\n  | 'stage_progression'\n  | 'reference_chase'\n  | 'training_renewal'\n  | 'rtw_annual_check'\n  | 'compliance_score_update'\n  | 'sync_to_careflow'\n  | 'bulk_notification'\n  | 'escalation';\n\nexport interface WorkflowRule {\n  id: string;\n  name: string;\n  description: string;\n  triggerType: string;\n  conditions: WorkflowCondition[];\n  actions: WorkflowAction[];\n  isActive: boolean;\n  priority: number;\n}\n\nexport interface WorkflowCondition {\n  field: string;\n  operator: 'eq' | 'neq' | 'gt' | 'lt' | 'gte' | 'lte' | 'in' | 'contains';\n  value: any;\n}\n\nexport interface WorkflowAction {\n  type: string;\n  config: Record<string, any>;\n}\n\nexport interface WorkflowExecution {\n  id: string;\n  ruleId: string;\n  tenantId: string;\n  triggeredAt: Date;\n  completedAt?: Date;\n  status: 'running' | 'completed' | 'failed';\n  actionsExecuted: number;\n  errors?: string[];\n}\n\n// ===========================================\n// WORKFLOW ENGINE\n// ===========================================\n\nclass AutomatedWorkflowEngine {\n  private taskQueue: WorkflowTask[] = [];\n  private isProcessing: boolean = false;\n  private intervalIds: NodeJS.Timer[] = [];\n\n  // =========================================\n  // INITIALIZATION\n  // =========================================\n\n  /**\n   * Start all automated workflows\n   */\n  start(): void {\n    log.info('Starting Automated Workflow Engine...', { component: 'AutomatedWorkflowEngine', action: 'start' });\n\n    // Daily expiry check at 6 AM\n    this.scheduleRecurring('expiry_check', () => this.runExpiryChecks(), {\n      hour: 6,\n      minute: 0\n    });\n\n    // Hourly reference chase check\n    this.scheduleRecurring('reference_chase', () => this.runReferenceChasers(), {\n      minute: 30 // Every hour at 30 minutes past\n    });\n\n    // Real-time queue processing\n    this.intervalIds.push(\n      setInterval(() => this.processQueue(), 5000) // Every 5 seconds\n    );\n\n    log.info('Workflow Engine started successfully', { component: 'AutomatedWorkflowEngine', action: 'start' });\n  }\n\n  /**\n   * Stop all automated workflows\n   */\n  stop(): void {\n    this.intervalIds = [];\n    this.isProcessing = false;\n    log.info('Workflow Engine stopped', { component: 'AutomatedWorkflowEngine', action: 'stop' });\n  }\n\n  /**\n   * Schedule a recurring task\n   */\n  private scheduleRecurring(\n    name: string,\n    fn: () => Promise<void>,\n    schedule: { hour?: number; minute?: number }\n  ): void {\n    const checkAndRun = () => {\n      const now = new Date();\n      if (\n        (schedule.hour === undefined || now.getHours() === schedule.hour) &&\n        (schedule.minute === undefined || now.getMinutes() === schedule.minute)\n      ) {\n        fn().catch(err => log.error(`Scheduled task ${name} failed`, err, { component: 'AutomatedWorkflowEngine', action: 'scheduleRecurring', metadata: { name } }));\n      }\n    };\n\n    // Check every minute\n    this.intervalIds.push(setInterval(checkAndRun, 60000));\n  }\n\n  // =========================================\n  // EXPIRY MANAGEMENT\n  // =========================================\n\n  /**\n   * Run expiry checks for all documents\n   */\n  async runExpiryChecks(): Promise<{ processed: number; expired: number; reminded: number }> {\n    log.info('Running expiry checks...', { component: 'AutomatedWorkflowEngine', action: 'runExpiryChecks' });\n    const startTime = performance.now();\n    let processed = 0;\n    let expired = 0;\n    let reminded = 0;\n\n    try {\n      // Get all documents with expiry dates\n      const { data: documents, error } = await supabase\n        .from('compliance_documents')\n        .select('*, compliance_persons(*)')\n        .eq('is_current', true)\n        .not('expiry_date', 'is', null);\n\n      if (error || !documents) {\n        log.error('Failed to fetch documents for expiry check', error, { component: 'AutomatedWorkflowEngine', action: 'runExpiryChecks' });\n        return { processed: 0, expired: 0, reminded: 0 };\n      }\n\n      const now = new Date();\n\n      for (const doc of documents) {\n        processed++;\n        const expiryDate = new Date(doc.expiry_date);\n        const daysUntilExpiry = Math.floor((expiryDate.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));\n\n        // Handle expired documents\n        if (daysUntilExpiry < 0 && doc.status !== 'EXPIRED') {\n          await this.handleExpiredDocument(doc);\n          expired++;\n        }\n        // Handle expiring soon\n        else if (daysUntilExpiry <= 30 && doc.status === 'VERIFIED') {\n          await this.handleExpiringDocument(doc, daysUntilExpiry);\n          reminded++;\n        }\n      }\n\n      const duration = performance.now() - startTime;\n      log.info(`Expiry check complete: ${processed} processed, ${expired} expired, ${reminded} reminded`, { component: 'AutomatedWorkflowEngine', action: 'runExpiryChecks', metadata: { processed, expired, reminded } });\n      log.performance('runExpiryChecks', duration, { component: 'AutomatedWorkflowEngine' });\n      return { processed, expired, reminded };\n    } catch (error) {\n      log.error('Expiry check failed', error, { component: 'AutomatedWorkflowEngine', action: 'runExpiryChecks' });\n      return { processed, expired, reminded };\n    }\n  }\n\n  /**\n   * Handle an expired document\n   */\n  private async handleExpiredDocument(document: any): Promise<void> {\n    // Update document status\n    await supabase\n      .from('compliance_documents')\n      .update({ status: 'EXPIRED', updated_at: new Date().toISOString() })\n      .eq('id', document.id);\n\n    // Update checklist\n    await supabase\n      .from('compliance_checklists')\n      .update({ status: 'EXPIRED', updated_at: new Date().toISOString() })\n      .eq('document_id', document.id);\n\n    // Create urgent task\n    await this.createTask({\n      type: 'escalation',\n      entityId: document.id,\n      entityType: 'compliance_documents',\n      tenantId: document.tenant_id,\n      urgency: 'CRITICAL',\n      scheduledAt: new Date()\n    });\n\n    // Send notifications\n    await this.sendNotifications({\n      tenantId: document.tenant_id,\n      personId: document.person_id,\n      type: 'DOCUMENT_EXPIRED',\n      urgency: 'CRITICAL',\n      title: 'Document Expired - Immediate Action Required',\n      message: `${document.file_name} has expired. This person may no longer be compliant to work.`,\n      recipients: ['employee', 'hr_manager', 'compliance_officer', 'registered_manager']\n    });\n\n    // Recalculate compliance score\n    await complianceService.recalculateComplianceScore(document.person_id);\n  }\n\n  /**\n   * Handle a document that is expiring soon\n   */\n  private async handleExpiringDocument(document: any, daysUntilExpiry: number): Promise<void> {\n    // Determine urgency level\n    let urgency: UrgencyLevel = 'LOW';\n    if (daysUntilExpiry <= 7) urgency = 'HIGH';\n    else if (daysUntilExpiry <= 14) urgency = 'MEDIUM';\n\n    // Update status if not already expiring_soon\n    if (document.status !== 'EXPIRING_SOON') {\n      await supabase\n        .from('compliance_documents')\n        .update({ status: 'EXPIRING_SOON', updated_at: new Date().toISOString() })\n        .eq('id', document.id);\n    }\n\n    // Check if reminder already sent today\n    const { data: existingReminder } = await supabase\n      .from('compliance_notifications')\n      .select('id')\n      .eq('document_id', document.id)\n      .eq('notification_type', 'EXPIRY_REMINDER')\n      .gte('created_at', new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString())\n      .single();\n\n    if (!existingReminder) {\n      // Send reminder based on days until expiry\n      const recipients = daysUntilExpiry <= 7\n        ? ['employee', 'hr_manager', 'compliance_officer']\n        : ['employee', 'hr_manager'];\n\n      await this.sendNotifications({\n        tenantId: document.tenant_id,\n        personId: document.person_id,\n        documentId: document.id,\n        type: 'EXPIRY_REMINDER',\n        urgency,\n        title: `Document Expiring in ${daysUntilExpiry} Days`,\n        message: `${document.file_name} will expire on ${document.expiry_date}. Please upload a renewed document.`,\n        recipients\n      });\n    }\n  }\n\n  // =========================================\n  // REFERENCE CHASING\n  // =========================================\n\n  /**\n   * Run reference chaser for pending references\n   */\n  async runReferenceChasers(): Promise<{ chased: number }> {\n    log.info('Running reference chasers...', { component: 'AutomatedWorkflowEngine', action: 'runReferenceChasers' });\n    const startTime = performance.now();\n    let chased = 0;\n\n    try {\n      // Get pending reference requests\n      const { data: pendingRefs, error } = await supabase\n        .from('compliance_checklists')\n        .select('*, compliance_persons(*)')\n        .eq('document_type_id', 'employment_references')\n        .eq('status', 'PENDING')\n        .eq('is_applicable', true);\n\n      if (error || !pendingRefs) {\n        return { chased: 0 };\n      }\n\n      const now = new Date();\n\n      for (const ref of pendingRefs) {\n        const createdAt = new Date(ref.created_at);\n        const daysSinceCreated = Math.floor((now.getTime() - createdAt.getTime()) / (1000 * 60 * 60 * 24));\n\n        // Chase after 3 days\n        if (daysSinceCreated >= 3 && daysSinceCreated < 7) {\n          await this.sendReferenceChaser(ref, 'first');\n          chased++;\n        }\n        // Chase again after 7 days\n        else if (daysSinceCreated >= 7 && daysSinceCreated < 14) {\n          await this.sendReferenceChaser(ref, 'second');\n          chased++;\n        }\n        // Escalate after 14 days\n        else if (daysSinceCreated >= 14) {\n          await this.escalateReference(ref);\n          chased++;\n        }\n      }\n\n      const duration = performance.now() - startTime;\n      log.info(`Reference chase complete: ${chased} chased`, { component: 'AutomatedWorkflowEngine', action: 'runReferenceChasers', metadata: { chased } });\n      log.performance('runReferenceChasers', duration, { component: 'AutomatedWorkflowEngine' });\n      return { chased };\n    } catch (error) {\n      log.error('Reference chase failed', error, { component: 'AutomatedWorkflowEngine', action: 'runReferenceChasers' });\n      return { chased: 0 };\n    }\n  }\n\n  /**\n   * Send reference chase email\n   */\n  private async sendReferenceChaser(ref: any, chaseType: 'first' | 'second'): Promise<void> {\n    const recipients = chaseType === 'first'\n      ? ['referee']\n      : ['referee', 'applicant'];\n\n    await this.sendNotifications({\n      tenantId: ref.tenant_id,\n      personId: ref.person_id,\n      type: 'REFERENCE_CHASE',\n      urgency: chaseType === 'second' ? 'HIGH' : 'MEDIUM',\n      title: `Reference Request Follow-up`,\n      message: `We are still awaiting references for ${ref.compliance_persons?.full_name}. Please respond at your earliest convenience.`,\n      recipients\n    });\n  }\n\n  /**\n   * Escalate reference that has not been received\n   */\n  private async escalateReference(ref: any): Promise<void> {\n    await this.createTask({\n      type: 'escalation',\n      entityId: ref.id,\n      entityType: 'compliance_checklists',\n      tenantId: ref.tenant_id,\n      urgency: 'HIGH',\n      scheduledAt: new Date()\n    });\n\n    await this.sendNotifications({\n      tenantId: ref.tenant_id,\n      personId: ref.person_id,\n      type: 'REFERENCE_ESCALATION',\n      urgency: 'HIGH',\n      title: 'Reference Escalation Required',\n      message: `References for ${ref.compliance_persons?.full_name} have not been received after 14 days. Alternative referees may be required.`,\n      recipients: ['hr_manager', 'compliance_officer']\n    });\n  }\n\n  // =========================================\n  // TRAINING RENEWALS\n  // =========================================\n\n  /**\n   * Process training renewal reminders\n   */\n  async processTrainingRenewals(): Promise<{ scheduled: number }> {\n    log.info('Processing training renewals...', { component: 'AutomatedWorkflowEngine', action: 'processTrainingRenewals' });\n    const startTime = performance.now();\n    let scheduled = 0;\n\n    try {\n      // Get training documents expiring in 30 days\n      const { data: expiringTraining, error } = await supabase\n        .from('compliance_documents')\n        .select('*, compliance_persons(*)')\n        .eq('document_type_id', 'mandatory_training')\n        .eq('is_current', true)\n        .lte('expiry_date', new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString())\n        .gte('expiry_date', new Date().toISOString());\n\n      if (error || !expiringTraining) {\n        return { scheduled: 0 };\n      }\n\n      for (const training of expiringTraining) {\n        // Create training renewal task\n        await this.createTask({\n          type: 'training_renewal',\n          entityId: training.id,\n          entityType: 'compliance_documents',\n          tenantId: training.tenant_id,\n          urgency: 'MEDIUM',\n          scheduledAt: new Date()\n        });\n\n        // Send notification\n        await this.sendNotifications({\n          tenantId: training.tenant_id,\n          personId: training.person_id,\n          documentId: training.id,\n          type: 'TRAINING_RENEWAL',\n          urgency: 'MEDIUM',\n          title: 'Training Renewal Required',\n          message: `Your ${training.extracted_data?.trainingType || 'mandatory training'} certificate will expire soon. Please complete the refresher course.`,\n          recipients: ['employee', 'hr_manager']\n        });\n\n        scheduled++;\n      }\n\n      const duration = performance.now() - startTime;\n      log.info(`Training renewals processed: ${scheduled} scheduled`, { component: 'AutomatedWorkflowEngine', action: 'processTrainingRenewals', metadata: { scheduled } });\n      log.performance('processTrainingRenewals', duration, { component: 'AutomatedWorkflowEngine' });\n      return { scheduled };\n    } catch (error) {\n      log.error('Training renewal processing failed', error, { component: 'AutomatedWorkflowEngine', action: 'processTrainingRenewals' });\n      return { scheduled: 0 };\n    }\n  }\n\n  // =========================================\n  // STAGE PROGRESSION\n  // =========================================\n\n  /**\n   * Check and progress stages for all persons\n   */\n  async checkStageProgressions(tenantId: string): Promise<{ progressed: number }> {\n    log.info('Checking stage progressions...', { component: 'AutomatedWorkflowEngine', action: 'checkStageProgressions', metadata: { tenantId } });\n    const startTime = performance.now();\n    let progressed = 0;\n\n    try {\n      // Get all persons who might be ready for progression\n      const { data: persons, error } = await supabase\n        .from('compliance_persons')\n        .select('id, current_stage')\n        .eq('tenant_id', tenantId)\n        .neq('current_stage', 'ONGOING')\n        .neq('current_stage', 'OFFBOARDING');\n\n      if (error || !persons) {\n        return { progressed: 0 };\n      }\n\n      for (const person of persons) {\n        const result = await complianceService.progressToNextStage(person.id);\n        if (result.success) {\n          progressed++;\n\n          // Send notification about stage progression\n          await this.sendNotifications({\n            tenantId,\n            personId: person.id,\n            type: 'STAGE_PROGRESSION',\n            urgency: 'LOW',\n            title: 'Compliance Stage Advanced',\n            message: `Congratulations! All requirements for ${person.current_stage} have been met. Moving to ${result.newStage}.`,\n            recipients: ['employee', 'hr_manager']\n          });\n        }\n      }\n\n      const duration = performance.now() - startTime;\n      log.info(`Stage progressions: ${progressed} advanced`, { component: 'AutomatedWorkflowEngine', action: 'checkStageProgressions', metadata: { progressed } });\n      log.performance('checkStageProgressions', duration, { component: 'AutomatedWorkflowEngine' });\n      return { progressed };\n    } catch (error) {\n      log.error('Stage progression check failed', error, { component: 'AutomatedWorkflowEngine', action: 'checkStageProgressions' });\n      return { progressed: 0 };\n    }\n  }\n\n  // =========================================\n  // RTW ANNUAL CHECKS\n  // =========================================\n\n  /**\n   * Process annual Right to Work checks for limited leave employees\n   */\n  async processRTWAnnualChecks(): Promise<{ checked: number }> {\n    log.info('Processing RTW annual checks...', { component: 'AutomatedWorkflowEngine', action: 'processRTWAnnualChecks' });\n    const startTime = performance.now();\n    let checked = 0;\n\n    try {\n      // Get employees with limited leave to remain\n      const { data: employees, error } = await supabase\n        .from('compliance_persons')\n        .select('*')\n        .eq('person_type', 'EMPLOYEE')\n        .eq('has_indefinite_leave', false)\n        .not('visa_type', 'is', null);\n\n      if (error || !employees) {\n        return { checked: 0 };\n      }\n\n      const oneYearAgo = new Date(Date.now() - 365 * 24 * 60 * 60 * 1000);\n\n      for (const employee of employees) {\n        // Check if annual check is due\n        const lastCheck = await this.getLastRTWCheck(employee.id);\n\n        if (!lastCheck || new Date(lastCheck.created_at) < oneYearAgo) {\n          // Create RTW check task\n          await this.createTask({\n            type: 'rtw_annual_check',\n            entityId: employee.id,\n            entityType: 'compliance_persons',\n            tenantId: employee.tenant_id,\n            urgency: 'HIGH',\n            scheduledAt: new Date()\n          });\n\n          // Send notification\n          await this.sendNotifications({\n            tenantId: employee.tenant_id,\n            personId: employee.id,\n            type: 'RTW_ANNUAL_CHECK',\n            urgency: 'HIGH',\n            title: 'Annual Right to Work Check Due',\n            message: `Annual RTW verification is required for ${employee.full_name}. Please complete the check and update records.`,\n            recipients: ['hr_manager', 'compliance_officer']\n          });\n\n          checked++;\n        }\n      }\n\n      const duration = performance.now() - startTime;\n      log.info(`RTW annual checks: ${checked} due`, { component: 'AutomatedWorkflowEngine', action: 'processRTWAnnualChecks', metadata: { checked } });\n      log.performance('processRTWAnnualChecks', duration, { component: 'AutomatedWorkflowEngine' });\n      return { checked };\n    } catch (error) {\n      log.error('RTW annual check failed', error, { component: 'AutomatedWorkflowEngine', action: 'processRTWAnnualChecks' });\n      return { checked: 0 };\n    }\n  }\n\n  private async getLastRTWCheck(personId: string): Promise<any> {\n    const { data } = await supabase\n      .from('compliance_audit_log')\n      .select('*')\n      .eq('entity_id', personId)\n      .eq('action', 'RTW_CHECK_COMPLETED')\n      .order('created_at', { ascending: false })\n      .limit(1)\n      .single();\n\n    return data;\n  }\n\n  // =========================================\n  // ESCALATION\n  // =========================================\n\n  /**\n   * Process escalations for overdue tasks\n   */\n  async processEscalations(): Promise<{ escalated: number }> {\n    log.info('Processing escalations...', { component: 'AutomatedWorkflowEngine', action: 'processEscalations' });\n    const startTime = performance.now();\n    let escalated = 0;\n\n    try {\n      // Get overdue tasks\n      const { data: overdueTasks, error } = await supabase\n        .from('compliance_tasks')\n        .select('*')\n        .eq('status', 'PENDING')\n        .lt('due_date', new Date().toISOString());\n\n      if (error || !overdueTasks) {\n        return { escalated: 0 };\n      }\n\n      for (const task of overdueTasks) {\n        // Escalate based on how overdue\n        const dueDate = new Date(task.due_date);\n        const daysOverdue = Math.floor((Date.now() - dueDate.getTime()) / (1000 * 60 * 60 * 24));\n\n        let newUrgency = task.urgency;\n        if (daysOverdue >= 7) {\n          newUrgency = 'CRITICAL';\n        } else if (daysOverdue >= 3) {\n          newUrgency = task.urgency === 'LOW' ? 'MEDIUM' : 'HIGH';\n        }\n\n        if (newUrgency !== task.urgency) {\n          // Update task urgency\n          await supabase\n            .from('compliance_tasks')\n            .update({ urgency: newUrgency })\n            .eq('id', task.id);\n\n          // Send escalation notification\n          await this.sendNotifications({\n            tenantId: task.tenant_id,\n            personId: task.person_id || undefined,\n            type: 'TASK_ESCALATION',\n            urgency: newUrgency,\n            title: `Task Escalated: ${task.title}`,\n            message: `This task is ${daysOverdue} days overdue and has been escalated to ${newUrgency} priority.`,\n            recipients: ['hr_manager', 'compliance_officer', 'registered_manager']\n          });\n\n          escalated++;\n        }\n      }\n\n      const duration = performance.now() - startTime;\n      log.info(`Escalations processed: ${escalated}`, { component: 'AutomatedWorkflowEngine', action: 'processEscalations', metadata: { escalated } });\n      log.performance('processEscalations', duration, { component: 'AutomatedWorkflowEngine' });\n      return { escalated };\n    } catch (error) {\n      log.error('Escalation processing failed', error, { component: 'AutomatedWorkflowEngine', action: 'processEscalations' });\n      return { escalated: 0 };\n    }\n  }\n\n  // =========================================\n  // QUEUE MANAGEMENT\n  // =========================================\n\n  /**\n   * Create a workflow task\n   */\n  async createTask(task: Omit<WorkflowTask, 'id' | 'status' | 'retryCount' | 'maxRetries'>): Promise<WorkflowTask> {\n    const newTask: WorkflowTask = {\n      ...task,\n      id: crypto.randomUUID(),\n      status: 'pending',\n      retryCount: 0,\n      maxRetries: 3\n    };\n\n    this.taskQueue.push(newTask);\n    return newTask;\n  }\n\n  /**\n   * Process the task queue\n   */\n  private async processQueue(): Promise<void> {\n    if (this.isProcessing || this.taskQueue.length === 0) return;\n\n    this.isProcessing = true;\n\n    try {\n      const task = this.taskQueue.shift();\n      if (!task) return;\n\n      task.status = 'in_progress';\n\n      try {\n        const result = await this.executeTask(task);\n        task.status = 'completed';\n        task.result = result;\n        task.executedAt = new Date();\n      } catch (error) {\n        task.retryCount++;\n        task.error = String(error);\n\n        if (task.retryCount < task.maxRetries) {\n          task.status = 'pending';\n          this.taskQueue.push(task);\n        } else {\n          task.status = 'failed';\n        }\n      }\n    } finally {\n      this.isProcessing = false;\n    }\n  }\n\n  /**\n   * Execute a workflow task\n   */\n  private async executeTask(task: WorkflowTask): Promise<any> {\n    switch (task.type) {\n      case 'expiry_check':\n        return this.runExpiryChecks();\n      case 'reference_chase':\n        return this.runReferenceChasers();\n      case 'training_renewal':\n        return this.processTrainingRenewals();\n      case 'compliance_score_update':\n        return complianceService.recalculateComplianceScore(task.entityId);\n      case 'stage_progression':\n        return complianceService.progressToNextStage(task.entityId);\n      default:\n        log.warn(`Unknown task type: ${task.type}`, { component: 'AutomatedWorkflowEngine', action: 'executeTask' });\n        return null;\n    }\n  }\n\n  // =========================================\n  // NOTIFICATIONS\n  // =========================================\n\n  /**\n   * Send notifications to specified recipients\n   */\n  private async sendNotifications(params: {\n    tenantId: string;\n    personId?: string;\n    documentId?: string;\n    type: string;\n    urgency: UrgencyLevel;\n    title: string;\n    message: string;\n    recipients: string[];\n  }): Promise<void> {\n    try {\n      // Create notification record\n      await supabase.from('compliance_notifications').insert({\n        tenant_id: params.tenantId,\n        person_id: params.personId,\n        document_id: params.documentId,\n        notification_type: params.type,\n        urgency: params.urgency,\n        title: params.title,\n        message: params.message,\n        recipients: params.recipients.map(r => ({ role: r })),\n        sent_at: new Date().toISOString(),\n        in_app_sent: true\n      });\n\n      // In production, this would also trigger:\n      // - Email notifications via integration service\n      // - SMS for critical alerts\n      // - Push notifications for mobile app\n\n    } catch (error) {\n      log.error('Failed to send notification', error, { component: 'AutomatedWorkflowEngine', action: 'sendNotifications' });\n    }\n  }\n\n  // =========================================\n  // REPORTING\n  // =========================================\n\n  /**\n   * Get workflow status and statistics\n   */\n  async getWorkflowStatus(): Promise<{\n    queueLength: number;\n    processing: boolean;\n    recentTasks: WorkflowTask[];\n    statistics: {\n      completed: number;\n      failed: number;\n      pending: number;\n    };\n  }> {\n    return {\n      queueLength: this.taskQueue.length,\n      processing: this.isProcessing,\n      recentTasks: this.taskQueue.slice(0, 10),\n      statistics: {\n        completed: 0, // Would query from database in production\n        failed: 0,\n        pending: this.taskQueue.filter(t => t.status === 'pending').length\n      }\n    };\n  }\n\n  /**\n   * Run all workflows manually (for testing/admin)\n   */\n  async runAllWorkflows(tenantId: string): Promise<{\n    expiryChecks: { processed: number; expired: number; reminded: number };\n    referenceChase: { chased: number };\n    trainingRenewals: { scheduled: number };\n    stageProgressions: { progressed: number };\n    escalations: { escalated: number };\n  }> {\n    log.info('Running all workflows manually...', { component: 'AutomatedWorkflowEngine', action: 'runAllWorkflows', metadata: { tenantId } });\n\n    const results = {\n      expiryChecks: await this.runExpiryChecks(),\n      referenceChase: await this.runReferenceChasers(),\n      trainingRenewals: await this.processTrainingRenewals(),\n      stageProgressions: await this.checkStageProgressions(tenantId),\n      escalations: await this.processEscalations()\n    };\n\n    log.info('All workflows complete', { component: 'AutomatedWorkflowEngine', action: 'runAllWorkflows', metadata: { results } });\n    return results;\n  }\n}\n\n// Export singleton instance\nexport const automatedWorkflowEngine = new AutomatedWorkflowEngine();\nexport default automatedWorkflowEngine;\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/compliance/ComplianceReportGenerator.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ALL_COMPLIANCE_DOCUMENTS' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CQC_DOCUMENTS' is defined but never used. Allowed unused vars must match /^_/u.","line":15,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SHARED_DOCUMENTS' is defined but never used. Allowed unused vars must match /^_/u.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ComplianceStage' is defined but never used. Allowed unused vars must match /^_/u.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'documents' is defined but never used. Allowed unused args must match /^_/u.","line":169,"column":53,"nodeType":null,"messageId":"unusedVar","endLine":169,"endColumn":62},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'byNationality' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":170,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":170,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'persons' is defined but never used. Allowed unused args must match /^_/u.","line":557,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":557,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'documents' is defined but never used. Allowed unused args must match /^_/u.","line":575,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":575,"endColumn":59},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'documents' is defined but never used. Allowed unused args must match /^_/u.","line":607,"column":51,"nodeType":null,"messageId":"unusedVar","endLine":607,"endColumn":60},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'training' is defined but never used. Allowed unused args must match /^_/u.","line":607,"column":69,"nodeType":null,"messageId":"unusedVar","endLine":607,"endColumn":77},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'d' is defined but never used. Allowed unused args must match /^_/u.","line":667,"column":60,"nodeType":null,"messageId":"unusedVar","endLine":667,"endColumn":61}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Compliance Report Generator\n * \n * Generates audit-ready compliance reports for:\n * - Home Office inspections (Right to Work)\n * - CQC inspections (Care Quality)\n * - Internal audits\n * - Management dashboards\n */\n\nimport { supabase } from '../supabase';\nimport { \n  ALL_COMPLIANCE_DOCUMENTS,\n  HOME_OFFICE_DOCUMENTS,\n  CQC_DOCUMENTS,\n  SHARED_DOCUMENTS,\n  ComplianceAuthority,\n  ComplianceStage\n} from './complianceTypes';\n\n// ===========================================\n// TYPES\n// ===========================================\n\nexport interface ComplianceReport {\n  id: string;\n  type: ReportType;\n  generatedAt: string;\n  generatedBy: string;\n  tenantId: string;\n  period?: { start: string; end: string };\n  summary: ReportSummary;\n  sections: ReportSection[];\n  metadata: ReportMetadata;\n}\n\nexport type ReportType = \n  | 'home_office_audit'\n  | 'cqc_inspection'\n  | 'internal_audit'\n  | 'management_summary'\n  | 'individual_compliance'\n  | 'expiry_forecast'\n  | 'compliance_trends';\n\nexport interface ReportSummary {\n  title: string;\n  overallScore: number;\n  totalStaff: number;\n  compliantCount: number;\n  atRiskCount: number;\n  nonCompliantCount: number;\n  criticalIssues: string[];\n  keyFindings: string[];\n  recommendations: string[];\n}\n\nexport interface ReportSection {\n  title: string;\n  description?: string;\n  authority?: ComplianceAuthority;\n  data: ReportData;\n  charts?: ChartData[];\n  tables?: TableData[];\n  highlights?: string[];\n  issues?: ReportIssue[];\n}\n\nexport interface ReportData {\n  [key: string]: any;\n}\n\nexport interface ChartData {\n  type: 'pie' | 'bar' | 'line' | 'donut';\n  title: string;\n  data: { label: string; value: number; color?: string }[];\n}\n\nexport interface TableData {\n  title: string;\n  headers: string[];\n  rows: string[][];\n  totals?: string[];\n}\n\nexport interface ReportIssue {\n  severity: 'critical' | 'high' | 'medium' | 'low';\n  description: string;\n  affectedPersons?: string[];\n  recommendation?: string;\n  dueDate?: string;\n}\n\nexport interface ReportMetadata {\n  version: string;\n  format: 'pdf' | 'excel' | 'html' | 'json';\n  confidentiality: 'public' | 'internal' | 'confidential' | 'restricted';\n  retentionPeriod: string;\n  approvalRequired: boolean;\n}\n\n// ===========================================\n// REPORT GENERATOR\n// ===========================================\n\nclass ComplianceReportGenerator {\n  \n  // =========================================\n  // HOME OFFICE AUDIT REPORT\n  // =========================================\n\n  /**\n   * Generate comprehensive Home Office audit report\n   */\n  async generateHomeOfficeAuditReport(tenantId: string): Promise<ComplianceReport> {\n    const reportId = crypto.randomUUID();\n    const generatedAt = new Date().toISOString();\n\n    // Get all data\n    const persons = await this.getPersonsData(tenantId);\n    const documents = await this.getDocumentsByAuthority(tenantId, 'HOME_OFFICE');\n    const rtwChecks = await this.getRTWCheckHistory(tenantId);\n\n    // Calculate statistics\n    const stats = this.calculateHomeOfficeStats(persons, documents);\n\n    // Build sections\n    const sections: ReportSection[] = [\n      this.buildRTWComplianceSummary(persons, documents),\n      this.buildRTWDocumentationSection(documents),\n      this.buildSponsorComplianceSection(persons),\n      this.buildRTWCheckHistorySection(rtwChecks),\n      this.buildHomeOfficeIssuesSection(persons, documents)\n    ];\n\n    return {\n      id: reportId,\n      type: 'home_office_audit',\n      generatedAt,\n      generatedBy: 'system',\n      tenantId,\n      summary: {\n        title: 'Home Office Right to Work Audit Report',\n        overallScore: stats.complianceScore,\n        totalStaff: stats.totalStaff,\n        compliantCount: stats.compliant,\n        atRiskCount: stats.atRisk,\n        nonCompliantCount: stats.nonCompliant,\n        criticalIssues: stats.criticalIssues,\n        keyFindings: [\n          `${stats.compliant} employees have valid RTW documentation`,\n          `${stats.expiringSoon} visas/permits expiring in next 90 days`,\n          `${stats.sponsoredWorkers} sponsored workers on record`,\n          `${stats.rtwChecksOverdue} RTW checks overdue`\n        ],\n        recommendations: this.generateHomeOfficeRecommendations(stats)\n      },\n      sections,\n      metadata: {\n        version: '1.0',\n        format: 'json',\n        confidentiality: 'confidential',\n        retentionPeriod: '6 years', // Home Office requirement\n        approvalRequired: true\n      }\n    };\n  }\n\n  private buildRTWComplianceSummary(persons: any[], documents: any[]): ReportSection {\n    const byNationality = this.groupBy(persons, 'nationality');\n    const byVisaType = persons.filter(p => p.visa_type).reduce((acc, p) => {\n      acc[p.visa_type] = (acc[p.visa_type] || 0) + 1;\n      return acc;\n    }, {} as Record<string, number>);\n\n    return {\n      title: 'Right to Work Compliance Summary',\n      authority: 'HOME_OFFICE',\n      description: 'Overview of workforce right to work status',\n      data: {\n        totalWorkforce: persons.length,\n        ukNationals: persons.filter(p => ['British', 'Irish'].includes(p.nationality)).length,\n        requiresVisa: persons.filter(p => p.visa_type).length,\n        indefiniteLeave: persons.filter(p => p.has_indefinite_leave).length\n      },\n      charts: [\n        {\n          type: 'pie',\n          title: 'Workforce by Immigration Status',\n          data: [\n            { label: 'UK/Irish Nationals', value: persons.filter(p => ['British', 'Irish'].includes(p.nationality)).length, color: '#10b981' },\n            { label: 'Settled Status', value: persons.filter(p => p.has_indefinite_leave).length, color: '#3b82f6' },\n            { label: 'Visa Holders', value: persons.filter(p => p.visa_type && !p.has_indefinite_leave).length, color: '#f59e0b' }\n          ]\n        }\n      ],\n      tables: [\n        {\n          title: 'Visa Types Distribution',\n          headers: ['Visa Type', 'Count', '% of Workforce'],\n          rows: Object.entries(byVisaType).map(([type, count]) => [\n            type,\n            String(count),\n            `${((count as number / persons.length) * 100).toFixed(1)}%`\n          ])\n        }\n      ]\n    };\n  }\n\n  private buildRTWDocumentationSection(documents: any[]): ReportSection {\n    const byType = this.groupBy(documents, 'document_type_id');\n    const byStatus = this.groupBy(documents, 'status');\n\n    return {\n      title: 'RTW Documentation Status',\n      authority: 'HOME_OFFICE',\n      data: {\n        totalDocuments: documents.length,\n        verified: byStatus['VERIFIED']?.length || 0,\n        pending: byStatus['PENDING']?.length || 0,\n        expired: byStatus['EXPIRED']?.length || 0,\n        expiringSoon: byStatus['EXPIRING_SOON']?.length || 0\n      },\n      tables: [\n        {\n          title: 'Document Status Summary',\n          headers: ['Document Type', 'Total', 'Verified', 'Pending', 'Expired'],\n          rows: Object.entries(byType).map(([type, docs]) => {\n            const docList = docs as any[];\n            return [\n              HOME_OFFICE_DOCUMENTS[type as keyof typeof HOME_OFFICE_DOCUMENTS]?.name || type,\n              String(docList.length),\n              String(docList.filter(d => d.status === 'VERIFIED').length),\n              String(docList.filter(d => d.status === 'PENDING').length),\n              String(docList.filter(d => d.status === 'EXPIRED').length)\n            ];\n          })\n        }\n      ],\n      issues: documents\n        .filter(d => d.status === 'EXPIRED')\n        .map(d => ({\n          severity: 'critical' as const,\n          description: `Expired ${d.document_type_id} for ${d.compliance_persons?.full_name}`,\n          affectedPersons: [d.compliance_persons?.full_name],\n          recommendation: 'Immediate renewal required'\n        }))\n    };\n  }\n\n  private buildSponsorComplianceSection(persons: any[]): ReportSection {\n    const sponsored = persons.filter(p => \n      p.visa_type && ['Skilled Worker', 'Tier 2', 'Health and Care'].some(t => \n        p.visa_type.toLowerCase().includes(t.toLowerCase())\n      )\n    );\n\n    return {\n      title: 'Sponsor Licence Compliance',\n      authority: 'HOME_OFFICE',\n      description: 'Sponsored worker monitoring and compliance',\n      data: {\n        totalSponsored: sponsored.length,\n        activeAssignments: sponsored.filter(p => p.person_type === 'EMPLOYEE').length,\n        pendingStarters: sponsored.filter(p => p.person_type === 'CANDIDATE').length\n      },\n      tables: [\n        {\n          title: 'Sponsored Workers',\n          headers: ['Name', 'Visa Type', 'CoS Expiry', 'Status'],\n          rows: sponsored.map(p => [\n            p.full_name,\n            p.visa_type,\n            p.visa_expiry_date || 'N/A',\n            p.compliance_status\n          ])\n        }\n      ],\n      highlights: [\n        `${sponsored.length} workers currently sponsored`,\n        'All CoS records maintained',\n        'Reporting duties up to date'\n      ]\n    };\n  }\n\n  private buildRTWCheckHistorySection(checks: any[]): ReportSection {\n    return {\n      title: 'RTW Check History',\n      authority: 'HOME_OFFICE',\n      description: 'Record of all right to work verifications',\n      data: {\n        totalChecks: checks.length,\n        last30Days: checks.filter(c => \n          new Date(c.created_at) > new Date(Date.now() - 30 * 24 * 60 * 60 * 1000)\n        ).length,\n        manualChecks: checks.filter(c => c.check_type === 'manual').length,\n        onlineChecks: checks.filter(c => c.check_type === 'online').length\n      },\n      tables: [\n        {\n          title: 'Recent RTW Checks',\n          headers: ['Date', 'Employee', 'Check Type', 'Result', 'Verified By'],\n          rows: checks.slice(0, 20).map(c => [\n            new Date(c.created_at).toLocaleDateString(),\n            c.full_name,\n            c.check_type,\n            c.result,\n            c.verified_by\n          ])\n        }\n      ]\n    };\n  }\n\n  private buildHomeOfficeIssuesSection(persons: any[], documents: any[]): ReportSection {\n    const issues: ReportIssue[] = [];\n\n    // Check for expired documents\n    documents\n      .filter(d => d.status === 'EXPIRED')\n      .forEach(d => {\n        issues.push({\n          severity: 'critical',\n          description: `Expired RTW document: ${d.document_type_id}`,\n          affectedPersons: [d.compliance_persons?.full_name],\n          recommendation: 'Immediate action required - employee may not be legally permitted to work'\n        });\n      });\n\n    // Check for expiring visas\n    persons\n      .filter(p => p.visa_expiry_date)\n      .forEach(p => {\n        const daysUntil = Math.floor((new Date(p.visa_expiry_date).getTime() - Date.now()) / (1000 * 60 * 60 * 24));\n        if (daysUntil <= 30 && daysUntil > 0) {\n          issues.push({\n            severity: daysUntil <= 7 ? 'critical' : 'high',\n            description: `Visa expiring in ${daysUntil} days`,\n            affectedPersons: [p.full_name],\n            recommendation: 'Initiate visa extension process',\n            dueDate: p.visa_expiry_date\n          });\n        }\n      });\n\n    return {\n      title: 'Identified Issues & Action Items',\n      authority: 'HOME_OFFICE',\n      data: {\n        criticalCount: issues.filter(i => i.severity === 'critical').length,\n        highCount: issues.filter(i => i.severity === 'high').length,\n        mediumCount: issues.filter(i => i.severity === 'medium').length\n      },\n      issues\n    };\n  }\n\n  private calculateHomeOfficeStats(persons: any[], documents: any[]) {\n    const nonCompliant = persons.filter(p => p.compliance_status === 'NON_COMPLIANT');\n    const atRisk = persons.filter(p => p.compliance_status === 'AT_RISK');\n    const compliant = persons.filter(p => p.compliance_status === 'COMPLIANT');\n\n    return {\n      totalStaff: persons.length,\n      compliant: compliant.length,\n      atRisk: atRisk.length,\n      nonCompliant: nonCompliant.length,\n      complianceScore: persons.length > 0 \n        ? Math.round((compliant.length / persons.length) * 100)\n        : 0,\n      expiringSoon: documents.filter(d => d.status === 'EXPIRING_SOON').length,\n      sponsoredWorkers: persons.filter(p => p.visa_type?.includes('Skilled') || p.visa_type?.includes('Tier')).length,\n      rtwChecksOverdue: 0, // Would be calculated from RTW check schedule\n      criticalIssues: [\n        ...nonCompliant.map(p => `${p.full_name}: Non-compliant RTW status`),\n        ...documents.filter(d => d.status === 'EXPIRED').map(d => `Expired document: ${d.document_type_id}`)\n      ].slice(0, 5)\n    };\n  }\n\n  private generateHomeOfficeRecommendations(stats: any): string[] {\n    const recommendations: string[] = [];\n\n    if (stats.nonCompliant > 0) {\n      recommendations.push('URGENT: Address non-compliant employees immediately');\n    }\n    if (stats.expiringSoon > 5) {\n      recommendations.push('Schedule bulk visa/document renewal process');\n    }\n    if (stats.rtwChecksOverdue > 0) {\n      recommendations.push('Complete overdue RTW verification checks');\n    }\n    recommendations.push('Maintain 6-year document retention policy');\n    recommendations.push('Schedule quarterly compliance audits');\n\n    return recommendations;\n  }\n\n  // =========================================\n  // CQC INSPECTION REPORT\n  // =========================================\n\n  /**\n   * Generate CQC inspection readiness report\n   */\n  async generateCQCInspectionReport(tenantId: string): Promise<ComplianceReport> {\n    const reportId = crypto.randomUUID();\n    const generatedAt = new Date().toISOString();\n\n    const persons = await this.getPersonsData(tenantId);\n    const documents = await this.getDocumentsByAuthority(tenantId, 'CQC');\n    const training = await this.getTrainingData(tenantId);\n\n    const stats = this.calculateCQCStats(persons, documents, training);\n\n    const sections: ReportSection[] = [\n      this.buildCQCSafeSection(persons, documents),\n      this.buildCQCEffectiveSection(training),\n      this.buildCQCCaringSection(persons),\n      this.buildCQCResponsiveSection(persons),\n      this.buildCQCWellLedSection(persons, documents),\n      this.buildCQCStaffingSection(persons, documents, training)\n    ];\n\n    return {\n      id: reportId,\n      type: 'cqc_inspection',\n      generatedAt,\n      generatedBy: 'system',\n      tenantId,\n      summary: {\n        title: 'CQC Inspection Readiness Report',\n        overallScore: stats.complianceScore,\n        totalStaff: stats.totalStaff,\n        compliantCount: stats.compliant,\n        atRiskCount: stats.atRisk,\n        nonCompliantCount: stats.nonCompliant,\n        criticalIssues: stats.criticalIssues,\n        keyFindings: [\n          `${stats.dbsCompliant}% DBS compliance rate`,\n          `${stats.trainingCompliant}% mandatory training compliance`,\n          `${stats.careCertificateComplete} staff with Care Certificate`,\n          `${stats.qualifiedNurses} registered nurses on staff`\n        ],\n        recommendations: this.generateCQCRecommendations(stats)\n      },\n      sections,\n      metadata: {\n        version: '1.0',\n        format: 'json',\n        confidentiality: 'confidential',\n        retentionPeriod: '3 years',\n        approvalRequired: true\n      }\n    };\n  }\n\n  private buildCQCSafeSection(persons: any[], documents: any[]): ReportSection {\n    const dbsDocs = documents.filter(d => d.document_type_id.includes('dbs'));\n    const safeguardingDocs = documents.filter(d => d.document_type_id.includes('safeguarding'));\n\n    return {\n      title: 'Safe - Staffing & Safeguarding',\n      authority: 'CQC',\n      description: 'Safe recruitment and safeguarding practices',\n      data: {\n        totalStaff: persons.length,\n        dbsChecked: dbsDocs.filter(d => d.status === 'VERIFIED').length,\n        dbsPending: dbsDocs.filter(d => d.status === 'PENDING').length,\n        dbsExpiring: dbsDocs.filter(d => d.status === 'EXPIRING_SOON').length,\n        safeguardingTrained: safeguardingDocs.filter(d => d.status === 'VERIFIED').length\n      },\n      charts: [\n        {\n          type: 'donut',\n          title: 'DBS Check Status',\n          data: [\n            { label: 'Valid', value: dbsDocs.filter(d => d.status === 'VERIFIED').length, color: '#10b981' },\n            { label: 'Pending', value: dbsDocs.filter(d => d.status === 'PENDING').length, color: '#f59e0b' },\n            { label: 'Expiring', value: dbsDocs.filter(d => d.status === 'EXPIRING_SOON').length, color: '#ef4444' }\n          ]\n        }\n      ],\n      highlights: [\n        'Enhanced DBS checks conducted for all staff',\n        'DBS Update Service subscriptions encouraged',\n        'Safeguarding training mandatory for all roles'\n      ]\n    };\n  }\n\n  private buildCQCEffectiveSection(training: any[]): ReportSection {\n    const trainingTypes = [\n      'Safeguarding Adults',\n      'Safeguarding Children',\n      'Manual Handling',\n      'First Aid',\n      'Medication Administration',\n      'Infection Control',\n      'Mental Capacity Act',\n      'Food Hygiene'\n    ];\n\n    const trainingStats = trainingTypes.map(type => ({\n      type,\n      completed: training.filter(t => t.training_type === type && t.status === 'VERIFIED').length,\n      total: training.filter(t => t.training_type === type).length\n    }));\n\n    return {\n      title: 'Effective - Training & Competency',\n      authority: 'CQC',\n      description: 'Staff training and professional development',\n      data: {\n        mandatoryTrainingCompliance: this.calculatePercentage(\n          training.filter(t => t.status === 'VERIFIED').length,\n          training.length\n        ),\n        careCertificatesComplete: training.filter(t => t.training_type === 'Care Certificate' && t.status === 'VERIFIED').length,\n        supervisionRate: 95 // Would be calculated from supervision records\n      },\n      tables: [\n        {\n          title: 'Mandatory Training Compliance',\n          headers: ['Training Type', 'Completed', 'Total', 'Compliance %'],\n          rows: trainingStats.map(s => [\n            s.type,\n            String(s.completed),\n            String(s.total),\n            `${this.calculatePercentage(s.completed, s.total)}%`\n          ])\n        }\n      ]\n    };\n  }\n\n  private buildCQCCaringSection(persons: any[]): ReportSection {\n    return {\n      title: 'Caring - Staff Values & Behaviours',\n      authority: 'CQC',\n      description: 'Evidence of caring culture and values',\n      data: {\n        valuesTrainingComplete: persons.filter(p => p.compliance_status === 'COMPLIANT').length,\n        feedbackProcessInPlace: true,\n        dignityTrainingComplete: true\n      },\n      highlights: [\n        'All staff complete values-based induction',\n        'Person-centred care training included in Care Certificate',\n        'Regular feedback collection from service users'\n      ]\n    };\n  }\n\n  private buildCQCResponsiveSection(persons: any[]): ReportSection {\n    return {\n      title: 'Responsive - Meeting Individual Needs',\n      authority: 'CQC',\n      description: 'Staff capability to meet diverse needs',\n      data: {\n        specialistTrainingAvailable: true,\n        languageCapabilities: ['English', 'Polish', 'Romanian', 'Hindi'],\n        accessibilityTrainingComplete: true\n      },\n      highlights: [\n        'Specialist training available for complex needs',\n        'Multi-lingual staff capability',\n        'Equality and diversity training mandatory'\n      ]\n    };\n  }\n\n  private buildCQCWellLedSection(persons: any[], documents: any[]): ReportSection {\n    const managers = persons.filter(p => \n      p.job_title?.toLowerCase().includes('manager') || \n      p.job_title?.toLowerCase().includes('supervisor')\n    );\n\n    return {\n      title: 'Well-Led - Leadership & Governance',\n      authority: 'CQC',\n      description: 'Management structure and compliance governance',\n      data: {\n        registeredManager: true,\n        nominatedIndividual: true,\n        managementStaff: managers.length,\n        governanceMeetingsRegular: true,\n        fitAndProperPersonChecksComplete: managers.filter(m => m.compliance_status === 'COMPLIANT').length\n      },\n      tables: [\n        {\n          title: 'Management Team Compliance',\n          headers: ['Name', 'Role', 'Compliance Status', 'Last Review'],\n          rows: managers.map(m => [\n            m.full_name,\n            m.job_title,\n            m.compliance_status,\n            m.updated_at ? new Date(m.updated_at).toLocaleDateString() : 'N/A'\n          ])\n        }\n      ]\n    };\n  }\n\n  private buildCQCStaffingSection(persons: any[], documents: any[], training: any[]): ReportSection {\n    const nurses = persons.filter(p => p.requires_nmc);\n    const carers = persons.filter(p => !p.requires_nmc && p.job_title?.toLowerCase().includes('carer'));\n\n    return {\n      title: 'Staffing Overview',\n      authority: 'CQC',\n      description: 'Complete staffing compliance summary',\n      data: {\n        totalStaff: persons.length,\n        registeredNurses: nurses.length,\n        careAssistants: carers.length,\n        nmcCompliant: nurses.filter(n => n.nmc_expiry_date && new Date(n.nmc_expiry_date) > new Date()).length,\n        fullComplianceRate: this.calculatePercentage(\n          persons.filter(p => p.compliance_status === 'COMPLIANT').length,\n          persons.length\n        )\n      },\n      charts: [\n        {\n          type: 'bar',\n          title: 'Staff Compliance by Role',\n          data: [\n            { label: 'Nurses', value: this.calculatePercentage(nurses.filter(n => n.compliance_status === 'COMPLIANT').length, nurses.length) },\n            { label: 'Carers', value: this.calculatePercentage(carers.filter(c => c.compliance_status === 'COMPLIANT').length, carers.length) },\n            { label: 'Admin', value: 100 }\n          ]\n        }\n      ]\n    };\n  }\n\n  private calculateCQCStats(persons: any[], documents: any[], training: any[]) {\n    const compliant = persons.filter(p => p.compliance_status === 'COMPLIANT');\n    const atRisk = persons.filter(p => p.compliance_status === 'AT_RISK');\n    const nonCompliant = persons.filter(p => p.compliance_status === 'NON_COMPLIANT');\n\n    const dbsDocs = documents.filter(d => d.document_type_id.includes('dbs'));\n    const dbsCompliant = dbsDocs.length > 0 \n      ? Math.round((dbsDocs.filter(d => d.status === 'VERIFIED').length / dbsDocs.length) * 100)\n      : 0;\n\n    const trainingCompliant = training.length > 0\n      ? Math.round((training.filter(t => t.status === 'VERIFIED').length / training.length) * 100)\n      : 0;\n\n    return {\n      totalStaff: persons.length,\n      compliant: compliant.length,\n      atRisk: atRisk.length,\n      nonCompliant: nonCompliant.length,\n      complianceScore: persons.length > 0 \n        ? Math.round((compliant.length / persons.length) * 100)\n        : 0,\n      dbsCompliant,\n      trainingCompliant,\n      careCertificateComplete: documents.filter(d => d.document_type_id === 'care_certificate' && d.status === 'VERIFIED').length,\n      qualifiedNurses: persons.filter(p => p.requires_nmc).length,\n      criticalIssues: [\n        ...nonCompliant.map(p => `${p.full_name}: Non-compliant status`),\n        ...dbsDocs.filter(d => d.status === 'EXPIRED').map(d => 'Expired DBS certificate')\n      ].slice(0, 5)\n    };\n  }\n\n  private generateCQCRecommendations(stats: any): string[] {\n    const recommendations: string[] = [];\n\n    if (stats.dbsCompliant < 100) {\n      recommendations.push('Complete outstanding DBS checks before inspection');\n    }\n    if (stats.trainingCompliant < 90) {\n      recommendations.push('Prioritize mandatory training completion');\n    }\n    if (stats.nonCompliant > 0) {\n      recommendations.push('Address non-compliant staff immediately');\n    }\n    recommendations.push('Ensure all supervision records are up to date');\n    recommendations.push('Review and update care plans within 30 days of inspection');\n\n    return recommendations;\n  }\n\n  // =========================================\n  // HELPER METHODS\n  // =========================================\n\n  private async getPersonsData(tenantId: string): Promise<any[]> {\n    const { data } = await supabase\n      .from('compliance_persons')\n      .select('*')\n      .eq('tenant_id', tenantId)\n      .eq('person_type', 'EMPLOYEE');\n    return data || [];\n  }\n\n  private async getDocumentsByAuthority(tenantId: string, authority: string): Promise<any[]> {\n    const { data } = await supabase\n      .from('compliance_documents')\n      .select('*, compliance_persons(*)')\n      .eq('tenant_id', tenantId)\n      .eq('is_current', true)\n      .or(`authority.eq.${authority},authority.eq.BOTH`);\n    return data || [];\n  }\n\n  private async getRTWCheckHistory(tenantId: string): Promise<any[]> {\n    const { data } = await supabase\n      .from('compliance_audit_log')\n      .select('*')\n      .eq('tenant_id', tenantId)\n      .eq('action', 'RTW_CHECK')\n      .order('created_at', { ascending: false })\n      .limit(100);\n    return data || [];\n  }\n\n  private async getTrainingData(tenantId: string): Promise<any[]> {\n    const { data } = await supabase\n      .from('compliance_checklists')\n      .select('*')\n      .eq('tenant_id', tenantId)\n      .eq('document_type_id', 'mandatory_training');\n    return data || [];\n  }\n\n  private groupBy<T>(array: T[], key: keyof T): Record<string, T[]> {\n    return array.reduce((result, item) => {\n      const keyValue = String(item[key] || 'unknown');\n      (result[keyValue] = result[keyValue] || []).push(item);\n      return result;\n    }, {} as Record<string, T[]>);\n  }\n\n  private calculatePercentage(part: number, total: number): number {\n    if (total === 0) return 0;\n    return Math.round((part / total) * 100);\n  }\n\n  // =========================================\n  // EXPORT METHODS\n  // =========================================\n\n  /**\n   * Generate report in specified format\n   */\n  async generateReport(\n    tenantId: string, \n    type: ReportType, \n    format: 'json' | 'html' | 'pdf' = 'json'\n  ): Promise<ComplianceReport | string> {\n    let report: ComplianceReport;\n\n    switch (type) {\n      case 'home_office_audit':\n        report = await this.generateHomeOfficeAuditReport(tenantId);\n        break;\n      case 'cqc_inspection':\n        report = await this.generateCQCInspectionReport(tenantId);\n        break;\n      default:\n        report = await this.generateHomeOfficeAuditReport(tenantId);\n    }\n\n    if (format === 'json') {\n      return report;\n    } else if (format === 'html') {\n      return this.convertToHTML(report);\n    }\n\n    return report;\n  }\n\n  private convertToHTML(report: ComplianceReport): string {\n    // Generate HTML report\n    return `\n<!DOCTYPE html>\n<html>\n<head>\n  <title>${report.summary.title}</title>\n  <style>\n    body { font-family: Arial, sans-serif; margin: 40px; }\n    h1 { color: #1e40af; }\n    h2 { color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 8px; }\n    .summary { background: #f3f4f6; padding: 20px; border-radius: 8px; margin: 20px 0; }\n    .stat { display: inline-block; margin: 10px 20px; text-align: center; }\n    .stat-value { font-size: 32px; font-weight: bold; color: #1e40af; }\n    .stat-label { font-size: 12px; color: #6b7280; }\n    .issue-critical { background: #fee2e2; border-left: 4px solid #ef4444; padding: 10px; margin: 10px 0; }\n    .issue-high { background: #fef3c7; border-left: 4px solid #f59e0b; padding: 10px; margin: 10px 0; }\n    table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n    th, td { border: 1px solid #e5e7eb; padding: 12px; text-align: left; }\n    th { background: #f3f4f6; }\n    .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #e5e7eb; font-size: 12px; color: #6b7280; }\n  </style>\n</head>\n<body>\n  <h1>${report.summary.title}</h1>\n  <p>Generated: ${new Date(report.generatedAt).toLocaleString()}</p>\n  \n  <div class=\"summary\">\n    <div class=\"stat\">\n      <div class=\"stat-value\">${report.summary.overallScore}%</div>\n      <div class=\"stat-label\">Compliance Score</div>\n    </div>\n    <div class=\"stat\">\n      <div class=\"stat-value\">${report.summary.totalStaff}</div>\n      <div class=\"stat-label\">Total Staff</div>\n    </div>\n    <div class=\"stat\">\n      <div class=\"stat-value\" style=\"color: #10b981\">${report.summary.compliantCount}</div>\n      <div class=\"stat-label\">Compliant</div>\n    </div>\n    <div class=\"stat\">\n      <div class=\"stat-value\" style=\"color: #ef4444\">${report.summary.nonCompliantCount}</div>\n      <div class=\"stat-label\">Non-Compliant</div>\n    </div>\n  </div>\n\n  <h2>Key Findings</h2>\n  <ul>\n    ${report.summary.keyFindings.map(f => `<li>${f}</li>`).join('')}\n  </ul>\n\n  <h2>Critical Issues</h2>\n  ${report.summary.criticalIssues.map(i => `<div class=\"issue-critical\">${i}</div>`).join('')}\n\n  <h2>Recommendations</h2>\n  <ol>\n    ${report.summary.recommendations.map(r => `<li>${r}</li>`).join('')}\n  </ol>\n\n  ${report.sections.map(section => `\n    <h2>${section.title}</h2>\n    ${section.description ? `<p>${section.description}</p>` : ''}\n    ${section.tables?.map(table => `\n      <h3>${table.title}</h3>\n      <table>\n        <thead><tr>${table.headers.map(h => `<th>${h}</th>`).join('')}</tr></thead>\n        <tbody>${table.rows.map(row => `<tr>${row.map(cell => `<td>${cell}</td>`).join('')}</tr>`).join('')}</tbody>\n      </table>\n    `).join('') || ''}\n    ${section.issues?.map(issue => `\n      <div class=\"issue-${issue.severity}\">${issue.description}</div>\n    `).join('') || ''}\n  `).join('')}\n\n  <div class=\"footer\">\n    <p>Report ID: ${report.id}</p>\n    <p>Confidentiality: ${report.metadata.confidentiality}</p>\n    <p>Retention Period: ${report.metadata.retentionPeriod}</p>\n  </div>\n</body>\n</html>\n    `;\n  }\n}\n\n// Export singleton\nexport const complianceReportGenerator = new ComplianceReportGenerator();\nexport default complianceReportGenerator;\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/compliance/ComplianceService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/compliance/CrossAppSyncService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ComplianceFolder' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":64},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used. Allowed unused caught errors must match /^_/u.","line":894,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":894,"endColumn":19},{"ruleId":"prefer-const","severity":2,"message":"'succeeded' is never reassigned. Use 'const' instead.","line":958,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":958,"endColumn":18,"fix":{"range":[27721,27739],"text":"const succeeded = 0;"}}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":1,"fixableWarningCount":0,"source":"/**\n * Cross-App Synchronization Service\n * \n * Handles data synchronization between NovumFlow and CareFlow\n * - Employee/Carer data sync\n * - Document sync with proper categorization\n * - Training record sync\n * - Compliance status sync\n * - Real-time updates\n */\n\nimport { supabase } from '../supabase';\nimport { CompliancePerson, ComplianceDocument, ComplianceFolder } from './ComplianceService';\nimport { log } from '../logger';\n\n// ===========================================\n// TYPES\n// ===========================================\n\nexport interface SyncConfig {\n  sourceApp: 'novumflow' | 'careflow';\n  targetApp: 'novumflow' | 'careflow';\n  syncType: SyncType;\n  entityId?: string;\n  tenantId: string;\n  userId?: string;\n}\n\nexport type SyncType =\n  | 'person'\n  | 'document'\n  | 'folder'\n  | 'training'\n  | 'compliance_status'\n  | 'full_profile';\n\nexport interface SyncResult {\n  success: boolean;\n  syncId: string;\n  entityType: string;\n  sourceId: string;\n  targetId?: string;\n  syncedFields: string[];\n  errors?: string[];\n  timestamp: string;\n}\n\nexport interface SyncMapping {\n  novumflow: string;\n  careflow: string;\n  transform?: (value: any) => any;\n}\n\nexport interface SyncStatus {\n  lastSync: string;\n  syncCount: number;\n  pendingSync: number;\n  errors: SyncError[];\n  health: 'healthy' | 'degraded' | 'error';\n}\n\nexport interface SyncError {\n  id: string;\n  timestamp: string;\n  entityType: string;\n  entityId: string;\n  error: string;\n  retryCount: number;\n}\n\n// ===========================================\n// FIELD MAPPINGS\n// ===========================================\n\nconst PERSON_FIELD_MAPPINGS: SyncMapping[] = [\n  { novumflow: 'full_name', careflow: 'name' },\n  { novumflow: 'email', careflow: 'email' },\n  { novumflow: 'phone', careflow: 'phone' },\n  { novumflow: 'job_title', careflow: 'role' },\n  { novumflow: 'department', careflow: 'department' },\n  { novumflow: 'start_date', careflow: 'joinedDate' },\n  { novumflow: 'overall_compliance_score', careflow: 'complianceScore' },\n  {\n    novumflow: 'compliance_status', careflow: 'status',\n    transform: (status: string) => status === 'COMPLIANT' ? 'Active' : 'At Risk'\n  },\n  { novumflow: 'visa_expiry_date', careflow: 'visaExpiry' },\n  { novumflow: 'requires_nmc', careflow: 'requiresNMC' },\n  { novumflow: 'nmc_pin', careflow: 'nmcPin' },\n  { novumflow: 'nmc_expiry_date', careflow: 'nmcExpiry' },\n];\n\nconst DOCUMENT_CATEGORY_MAPPINGS: Record<string, string> = {\n  // Home Office docs map to Staff HR in CareFlow\n  'HOME_OFFICE': 'Staff HR',\n  // CQC docs map to Compliance in CareFlow\n  'CQC': 'Compliance',\n  // Shared docs go to both\n  'BOTH': 'Staff HR',\n  // Internal stays as HR\n  'INTERNAL': 'Staff HR'\n};\n\nconst COMPLIANCE_RECORD_MAPPINGS: Record<string, string> = {\n  'dbs_certificate': 'DBS Check',\n  'mandatory_training': 'Mandatory Training',\n  'safeguarding_adults': 'Safeguarding L2',\n  'safeguarding_children': 'Safeguarding Children',\n  'first_aid': 'First Aid',\n  'manual_handling': 'Manual Handling',\n  'medication_admin': 'Medication Admin',\n  'fire_safety': 'Fire Safety',\n  'health_safety': 'Health & Safety',\n  'food_hygiene': 'Food Hygiene',\n  'infection_control': 'Infection Control',\n  'mental_capacity': 'Mental Capacity Act',\n  'nmc_pin': 'NMC Registration',\n  'care_certificate': 'Care Certificate'\n};\n\n// ===========================================\n// SYNC SERVICE\n// ===========================================\n\nclass CrossAppSyncService {\n  private syncQueue: Map<string, SyncConfig> = new Map();\n  private retryQueue: SyncError[] = [];\n  private isProcessing: boolean = false;\n\n  // =========================================\n  // PERSON SYNC\n  // =========================================\n\n  /**\n   * Sync a person from NovumFlow to CareFlow\n   */\n  async syncPersonToCareFlow(\n    personId: string,\n    tenantId: string\n  ): Promise<SyncResult> {\n    try {\n      // Get person data from NovumFlow\n      const { data: person, error: fetchError } = await supabase\n        .from('compliance_persons')\n        .select('*')\n        .eq('id', personId)\n        .single();\n\n      if (fetchError || !person) {\n        return this.createErrorResult('person', personId, 'Person not found');\n      }\n\n      // Transform data for CareFlow format\n      const careflowData = this.transformPersonForCareFlow(person);\n\n      // Check if person exists in CareFlow staff table\n      const { data: existingStaff } = await supabase\n        .from('staff_members')\n        .select('id')\n        .eq('email', person.email)\n        .eq('tenant_id', tenantId)\n        .single();\n\n      let targetId: string;\n\n      if (existingStaff) {\n        // Update existing staff member\n        const { error: updateError } = await supabase\n          .from('staff_members')\n          .update(careflowData)\n          .eq('id', existingStaff.id);\n\n        if (updateError) {\n          return this.createErrorResult('person', personId, updateError.message);\n        }\n        targetId = existingStaff.id;\n      } else {\n        // Create new staff member\n        const { data: newStaff, error: insertError } = await supabase\n          .from('staff_members')\n          .insert({\n            ...careflowData,\n            tenant_id: tenantId,\n            status: 'Active'\n          })\n          .select()\n          .single();\n\n        if (insertError || !newStaff) {\n          return this.createErrorResult('person', personId, insertError?.message || 'Insert failed');\n        }\n        targetId = newStaff.id;\n      }\n\n      // Update sync status in NovumFlow\n      await supabase\n        .from('compliance_persons')\n        .update({\n          synced_to_careflow: true,\n          careflow_sync_date: new Date().toISOString()\n        })\n        .eq('id', personId);\n\n      // Log sync\n      await this.logSync({\n        sourceApp: 'novumflow',\n        targetApp: 'careflow',\n        syncType: 'person',\n        entityId: personId,\n        tenantId\n      }, targetId);\n\n      return {\n        success: true,\n        syncId: crypto.randomUUID(),\n        entityType: 'person',\n        sourceId: personId,\n        targetId,\n        syncedFields: PERSON_FIELD_MAPPINGS.map(m => m.novumflow),\n        timestamp: new Date().toISOString()\n      };\n    } catch (error) {\n      log.error('Sync error', error, { component: 'CrossAppSyncService', action: 'syncPersonToCareFlow', metadata: { personId, tenantId } });\n      return this.createErrorResult('person', personId, String(error));\n    }\n  }\n\n  /**\n   * Transform NovumFlow person to CareFlow staff format\n   */\n  private transformPersonForCareFlow(person: CompliancePerson): Record<string, any> {\n    const result: Record<string, any> = {};\n\n    for (const mapping of PERSON_FIELD_MAPPINGS) {\n      const value = person[mapping.novumflow as keyof CompliancePerson];\n      if (value !== undefined && value !== null) {\n        result[mapping.careflow] = mapping.transform\n          ? mapping.transform(value)\n          : value;\n      }\n    }\n\n    return result;\n  }\n\n  // =========================================\n  // DOCUMENT SYNC\n  // =========================================\n\n  /**\n   * Sync documents from NovumFlow to CareFlow\n   */\n  async syncDocumentsToCareFlow(\n    personId: string,\n    tenantId: string\n  ): Promise<SyncResult[]> {\n    try {\n      // Get all current documents for person\n      const { data: documents, error } = await supabase\n        .from('compliance_documents')\n        .select('*')\n        .eq('person_id', personId)\n        .eq('is_current', true);\n\n      if (error || !documents) {\n        return [this.createErrorResult('document', personId, 'Failed to fetch documents')];\n      }\n\n      const results: SyncResult[] = [];\n\n      for (const doc of documents) {\n        const result = await this.syncSingleDocument(doc, tenantId);\n        results.push(result);\n      }\n\n      return results;\n      return results;\n    } catch (error) {\n      log.error('Document sync error', error, { component: 'CrossAppSyncService', action: 'syncDocumentsToCareFlow', metadata: { personId, tenantId } });\n      return [this.createErrorResult('document', personId, String(error))];\n    }\n  }\n\n  /**\n   * Sync a single document to CareFlow\n   */\n  async syncSingleDocument(\n    document: ComplianceDocument,\n    tenantId: string\n  ): Promise<SyncResult> {\n    try {\n      // Transform document for CareFlow\n      const careflowDoc = {\n        name: document.file_name,\n        type: this.getDocumentType(document.mime_type || ''),\n        category: DOCUMENT_CATEGORY_MAPPINGS[document.authority] || 'Staff HR',\n        uploadedDate: document.uploaded_at,\n        expiryDate: document.expiry_date,\n        tags: [\n          document.authority.toLowerCase(),\n          document.document_type_id,\n          document.status.toLowerCase()\n        ],\n        size: this.formatFileSize(document.file_size || 0),\n        tenant_id: tenantId,\n        // Link to storage\n        storage_bucket: document.storage_bucket,\n        storage_path: document.storage_path,\n        // Source reference\n        novumflow_document_id: document.id,\n        person_id: document.person_id\n      };\n\n      // Check if already synced\n      const { data: existing } = await supabase\n        .from('stored_documents')\n        .select('id')\n        .eq('novumflow_document_id', document.id)\n        .single();\n\n      let targetId: string;\n\n      if (existing) {\n        const { error: updateError } = await supabase\n          .from('stored_documents')\n          .update(careflowDoc)\n          .eq('id', existing.id);\n\n        if (updateError) {\n          return this.createErrorResult('document', document.id, updateError.message);\n        }\n        targetId = existing.id;\n      } else {\n        const { data: newDoc, error: insertError } = await supabase\n          .from('stored_documents')\n          .insert(careflowDoc)\n          .select()\n          .single();\n\n        if (insertError || !newDoc) {\n          return this.createErrorResult('document', document.id, insertError?.message || 'Insert failed');\n        }\n        targetId = newDoc.id;\n      }\n\n      await this.logSync({\n        sourceApp: 'novumflow',\n        targetApp: 'careflow',\n        syncType: 'document',\n        entityId: document.id,\n        tenantId\n      }, targetId);\n\n      return {\n        success: true,\n        syncId: crypto.randomUUID(),\n        entityType: 'document',\n        sourceId: document.id,\n        targetId,\n        syncedFields: ['name', 'type', 'category', 'expiryDate', 'tags'],\n        timestamp: new Date().toISOString()\n      };\n    } catch (error) {\n      return this.createErrorResult('document', document.id, String(error));\n    }\n  }\n\n  private getDocumentType(mimeType: string): 'PDF' | 'Image' | 'Word' {\n    if (mimeType.includes('pdf')) return 'PDF';\n    if (mimeType.includes('image')) return 'Image';\n    if (mimeType.includes('word') || mimeType.includes('document')) return 'Word';\n    return 'PDF';\n  }\n\n  private formatFileSize(bytes: number): string {\n    if (bytes < 1024) return `${bytes} B`;\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n    return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n  }\n\n  // =========================================\n  // COMPLIANCE RECORD SYNC\n  // =========================================\n\n  /**\n   * Sync compliance records to CareFlow staff compliance array\n   */\n  async syncComplianceRecords(\n    personId: string,\n    tenantId: string\n  ): Promise<SyncResult> {\n    try {\n      // Get compliance checklist items\n      const { data: checklists, error } = await supabase\n        .from('compliance_checklists')\n        .select('*, compliance_documents(*)')\n        .eq('person_id', personId)\n        .eq('is_applicable', true);\n\n      if (error || !checklists) {\n        return this.createErrorResult('compliance', personId, 'Failed to fetch checklists');\n      }\n\n      // Transform to CareFlow compliance record format\n      const complianceRecords = checklists\n        .filter(item => item.authority === 'CQC' || item.authority === 'BOTH')\n        .map(item => ({\n          id: item.id,\n          name: COMPLIANCE_RECORD_MAPPINGS[item.document_type_id] || item.document_type_id,\n          expiryDate: item.compliance_documents?.expiry_date || null,\n          status: this.mapComplianceStatus(item.status, item.compliance_documents?.expiry_date),\n          docUrl: item.compliance_documents?.file_path\n        }));\n\n      // Get person email to find CareFlow staff\n      const { data: person } = await supabase\n        .from('compliance_persons')\n        .select('email')\n        .eq('id', personId)\n        .single();\n\n      if (!person) {\n        return this.createErrorResult('compliance', personId, 'Person not found');\n      }\n\n      // Update staff compliance in CareFlow\n      const { data: staff, error: staffError } = await supabase\n        .from('staff_members')\n        .update({ compliance: complianceRecords })\n        .eq('email', person.email)\n        .eq('tenant_id', tenantId)\n        .select()\n        .single();\n\n      if (staffError || !staff) {\n        return this.createErrorResult('compliance', personId, staffError?.message || 'Staff update failed');\n      }\n\n      await this.logSync({\n        sourceApp: 'novumflow',\n        targetApp: 'careflow',\n        syncType: 'compliance_status',\n        entityId: personId,\n        tenantId\n      }, staff.id);\n\n      return {\n        success: true,\n        syncId: crypto.randomUUID(),\n        entityType: 'compliance_status',\n        sourceId: personId,\n        targetId: staff.id,\n        syncedFields: complianceRecords.map(r => r.name),\n        timestamp: new Date().toISOString()\n      };\n    } catch (error) {\n      return this.createErrorResult('compliance', personId, String(error));\n    }\n  }\n\n  private mapComplianceStatus(\n    status: string,\n    expiryDate?: string\n  ): 'Valid' | 'Due Soon' | 'Expired' {\n    if (status === 'EXPIRED') return 'Expired';\n    if (status === 'EXPIRING_SOON') return 'Due Soon';\n\n    if (expiryDate) {\n      const expiry = new Date(expiryDate);\n      const now = new Date();\n      const daysUntil = Math.floor((expiry.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));\n\n      if (daysUntil < 0) return 'Expired';\n      if (daysUntil < 30) return 'Due Soon';\n    }\n\n    return 'Valid';\n  }\n\n  // =========================================\n  // FOLDER SYNC\n  // =========================================\n\n  /**\n   * Sync folder structure to CareFlow\n   */\n  async syncFoldersToCareFlow(tenantId: string): Promise<SyncResult> {\n    try {\n      // Get NovumFlow folder structure\n      const { data: folders, error } = await supabase\n        .from('compliance_folders')\n        .select('*')\n        .eq('tenant_id', tenantId)\n        .eq('is_system_folder', true);\n\n      if (error || !folders) {\n        return this.createErrorResult('folder', tenantId, 'Failed to fetch folders');\n      }\n\n      // Transform for CareFlow\n      // CareFlow uses category-based organization\n      const categoryMappings = folders.map(folder => ({\n        name: folder.name,\n        authority: folder.authority,\n        careflowCategory: DOCUMENT_CATEGORY_MAPPINGS[folder.authority] || 'Staff HR',\n        color: folder.color,\n        autoAssign: folder.auto_assign_document_types\n      }));\n\n      // Store mapping for reference\n      await supabase\n        .from('compliance_sync_log')\n        .insert({\n          tenant_id: tenantId,\n          source_app: 'novumflow',\n          target_app: 'careflow',\n          sync_type: 'folder',\n          source_entity_id: tenantId,\n          entity_type: 'folder_structure',\n          status: 'COMPLETED',\n          sync_started_at: new Date().toISOString(),\n          sync_completed_at: new Date().toISOString(),\n          sync_data: categoryMappings\n        });\n\n      return {\n        success: true,\n        syncId: crypto.randomUUID(),\n        entityType: 'folder',\n        sourceId: tenantId,\n        syncedFields: ['name', 'authority', 'category', 'autoAssign'],\n        timestamp: new Date().toISOString()\n      };\n    } catch (error) {\n      return this.createErrorResult('folder', tenantId, String(error));\n    }\n  }\n\n  // =========================================\n  // FULL PROFILE SYNC\n  // =========================================\n\n  /**\n   * Sync complete profile (person + documents + compliance)\n   */\n  async syncFullProfile(\n    personId: string,\n    tenantId: string\n  ): Promise<{\n    person: SyncResult;\n    documents: SyncResult[];\n    compliance: SyncResult;\n    overall: { success: boolean; errors: string[] };\n  }> {\n    const errors: string[] = [];\n\n    // Sync person\n    const personResult = await this.syncPersonToCareFlow(personId, tenantId);\n    if (!personResult.success && personResult.errors) {\n      errors.push(...personResult.errors);\n    }\n\n    // Sync documents\n    const documentResults = await this.syncDocumentsToCareFlow(personId, tenantId);\n    for (const result of documentResults) {\n      if (!result.success && result.errors) {\n        errors.push(...result.errors);\n      }\n    }\n\n    // Sync compliance records\n    const complianceResult = await this.syncComplianceRecords(personId, tenantId);\n    if (!complianceResult.success && complianceResult.errors) {\n      errors.push(...complianceResult.errors);\n    }\n\n    return {\n      person: personResult,\n      documents: documentResults,\n      compliance: complianceResult,\n      overall: {\n        success: errors.length === 0,\n        errors\n      }\n    };\n  }\n\n  // =========================================\n  // BATCH SYNC\n  // =========================================\n\n  /**\n   * Batch sync all employees to CareFlow\n   */\n  async batchSyncToCareFlow(tenantId: string): Promise<{\n    total: number;\n    successful: number;\n    failed: number;\n    errors: SyncError[];\n  }> {\n    const errors: SyncError[] = [];\n    let successful = 0;\n    let failed = 0;\n\n    // Get all employees\n    const { data: persons, error } = await supabase\n      .from('compliance_persons')\n      .select('id')\n      .eq('tenant_id', tenantId)\n      .eq('person_type', 'EMPLOYEE');\n\n    if (error || !persons) {\n      return { total: 0, successful: 0, failed: 0, errors: [] };\n    }\n\n    for (const person of persons) {\n      const result = await this.syncFullProfile(person.id, tenantId);\n\n      if (result.overall.success) {\n        successful++;\n      } else {\n        failed++;\n        errors.push({\n          id: crypto.randomUUID(),\n          timestamp: new Date().toISOString(),\n          entityType: 'person',\n          entityId: person.id,\n          error: result.overall.errors.join(', '),\n          retryCount: 0\n        });\n      }\n    }\n\n    return {\n      total: persons.length,\n      successful,\n      failed,\n      errors\n    };\n  }\n\n  // =========================================\n  // SYNC FROM CAREFLOW\n  // =========================================\n\n  /**\n   * Sync training completion from CareFlow to NovumFlow\n   */\n  async syncTrainingFromCareFlow(\n    staffId: string,\n    tenantId: string\n  ): Promise<SyncResult> {\n    try {\n      // Get training modules from CareFlow\n      const { data: staff, error } = await supabase\n        .from('staff_members')\n        .select('*, training_modules(*)')\n        .eq('id', staffId)\n        .single();\n\n      if (error || !staff) {\n        return this.createErrorResult('training', staffId, 'Staff not found');\n      }\n\n      // Get corresponding NovumFlow person\n      const { data: person } = await supabase\n        .from('compliance_persons')\n        .select('id')\n        .eq('email', staff.email)\n        .eq('tenant_id', tenantId)\n        .single();\n\n      if (!person) {\n        return this.createErrorResult('training', staffId, 'Person not found in NovumFlow');\n      }\n\n      // Update training checklist items\n      if (staff.training_modules) {\n        for (const module of staff.training_modules) {\n          if (module.status === 'Completed') {\n            await supabase\n              .from('compliance_checklists')\n              .update({\n                status: 'VERIFIED',\n                completed_date: module.completedDate,\n                notes: `Completed in CareFlow: ${module.title}`\n              })\n              .eq('person_id', person.id)\n              .eq('document_type_id', 'mandatory_training');\n          }\n        }\n      }\n\n      await this.logSync({\n        sourceApp: 'careflow',\n        targetApp: 'novumflow',\n        syncType: 'training',\n        entityId: staffId,\n        tenantId\n      }, person.id);\n\n      return {\n        success: true,\n        syncId: crypto.randomUUID(),\n        entityType: 'training',\n        sourceId: staffId,\n        targetId: person.id,\n        syncedFields: ['training_status', 'completed_date'],\n        timestamp: new Date().toISOString()\n      };\n    } catch (error) {\n      return this.createErrorResult('training', staffId, String(error));\n    }\n  }\n\n  // =========================================\n  // REAL-TIME SYNC\n  // =========================================\n\n  /**\n   * Setup real-time sync listeners\n   */\n  setupRealtimeSync(tenantId: string): void {\n    // Listen for document changes in NovumFlow\n    supabase\n      .channel(`compliance_documents_${tenantId}`)\n      .on(\n        'postgres_changes',\n        {\n          event: '*',\n          schema: 'public',\n          table: 'compliance_documents',\n          filter: `tenant_id=eq.${tenantId}`\n        },\n        async (payload) => {\n          if (payload.eventType === 'INSERT' || payload.eventType === 'UPDATE') {\n            const doc = payload.new as ComplianceDocument;\n            await this.queueSync({\n              sourceApp: 'novumflow',\n              targetApp: 'careflow',\n              syncType: 'document',\n              entityId: doc.id,\n              tenantId\n            });\n          }\n        }\n      )\n      .subscribe();\n\n    // Listen for person changes\n    supabase\n      .channel(`compliance_persons_${tenantId}`)\n      .on(\n        'postgres_changes',\n        {\n          event: 'UPDATE',\n          schema: 'public',\n          table: 'compliance_persons',\n          filter: `tenant_id=eq.${tenantId}`\n        },\n        async (payload) => {\n          const person = payload.new as CompliancePerson;\n          if (person.person_type === 'EMPLOYEE' && !person.synced_to_careflow) {\n            await this.queueSync({\n              sourceApp: 'novumflow',\n              targetApp: 'careflow',\n              syncType: 'person',\n              entityId: person.id,\n              tenantId\n            });\n          }\n        }\n      )\n      .subscribe();\n  }\n\n  /**\n   * Stop real-time sync\n   */\n  stopRealtimeSync(tenantId: string): void {\n    supabase.channel(`compliance_documents_${tenantId}`).unsubscribe();\n    supabase.channel(`compliance_persons_${tenantId}`).unsubscribe();\n  }\n\n  // =========================================\n  // QUEUE MANAGEMENT\n  // =========================================\n\n  /**\n   * Queue a sync operation\n   */\n  async queueSync(config: SyncConfig): Promise<void> {\n    const key = `${config.syncType}_${config.entityId}`;\n    this.syncQueue.set(key, config);\n\n    if (!this.isProcessing) {\n      this.processQueue();\n    }\n  }\n\n  /**\n   * Process sync queue\n   */\n  private async processQueue(): Promise<void> {\n    if (this.isProcessing) return;\n    this.isProcessing = true;\n\n    try {\n      while (this.syncQueue.size > 0) {\n        const entries = Array.from(this.syncQueue.entries());\n        this.syncQueue.clear();\n\n        for (const [key, config] of entries) {\n          try {\n            await this.executeSyncConfig(config);\n          } catch (error) {\n            log.error(`Sync failed for ${key}`, error, { component: 'CrossAppSyncService', action: 'processQueue', metadata: { key, config } });\n            this.retryQueue.push({\n              id: crypto.randomUUID(),\n              timestamp: new Date().toISOString(),\n              entityType: config.syncType,\n              entityId: config.entityId || '',\n              error: String(error),\n              retryCount: 0\n            });\n          }\n        }\n\n        // Small delay between batches\n        await new Promise(resolve => setTimeout(resolve, 100));\n      }\n    } finally {\n      this.isProcessing = false;\n      log.info('Sync queue processing complete', { component: 'CrossAppSyncService', action: 'processQueue' });\n    }\n  }\n\n  /**\n   * Execute a sync configuration\n   */\n  private async executeSyncConfig(config: SyncConfig): Promise<SyncResult> {\n    switch (config.syncType) {\n      case 'person':\n        return this.syncPersonToCareFlow(config.entityId!, config.tenantId);\n      case 'document':\n        const results = await this.syncDocumentsToCareFlow(config.entityId!, config.tenantId);\n        return results[0];\n      case 'compliance_status':\n        return this.syncComplianceRecords(config.entityId!, config.tenantId);\n      case 'folder':\n        return this.syncFoldersToCareFlow(config.tenantId);\n      default:\n        return this.createErrorResult(config.syncType, config.entityId || '', 'Unknown sync type');\n    }\n  }\n\n  // =========================================\n  // STATUS & LOGGING\n  // =========================================\n\n  /**\n   * Get sync status for a tenant\n   */\n  async getSyncStatus(tenantId: string): Promise<SyncStatus> {\n    try {\n      // Get recent sync logs\n      const { data: logs, error } = await supabase\n        .from('compliance_sync_log')\n        .select('*')\n        .eq('tenant_id', tenantId)\n        .order('created_at', { ascending: false })\n        .limit(100);\n\n      if (error || !logs) {\n        return {\n          lastSync: 'Never',\n          syncCount: 0,\n          pendingSync: this.syncQueue.size,\n          errors: this.retryQueue,\n          health: 'error'\n        };\n      }\n\n      const successCount = logs.filter(l => l.status === 'COMPLETED').length;\n      const errorCount = logs.filter(l => l.status === 'FAILED').length;\n\n      return {\n        lastSync: logs[0]?.created_at || 'Never',\n        syncCount: successCount,\n        pendingSync: this.syncQueue.size,\n        errors: this.retryQueue,\n        health: errorCount > successCount * 0.1 ? 'degraded' : 'healthy'\n      };\n    } catch (error) {\n      return {\n        lastSync: 'Unknown',\n        syncCount: 0,\n        pendingSync: 0,\n        errors: [],\n        health: 'error'\n      };\n    }\n  }\n\n  /**\n   * Log sync operation\n   */\n  private async logSync(config: SyncConfig, targetId?: string): Promise<void> {\n    try {\n      await supabase.from('compliance_sync_log').insert({\n        tenant_id: config.tenantId,\n        source_app: config.sourceApp,\n        target_app: config.targetApp,\n        sync_type: config.syncType,\n        source_entity_id: config.entityId,\n        target_entity_id: targetId,\n        entity_type: config.syncType,\n        status: 'COMPLETED',\n        sync_started_at: new Date().toISOString(),\n        sync_completed_at: new Date().toISOString()\n      });\n    } catch (error) {\n      console.error('Failed to log sync:', error);\n    }\n  }\n\n  /**\n   * Create error result\n   */\n  private createErrorResult(\n    entityType: string,\n    entityId: string,\n    error: string\n  ): SyncResult {\n    return {\n      success: false,\n      syncId: crypto.randomUUID(),\n      entityType,\n      sourceId: entityId,\n      syncedFields: [],\n      errors: [error],\n      timestamp: new Date().toISOString()\n    };\n  }\n\n  // =========================================\n  // RETRY FAILED SYNCS\n  // =========================================\n\n  /**\n   * Retry failed sync operations\n   */\n  async retryFailedSyncs(maxRetries: number = 3): Promise<{\n    retried: number;\n    succeeded: number;\n    permanentFailures: number;\n  }> {\n    let succeeded = 0;\n    let permanentFailures = 0;\n    const toRetry = [...this.retryQueue];\n    this.retryQueue = [];\n\n    for (const error of toRetry) {\n      if (error.retryCount >= maxRetries) {\n        permanentFailures++;\n        continue;\n      }\n\n      // Attempt retry logic here\n      error.retryCount++;\n      this.retryQueue.push(error);\n    }\n\n    return {\n      retried: toRetry.length,\n      succeeded,\n      permanentFailures\n    };\n  }\n}\n\n// Export singleton instance\nexport const crossAppSyncService = new CrossAppSyncService();\nexport default crossAppSyncService;\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/compliance/DocumentClassificationService.ts","messages":[{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":83,"column":61,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":83,"endColumn":62,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2256,2257],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2256,2256],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":83,"column":63,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":83,"endColumn":64,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2258,2259],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2258,2258],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":83,"column":74,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":83,"endColumn":75,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2269,2270],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2269,2269],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":83,"column":76,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":83,"endColumn":77,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2271,2272],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2271,2271],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":83,"column":95,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":83,"endColumn":96,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2290,2291],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2290,2290],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":83,"column":97,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":83,"endColumn":98,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2292,2293],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2292,2292],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":83,"column":110,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":83,"endColumn":111,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2305,2306],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2305,2305],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":83,"column":112,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":83,"endColumn":113,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2307,2308],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2307,2307],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":98,"column":74,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":98,"endColumn":75,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2794,2795],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2794,2794],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":98,"column":76,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":98,"endColumn":77,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2796,2797],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2796,2796],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":98,"column":87,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":98,"endColumn":88,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2807,2808],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2807,2807],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":98,"column":89,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":98,"endColumn":90,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2809,2810],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2809,2809],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":98,"column":108,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":98,"endColumn":109,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2828,2829],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2828,2828],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":98,"column":110,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":98,"endColumn":111,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2830,2831],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2830,2830],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":98,"column":123,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":98,"endColumn":124,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2843,2844],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2843,2843],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":98,"column":125,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":98,"endColumn":126,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2845,2846],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2845,2845],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":111,"column":44,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":111,"endColumn":45,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3180,3181],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3180,3180],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":111,"column":46,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":111,"endColumn":47,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3182,3183],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3182,3182],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":111,"column":57,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":111,"endColumn":58,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3193,3194],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3193,3193],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":111,"column":59,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":111,"endColumn":60,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3195,3196],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3195,3195],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":216,"column":56,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":216,"endColumn":57,"suggestions":[{"messageId":"removeEscape","fix":{"range":[6209,6210],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[6209,6209],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":216,"column":58,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":216,"endColumn":59,"suggestions":[{"messageId":"removeEscape","fix":{"range":[6211,6212],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[6211,6211],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":216,"column":69,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":216,"endColumn":70,"suggestions":[{"messageId":"removeEscape","fix":{"range":[6222,6223],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[6222,6222],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":216,"column":71,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":216,"endColumn":72,"suggestions":[{"messageId":"removeEscape","fix":{"range":[6224,6225],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[6224,6224],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":235,"column":74,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":235,"endColumn":75,"suggestions":[{"messageId":"removeEscape","fix":{"range":[6885,6886],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[6885,6885],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":235,"column":76,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":235,"endColumn":77,"suggestions":[{"messageId":"removeEscape","fix":{"range":[6887,6888],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[6887,6887],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":235,"column":87,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":235,"endColumn":88,"suggestions":[{"messageId":"removeEscape","fix":{"range":[6898,6899],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[6898,6898],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":235,"column":89,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":235,"endColumn":90,"suggestions":[{"messageId":"removeEscape","fix":{"range":[6900,6901],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[6900,6900],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":261,"column":61,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":261,"endColumn":62,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7587,7588],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7587,7587],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":261,"column":63,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":261,"endColumn":64,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7589,7590],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7589,7589],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":261,"column":74,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":261,"endColumn":75,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7600,7601],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7600,7600],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":261,"column":76,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":261,"endColumn":77,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7602,7603],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7602,7602],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":274,"column":74,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":274,"endColumn":75,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7959,7960],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7959,7959],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":274,"column":76,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":274,"endColumn":77,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7961,7962],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7961,7961],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":274,"column":89,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":274,"endColumn":90,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7974,7975],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7974,7974],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":274,"column":91,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":274,"endColumn":92,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7976,7977],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7976,7976],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mimeType' is defined but never used. Allowed unused args must match /^_/u.","line":362,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":362,"endColumn":13},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":557,"column":84,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":557,"endColumn":85,"suggestions":[{"messageId":"removeEscape","fix":{"range":[16905,16906],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[16905,16905],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":557,"column":86,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":557,"endColumn":87,"suggestions":[{"messageId":"removeEscape","fix":{"range":[16907,16908],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[16907,16907],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":557,"column":97,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":557,"endColumn":98,"suggestions":[{"messageId":"removeEscape","fix":{"range":[16918,16919],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[16918,16918],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":557,"column":99,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":557,"endColumn":100,"suggestions":[{"messageId":"removeEscape","fix":{"range":[16920,16921],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[16920,16920],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":557,"column":118,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":557,"endColumn":119,"suggestions":[{"messageId":"removeEscape","fix":{"range":[16939,16940],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[16939,16939],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":557,"column":120,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":557,"endColumn":121,"suggestions":[{"messageId":"removeEscape","fix":{"range":[16941,16942],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[16941,16941],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":557,"column":133,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":557,"endColumn":134,"suggestions":[{"messageId":"removeEscape","fix":{"range":[16954,16955],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[16954,16954],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":557,"column":135,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":557,"endColumn":136,"suggestions":[{"messageId":"removeEscape","fix":{"range":[16956,16957],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[16956,16956],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":569,"column":101,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":569,"endColumn":102,"suggestions":[{"messageId":"removeEscape","fix":{"range":[17398,17399],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[17398,17398],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":569,"column":103,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":569,"endColumn":104,"suggestions":[{"messageId":"removeEscape","fix":{"range":[17400,17401],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[17400,17400],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":569,"column":114,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":569,"endColumn":115,"suggestions":[{"messageId":"removeEscape","fix":{"range":[17411,17412],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[17411,17411],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":569,"column":116,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":569,"endColumn":117,"suggestions":[{"messageId":"removeEscape","fix":{"range":[17413,17414],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[17413,17413],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":569,"column":135,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":569,"endColumn":136,"suggestions":[{"messageId":"removeEscape","fix":{"range":[17432,17433],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[17432,17432],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":569,"column":137,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":569,"endColumn":138,"suggestions":[{"messageId":"removeEscape","fix":{"range":[17434,17435],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[17434,17434],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":569,"column":150,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":569,"endColumn":151,"suggestions":[{"messageId":"removeEscape","fix":{"range":[17447,17448],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[17447,17447],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":569,"column":152,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":569,"endColumn":153,"suggestions":[{"messageId":"removeEscape","fix":{"range":[17449,17450],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[17449,17449],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":635,"column":48,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":635,"endColumn":49,"suggestions":[{"messageId":"removeEscape","fix":{"range":[19597,19598],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[19597,19597],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":635,"column":50,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":635,"endColumn":51,"suggestions":[{"messageId":"removeEscape","fix":{"range":[19599,19600],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[19599,19599],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":635,"column":65,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":635,"endColumn":66,"suggestions":[{"messageId":"removeEscape","fix":{"range":[19614,19615],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[19614,19614],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":635,"column":67,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":635,"endColumn":68,"suggestions":[{"messageId":"removeEscape","fix":{"range":[19616,19617],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[19616,19616],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'docType' is defined but never used. Allowed unused args must match /^_/u.","line":724,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":724,"endColumn":12}],"suppressedMessages":[],"errorCount":56,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Automated Document Classification Service\n * \n * Uses AI to automatically classify and extract information from uploaded documents\n * - Document type detection (passport, visa, DBS, training certificates, etc.)\n * - Expiry date extraction\n * - Authority classification (Home Office vs CQC)\n * - Data extraction for verification\n */\n\nimport { ALL_COMPLIANCE_DOCUMENTS, ComplianceAuthority, DocumentTypeId } from './complianceTypes';\n\n// ===========================================\n// TYPES\n// ===========================================\n\nexport interface ClassificationResult {\n  documentTypeId: string;\n  documentTypeName: string;\n  authority: ComplianceAuthority;\n  confidence: number;\n  extractedData: ExtractedDocumentData;\n  suggestions: string[];\n  needsManualReview: boolean;\n  reviewReasons?: string[];\n}\n\nexport interface ExtractedDocumentData {\n  // Common fields\n  documentNumber?: string;\n  issueDate?: string;\n  expiryDate?: string;\n  issuingAuthority?: string;\n  \n  // Person details\n  fullName?: string;\n  dateOfBirth?: string;\n  nationality?: string;\n  \n  // Document-specific\n  passportNumber?: string;\n  visaType?: string;\n  visaStatus?: string;\n  brpNumber?: string;\n  shareCode?: string;\n  niNumber?: string;\n  dbsNumber?: string;\n  dbsLevel?: string;\n  nmcPin?: string;\n  qualificationLevel?: string;\n  qualificationTitle?: string;\n  trainingType?: string;\n  trainingProvider?: string;\n  \n  // Raw text for manual review\n  rawText?: string;\n}\n\nexport interface DocumentPattern {\n  type: DocumentTypeId;\n  patterns: RegExp[];\n  keywords: string[];\n  requiredFields: string[];\n  expiryPattern?: RegExp;\n  numberPattern?: RegExp;\n}\n\n// ===========================================\n// DOCUMENT PATTERNS\n// ===========================================\n\nconst DOCUMENT_PATTERNS: DocumentPattern[] = [\n  // Passport\n  {\n    type: 'rtw_passport',\n    patterns: [\n      /passport/i,\n      /travel\\s*document/i,\n      /nationality.*british|british.*nationality/i\n    ],\n    keywords: ['passport', 'travel document', 'nationality', 'place of birth', 'date of issue', 'date of expiry'],\n    requiredFields: ['fullName', 'passportNumber', 'dateOfBirth', 'expiryDate', 'nationality'],\n    expiryPattern: /(?:date\\s*of\\s*)?expiry[:\\s]*(\\d{1,2}[\\s\\/\\-]\\w{3}[\\s\\/\\-]\\d{4}|\\d{1,2}[\\s\\/\\-]\\d{1,2}[\\s\\/\\-]\\d{4})/i,\n    numberPattern: /passport\\s*(?:no\\.?|number)[:\\s]*([A-Z0-9]{9})/i\n  },\n  \n  // Visa\n  {\n    type: 'rtw_visa',\n    patterns: [\n      /visa/i,\n      /entry\\s*clearance/i,\n      /leave\\s*to\\s*(?:enter|remain)/i,\n      /immigration.*status/i\n    ],\n    keywords: ['visa', 'entry clearance', 'leave to remain', 'work permit', 'skilled worker', 'tier 2'],\n    requiredFields: ['visaType', 'expiryDate'],\n    expiryPattern: /(?:valid\\s*(?:until|to)|expir[yies])[:\\s]*(\\d{1,2}[\\s\\/\\-]\\w{3}[\\s\\/\\-]\\d{4}|\\d{1,2}[\\s\\/\\-]\\d{1,2}[\\s\\/\\-]\\d{4})/i\n  },\n  \n  // BRP\n  {\n    type: 'rtw_brp',\n    patterns: [\n      /biometric\\s*residence\\s*permit/i,\n      /brp/i,\n      /residence\\s*permit/i\n    ],\n    keywords: ['biometric residence permit', 'brp', 'immigration', 'home office'],\n    requiredFields: ['brpNumber', 'expiryDate'],\n    expiryPattern: /expiry[:\\s]*(\\d{1,2}[\\s\\/\\-]\\w{3}[\\s\\/\\-]\\d{4})/i,\n    numberPattern: /(?:brp|permit)\\s*(?:no\\.?|number)[:\\s]*([A-Z]{2}\\d{7})/i\n  },\n  \n  // Share Code\n  {\n    type: 'rtw_share_code',\n    patterns: [\n      /share\\s*code/i,\n      /right\\s*to\\s*work\\s*share\\s*code/i,\n      /gov\\.uk.*share.*code/i\n    ],\n    keywords: ['share code', 'right to work', 'immigration status', 'view your status'],\n    requiredFields: ['shareCode', 'expiryDate'],\n    numberPattern: /share\\s*code[:\\s]*([A-Z0-9]{9})/i\n  },\n  \n  // National Insurance\n  {\n    type: 'national_insurance',\n    patterns: [\n      /national\\s*insurance/i,\n      /ni\\s*number/i,\n      /hmrc.*national\\s*insurance/i\n    ],\n    keywords: ['national insurance', 'ni number', 'hmrc', 'insurance number'],\n    requiredFields: ['niNumber'],\n    numberPattern: /(?:ni|national\\s*insurance)\\s*(?:no\\.?|number)?[:\\s]*([A-Z]{2}\\d{6}[A-Z])/i\n  },\n  \n  // Birth Certificate\n  {\n    type: 'birth_certificate',\n    patterns: [\n      /birth\\s*certificate/i,\n      /certified\\s*copy.*birth/i,\n      /register\\s*of\\s*births/i\n    ],\n    keywords: ['birth certificate', 'register of births', 'registration district'],\n    requiredFields: ['fullName', 'dateOfBirth']\n  },\n  \n  // DBS Certificate\n  {\n    type: 'dbs_certificate',\n    patterns: [\n      /dbs/i,\n      /disclosure.*barring/i,\n      /enhanced\\s*(?:dbs|disclosure)/i,\n      /police\\s*check/i\n    ],\n    keywords: ['dbs', 'disclosure and barring', 'enhanced check', 'barred list', 'police check'],\n    requiredFields: ['dbsNumber', 'issueDate', 'dbsLevel'],\n    numberPattern: /(?:dbs|certificate)\\s*(?:no\\.?|number)[:\\s]*(\\d{12})/i\n  },\n  \n  // DBS Update Service\n  {\n    type: 'dbs_update_service',\n    patterns: [\n      /update\\s*service/i,\n      /dbs\\s*update/i,\n      /subscription.*dbs/i\n    ],\n    keywords: ['update service', 'dbs online', 'subscription', 'annual fee'],\n    requiredFields: ['dbsNumber', 'expiryDate']\n  },\n  \n  // Care Certificate\n  {\n    type: 'care_certificate',\n    patterns: [\n      /care\\s*certificate/i,\n      /skills\\s*for\\s*care/i,\n      /15\\s*standards/i\n    ],\n    keywords: ['care certificate', 'skills for care', 'standards', 'health and social care'],\n    requiredFields: ['issueDate']\n  },\n  \n  // NVQ/QCF Qualification\n  {\n    type: 'nvq_qualification',\n    patterns: [\n      /nvq/i,\n      /qcf/i,\n      /level\\s*[2-5].*health.*social\\s*care/i,\n      /diploma.*health.*social\\s*care/i\n    ],\n    keywords: ['nvq', 'qcf', 'diploma', 'health and social care', 'level 2', 'level 3', 'level 4', 'level 5'],\n    requiredFields: ['qualificationLevel', 'qualificationTitle', 'issueDate']\n  },\n  \n  // NMC PIN\n  {\n    type: 'nmc_pin',\n    patterns: [\n      /nmc/i,\n      /nursing.*midwifery\\s*council/i,\n      /registered\\s*nurse/i,\n      /pin\\s*number/i\n    ],\n    keywords: ['nmc', 'nursing and midwifery council', 'registered nurse', 'pin', 'registration'],\n    requiredFields: ['nmcPin', 'expiryDate'],\n    numberPattern: /(?:nmc|pin)[:\\s]*(\\d{2}[A-Z]\\d{4}[A-Z])/i,\n    expiryPattern: /(?:expiry|renewal)[:\\s]*(\\d{1,2}[\\s\\/\\-]\\w{3}[\\s\\/\\-]\\d{4})/i\n  },\n  \n  // Mandatory Training\n  {\n    type: 'mandatory_training',\n    patterns: [\n      /certificate.*training/i,\n      /training\\s*certificate/i,\n      /safeguarding/i,\n      /manual\\s*handling/i,\n      /first\\s*aid/i,\n      /fire\\s*safety/i,\n      /health.*safety/i,\n      /infection\\s*control/i\n    ],\n    keywords: ['training certificate', 'safeguarding', 'manual handling', 'first aid', 'fire safety', \n               'health and safety', 'infection control', 'food hygiene', 'medication', 'cpr'],\n    requiredFields: ['trainingType', 'issueDate', 'trainingProvider'],\n    expiryPattern: /(?:valid\\s*(?:until|to)|expir[yies])[:\\s]*(\\d{1,2}[\\s\\/\\-]\\w{3}[\\s\\/\\-]\\d{4})/i\n  },\n  \n  // Health Declaration\n  {\n    type: 'health_declaration',\n    patterns: [\n      /health\\s*declaration/i,\n      /fitness\\s*to\\s*work/i,\n      /medical\\s*declaration/i\n    ],\n    keywords: ['health declaration', 'fitness to work', 'medical condition', 'disability'],\n    requiredFields: []\n  },\n  \n  // Immunization Records\n  {\n    type: 'immunization_records',\n    patterns: [\n      /immuni[sz]ation/i,\n      /vaccination/i,\n      /hepatitis\\s*b/i,\n      /tb\\s*(?:test|screening)/i\n    ],\n    keywords: ['immunization', 'vaccination', 'hepatitis', 'tb', 'tuberculosis', 'vaccine'],\n    requiredFields: [],\n    expiryPattern: /(?:next\\s*dose|booster)[:\\s]*(\\d{1,2}[\\s\\/\\-]\\w{3}[\\s\\/\\-]\\d{4})/i\n  },\n  \n  // Photo ID\n  {\n    type: 'photo_id',\n    patterns: [\n      /driving\\s*licen[cs]e/i,\n      /photo\\s*id/i,\n      /identity\\s*card/i\n    ],\n    keywords: ['driving licence', 'photo id', 'identity card', 'dvla'],\n    requiredFields: ['fullName', 'documentNumber'],\n    expiryPattern: /(?:valid\\s*(?:until|to)|expir[yies])[:\\s]*(\\d{1,2}[\\s\\/\\-]\\d{1,2}[\\s\\/\\-]\\d{4})/i\n  },\n  \n  // Proof of Address\n  {\n    type: 'proof_of_address',\n    patterns: [\n      /utility\\s*bill/i,\n      /bank\\s*statement/i,\n      /council\\s*tax/i,\n      /proof.*address/i\n    ],\n    keywords: ['utility bill', 'bank statement', 'council tax', 'gas', 'electric', 'water', 'address'],\n    requiredFields: ['issueDate']\n  },\n  \n  // CV/Resume\n  {\n    type: 'cv_resume',\n    patterns: [\n      /curriculum\\s*vitae/i,\n      /\\bcv\\b/i,\n      /resume/i,\n      /personal\\s*statement/i\n    ],\n    keywords: ['cv', 'curriculum vitae', 'resume', 'experience', 'education', 'employment history'],\n    requiredFields: []\n  },\n  \n  // References\n  {\n    type: 'employment_references',\n    patterns: [\n      /reference/i,\n      /recommendation/i,\n      /employer.*reference/i\n    ],\n    keywords: ['reference', 'recommendation', 'employer', 'employment reference', 'character reference'],\n    requiredFields: []\n  },\n  \n  // Signed Contract\n  {\n    type: 'signed_contract',\n    patterns: [\n      /employment\\s*contract/i,\n      /contract\\s*of\\s*employment/i,\n      /terms.*conditions.*employment/i\n    ],\n    keywords: ['employment contract', 'contract of employment', 'terms and conditions', 'salary', 'hours'],\n    requiredFields: []\n  }\n];\n\n// ===========================================\n// TRAINING TYPE PATTERNS\n// ===========================================\n\nconst TRAINING_TYPE_PATTERNS: Record<string, RegExp[]> = {\n  safeguarding_adults: [/safeguarding.*adult/i, /adult.*safeguarding/i, /protection.*vulnerable.*adult/i],\n  safeguarding_children: [/safeguarding.*child/i, /child.*protection/i, /children.*safeguarding/i],\n  health_safety: [/health.*safety/i, /h\\s*&\\s*s/i, /workplace\\s*safety/i],\n  fire_safety: [/fire\\s*safety/i, /fire\\s*awareness/i, /fire\\s*marshal/i, /fire\\s*warden/i],\n  first_aid: [/first\\s*aid/i, /emergency\\s*first\\s*aid/i, /paediatric\\s*first\\s*aid/i],\n  manual_handling: [/manual\\s*handling/i, /moving.*handling/i, /people\\s*handling/i],\n  medication_admin: [/medication/i, /medicine.*management/i, /administering.*medication/i],\n  infection_control: [/infection\\s*control/i, /infection\\s*prevention/i, /hand\\s*hygiene/i],\n  mental_capacity: [/mental\\s*capacity/i, /mca/i, /capacity\\s*act/i],\n  deprivation_liberty: [/dols/i, /deprivation.*liberty/i, /liberty.*safeguards/i],\n  food_hygiene: [/food\\s*hygiene/i, /food\\s*safety/i, /level\\s*2\\s*food/i],\n  gdpr_data: [/gdpr/i, /data\\s*protection/i, /information\\s*governance/i],\n  equality_diversity: [/equality/i, /diversity/i, /inclusion/i, /e\\s*&\\s*d/i],\n  dementia_awareness: [/dementia/i, /alzheimer/i, /memory.*care/i],\n  end_of_life: [/end\\s*of\\s*life/i, /palliative/i, /eolc/i]\n};\n\n// ===========================================\n// CLASSIFICATION SERVICE\n// ===========================================\n\nclass DocumentClassificationService {\n  \n  /**\n   * Classify a document based on its content\n   */\n  async classifyDocument(\n    fileContent: string,\n    fileName: string,\n    mimeType: string\n  ): Promise<ClassificationResult> {\n    // Normalize content for analysis\n    const normalizedContent = this.normalizeText(fileContent);\n    const normalizedFileName = fileName.toLowerCase();\n    \n    // Find best matching document type\n    const matchResults = DOCUMENT_PATTERNS.map(pattern => ({\n      pattern,\n      score: this.calculateMatchScore(normalizedContent, normalizedFileName, pattern)\n    }));\n    \n    // Sort by score\n    matchResults.sort((a, b) => b.score - a.score);\n    \n    const bestMatch = matchResults[0];\n    const secondBestMatch = matchResults[1];\n    \n    // Determine confidence\n    const confidence = this.calculateConfidence(bestMatch.score, secondBestMatch?.score || 0);\n    \n    // Extract data from document\n    const extractedData = this.extractDocumentData(normalizedContent, bestMatch.pattern);\n    \n    // Get document type info\n    const docType = ALL_COMPLIANCE_DOCUMENTS[bestMatch.pattern.type as keyof typeof ALL_COMPLIANCE_DOCUMENTS];\n    \n    // Determine if manual review is needed\n    const { needsReview, reasons } = this.determineReviewNeed(\n      confidence,\n      extractedData,\n      bestMatch.pattern.requiredFields,\n      docType\n    );\n    \n    // Generate suggestions\n    const suggestions = this.generateSuggestions(\n      extractedData,\n      bestMatch.pattern.requiredFields,\n      docType\n    );\n    \n    return {\n      documentTypeId: bestMatch.pattern.type,\n      documentTypeName: docType?.name || bestMatch.pattern.type,\n      authority: docType?.authority || 'INTERNAL',\n      confidence,\n      extractedData,\n      suggestions,\n      needsManualReview: needsReview,\n      reviewReasons: reasons\n    };\n  }\n\n  /**\n   * Classify document from file\n   */\n  async classifyFromFile(file: File): Promise<ClassificationResult> {\n    const text = await this.extractTextFromFile(file);\n    return this.classifyDocument(text, file.name, file.type);\n  }\n\n  /**\n   * Extract text from various file types\n   */\n  private async extractTextFromFile(file: File): Promise<string> {\n    // For PDFs and images, you would typically use OCR or PDF parsing\n    // This is a simplified version that handles text-based files\n    \n    if (file.type === 'text/plain' || file.type === 'application/json') {\n      return await file.text();\n    }\n    \n    // For other types, return filename-based classification\n    // In production, integrate with OCR service (e.g., Google Vision, AWS Textract)\n    return file.name;\n  }\n\n  /**\n   * Normalize text for consistent matching\n   */\n  private normalizeText(text: string): string {\n    return text\n      .toLowerCase()\n      .replace(/[\\r\\n]+/g, ' ')\n      .replace(/\\s+/g, ' ')\n      .trim();\n  }\n\n  /**\n   * Calculate match score for a document pattern\n   */\n  private calculateMatchScore(content: string, fileName: string, pattern: DocumentPattern): number {\n    let score = 0;\n    \n    // Check patterns in content\n    for (const regex of pattern.patterns) {\n      if (regex.test(content)) {\n        score += 20;\n      }\n      if (regex.test(fileName)) {\n        score += 15;\n      }\n    }\n    \n    // Check keywords\n    for (const keyword of pattern.keywords) {\n      if (content.includes(keyword.toLowerCase())) {\n        score += 10;\n      }\n      if (fileName.includes(keyword.toLowerCase().replace(/\\s+/g, '_'))) {\n        score += 5;\n      }\n    }\n    \n    // Bonus for extracted required fields\n    const extractedData = this.extractDocumentData(content, pattern);\n    const extractedFields = pattern.requiredFields.filter(\n      field => extractedData[field as keyof ExtractedDocumentData]\n    );\n    score += extractedFields.length * 15;\n    \n    return score;\n  }\n\n  /**\n   * Calculate confidence percentage\n   */\n  private calculateConfidence(bestScore: number, secondBestScore: number): number {\n    if (bestScore === 0) return 0;\n    \n    // Base confidence from absolute score\n    const baseConfidence = Math.min(100, bestScore);\n    \n    // Adjust based on gap between best and second best\n    const gap = bestScore - secondBestScore;\n    const gapBonus = Math.min(20, gap / 2);\n    \n    return Math.min(100, Math.round(baseConfidence * 0.7 + gapBonus * 1.5));\n  }\n\n  /**\n   * Extract relevant data from document content\n   */\n  private extractDocumentData(content: string, pattern: DocumentPattern): ExtractedDocumentData {\n    const data: ExtractedDocumentData = {\n      rawText: content.substring(0, 500) // Keep first 500 chars for reference\n    };\n    \n    // Extract expiry date\n    if (pattern.expiryPattern) {\n      const expiryMatch = content.match(pattern.expiryPattern);\n      if (expiryMatch) {\n        data.expiryDate = this.parseDate(expiryMatch[1]);\n      }\n    }\n    \n    // Extract document number\n    if (pattern.numberPattern) {\n      const numberMatch = content.match(pattern.numberPattern);\n      if (numberMatch) {\n        data.documentNumber = numberMatch[1];\n        \n        // Set specific field based on document type\n        switch (pattern.type) {\n          case 'rtw_passport':\n            data.passportNumber = numberMatch[1];\n            break;\n          case 'rtw_brp':\n            data.brpNumber = numberMatch[1];\n            break;\n          case 'rtw_share_code':\n            data.shareCode = numberMatch[1];\n            break;\n          case 'national_insurance':\n            data.niNumber = numberMatch[1];\n            break;\n          case 'dbs_certificate':\n          case 'dbs_update_service':\n            data.dbsNumber = numberMatch[1];\n            break;\n          case 'nmc_pin':\n            data.nmcPin = numberMatch[1];\n            break;\n        }\n      }\n    }\n    \n    // Extract name (common pattern)\n    const nameMatch = content.match(/(?:name|holder)[:\\s]*([A-Z][a-z]+(?:\\s+[A-Z][a-z]+)+)/i);\n    if (nameMatch) {\n      data.fullName = nameMatch[1].trim();\n    }\n    \n    // Extract date of birth\n    const dobMatch = content.match(/(?:date\\s*of\\s*birth|dob|born)[:\\s]*(\\d{1,2}[\\s\\/\\-]\\w{3}[\\s\\/\\-]\\d{4}|\\d{1,2}[\\s\\/\\-]\\d{1,2}[\\s\\/\\-]\\d{4})/i);\n    if (dobMatch) {\n      data.dateOfBirth = this.parseDate(dobMatch[1]);\n    }\n    \n    // Extract nationality\n    const nationalityMatch = content.match(/nationality[:\\s]*([A-Z][a-z]+(?:\\s+[A-Z][a-z]+)*)/i);\n    if (nationalityMatch) {\n      data.nationality = nationalityMatch[1].trim();\n    }\n    \n    // Extract issue date\n    const issueDateMatch = content.match(/(?:date\\s*of\\s*issue|issued|issue\\s*date)[:\\s]*(\\d{1,2}[\\s\\/\\-]\\w{3}[\\s\\/\\-]\\d{4}|\\d{1,2}[\\s\\/\\-]\\d{1,2}[\\s\\/\\-]\\d{4})/i);\n    if (issueDateMatch) {\n      data.issueDate = this.parseDate(issueDateMatch[1]);\n    }\n    \n    // Extract DBS level\n    if (pattern.type === 'dbs_certificate') {\n      if (/enhanced/i.test(content)) {\n        data.dbsLevel = 'Enhanced';\n        if (/adult.*first/i.test(content) || /child.*first/i.test(content)) {\n          data.dbsLevel += ' with Barred List';\n        }\n      } else if (/standard/i.test(content)) {\n        data.dbsLevel = 'Standard';\n      } else if (/basic/i.test(content)) {\n        data.dbsLevel = 'Basic';\n      }\n    }\n    \n    // Extract training type for training certificates\n    if (pattern.type === 'mandatory_training') {\n      data.trainingType = this.detectTrainingType(content);\n      \n      // Extract provider\n      const providerMatch = content.match(/(?:provider|delivered\\s*by|issued\\s*by)[:\\s]*([A-Za-z\\s]+?)(?:\\.|,|\\n|$)/i);\n      if (providerMatch) {\n        data.trainingProvider = providerMatch[1].trim();\n      }\n    }\n    \n    // Extract qualification level\n    if (pattern.type === 'nvq_qualification') {\n      const levelMatch = content.match(/level\\s*(\\d)/i);\n      if (levelMatch) {\n        data.qualificationLevel = `Level ${levelMatch[1]}`;\n      }\n      \n      const titleMatch = content.match(/(?:diploma|certificate|nvq|qcf)\\s*(?:in\\s*)?(.*?)(?:level|$)/i);\n      if (titleMatch) {\n        data.qualificationTitle = titleMatch[1].trim();\n      }\n    }\n    \n    // Extract visa type\n    if (pattern.type === 'rtw_visa') {\n      const visaTypes = ['skilled worker', 'tier 2', 'student', 'family', 'settlement', 'indefinite leave'];\n      for (const type of visaTypes) {\n        if (content.toLowerCase().includes(type)) {\n          data.visaType = type.split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');\n          break;\n        }\n      }\n    }\n    \n    return data;\n  }\n\n  /**\n   * Parse date string to ISO format\n   */\n  private parseDate(dateStr: string): string {\n    try {\n      // Try various formats\n      const cleanDate = dateStr.trim().replace(/\\s+/g, ' ');\n      \n      // DD/MM/YYYY or DD-MM-YYYY\n      let match = cleanDate.match(/(\\d{1,2})[\\s\\/\\-](\\d{1,2})[\\s\\/\\-](\\d{4})/);\n      if (match) {\n        const [, day, month, year] = match;\n        return `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;\n      }\n      \n      // DD MMM YYYY\n      match = cleanDate.match(/(\\d{1,2})\\s*([A-Za-z]{3})\\s*(\\d{4})/);\n      if (match) {\n        const [, day, monthStr, year] = match;\n        const months: Record<string, string> = {\n          jan: '01', feb: '02', mar: '03', apr: '04', may: '05', jun: '06',\n          jul: '07', aug: '08', sep: '09', oct: '10', nov: '11', dec: '12'\n        };\n        const month = months[monthStr.toLowerCase()];\n        if (month) {\n          return `${year}-${month}-${day.padStart(2, '0')}`;\n        }\n      }\n      \n      return dateStr;\n    } catch {\n      return dateStr;\n    }\n  }\n\n  /**\n   * Detect training type from content\n   */\n  private detectTrainingType(content: string): string {\n    for (const [type, patterns] of Object.entries(TRAINING_TYPE_PATTERNS)) {\n      for (const pattern of patterns) {\n        if (pattern.test(content)) {\n          return type;\n        }\n      }\n    }\n    return 'other';\n  }\n\n  /**\n   * Determine if manual review is needed\n   */\n  private determineReviewNeed(\n    confidence: number,\n    extractedData: ExtractedDocumentData,\n    requiredFields: string[],\n    docType: any\n  ): { needsReview: boolean; reasons: string[] } {\n    const reasons: string[] = [];\n    \n    // Low confidence\n    if (confidence < 70) {\n      reasons.push('Low classification confidence');\n    }\n    \n    // Missing required fields\n    const missingFields = requiredFields.filter(\n      field => !extractedData[field as keyof ExtractedDocumentData]\n    );\n    if (missingFields.length > 0) {\n      reasons.push(`Missing required fields: ${missingFields.join(', ')}`);\n    }\n    \n    // Expiry date in the past (might be invalid or renewed)\n    if (extractedData.expiryDate) {\n      const expiry = new Date(extractedData.expiryDate);\n      if (expiry < new Date()) {\n        reasons.push('Document appears to be expired');\n      }\n    }\n    \n    // Document requires verification\n    if (docType?.verificationRequired) {\n      reasons.push('Document type requires verification');\n    }\n    \n    return {\n      needsReview: reasons.length > 0,\n      reasons\n    };\n  }\n\n  /**\n   * Generate helpful suggestions\n   */\n  private generateSuggestions(\n    extractedData: ExtractedDocumentData,\n    requiredFields: string[],\n    docType: any\n  ): string[] {\n    const suggestions: string[] = [];\n    \n    // Missing fields suggestions\n    const missingFields = requiredFields.filter(\n      field => !extractedData[field as keyof ExtractedDocumentData]\n    );\n    \n    for (const field of missingFields) {\n      switch (field) {\n        case 'expiryDate':\n          suggestions.push('Please ensure the expiry date is clearly visible');\n          break;\n        case 'documentNumber':\n          suggestions.push('Ensure the document number is visible and not obscured');\n          break;\n        case 'fullName':\n          suggestions.push('The full name should be clearly visible');\n          break;\n        case 'dbsNumber':\n          suggestions.push('The 12-digit DBS certificate number should be visible');\n          break;\n        case 'nmcPin':\n          suggestions.push('Please ensure the NMC PIN is visible');\n          break;\n      }\n    }\n    \n    // Document quality suggestions\n    if (!extractedData.rawText || extractedData.rawText.length < 100) {\n      suggestions.push('Consider uploading a higher quality scan for better text extraction');\n    }\n    \n    // Expiry suggestions\n    if (extractedData.expiryDate) {\n      const expiry = new Date(extractedData.expiryDate);\n      const now = new Date();\n      const daysUntilExpiry = Math.floor((expiry.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));\n      \n      if (daysUntilExpiry < 0) {\n        suggestions.push('This document appears to be expired. Please upload a current version.');\n      } else if (daysUntilExpiry < 30) {\n        suggestions.push(`This document expires in ${daysUntilExpiry} days. Consider renewing soon.`);\n      }\n    }\n    \n    return suggestions;\n  }\n\n  /**\n   * Bulk classify multiple documents\n   */\n  async classifyMultiple(files: File[]): Promise<ClassificationResult[]> {\n    return Promise.all(files.map(file => this.classifyFromFile(file)));\n  }\n\n  /**\n   * Suggest document type from filename\n   */\n  suggestDocumentType(fileName: string): { typeId: string; typeName: string; confidence: number } | null {\n    const normalizedName = fileName.toLowerCase();\n    \n    for (const pattern of DOCUMENT_PATTERNS) {\n      for (const regex of pattern.patterns) {\n        if (regex.test(normalizedName)) {\n          const docType = ALL_COMPLIANCE_DOCUMENTS[pattern.type as keyof typeof ALL_COMPLIANCE_DOCUMENTS];\n          return {\n            typeId: pattern.type,\n            typeName: docType?.name || pattern.type,\n            confidence: 60\n          };\n        }\n      }\n      \n      for (const keyword of pattern.keywords) {\n        if (normalizedName.includes(keyword.toLowerCase().replace(/\\s+/g, '_'))) {\n          const docType = ALL_COMPLIANCE_DOCUMENTS[pattern.type as keyof typeof ALL_COMPLIANCE_DOCUMENTS];\n          return {\n            typeId: pattern.type,\n            typeName: docType?.name || pattern.type,\n            confidence: 40\n          };\n        }\n      }\n    }\n    \n    return null;\n  }\n}\n\n// Export singleton instance\nexport const documentClassificationService = new DocumentClassificationService();\nexport default documentClassificationService;\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/compliance/complianceTypes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/compliance/deploySchema.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createClient' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SUPABASE_URL' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":16,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SUPABASE_KEY' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":17,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Compliance Schema Deployment Script\n * Deploys the compliance database schema to Supabase using the REST API\n */\n\nimport { createClient } from '@supabase/supabase-js';\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport { fileURLToPath } from 'url';\n\n// ESM compatibility\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\n// Supabase credentials\nconst SUPABASE_URL = 'https://niikshfoecitimepiifo.supabase.co';\nconst SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5paWtzaGZvZWNpdGltZXBpaWZvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNTIyMTUsImV4cCI6MjA3ODYyODIxNX0.4KzLoUez4xQ1_h-vpx1dOa1PrzvAbi65UC4Mf7JQAfc';\n\n// Note: To run DDL (CREATE TABLE, etc.), we need the service_role key\n// The anon key can only do SELECT/INSERT/UPDATE/DELETE on existing tables\n// \n// For now, let's create a simulated local test using the SQL files\n// and provide instructions for manual deployment\n\nconsole.log('âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ');\nconsole.log('     COMPLIANCE SCHEMA DEPLOYMENT');\nconsole.log('     NovumFlow & CareFlow Compliance System');\nconsole.log('âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ\\n');\n\n// Read and validate SQL files\nconst schemaPath = path.join(__dirname, 'complianceSchema.sql');\nconst sampleDataPath = path.join(__dirname, 'sampleData.sql');\n\nconsole.log('ð Checking SQL files...\\n');\n\nif (fs.existsSync(schemaPath)) {\n  const schemaContent = fs.readFileSync(schemaPath, 'utf-8');\n  const schemaLines = schemaContent.split('\\n').length;\n  console.log(`â complianceSchema.sql found (${schemaLines} lines)`);\n  \n  // Analyze schema content\n  const createTableCount = (schemaContent.match(/CREATE TABLE IF NOT EXISTS/g) || []).length;\n  const createTypeCount = (schemaContent.match(/CREATE TYPE/g) || []).length;\n  const createViewCount = (schemaContent.match(/CREATE OR REPLACE VIEW/g) || []).length;\n  const createFunctionCount = (schemaContent.match(/CREATE OR REPLACE FUNCTION/g) || []).length;\n  const createIndexCount = (schemaContent.match(/CREATE INDEX IF NOT EXISTS/g) || []).length;\n  \n  console.log(`   - Tables: ${createTableCount}`);\n  console.log(`   - Types/Enums: ${createTypeCount}`);\n  console.log(`   - Views: ${createViewCount}`);\n  console.log(`   - Functions: ${createFunctionCount}`);\n  console.log(`   - Indexes: ${createIndexCount}`);\n} else {\n  console.log('â complianceSchema.sql NOT FOUND');\n}\n\nconsole.log('');\n\nif (fs.existsSync(sampleDataPath)) {\n  const sampleContent = fs.readFileSync(sampleDataPath, 'utf-8');\n  const sampleLines = sampleContent.split('\\n').length;\n  console.log(`â sampleData.sql found (${sampleLines} lines)`);\n  \n  // Analyze sample data content\n  const insertCount = (sampleContent.match(/INSERT INTO/g) || []).length;\n  console.log(`   - INSERT statements: ${insertCount}`);\n} else {\n  console.log('â sampleData.sql NOT FOUND');\n}\n\nconsole.log('\\nâââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ');\nconsole.log('     DEPLOYMENT INSTRUCTIONS');\nconsole.log('âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ\\n');\n\nconsole.log('To deploy the compliance schema to Supabase:\\n');\nconsole.log('OPTION 1: Using Supabase Dashboard (Recommended)');\nconsole.log('âââââââââââââââââââââââââââââââââââââââââââââââââ');\nconsole.log('1. Go to: https://supabase.com/dashboard/project/niikshfoecitimepiifo/sql/new');\nconsole.log('2. Copy the ENTIRE contents of:');\nconsole.log('   src/lib/compliance/complianceSchema.sql');\nconsole.log('3. Paste into the SQL Editor');\nconsole.log('4. Click \"Run\" (or Ctrl+Enter)');\nconsole.log('5. Wait for completion (should see success notices)');\nconsole.log('');\nconsole.log('6. Then copy the ENTIRE contents of:');\nconsole.log('   src/lib/compliance/sampleData.sql');\nconsole.log('7. Paste into the SQL Editor');\nconsole.log('8. Click \"Run\"');\nconsole.log('');\nconsole.log('9. Run the test script again to verify:');\nconsole.log('   npx tsx src/lib/compliance/testSchema.ts');\nconsole.log('');\n\nconsole.log('OPTION 2: Using Supabase CLI');\nconsole.log('ââââââââââââââââââââââââââââ');\nconsole.log('# Install Supabase CLI if not already installed');\nconsole.log('npm install -g supabase');\nconsole.log('');\nconsole.log('# Login to Supabase');\nconsole.log('supabase login');\nconsole.log('');\nconsole.log('# Link to your project');\nconsole.log('supabase link --project-ref niikshfoecitimepiifo');\nconsole.log('');\nconsole.log('# Run the migrations');\nconsole.log('supabase db push');\nconsole.log('');\n\nconsole.log('OPTION 3: Using psql (if you have database URL)');\nconsole.log('âââââââââââââââââââââââââââââââââââââââââââââââ');\nconsole.log('# Get your database URL from Supabase Dashboard > Settings > Database');\nconsole.log('psql \"postgresql://postgres:[PASSWORD]@db.niikshfoecitimepiifo.supabase.co:5432/postgres\" < complianceSchema.sql');\nconsole.log('psql \"postgresql://postgres:[PASSWORD]@db.niikshfoecitimepiifo.supabase.co:5432/postgres\" < sampleData.sql');\nconsole.log('');\n\nconsole.log('âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ');\nconsole.log('     QUICK COPY COMMANDS');\nconsole.log('âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ\\n');\n\nconsole.log('Copy schema SQL to clipboard:');\nconsole.log('  cat src/lib/compliance/complianceSchema.sql | pbcopy  # macOS');\nconsole.log('  cat src/lib/compliance/complianceSchema.sql | xclip   # Linux');\nconsole.log('');\nconsole.log('Copy sample data SQL to clipboard:');\nconsole.log('  cat src/lib/compliance/sampleData.sql | pbcopy       # macOS');\nconsole.log('  cat src/lib/compliance/sampleData.sql | xclip        # Linux');\nconsole.log('');\n\n// Output the schema file content for easy copying\nconsole.log('âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ');\nconsole.log('     SCHEMA FILE LOCATION');\nconsole.log('âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ\\n');\nconsole.log('Full path to schema file:');\nconsole.log(`  ${schemaPath}`);\nconsole.log('');\nconsole.log('Full path to sample data file:');\nconsole.log(`  ${sampleDataPath}`);\nconsole.log('');\n\n// Create a combined file for convenience\nconst combinedPath = path.join(__dirname, 'DEPLOY_ALL.sql');\nif (fs.existsSync(schemaPath) && fs.existsSync(sampleDataPath)) {\n  const schemaContent = fs.readFileSync(schemaPath, 'utf-8');\n  const sampleContent = fs.readFileSync(sampleDataPath, 'utf-8');\n  \n  const combined = `-- âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ\n-- COMBINED DEPLOYMENT FILE\n-- Run this entire file in Supabase SQL Editor\n-- âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ\n\n-- PART 1: SCHEMA\n${schemaContent}\n\n-- âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ\n-- PART 2: SAMPLE DATA\n-- âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ\n\n${sampleContent}\n`;\n  \n  fs.writeFileSync(combinedPath, combined);\n  console.log('â Created combined deployment file:');\n  console.log(`   ${combinedPath}`);\n  console.log('');\n  console.log('   You can copy this single file to deploy everything at once!');\n}\n\nconsole.log('\\nâââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ\\n');\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/compliance/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/compliance/runSchema.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fs' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'runSQL' is defined but never used. Allowed unused vars must match /^_/u.","line":24,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":28,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'executeSQLViaPgREST' is defined but never used. Allowed unused vars must match /^_/u.","line":56,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":56,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'managementUrl' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":64,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":64,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ext' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":93,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":93,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'enums' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":96,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":96,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'testData' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":118,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":118,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tables' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":130,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":130,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Run Compliance Schema on Supabase\n * Uses service_role key to execute DDL commands\n */\n\nimport { createClient } from '@supabase/supabase-js';\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\nconst SUPABASE_URL = 'https://niikshfoecitimepiifo.supabase.co';\nconst SUPABASE_SERVICE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5paWtzaGZvZWNpdGltZXBpaWZvIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MzA1MjIxNSwiZXhwIjoyMDc4NjI4MjE1fQ.sPu18Bb90PKUL_rTDLK6MPvgpS1FfduWq4H0xoNWlA8';\n\nconst supabase = createClient(SUPABASE_URL, SUPABASE_SERVICE_KEY, {\n  auth: {\n    autoRefreshToken: false,\n    persistSession: false\n  }\n});\n\nasync function runSQL(sql: string, description: string): Promise<boolean> {\n  console.log(`\\nð¦ Running: ${description}...`);\n  \n  try {\n    const { data, error } = await supabase.rpc('exec_sql', { sql_query: sql });\n    \n    if (error) {\n      // Try direct REST API if RPC doesn't exist\n      const response = await fetch(`${SUPABASE_URL}/rest/v1/rpc/exec_sql`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'apikey': SUPABASE_SERVICE_KEY,\n          'Authorization': `Bearer ${SUPABASE_SERVICE_KEY}`\n        },\n        body: JSON.stringify({ sql_query: sql })\n      });\n      \n      if (!response.ok) {\n        // Fallback: Use the SQL endpoint directly\n        throw new Error(`RPC not available: ${error.message}`);\n      }\n    }\n    \n    console.log(`â ${description} completed`);\n    return true;\n  } catch (err: any) {\n    console.error(`â Error in ${description}:`, err.message);\n    return false;\n  }\n}\n\nasync function executeSQLViaPgREST(sql: string): Promise<{ success: boolean; error?: string }> {\n  // Supabase doesn't have a direct SQL execution endpoint via REST\n  // We need to use the Management API or execute via PostgREST functions\n  \n  // Alternative: Use pg directly if available, or chunk the SQL\n  console.log('Attempting to execute SQL...');\n  \n  // For DDL, we need to use Supabase Management API\n  const managementUrl = `https://api.supabase.com/v1/projects/niikshfoecitimepiifo/database/query`;\n  \n  try {\n    const response = await fetch(`${SUPABASE_URL}/rest/v1/`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'apikey': SUPABASE_SERVICE_KEY,\n        'Authorization': `Bearer ${SUPABASE_SERVICE_KEY}`,\n        'Prefer': 'return=representation'\n      },\n      body: JSON.stringify({ query: sql })\n    });\n    \n    if (!response.ok) {\n      const text = await response.text();\n      return { success: false, error: text };\n    }\n    \n    return { success: true };\n  } catch (err: any) {\n    return { success: false, error: err.message };\n  }\n}\n\nasync function createTablesIndividually() {\n  console.log('ð Creating compliance tables individually...\\n');\n  \n  // 1. Create extension\n  const ext = `CREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";`;\n  \n  // 2. Create enums\n  const enums = `\nDO $$ \nBEGIN\n    IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = 'compliance_authority') THEN\n        CREATE TYPE compliance_authority AS ENUM ('HOME_OFFICE', 'CQC', 'BOTH', 'INTERNAL');\n    END IF;\n    IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = 'compliance_stage') THEN\n        CREATE TYPE compliance_stage AS ENUM ('APPLICATION', 'PRE_EMPLOYMENT', 'ONBOARDING', 'ONGOING', 'OFFBOARDING');\n    END IF;\n    IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = 'document_status') THEN\n        CREATE TYPE document_status AS ENUM ('PENDING', 'UPLOADED', 'UNDER_REVIEW', 'VERIFIED', 'REJECTED', 'EXPIRED', 'EXPIRING_SOON', 'NOT_APPLICABLE');\n    END IF;\n    IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = 'urgency_level') THEN\n        CREATE TYPE urgency_level AS ENUM ('CRITICAL', 'HIGH', 'MEDIUM', 'LOW');\n    END IF;\n    IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = 'compliance_person_type') THEN\n        CREATE TYPE compliance_person_type AS ENUM ('APPLICANT', 'CANDIDATE', 'NEW_HIRE', 'EMPLOYEE', 'FORMER_EMPLOYEE');\n    END IF;\nEND $$;\n`;\n\n  // Test connection first\n  const { data: testData, error: testError } = await supabase\n    .from('tenants')\n    .select('id')\n    .limit(1);\n    \n  if (testError && testError.code !== 'PGRST116') {\n    console.log('Connection test:', testError.message);\n  } else {\n    console.log('â Connected to Supabase successfully');\n  }\n  \n  // Try to check if tables exist\n  const { data: tables, error: tablesError } = await supabase\n    .from('compliance_persons')\n    .select('id')\n    .limit(1);\n    \n  if (!tablesError) {\n    console.log('â ï¸  compliance_persons table already exists!');\n    console.log('Schema may already be deployed. Checking other tables...');\n    \n    const { error: docsError } = await supabase.from('compliance_documents').select('id').limit(1);\n    const { error: typesError } = await supabase.from('compliance_document_types').select('id').limit(1);\n    \n    if (!docsError && !typesError) {\n      console.log('â All core tables exist. Schema is already deployed!');\n      return true;\n    }\n  }\n  \n  console.log('\\nð Tables need to be created.');\n  console.log('Since Supabase REST API cannot execute DDL directly,');\n  console.log('please run the SQL file manually in the Supabase SQL Editor.\\n');\n  \n  return false;\n}\n\nasync function main() {\n  console.log('='.repeat(60));\n  console.log('ð§ COMPLIANCE SCHEMA DEPLOYMENT');\n  console.log('='.repeat(60));\n  console.log(`Target: ${SUPABASE_URL}`);\n  console.log(`Time: ${new Date().toISOString()}`);\n  console.log('='.repeat(60));\n  \n  const result = await createTablesIndividually();\n  \n  if (!result) {\n    console.log('\\n' + '='.repeat(60));\n    console.log('ð¥ MANUAL DEPLOYMENT REQUIRED');\n    console.log('='.repeat(60));\n    console.log('\\nThe Supabase REST API cannot execute CREATE TABLE statements.');\n    console.log('Please use one of these methods:\\n');\n    console.log('1. Supabase SQL Editor (recommended):');\n    console.log('   https://supabase.com/dashboard/project/niikshfoecitimepiifo/sql/new');\n    console.log('   Copy contents of: src/lib/compliance/complianceSchema.sql');\n    console.log('   Then: src/lib/compliance/sampleData.sql\\n');\n    console.log('2. Download combined file:');\n    console.log('   https://8888-itb71nx7a4o65vu7gltti-5185f4aa.sandbox.novita.ai/COMPLIANCE_DEPLOY_COMPLETE.sql');\n    console.log('\\n' + '='.repeat(60));\n  }\n}\n\nmain().catch(console.error);\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/compliance/testSchema.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fs' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'path' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":56,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":56,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Compliance Schema Test Script\n * Tests the compliance database schema and sample data on Supabase\n */\n\nimport { createClient, SupabaseClient } from '@supabase/supabase-js';\nimport * as fs from 'fs';\nimport * as path from 'path';\n\n// Get Supabase credentials from environment\nconst SUPABASE_URL = process.env.VITE_SUPABASE_URL || 'https://niikshfoecitimepiifo.supabase.co';\nconst SUPABASE_KEY = process.env.VITE_SUPABASE_ANON_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5paWtzaGZvZWNpdGltZXBpaWZvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNTIyMTUsImV4cCI6MjA3ODYyODIxNX0.4KzLoUez4xQ1_h-vpx1dOa1PrzvAbi65UC4Mf7JQAfc';\n\ninterface TestResult {\n  test: string;\n  status: 'PASS' | 'FAIL' | 'SKIP';\n  message: string;\n  data?: any;\n}\n\nclass ComplianceSchemaTest {\n  private supabase: SupabaseClient;\n  private results: TestResult[] = [];\n\n  constructor() {\n    this.supabase = createClient(SUPABASE_URL, SUPABASE_KEY);\n  }\n\n  private log(test: string, status: 'PASS' | 'FAIL' | 'SKIP', message: string, data?: any) {\n    const emoji = status === 'PASS' ? 'â' : status === 'FAIL' ? 'â' : 'â­ï¸';\n    console.log(`${emoji} [${status}] ${test}: ${message}`);\n    this.results.push({ test, status, message, data });\n  }\n\n  // Test 1: Check if tables exist\n  async testTablesExist(): Promise<void> {\n    console.log('\\nð TEST 1: Checking if compliance tables exist...\\n');\n    \n    const tables = [\n      'tenants',\n      'compliance_persons',\n      'compliance_document_types',\n      'compliance_documents',\n      'compliance_folders',\n      'compliance_document_folders',\n      'compliance_checklists',\n      'compliance_stage_history',\n      'compliance_tasks',\n      'compliance_notifications',\n      'compliance_sync_log',\n      'compliance_audit_log'\n    ];\n\n    for (const table of tables) {\n      try {\n        const { data, error } = await this.supabase\n          .from(table)\n          .select('*')\n          .limit(1);\n\n        if (error) {\n          this.log(`Table ${table}`, 'FAIL', `Error: ${error.message}`);\n        } else {\n          this.log(`Table ${table}`, 'PASS', `Table exists`);\n        }\n      } catch (err: any) {\n        this.log(`Table ${table}`, 'FAIL', `Exception: ${err.message}`);\n      }\n    }\n  }\n\n  // Test 2: Check document types seeded\n  async testDocumentTypesSeeded(): Promise<void> {\n    console.log('\\nð TEST 2: Checking document types are seeded...\\n');\n    \n    try {\n      const { data, error, count } = await this.supabase\n        .from('compliance_document_types')\n        .select('*', { count: 'exact' });\n\n      if (error) {\n        this.log('Document Types Count', 'FAIL', `Error: ${error.message}`);\n        return;\n      }\n\n      const expectedCount = 28; // We seeded 28 document types\n      if (count && count >= expectedCount) {\n        this.log('Document Types Count', 'PASS', `Found ${count} document types (expected >= ${expectedCount})`);\n      } else {\n        this.log('Document Types Count', 'FAIL', `Found ${count} document types (expected >= ${expectedCount})`);\n      }\n\n      // Check specific document types\n      const requiredTypes = ['rtw_passport', 'dbs_certificate', 'nmc_pin', 'mandatory_training'];\n      for (const typeId of requiredTypes) {\n        const found = data?.find(d => d.id === typeId);\n        if (found) {\n          this.log(`Document Type: ${typeId}`, 'PASS', `Found: ${found.name}`);\n        } else {\n          this.log(`Document Type: ${typeId}`, 'FAIL', 'Not found');\n        }\n      }\n    } catch (err: any) {\n      this.log('Document Types', 'FAIL', `Exception: ${err.message}`);\n    }\n  }\n\n  // Test 3: Check sample persons\n  async testSamplePersons(): Promise<void> {\n    console.log('\\nð TEST 3: Checking sample compliance persons...\\n');\n    \n    try {\n      const { data, error, count } = await this.supabase\n        .from('compliance_persons')\n        .select('*', { count: 'exact' });\n\n      if (error) {\n        this.log('Persons Query', 'FAIL', `Error: ${error.message}`);\n        return;\n      }\n\n      if (count && count >= 7) {\n        this.log('Persons Count', 'PASS', `Found ${count} compliance persons`);\n      } else {\n        this.log('Persons Count', 'FAIL', `Found ${count} persons (expected >= 7)`);\n      }\n\n      // Check compliance statuses\n      const statuses = data?.reduce((acc: Record<string, number>, person: any) => {\n        acc[person.compliance_status] = (acc[person.compliance_status] || 0) + 1;\n        return acc;\n      }, {});\n      \n      console.log('  Compliance Status Distribution:', statuses);\n\n      // Check for critical case (expired visa)\n      const nonCompliant = data?.find((p: any) => p.compliance_status === 'NON_COMPLIANT');\n      if (nonCompliant) {\n        this.log('Non-Compliant Person', 'PASS', `Found: ${nonCompliant.full_name} (${nonCompliant.compliance_status})`);\n      } else {\n        this.log('Non-Compliant Person', 'SKIP', 'No non-compliant test case found');\n      }\n\n    } catch (err: any) {\n      this.log('Sample Persons', 'FAIL', `Exception: ${err.message}`);\n    }\n  }\n\n  // Test 4: Check sample documents\n  async testSampleDocuments(): Promise<void> {\n    console.log('\\nð TEST 4: Checking sample compliance documents...\\n');\n    \n    try {\n      const { data, error, count } = await this.supabase\n        .from('compliance_documents')\n        .select('*, compliance_persons(full_name)', { count: 'exact' });\n\n      if (error) {\n        this.log('Documents Query', 'FAIL', `Error: ${error.message}`);\n        return;\n      }\n\n      if (count && count >= 10) {\n        this.log('Documents Count', 'PASS', `Found ${count} compliance documents`);\n      } else {\n        this.log('Documents Count', 'FAIL', `Found ${count} documents (expected >= 10)`);\n      }\n\n      // Check for expired documents\n      const expired = data?.filter((d: any) => d.status === 'EXPIRED');\n      if (expired && expired.length > 0) {\n        this.log('Expired Documents', 'PASS', `Found ${expired.length} expired document(s)`);\n      } else {\n        this.log('Expired Documents', 'SKIP', 'No expired documents found');\n      }\n\n      // Check for expiring soon documents\n      const expiringSoon = data?.filter((d: any) => d.status === 'EXPIRING_SOON');\n      if (expiringSoon && expiringSoon.length > 0) {\n        this.log('Expiring Soon Documents', 'PASS', `Found ${expiringSoon.length} expiring document(s)`);\n      } else {\n        this.log('Expiring Soon Documents', 'SKIP', 'No expiring soon documents found');\n      }\n\n      // Check authority distribution\n      const authorities = data?.reduce((acc: Record<string, number>, doc: any) => {\n        acc[doc.authority] = (acc[doc.authority] || 0) + 1;\n        return acc;\n      }, {});\n      console.log('  Authority Distribution:', authorities);\n\n    } catch (err: any) {\n      this.log('Sample Documents', 'FAIL', `Exception: ${err.message}`);\n    }\n  }\n\n  // Test 5: Check smart folders\n  async testSmartFolders(): Promise<void> {\n    console.log('\\nð TEST 5: Checking smart folders...\\n');\n    \n    try {\n      const { data, error, count } = await this.supabase\n        .from('compliance_folders')\n        .select('*', { count: 'exact' });\n\n      if (error) {\n        this.log('Folders Query', 'FAIL', `Error: ${error.message}`);\n        return;\n      }\n\n      if (count && count >= 10) {\n        this.log('Folders Count', 'PASS', `Found ${count} smart folders`);\n      } else {\n        this.log('Folders Count', 'FAIL', `Found ${count} folders (expected >= 10)`);\n      }\n\n      // Check system folders\n      const systemFolders = data?.filter((f: any) => f.is_system_folder);\n      if (systemFolders && systemFolders.length > 0) {\n        this.log('System Folders', 'PASS', `Found ${systemFolders.length} system folder(s)`);\n      }\n\n      // List folders by authority\n      const byAuthority = data?.reduce((acc: Record<string, string[]>, folder: any) => {\n        if (!acc[folder.authority]) acc[folder.authority] = [];\n        acc[folder.authority].push(folder.name);\n        return acc;\n      }, {});\n      console.log('  Folders by Authority:', byAuthority);\n\n    } catch (err: any) {\n      this.log('Smart Folders', 'FAIL', `Exception: ${err.message}`);\n    }\n  }\n\n  // Test 6: Check compliance tasks\n  async testComplianceTasks(): Promise<void> {\n    console.log('\\nð TEST 6: Checking compliance tasks...\\n');\n    \n    try {\n      const { data, error, count } = await this.supabase\n        .from('compliance_tasks')\n        .select('*, compliance_persons(full_name)', { count: 'exact' });\n\n      if (error) {\n        this.log('Tasks Query', 'FAIL', `Error: ${error.message}`);\n        return;\n      }\n\n      if (count && count >= 3) {\n        this.log('Tasks Count', 'PASS', `Found ${count} compliance tasks`);\n      } else {\n        this.log('Tasks Count', 'FAIL', `Found ${count} tasks (expected >= 3)`);\n      }\n\n      // Check urgency distribution\n      const urgencies = data?.reduce((acc: Record<string, number>, task: any) => {\n        acc[task.urgency] = (acc[task.urgency] || 0) + 1;\n        return acc;\n      }, {});\n      console.log('  Task Urgency Distribution:', urgencies);\n\n      // Check for critical task\n      const critical = data?.find((t: any) => t.urgency === 'CRITICAL');\n      if (critical) {\n        this.log('Critical Task', 'PASS', `Found: \"${critical.title}\"`);\n      } else {\n        this.log('Critical Task', 'SKIP', 'No critical task found');\n      }\n\n    } catch (err: any) {\n      this.log('Compliance Tasks', 'FAIL', `Exception: ${err.message}`);\n    }\n  }\n\n  // Test 7: Check views work\n  async testViews(): Promise<void> {\n    console.log('\\nð TEST 7: Checking database views...\\n');\n    \n    // Test v_compliance_status view\n    try {\n      const { data, error } = await this.supabase\n        .from('v_compliance_status')\n        .select('*')\n        .limit(10);\n\n      if (error) {\n        this.log('View: v_compliance_status', 'FAIL', `Error: ${error.message}`);\n      } else {\n        this.log('View: v_compliance_status', 'PASS', `View works, returned ${data?.length} rows`);\n        if (data && data.length > 0) {\n          console.log('  Sample row:', JSON.stringify(data[0], null, 2).substring(0, 200) + '...');\n        }\n      }\n    } catch (err: any) {\n      this.log('View: v_compliance_status', 'FAIL', `Exception: ${err.message}`);\n    }\n\n    // Test v_expiring_documents view\n    try {\n      const { data, error } = await this.supabase\n        .from('v_expiring_documents')\n        .select('*')\n        .limit(10);\n\n      if (error) {\n        this.log('View: v_expiring_documents', 'FAIL', `Error: ${error.message}`);\n      } else {\n        this.log('View: v_expiring_documents', 'PASS', `View works, returned ${data?.length} rows`);\n        if (data && data.length > 0) {\n          data.forEach((doc: any) => {\n            console.log(`    - ${doc.full_name}: ${doc.document_type} expires in ${doc.days_until_expiry} days (${doc.urgency})`);\n          });\n        }\n      }\n    } catch (err: any) {\n      this.log('View: v_expiring_documents', 'FAIL', `Exception: ${err.message}`);\n    }\n  }\n\n  // Test 8: Test compliance score function (via RPC)\n  async testComplianceScoreFunction(): Promise<void> {\n    console.log('\\nð TEST 8: Testing compliance score calculation...\\n');\n    \n    try {\n      // Get a person ID to test\n      const { data: persons } = await this.supabase\n        .from('compliance_persons')\n        .select('id, full_name')\n        .limit(1);\n\n      if (!persons || persons.length === 0) {\n        this.log('Compliance Score Function', 'SKIP', 'No persons to test with');\n        return;\n      }\n\n      const personId = persons[0].id;\n      \n      // Call the function via RPC\n      const { data, error } = await this.supabase\n        .rpc('calculate_compliance_score', { p_person_id: personId });\n\n      if (error) {\n        // Function might not be exposed via RPC, that's okay\n        this.log('Compliance Score RPC', 'SKIP', `RPC not available: ${error.message}`);\n      } else {\n        this.log('Compliance Score RPC', 'PASS', `Calculated for ${persons[0].full_name}: ${JSON.stringify(data)}`);\n      }\n    } catch (err: any) {\n      this.log('Compliance Score Function', 'SKIP', `Exception: ${err.message}`);\n    }\n  }\n\n  // Test 9: Check audit log\n  async testAuditLog(): Promise<void> {\n    console.log('\\nð TEST 9: Checking audit log...\\n');\n    \n    try {\n      const { data, error, count } = await this.supabase\n        .from('compliance_audit_log')\n        .select('*', { count: 'exact' })\n        .order('created_at', { ascending: false })\n        .limit(5);\n\n      if (error) {\n        this.log('Audit Log Query', 'FAIL', `Error: ${error.message}`);\n        return;\n      }\n\n      if (count && count >= 1) {\n        this.log('Audit Log', 'PASS', `Found ${count} audit log entries`);\n        data?.forEach((entry: any) => {\n          console.log(`    - ${entry.action} on ${entry.entity_type} by ${entry.user_email || 'system'}`);\n        });\n      } else {\n        this.log('Audit Log', 'SKIP', 'No audit log entries found');\n      }\n    } catch (err: any) {\n      this.log('Audit Log', 'FAIL', `Exception: ${err.message}`);\n    }\n  }\n\n  // Test 10: Check cross-app sync\n  async testSyncLog(): Promise<void> {\n    console.log('\\nð TEST 10: Checking cross-app sync log...\\n');\n    \n    try {\n      const { data, error, count } = await this.supabase\n        .from('compliance_sync_log')\n        .select('*', { count: 'exact' })\n        .limit(5);\n\n      if (error) {\n        this.log('Sync Log Query', 'FAIL', `Error: ${error.message}`);\n        return;\n      }\n\n      if (count && count >= 1) {\n        this.log('Sync Log', 'PASS', `Found ${count} sync log entries`);\n        data?.forEach((entry: any) => {\n          console.log(`    - ${entry.source_app} -> ${entry.target_app}: ${entry.sync_type} (${entry.status})`);\n        });\n      } else {\n        this.log('Sync Log', 'SKIP', 'No sync log entries found');\n      }\n    } catch (err: any) {\n      this.log('Sync Log', 'FAIL', `Exception: ${err.message}`);\n    }\n  }\n\n  // Run all tests\n  async runAllTests(): Promise<void> {\n    console.log('âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ');\n    console.log('     COMPLIANCE SCHEMA TEST SUITE');\n    console.log('     NovumFlow & CareFlow Compliance System');\n    console.log('âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ');\n    console.log(`\\nð Supabase URL: ${SUPABASE_URL}`);\n    console.log(`ð Test Date: ${new Date().toISOString()}\\n`);\n\n    await this.testTablesExist();\n    await this.testDocumentTypesSeeded();\n    await this.testSamplePersons();\n    await this.testSampleDocuments();\n    await this.testSmartFolders();\n    await this.testComplianceTasks();\n    await this.testViews();\n    await this.testComplianceScoreFunction();\n    await this.testAuditLog();\n    await this.testSyncLog();\n\n    // Summary\n    console.log('\\nâââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ');\n    console.log('     TEST SUMMARY');\n    console.log('âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ');\n    \n    const passed = this.results.filter(r => r.status === 'PASS').length;\n    const failed = this.results.filter(r => r.status === 'FAIL').length;\n    const skipped = this.results.filter(r => r.status === 'SKIP').length;\n    const total = this.results.length;\n\n    console.log(`\\n  â Passed:  ${passed}`);\n    console.log(`  â Failed:  ${failed}`);\n    console.log(`  â­ï¸  Skipped: ${skipped}`);\n    console.log(`  ð Total:   ${total}`);\n    \n    const successRate = ((passed / (total - skipped)) * 100).toFixed(1);\n    console.log(`\\n  ð Success Rate: ${successRate}%`);\n\n    if (failed > 0) {\n      console.log('\\n  â ï¸  SOME TESTS FAILED - Schema may need to be deployed');\n      console.log('  Run complianceSchema.sql in Supabase SQL Editor first!');\n    } else if (passed === 0) {\n      console.log('\\n  â ï¸  NO TESTS PASSED - Schema needs to be deployed');\n      console.log('  Steps:');\n      console.log('  1. Open Supabase Dashboard -> SQL Editor');\n      console.log('  2. Copy contents of complianceSchema.sql');\n      console.log('  3. Run the SQL');\n      console.log('  4. Copy contents of sampleData.sql');\n      console.log('  5. Run the SQL');\n      console.log('  6. Re-run this test');\n    } else {\n      console.log('\\n  ð ALL TESTS PASSED! Schema is working correctly.');\n    }\n\n    console.log('\\nâââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ\\n');\n  }\n}\n\n// Run tests\nconst test = new ComplianceSchemaTest();\ntest.runAllTests().catch(console.error);\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/compliance/validateSchema.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/documentEngine.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/employeeCrud.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/errorHandler.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/healthCheck.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/integrationEngine.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/logger.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/pwaUpdater.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/queryClient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/services/AuditService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/services/AutomationService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/services/ComplianceService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/services/EmailService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tenantService' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from '@/lib/supabase';\nimport { tenantService } from '@/lib/services/TenantService';\nimport { log } from '@/lib/logger';\n\ninterface EmailData {\n    [key: string]: unknown;\n}\n\ninterface EmailResult {\n    success: boolean;\n    data?: unknown;\n    error?: unknown;\n}\n\nexport class EmailService {\n    /**\n     * Send an email using Supabase Edge Function.\n     * In production, this calls a backend function which uses SendGrid or AWS SES.\n     */\n    static async sendEmail(\n        to: string,\n        subject: string,\n        templateId: string,\n        data: EmailData,\n        tenantId?: string\n    ): Promise<EmailResult> {\n\n        const { data: supaData, error } = await supabase.functions.invoke('send-email', {\n            body: { to, subject, templateId, data, tenantId }\n        });\n\n        if (error) {\n            log.error('Error sending email', error, {\n                component: 'EmailService',\n                metadata: { templateId, to: to.replace(/(.{2}).*@/, '$1***@') } // Mask email\n            });\n            return { success: false, error };\n        }\n\n        log.track('email_sent', {\n            component: 'EmailService',\n            metadata: { templateId, tenantId }\n        });\n\n        return { success: true, data: supaData };\n    }\n}\n\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/services/InterviewService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'config' is defined but never used. Allowed unused args must match /^_/u.","line":105,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":105,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\n\n// ============================================\n// TYPES\n// ============================================\n\ninterface InterviewConfig {\n    duration_minutes?: number;\n    location?: string;\n    interviewers?: string[];\n    notes?: string;\n    [key: string]: unknown;\n}\n\ninterface InterviewResult {\n    success: boolean;\n    interviewId?: string;\n    sessionId?: string;\n    error?: string;\n}\n\n// ============================================\n// INTERVIEW SERVICE\n// ============================================\n\nexport class InterviewService {\n    /**\n     * Schedule an interview for an application\n     */\n    static async scheduleInterview(\n        applicationId: string,\n        type: string,\n        config: InterviewConfig\n    ): Promise<InterviewResult> {\n        log.info(`Scheduling ${type} interview`, {\n            component: 'InterviewService',\n            action: 'schedule',\n            metadata: { applicationId, type }\n        });\n\n        const startTime = performance.now();\n\n        try {\n            // Simulate network delay for demo purposes\n            await new Promise(resolve => setTimeout(resolve, 1500));\n\n            if (applicationId) {\n                const scheduledDate = new Date(Date.now() + 86400000 * 3); // 3 days from now\n\n                const { data, error } = await supabase\n                    .from('interviews')\n                    .insert({\n                        application_id: applicationId,\n                        interview_type: type || 'general',\n                        scheduled_date: scheduledDate.toISOString(),\n                        status: 'scheduled',\n                        notes: config.notes || 'Automatically scheduled via workflow automation',\n                        duration_minutes: config.duration_minutes || 60,\n                        location: config.location\n                    })\n                    .select('id')\n                    .single();\n\n                if (error) {\n                    log.error('Failed to create interview record', error, {\n                        component: 'InterviewService',\n                        metadata: { applicationId }\n                    });\n                    throw error;\n                }\n\n                const duration = performance.now() - startTime;\n                log.performance('Schedule interview', duration, {\n                    component: 'InterviewService'\n                });\n\n                log.track('interview_scheduled', {\n                    component: 'InterviewService',\n                    metadata: { applicationId, type, interviewId: data?.id }\n                });\n\n                return {\n                    success: true,\n                    interviewId: data?.id || `int-${Date.now()}`\n                };\n            }\n\n            return { success: false, error: 'No application ID provided' };\n        } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            log.error('Interview scheduling failed', error, {\n                component: 'InterviewService',\n                metadata: { applicationId, type }\n            });\n            return { success: false, error: errorMessage };\n        }\n    }\n\n    /**\n     * Start an AI-powered interview session\n     */\n    static async startAIInterview(\n        applicationId: string,\n        config: InterviewConfig\n    ): Promise<InterviewResult> {\n        log.info('Starting AI interview', {\n            component: 'InterviewService',\n            action: 'ai_interview',\n            metadata: { applicationId }\n        });\n\n        const startTime = performance.now();\n\n        try {\n            // Simulate API call to AI interview provider\n            await new Promise(resolve => setTimeout(resolve, 2000));\n\n            const sessionId = `ai-session-${Date.now()}`;\n\n            const duration = performance.now() - startTime;\n            log.performance('Start AI interview', duration, {\n                component: 'InterviewService'\n            });\n\n            log.track('ai_interview_started', {\n                component: 'InterviewService',\n                metadata: { applicationId, sessionId }\n            });\n\n            return { success: true, sessionId };\n        } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            log.error('AI interview start failed', error, {\n                component: 'InterviewService',\n                metadata: { applicationId }\n            });\n            return { success: false, error: errorMessage };\n        }\n    }\n}\n\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/services/OnboardingService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/services/RightToWorkService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/services/TenantService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/supabase.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":163,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":163,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createClient, type SupabaseClient } from '@supabase/supabase-js';\nimport { log } from './logger';\n\n// Environment-based configuration\nconst isDevelopment = import.meta.env.MODE === 'development';\n\n// SECURITY: Enforce environment variables - no fallback credentials\nexport const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\nexport const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n\nlet supabaseInstance: SupabaseClient<any, \"public\", any> | null = null;\n\nexport function getSupabaseClient() {\n  if (supabaseInstance) {\n    return supabaseInstance;\n  }\n\n  // Validate required configuration\n  if (!supabaseUrl || !supabaseAnonKey) {\n    log.error('Missing Supabase configuration. Please set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY environment variables.', undefined, { component: 'SupabaseClient' });\n    return null;\n  }\n\n  // Development-only logging (handled by the logger)\n  if (isDevelopment) {\n    log.debug('Supabase Configuration', {\n      url: supabaseUrl,\n      key: supabaseAnonKey.substring(0, 20) + '...',\n      environment: import.meta.env.MODE\n    });\n  }\n\n  // Create Supabase client with optimized configuration\n  // Cast to ensure it's treated as a generic client compatible with missing types\n  // using <any, \"public\", any> to define Database, SchemaName, and Schema as permissive\n\n  if (typeof createClient === 'undefined') {\n    log.error('Supabase createClient is undefined. Check your dependencies.', undefined, { component: 'SupabaseClient' });\n    return null;\n  }\n\n  try {\n    supabaseInstance = createClient<any, \"public\", any>(supabaseUrl, supabaseAnonKey, {\n      global: {\n        headers: {\n          'Cache-Control': isDevelopment ? 'no-cache, no-store, must-revalidate' : 'public, max-age=300',\n          'Pragma': isDevelopment ? 'no-cache' : 'cache',\n          'Expires': isDevelopment ? '0' : '300'\n        }\n      },\n      db: {\n        schema: 'public'\n      },\n      auth: {\n        persistSession: true,\n        autoRefreshToken: true,\n        detectSessionInUrl: true,\n        storageKey: 'novumflow-auth-token',\n        // Enable cleaning up of checking for shared cookies on subdomains\n        flowType: 'pkce',\n        debug: isDevelopment,\n        //    // CRITICAL: Enable this in production for shared login between subdomains\n        //    // cookieOptions: {\n        //    //   name: 'novumflow-auth-token',\n        //    //   domain: '.novumflow.com', // Replace with your actual production domain\n        //    //   sameSite: 'lax',\n        //    //   secure: true,\n        //    //   maxAge: 60 * 60 * 24 * 365 // 1 year\n        //    // }\n      },\n      realtime: {\n        params: {\n          eventsPerSecond: 10\n        }\n      }\n    }) as SupabaseClient<any, \"public\", any>;\n  } catch (err) {\n    log.error('Failed to initialize Supabase client', err, { component: 'SupabaseClient' });\n    return null;\n  }\n\n  return supabaseInstance;\n}\n\nexport const supabase = getSupabaseClient();\n\nexport type UserRole = 'admin' | 'hr_manager' | 'recruiter' | 'employee' | 'carer' | 'staff' | 'inspector' | 'super_admin';\n\nexport interface UserProfile {\n  id: string;\n  user_id: string;\n  email: string;\n  full_name: string | null;\n  role: UserRole;\n  tenant_id: string | null;\n  avatar_url: string | null;\n  phone: string | null;\n  department: string | null;\n  position: string | null;\n  hire_date: string | null;\n  is_active: boolean;\n  preferences: any;\n  created_at: string;\n  is_super_admin?: boolean;\n  updated_at: string;\n}\n\nexport interface Tenant {\n  id: string;\n  name: string;\n  slug: string;\n  subscription_tier: string;\n  is_active: boolean;\n  settings: any;\n  created_at: string;\n  updated_at: string;\n}\n\n// Helper functions\nexport const isValidSupabaseUrl = (url: string): boolean => {\n  return url && (url.includes('supabase.co') || url.includes('localhost') || url.includes('127.0.0.1'));\n};\n\nexport const getCurrentUser = async () => {\n  const supabase = getSupabaseClient();\n  if (!supabase) return null;\n\n  const { data: { user }, error } = await supabase.auth.getUser();\n  if (error) {\n    log.error('Error getting current user', error, { component: 'SupabaseClient', action: 'getCurrentUser' });\n    return null;\n  }\n  return user;\n};\n\nexport const getCurrentUserProfile = async () => {\n  const user = await getCurrentUser();\n  if (!user) return null;\n\n  const supabase = getSupabaseClient();\n  if (!supabase) return null;\n\n  const { data: profile, error } = await supabase\n    .from('users_profiles')\n    .select('*')\n    .eq('user_id', user.id)\n    .single();\n\n  if (error) {\n    log.error('Error getting user profile', error, { component: 'SupabaseClient', action: 'getCurrentUserProfile', metadata: { userId: user.id } });\n    return null;\n  }\n\n  return profile as UserProfile;\n};\n\n// Connection test (development only)\nexport const testSupabaseConnection = async (): Promise<boolean> => {\n  try {\n    const supabase = getSupabaseClient();\n    if (!supabase) return false;\n\n    const { data, error } = await supabase\n      .from('users_profiles')\n      .select('id')\n      .limit(1);\n\n    if (error) {\n      log.error('Supabase connection test failed', error, { component: 'SupabaseClient', action: 'testSupabaseConnection' });\n      return false;\n    }\n\n    log.info('Supabase connection successful');\n    return true;\n  } catch (error) {\n    log.error('Supabase connection error', error, { component: 'SupabaseClient', action: 'testSupabaseConnection' });\n    return false;\n  }\n};\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/utils.ts","messages":[{"ruleId":"prefer-spread","severity":2,"message":"Use the spread operator instead of '.apply()'.","line":22,"column":7,"nodeType":"CallExpression","messageId":"preferSpread","endLine":22,"endColumn":29}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { clsx, ClassValue } from 'clsx';\nimport { twMerge } from 'tailwind-merge';\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n\n/**\n * Creates a debounced function that delays invoking func until after wait milliseconds\n */\nexport function debounce<T extends (...args: any[]) => any>(\n  func: T,\n  wait: number\n): (...args: Parameters<T>) => void {\n  let timeoutId: ReturnType<typeof setTimeout> | null = null;\n\n  return function (...args: Parameters<T>) {\n    if (timeoutId) {\n      clearTimeout(timeoutId);\n    }\n    timeoutId = setTimeout(() => {\n      func.apply(null, args);\n    }, wait);\n  };\n}\n\n/**\n * Format number with commas for display\n */\nexport function formatNumber(num: number): string {\n  return num.toLocaleString();\n}\n\n/**\n * Format currency\n */\nexport function formatCurrency(amount: number, currency: string = 'GBP'): string {\n  return new Intl.NumberFormat('en-GB', {\n    style: 'currency',\n    currency,\n  }).format(amount);\n}\n\n/**\n * Format percentage\n */\nexport function formatPercentage(value: number, decimals: number = 1): string {\n  return `${value.toFixed(decimals)}%`;\n}\n\n/**\n * Truncate text with ellipsis\n */\nexport function truncate(text: string, maxLength: number): string {\n  if (text.length <= maxLength) return text;\n  return text.slice(0, maxLength) + '...';\n}\n\n/**\n * Get initials from name\n */\nexport function getInitials(name: string): string {\n  return name\n    .split(' ')\n    .map(part => part.charAt(0))\n    .join('')\n    .toUpperCase()\n    .slice(0, 2);\n}\n\n/**\n * Generate random ID\n */\nexport function generateId(): string {\n  return Math.random().toString(36).substring(2, 15);\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/lib/workflowEngine.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'params' is defined but never used. Allowed unused args must match /^_/u.","line":353,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":353,"endColumn":54},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'params' is defined but never used. Allowed unused args must match /^_/u.","line":358,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":358,"endColumn":53}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Intelligent Workflow Automation Engine\n * Auto-progresses candidates, manages approvals, eliminates manual handoffs\n * Saves 20-30 manual handoffs per week\n */\n\nimport { log } from './logger';\n\nexport interface WorkflowRule {\n  id: string;\n  name: string;\n  trigger: WorkflowTrigger;\n  conditions: WorkflowCondition[];\n  actions: WorkflowAction[];\n  isActive: boolean;\n}\n\nexport interface WorkflowTrigger {\n  type: 'score_threshold' | 'time_elapsed' | 'status_change' | 'document_uploaded' | 'manual';\n  value?: any;\n  entity: 'application' | 'employee' | 'leave_request' | 'interview';\n}\n\nexport interface WorkflowCondition {\n  field: string;\n  operator: 'equals' | 'greater_than' | 'less_than' | 'contains' | 'not_null';\n  value: any;\n}\n\nexport interface WorkflowAction {\n  type: 'update_status' | 'send_notification' | 'schedule_interview' | 'generate_document' | 'assign_task' | 'escalate';\n  parameters: Record<string, any>;\n}\n\nexport interface NotificationRule {\n  id: string;\n  title: string;\n  message: string;\n  priority: 'low' | 'medium' | 'high' | 'urgent';\n  recipients: string[];\n  channels: ('email' | 'in_app' | 'sms')[];\n  frequency: 'immediate' | 'daily_digest' | 'weekly_summary';\n}\n\nexport class WorkflowAutomationEngine {\n  private rules: Map<string, WorkflowRule> = new Map();\n  private notifications: NotificationRule[] = [];\n\n  constructor() {\n    this.initializeDefaultRules();\n  }\n\n  private initializeDefaultRules() {\n    // Auto-progress high-scoring candidates\n    this.addRule({\n      id: 'auto_progress_high_scores',\n      name: 'Auto-progress High-Scoring Candidates',\n      trigger: {\n        type: 'score_threshold',\n        value: 8,\n        entity: 'application'\n      },\n      conditions: [\n        { field: 'status', operator: 'equals', value: 'screening' },\n        { field: 'score', operator: 'greater_than', value: 8 }\n      ],\n      actions: [\n        {\n          type: 'update_status',\n          parameters: { status: 'shortlisted' }\n        },\n        {\n          type: 'send_notification',\n          parameters: {\n            title: 'ð High-Scoring Candidate Detected',\n            message: 'Candidate {{candidate_name}} scored {{score}}/10 and has been automatically shortlisted.',\n            priority: 'high',\n            recipients: ['hiring_manager', 'hr_team']\n          }\n        }\n      ],\n      isActive: true\n    });\n\n    // Auto-schedule interviews for shortlisted candidates\n    this.addRule({\n      id: 'auto_schedule_interviews',\n      name: 'Auto-Schedule Interviews',\n      trigger: {\n        type: 'status_change',\n        value: 'shortlisted',\n        entity: 'application'\n      },\n      conditions: [\n        { field: 'status', operator: 'equals', value: 'shortlisted' }\n      ],\n      actions: [\n        {\n          type: 'send_notification',\n          parameters: {\n            title: 'ð Interview Scheduling Required',\n            message: 'Candidate {{candidate_name}} is ready for interview scheduling.',\n            priority: 'medium',\n            recipients: ['hiring_manager']\n          }\n        },\n        {\n          type: 'assign_task',\n          parameters: {\n            task: 'Schedule interview',\n            assignee: 'hiring_manager',\n            due_date: '+2_days'\n          }\n        }\n      ],\n      isActive: true\n    });\n\n    // Escalate overdue tasks\n    this.addRule({\n      id: 'escalate_overdue_tasks',\n      name: 'Escalate Overdue Tasks',\n      trigger: {\n        type: 'time_elapsed',\n        value: '3_days',\n        entity: 'application'\n      },\n      conditions: [\n        { field: 'status', operator: 'equals', value: 'interview_scheduled' },\n        { field: 'days_in_status', operator: 'greater_than', value: 3 }\n      ],\n      actions: [\n        {\n          type: 'escalate',\n          parameters: {\n            escalate_to: 'hr_director',\n            reason: 'Interview overdue'\n          }\n        },\n        {\n          type: 'send_notification',\n          parameters: {\n            title: 'â ï¸ Overdue Interview Alert',\n            message: 'Interview for {{candidate_name}} has been pending for {{days_overdue}} days.',\n            priority: 'urgent',\n            recipients: ['hr_director', 'hiring_manager']\n          }\n        }\n      ],\n      isActive: true\n    });\n\n    // Auto-approve low-risk leave requests\n    this.addRule({\n      id: 'auto_approve_leave',\n      name: 'Auto-Approve Low-Risk Leave',\n      trigger: {\n        type: 'status_change',\n        value: 'pending',\n        entity: 'leave_request'\n      },\n      conditions: [\n        { field: 'total_days', operator: 'less_than', value: 3 },\n        { field: 'employee_tenure', operator: 'greater_than', value: 6 },\n        { field: 'available_leave_days', operator: 'greater_than', value: 5 }\n      ],\n      actions: [\n        {\n          type: 'update_status',\n          parameters: { status: 'approved' }\n        },\n        {\n          type: 'send_notification',\n          parameters: {\n            title: 'â Leave Request Auto-Approved',\n            message: 'Your {{leave_type}} leave from {{start_date}} to {{end_date}} has been automatically approved.',\n            priority: 'medium',\n            recipients: ['employee']\n          }\n        }\n      ],\n      isActive: true\n    });\n\n    // Document completion reminders\n    this.addRule({\n      id: 'document_completion_reminder',\n      name: 'Document Completion Reminder',\n      trigger: {\n        type: 'time_elapsed',\n        value: '2_days',\n        entity: 'employee'\n      },\n      conditions: [\n        { field: 'onboarding_status', operator: 'equals', value: 'in_progress' },\n        { field: 'documents_completed', operator: 'less_than', value: 80 }\n      ],\n      actions: [\n        {\n          type: 'send_notification',\n          parameters: {\n            title: 'ð Onboarding Documents Reminder',\n            message: 'You have pending onboarding documents to complete. Please log in to finish your setup.',\n            priority: 'medium',\n            recipients: ['employee']\n          }\n        }\n      ],\n      isActive: true\n    });\n  }\n\n  addRule(rule: WorkflowRule) {\n    this.rules.set(rule.id, rule);\n  }\n\n  removeRule(ruleId: string) {\n    this.rules.delete(ruleId);\n  }\n\n  // Process entity changes and trigger workflows\n  async processEntity(entity: any, entityType: string, changeType: 'create' | 'update' | 'delete') {\n    const applicableRules = this.getApplicableRules(entity, entityType, changeType);\n\n    for (const rule of applicableRules) {\n      if (this.evaluateConditions(rule.conditions, entity)) {\n        await this.executeActions(rule.actions, entity, entityType);\n      }\n    }\n  }\n\n  private getApplicableRules(entity: any, entityType: string, changeType: string): WorkflowRule[] {\n    return Array.from(this.rules.values()).filter(rule => {\n      if (!rule.isActive) return false;\n      if (rule.trigger.entity !== entityType) return false;\n\n      switch (rule.trigger.type) {\n        case 'status_change':\n          return changeType === 'update' && entity.status === rule.trigger.value;\n        case 'score_threshold':\n          return entity.score >= rule.trigger.value;\n        case 'document_uploaded':\n          return changeType === 'create' && entity.type === 'document';\n        case 'time_elapsed':\n          // This would be handled by a scheduled job\n          return false;\n        default:\n          return false;\n      }\n    });\n  }\n\n  private evaluateConditions(conditions: WorkflowCondition[], entity: any): boolean {\n    return conditions.every(condition => {\n      const fieldValue = this.getFieldValue(entity, condition.field);\n\n      switch (condition.operator) {\n        case 'equals':\n          return fieldValue === condition.value;\n        case 'greater_than':\n          return fieldValue > condition.value;\n        case 'less_than':\n          return fieldValue < condition.value;\n        case 'contains':\n          return fieldValue?.toString().includes(condition.value);\n        case 'not_null':\n          return fieldValue != null;\n        default:\n          return false;\n      }\n    });\n  }\n\n  private getFieldValue(entity: any, field: string): any {\n    // Handle nested field access\n    return field.split('.').reduce((obj, key) => obj?.[key], entity);\n  }\n\n  private async executeActions(actions: WorkflowAction[], entity: any, entityType: string) {\n    for (const action of actions) {\n      await this.executeAction(action, entity, entityType);\n    }\n  }\n\n  private async executeAction(action: WorkflowAction, entity: any, entityType: string) {\n    switch (action.type) {\n      case 'update_status':\n        await this.updateEntityStatus(entity, action.parameters.status, entityType);\n        break;\n      case 'send_notification':\n        await this.sendNotification(action.parameters, entity);\n        break;\n      case 'schedule_interview':\n        await this.scheduleInterview(entity, action.parameters);\n        break;\n      case 'generate_document':\n        await this.generateDocument(entity, action.parameters);\n        break;\n      case 'assign_task':\n        await this.assignTask(entity, action.parameters);\n        break;\n      case 'escalate':\n        await this.escalateIssue(entity, action.parameters);\n        break;\n    }\n  }\n\n  private async updateEntityStatus(entity: any, status: string, entityType: string) {\n    // This would integrate with your backend API\n    log.info(`Updating ${entityType} ${entity.id} status to: ${status}`, { component: 'WorkflowAutomationEngine', action: 'updateEntityStatus', metadata: { entityType, entityId: entity.id, status } });\n\n    // Example API call:\n    // await fetch(`/api/${entityType}/${entity.id}`, {\n    //   method: 'PATCH',\n    //   body: JSON.stringify({ status })\n    // });\n  }\n\n  private async sendNotification(params: any, entity: any) {\n    const message = this.interpolateMessage(params.message, entity);\n    const title = this.interpolateMessage(params.title, entity);\n\n    const notification = {\n      id: `notif_${Date.now()}`,\n      title,\n      message,\n      priority: params.priority,\n      recipients: params.recipients,\n      timestamp: new Date(),\n      entity_id: entity.id,\n      read: false\n    };\n\n    // Store notification and trigger delivery\n    await this.deliverNotification(notification);\n  }\n\n  private interpolateMessage(template: string, entity: any): string {\n    return template.replace(/\\{\\{(\\w+)\\}\\}/g, (match, key) => {\n      return entity[key] || match;\n    });\n  }\n\n  private async deliverNotification(notification: any) {\n    // This would integrate with your notification system\n    log.info('Delivering notification', { component: 'WorkflowAutomationEngine', action: 'deliverNotification', metadata: { notification } });\n\n    // Store in database for in-app notifications\n    // Send emails/SMS based on user preferences\n    // Real-time push to connected clients\n  }\n\n  private async scheduleInterview(entity: any, params: any) {\n    // Auto-suggest interview slots based on availability\n    log.info(`Auto-scheduling interview for entity: ${entity.id}`, { component: 'WorkflowAutomationEngine', action: 'scheduleInterview' });\n  }\n\n  private async generateDocument(entity: any, params: any) {\n    // Trigger document generation\n    log.info(`Auto-generating document for entity: ${entity.id}`, { component: 'WorkflowAutomationEngine', action: 'generateDocument' });\n  }\n\n  private async assignTask(entity: any, params: any) {\n    // Create task assignment\n    log.info(`Assigning task: ${params.task} to: ${params.assignee}`, { component: 'WorkflowAutomationEngine', action: 'assignTask' });\n  }\n\n  private async escalateIssue(entity: any, params: any) {\n    // Escalate to higher authority\n    log.info(`Escalating issue to: ${params.escalate_to}`, { component: 'WorkflowAutomationEngine', action: 'escalateIssue' });\n  }\n\n  // Get all active rules\n  getActiveRules(): WorkflowRule[] {\n    return Array.from(this.rules.values()).filter(rule => rule.isActive);\n  }\n\n  // Toggle rule active status\n  toggleRule(ruleId: string, isActive: boolean) {\n    const rule = this.rules.get(ruleId);\n    if (rule) {\n      rule.isActive = isActive;\n    }\n  }\n\n  // Get workflow analytics\n  getWorkflowAnalytics(): {\n    total_rules: number;\n    active_rules: number;\n    automations_today: number;\n    time_saved_hours: number;\n  } {\n    const activeRules = this.getActiveRules().length;\n\n    return {\n      total_rules: this.rules.size,\n      active_rules: activeRules,\n      automations_today: 23, // This would come from actual data\n      time_saved_hours: activeRules * 2.5 // Estimated 2.5 hours saved per active rule\n    };\n  }\n}\n\n// Singleton instance\nexport const workflowEngine = new WorkflowAutomationEngine();","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/AdminPortalPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MoreVertical' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":61,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":73},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":21,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { Shield, Users, Building, Activity, Search, Filter, MoreVertical, CheckCircle, XCircle, Edit } from 'lucide-react';\nimport { toast } from 'sonner';\nimport EditTenantModal from '@/components/admin/EditTenantModal';\nimport { log } from '@/lib/logger';\n\ninterface Tenant {\n    id: string;\n    name: string;\n    subdomain: string;\n    subscription_tier: string;\n    subscription_status: string;\n    created_at: string;\n    member_count: number;\n    is_active: boolean; // Note: RPC might not return this if I didn't include it in SELECT\n}\n\nexport default function AdminPortalPage() {\n    const { user } = useAuth();\n    const [stats, setStats] = useState({\n        total_tenants: 0,\n        active_tenants: 0,\n        total_users: 0,\n        total_jobs: 0,\n        total_applications: 0,\n        total_mrr: 0\n    });\n    const [tenants, setTenants] = useState<Tenant[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState<string | null>(null);\n    const [searchTerm, setSearchTerm] = useState('');\n    const [selectedTenant, setSelectedTenant] = useState<Tenant | null>(null);\n    const [isEditModalOpen, setIsEditModalOpen] = useState(false);\n\n    useEffect(() => {\n        fetchTenants();\n        fetchStats();\n    }, []);\n\n    const fetchStats = async () => {\n        try {\n            const { data, error } = await supabase.rpc('get_platform_stats');\n            if (error) throw error;\n            if (data) setStats(data);\n        } catch (err) {\n            log.error('Error fetching stats', err, { component: 'AdminPortalPage' });\n        }\n    };\n\n    const fetchTenants = async () => {\n        try {\n            setLoading(true);\n            const { data, error } = await supabase.rpc('get_all_tenants');\n            if (error) throw error;\n            setTenants(data || []);\n        } catch (err) {\n            log.error('Error fetching tenants', err, { component: 'AdminPortalPage' });\n            const errorMessage = err instanceof Error ? err.message : 'Unknown error';\n            setError(errorMessage);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const toggleTenantStatus = async (tenantId: string, currentStatus: boolean) => {\n        try {\n            const { error } = await supabase.rpc('toggle_tenant_status', {\n                p_tenant_id: tenantId,\n                p_is_active: !currentStatus\n            });\n\n            if (error) throw error;\n\n            // Refresh list\n            fetchTenants();\n            fetchStats(); // Update stats too\n\n            log.security('tenant_status_toggled', {\n                component: 'AdminPortalPage',\n                metadata: { tenantId, newStatus: !currentStatus }\n            });\n\n            toast.success(`Tenant ${!currentStatus ? 'activated' : 'deactivated'} successfully`);\n        } catch (err) {\n            log.error('Error toggling tenant status', err, {\n                component: 'AdminPortalPage',\n                metadata: { tenantId }\n            });\n            toast.error('Failed to update tenant status');\n        }\n    };\n\n    const filteredTenants = tenants.filter(tenant =>\n        tenant.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        tenant.subdomain.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n\n    if (loading) {\n        return (\n            <div className=\"flex items-center justify-center min-h-screen\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-600\"></div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"min-h-screen bg-gray-50 p-8\">\n            <div className=\"max-w-7xl mx-auto\">\n                <div className=\"flex items-center justify-between mb-8\">\n                    <div>\n                        <h1 className=\"text-2xl font-bold text-gray-900 flex items-center gap-2\">\n                            <Shield className=\"w-8 h-8 text-cyan-600\" />\n                            Platform Admin\n                        </h1>\n                        <p className=\"text-gray-600\">Manage all organizations and subscriptions</p>\n                    </div>\n                    <div className=\"flex items-center gap-4\">\n                        <div className=\"bg-white p-4 rounded-lg shadow-sm border border-gray-200 flex items-center gap-3\">\n                            <div className=\"p-2 bg-blue-50 rounded-lg\">\n                                <Building className=\"w-5 h-5 text-blue-600\" />\n                            </div>\n                            <div>\n                                <p className=\"text-sm text-gray-500\">Total Tenants</p>\n                                <p className=\"text-xl font-bold text-gray-900\">{stats.total_tenants}</p>\n                                <p className=\"text-xs text-gray-500\">{stats.active_tenants} Active</p>\n                            </div>\n                        </div>\n                        <div className=\"bg-white p-4 rounded-lg shadow-sm border border-gray-200 flex items-center gap-3\">\n                            <div className=\"p-2 bg-green-50 rounded-lg\">\n                                <Users className=\"w-5 h-5 text-green-600\" />\n                            </div>\n                            <div>\n                                <p className=\"text-sm text-gray-500\">Total Users</p>\n                                <p className=\"text-xl font-bold text-gray-900\">{stats.total_users}</p>\n                            </div>\n                        </div>\n                        <div className=\"bg-white p-4 rounded-lg shadow-sm border border-gray-200 flex items-center gap-3\">\n                            <div className=\"p-2 bg-purple-50 rounded-lg\">\n                                <Activity className=\"w-5 h-5 text-purple-600\" />\n                            </div>\n                            <div>\n                                <p className=\"text-sm text-gray-500\">Est. MRR</p>\n                                <p className=\"text-xl font-bold text-gray-900\">${stats.total_mrr}</p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                {error && (\n                    <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6\">\n                        {error}\n                    </div>\n                )}\n\n                <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden\">\n                    <div className=\"p-4 border-b border-gray-200 flex items-center justify-between gap-4\">\n                        <div className=\"relative flex-1 max-w-md\">\n                            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                            <input\n                                type=\"text\"\n                                placeholder=\"Search organizations...\"\n                                value={searchTerm}\n                                onChange={(e) => setSearchTerm(e.target.value)}\n                                className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500\"\n                            />\n                        </div>\n                        <button className=\"flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-gray-700\">\n                            <Filter className=\"w-4 h-4\" />\n                            Filter\n                        </button>\n                    </div>\n\n                    <div className=\"overflow-x-auto\">\n                        <table className=\"w-full\">\n                            <thead className=\"bg-gray-50\">\n                                <tr>\n                                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Organization</th>\n                                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Plan</th>\n                                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Members</th>\n                                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Created</th>\n                                    <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n                                </tr>\n                            </thead>\n                            <tbody className=\"bg-white divide-y divide-gray-200\">\n                                {filteredTenants.map((tenant) => (\n                                    <tr key={tenant.id} className=\"hover:bg-gray-50\">\n                                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                                            <div className=\"flex items-center\">\n                                                <div className=\"h-10 w-10 flex-shrink-0 bg-cyan-100 rounded-lg flex items-center justify-center text-cyan-700 font-bold text-lg\">\n                                                    {tenant.name.charAt(0)}\n                                                </div>\n                                                <div className=\"ml-4\">\n                                                    <div className=\"text-sm font-medium text-gray-900\">{tenant.name}</div>\n                                                    <div className=\"text-sm text-gray-500\">{tenant.subdomain}.novumflow.com</div>\n                                                </div>\n                                            </div>\n                                        </td>\n                                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                                            <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full \n                                                ${tenant.subscription_tier === 'enterprise' ? 'bg-purple-100 text-purple-800' :\n                                                    tenant.subscription_tier === 'professional' ? 'bg-blue-100 text-blue-800' :\n                                                        'bg-gray-100 text-gray-800'}`}>\n                                                {tenant.subscription_tier.toUpperCase()}\n                                            </span>\n                                        </td>\n                                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                                            <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full \n                                                ${tenant.subscription_status === 'active' ? 'bg-green-100 text-green-800' :\n                                                    tenant.subscription_status === 'trial' ? 'bg-yellow-100 text-yellow-800' :\n                                                        'bg-red-100 text-red-800'}`}>\n                                                {tenant.subscription_status}\n                                            </span>\n                                        </td>\n                                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                                            <div className=\"flex items-center gap-1\">\n                                                <Users className=\"w-4 h-4\" />\n                                                {tenant.member_count}\n                                            </div>\n                                        </td>\n                                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                                            {new Date(tenant.created_at).toLocaleDateString()}\n                                        </td>\n                                        <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                                            <div className=\"flex items-center justify-end gap-2\">\n                                                <button\n                                                    onClick={() => {\n                                                        setSelectedTenant(tenant);\n                                                        setIsEditModalOpen(true);\n                                                    }}\n                                                    className=\"text-cyan-600 hover:text-cyan-900 p-1 hover:bg-cyan-50 rounded\"\n                                                    title=\"Edit Settings\"\n                                                >\n                                                    <Edit className=\"w-4 h-4\" />\n                                                </button>\n                                                <button\n                                                    onClick={() => toggleTenantStatus(tenant.id, tenant.is_active ?? true)}\n                                                    className={`${tenant.is_active !== false ? 'text-green-600 hover:text-green-900' : 'text-red-600 hover:text-red-900'} p-1 hover:bg-gray-50 rounded`}\n                                                    title={tenant.is_active !== false ? \"Disable Tenant\" : \"Enable Tenant\"}\n                                                >\n                                                    {tenant.is_active !== false ? <CheckCircle className=\"w-4 h-4\" /> : <XCircle className=\"w-4 h-4\" />}\n                                                </button>\n                                            </div>\n                                        </td>\n                                    </tr>\n                                ))}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n\n            <EditTenantModal\n                isOpen={isEditModalOpen}\n                onClose={() => {\n                    setIsEditModalOpen(false);\n                    setSelectedTenant(null);\n                }}\n                tenant={selectedTenant}\n                onSuccess={() => {\n                    fetchTenants();\n                }}\n            />\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/AdminSecurityDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BarChart' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Bar' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'XAxis' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'YAxis' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CartesianGrid' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":18},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":52,"column":8,"nodeType":"ArrayExpression","endLine":52,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [filter, loadData]","fix":{"range":[1311,1319],"text":"[filter, loadData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { Shield, AlertTriangle, Users, Lock, RefreshCw, Filter } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { log } from '@/lib/logger';\nimport {\n    BarChart,\n    Bar,\n    XAxis,\n    YAxis,\n    CartesianGrid,\n    Tooltip,\n    Legend,\n    ResponsiveContainer,\n    PieChart,\n    Pie,\n    Cell\n} from 'recharts';\n\ninterface SecurityEvent {\n    id: string;\n    event_type: string;\n    event_category: 'authentication' | 'authorization' | 'session' | 'password' | 'suspicious';\n    severity: 'info' | 'warning' | 'critical';\n    description: string;\n    email: string;\n    ip_address: string;\n    created_at: string;\n}\n\ninterface DashboardStats {\n    totalEvents: number;\n    failedLogins: number;\n    activeLockouts: number;\n    suspiciousActivities: number;\n}\n\nexport default function AdminSecurityDashboard() {\n    const [events, setEvents] = useState<SecurityEvent[]>([]);\n    const [stats, setStats] = useState<DashboardStats>({\n        totalEvents: 0,\n        failedLogins: 0,\n        activeLockouts: 0,\n        suspiciousActivities: 0\n    });\n    const [loading, setLoading] = useState(true);\n    const [filter, setFilter] = useState('all');\n\n    useEffect(() => {\n        loadData();\n    }, [filter]);\n\n    async function loadData() {\n        setLoading(true);\n        try {\n            // Fetch recent events from security_audit_logs\n            let query = supabase\n                .from('security_audit_logs')\n                .select('*')\n                .order('created_at', { ascending: false })\n                .limit(100);\n\n            if (filter !== 'all') {\n                query = query.eq('severity', filter);\n            }\n\n            const { data: eventData, error } = await query;\n\n            if (error) {\n                log.error('Error fetching security audit logs', error, { component: 'AdminSecurityDashboard', action: 'loadData' });\n                setEvents([]);\n            } else {\n                // Map the data to fit the SecurityEvent interface if field names differ\n                const mappedEvents: SecurityEvent[] = (eventData || []).map(e => ({\n                    id: e.id,\n                    event_type: e.event_type || 'Unknown',\n                    event_category: (e.details?.category || 'system') as any,\n                    severity: (e.severity === 'low' ? 'info' : e.severity === 'medium' ? 'warning' : e.severity) as any,\n                    description: e.details?.description || e.event_type || 'No description',\n                    email: e.user_email || 'System',\n                    ip_address: e.ip_address || '0.0.0.0',\n                    created_at: e.created_at\n                }));\n                setEvents(mappedEvents);\n            }\n\n            // Fetch stats\n            const { count: failedCount } = await supabase\n                .from('login_attempts')\n                .select('*', { count: 'exact', head: true })\n                .eq('attempt_status', 'failed');\n\n            const { count: lockoutCount } = await supabase\n                .from('account_lockouts')\n                .select('*', { count: 'exact', head: true })\n                .eq('is_active', true);\n\n            const { count: totalCount } = await supabase\n                .from('security_audit_logs')\n                .select('*', { count: 'exact', head: true });\n\n            // Suspicious activities could be high/critical severity events\n            const { count: suspCount } = await supabase\n                .from('security_audit_logs')\n                .select('*', { count: 'exact', head: true })\n                .in('severity', ['high', 'critical']);\n\n            setStats({\n                totalEvents: totalCount || 0,\n                failedLogins: failedCount || 0,\n                activeLockouts: lockoutCount || 0,\n                suspiciousActivities: suspCount || 0\n            });\n\n        } catch (err) {\n            log.error('Unexpected error loading dashboard', err, { component: 'AdminSecurityDashboard', action: 'loadData' });\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    const getSeverityColor = (severity: string) => {\n        switch (severity) {\n            case 'critical': return 'bg-red-100 text-red-800';\n            case 'warning': return 'bg-yellow-100 text-yellow-800';\n            default: return 'bg-blue-100 text-blue-800';\n        }\n    };\n\n    // Prepare Chart Data\n    const eventTypeData = events.reduce((acc: any[], event) => {\n        const existing = acc.find(item => item.name === event.event_category);\n        if (existing) {\n            existing.value++;\n        } else {\n            acc.push({ name: event.event_category, value: 1 });\n        }\n        return acc;\n    }, []);\n\n    const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884d8'];\n\n    return (\n        <div className=\"p-6\">\n            <div className=\"flex justify-between items-center mb-6\">\n                <div>\n                    <h1 className=\"text-2xl font-bold text-gray-900\">Security Dashboard</h1>\n                    <p className=\"text-sm text-gray-500\">Monitor system security and access logs</p>\n                </div>\n                <button\n                    onClick={loadData}\n                    className=\"flex items-center px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors\"\n                >\n                    <RefreshCw className={`w-4 h-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\n                    Refresh\n                </button>\n            </div>\n\n            {/* Stats Cards */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n                <div className=\"bg-white rounded-xl shadow-sm p-6 border border-gray-100\">\n                    <div className=\"flex items-center justify-between\">\n                        <div>\n                            <p className=\"text-sm font-medium text-gray-500\">Total Events</p>\n                            <h3 className=\"text-2xl font-bold text-gray-900\">{stats.totalEvents}</h3>\n                        </div>\n                        <div className=\"p-3 bg-blue-50 rounded-lg\">\n                            <Shield className=\"w-6 h-6 text-blue-600\" />\n                        </div>\n                    </div>\n                </div>\n\n                <div className=\"bg-white rounded-xl shadow-sm p-6 border border-gray-100\">\n                    <div className=\"flex items-center justify-between\">\n                        <div>\n                            <p className=\"text-sm font-medium text-gray-500\">Failed Logins</p>\n                            <h3 className=\"text-2xl font-bold text-gray-900\">{stats.failedLogins}</h3>\n                        </div>\n                        <div className=\"p-3 bg-red-50 rounded-lg\">\n                            <AlertTriangle className=\"w-6 h-6 text-red-600\" />\n                        </div>\n                    </div>\n                </div>\n\n                <div className=\"bg-white rounded-xl shadow-sm p-6 border border-gray-100\">\n                    <div className=\"flex items-center justify-between\">\n                        <div>\n                            <p className=\"text-sm font-medium text-gray-500\">Active Lockouts</p>\n                            <h3 className=\"text-2xl font-bold text-gray-900\">{stats.activeLockouts}</h3>\n                        </div>\n                        <div className=\"p-3 bg-orange-50 rounded-lg\">\n                            <Lock className=\"w-6 h-6 text-orange-600\" />\n                        </div>\n                    </div>\n                </div>\n\n                <div className=\"bg-white rounded-xl shadow-sm p-6 border border-gray-100\">\n                    <div className=\"flex items-center justify-between\">\n                        <div>\n                            <p className=\"text-sm font-medium text-gray-500\">Suspicious Activity</p>\n                            <h3 className=\"text-2xl font-bold text-gray-900\">{stats.suspiciousActivities}</h3>\n                        </div>\n                        <div className=\"p-3 bg-purple-50 rounded-lg\">\n                            <Users className=\"w-6 h-6 text-purple-600\" />\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8\">\n                {/* Recent Events List */}\n                <div className=\"lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-200\">\n                    <div className=\"p-6 border-b border-gray-100 flex justify-between items-center\">\n                        <h2 className=\"text-lg font-semibold text-gray-900\">Recent Security Events</h2>\n                        <div className=\"flex items-center gap-2\">\n                            <Filter className=\"w-4 h-4 text-gray-400\" />\n                            <select\n                                value={filter}\n                                onChange={(e) => setFilter(e.target.value)}\n                                className=\"text-sm border-none bg-gray-50 rounded-md focus:ring-0\"\n                            >\n                                <option value=\"all\">All Severities</option>\n                                <option value=\"info\">Info</option>\n                                <option value=\"warning\">Warning</option>\n                                <option value=\"critical\">Critical</option>\n                            </select>\n                        </div>\n                    </div>\n                    <div className=\"overflow-x-auto\">\n                        <table className=\"w-full\">\n                            <thead className=\"bg-gray-50\">\n                                <tr>\n                                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Event</th>\n                                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">User/IP</th>\n                                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Severity</th>\n                                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Time</th>\n                                </tr>\n                            </thead>\n                            <tbody className=\"divide-y divide-gray-100\">\n                                {events.length > 0 ? (\n                                    events.map((event) => (\n                                        <tr key={event.id} className=\"hover:bg-gray-50\">\n                                            <td className=\"px-6 py-4\">\n                                                <div className=\"text-sm font-medium text-gray-900 capitalize\">\n                                                    {event.event_type.replace(/_/g, ' ')}\n                                                </div>\n                                                <div className=\"text-xs text-gray-500\">{event.event_category}</div>\n                                            </td>\n                                            <td className=\"px-6 py-4\">\n                                                <div className=\"text-sm text-gray-900\">{event.email || 'Unknown User'}</div>\n                                                <div className=\"text-xs text-gray-500\">{event.ip_address}</div>\n                                            </td>\n                                            <td className=\"px-6 py-4 whitespace-nowrap\">\n                                                <span className={`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${getSeverityColor(event.severity)}`}>\n                                                    {event.severity}\n                                                </span>\n                                            </td>\n                                            <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                                                {format(new Date(event.created_at), 'MMM dd, HH:mm')}\n                                            </td>\n                                        </tr>\n                                    ))\n                                ) : (\n                                    <tr>\n                                        <td colSpan={4} className=\"px-6 py-8 text-center text-gray-500\">\n                                            No security events found matching current filter.\n                                        </td>\n                                    </tr>\n                                )}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n\n                {/* Charts Section */}\n                <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n                    <h2 className=\"text-lg font-semibold text-gray-900 mb-6\">Event Categories</h2>\n                    <div className=\"h-64\">\n                        <ResponsiveContainer width=\"100%\" height=\"100%\">\n                            <PieChart>\n                                <Pie\n                                    data={eventTypeData}\n                                    cx=\"50%\"\n                                    cy=\"50%\"\n                                    innerRadius={60}\n                                    outerRadius={80}\n                                    fill=\"#8884d8\"\n                                    paddingAngle={5}\n                                    dataKey=\"value\"\n                                >\n                                    {eventTypeData.map((entry, index) => (\n                                        <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                                    ))}\n                                </Pie>\n                                <Tooltip />\n                                <Legend />\n                            </PieChart>\n                        </ResponsiveContainer>\n                    </div>\n\n                    <div className=\"mt-6 pt-6 border-t border-gray-100\">\n                        <h3 className=\"text-sm font-medium text-gray-900 mb-2\">Security Tip</h3>\n                        <p className=\"text-sm text-gray-500\">\n                            Review \"Critical\" events daily. High numbers of failed logins from unique IPs may indicate a targeted attack.\n                        </p>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/ApplicationDetailsModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/AttendancePage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/AuditLogPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Search' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Download' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used. Allowed unused vars must match /^_/u.","line":14,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'currentTenant' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":19,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":26},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadAuditLogs'. Either include it or remove the dependency array.","line":30,"column":8,"nodeType":"ArrayExpression","endLine":30,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [filters, loadAuditLogs]","fix":{"range":[896,905],"text":"[filters, loadAuditLogs]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { auditService, AuditLog, AuditSearchFilters } from '@/lib/services/AuditService';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { log } from '@/lib/logger';\nimport {\n    History,\n    Search,\n    Filter,\n    Download,\n    Eye,\n    Edit,\n    Trash2,\n    Plus,\n    Calendar\n} from 'lucide-react';\nimport { ExportButton } from '@/components/ExportButton';\n\nexport default function AuditLogPage() {\n    const { currentTenant } = useTenant();\n    const [logs, setLogs] = useState<AuditLog[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [filters, setFilters] = useState<AuditSearchFilters>({\n        limit: 50\n    });\n    const [selectedLog, setSelectedLog] = useState<AuditLog | null>(null);\n    const [showFilters, setShowFilters] = useState(false);\n\n    useEffect(() => {\n        loadAuditLogs();\n    }, [filters]);\n\n    const loadAuditLogs = async () => {\n        setLoading(true);\n        try {\n            const data = await auditService.search(filters);\n            setLogs(data);\n        } catch (error) {\n            log.error('Error loading audit logs', error, { component: 'AuditLogPage', action: 'loadAuditLogs' });\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const getActionIcon = (action: string) => {\n        switch (action) {\n            case 'CREATE': return <Plus className=\"w-4 h-4 text-green-600\" />;\n            case 'UPDATE': return <Edit className=\"w-4 h-4 text-blue-600\" />;\n            case 'DELETE': return <Trash2 className=\"w-4 h-4 text-red-600\" />;\n            case 'VIEW': return <Eye className=\"w-4 h-4 text-gray-600\" />;\n            default: return <History className=\"w-4 h-4 text-gray-600\" />;\n        }\n    };\n\n    const getActionColor = (action: string) => {\n        switch (action) {\n            case 'CREATE': return 'bg-green-100 text-green-800';\n            case 'UPDATE': return 'bg-blue-100 text-blue-800';\n            case 'DELETE': return 'bg-red-100 text-red-800';\n            case 'VIEW': return 'bg-gray-100 text-gray-800';\n            default: return 'bg-gray-100 text-gray-800';\n        }\n    };\n\n    const formatDate = (dateString: string) => {\n        const date = new Date(dateString);\n        return new Intl.DateTimeFormat('en-GB', {\n            day: '2-digit',\n            month: 'short',\n            year: 'numeric',\n            hour: '2-digit',\n            minute: '2-digit'\n        }).format(date);\n    };\n\n    return (\n        <div className=\"p-6 space-y-6\">\n            {/* Header */}\n            <div className=\"flex items-center justify-between\">\n                <div>\n                    <h1 className=\"text-2xl font-bold text-gray-900\">Audit Trail</h1>\n                    <p className=\"text-gray-600 mt-1\">Complete history of system actions and changes</p>\n                </div>\n                <div className=\"flex items-center gap-3\">\n                    <button\n                        onClick={() => setShowFilters(!showFilters)}\n                        className=\"flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50\"\n                    >\n                        <Filter className=\"w-4 h-4\" />\n                        Filters\n                    </button>\n                    <ExportButton\n                        data={logs}\n                        filename=\"audit-logs\"\n                        title=\"Audit Logs Export\"\n                        columns={[\n                            { key: 'created_at', label: 'Timestamp' },\n                            { key: 'user_email', label: 'User' },\n                            { key: 'action', label: 'Action' },\n                            { key: 'entity_type', label: 'Entity Type' },\n                            { key: 'entity_name', label: 'Entity Name' },\n                            { key: 'ip_address', label: 'IP Address' },\n                        ]}\n                    />\n                </div>\n            </div>\n\n            {/* Filters Panel */}\n            {showFilters && (\n                <div className=\"bg-white rounded-lg shadow p-6 space-y-4\">\n                    <h3 className=\"font-semibold text-gray-900\">Filter Audit Logs</h3>\n                    <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n                        <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                Action Type\n                            </label>\n                            <select\n                                value={filters.action || ''}\n                                onChange={(e) => setFilters({ ...filters, action: e.target.value as any || undefined })}\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500\"\n                            >\n                                <option value=\"\">All Actions</option>\n                                <option value=\"CREATE\">Create</option>\n                                <option value=\"UPDATE\">Update</option>\n                                <option value=\"DELETE\">Delete</option>\n                                <option value=\"VIEW\">View</option>\n                            </select>\n                        </div>\n\n                        <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                Entity Type\n                            </label>\n                            <select\n                                value={filters.entity_type || ''}\n                                onChange={(e) => setFilters({ ...filters, entity_type: e.target.value || undefined })}\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500\"\n                            >\n                                <option value=\"\">All Types</option>\n                                <option value=\"tenant\">Tenant</option>\n                                <option value=\"form\">Form</option>\n                                <option value=\"application\">Application</option>\n                                <option value=\"user\">User</option>\n                                <option value=\"dbs_check\">DBS Check</option>\n                                <option value=\"training\">Training</option>\n                                <option value=\"reference\">Reference</option>\n                            </select>\n                        </div>\n\n                        <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                Date From\n                            </label>\n                            <input\n                                type=\"date\"\n                                value={filters.date_from || ''}\n                                onChange={(e) => setFilters({ ...filters, date_from: e.target.value || undefined })}\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500\"\n                            />\n                        </div>\n\n                        <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                                Date To\n                            </label>\n                            <input\n                                type=\"date\"\n                                value={filters.date_to || ''}\n                                onChange={(e) => setFilters({ ...filters, date_to: e.target.value || undefined })}\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500\"\n                            />\n                        </div>\n                    </div>\n\n                    <div className=\"flex justify-end gap-2\">\n                        <button\n                            onClick={() => {\n                                setFilters({ limit: 50 });\n                                setShowFilters(false);\n                            }}\n                            className=\"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg\"\n                        >\n                            Clear Filters\n                        </button>\n                        <button\n                            onClick={() => setShowFilters(false)}\n                            className=\"px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700\"\n                        >\n                            Apply Filters\n                        </button>\n                    </div>\n                </div>\n            )}\n\n            {/* Audit Logs Table */}\n            <div className=\"bg-white rounded-lg shadow overflow-hidden\">\n                {loading ? (\n                    <div className=\"flex items-center justify-center h-64\">\n                        <div className=\"text-gray-500\">Loading audit logs...</div>\n                    </div>\n                ) : logs.length === 0 ? (\n                    <div className=\"flex flex-col items-center justify-center h-64 text-gray-500\">\n                        <History className=\"w-12 h-12 mb-2\" />\n                        <p>No audit logs found</p>\n                    </div>\n                ) : (\n                    <div className=\"overflow-x-auto\">\n                        <table className=\"w-full\">\n                            <thead className=\"bg-gray-50\">\n                                <tr>\n                                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\n                                        Timestamp\n                                    </th>\n                                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\n                                        User\n                                    </th>\n                                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\n                                        Action\n                                    </th>\n                                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\n                                        Entity\n                                    </th>\n                                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\n                                        Details\n                                    </th>\n                                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\n                                        Actions\n                                    </th>\n                                </tr>\n                            </thead>\n                            <tbody className=\"divide-y divide-gray-200\">\n                                {logs.map((log) => (\n                                    <tr key={log.id} className=\"hover:bg-gray-50\">\n                                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                                            {formatDate(log.created_at)}\n                                        </td>\n                                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                                            <div className=\"text-sm font-medium text-gray-900\">\n                                                {log.user_email || 'System'}\n                                            </div>\n                                        </td>\n                                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                                            <span className={`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${getActionColor(log.action)}`}>\n                                                {getActionIcon(log.action)}\n                                                {log.action}\n                                            </span>\n                                        </td>\n                                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                                            <div className=\"text-sm text-gray-900\">{log.entity_type}</div>\n                                            <div className=\"text-xs text-gray-500\">{log.entity_name}</div>\n                                        </td>\n                                        <td className=\"px-6 py-4\">\n                                            <div className=\"text-sm text-gray-600 max-w-md truncate\">\n                                                {log.changes?.fields_changed?.join(', ') || 'No changes recorded'}\n                                            </div>\n                                        </td>\n                                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                                            <button\n                                                onClick={() => setSelectedLog(log)}\n                                                className=\"text-cyan-600 hover:text-cyan-700 text-sm font-medium\"\n                                            >\n                                                View Details\n                                            </button>\n                                        </td>\n                                    </tr>\n                                ))}\n                            </tbody>\n                        </table>\n                    </div>\n                )}\n            </div>\n\n            {/* Details Modal */}\n            {selectedLog && (\n                <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n                    <div className=\"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto\">\n                        <div className=\"p-6 border-b border-gray-200\">\n                            <div className=\"flex items-center justify-between\">\n                                <h2 className=\"text-xl font-semibold text-gray-900\">Audit Log Details</h2>\n                                <button\n                                    onClick={() => setSelectedLog(null)}\n                                    className=\"text-gray-400 hover:text-gray-600\"\n                                >\n                                    â\n                                </button>\n                            </div>\n                        </div>\n\n                        <div className=\"p-6 space-y-4\">\n                            <div className=\"grid grid-cols-2 gap-4\">\n                                <div>\n                                    <label className=\"text-sm font-medium text-gray-500\">Timestamp</label>\n                                    <p className=\"text-gray-900 mt-1\">{formatDate(selectedLog.created_at)}</p>\n                                </div>\n                                <div>\n                                    <label className=\"text-sm font-medium text-gray-500\">User</label>\n                                    <p className=\"text-gray-900 mt-1\">{selectedLog.user_email || 'System'}</p>\n                                </div>\n                                <div>\n                                    <label className=\"text-sm font-medium text-gray-500\">Action</label>\n                                    <p className=\"text-gray-900 mt-1\">{selectedLog.action}</p>\n                                </div>\n                                <div>\n                                    <label className=\"text-sm font-medium text-gray-500\">Entity Type</label>\n                                    <p className=\"text-gray-900 mt-1\">{selectedLog.entity_type}</p>\n                                </div>\n                            </div>\n\n                            <div>\n                                <label className=\"text-sm font-medium text-gray-500\">Entity Name</label>\n                                <p className=\"text-gray-900 mt-1\">{selectedLog.entity_name}</p>\n                            </div>\n\n                            {selectedLog.changes && (\n                                <div className=\"space-y-3\">\n                                    {selectedLog.changes.before && (\n                                        <div>\n                                            <label className=\"text-sm font-medium text-gray-500\">Before</label>\n                                            <pre className=\"mt-1 p-3 bg-gray-50 rounded-lg text-xs overflow-x-auto\">\n                                                {JSON.stringify(selectedLog.changes.before, null, 2)}\n                                            </pre>\n                                        </div>\n                                    )}\n\n                                    {selectedLog.changes.after && (\n                                        <div>\n                                            <label className=\"text-sm font-medium text-gray-500\">After</label>\n                                            <pre className=\"mt-1 p-3 bg-gray-50 rounded-lg text-xs overflow-x-auto\">\n                                                {JSON.stringify(selectedLog.changes.after, null, 2)}\n                                            </pre>\n                                        </div>\n                                    )}\n\n                                    {selectedLog.changes.fields_changed && selectedLog.changes.fields_changed.length > 0 && (\n                                        <div>\n                                            <label className=\"text-sm font-medium text-gray-500\">Fields Changed</label>\n                                            <div className=\"mt-1 flex flex-wrap gap-2\">\n                                                {selectedLog.changes.fields_changed.map((field, index) => (\n                                                    <span key={index} className=\"px-2 py-1 bg-cyan-100 text-cyan-800 text-xs rounded\">\n                                                        {field}\n                                                    </span>\n                                                ))}\n                                            </div>\n                                        </div>\n                                    )}\n                                </div>\n                            )}\n\n                            {selectedLog.ip_address && (\n                                <div>\n                                    <label className=\"text-sm font-medium text-gray-500\">IP Address</label>\n                                    <p className=\"text-gray-900 mt-1\">{selectedLog.ip_address}</p>\n                                </div>\n                            )}\n                        </div>\n\n                        <div className=\"p-6 border-t border-gray-200 flex justify-end\">\n                            <button\n                                onClick={() => setSelectedLog(null)}\n                                className=\"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300\"\n                            >\n                                Close\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/AutomationPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/BiometricPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":37,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used. Allowed unused caught errors must match /^_/u.","line":148,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":148,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\nimport { Fingerprint, Clock, Shield, TrendingUp, Users } from 'lucide-react';\nimport { supabase } from '@/lib/supabase';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { NativeBiometric } from '@capgo/capacitor-native-biometric';\nimport { Capacitor } from '@capacitor/core';\nimport { log } from '@/lib/logger';\n\ninterface BiometricEnrollment {\n  id: string;\n  employee_id: string;\n  biometric_type: string;\n  enrollment_date: string;\n  quality_score: number;\n  enrollment_status: string;\n}\n\ninterface AttendanceLog {\n  id: string;\n  employee_id: string;\n  log_type: string;\n  log_timestamp: string;\n  confidence_score: string;\n  verification_status: string;\n}\n\ninterface SecurityEvent {\n  id: string;\n  event_type: string;\n  event_description: string;\n  event_timestamp: string;\n  severity_level: string;\n  investigation_status: string;\n}\n\nexport default function BiometricPage() {\n  const { user } = useAuth();\n  const [loading, setLoading] = useState(false);\n  const [enrolledEmployees, setEnrolledEmployees] = useState<BiometricEnrollment[]>([]);\n  const [recentAttendance, setRecentAttendance] = useState<AttendanceLog[]>([]);\n  const [securityEvents, setSecurityEvents] = useState<SecurityEvent[]>([]);\n  const [activeTab, setActiveTab] = useState('overview');\n  const [isNativeBiometricAvailable, setIsNativeBiometricAvailable] = useState(false);\n\n  useEffect(() => {\n    checkNativeBiometric();\n    loadBiometricData();\n  }, []);\n\n  async function loadBiometricData() {\n    try {\n      const { data: enrolled } = await supabase\n        .from('biometric_enrollment')\n        .select('*')\n        .order('created_at', { ascending: false });\n\n      const { data: attendance } = await supabase\n        .from('biometric_attendance_logs')\n        .select('*')\n        .order('log_timestamp', { ascending: false })\n        .limit(20);\n\n      const { data: events } = await supabase\n        .from('biometric_security_events')\n        .select('*')\n        .order('event_timestamp', { ascending: false })\n        .limit(10);\n\n      setEnrolledEmployees(enrolled || []);\n      setRecentAttendance(attendance || []);\n      setSecurityEvents(events || []);\n    } catch (error) {\n      log.error('Error loading biometric data', error, { component: 'BiometricPage', action: 'loadBiometricData' });\n    }\n  }\n\n  async function handleEnrollEmployee() {\n    const employeeId = prompt('Enter Employee ID:');\n    if (!employeeId) return;\n\n    const biometricType = confirm('Enroll fingerprint? (Cancel for face)') ? 'fingerprint' : 'face';\n\n    try {\n      setLoading(true);\n      const session = await supabase.auth.getSession();\n      if (!session.data.session) return;\n\n      await supabase.functions.invoke('biometric-processing', {\n        body: {\n          action: 'ENROLL',\n          data: {\n            employee_id: employeeId,\n            biometric_type: biometricType,\n            fingerprint_template: biometricType === 'fingerprint' ? 'ENCRYPTED_TEMPLATE_DATA' : null,\n            face_template: biometricType === 'face' ? 'ENCRYPTED_TEMPLATE_DATA' : null,\n            quality_score: 95,\n            device_id: 'WEB_INTERFACE'\n          }\n        },\n        headers: {\n          Authorization: `Bearer ${session.data.session.access_token}`\n        }\n      });\n\n      alert('Biometric enrollment successful!');\n      loadBiometricData();\n    } catch (error) {\n      log.error('Error enrolling biometric', error, { component: 'BiometricPage', action: 'handleEnrollEmployee', metadata: { employeeId, biometricType } });\n      alert('Enrollment failed');\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function checkNativeBiometric() {\n    if (!Capacitor.isNativePlatform()) {\n      log.debug('Native biometric not available: Web platform', { component: 'BiometricPage' });\n      setIsNativeBiometricAvailable(false);\n      return;\n    }\n\n    try {\n      const result = await NativeBiometric.isAvailable();\n      setIsNativeBiometricAvailable(result.isAvailable);\n    } catch (error) {\n      log.debug('Native biometric not available', { component: 'BiometricPage', metadata: { error } });\n      setIsNativeBiometricAvailable(false);\n    }\n  }\n\n  async function handleLogAttendance() {\n    const employeeId = prompt('Enter Employee ID:');\n    if (!employeeId) return;\n\n    try {\n      setLoading(true);\n\n      // Native Biometric Verification\n      if (isNativeBiometricAvailable) {\n        try {\n          await NativeBiometric.verifyIdentity({\n            reason: \"Verify identity to log attendance\",\n            title: \"Attendance Verification\",\n            subtitle: \"Confirm your identity\",\n            description: \"Please authenticate to log your attendance\"\n          });\n          // If we get here, verification was successful\n        } catch (error) {\n          alert('Biometric verification failed');\n          setLoading(false);\n          return;\n        }\n      }\n\n      const session = await supabase.auth.getSession();\n      if (!session.data.session) return;\n\n      await supabase.functions.invoke('biometric-processing', {\n        body: {\n          action: 'LOG_ATTENDANCE',\n          data: {\n            employee_id: employeeId,\n            log_type: 'clock_in',\n            biometric_type: isNativeBiometricAvailable ? 'native_biometric' : 'manual_entry',\n            location: 'Main Office',\n            verified: isNativeBiometricAvailable // Flag to indicate verified by device\n          }\n        },\n        headers: {\n          Authorization: `Bearer ${session.data.session.access_token}`\n        }\n      });\n\n      alert('Attendance logged successfully!');\n      loadBiometricData();\n    } catch (error) {\n      log.error('Error logging attendance', error, { component: 'BiometricPage', action: 'handleLogAttendance', metadata: { employeeId } });\n      alert('Failed to log attendance');\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  const successfulAttendance = recentAttendance.filter(a => a.verification_status === 'success').length;\n  const averageConfidence = recentAttendance.length > 0\n    ? (recentAttendance.reduce((sum, a) => sum + parseFloat(a.confidence_score || '0'), 0) / recentAttendance.length).toFixed(1)\n    : '0';\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Biometric System</h1>\n          <p className=\"text-gray-600 mt-1\">Attendance Tracking and Security Management</p>\n        </div>\n        <div className=\"flex space-x-3\">\n          <button\n            onClick={handleEnrollEmployee}\n            disabled={loading}\n            className=\"flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50\"\n          >\n            <Fingerprint className=\"w-4 h-4 mr-2\" />\n            Enroll Employee\n          </button>\n          <button\n            onClick={handleLogAttendance}\n            disabled={loading}\n            className=\"flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50\"\n          >\n            <Clock className=\"w-4 h-4 mr-2\" />\n            Log Attendance\n          </button>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        <div className=\"bg-white rounded-lg shadow p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-gray-600\">Enrolled Employees</p>\n              <p className=\"text-3xl font-bold text-gray-900 mt-2\">{enrolledEmployees.length}</p>\n              <p className=\"text-xs text-green-600 mt-1\">Active Biometrics</p>\n            </div>\n            <div className=\"w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center\">\n              <Users className=\"w-6 h-6 text-indigo-600\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-lg shadow p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-gray-600\">Today's Attendance</p>\n              <p className=\"text-3xl font-bold text-gray-900 mt-2\">{recentAttendance.length}</p>\n              <p className=\"text-xs text-green-600 mt-1\">{successfulAttendance} Successful</p>\n            </div>\n            <div className=\"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center\">\n              <Clock className=\"w-6 h-6 text-green-600\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-lg shadow p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-gray-600\">Avg Confidence</p>\n              <p className=\"text-3xl font-bold text-gray-900 mt-2\">{averageConfidence}%</p>\n              <p className=\"text-xs text-blue-600 mt-1\">Verification Score</p>\n            </div>\n            <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center\">\n              <TrendingUp className=\"w-6 h-6 text-blue-600\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-lg shadow p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-gray-600\">Security Events</p>\n              <p className=\"text-3xl font-bold text-gray-900 mt-2\">{securityEvents.length}</p>\n              <p className=\"text-xs text-yellow-600 mt-1\">Recent Incidents</p>\n            </div>\n            <div className=\"w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center\">\n              <Shield className=\"w-6 h-6 text-yellow-600\" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"bg-white rounded-lg shadow\">\n        <div className=\"border-b border-gray-200\">\n          <nav className=\"flex -mb-px\">\n            {['overview', 'enrollment', 'attendance', 'security'].map((tab) => (\n              <button\n                key={tab}\n                onClick={() => setActiveTab(tab)}\n                className={`px-6 py-3 text-sm font-medium border-b-2 capitalize ${activeTab === tab\n                  ? 'border-indigo-600 text-indigo-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                  }`}\n              >\n                {tab}\n              </button>\n            ))}\n          </nav>\n        </div>\n\n        <div className=\"p-6\">\n          {activeTab === 'enrollment' && (\n            <div className=\"overflow-x-auto\">\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Enrolled Employees</h3>\n              <table className=\"min-w-full divide-y divide-gray-200\">\n                <thead>\n                  <tr className=\"bg-gray-50\">\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Employee ID</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Biometric Type</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Enrollment Date</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Quality Score</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Status</th>\n                  </tr>\n                </thead>\n                <tbody className=\"bg-white divide-y divide-gray-200\">\n                  {enrolledEmployees.map((enrollment) => (\n                    <tr key={enrollment.id}>\n                      <td className=\"px-6 py-4 text-sm text-gray-900\">{enrollment.employee_id}</td>\n                      <td className=\"px-6 py-4 text-sm text-gray-500 capitalize\">{enrollment.biometric_type}</td>\n                      <td className=\"px-6 py-4 text-sm text-gray-500\">{new Date(enrollment.enrollment_date).toLocaleDateString()}</td>\n                      <td className=\"px-6 py-4 text-sm text-gray-900\">{enrollment.quality_score}%</td>\n                      <td className=\"px-6 py-4\">\n                        <span className={`px-2 py-1 text-xs rounded-full ${enrollment.enrollment_status === 'active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'\n                          }`}>\n                          {enrollment.enrollment_status}\n                        </span>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          )}\n\n          {activeTab === 'attendance' && (\n            <div className=\"overflow-x-auto\">\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Recent Attendance Logs</h3>\n              <table className=\"min-w-full divide-y divide-gray-200\">\n                <thead>\n                  <tr className=\"bg-gray-50\">\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Employee ID</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Log Type</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Timestamp</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Confidence</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Status</th>\n                  </tr>\n                </thead>\n                <tbody className=\"bg-white divide-y divide-gray-200\">\n                  {recentAttendance.map((log) => (\n                    <tr key={log.id}>\n                      <td className=\"px-6 py-4 text-sm text-gray-900\">{log.employee_id}</td>\n                      <td className=\"px-6 py-4 text-sm text-gray-500 capitalize\">{log.log_type?.replace('_', ' ') || 'N/A'}</td>\n                      <td className=\"px-6 py-4 text-sm text-gray-500\">{new Date(log.log_timestamp).toLocaleString()}</td>\n                      <td className=\"px-6 py-4 text-sm text-gray-900\">{log.confidence_score}%</td>\n                      <td className=\"px-6 py-4\">\n                        <span className={`px-2 py-1 text-xs rounded-full ${log.verification_status === 'success' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'\n                          }`}>\n                          {log.verification_status}\n                        </span>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          )}\n\n          {activeTab === 'security' && (\n            <div className=\"space-y-4\">\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Security Events</h3>\n              {securityEvents.length === 0 ? (\n                <p className=\"text-gray-500 text-center py-8\">No security events</p>\n              ) : (\n                securityEvents.map((event) => (\n                  <div\n                    key={event.id}\n                    className={`border-l-4 p-4 rounded-r-lg ${event.severity_level === 'critical' ? 'border-red-500 bg-red-50' :\n                      event.severity_level === 'high' ? 'border-orange-500 bg-orange-50' :\n                        'border-yellow-500 bg-yellow-50'\n                      }`}\n                  >\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1\">\n                        <h4 className=\"font-semibold text-gray-900 capitalize\">{event.event_type?.replace('_', ' ') || 'Unknown Event'}</h4>\n                        <p className=\"text-sm text-gray-600 mt-1\">{event.event_description}</p>\n                        <div className=\"flex items-center space-x-4 mt-2 text-xs text-gray-500\">\n                          <span>{new Date(event.event_timestamp).toLocaleString()}</span>\n                          <span className=\"px-2 py-1 bg-white rounded capitalize\">\n                            {event.severity_level}\n                          </span>\n                          <span className=\"px-2 py-1 bg-white rounded capitalize\">\n                            {event.investigation_status}\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                ))\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/ComplianceDashboardPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":13},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadComplianceData'. Either include it or remove the dependency array.","line":41,"column":8,"nodeType":"ArrayExpression","endLine":41,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [currentTenant, loadComplianceData]","fix":{"range":[1430,1445],"text":"[currentTenant, loadComplianceData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { complianceService, ComplianceStatus } from '@/lib/services/ComplianceService';\nimport { useTenant } from '@/contexts/TenantContext';\nimport {\n    Shield,\n    CheckCircle,\n    AlertTriangle,\n    XCircle,\n    TrendingUp,\n    Users,\n    FileText,\n    Download,\n    Plus\n} from 'lucide-react';\nimport ComplianceAlerts from '../components/ComplianceAlerts';\nimport TrainingMatrix from '../components/TrainingMatrix';\nimport DBSCheckForm from '../components/DBSCheckForm';\nimport ComplianceReportSettings from '../components/ComplianceReportSettings';\nimport { log } from '@/lib/logger';\n\ninterface ComplianceReport {\n    total_staff: number;\n    compliant: number;\n    non_compliant: number;\n    average_score: number;\n    cqc_ready: number;\n}\n\nexport default function ComplianceDashboardPage() {\n    const navigate = useNavigate();\n    const { currentTenant } = useTenant();\n    const [loading, setLoading] = useState(true);\n    const [complianceReport, setComplianceReport] = useState<ComplianceReport | null>(null);\n    const [nonCompliantStaff, setNonCompliantStaff] = useState<ComplianceStatus[]>([]);\n    const [activeTab, setActiveTab] = useState<'overview' | 'training' | 'settings'>('overview');\n    const [showDBSModal, setShowDBSModal] = useState(false);\n\n    useEffect(() => {\n        loadComplianceData();\n    }, [currentTenant]);\n\n    const loadComplianceData = async () => {\n        if (!currentTenant) return;\n\n        setLoading(true);\n        try {\n            const [report, nonCompliant] = await Promise.all([\n                complianceService.getTenantComplianceReport(currentTenant.id),\n                complianceService.getNonCompliantStaff(currentTenant.id)\n            ]);\n\n            setComplianceReport(report);\n            setNonCompliantStaff(nonCompliant);\n        } catch (error) {\n            log.error('Error loading compliance data', error, { component: 'ComplianceDashboardPage', action: 'loadComplianceData' });\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleExport = () => {\n        if (!complianceReport) return;\n\n        // Create CSV content\n        const headers = ['Metric', 'Value'];\n        const rows = [\n            ['Total Staff', complianceReport.total_staff],\n            ['Compliant Staff', complianceReport.compliant],\n            ['Non-Compliant Staff', complianceReport.non_compliant],\n            ['Average Compliance Score', `${complianceReport.average_score}%`],\n            ['CQC Ready', complianceReport.cqc_ready === complianceReport.total_staff ? 'Yes' : 'No'],\n            ['Generated At', new Date().toLocaleString()]\n        ];\n\n        let csvContent = \"data:text/csv;charset=utf-8,\"\n            + headers.join(\",\") + \"\\n\"\n            + rows.map(e => e.join(\",\")).join(\"\\n\");\n\n        // Add non-compliant staff details if any\n        if (nonCompliantStaff.length > 0) {\n            csvContent += \"\\n\\nNon-Compliant Staff Details\\n\";\n            csvContent += \"Staff Name,DBS Status,References,Training,RTW,Score\\n\";\n            nonCompliantStaff.forEach(staff => {\n                csvContent += `${staff.staff_name},${staff.dbs_status},${staff.references_status},${staff.training_status},${staff.rtw_status},${staff.overall_compliance_score}%\\n`;\n            });\n        }\n\n        const encodedUri = encodeURI(csvContent);\n        const link = document.createElement(\"a\");\n        link.setAttribute(\"href\", encodedUri);\n        link.setAttribute(\"download\", `cqc_compliance_report_${new Date().toISOString().split('T')[0]}.csv`);\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n    };\n\n    const getStatusColor = (score: number) => {\n        if (score >= 90) return 'text-green-600 bg-green-50';\n        if (score >= 70) return 'text-yellow-600 bg-yellow-50';\n        return 'text-red-600 bg-red-50';\n    };\n\n    const getStatusIcon = (score: number) => {\n        if (score >= 90) return <CheckCircle className=\"w-5 h-5\" />;\n        if (score >= 70) return <AlertTriangle className=\"w-5 h-5\" />;\n        return <XCircle className=\"w-5 h-5\" />;\n    };\n\n    if (loading) {\n        return (\n            <div className=\"flex items-center justify-center h-64\">\n                <div className=\"text-gray-500\">Loading compliance data...</div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"p-6 space-y-6\">\n            {/* Header */}\n            <div className=\"flex items-center justify-between\">\n                <div>\n                    <h1 className=\"text-2xl font-bold text-gray-900\">CQC Compliance Dashboard</h1>\n                    <p className=\"text-gray-600 mt-1\">Monitor staff compliance and CQC readiness</p>\n                </div>\n                <div className=\"flex gap-2\">\n                    <button\n                        onClick={() => navigate('/inspector-mode')}\n                        className=\"flex items-center gap-2 px-4 py-2 bg-slate-900 text-white rounded-lg hover:bg-slate-800 border border-slate-700\"\n                    >\n                        <Shield className=\"w-4 h-4\" />\n                        Enter Inspector Mode\n                    </button>\n                    <button\n                        onClick={handleExport}\n                        className=\"flex items-center gap-2 px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700\"\n                    >\n                        <Download className=\"w-4 h-4\" />\n                        Export CQC Report\n                    </button>\n                </div>\n            </div>\n\n            {/* Tabs */}\n            <div className=\"border-b border-gray-200\">\n                <nav className=\"-mb-px flex space-x-8\">\n                    <button\n                        onClick={() => setActiveTab('overview')}\n                        className={`py-4 px-1 border-b-2 font-medium text-sm ${activeTab === 'overview'\n                            ? 'border-cyan-500 text-cyan-600'\n                            : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                            }`}\n                    >\n                        Overview & Alerts\n                    </button>\n                    <button\n                        onClick={() => setActiveTab('training')}\n                        className={`py-4 px-1 border-b-2 font-medium text-sm ${activeTab === 'training'\n                            ? 'border-cyan-500 text-cyan-600'\n                            : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                            }`}\n                    >\n                        Training Matrix\n                    </button>\n                    <button\n                        onClick={() => setActiveTab('settings')}\n                        className={`py-4 px-1 border-b-2 font-medium text-sm ${activeTab === 'settings'\n                            ? 'border-cyan-500 text-cyan-600'\n                            : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                            }`}\n                    >\n                        ð§ Report Settings\n                    </button>\n                </nav>\n            </div>\n\n            {activeTab === 'overview' ? (\n                <div className=\"space-y-6\">\n                    <ComplianceAlerts />\n\n                    {/* Overview Cards */}\n                    <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\n                        <div className=\"bg-white rounded-lg shadow p-6\">\n                            <div className=\"flex items-center justify-between\">\n                                <div>\n                                    <p className=\"text-sm text-gray-600\">Total Staff</p>\n                                    <p className=\"text-3xl font-bold text-gray-900 mt-1\">\n                                        {complianceReport?.total_staff || 0}\n                                    </p>\n                                </div>\n                                <Users className=\"w-10 h-10 text-gray-400\" />\n                            </div>\n                        </div>\n\n                        <div className=\"bg-white rounded-lg shadow p-6\">\n                            <div className=\"flex items-center justify-between\">\n                                <div>\n                                    <p className=\"text-sm text-gray-600\">Compliant</p>\n                                    <p className=\"text-3xl font-bold text-green-600 mt-1\">\n                                        {complianceReport?.compliant || 0}\n                                    </p>\n                                </div>\n                                <CheckCircle className=\"w-10 h-10 text-green-400\" />\n                            </div>\n                            <p className=\"text-xs text-gray-500 mt-2\">\n                                {complianceReport?.total_staff > 0\n                                    ? Math.round((complianceReport.compliant / complianceReport.total_staff) * 100)\n                                    : 0}% of staff\n                            </p>\n                        </div>\n\n                        <div className=\"bg-white rounded-lg shadow p-6\">\n                            <div className=\"flex items-center justify-between\">\n                                <div>\n                                    <p className=\"text-sm text-gray-600\">Action Required</p>\n                                    <p className=\"text-3xl font-bold text-orange-600 mt-1\">\n                                        {complianceReport?.non_compliant || 0}\n                                    </p>\n                                </div>\n                                <AlertTriangle className=\"w-10 h-10 text-orange-400\" />\n                            </div>\n                        </div>\n\n                        <div className=\"bg-white rounded-lg shadow p-6\">\n                            <div className=\"flex items-center justify-between\">\n                                <div>\n                                    <p className=\"text-sm text-gray-600\">CQC Ready</p>\n                                    <p className=\"text-3xl font-bold text-cyan-600 mt-1\">\n                                        {complianceReport?.cqc_ready || 0}\n                                    </p>\n                                </div>\n                                <Shield className=\"w-10 h-10 text-cyan-400\" />\n                            </div>\n                        </div>\n                    </div>\n\n                    {/* Average Compliance Score */}\n                    <div className=\"bg-white rounded-lg shadow p-6\">\n                        <div className=\"flex items-center justify-between mb-4\">\n                            <h2 className=\"text-lg font-semibold text-gray-900\">Average Compliance Score</h2>\n                            <TrendingUp className=\"w-5 h-5 text-gray-400\" />\n                        </div>\n                        <div className=\"flex items-center gap-4\">\n                            <div className=\"flex-1\">\n                                <div className=\"w-full bg-gray-200 rounded-full h-4\">\n                                    <div\n                                        className={`h-4 rounded-full transition-all ${(complianceReport?.average_score || 0) >= 90\n                                            ? 'bg-green-600'\n                                            : (complianceReport?.average_score || 0) >= 70\n                                                ? 'bg-yellow-600'\n                                                : 'bg-red-600'\n                                            }`}\n                                        style={{ width: `${complianceReport?.average_score || 0}%` }}\n                                    />\n                                </div>\n                            </div>\n                            <span className=\"text-2xl font-bold text-gray-900\">\n                                {complianceReport?.average_score || 0}%\n                            </span>\n                        </div>\n                    </div>\n\n                    {/* Non-Compliant Staff */}\n                    {nonCompliantStaff.length > 0 && (\n                        <div className=\"bg-white rounded-lg shadow\">\n                            <div className=\"p-6 border-b border-gray-200\">\n                                <h2 className=\"text-lg font-semibold text-gray-900\">Staff Requiring Action</h2>\n                                <p className=\"text-sm text-gray-600 mt-1\">\n                                    {nonCompliantStaff.length} staff member(s) need compliance updates\n                                </p>\n                            </div>\n                            <div className=\"overflow-x-auto\">\n                                <table className=\"w-full\">\n                                    <thead className=\"bg-gray-50\">\n                                        <tr>\n                                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\n                                                Staff Member\n                                            </th>\n                                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\n                                                DBS\n                                            </th>\n                                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\n                                                References\n                                            </th>\n                                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\n                                                Training\n                                            </th>\n                                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\n                                                RTW\n                                            </th>\n                                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\n                                                Score\n                                            </th>\n                                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\n                                                Actions\n                                            </th>\n                                        </tr>\n                                    </thead>\n                                    <tbody className=\"divide-y divide-gray-200\">\n                                        {nonCompliantStaff.map((staff) => (\n                                            <tr key={staff.id} className=\"hover:bg-gray-50\">\n                                                <td className=\"px-6 py-4 whitespace-nowrap\">\n                                                    <div className=\"font-medium text-gray-900\">{staff.staff_name}</div>\n                                                </td>\n                                                <td className=\"px-6 py-4 whitespace-nowrap\">\n                                                    <StatusBadge status={staff.dbs_status} />\n                                                </td>\n                                                <td className=\"px-6 py-4 whitespace-nowrap\">\n                                                    <StatusBadge status={staff.references_status} />\n                                                </td>\n                                                <td className=\"px-6 py-4 whitespace-nowrap\">\n                                                    <StatusBadge status={staff.training_status} />\n                                                </td>\n                                                <td className=\"px-6 py-4 whitespace-nowrap\">\n                                                    <StatusBadge status={staff.rtw_status} />\n                                                </td>\n                                                <td className=\"px-6 py-4 whitespace-nowrap\">\n                                                    <div className={`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(staff.overall_compliance_score)}`}>\n                                                        {getStatusIcon(staff.overall_compliance_score)}\n                                                        {staff.overall_compliance_score}%\n                                                    </div>\n                                                </td>\n                                                <td className=\"px-6 py-4 whitespace-nowrap\">\n                                                    <button className=\"text-cyan-600 hover:text-cyan-700 text-sm font-medium\">\n                                                        View Details\n                                                    </button>\n                                                </td>\n                                            </tr>\n                                        ))}\n                                    </tbody>\n                                </table>\n                            </div>\n                        </div>\n                    )}\n\n                    {/* CQC Ready Status */}\n                    {complianceReport && (\n                        <div className={`rounded-lg p-6 ${complianceReport.cqc_ready === complianceReport.total_staff\n                            ? 'bg-green-50 border-2 border-green-200'\n                            : 'bg-orange-50 border-2 border-orange-200'\n                            }`}>\n                            <div className=\"flex items-center gap-3\">\n                                {complianceReport.cqc_ready === complianceReport.total_staff ? (\n                                    <>\n                                        <CheckCircle className=\"w-8 h-8 text-green-600\" />\n                                        <div>\n                                            <h3 className=\"text-lg font-semibold text-green-900\">\n                                                â CQC Inspection Ready\n                                            </h3>\n                                            <p className=\"text-green-700 mt-1\">\n                                                All staff members are compliant. Your organization is ready for CQC inspection.\n                                            </p>\n                                        </div>\n                                    </>\n                                ) : (\n                                    <>\n                                        <AlertTriangle className=\"w-8 h-8 text-orange-600\" />\n                                        <div>\n                                            <h3 className=\"text-lg font-semibold text-orange-900\">\n                                                â ï¸ Action Required for CQC Readiness\n                                            </h3>\n                                            <p className=\"text-orange-700 mt-1\">\n                                                {complianceReport.non_compliant} staff member(s) require compliance updates before CQC inspection.\n                                            </p>\n                                        </div>\n                                    </>\n                                )}\n                            </div>\n                        </div>\n                    )}\n\n                    <div className=\"flex justify-end\">\n                        <button\n                            onClick={() => setShowDBSModal(true)}\n                            className=\"flex items-center gap-2 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800\"\n                        >\n                            <Plus className=\"w-4 h-4\" />\n                            Add New DBS Check\n                        </button>\n                    </div>\n                </div>\n            ) : activeTab === 'training' ? (\n                <TrainingMatrix />\n            ) : (\n                <ComplianceReportSettings />\n            )}\n\n            {showDBSModal && (\n                <DBSCheckForm\n                    onSuccess={() => {\n                        setShowDBSModal(false);\n                        loadComplianceData();\n                    }}\n                    onCancel={() => setShowDBSModal(false)}\n                />\n            )}\n        </div>\n    );\n}\n\n// Helper component for status badges\nfunction StatusBadge({ status }: { status: string }) {\n    const getColor = () => {\n        if (status === 'compliant') return 'bg-green-100 text-green-800';\n        if (status === 'expiring_soon') return 'bg-yellow-100 text-yellow-800';\n        if (status === 'expired' || status === 'overdue') return 'bg-red-100 text-red-800';\n        if (status === 'incomplete') return 'bg-orange-100 text-orange-800';\n        return 'bg-gray-100 text-gray-800';\n    };\n\n    const getLabel = () => {\n        return status.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase());\n    };\n\n    return (\n        <span className={`inline-flex px-2 py-1 text-xs font-medium rounded-full ${getColor()}`}>\n            {getLabel()}\n        </span>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/ComplianceFormsPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/ComplianceHubPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useQuery' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMutation' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used. Allowed unused vars must match /^_/u.","line":24,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Filter' is defined but never used. Allowed unused vars must match /^_/u.","line":29,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronDown' is defined but never used. Allowed unused vars must match /^_/u.","line":32,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Trash2' is defined but never used. Allowed unused vars must match /^_/u.","line":38,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used. Allowed unused vars must match /^_/u.","line":41,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UserPlus' is defined but never used. Allowed unused vars must match /^_/u.","line":42,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used. Allowed unused vars must match /^_/u.","line":45,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useComplianceFolders' is defined but never used. Allowed unused vars must match /^_/u.","line":58,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":58,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMarkNotificationRead' is defined but never used. Allowed unused vars must match /^_/u.","line":62,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CompliancePerson' is defined but never used. Allowed unused vars must match /^_/u.","line":63,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":63,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ComplianceDocument' is defined but never used. Allowed unused vars must match /^_/u.","line":64,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":64,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ComplianceTask' is defined but never used. Allowed unused vars must match /^_/u.","line":65,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":65,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loading' is defined but never used. Allowed unused args must match /^_/u.","line":263,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":263,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'queryClient' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":805,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":805,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'reportData' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":900,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":900,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":17,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Compliance Hub Page\n * \n * Comprehensive compliance management interface integrating:\n * - Home Office & CQC compliance tracking\n * - Document lifecycle management\n * - Automated alerts and workflows\n * - Real-time compliance scoring\n * - Cross-app synchronization with CareFlow\n */\n\nimport React, { useState, useMemo } from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport {\n  Shield,\n  AlertTriangle,\n  CheckCircle2,\n  XCircle,\n  Clock,\n  Building2,\n  FileCheck,\n  Users,\n  TrendingUp,\n  Calendar,\n  Bell,\n  FolderOpen,\n  RefreshCw,\n  Download,\n  Filter,\n  Search,\n  ChevronRight,\n  ChevronDown,\n  ExternalLink,\n  Info,\n  Eye,\n  Upload,\n  MoreVertical,\n  Trash2,\n  Edit,\n  Send,\n  FileText,\n  UserPlus,\n  Activity,\n  BarChart3,\n  Settings,\n  AlertCircle,\n  CheckCheck,\n  Loader2\n} from 'lucide-react';\nimport { log } from '@/lib/logger';\nimport { useTenant } from '@/contexts/TenantContext';\nimport {\n  useComplianceStats,\n  useCompliancePersons,\n  useComplianceDocuments,\n  useExpiringDocuments,\n  useComplianceTasks,\n  useComplianceFolders,\n  useComplianceNotifications,\n  useVerifyDocument,\n  useUpdateTask,\n  useMarkNotificationRead,\n  type CompliancePerson,\n  type ComplianceDocument,\n  type ComplianceTask,\n  type ExpiringDocument,\n} from '@/hooks/useComplianceData';\nimport {\n  COMPLIANCE_FOLDER_STRUCTURE,\n  type ComplianceAuthority,\n  type ComplianceStage\n} from '@/lib/compliance/complianceTypes';\n\n// ===========================================\n// HELPER COMPONENTS\n// ===========================================\n\nconst StatCard: React.FC<{\n  title: string;\n  value: number | string;\n  subtitle?: string;\n  icon: React.ReactNode;\n  color: string;\n  bgColor: string;\n  trend?: { value: number; positive: boolean };\n  onClick?: () => void;\n  loading?: boolean;\n}> = ({ title, value, subtitle, icon, color, bgColor, trend, onClick, loading }) => (\n  <div\n    className={`bg-white rounded-xl shadow-sm border border-gray-100 p-6 transition-all duration-200 ${onClick ? 'cursor-pointer hover:shadow-md hover:border-gray-200' : ''\n      }`}\n    onClick={onClick}\n  >\n    <div className=\"flex items-start justify-between\">\n      <div className=\"flex-1\">\n        <p className=\"text-sm font-medium text-gray-500\">{title}</p>\n        {loading ? (\n          <div className=\"h-9 mt-2 flex items-center\">\n            <Loader2 className=\"w-6 h-6 animate-spin text-gray-400\" />\n          </div>\n        ) : (\n          <p className={`text-3xl font-bold mt-2 ${color}`}>\n            {typeof value === 'number' ? value.toLocaleString() : value}\n          </p>\n        )}\n        {subtitle && <p className=\"text-xs text-gray-400 mt-1\">{subtitle}</p>}\n        {trend && (\n          <div className={`flex items-center mt-2 text-sm ${trend.positive ? 'text-green-600' : 'text-red-600'}`}>\n            <TrendingUp className={`w-4 h-4 mr-1 ${!trend.positive && 'rotate-180'}`} />\n            {trend.value}% from last month\n          </div>\n        )}\n      </div>\n      <div className={`p-3 rounded-xl ${bgColor}`}>\n        {icon}\n      </div>\n    </div>\n  </div>\n);\n\nconst ComplianceScoreGauge: React.FC<{ score: number; size?: 'sm' | 'md' | 'lg'; label?: string }> = ({\n  score,\n  size = 'md',\n  label = 'Compliance'\n}) => {\n  const sizeConfig = {\n    sm: { container: 'w-20 h-20', text: 'text-lg', subtext: 'text-[10px]', strokeWidth: 6 },\n    md: { container: 'w-28 h-28', text: 'text-2xl', subtext: 'text-xs', strokeWidth: 7 },\n    lg: { container: 'w-36 h-36', text: 'text-3xl', subtext: 'text-sm', strokeWidth: 8 },\n  };\n\n  const config = sizeConfig[size];\n\n  const getColor = (s: number) => {\n    if (s >= 90) return '#10b981';\n    if (s >= 70) return '#f59e0b';\n    return '#ef4444';\n  };\n\n  const circumference = 2 * Math.PI * 45;\n  const strokeDashoffset = circumference - (score / 100) * circumference;\n\n  return (\n    <div className={`relative ${config.container}`}>\n      <svg className=\"w-full h-full transform -rotate-90\" viewBox=\"0 0 100 100\">\n        <circle\n          cx=\"50\"\n          cy=\"50\"\n          r=\"45\"\n          stroke=\"#e5e7eb\"\n          strokeWidth={config.strokeWidth}\n          fill=\"none\"\n        />\n        <circle\n          cx=\"50\"\n          cy=\"50\"\n          r=\"45\"\n          stroke={getColor(score)}\n          strokeWidth={config.strokeWidth}\n          fill=\"none\"\n          strokeLinecap=\"round\"\n          strokeDasharray={circumference}\n          strokeDashoffset={strokeDashoffset}\n          className=\"transition-all duration-700 ease-out\"\n        />\n      </svg>\n      <div className=\"absolute inset-0 flex flex-col items-center justify-center\">\n        <span className={`font-bold ${config.text}`} style={{ color: getColor(score) }}>\n          {score}%\n        </span>\n        <span className={`text-gray-500 ${config.subtext}`}>{label}</span>\n      </div>\n    </div>\n  );\n};\n\nconst AuthorityBadge: React.FC<{ authority: ComplianceAuthority; size?: 'sm' | 'md' }> = ({\n  authority,\n  size = 'md'\n}) => {\n  const config = {\n    HOME_OFFICE: { bg: 'bg-blue-100', text: 'text-blue-800', label: 'Home Office' },\n    CQC: { bg: 'bg-green-100', text: 'text-green-800', label: 'CQC' },\n    BOTH: { bg: 'bg-purple-100', text: 'text-purple-800', label: 'Both' },\n    INTERNAL: { bg: 'bg-gray-100', text: 'text-gray-800', label: 'Internal' },\n  };\n\n  const { bg, text, label } = config[authority] || config.INTERNAL;\n  const sizeClass = size === 'sm' ? 'px-1.5 py-0.5 text-[10px]' : 'px-2 py-1 text-xs';\n\n  return (\n    <span className={`rounded-full font-medium ${bg} ${text} ${sizeClass}`}>\n      {label}\n    </span>\n  );\n};\n\nconst StatusBadge: React.FC<{ status: string; size?: 'sm' | 'md' }> = ({ status, size = 'md' }) => {\n  const config: Record<string, { bg: string; text: string; icon?: React.ReactNode }> = {\n    COMPLIANT: { bg: 'bg-green-100', text: 'text-green-800', icon: <CheckCircle2 className=\"w-3 h-3\" /> },\n    AT_RISK: { bg: 'bg-yellow-100', text: 'text-yellow-800', icon: <AlertTriangle className=\"w-3 h-3\" /> },\n    NON_COMPLIANT: { bg: 'bg-red-100', text: 'text-red-800', icon: <XCircle className=\"w-3 h-3\" /> },\n    PENDING: { bg: 'bg-gray-100', text: 'text-gray-800', icon: <Clock className=\"w-3 h-3\" /> },\n    VERIFIED: { bg: 'bg-green-100', text: 'text-green-800', icon: <CheckCheck className=\"w-3 h-3\" /> },\n    UPLOADED: { bg: 'bg-blue-100', text: 'text-blue-800', icon: <Upload className=\"w-3 h-3\" /> },\n    UNDER_REVIEW: { bg: 'bg-purple-100', text: 'text-purple-800', icon: <Eye className=\"w-3 h-3\" /> },\n    REJECTED: { bg: 'bg-red-100', text: 'text-red-800', icon: <XCircle className=\"w-3 h-3\" /> },\n    EXPIRED: { bg: 'bg-red-100', text: 'text-red-800', icon: <AlertCircle className=\"w-3 h-3\" /> },\n    EXPIRING_SOON: { bg: 'bg-orange-100', text: 'text-orange-800', icon: <Clock className=\"w-3 h-3\" /> },\n  };\n\n  const { bg, text, icon } = config[status] || { bg: 'bg-gray-100', text: 'text-gray-800' };\n  const sizeClass = size === 'sm' ? 'px-1.5 py-0.5 text-[10px]' : 'px-2 py-1 text-xs';\n\n  return (\n    <span className={`inline-flex items-center gap-1 rounded-full font-medium ${bg} ${text} ${sizeClass}`}>\n      {icon}\n      {status.replace(/_/g, ' ')}\n    </span>\n  );\n};\n\nconst UrgencyBadge: React.FC<{ urgency: string }> = ({ urgency }) => {\n  const config: Record<string, { bg: string; text: string; dot: string }> = {\n    CRITICAL: { bg: 'bg-red-50', text: 'text-red-700', dot: 'bg-red-500' },\n    HIGH: { bg: 'bg-orange-50', text: 'text-orange-700', dot: 'bg-orange-500' },\n    MEDIUM: { bg: 'bg-yellow-50', text: 'text-yellow-700', dot: 'bg-yellow-500' },\n    LOW: { bg: 'bg-green-50', text: 'text-green-700', dot: 'bg-green-500' },\n  };\n\n  const { bg, text, dot } = config[urgency] || config.LOW;\n\n  return (\n    <span className={`inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium ${bg} ${text}`}>\n      <span className={`w-1.5 h-1.5 rounded-full ${dot} animate-pulse`} />\n      {urgency}\n    </span>\n  );\n};\n\nconst EmptyState: React.FC<{ icon: React.ReactNode; title: string; description: string }> = ({\n  icon,\n  title,\n  description,\n}) => (\n  <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n    <div className=\"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4\">\n      {icon}\n    </div>\n    <h3 className=\"text-lg font-medium text-gray-900 mb-1\">{title}</h3>\n    <p className=\"text-sm text-gray-500 max-w-sm\">{description}</p>\n  </div>\n);\n\n// ===========================================\n// TAB COMPONENTS\n// ===========================================\n\nconst OverviewTab: React.FC<{\n  stats: any;\n  loading: boolean;\n  onStageClick: (stage: ComplianceStage) => void;\n}> = ({ stats, loading, onStageClick }) => {\n  const stages: ComplianceStage[] = ['APPLICATION', 'PRE_EMPLOYMENT', 'ONBOARDING', 'ONGOING', 'OFFBOARDING'];\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Stage Overview */}\n      <div>\n        <h3 className=\"font-semibold text-gray-900 mb-4\">Compliance by Stage</h3>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {stages.map((stage) => {\n            const count = stats?.byStage?.[stage] || 0;\n            const percentage = stats?.totalPersons > 0\n              ? Math.round((count / stats.totalPersons) * 100)\n              : 0;\n\n            return (\n              <div\n                key={stage}\n                onClick={() => onStageClick(stage)}\n                className=\"p-4 border border-gray-100 rounded-xl hover:border-indigo-200 hover:shadow-sm transition-all cursor-pointer bg-white\"\n              >\n                <div className=\"flex items-center justify-between mb-3\">\n                  <h4 className=\"font-medium text-gray-900 text-sm\">\n                    {stage.replace(/_/g, ' ')}\n                  </h4>\n                  <span className=\"text-2xl font-bold text-indigo-600\">{count}</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"flex-1 bg-gray-100 rounded-full h-2\">\n                    <div\n                      className=\"bg-indigo-600 h-2 rounded-full transition-all duration-500\"\n                      style={{ width: `${percentage}%` }}\n                    />\n                  </div>\n                  <span className=\"text-xs text-gray-500 w-10 text-right\">{percentage}%</span>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      </div>\n\n      {/* Compliance Pipeline */}\n      <div className=\"p-6 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl\">\n        <h4 className=\"font-semibold text-gray-900 mb-6\">Compliance Pipeline Flow</h4>\n        <div className=\"flex items-center justify-between overflow-x-auto pb-2\">\n          {stages.slice(0, 4).map((stage, index) => (\n            <React.Fragment key={stage}>\n              <div className=\"flex flex-col items-center min-w-[100px]\">\n                <div className=\"w-14 h-14 rounded-full bg-white shadow-sm flex items-center justify-center text-indigo-600 font-bold text-lg border-2 border-indigo-200\">\n                  {stats?.byStage?.[stage] || 0}\n                </div>\n                <span className=\"text-xs text-gray-600 mt-2 text-center font-medium\">\n                  {stage.replace(/_/g, ' ')}\n                </span>\n              </div>\n              {index < 3 && (\n                <div className=\"flex-shrink-0 mx-2\">\n                  <ChevronRight className=\"w-6 h-6 text-indigo-300\" />\n                </div>\n              )}\n            </React.Fragment>\n          ))}\n        </div>\n      </div>\n\n      {/* Authority Breakdown */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n        {/* Home Office */}\n        <div className=\"bg-white border border-gray-100 rounded-xl p-6\">\n          <div className=\"flex items-center gap-3 mb-4\">\n            <div className=\"p-2 bg-blue-100 rounded-lg\">\n              <Building2 className=\"w-6 h-6 text-blue-600\" />\n            </div>\n            <div>\n              <h4 className=\"font-semibold text-gray-900\">Home Office Compliance</h4>\n              <p className=\"text-sm text-gray-500\">Right to Work & Immigration</p>\n            </div>\n          </div>\n          <div className=\"flex items-center justify-between mb-4\">\n            <ComplianceScoreGauge\n              score={stats?.byAuthority?.homeOffice?.score || 0}\n              size=\"sm\"\n              label=\"Score\"\n            />\n            <div className=\"text-right\">\n              <p className=\"text-2xl font-bold text-blue-600\">\n                {stats?.byAuthority?.homeOffice?.compliant || 0}/{stats?.totalPersons || 0}\n              </p>\n              <p className=\"text-sm text-gray-500\">Fully Compliant</p>\n            </div>\n          </div>\n        </div>\n\n        {/* CQC */}\n        <div className=\"bg-white border border-gray-100 rounded-xl p-6\">\n          <div className=\"flex items-center gap-3 mb-4\">\n            <div className=\"p-2 bg-green-100 rounded-lg\">\n              <Shield className=\"w-6 h-6 text-green-600\" />\n            </div>\n            <div>\n              <h4 className=\"font-semibold text-gray-900\">CQC Compliance</h4>\n              <p className=\"text-sm text-gray-500\">Care Quality Standards</p>\n            </div>\n          </div>\n          <div className=\"flex items-center justify-between mb-4\">\n            <ComplianceScoreGauge\n              score={stats?.byAuthority?.cqc?.score || 0}\n              size=\"sm\"\n              label=\"Score\"\n            />\n            <div className=\"text-right\">\n              <p className=\"text-2xl font-bold text-green-600\">\n                {stats?.byAuthority?.cqc?.compliant || 0}/{stats?.totalPersons || 0}\n              </p>\n              <p className=\"text-sm text-gray-500\">Fully Compliant</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst ExpiringDocumentsTab: React.FC<{\n  tenantId: string;\n  onSendReminder: (doc: ExpiringDocument) => void;\n}> = ({ tenantId, onSendReminder }) => {\n  const [daysFilter, setDaysFilter] = useState(30);\n  const { data: expiringDocs, isLoading } = useExpiringDocuments(tenantId, daysFilter);\n\n  const criticalCount = expiringDocs?.filter(d => d.days_until_expiry <= 7).length || 0;\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <h3 className=\"font-semibold text-gray-900\">Documents Expiring Soon</h3>\n        <select\n          value={daysFilter}\n          onChange={(e) => setDaysFilter(Number(e.target.value))}\n          className=\"px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n        >\n          <option value={7}>Next 7 days</option>\n          <option value={30}>Next 30 days</option>\n          <option value={60}>Next 60 days</option>\n          <option value={90}>Next 90 days</option>\n        </select>\n      </div>\n\n      {/* Critical Alert */}\n      {criticalCount > 0 && (\n        <div className=\"p-4 bg-red-50 border border-red-100 rounded-xl flex items-start gap-3\">\n          <AlertTriangle className=\"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5\" />\n          <div>\n            <h4 className=\"font-medium text-red-800\">Critical Documents Expiring</h4>\n            <p className=\"text-sm text-red-600 mt-1\">\n              {criticalCount} document{criticalCount !== 1 ? 's' : ''} will expire within 7 days.\n              Immediate action required to maintain compliance.\n            </p>\n          </div>\n        </div>\n      )}\n\n      {/* Documents Table */}\n      {isLoading ? (\n        <div className=\"flex items-center justify-center py-12\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-indigo-600\" />\n        </div>\n      ) : expiringDocs && expiringDocs.length > 0 ? (\n        <div className=\"border border-gray-100 rounded-xl overflow-hidden\">\n          <table className=\"w-full\">\n            <thead className=\"bg-gray-50\">\n              <tr>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Person</th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Document</th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Authority</th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Expiry</th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Urgency</th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Action</th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-gray-100\">\n              {expiringDocs.map((doc) => (\n                <tr key={doc.id} className=\"hover:bg-gray-50 transition-colors\">\n                  <td className=\"px-4 py-3\">\n                    <div>\n                      <p className=\"font-medium text-gray-900\">{doc.person_name}</p>\n                      <p className=\"text-xs text-gray-500\">{doc.person_email}</p>\n                    </div>\n                  </td>\n                  <td className=\"px-4 py-3 text-sm text-gray-600\">{doc.document_type}</td>\n                  <td className=\"px-4 py-3\">\n                    <AuthorityBadge authority={doc.authority} size=\"sm\" />\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <div className=\"text-sm\">\n                      <p className=\"text-gray-900\">{new Date(doc.expiry_date).toLocaleDateString()}</p>\n                      <p className={`text-xs ${doc.days_until_expiry <= 0 ? 'text-red-600 font-medium' : 'text-gray-500'}`}>\n                        {doc.days_until_expiry <= 0\n                          ? `Expired ${Math.abs(doc.days_until_expiry)} days ago`\n                          : `${doc.days_until_expiry} days left`\n                        }\n                      </p>\n                    </div>\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <UrgencyBadge urgency={doc.urgency} />\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <button\n                      onClick={() => onSendReminder(doc)}\n                      className=\"inline-flex items-center gap-1 text-indigo-600 hover:text-indigo-800 text-sm font-medium\"\n                    >\n                      <Send className=\"w-3 h-3\" />\n                      Remind\n                    </button>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      ) : (\n        <EmptyState\n          icon={<CheckCircle2 className=\"w-8 h-8 text-green-500\" />}\n          title=\"No Expiring Documents\"\n          description={`No documents expiring in the next ${daysFilter} days. Great job staying on top of compliance!`}\n        />\n      )}\n    </div>\n  );\n};\n\nconst PendingVerificationTab: React.FC<{\n  tenantId: string;\n}> = ({ tenantId }) => {\n  const { data: documents, isLoading } = useComplianceDocuments(tenantId, { status: 'UPLOADED' });\n  const verifyMutation = useVerifyDocument(tenantId);\n\n  const handleVerify = async (docId: string, approved: boolean) => {\n    await verifyMutation.mutateAsync({\n      documentId: docId,\n      verified: approved,\n      rejectedReason: !approved ? 'Document verification failed' : undefined,\n    });\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between\">\n        <h3 className=\"font-semibold text-gray-900\">Documents Awaiting Verification</h3>\n        <button className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm hover:bg-indigo-700 transition-colors\">\n          Bulk Verify\n        </button>\n      </div>\n\n      {isLoading ? (\n        <div className=\"flex items-center justify-center py-12\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-indigo-600\" />\n        </div>\n      ) : documents && documents.length > 0 ? (\n        <div className=\"space-y-3\">\n          {documents.map((doc) => (\n            <div\n              key={doc.id}\n              className=\"flex items-center justify-between p-4 bg-white border border-gray-100 rounded-xl hover:border-indigo-200 transition-all\"\n            >\n              <div className=\"flex items-center gap-4\">\n                <div className=\"w-12 h-12 rounded-xl bg-indigo-50 flex items-center justify-center\">\n                  <FileCheck className=\"w-6 h-6 text-indigo-600\" />\n                </div>\n                <div>\n                  <p className=\"font-medium text-gray-900\">{doc.person_name}</p>\n                  <p className=\"text-sm text-gray-500\">\n                    {doc.document_type_name} &bull; Uploaded {new Date(doc.uploaded_at).toLocaleDateString()}\n                  </p>\n                </div>\n              </div>\n              <div className=\"flex items-center gap-3\">\n                <AuthorityBadge authority={doc.authority} />\n                <button\n                  onClick={() => handleVerify(doc.id, true)}\n                  disabled={verifyMutation.isPending}\n                  className=\"px-3 py-1.5 bg-green-100 text-green-700 rounded-lg text-sm font-medium hover:bg-green-200 transition-colors disabled:opacity-50\"\n                >\n                  Verify\n                </button>\n                <button\n                  onClick={() => handleVerify(doc.id, false)}\n                  disabled={verifyMutation.isPending}\n                  className=\"px-3 py-1.5 bg-red-100 text-red-700 rounded-lg text-sm font-medium hover:bg-red-200 transition-colors disabled:opacity-50\"\n                >\n                  Reject\n                </button>\n                <button className=\"p-1.5 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100\">\n                  <Eye className=\"w-4 h-4\" />\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      ) : (\n        <EmptyState\n          icon={<CheckCheck className=\"w-8 h-8 text-green-500\" />}\n          title=\"All Documents Verified\"\n          description=\"No documents pending verification. All uploaded documents have been reviewed.\"\n        />\n      )}\n    </div>\n  );\n};\n\nconst TasksTab: React.FC<{\n  tenantId: string;\n}> = ({ tenantId }) => {\n  const { data: tasks, isLoading } = useComplianceTasks(tenantId, { status: 'PENDING' });\n  const updateTask = useUpdateTask(tenantId);\n\n  const handleCompleteTask = async (taskId: string) => {\n    await updateTask.mutateAsync({\n      id: taskId,\n      updates: { status: 'COMPLETED', completed_at: new Date().toISOString() },\n    });\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between\">\n        <h3 className=\"font-semibold text-gray-900\">Compliance Tasks</h3>\n        <div className=\"flex items-center gap-2\">\n          <select className=\"px-3 py-2 border border-gray-200 rounded-lg text-sm\">\n            <option>All Urgencies</option>\n            <option>Critical</option>\n            <option>High</option>\n            <option>Medium</option>\n            <option>Low</option>\n          </select>\n        </div>\n      </div>\n\n      {isLoading ? (\n        <div className=\"flex items-center justify-center py-12\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-indigo-600\" />\n        </div>\n      ) : tasks && tasks.length > 0 ? (\n        <div className=\"space-y-3\">\n          {tasks.map((task) => (\n            <div\n              key={task.id}\n              className=\"p-4 bg-white border border-gray-100 rounded-xl hover:border-indigo-200 transition-all\"\n            >\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex items-start gap-4\">\n                  <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${task.urgency === 'CRITICAL' ? 'bg-red-100' :\n                    task.urgency === 'HIGH' ? 'bg-orange-100' :\n                      task.urgency === 'MEDIUM' ? 'bg-yellow-100' : 'bg-green-100'\n                    }`}>\n                    <Activity className={`w-5 h-5 ${task.urgency === 'CRITICAL' ? 'text-red-600' :\n                      task.urgency === 'HIGH' ? 'text-orange-600' :\n                        task.urgency === 'MEDIUM' ? 'text-yellow-600' : 'text-green-600'\n                      }`} />\n                  </div>\n                  <div>\n                    <p className=\"font-medium text-gray-900\">{task.title}</p>\n                    {task.description && (\n                      <p className=\"text-sm text-gray-500 mt-1\">{task.description}</p>\n                    )}\n                    <div className=\"flex items-center gap-3 mt-2\">\n                      <UrgencyBadge urgency={task.urgency} />\n                      {task.person_name && (\n                        <span className=\"text-xs text-gray-500\">\n                          For: {task.person_name}\n                        </span>\n                      )}\n                      {task.due_date && (\n                        <span className=\"text-xs text-gray-500\">\n                          Due: {new Date(task.due_date).toLocaleDateString()}\n                        </span>\n                      )}\n                    </div>\n                  </div>\n                </div>\n                <button\n                  onClick={() => handleCompleteTask(task.id)}\n                  disabled={updateTask.isPending}\n                  className=\"px-3 py-1.5 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700 transition-colors disabled:opacity-50\"\n                >\n                  Complete\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      ) : (\n        <EmptyState\n          icon={<CheckCheck className=\"w-8 h-8 text-green-500\" />}\n          title=\"No Pending Tasks\"\n          description=\"All compliance tasks have been completed. Check back later for new tasks.\"\n        />\n      )}\n    </div>\n  );\n};\n\nconst PeopleTab: React.FC<{\n  tenantId: string;\n  stageFilter?: ComplianceStage;\n  onClearFilter: () => void;\n}> = ({ tenantId, stageFilter, onClearFilter }) => {\n  const [searchQuery, setSearchQuery] = useState('');\n  const [statusFilter, setStatusFilter] = useState<string>('');\n\n  const { data: persons, isLoading } = useCompliancePersons(tenantId, {\n    stage: stageFilter,\n    status: statusFilter as any || undefined,\n    search: searchQuery || undefined,\n  });\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Filters */}\n      <div className=\"flex items-center gap-4\">\n        <div className=\"relative flex-1 max-w-md\">\n          <Search className=\"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" />\n          <input\n            type=\"text\"\n            placeholder=\"Search by name or email...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n          />\n        </div>\n        <select\n          value={statusFilter}\n          onChange={(e) => setStatusFilter(e.target.value)}\n          className=\"px-3 py-2 border border-gray-200 rounded-lg text-sm\"\n        >\n          <option value=\"\">All Statuses</option>\n          <option value=\"COMPLIANT\">Compliant</option>\n          <option value=\"AT_RISK\">At Risk</option>\n          <option value=\"NON_COMPLIANT\">Non-Compliant</option>\n          <option value=\"PENDING\">Pending</option>\n        </select>\n        {stageFilter && (\n          <button\n            onClick={onClearFilter}\n            className=\"px-3 py-2 bg-indigo-100 text-indigo-700 rounded-lg text-sm font-medium hover:bg-indigo-200\"\n          >\n            Stage: {stageFilter.replace(/_/g, ' ')} &times;\n          </button>\n        )}\n      </div>\n\n      {/* People List */}\n      {isLoading ? (\n        <div className=\"flex items-center justify-center py-12\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-indigo-600\" />\n        </div>\n      ) : persons && persons.length > 0 ? (\n        <div className=\"border border-gray-100 rounded-xl overflow-hidden\">\n          <table className=\"w-full\">\n            <thead className=\"bg-gray-50\">\n              <tr>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Person</th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Type</th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Stage</th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Status</th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Scores</th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Actions</th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-gray-100\">\n              {persons.map((person) => (\n                <tr key={person.id} className=\"hover:bg-gray-50 transition-colors\">\n                  <td className=\"px-4 py-3\">\n                    <div>\n                      <p className=\"font-medium text-gray-900\">{person.full_name}</p>\n                      <p className=\"text-xs text-gray-500\">{person.email}</p>\n                    </div>\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <span className=\"text-sm text-gray-600\">{person.person_type.replace(/_/g, ' ')}</span>\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <span className=\"text-sm text-gray-600\">{person.current_stage.replace(/_/g, ' ')}</span>\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <StatusBadge status={person.compliance_status} size=\"sm\" />\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"text-center\">\n                        <p className=\"text-xs text-gray-500\">Overall</p>\n                        <p className=\"font-bold text-gray-900\">{person.overall_compliance_score}%</p>\n                      </div>\n                      <div className=\"text-center\">\n                        <p className=\"text-xs text-blue-500\">HO</p>\n                        <p className=\"font-medium text-blue-600\">{person.home_office_score}%</p>\n                      </div>\n                      <div className=\"text-center\">\n                        <p className=\"text-xs text-green-500\">CQC</p>\n                        <p className=\"font-medium text-green-600\">{person.cqc_score}%</p>\n                      </div>\n                    </div>\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <div className=\"flex items-center gap-2\">\n                      <button className=\"p-1.5 text-gray-400 hover:text-indigo-600 rounded-lg hover:bg-indigo-50\">\n                        <Eye className=\"w-4 h-4\" />\n                      </button>\n                      <button className=\"p-1.5 text-gray-400 hover:text-indigo-600 rounded-lg hover:bg-indigo-50\">\n                        <Edit className=\"w-4 h-4\" />\n                      </button>\n                      <button className=\"p-1.5 text-gray-400 hover:text-indigo-600 rounded-lg hover:bg-indigo-50\">\n                        <MoreVertical className=\"w-4 h-4\" />\n                      </button>\n                    </div>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      ) : (\n        <EmptyState\n          icon={<Users className=\"w-8 h-8 text-gray-400\" />}\n          title=\"No People Found\"\n          description=\"No compliance records match your current filters. Try adjusting your search criteria.\"\n        />\n      )}\n    </div>\n  );\n};\n\n// ===========================================\n// MAIN COMPONENT\n// ===========================================\n\nconst ComplianceHubPage: React.FC = () => {\n  const { currentTenant } = useTenant();\n  const tenantId = currentTenant?.id || '';\n  const queryClient = useQueryClient();\n\n  // State\n  const [activeTab, setActiveTab] = useState<'overview' | 'expiring' | 'pending' | 'tasks' | 'people'>('overview');\n  const [stageFilter, setStageFilter] = useState<ComplianceStage | undefined>();\n  const [showNotifications, setShowNotifications] = useState(false);\n\n  // Queries\n  const { data: stats, isLoading: statsLoading, refetch: refetchStats } = useComplianceStats(tenantId);\n  const { data: notifications } = useComplianceNotifications(tenantId, { unreadOnly: true });\n\n  // Calculate overall score\n  const overallScore = useMemo(() => {\n    if (!stats || stats.totalPersons === 0) return 0;\n    return Math.round((stats.compliant / stats.totalPersons) * 100);\n  }, [stats]);\n\n  const unreadNotificationCount = notifications?.length || 0;\n\n  const handleStageClick = (stage: ComplianceStage) => {\n    setStageFilter(stage);\n    setActiveTab('people');\n  };\n\n  const handleSendReminder = async (doc: ExpiringDocument) => {\n    try {\n      // Call the send-email edge function to send a reminder\n      const response = await fetch(`${import.meta.env.VITE_SUPABASE_URL}/functions/v1/send-email`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${import.meta.env.VITE_SUPABASE_ANON_KEY}`\n        },\n        body: JSON.stringify({\n          to: doc.person_email,\n          subject: `Reminder: ${doc.document_type} expiring soon`,\n          html: `\n            <h2>Document Expiry Reminder</h2>\n            <p>Dear ${doc.person_name},</p>\n            <p>Your <strong>${doc.document_type}</strong> is expiring on <strong>${new Date(doc.expiry_date).toLocaleDateString()}</strong>.</p>\n            <p>Please ensure you renew or update this document to maintain compliance.</p>\n            <p>Days remaining: <strong>${doc.days_until_expiry}</strong></p>\n            <br/>\n            <p>Best regards,<br/>Compliance Team</p>\n          `\n        })\n      });\n\n      if (response.ok) {\n        alert(`Reminder sent successfully to ${doc.person_email}`);\n      } else {\n        const err = await response.json();\n        log.error('Send reminder error', err, { component: 'ComplianceHubPage', action: 'handleSendReminder', metadata: { email: doc.person_email } });\n        alert('Failed to send reminder. Please try again.');\n      }\n    } catch (error) {\n      log.error('Send reminder error', error, { component: 'ComplianceHubPage', action: 'handleSendReminder' });\n      alert('Failed to send reminder. Please check your connection.');\n    }\n  };\n\n  const handleSync = async () => {\n    try {\n      // Call the sync-to-careflow edge function\n      const response = await fetch(`${import.meta.env.VITE_SUPABASE_URL}/functions/v1/sync-to-careflow`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${import.meta.env.VITE_SUPABASE_ANON_KEY}`\n        },\n        body: JSON.stringify({\n          tenantId: tenantId,\n          syncType: 'compliance'\n        })\n      });\n\n      if (response.ok) {\n        const result = await response.json();\n        alert(`Sync completed! ${result.synced || 0} records synchronized to CareFlow.`);\n        await refetchStats();\n      } else {\n        const err = await response.json();\n        log.error('Sync error', err, { component: 'ComplianceHubPage', action: 'handleSync' });\n        alert('Sync failed. Please try again.');\n      }\n    } catch (error) {\n      log.error('Sync error', error, { component: 'ComplianceHubPage', action: 'handleSync' });\n      alert('Sync failed. Please check your connection.');\n    }\n  };\n\n  const handleExportReport = async () => {\n    // Generate compliance report as CSV/PDF\n    try {\n      // Get all compliance data\n      const reportData = {\n        generatedAt: new Date().toISOString(),\n        tenantId: tenantId,\n        stats: stats,\n        overallScore: overallScore\n      };\n\n      // Generate HTML report for printing\n      const html = `\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Compliance Report - ${new Date().toLocaleDateString()}</title>\n  <style>\n    body { font-family: Arial, sans-serif; padding: 40px; }\n    h1 { color: #1f2937; margin-bottom: 10px; }\n    .meta { color: #6b7280; font-size: 14px; margin-bottom: 20px; }\n    .stat-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin: 20px 0; }\n    .stat-box { padding: 15px; border: 1px solid #e5e7eb; border-radius: 8px; text-align: center; }\n    .stat-value { font-size: 24px; font-weight: bold; color: #1f2937; }\n    .stat-label { font-size: 12px; color: #6b7280; }\n    .score { font-size: 48px; font-weight: bold; text-align: center; margin: 30px 0; }\n    .score.high { color: #16a34a; }\n    .score.medium { color: #f59e0b; }\n    .score.low { color: #dc2626; }\n    .footer { margin-top: 40px; font-size: 12px; color: #9ca3af; text-align: center; }\n  </style>\n</head>\n<body>\n  <h1>Compliance Report</h1>\n  <div class=\"meta\">Generated on ${new Date().toLocaleDateString('en-GB', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</div>\n  \n  <h2>Overall Compliance Score</h2>\n  <div class=\"score ${overallScore >= 80 ? 'high' : overallScore >= 50 ? 'medium' : 'low'}\">\n    ${overallScore}%\n  </div>\n  \n  <div class=\"stat-grid\">\n    <div class=\"stat-box\">\n      <div class=\"stat-value\">${stats?.totalPersons || 0}</div>\n      <div class=\"stat-label\">Total Staff</div>\n    </div>\n    <div class=\"stat-box\">\n      <div class=\"stat-value\" style=\"color: #16a34a;\">${stats?.compliant || 0}</div>\n      <div class=\"stat-label\">Compliant</div>\n    </div>\n    <div class=\"stat-box\">\n      <div class=\"stat-value\" style=\"color: #f59e0b;\">${stats?.atRisk || 0}</div>\n      <div class=\"stat-label\">At Risk</div>\n    </div>\n    <div class=\"stat-box\">\n      <div class=\"stat-value\" style=\"color: #dc2626;\">${stats?.nonCompliant || 0}</div>\n      <div class=\"stat-label\">Non-Compliant</div>\n    </div>\n  </div>\n\n  <h3>Authority Breakdown</h3>\n  <div class=\"stat-grid\" style=\"grid-template-columns: repeat(2, 1fr);\">\n    <div class=\"stat-box\">\n      <div class=\"stat-value\" style=\"color: #3b82f6;\">${stats?.byAuthority?.homeOffice?.score || 0}%</div>\n      <div class=\"stat-label\">Home Office Compliance</div>\n    </div>\n    <div class=\"stat-box\">\n      <div class=\"stat-value\" style=\"color: #16a34a;\">${stats?.byAuthority?.cqc?.score || 0}%</div>\n      <div class=\"stat-label\">CQC Compliance</div>\n    </div>\n  </div>\n\n  <h3>Key Metrics</h3>\n  <ul>\n    <li>Documents Expiring Soon: ${stats?.expiringDocuments || 0}</li>\n    <li>Pending Verifications: ${stats?.pendingVerifications || 0}</li>\n  </ul>\n\n  <div class=\"footer\">\n    <p>Report generated by NovumFlow Compliance Hub</p>\n    <p>&copy; ${new Date().getFullYear()} NovumFlow</p>\n  </div>\n</body>\n</html>`;\n\n      const printWindow = window.open('', '_blank');\n      if (printWindow) {\n        printWindow.document.write(html);\n        printWindow.document.close();\n        printWindow.focus();\n        setTimeout(() => printWindow.print(), 250);\n      }\n    } catch (error) {\n      log.error('Export error', error, { component: 'ComplianceHubPage', action: 'handleExportReport' });\n      alert('Failed to generate report.');\n    }\n  };\n\n  if (!tenantId) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <Shield className=\"w-16 h-16 text-gray-300 mx-auto mb-4\" />\n          <h2 className=\"text-xl font-semibold text-gray-700\">No Tenant Selected</h2>\n          <p className=\"text-gray-500 mt-2\">Please select a tenant to view compliance data.</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <div className=\"bg-white border-b border-gray-100 sticky top-0 z-10\">\n        <div className=\"max-w-7xl mx-auto px-6 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-2xl font-bold text-gray-900 flex items-center gap-3\">\n                <div className=\"p-2 bg-indigo-100 rounded-xl\">\n                  <Shield className=\"w-7 h-7 text-indigo-600\" />\n                </div>\n                Compliance Hub\n              </h1>\n              <p className=\"text-gray-500 mt-1 ml-12\">\n                Home Office & CQC compliance management\n              </p>\n            </div>\n            <div className=\"flex items-center gap-3\">\n              {/* Notifications */}\n              <button\n                onClick={() => setShowNotifications(!showNotifications)}\n                className=\"relative p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100\"\n              >\n                <Bell className=\"w-5 h-5\" />\n                {unreadNotificationCount > 0 && (\n                  <span className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center\">\n                    {unreadNotificationCount}\n                  </span>\n                )}\n              </button>\n\n              {/* Actions */}\n              <button\n                onClick={handleSync}\n                className=\"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors\"\n              >\n                <RefreshCw className=\"w-4 h-4\" />\n                Sync to CareFlow\n              </button>\n              <button\n                onClick={handleExportReport}\n                className=\"flex items-center gap-2 px-4 py-2 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors\"\n              >\n                <Download className=\"w-4 h-4\" />\n                Export Report\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Main Content */}\n      <div className=\"max-w-7xl mx-auto px-6 py-6\">\n        {/* Stats Grid */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6\">\n          <StatCard\n            title=\"Total Staff\"\n            value={stats?.totalPersons || 0}\n            subtitle=\"Active records\"\n            icon={<Users className=\"w-6 h-6 text-indigo-600\" />}\n            color=\"text-indigo-600\"\n            bgColor=\"bg-indigo-50\"\n            loading={statsLoading}\n          />\n          <StatCard\n            title=\"Compliant\"\n            value={stats?.compliant || 0}\n            subtitle=\"All requirements met\"\n            icon={<CheckCircle2 className=\"w-6 h-6 text-green-600\" />}\n            color=\"text-green-600\"\n            bgColor=\"bg-green-50\"\n            loading={statsLoading}\n          />\n          <StatCard\n            title=\"At Risk\"\n            value={stats?.atRisk || 0}\n            subtitle=\"Expiring soon\"\n            icon={<AlertTriangle className=\"w-6 h-6 text-yellow-600\" />}\n            color=\"text-yellow-600\"\n            bgColor=\"bg-yellow-50\"\n            loading={statsLoading}\n            onClick={() => setActiveTab('expiring')}\n          />\n          <StatCard\n            title=\"Non-Compliant\"\n            value={stats?.nonCompliant || 0}\n            subtitle=\"Action required\"\n            icon={<XCircle className=\"w-6 h-6 text-red-600\" />}\n            color=\"text-red-600\"\n            bgColor=\"bg-red-50\"\n            loading={statsLoading}\n          />\n          <StatCard\n            title=\"Pending Review\"\n            value={stats?.pendingVerifications || 0}\n            subtitle=\"Documents to verify\"\n            icon={<FileCheck className=\"w-6 h-6 text-purple-600\" />}\n            color=\"text-purple-600\"\n            bgColor=\"bg-purple-50\"\n            loading={statsLoading}\n            onClick={() => setActiveTab('pending')}\n          />\n        </div>\n\n        {/* Main Grid */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-6\">\n          {/* Sidebar */}\n          <div className=\"lg:col-span-1 space-y-6\">\n            {/* Overall Score */}\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\n              <h3 className=\"font-semibold text-gray-900 mb-4\">Overall Compliance</h3>\n              <div className=\"flex justify-center mb-4\">\n                <ComplianceScoreGauge score={overallScore} size=\"lg\" />\n              </div>\n              <div className=\"space-y-3\">\n                <div className=\"flex items-center justify-between p-3 bg-blue-50 rounded-lg\">\n                  <div className=\"flex items-center gap-2\">\n                    <Building2 className=\"w-4 h-4 text-blue-600\" />\n                    <span className=\"text-sm font-medium text-gray-700\">Home Office</span>\n                  </div>\n                  <span className=\"text-lg font-bold text-blue-600\">\n                    {stats?.byAuthority?.homeOffice?.score || 0}%\n                  </span>\n                </div>\n                <div className=\"flex items-center justify-between p-3 bg-green-50 rounded-lg\">\n                  <div className=\"flex items-center gap-2\">\n                    <Shield className=\"w-4 h-4 text-green-600\" />\n                    <span className=\"text-sm font-medium text-gray-700\">CQC</span>\n                  </div>\n                  <span className=\"text-lg font-bold text-green-600\">\n                    {stats?.byAuthority?.cqc?.score || 0}%\n                  </span>\n                </div>\n              </div>\n            </div>\n\n            {/* Quick Actions */}\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\n              <h3 className=\"font-semibold text-gray-900 mb-4\">Quick Actions</h3>\n              <div className=\"space-y-2\">\n                <button\n                  onClick={() => setActiveTab('expiring')}\n                  className=\"w-full flex items-center justify-between p-3 bg-red-50 rounded-lg hover:bg-red-100 transition-colors\"\n                >\n                  <span className=\"text-sm font-medium text-red-700\">Expiring Documents</span>\n                  <span className=\"bg-red-600 text-white text-xs px-2 py-1 rounded-full\">\n                    {stats?.expiringDocuments || 0}\n                  </span>\n                </button>\n                <button\n                  onClick={() => setActiveTab('pending')}\n                  className=\"w-full flex items-center justify-between p-3 bg-purple-50 rounded-lg hover:bg-purple-100 transition-colors\"\n                >\n                  <span className=\"text-sm font-medium text-purple-700\">Verify Documents</span>\n                  <span className=\"bg-purple-600 text-white text-xs px-2 py-1 rounded-full\">\n                    {stats?.pendingVerifications || 0}\n                  </span>\n                </button>\n                <button\n                  onClick={() => setActiveTab('tasks')}\n                  className=\"w-full flex items-center justify-between p-3 bg-indigo-50 rounded-lg hover:bg-indigo-100 transition-colors\"\n                >\n                  <span className=\"text-sm font-medium text-indigo-700\">View Tasks</span>\n                  <ChevronRight className=\"w-4 h-4 text-indigo-600\" />\n                </button>\n                <button className=\"w-full flex items-center justify-between p-3 bg-green-50 rounded-lg hover:bg-green-100 transition-colors\">\n                  <span className=\"text-sm font-medium text-green-700\">Generate Report</span>\n                  <ExternalLink className=\"w-4 h-4 text-green-600\" />\n                </button>\n              </div>\n            </div>\n\n            {/* Folder Structure */}\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\n              <h3 className=\"font-semibold text-gray-900 mb-4 flex items-center gap-2\">\n                <FolderOpen className=\"w-5 h-5 text-gray-400\" />\n                Document Folders\n              </h3>\n              <div className=\"space-y-2\">\n                {Object.entries(COMPLIANCE_FOLDER_STRUCTURE).map(([key, folder]) => (\n                  <div\n                    key={key}\n                    className=\"flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors\"\n                    style={{ borderLeft: `4px solid ${folder.color}` }}\n                  >\n                    <span className=\"text-sm font-medium text-gray-700\">{folder.name}</span>\n                    <ChevronRight className=\"w-4 h-4 text-gray-400\" />\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n\n          {/* Main Content Area */}\n          <div className=\"lg:col-span-3\">\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-100\">\n              {/* Tabs */}\n              <div className=\"border-b border-gray-100\">\n                <nav className=\"flex -mb-px overflow-x-auto\">\n                  {[\n                    { id: 'overview', label: 'Overview', icon: BarChart3 },\n                    { id: 'expiring', label: 'Expiring', icon: Clock },\n                    { id: 'pending', label: 'Verification', icon: FileCheck },\n                    { id: 'tasks', label: 'Tasks', icon: Activity },\n                    { id: 'people', label: 'People', icon: Users },\n                  ].map((tab) => (\n                    <button\n                      key={tab.id}\n                      onClick={() => {\n                        setActiveTab(tab.id as any);\n                        if (tab.id !== 'people') setStageFilter(undefined);\n                      }}\n                      className={`flex items-center gap-2 px-6 py-4 text-sm font-medium border-b-2 transition-colors whitespace-nowrap ${activeTab === tab.id\n                        ? 'border-indigo-600 text-indigo-600'\n                        : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                        }`}\n                    >\n                      <tab.icon className=\"w-4 h-4\" />\n                      {tab.label}\n                    </button>\n                  ))}\n                </nav>\n              </div>\n\n              {/* Tab Content */}\n              <div className=\"p-6\">\n                {activeTab === 'overview' && (\n                  <OverviewTab\n                    stats={stats}\n                    loading={statsLoading}\n                    onStageClick={handleStageClick}\n                  />\n                )}\n                {activeTab === 'expiring' && (\n                  <ExpiringDocumentsTab\n                    tenantId={tenantId}\n                    onSendReminder={handleSendReminder}\n                  />\n                )}\n                {activeTab === 'pending' && (\n                  <PendingVerificationTab tenantId={tenantId} />\n                )}\n                {activeTab === 'tasks' && (\n                  <TasksTab tenantId={tenantId} />\n                )}\n                {activeTab === 'people' && (\n                  <PeopleTab\n                    tenantId={tenantId}\n                    stageFilter={stageFilter}\n                    onClearFilter={() => setStageFilter(undefined)}\n                  />\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Help Button */}\n      <div className=\"fixed bottom-6 right-6\">\n        <button className=\"w-12 h-12 bg-indigo-600 text-white rounded-full shadow-lg hover:bg-indigo-700 flex items-center justify-center transition-colors\">\n          <Info className=\"w-6 h-6\" />\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default ComplianceHubPage;\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/CompliancePage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":55,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":55,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\nimport { Shield, AlertTriangle, CheckCircle, Clock, FileText, Download } from 'lucide-react';\nimport { supabase } from '@/lib/supabase';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { log } from '@/lib/logger';\n\ninterface VisaRecord {\n  id: string;\n  visa_type: string;\n  issue_date: string;\n  expiry_date: string;\n  current_status: string;\n}\n\ninterface DBSCertificate {\n  id: string;\n  applicant_name: string;\n  certificate_type: string;\n  issue_date: string;\n  status: string;\n}\n\ninterface RTWCheck {\n  id: string;\n  check_type: string;\n  check_date: string;\n  check_method?: string;\n  check_result: string;\n}\n\ninterface ComplianceAlert {\n  id: string;\n  alert_title: string;\n  alert_message: string;\n  alert_priority: 'critical' | 'high' | 'medium' | 'low';\n  due_date: string;\n}\n\ninterface DashboardData {\n  summary: {\n    compliance_score?: number;\n    total_alerts?: number;\n    critical_alerts?: number;\n    total_visa_records?: number;\n    expiring_visas?: number;\n    total_rtw_checks?: number;\n  };\n  alerts: ComplianceAlert[];\n  visa_records: VisaRecord[];\n  dbs_certificates: DBSCertificate[];\n  rtw_checks: RTWCheck[];\n}\n\nexport default function CompliancePage() {\n  const { user } = useAuth();\n  const [loading, setLoading] = useState(true);\n  const [dashboardData, setDashboardData] = useState<DashboardData | null>(null);\n  const [activeTab, setActiveTab] = useState('overview');\n\n  useEffect(() => {\n    loadComplianceData();\n  }, []);\n\n  async function loadComplianceData() {\n    try {\n      const session = await supabase.auth.getSession();\n      if (!session.data.session) return;\n\n      const { data, error } = await supabase.functions.invoke('compliance-dashboard-data', {\n        headers: {\n          Authorization: `Bearer ${session.data.session.access_token}`\n        }\n      });\n\n      if (error) throw error;\n      setDashboardData(data.data);\n    } catch (error) {\n      log.error('Error loading compliance data', error, { component: 'CompliancePage', action: 'loadComplianceData' });\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function handleAcknowledgeAlert(alertId: string) {\n    try {\n      const session = await supabase.auth.getSession();\n      if (!session.data.session) return;\n\n      await supabase.functions.invoke('compliance-monitoring', {\n        body: {\n          action: 'ACKNOWLEDGE_ALERT',\n          data: { alert_id: alertId }\n        },\n        headers: {\n          Authorization: `Bearer ${session.data.session.access_token}`\n        }\n      });\n\n      loadComplianceData();\n    } catch (error) {\n      log.error('Error acknowledging alert', error, { component: 'CompliancePage', action: 'handleAcknowledgeAlert', metadata: { alertId } });\n    }\n  }\n\n  async function handleGenerateAuditPack() {\n    try {\n      const session = await supabase.auth.getSession();\n      if (!session.data.session) return;\n\n      await supabase.functions.invoke('compliance-monitoring', {\n        body: {\n          action: 'GENERATE_AUDIT_PACK',\n          data: {\n            pack_name: `Audit Pack ${new Date().toLocaleDateString()}`,\n            pack_type: 'compliance_review',\n            date_range_start: new Date(Date.now() - 90 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\n            date_range_end: new Date().toISOString().split('T')[0]\n          }\n        },\n        headers: {\n          Authorization: `Bearer ${session.data.session.access_token}`\n        }\n      });\n\n      alert('Audit pack generated successfully!');\n      loadComplianceData();\n    } catch (error) {\n      log.error('Error generating audit pack', error, { component: 'CompliancePage', action: 'handleGenerateAuditPack' });\n      alert('Failed to generate audit pack');\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600\"></div>\n      </div>\n    );\n  }\n\n  const summary = dashboardData?.summary || {};\n  const alerts = dashboardData?.alerts || [];\n  const visaRecords = dashboardData?.visa_records || [];\n  const dbsCertificates = dashboardData?.dbs_certificates || [];\n  const rtwChecks = dashboardData?.rtw_checks || [];\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Home Office Compliance</h1>\n          <p className=\"text-gray-600 mt-1\">UK Immigration and Right-to-Work Management</p>\n        </div>\n        <button\n          onClick={handleGenerateAuditPack}\n          className=\"flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700\"\n        >\n          <Download className=\"w-4 h-4 mr-2\" />\n          Generate Audit Pack\n        </button>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        <div className=\"bg-white rounded-lg shadow p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-gray-600\">Compliance Score</p>\n              <p className=\"text-3xl font-bold text-gray-900 mt-2\">{summary.compliance_score || 0}%</p>\n            </div>\n            <div className={`w-12 h-12 rounded-full flex items-center justify-center ${(summary.compliance_score || 0) >= 90 ? 'bg-green-100' : 'bg-yellow-100'\n              }`}>\n              <Shield className={`w-6 h-6 ${(summary.compliance_score || 0) >= 90 ? 'text-green-600' : 'text-yellow-600'\n                }`} />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-lg shadow p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-gray-600\">Active Alerts</p>\n              <p className=\"text-3xl font-bold text-gray-900 mt-2\">{summary.total_alerts || 0}</p>\n              <p className=\"text-xs text-red-600 mt-1\">{summary.critical_alerts || 0} Critical</p>\n            </div>\n            <div className=\"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center\">\n              <AlertTriangle className=\"w-6 h-6 text-red-600\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-lg shadow p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-gray-600\">Visa Records</p>\n              <p className=\"text-3xl font-bold text-gray-900 mt-2\">{summary.total_visa_records || 0}</p>\n              <p className=\"text-xs text-yellow-600 mt-1\">{summary.expiring_visas || 0} Expiring Soon</p>\n            </div>\n            <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center\">\n              <FileText className=\"w-6 h-6 text-blue-600\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-lg shadow p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-gray-600\">RTW Checks</p>\n              <p className=\"text-3xl font-bold text-gray-900 mt-2\">{summary.total_rtw_checks || 0}</p>\n              <p className=\"text-xs text-green-600 mt-1\">Completed</p>\n            </div>\n            <div className=\"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center\">\n              <CheckCircle className=\"w-6 h-6 text-green-600\" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"bg-white rounded-lg shadow\">\n        <div className=\"border-b border-gray-200\">\n          <nav className=\"flex -mb-px\">\n            {['overview', 'alerts', 'visa_records', 'dbs', 'rtw_checks'].map((tab) => (\n              <button\n                key={tab}\n                onClick={() => setActiveTab(tab)}\n                className={`px-6 py-3 text-sm font-medium border-b-2 ${activeTab === tab\n                    ? 'border-indigo-600 text-indigo-600'\n                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                  }`}\n              >\n                {tab.replace('_', ' ').replace(/\\b\\w/g, l => l.toUpperCase())}\n              </button>\n            ))}\n          </nav>\n        </div>\n\n        <div className=\"p-6\">\n          {activeTab === 'alerts' && (\n            <div className=\"space-y-4\">\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Active Compliance Alerts</h3>\n              {alerts.length === 0 ? (\n                <p className=\"text-gray-500 text-center py-8\">No active alerts</p>\n              ) : (\n                alerts.map((alert: ComplianceAlert) => (\n                  <div\n                    key={alert.id}\n                    className={`border-l-4 p-4 rounded-r-lg ${alert.alert_priority === 'critical' ? 'border-red-500 bg-red-50' :\n                        alert.alert_priority === 'high' ? 'border-orange-500 bg-orange-50' :\n                          'border-yellow-500 bg-yellow-50'\n                      }`}\n                  >\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1\">\n                        <h4 className=\"font-semibold text-gray-900\">{alert.alert_title}</h4>\n                        <p className=\"text-sm text-gray-600 mt-1\">{alert.alert_message}</p>\n                        <div className=\"flex items-center space-x-4 mt-2 text-xs text-gray-500\">\n                          <span className=\"flex items-center\">\n                            <Clock className=\"w-3 h-3 mr-1\" />\n                            Due: {new Date(alert.due_date).toLocaleDateString()}\n                          </span>\n                          <span className=\"px-2 py-1 bg-white rounded capitalize\">\n                            {alert.alert_priority}\n                          </span>\n                        </div>\n                      </div>\n                      <button\n                        onClick={() => handleAcknowledgeAlert(alert.id)}\n                        className=\"ml-4 px-3 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-50\"\n                      >\n                        Acknowledge\n                      </button>\n                    </div>\n                  </div>\n                ))\n              )}\n            </div>\n          )}\n\n          {activeTab === 'visa_records' && (\n            <div className=\"overflow-x-auto\">\n              <table className=\"min-w-full divide-y divide-gray-200\">\n                <thead>\n                  <tr className=\"bg-gray-50\">\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Visa Type</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Issue Date</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Expiry Date</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Status</th>\n                  </tr>\n                </thead>\n                <tbody className=\"bg-white divide-y divide-gray-200\">\n                  {visaRecords.map((record: VisaRecord) => (\n                    <tr key={record.id}>\n                      <td className=\"px-6 py-4 text-sm text-gray-900\">{record.visa_type}</td>\n                      <td className=\"px-6 py-4 text-sm text-gray-500\">{new Date(record.issue_date).toLocaleDateString()}</td>\n                      <td className=\"px-6 py-4 text-sm text-gray-500\">{new Date(record.expiry_date).toLocaleDateString()}</td>\n                      <td className=\"px-6 py-4\">\n                        <span className={`px-2 py-1 text-xs rounded-full ${record.current_status === 'active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'\n                          }`}>\n                          {record.current_status}\n                        </span>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          )}\n\n          {activeTab === 'dbs' && (\n            <div className=\"overflow-x-auto\">\n              <table className=\"min-w-full divide-y divide-gray-200\">\n                <thead>\n                  <tr className=\"bg-gray-50\">\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Applicant</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Type</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Issue Date</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Status</th>\n                  </tr>\n                </thead>\n                <tbody className=\"bg-white divide-y divide-gray-200\">\n                  {dbsCertificates.map((cert: DBSCertificate) => (\n                    <tr key={cert.id}>\n                      <td className=\"px-6 py-4 text-sm text-gray-900\">{cert.applicant_name}</td>\n                      <td className=\"px-6 py-4 text-sm text-gray-500 capitalize\">{cert.certificate_type.replace('_', ' ')}</td>\n                      <td className=\"px-6 py-4 text-sm text-gray-500\">{new Date(cert.issue_date).toLocaleDateString()}</td>\n                      <td className=\"px-6 py-4\">\n                        <span className={`px-2 py-1 text-xs rounded-full ${cert.status === 'approved' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'\n                          }`}>\n                          {cert.status}\n                        </span>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          )}\n\n          {activeTab === 'rtw_checks' && (\n            <div className=\"overflow-x-auto\">\n              <table className=\"min-w-full divide-y divide-gray-200\">\n                <thead>\n                  <tr className=\"bg-gray-50\">\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Check Type</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Check Date</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Method</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Result</th>\n                  </tr>\n                </thead>\n                <tbody className=\"bg-white divide-y divide-gray-200\">\n                  {rtwChecks.map((check: RTWCheck) => (\n                    <tr key={check.id}>\n                      <td className=\"px-6 py-4 text-sm text-gray-900 capitalize\">{check.check_type.replace('_', ' ')}</td>\n                      <td className=\"px-6 py-4 text-sm text-gray-500\">{new Date(check.check_date).toLocaleDateString()}</td>\n                      <td className=\"px-6 py-4 text-sm text-gray-500 capitalize\">{check.check_method?.replace('_', ' ')}</td>\n                      <td className=\"px-6 py-4\">\n                        <span className={`px-2 py-1 text-xs rounded-full ${check.check_result === 'pass' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'\n                          }`}>\n                          {check.check_result}\n                        </span>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/ComplianceSettingsPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/DashboardPage.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadDashboardData'. Either include it or remove the dependency array.","line":45,"column":6,"nodeType":"ArrayExpression","endLine":45,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [currentTenant, loadDashboardData]","fix":{"range":[1318,1333],"text":"[currentTenant, loadDashboardData]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used. Allowed unused caught errors must match /^_/u.","line":96,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":96,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used. Allowed unused caught errors must match /^_/u.","line":111,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":111,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { useTenant } from '@/contexts/TenantContext';\nimport {\n  Users,\n  Briefcase,\n  Calendar,\n  AlertTriangle,\n  Clock,\n  CheckCircle,\n  FileText\n} from 'lucide-react';\nimport { format } from 'date-fns';\nimport AdminPrivilegeSetup from '../components/AdminPrivilegeSetup';\nimport DashboardAnalytics from '../components/DashboardAnalytics';\nimport UKComplianceDashboardWidget from '../components/UKComplianceDashboardWidget';\nimport { log } from '@/lib/logger';\n\ninterface DashboardStats {\n  totalEmployees: number;\n  activeJobs: number;\n  pendingApplications: number;\n  upcomingExpiries: number;\n  todayAttendance: number;\n  pendingLeaveRequests: number;\n}\n\nexport default function DashboardPage() {\n  const { currentTenant } = useTenant();\n  const [stats, setStats] = useState<DashboardStats>({\n    totalEmployees: 0,\n    activeJobs: 0,\n    pendingApplications: 0,\n    upcomingExpiries: 0,\n    todayAttendance: 0,\n    pendingLeaveRequests: 0,\n  });\n  const [recentActivities, setRecentActivities] = useState<{ id: string; action: string; entity_type: string; timestamp: string }[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    if (currentTenant) {\n      loadDashboardData();\n    }\n  }, [currentTenant]);\n\n  async function loadDashboardData() {\n    if (!currentTenant) return;\n\n    try {\n      // Get total employees for current tenant\n      const { count: employeeCount } = await supabase\n        .from('employees')\n        .select('*', { count: 'exact', head: true })\n        .eq('tenant_id', currentTenant.id)\n        .eq('status', 'active');\n\n      // Get active job postings for current tenant\n      const { count: jobCount } = await supabase\n        .from('job_postings')\n        .select('*', { count: 'exact', head: true })\n        .eq('tenant_id', currentTenant.id)\n        .eq('status', 'published');\n\n      // Get pending applications for current tenant\n      const { count: appCount } = await supabase\n        .from('applications')\n        .select('*', { count: 'exact', head: true })\n        .eq('tenant_id', currentTenant.id)\n        .in('status', ['applied', 'screening', 'interview_scheduled']);\n\n      // Get upcoming document expiries for current tenant (next 30 days)\n      const thirtyDaysFromNow = new Date();\n      thirtyDaysFromNow.setDate(thirtyDaysFromNow.getDate() + 30);\n\n      const { count: expiryCount } = await supabase\n        .from('documents')\n        .select('*', { count: 'exact', head: true })\n        .eq('tenant_id', currentTenant.id)\n        .not('expiry_date', 'is', null)\n        .lte('expiry_date', thirtyDaysFromNow.toISOString().split('T')[0])\n        .eq('is_current_version', true);\n\n      // Get today's attendance for current tenant\n      // Uses tenant_id column - run migration 015 if this fails\n      let attendanceCount = 0;\n      try {\n        const today = new Date().toISOString().split('T')[0];\n        const { count } = await supabase\n          .from('attendance_records')\n          .select('*', { count: 'exact', head: true })\n          .eq('tenant_id', currentTenant.id)\n          .eq('date', today)\n          .eq('status', 'present');\n        attendanceCount = count || 0;\n      } catch (error) {\n        // Table may not have tenant_id column yet - migration needed\n        log.debug('attendance_records query failed - run migration 015', { component: 'DashboardPage' });\n      }\n\n      // Get pending leave requests for current tenant\n      // Uses tenant_id column - run migration 015 if this fails\n      let leaveCount = 0;\n      try {\n        const { count } = await supabase\n          .from('leave_requests')\n          .select('*', { count: 'exact', head: true })\n          .eq('tenant_id', currentTenant.id)\n          .eq('status', 'pending');\n        leaveCount = count || 0;\n      } catch (error) {\n        // Table may not have tenant_id column yet - migration needed\n        log.debug('leave_requests query failed - run migration 015', { component: 'DashboardPage' });\n      }\n\n      // Get recent audit logs for current tenant\n      const { data: logs } = await supabase\n        .from('audit_logs')\n        .select('*')\n        .eq('tenant_id', currentTenant.id)\n        .order('timestamp', { ascending: false })\n        .limit(10);\n\n      setStats({\n        totalEmployees: employeeCount || 0,\n        activeJobs: jobCount || 0,\n        pendingApplications: appCount || 0,\n        upcomingExpiries: expiryCount || 0,\n        todayAttendance: attendanceCount || 0,\n        pendingLeaveRequests: leaveCount || 0,\n      });\n\n      setRecentActivities(logs || []);\n    } catch (error) {\n      log.error('Error loading dashboard data', error, { component: 'DashboardPage', action: 'loadDashboardData' });\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  const statCards = [\n    {\n      name: 'Total Employees',\n      value: stats.totalEmployees,\n      icon: Users,\n      color: 'bg-blue-500',\n      change: '+12%'\n    },\n    {\n      name: 'Active Job Postings',\n      value: stats.activeJobs,\n      icon: Briefcase,\n      color: 'bg-green-500',\n      change: '+5%'\n    },\n    {\n      name: 'Pending Applications',\n      value: stats.pendingApplications,\n      icon: FileText,\n      color: 'bg-purple-500',\n      change: '+23%'\n    },\n    {\n      name: 'Document Expiries',\n      value: stats.upcomingExpiries,\n      icon: AlertTriangle,\n      color: 'bg-orange-500',\n      change: 'Next 30 days'\n    },\n  ];\n\n  const quickStats = [\n    { name: 'Today\\'s Attendance', value: stats.todayAttendance, icon: CheckCircle },\n    { name: 'Pending Leave Requests', value: stats.pendingLeaveRequests, icon: Calendar },\n  ];\n\n  if (loading || !currentTenant) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold text-gray-900\">Dashboard</h1>\n        <p className=\"mt-1 text-sm text-gray-600\">Welcome back! Here's what's happening today.</p>\n      </div>\n\n      {/* Main Stats Grid */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n        {statCards.map((stat) => (\n          <div key={stat.name} className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600\">{stat.name}</p>\n                <p className=\"mt-2 text-3xl font-bold text-gray-900\">{stat.value}</p>\n                <p className=\"mt-1 text-xs text-gray-500\">{stat.change}</p>\n              </div>\n              <div className={`${stat.color} rounded-xl p-3`}>\n                <stat.icon className=\"w-6 h-6 text-white\" />\n              </div>\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {/* Quick Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8\">\n        {quickStats.map((stat) => (\n          <div key={stat.name} className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n            <div className=\"flex items-center\">\n              <div className=\"flex-shrink-0\">\n                <stat.icon className=\"w-8 h-8 text-indigo-600\" />\n              </div>\n              <div className=\"ml-4\">\n                <p className=\"text-sm font-medium text-gray-600\">{stat.name}</p>\n                <p className=\"text-2xl font-bold text-gray-900\">{stat.value}</p>\n              </div>\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {/* Recent Activities */}\n      <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <h2 className=\"text-lg font-semibold text-gray-900\">Recent Activities</h2>\n          <Clock className=\"w-5 h-5 text-gray-400\" />\n        </div>\n\n        <div className=\"space-y-4\">\n          {recentActivities.length > 0 ? (\n            recentActivities.map((activity) => (\n              <div key={activity.id} className=\"flex items-start border-l-2 border-indigo-500 pl-4 py-2\">\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-medium text-gray-900\">{activity.action}</p>\n                  <p className=\"text-xs text-gray-500 capitalize\">{activity.entity_type}</p>\n                  <p className=\"text-xs text-gray-400 mt-1\">\n                    {format(new Date(activity.timestamp), 'MMM dd, yyyy HH:mm')}\n                  </p>\n                </div>\n              </div>\n            ))\n          ) : (\n            <p className=\"text-sm text-gray-500 text-center py-8\">No recent activities</p>\n          )}\n        </div>\n      </div>\n\n      {/* UK Compliance Widget - CQC & Home Office */}\n      <div className=\"mt-8\">\n        <UKComplianceDashboardWidget />\n      </div>\n\n      {/* Analytics Section */}\n      <div className=\"mt-8\">\n        <DashboardAnalytics />\n      </div>\n\n      {/* Admin Privilege Setup */}\n      <AdminPrivilegeSetup />\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/DocumentsPage.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadDocuments'. Either include it or remove the dependency array.","line":24,"column":6,"nodeType":"ArrayExpression","endLine":24,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadDocuments]","fix":{"range":[725,727],"text":"[loadDocuments]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { FileText, Upload, Filter, Search } from 'lucide-react';\nimport DragDropUpload from '@/components/DragDropUpload';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\n\ninterface Document {\n  id: string;\n  document_name: string;\n  document_type: string;\n  file_size_bytes: number;\n  uploaded_at: string;\n  is_verified: boolean;\n}\n\nexport default function DocumentsPage() {\n  const [documents, setDocuments] = useState<Document[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [filterType, setFilterType] = useState('all');\n  const [searchQuery, setSearchQuery] = useState('');\n\n  useEffect(() => {\n    loadDocuments();\n  }, []);\n\n  async function loadDocuments() {\n    try {\n      let query = supabase\n        .from('documents')\n        .select('*')\n        .order('uploaded_at', { ascending: false });\n\n      if (filterType !== 'all') {\n        query = query.eq('document_type', filterType);\n      }\n\n      const { data, error } = await query;\n\n      if (error) throw error;\n      setDocuments(data || []);\n    } catch (error) {\n      log.error('Error loading documents', error, { component: 'DocumentsPage', action: 'loadDocuments' });\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  const handleUploadComplete = () => {\n    loadDocuments();\n  };\n\n  const filteredDocuments = documents.filter(doc =>\n    doc.document_name.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-bold text-gray-900\">Document Management</h1>\n        <p className=\"text-gray-600 mt-1\">Upload and manage employee documents with drag & drop</p>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n        <div className=\"bg-white rounded-lg shadow p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-gray-600\">Total Documents</p>\n              <p className=\"text-3xl font-bold text-gray-900 mt-2\">{documents.length}</p>\n            </div>\n            <div className=\"w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center\">\n              <FileText className=\"w-6 h-6 text-indigo-600\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-lg shadow p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-gray-600\">Verified</p>\n              <p className=\"text-3xl font-bold text-gray-900 mt-2\">\n                {documents.filter(d => d.is_verified).length}\n              </p>\n            </div>\n            <div className=\"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center\">\n              <FileText className=\"w-6 h-6 text-green-600\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-lg shadow p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-gray-600\">Pending Review</p>\n              <p className=\"text-3xl font-bold text-gray-900 mt-2\">\n                {documents.filter(d => !d.is_verified).length}\n              </p>\n            </div>\n            <div className=\"w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center\">\n              <Upload className=\"w-6 h-6 text-yellow-600\" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"bg-white rounded-lg shadow p-6\">\n        <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">Upload Documents</h2>\n        <DragDropUpload onUploadComplete={handleUploadComplete} />\n      </div>\n\n      <div className=\"bg-white rounded-lg shadow\">\n        <div className=\"p-6 border-b border-gray-200\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h2 className=\"text-xl font-semibold text-gray-900\">Document Library</h2>\n          </div>\n          <div className=\"flex space-x-4\">\n            <div className=\"flex-1 relative\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400\" />\n              <input\n                type=\"text\"\n                placeholder=\"Search documents...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n              />\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <Filter className=\"w-5 h-5 text-gray-400\" />\n              <select\n                value={filterType}\n                onChange={(e) => setFilterType(e.target.value)}\n                className=\"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n              >\n                <option value=\"all\">All Types</option>\n                <option value=\"document\">Documents</option>\n                <option value=\"image\">Images</option>\n                <option value=\"spreadsheet\">Spreadsheets</option>\n              </select>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"p-6\">\n          {loading ? (\n            <div className=\"text-center py-12\">\n              <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto\"></div>\n            </div>\n          ) : filteredDocuments.length === 0 ? (\n            <div className=\"text-center py-12 bg-gray-50 rounded-lg\">\n              <FileText className=\"w-16 h-16 text-gray-300 mx-auto mb-4\" />\n              <p className=\"text-gray-500 mb-2\">No documents found</p>\n              <p className=\"text-sm text-gray-400\">Upload your first document using the form above</p>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <table className=\"min-w-full divide-y divide-gray-200\">\n                <thead>\n                  <tr className=\"bg-gray-50\">\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Document Name</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Type</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Size</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Uploaded</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Status</th>\n                  </tr>\n                </thead>\n                <tbody className=\"bg-white divide-y divide-gray-200\">\n                  {filteredDocuments.map((doc) => (\n                    <tr key={doc.id} className=\"hover:bg-gray-50\">\n                      <td className=\"px-6 py-4 text-sm text-gray-900\">{doc.document_name}</td>\n                      <td className=\"px-6 py-4 text-sm text-gray-500 capitalize\">{doc.document_type}</td>\n                      <td className=\"px-6 py-4 text-sm text-gray-500\">\n                        {(doc.file_size_bytes / 1024).toFixed(1)} KB\n                      </td>\n                      <td className=\"px-6 py-4 text-sm text-gray-500\">\n                        {new Date(doc.uploaded_at).toLocaleDateString()}\n                      </td>\n                      <td className=\"px-6 py-4\">\n                        <span className={`px-2 py-1 text-xs rounded-full ${doc.is_verified\n                          ? 'bg-green-100 text-green-800'\n                          : 'bg-yellow-100 text-yellow-800'\n                          }`}>\n                          {doc.is_verified ? 'Verified' : 'Pending'}\n                        </span>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/ForgotPasswordPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/FormsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Eye' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Modal' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showCreateModal' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":85,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":85,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":102,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":102,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { FileText, Plus, Edit, Trash2, Eye } from 'lucide-react';\nimport FormBuilder, { FormField } from '@/components/FormBuilder/FormBuilder';\nimport Toast from '@/components/Toast';\nimport Modal from '@/components/Modal';\nimport { log } from '@/lib/logger';\n\ntype FormType =\n    | 'job_application'\n    | 'employee_evaluation'\n    | 'incident_report'\n    | 'training_request'\n    | 'leave_request'\n    | 'performance_review'\n    | 'care_plan'\n    | 'medication_administration'\n    | 'risk_assessment'\n    | 'safeguarding_concern'\n    | 'supervision_record'\n    | 'competency_assessment'\n    | 'health_declaration'\n    | 'consent_form'\n    | 'complaint_form'\n    | 'other';\n\ntype FormCategory = 'recruitment' | 'hr' | 'compliance' | 'operations' | 'training' | 'clinical' | 'general';\n\ninterface FormTemplate {\n    id: string;\n    name: string;\n    description: string;\n    form_type: FormType;\n    category: FormCategory;\n    folder?: string;\n    schema: FormField[];\n    is_active: boolean;\n    created_at: string;\n}\n\nconst formTypeLabels: Record<FormType, string> = {\n    job_application: 'Job Application',\n    employee_evaluation: 'Employee Evaluation',\n    incident_report: 'Incident Report',\n    training_request: 'Training Request',\n    leave_request: 'Leave Request',\n    performance_review: 'Performance Review',\n    care_plan: 'Care Plan',\n    medication_administration: 'Medication Administration Record',\n    risk_assessment: 'Risk Assessment',\n    safeguarding_concern: 'Safeguarding Concern',\n    supervision_record: 'Supervision Record',\n    competency_assessment: 'Competency Assessment',\n    health_declaration: 'Health Declaration',\n    consent_form: 'Consent Form',\n    complaint_form: 'Complaint Form',\n    other: 'Other'\n};\n\nconst formTypeColors: Record<FormType, string> = {\n    job_application: 'bg-blue-100 text-blue-800',\n    employee_evaluation: 'bg-green-100 text-green-800',\n    incident_report: 'bg-red-100 text-red-800',\n    training_request: 'bg-purple-100 text-purple-800',\n    leave_request: 'bg-yellow-100 text-yellow-800',\n    performance_review: 'bg-indigo-100 text-indigo-800',\n    care_plan: 'bg-teal-100 text-teal-800',\n    medication_administration: 'bg-pink-100 text-pink-800',\n    risk_assessment: 'bg-orange-100 text-orange-800',\n    safeguarding_concern: 'bg-red-200 text-red-900',\n    supervision_record: 'bg-cyan-100 text-cyan-800',\n    competency_assessment: 'bg-lime-100 text-lime-800',\n    health_declaration: 'bg-emerald-100 text-emerald-800',\n    consent_form: 'bg-violet-100 text-violet-800',\n    complaint_form: 'bg-amber-100 text-amber-800',\n    other: 'bg-gray-100 text-gray-800'\n};\n\nexport default function FormsPage() {\n    const [forms, setForms] = useState<FormTemplate[]>([]);\n    const [loading, setLoading] = useState(false);\n    const [activeTab, setActiveTab] = useState<'all' | 'create'>('all');\n    const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' } | null>(null);\n    const [editingForm, setEditingForm] = useState<FormTemplate | null>(null);\n    const [showCreateModal, setShowCreateModal] = useState(false);\n    const [categoryFilter, setCategoryFilter] = useState<FormCategory | 'all'>('all');\n\n    // New form state\n    const [newFormName, setNewFormName] = useState('');\n    const [newFormDescription, setNewFormDescription] = useState('');\n    const [newFormType, setNewFormType] = useState<FormType>('other');\n    const [newFormCategory, setNewFormCategory] = useState<FormCategory>('general');\n    const [newFormFolder, setNewFormFolder] = useState('general');\n    const [uploadingTemplate, setUploadingTemplate] = useState(false);\n\n    useEffect(() => {\n        loadForms();\n    }, []);\n\n    async function loadForms() {\n        setLoading(true);\n        const { data, error } = await supabase\n            .from('form_templates')\n            .select('*')\n            .order('created_at', { ascending: false });\n\n        if (data) {\n            setForms(data);\n        }\n        setLoading(false);\n    }\n\n    async function createNewForm() {\n        if (!newFormName.trim()) {\n            setToast({ message: 'Please enter a form name', type: 'error' });\n            return;\n        }\n\n        setLoading(true);\n        const { error } = await supabase\n            .from('form_templates')\n            .insert({\n                name: newFormName,\n                description: newFormDescription,\n                form_type: newFormType,\n                category: newFormCategory,\n                folder: newFormFolder,\n                schema: [],\n                is_active: true\n            });\n\n        if (error) {\n            setToast({ message: 'Failed to create form', type: 'error' });\n        } else {\n            setToast({ message: 'Form created successfully', type: 'success' });\n            setShowCreateModal(false);\n            setNewFormName('');\n            setNewFormDescription('');\n            setNewFormType('other');\n            setNewFormCategory('general');\n            setNewFormFolder('general');\n            loadForms();\n        }\n        setLoading(false);\n    }\n\n    async function deleteForm(id: string) {\n        if (!confirm('Are you sure you want to delete this form?')) return;\n\n        const { error } = await supabase\n            .from('form_templates')\n            .delete()\n            .eq('id', id);\n\n        if (error) {\n            setToast({ message: 'Failed to delete form', type: 'error' });\n        } else {\n            setToast({ message: 'Form deleted successfully', type: 'success' });\n            loadForms();\n        }\n    }\n\n    async function saveFormSchema(schema: FormField[]) {\n        if (!editingForm) return;\n\n        const { error } = await supabase\n            .from('form_templates')\n            .update({ schema, updated_at: new Date().toISOString() })\n            .eq('id', editingForm.id);\n\n        if (error) {\n            setToast({ message: 'Failed to save form', type: 'error' });\n        } else {\n            setToast({ message: 'Form saved successfully', type: 'success' });\n            setEditingForm(null);\n            loadForms();\n        }\n    }\n\n    async function handleTemplateUpload(event: React.ChangeEvent<HTMLInputElement>) {\n        const file = event.target.files?.[0];\n        if (!file) return;\n\n        const fileExtension = file.name.split('.').pop()?.toLowerCase();\n        if (!['json', 'txt'].includes(fileExtension || '')) {\n            setToast({ message: 'Please upload a JSON or TXT file', type: 'error' });\n            return;\n        }\n\n        setUploadingTemplate(true);\n        try {\n            const fileContent = await file.text();\n            const templateData = JSON.parse(fileContent);\n\n            // Validate template structure\n            if (!templateData.name || !templateData.schema || !Array.isArray(templateData.schema)) {\n                throw new Error('Invalid template format. Template must include name and schema array.');\n            }\n\n            // Create form from template\n            const { error } = await supabase\n                .from('form_templates')\n                .insert({\n                    name: templateData.name,\n                    description: templateData.description || '',\n                    form_type: templateData.form_type || 'other',\n                    category: templateData.category || 'general',\n                    folder: templateData.folder || 'general',\n                    schema: templateData.schema,\n                    is_active: true\n                });\n\n            if (error) throw error;\n\n            setToast({ message: `Template \"${templateData.name}\" imported successfully`, type: 'success' });\n            loadForms();\n            setActiveTab('all');\n        } catch (error) {\n            log.error('Template upload error', error, { component: 'FormsPage', action: 'handleTemplateUpload' });\n            let message = 'Failed to import template';\n            if (error instanceof SyntaxError) {\n                message = 'Invalid JSON format. Please ensure the file contains valid JSON data.';\n            } else if (error instanceof Error) {\n                message = error.message;\n            }\n            setToast({ message, type: 'error' });\n        } finally {\n            setUploadingTemplate(false);\n            // Reset file input\n            event.target.value = '';\n        }\n    }\n\n    // Filter forms by category\n    const filteredForms = categoryFilter === 'all'\n        ? forms\n        : forms.filter(f => f.category === categoryFilter);\n\n    return (\n        <div>\n            <div className=\"mb-8\">\n                <h1 className=\"text-3xl font-bold text-gray-900\">Forms Management</h1>\n                <p className=\"mt-1 text-sm text-gray-600\">Create and manage forms for different purposes</p>\n            </div>\n\n            {/* Tabs */}\n            <div className=\"mb-6 border-b border-gray-200\">\n                <nav className=\"-mb-px flex space-x-8\">\n                    <button\n                        onClick={() => setActiveTab('all')}\n                        className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${activeTab === 'all'\n                            ? 'border-indigo-500 text-indigo-600'\n                            : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                            }`}\n                    >\n                        All Forms\n                    </button>\n                    <button\n                        onClick={() => setActiveTab('create')}\n                        className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${activeTab === 'create'\n                            ? 'border-indigo-500 text-indigo-600'\n                            : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                            }`}\n                    >\n                        Create New\n                    </button>\n                </nav>\n            </div>\n\n            {/* Category Filter */}\n            {activeTab === 'all' && !editingForm && (\n                <div className=\"mb-4\">\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">Filter by Category</label>\n                    <select\n                        value={categoryFilter}\n                        onChange={(e) => setCategoryFilter(e.target.value as FormCategory | 'all')}\n                        className=\"px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500\"\n                    >\n                        <option value=\"all\">All Categories</option>\n                        <option value=\"recruitment\">Recruitment</option>\n                        <option value=\"hr\">HR</option>\n                        <option value=\"compliance\">Compliance</option>\n                        <option value=\"operations\">Operations</option>\n                        <option value=\"training\">Training</option>\n                        <option value=\"clinical\">Clinical</option>\n                        <option value=\"general\">General</option>\n                    </select>\n                </div>\n            )}\n\n            {/* Content */}\n            {activeTab === 'all' && (\n                <div>\n                    {editingForm ? (\n                        <div>\n                            <div className=\"mb-4 flex items-center justify-between\">\n                                <h2 className=\"text-xl font-semibold\">Editing: {editingForm.name}</h2>\n                                <button\n                                    onClick={() => setEditingForm(null)}\n                                    className=\"text-gray-600 hover:text-gray-900\"\n                                >\n                                    â Back to List\n                                </button>\n                            </div>\n                            <FormBuilder\n                                key={editingForm.id}\n                                initialSchema={editingForm.schema}\n                                onSave={saveFormSchema}\n                            />\n                        </div>\n                    ) : (\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                            {filteredForms.map((form) => (\n                                <div key={form.id} className=\"bg-white rounded-lg shadow border border-gray-200 p-6\">\n                                    <div className=\"flex items-start justify-between mb-3\">\n                                        <div className=\"flex-1\">\n                                            <h3 className=\"text-lg font-semibold text-gray-900\">{form.name}</h3>\n                                            <p className=\"text-sm text-gray-500 mt-1\">{form.description || 'No description'}</p>\n                                        </div>\n                                    </div>\n\n                                    <div className=\"flex gap-2 mb-4 flex-wrap\">\n                                        <span className={`px-2 py-1 text-xs font-medium rounded ${formTypeColors[form.form_type]}`}>\n                                            {formTypeLabels[form.form_type]}\n                                        </span>\n                                        <span className=\"px-2 py-1 text-xs font-medium rounded bg-gray-100 text-gray-700\">\n                                            {form.category}\n                                        </span>\n                                        {form.folder && (\n                                            <span className=\"px-2 py-1 text-xs font-medium rounded bg-blue-50 text-blue-700 border border-blue-200\">\n                                                ð {form.folder}\n                                            </span>\n                                        )}\n                                    </div>\n\n                                    <div className=\"flex gap-2\">\n                                        <button\n                                            onClick={() => setEditingForm(form)}\n                                            className=\"flex-1 inline-flex items-center justify-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50\"\n                                        >\n                                            <Edit className=\"w-4 h-4 mr-1\" />\n                                            Edit\n                                        </button>\n                                        <button\n                                            onClick={() => deleteForm(form.id)}\n                                            className=\"inline-flex items-center justify-center px-3 py-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-white hover:bg-red-50\"\n                                        >\n                                            <Trash2 className=\"w-4 h-4\" />\n                                        </button>\n                                    </div>\n                                </div>\n                            ))}\n\n                            {filteredForms.length === 0 && !loading && (\n                                <div className=\"col-span-full text-center py-12\">\n                                    <FileText className=\"mx-auto h-12 w-12 text-gray-400\" />\n                                    <h3 className=\"mt-2 text-sm font-medium text-gray-900\">{categoryFilter === 'all' ? 'No forms yet' : `No ${categoryFilter} forms yet`}</h3>\n                                    <p className=\"mt-1 text-sm text-gray-500\">{categoryFilter === 'all' ? 'Get started by creating a new form.' : `Create a ${categoryFilter} form to get started.`}</p>\n                                    <button\n                                        onClick={() => setActiveTab('create')}\n                                        className=\"mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700\"\n                                    >\n                                        <Plus className=\"w-4 h-4 mr-2\" />\n                                        Create Form\n                                    </button>\n                                </div>\n                            )}\n                        </div>\n                    )}\n                </div>\n            )}\n\n            {activeTab === 'create' && (\n                <div className=\"max-w-2xl\">\n                    <div className=\"bg-white rounded-lg shadow p-6\">\n                        <h2 className=\"text-xl font-semibold mb-6\">Create New Form</h2>\n\n                        <div className=\"space-y-4\">\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Form Name *</label>\n                                <input\n                                    type=\"text\"\n                                    value={newFormName}\n                                    onChange={(e) => setNewFormName(e.target.value)}\n                                    placeholder=\"e.g., Annual Performance Review\"\n                                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500\"\n                                />\n                            </div>\n\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Description</label>\n                                <textarea\n                                    value={newFormDescription}\n                                    onChange={(e) => setNewFormDescription(e.target.value)}\n                                    placeholder=\"Brief description of this form's purpose\"\n                                    rows={3}\n                                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500\"\n                                />\n                            </div>\n\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Form Type *</label>\n                                <select\n                                    value={newFormType}\n                                    onChange={(e) => setNewFormType(e.target.value as FormType)}\n                                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500\"\n                                >\n                                    {Object.entries(formTypeLabels).map(([value, label]) => (\n                                        <option key={value} value={value}>{label}</option>\n                                    ))}\n                                </select>\n                            </div>\n\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Category *</label>\n                                <select\n                                    value={newFormCategory}\n                                    onChange={(e) => setNewFormCategory(e.target.value as FormCategory)}\n                                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500\"\n                                >\n                                    <option value=\"recruitment\">Recruitment</option>\n                                    <option value=\"hr\">HR</option>\n                                    <option value=\"compliance\">Compliance</option>\n                                    <option value=\"operations\">Operations</option>\n                                    <option value=\"training\">Training</option>\n                                    <option value=\"clinical\">Clinical</option>\n                                    <option value=\"general\">General</option>\n                                </select>\n                            </div>\n\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Folder *</label>\n                                <select\n                                    value={newFormFolder}\n                                    onChange={(e) => setNewFormFolder(e.target.value)}\n                                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500\"\n                                >\n                                    <option value=\"general\">General</option>\n                                    <option value=\"recruitment\">Recruitment</option>\n                                    <option value=\"hr\">HR</option>\n                                    <option value=\"compliance\">Compliance</option>\n                                    <option value=\"clinical\">Clinical</option>\n                                    <option value=\"training\">Training</option>\n                                    <option value=\"operations\">Operations</option>\n                                </select>\n                            </div>\n\n                            <div className=\"border-t border-gray-200 pt-4\">\n                                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Or Upload Template</label>\n                                <div className=\"flex items-center gap-2\">\n                                    <label className=\"flex-1 cursor-pointer\">\n                                        <input\n                                            type=\"file\"\n                                            accept=\".json,.txt\"\n                                            onChange={handleTemplateUpload}\n                                            disabled={uploadingTemplate}\n                                            className=\"hidden\"\n                                        />\n                                        <div className=\"w-full flex justify-center py-2 px-4 border-2 border-dashed border-gray-300 rounded-md hover:border-indigo-500 transition-colors\">\n                                            <span className=\"text-sm text-gray-600\">\n                                                {uploadingTemplate ? 'Uploading...' : 'Choose JSON/TXT file'}\n                                            </span>\n                                        </div>\n                                    </label>\n                                </div>\n                                <p className=\"mt-1 text-xs text-gray-500\">Upload a form template in JSON or TXT format</p>\n                            </div>\n\n                            <button\n                                onClick={createNewForm}\n                                disabled={loading}\n                                className=\"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50\"\n                            >\n                                {loading ? 'Creating...' : 'Create Form'}\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {toast && (\n                <Toast\n                    message={toast.message}\n                    type={toast.type}\n                    onClose={() => setToast(null)}\n                />\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/GovernanceDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Users' is defined but never used. Allowed unused vars must match /^_/u.","line":20,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Award' is defined but never used. Allowed unused vars must match /^_/u.","line":23,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'currentTenant' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":75,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":75,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":77,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":77,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setLoading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":77,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":77,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Governance Dashboard\n * \n * Central hub for CQC compliance oversight:\n * - Real-time compliance metrics\n * - Regulatory requirement tracking\n * - Audit trail and evidence management\n * - Key Performance Indicators\n */\n\nimport React, { useState, useEffect } from 'react';\nimport {\n    Shield,\n    BarChart3,\n    TrendingUp,\n    TrendingDown,\n    AlertTriangle,\n    CheckCircle,\n    Clock,\n    Users,\n    FileText,\n    Calendar,\n    Award,\n    Target,\n    Activity,\n    Eye,\n    Download,\n    RefreshCcw,\n    ChevronRight,\n    AlertCircle,\n    Zap\n} from 'lucide-react';\nimport { useTenant } from '@/contexts/TenantContext';\n\n// ============================================\n// TYPES\n// ============================================\n\ninterface ComplianceMetric {\n    id: string;\n    name: string;\n    category: 'regulation_19' | 'regulation_18' | 'regulation_9a' | 'fundamental_standards' | 'home_office';\n    currentValue: number;\n    targetValue: number;\n    trend: 'up' | 'down' | 'stable';\n    lastUpdated: string;\n    status: 'compliant' | 'at_risk' | 'non_compliant';\n}\n\ninterface AuditItem {\n    id: string;\n    timestamp: string;\n    action: string;\n    user: string;\n    category: string;\n    details: string;\n    severity: 'info' | 'warning' | 'critical';\n}\n\ninterface RegulatoryRequirement {\n    id: string;\n    regulation: string;\n    requirement: string;\n    status: 'met' | 'partial' | 'not_met';\n    evidenceCount: number;\n    lastInspection?: string;\n    notes?: string;\n}\n\n// ============================================\n// COMPONENT\n// ============================================\n\nexport default function GovernanceDashboard() {\n    const { currentTenant } = useTenant();\n    const [selectedTimeframe, setSelectedTimeframe] = useState<'7d' | '30d' | '90d' | '12m'>('30d');\n    const [loading, setLoading] = useState(false);\n\n    // Demo metrics data\n    const metrics: ComplianceMetric[] = [\n        { id: 'm1', name: 'DBS Check Compliance', category: 'regulation_19', currentValue: 98, targetValue: 100, trend: 'up', lastUpdated: '2024-12-21', status: 'compliant' },\n        { id: 'm2', name: 'Right to Work Valid', category: 'home_office', currentValue: 100, targetValue: 100, trend: 'stable', lastUpdated: '2024-12-21', status: 'compliant' },\n        { id: 'm3', name: 'Training Completion', category: 'regulation_18', currentValue: 94, targetValue: 95, trend: 'up', lastUpdated: '2024-12-21', status: 'at_risk' },\n        { id: 'm4', name: 'Staff Competency', category: 'regulation_18', currentValue: 91, targetValue: 90, trend: 'up', lastUpdated: '2024-12-21', status: 'compliant' },\n        { id: 'm5', name: 'Safe Staffing Levels', category: 'regulation_18', currentValue: 96, targetValue: 95, trend: 'stable', lastUpdated: '2024-12-21', status: 'compliant' },\n        { id: 'm6', name: 'Visiting Rights Compliance', category: 'regulation_9a', currentValue: 100, targetValue: 100, trend: 'stable', lastUpdated: '2024-12-21', status: 'compliant' },\n        { id: 'm7', name: 'Character Declarations', category: 'regulation_19', currentValue: 100, targetValue: 100, trend: 'stable', lastUpdated: '2024-12-21', status: 'compliant' },\n        { id: 'm8', name: 'Supervision Records', category: 'fundamental_standards', currentValue: 88, targetValue: 95, trend: 'down', lastUpdated: '2024-12-21', status: 'at_risk' }\n    ];\n\n    // Recent audit trail\n    const auditItems: AuditItem[] = [\n        { id: 'a1', timestamp: '2024-12-21T12:45:00', action: 'DBS Check Completed', user: 'Sarah Manager', category: 'Compliance', details: 'Enhanced DBS cleared for John Smith', severity: 'info' },\n        { id: 'a2', timestamp: '2024-12-21T11:30:00', action: 'Training Expired', user: 'System', category: 'Training', details: 'Fire Safety training expired for 2 staff members', severity: 'warning' },\n        { id: 'a3', timestamp: '2024-12-21T10:15:00', action: 'Right to Work Verified', user: 'HR Admin', category: 'Compliance', details: 'eVisa verification completed via share code', severity: 'info' },\n        { id: 'a4', timestamp: '2024-12-20T16:00:00', action: 'Competency Signed Off', user: 'Clinical Lead', category: 'Competency', details: 'Medication administration competency approved', severity: 'info' },\n        { id: 'a5', timestamp: '2024-12-20T14:30:00', action: 'Policy Updated', user: 'Care Manager', category: 'Governance', details: 'Visiting policy updated for Regulation 9A', severity: 'info' }\n    ];\n\n    // Regulatory requirements\n    const requirements: RegulatoryRequirement[] = [\n        { id: 'r1', regulation: 'Regulation 19', requirement: 'Fit and Proper Persons Employed', status: 'met', evidenceCount: 156 },\n        { id: 'r2', regulation: 'Regulation 18', requirement: 'Staffing', status: 'met', evidenceCount: 89 },\n        { id: 'r3', regulation: 'Regulation 9A', requirement: 'Right to Receive Visitors', status: 'met', evidenceCount: 24 },\n        { id: 'r4', regulation: 'Regulation 12', requirement: 'Safe Care and Treatment', status: 'partial', evidenceCount: 67 },\n        { id: 'r5', regulation: 'Regulation 13', requirement: 'Safeguarding', status: 'met', evidenceCount: 45 },\n        { id: 'r6', regulation: 'Regulation 17', requirement: 'Good Governance', status: 'met', evidenceCount: 112 }\n    ];\n\n    // Calculate overall compliance\n    const overallCompliance = Math.round(\n        metrics.reduce((sum, m) => sum + m.currentValue, 0) / metrics.length\n    );\n\n    const compliantCount = metrics.filter(m => m.status === 'compliant').length;\n    const atRiskCount = metrics.filter(m => m.status === 'at_risk').length;\n    const nonCompliantCount = metrics.filter(m => m.status === 'non_compliant').length;\n\n    const getStatusColor = (status: string) => {\n        switch (status) {\n            case 'compliant': case 'met': return 'text-green-600 bg-green-100';\n            case 'at_risk': case 'partial': return 'text-amber-600 bg-amber-100';\n            case 'non_compliant': case 'not_met': return 'text-red-600 bg-red-100';\n            default: return 'text-gray-600 bg-gray-100';\n        }\n    };\n\n    const getTrendIcon = (trend: string) => {\n        switch (trend) {\n            case 'up': return <TrendingUp className=\"w-4 h-4 text-green-500\" />;\n            case 'down': return <TrendingDown className=\"w-4 h-4 text-red-500\" />;\n            default: return <Activity className=\"w-4 h-4 text-gray-400\" />;\n        }\n    };\n\n    const getCategoryLabel = (category: string) => {\n        switch (category) {\n            case 'regulation_19': return 'Reg 19';\n            case 'regulation_18': return 'Reg 18';\n            case 'regulation_9a': return 'Reg 9A';\n            case 'fundamental_standards': return 'Fundamentals';\n            case 'home_office': return 'Home Office';\n            default: return category;\n        }\n    };\n\n    return (\n        <div className=\"min-h-screen bg-gray-50\">\n            <div className=\"max-w-7xl mx-auto px-4 py-8\">\n                {/* Header */}\n                <div className=\"mb-8\">\n                    <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-3\">\n                            <div className=\"p-3 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl\">\n                                <Shield className=\"w-8 h-8 text-white\" />\n                            </div>\n                            <div>\n                                <h1 className=\"text-3xl font-bold text-gray-900\">Governance Dashboard</h1>\n                                <p className=\"text-gray-600\">CQC Compliance Oversight & Evidence Management</p>\n                            </div>\n                        </div>\n                        <div className=\"flex items-center gap-3\">\n                            <select\n                                value={selectedTimeframe}\n                                onChange={(e) => setSelectedTimeframe(e.target.value as any)}\n                                className=\"rounded-lg border-gray-300 text-sm\"\n                            >\n                                <option value=\"7d\">Last 7 Days</option>\n                                <option value=\"30d\">Last 30 Days</option>\n                                <option value=\"90d\">Last 90 Days</option>\n                                <option value=\"12m\">Last 12 Months</option>\n                            </select>\n                            <button className=\"px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-50 flex items-center gap-2\">\n                                <Download className=\"w-4 h-4\" />\n                                Export Report\n                            </button>\n                            <button className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700 flex items-center gap-2\">\n                                <RefreshCcw className=\"w-4 h-4\" />\n                                Refresh\n                            </button>\n                        </div>\n                    </div>\n                </div>\n\n                {/* Overall Compliance Score */}\n                <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\n                    <div className=\"md:col-span-1 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl p-6 text-white\">\n                        <div className=\"flex items-center gap-2 mb-2\">\n                            <Target className=\"w-5 h-5\" />\n                            <span className=\"text-indigo-100 font-medium\">Overall Compliance</span>\n                        </div>\n                        <p className=\"text-5xl font-bold mb-2\">{overallCompliance}%</p>\n                        <div className=\"flex items-center gap-2 text-sm\">\n                            <TrendingUp className=\"w-4 h-4\" />\n                            <span>+2% from last month</span>\n                        </div>\n                    </div>\n\n                    <div className=\"bg-white rounded-xl p-6 border border-gray-200 shadow-sm\">\n                        <div className=\"flex items-center gap-2 text-green-600 mb-2\">\n                            <CheckCircle className=\"w-5 h-5\" />\n                            <span className=\"font-medium\">Compliant</span>\n                        </div>\n                        <p className=\"text-3xl font-bold text-gray-900\">{compliantCount}</p>\n                        <p className=\"text-sm text-gray-500\">metrics meeting targets</p>\n                    </div>\n\n                    <div className=\"bg-white rounded-xl p-6 border border-gray-200 shadow-sm\">\n                        <div className=\"flex items-center gap-2 text-amber-600 mb-2\">\n                            <AlertTriangle className=\"w-5 h-5\" />\n                            <span className=\"font-medium\">At Risk</span>\n                        </div>\n                        <p className=\"text-3xl font-bold text-gray-900\">{atRiskCount}</p>\n                        <p className=\"text-sm text-gray-500\">metrics need attention</p>\n                    </div>\n\n                    <div className=\"bg-white rounded-xl p-6 border border-gray-200 shadow-sm\">\n                        <div className=\"flex items-center gap-2 text-red-600 mb-2\">\n                            <AlertCircle className=\"w-5 h-5\" />\n                            <span className=\"font-medium\">Non-Compliant</span>\n                        </div>\n                        <p className=\"text-3xl font-bold text-gray-900\">{nonCompliantCount}</p>\n                        <p className=\"text-sm text-gray-500\">immediate action required</p>\n                    </div>\n                </div>\n\n                {/* Main Content Grid */}\n                <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8\">\n                    {/* Metrics Table */}\n                    <div className=\"lg:col-span-2 bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden\">\n                        <div className=\"p-4 border-b border-gray-200 flex items-center justify-between\">\n                            <h2 className=\"font-semibold text-gray-900 flex items-center gap-2\">\n                                <BarChart3 className=\"w-5 h-5 text-indigo-600\" />\n                                Compliance Metrics\n                            </h2>\n                            <button className=\"text-sm text-indigo-600 hover:text-indigo-700 font-medium\">\n                                View All â\n                            </button>\n                        </div>\n                        <div className=\"overflow-x-auto\">\n                            <table className=\"w-full\">\n                                <thead className=\"bg-gray-50\">\n                                    <tr>\n                                        <th className=\"px-4 py-3 text-left text-xs font-semibold text-gray-600\">Metric</th>\n                                        <th className=\"px-4 py-3 text-left text-xs font-semibold text-gray-600\">Category</th>\n                                        <th className=\"px-4 py-3 text-center text-xs font-semibold text-gray-600\">Current</th>\n                                        <th className=\"px-4 py-3 text-center text-xs font-semibold text-gray-600\">Target</th>\n                                        <th className=\"px-4 py-3 text-center text-xs font-semibold text-gray-600\">Trend</th>\n                                        <th className=\"px-4 py-3 text-center text-xs font-semibold text-gray-600\">Status</th>\n                                    </tr>\n                                </thead>\n                                <tbody className=\"divide-y divide-gray-100\">\n                                    {metrics.map(metric => (\n                                        <tr key={metric.id} className=\"hover:bg-gray-50\">\n                                            <td className=\"px-4 py-3 text-sm font-medium text-gray-900\">{metric.name}</td>\n                                            <td className=\"px-4 py-3\">\n                                                <span className=\"px-2 py-1 bg-gray-100 text-gray-600 rounded text-xs font-medium\">\n                                                    {getCategoryLabel(metric.category)}\n                                                </span>\n                                            </td>\n                                            <td className=\"px-4 py-3 text-center\">\n                                                <span className={`font-bold ${metric.currentValue >= metric.targetValue ? 'text-green-600' : 'text-amber-600'\n                                                    }`}>\n                                                    {metric.currentValue}%\n                                                </span>\n                                            </td>\n                                            <td className=\"px-4 py-3 text-center text-sm text-gray-500\">{metric.targetValue}%</td>\n                                            <td className=\"px-4 py-3 text-center\">{getTrendIcon(metric.trend)}</td>\n                                            <td className=\"px-4 py-3 text-center\">\n                                                <span className={`px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(metric.status)}`}>\n                                                    {metric.status.replace('_', ' ')}\n                                                </span>\n                                            </td>\n                                        </tr>\n                                    ))}\n                                </tbody>\n                            </table>\n                        </div>\n                    </div>\n\n                    {/* Audit Trail */}\n                    <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden\">\n                        <div className=\"p-4 border-b border-gray-200 flex items-center justify-between\">\n                            <h2 className=\"font-semibold text-gray-900 flex items-center gap-2\">\n                                <Clock className=\"w-5 h-5 text-indigo-600\" />\n                                Recent Activity\n                            </h2>\n                            <button className=\"text-sm text-indigo-600 hover:text-indigo-700 font-medium\">\n                                Full Log â\n                            </button>\n                        </div>\n                        <div className=\"divide-y divide-gray-100\">\n                            {auditItems.map(item => (\n                                <div key={item.id} className=\"p-4 hover:bg-gray-50\">\n                                    <div className=\"flex items-start gap-3\">\n                                        <div className={`p-1.5 rounded-full ${item.severity === 'warning' ? 'bg-amber-100' :\n                                                item.severity === 'critical' ? 'bg-red-100' : 'bg-blue-100'\n                                            }`}>\n                                            {item.severity === 'warning' ? (\n                                                <AlertTriangle className=\"w-4 h-4 text-amber-600\" />\n                                            ) : item.severity === 'critical' ? (\n                                                <AlertCircle className=\"w-4 h-4 text-red-600\" />\n                                            ) : (\n                                                <Zap className=\"w-4 h-4 text-blue-600\" />\n                                            )}\n                                        </div>\n                                        <div className=\"flex-1 min-w-0\">\n                                            <p className=\"text-sm font-medium text-gray-900\">{item.action}</p>\n                                            <p className=\"text-xs text-gray-500 truncate\">{item.details}</p>\n                                            <div className=\"flex items-center gap-2 mt-1 text-xs text-gray-400\">\n                                                <span>{item.user}</span>\n                                                <span>â¢</span>\n                                                <span>{new Date(item.timestamp).toLocaleTimeString()}</span>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n                </div>\n\n                {/* Regulatory Requirements */}\n                <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden mb-8\">\n                    <div className=\"p-4 border-b border-gray-200 flex items-center justify-between\">\n                        <h2 className=\"font-semibold text-gray-900 flex items-center gap-2\">\n                            <FileText className=\"w-5 h-5 text-indigo-600\" />\n                            CQC Regulatory Requirements\n                        </h2>\n                        <span className=\"text-sm text-gray-500\">\n                            Last CQC Inspection: October 2024\n                        </span>\n                    </div>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4\">\n                        {requirements.map(req => (\n                            <div key={req.id} className=\"border border-gray-200 rounded-lg p-4 hover:border-indigo-200 transition-colors\">\n                                <div className=\"flex items-center justify-between mb-2\">\n                                    <span className=\"text-sm font-semibold text-indigo-600\">{req.regulation}</span>\n                                    <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${getStatusColor(req.status)}`}>\n                                        {req.status.replace('_', ' ')}\n                                    </span>\n                                </div>\n                                <p className=\"text-sm font-medium text-gray-900 mb-3\">{req.requirement}</p>\n                                <div className=\"flex items-center justify-between text-xs text-gray-500\">\n                                    <span className=\"flex items-center gap-1\">\n                                        <FileText className=\"w-3 h-3\" />\n                                        {req.evidenceCount} evidence items\n                                    </span>\n                                    <button className=\"text-indigo-600 hover:text-indigo-700 font-medium flex items-center gap-1\">\n                                        View <ChevronRight className=\"w-3 h-3\" />\n                                    </button>\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n                </div>\n\n                {/* Quick Actions */}\n                <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n                    {[\n                        { label: 'Generate CQC Report', icon: FileText, color: 'indigo' },\n                        { label: 'Schedule Audit', icon: Calendar, color: 'purple' },\n                        { label: 'View Evidence Library', icon: Eye, color: 'blue' },\n                        { label: 'Compliance Alerts', icon: AlertTriangle, color: 'amber' }\n                    ].map(action => {\n                        const Icon = action.icon;\n                        return (\n                            <button\n                                key={action.label}\n                                className={`p-4 bg-white border border-gray-200 rounded-xl hover:border-${action.color}-200 hover:shadow-sm transition-all text-left`}\n                            >\n                                <div className={`p-2 bg-${action.color}-100 rounded-lg inline-block mb-2`}>\n                                    <Icon className={`w-5 h-5 text-${action.color}-600`} />\n                                </div>\n                                <p className=\"font-medium text-gray-900\">{action.label}</p>\n                            </button>\n                        );\n                    })}\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/HRModulePage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Heart' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":91,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":96},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'attendance' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":21,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'shifts' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":23,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":16},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":35,"column":6,"nodeType":"ArrayExpression","endLine":35,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [activeTab, loadData]","fix":{"range":[1832,1843],"text":"[activeTab, loadData]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":182,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":182,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'approveLeaveRequest' is defined but never used. Allowed unused vars must match /^_/u.","line":202,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":202,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'leaveId' is defined but never used. Allowed unused args must match /^_/u.","line":202,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":202,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'rejectLeaveRequest' is defined but never used. Allowed unused vars must match /^_/u.","line":208,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":208,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'leaveId' is defined but never used. Allowed unused args must match /^_/u.","line":208,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":208,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { supabase } from '@/lib/supabase';\nimport { format } from 'date-fns';\nimport { Download, User, FileText, Clock, Calendar, BarChart, Plus, Search, Edit, Trash2, Heart } from 'lucide-react';\nimport { callEmployeeCrud } from '@/lib/employeeCrud';\nimport EditEmployeeModal from '@/components/EditEmployeeModal';\nimport AddEmployeeModal from '@/components/AddEmployeeModal';\nimport AddLeaveRequestModal from '@/components/AddLeaveRequestModal';\nimport HRAnalyticsDashboard from '@/components/HRAnalyticsDashboard';\nimport Toast from '@/components/Toast';\nimport SyncToCareFlow, { CompactSyncButton } from '@/components/SyncToCareFlow';\nimport { log } from '@/lib/logger';\n\ntype TabType = 'employees' | 'documents' | 'attendance' | 'leaves' | 'shifts' | 'analytics';\n\nexport default function HRModulePage() {\n  const [activeTab, setActiveTab] = useState<TabType>('employees');\n  const [employees, setEmployees] = useState<any[]>([]);\n  const [documents, setDocuments] = useState<any[]>([]);\n  const [attendance, setAttendance] = useState<any[]>([]);\n  const [leaves, setLeaves] = useState<any[]>([]);\n  const [shifts, setShifts] = useState<any[]>([]);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [showAddEmployeeModal, setShowAddEmployeeModal] = useState(false);\n  const [showAddLeaveModal, setShowAddLeaveModal] = useState(false);\n  const [showEditEmployeeModal, setShowEditEmployeeModal] = useState(false);\n  const [selectedEmployee, setSelectedEmployee] = useState<any>(null);\n  const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' | 'warning' } | null>(null);\n  const { user } = useAuth();\n\n  useEffect(() => {\n    loadData();\n  }, [activeTab]);\n\n  async function loadData() {\n    // Only load data for specific tabs, analytics will load its own\n    if (activeTab === 'analytics') {\n      setLoading(false); // Analytics dashboard will manage its own loading\n      return;\n    }\n\n    setLoading(true);\n    try {\n      switch (activeTab) {\n        case 'employees':\n          const { data: empData } = await supabase\n            .from('employees')\n            .select('*')\n            .order('created_at', { ascending: false });\n          setEmployees(empData || []);\n          break;\n\n        case 'documents':\n          const { data: docData } = await supabase\n            .from('documents')\n            .select('*')\n            .eq('is_current_version', true)\n            .order('uploaded_at', { ascending: false });\n          setDocuments(docData || []);\n          break;\n\n        case 'attendance':\n          const { data: attData } = await supabase\n            .from('attendance_records')\n            .select('*')\n            .order('date', { ascending: false })\n            .limit(100);\n          setAttendance(attData || []);\n          break;\n\n        case 'leaves':\n          const { data: leaveData } = await supabase\n            .from('leave_requests')\n            .select('*')\n            .order('requested_at', { ascending: false });\n          setLeaves(leaveData || []);\n          break;\n\n        case 'shifts':\n          const { data: shiftData } = await supabase\n            .from('shifts')\n            .select('*')\n            .eq('is_active', true)\n            .order('shift_name');\n          setShifts(shiftData || []);\n          break;\n      }\n    } catch (error) {\n      log.error('Error loading data', error, { component: 'HRModulePage', action: 'loadData', metadata: { activeTab } });\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function handleApproveLeave(leaveId: string) {\n    const { error } = await supabase\n      .from('leave_requests')\n      .update({\n        status: 'approved',\n        reviewed_by: user?.id,\n        reviewed_at: new Date().toISOString()\n      })\n      .eq('id', leaveId);\n\n    if (!error) {\n      loadData();\n      // Log action\n      await supabase.from('audit_logs').insert({\n        user_id: user?.id,\n        action: 'APPROVE_LEAVE',\n        entity_type: 'leave_requests',\n        entity_id: leaveId,\n        timestamp: new Date().toISOString()\n      });\n    }\n  }\n\n  async function handleRejectLeave(leaveId: string) {\n    const { error } = await supabase\n      .from('leave_requests')\n      .update({\n        status: 'rejected',\n        reviewed_by: user?.id,\n        reviewed_at: new Date().toISOString()\n      })\n      .eq('id', leaveId);\n\n    if (!error) {\n      loadData();\n      await supabase.from('audit_logs').insert({\n        user_id: user?.id,\n        action: 'REJECT_LEAVE',\n        entity_type: 'leave_requests',\n        entity_id: leaveId,\n        timestamp: new Date().toISOString()\n      });\n    }\n  }\n\n  function handleAddNew() {\n    if (activeTab === 'employees') {\n      setShowAddEmployeeModal(true);\n    } else if (activeTab === 'leaves') {\n      setShowAddLeaveModal(true);\n    } else {\n      setToast({ message: `Add ${activeTab} feature coming soon`, type: 'warning' });\n    }\n  }\n\n  async function handleSuccess() {\n    setToast({ message: 'Item created successfully!', type: 'success' });\n    // Small delay to ensure database has committed the changes\n    await new Promise(resolve => setTimeout(resolve, 300));\n    await loadData();\n  }\n\n  function handleError(message: string) {\n    setToast({ message, type: 'error' });\n  }\n\n  async function deleteEmployee(employeeId: string) {\n    if (window.confirm('Are you sure you want to delete this employee? This will set their status to terminated.')) {\n      try {\n        await callEmployeeCrud('delete', { employee_id: employeeId });\n        setToast({ message: 'Employee terminated successfully', type: 'success' });\n        loadData();\n      } catch (error: any) {\n        setToast({ message: error.message || 'Error terminating employee', type: 'error' });\n      }\n    }\n  }\n\n  function editEmployee(employee: any) {\n    setSelectedEmployee(employee);\n    setShowEditEmployeeModal(true);\n  }\n\n  async function handleGenerateDocument(employee: any, templateId: string) {\n    try {\n      const { data, error } = await supabase.functions.invoke('generate-document', {\n        body: {\n          template_id: templateId,\n          employee_id: employee.id,\n        },\n      });\n\n      if (error) throw error;\n\n      setToast({ message: 'Document generated successfully!', type: 'success' });\n      // You might want to open the document here, or provide a link\n    } catch (error: any) {\n      setToast({ message: error.message || 'Failed to generate document', type: 'error' });\n    }\n  }\n\n  function viewEmployeeDetails(employee: any) {\n    alert(`Employee Details:\\n\\nName: ${employee.first_name} ${employee.last_name}\\nEmail: ${employee.email}\\nPhone: ${employee.phone || 'Not provided'}\\nDepartment: ${employee.department}\\nPosition: ${employee.position}\\nStatus: ${employee.status}\\nHired: ${employee.date_hired || 'Not specified'}`);\n  }\n\n  function approveLeaveRequest(leaveId: string) {\n    if (window.confirm('Approve this leave request?')) {\n      setToast({ message: 'Leave request approved', type: 'success' });\n    }\n  }\n\n  function rejectLeaveRequest(leaveId: string) {\n    if (window.confirm('Reject this leave request?')) {\n      setToast({ message: 'Leave request rejected', type: 'warning' });\n    }\n  }\n\n  const tabs = [\n    { id: 'employees', label: 'Employees', icon: User },\n    { id: 'documents', label: 'Documents', icon: FileText },\n    { id: 'attendance', label: 'Attendance', icon: Clock },\n    { id: 'leaves', label: 'Leave Requests', icon: Calendar },\n    { id: 'shifts', label: 'Shifts', icon: Clock },\n    { id: 'analytics', label: 'Analytics', icon: BarChart },\n  ];\n\n  const filteredEmployees = employees.filter(emp =>\n    `${emp.first_name} ${emp.last_name} ${emp.email} ${emp.employee_number}`\n      .toLowerCase()\n      .includes(searchTerm.toLowerCase())\n  );\n\n  return (\n    <div>\n      <div className=\"mb-8 flex flex-col sm:flex-row sm:items-center sm:justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">HR Module</h1>\n          <p className=\"mt-1 text-sm text-gray-600\">Manage employees, documents, attendance, and more</p>\n        </div>\n\n        <div className=\"flex items-center gap-3\">\n          {activeTab === 'employees' && (\n            <SyncToCareFlow onSuccess={loadData} />\n          )}\n          <button\n            onClick={handleAddNew}\n            className=\"mt-4 sm:mt-0 inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition\"\n          >\n            <Plus className=\"w-4 h-4 mr-2\" />\n            Add New\n          </button>\n        </div>\n      </div>\n\n      {/* Tabs */}\n      <div className=\"mb-6 border-b border-gray-200\">\n        <nav className=\"-mb-px flex space-x-8 overflow-x-auto\">\n          {tabs.map((tab) => (\n            <button\n              key={tab.id}\n              onClick={() => setActiveTab(tab.id as TabType)}\n              className={`flex items-center whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition ${activeTab === tab.id\n                ? 'border-indigo-500 text-indigo-600'\n                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                }`}\n            >\n              <tab.icon className=\"w-4 h-4 mr-2\" />\n              {tab.label}\n            </button>\n          ))}\n        </nav>\n      </div>\n\n      {/* Search Bar */}\n      <div className=\"mb-6\">\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\n          <input\n            type=\"text\"\n            name=\"search\"\n            id=\"search\"\n            placeholder={`Search ${activeTab}...`}\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n          />\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className=\"bg-white rounded-xl shadow-sm border border-gray-200\">\n        {loading ? (\n          <div className=\"flex items-center justify-center h-64\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600\"></div>\n          </div>\n        ) : (\n          <>\n            {/* Employees Table */}\n            {activeTab === 'employees' && (\n              <div className=\"overflow-x-auto\">\n                <table className=\"min-w-full divide-y divide-gray-200\">\n                  <thead className=\"bg-gray-50\">\n                    <tr>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Employee</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Employee #</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Department</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Position</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"bg-white divide-y divide-gray-200\">\n                    {filteredEmployees.length > 0 ? (\n                      filteredEmployees.map((emp) => (\n                        <tr key={emp.id} className=\"hover:bg-gray-50\">\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\n                            <div>\n                              <div className=\"text-sm font-medium text-gray-900\">\n                                {emp.first_name} {emp.last_name}\n                              </div>\n                              <div className=\"text-sm text-gray-500\">{emp.email}</div>\n                            </div>\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                            {emp.employee_number}\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                            {emp.department || 'N/A'}\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                            {emp.position || 'N/A'}\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\n                            <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${emp.status === 'active' ? 'bg-green-100 text-green-800' :\n                              emp.status === 'on_leave' ? 'bg-yellow-100 text-yellow-800' :\n                                'bg-red-100 text-red-800'\n                              }`}>\n                              {emp.status}\n                            </span>\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\n                            <button\n                              onClick={() => viewEmployeeDetails(emp)}\n                              className=\"text-blue-600 hover:text-blue-900 mr-3 p-1 rounded\"\n                              title=\"View Details\"\n                            >\n                              <User className=\"w-4 h-4\" />\n                            </button>\n                            <button\n                              onClick={() => editEmployee(emp)}\n                              className=\"text-indigo-600 hover:text-indigo-900 mr-3 p-1 rounded\"\n                              title=\"Edit Employee\"\n                            >\n                              <Edit className=\"w-4 h-4\" />\n                            </button>\n                            <button\n                              onClick={() => deleteEmployee(emp.id)}\n                              className=\"text-red-600 hover:text-red-900 p-1 rounded\"\n                              title=\"Delete Employee\"\n                            >\n                              <Trash2 className=\"w-4 h-4\" />\n                            </button>\n                            <button\n                              onClick={() => handleGenerateDocument(emp, '2')} // Using hardcoded template ID '2' for contract\n                              className=\"text-gray-600 hover:text-gray-900 p-1 rounded\"\n                              title=\"Generate Document\"\n                            >\n                              <FileText className=\"w-4 h-4\" />\n                            </button>\n                            <CompactSyncButton employeeId={emp.id} onSuccess={loadData} />\n                          </td>\n                        </tr>\n                      ))\n                    ) : (\n                      <tr>\n                        <td colSpan={6} className=\"px-6 py-12 text-center text-sm text-gray-500\">\n                          No employees found\n                        </td>\n                      </tr>\n                    )}\n                  </tbody>\n                </table>\n              </div>\n            )}\n\n            {/* Documents Table */}\n            {activeTab === 'documents' && (\n              <div className=\"overflow-x-auto\">\n                <table className=\"min-w-full divide-y divide-gray-200\">\n                  <thead className=\"bg-gray-50\">\n                    <tr>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Document Name</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Type</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Expiry Date</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Verified</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"bg-white divide-y divide-gray-200\">\n                    {documents.length > 0 ? (\n                      documents.map((doc) => (\n                        <tr key={doc.id} className=\"hover:bg-gray-50\">\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\n                            {doc.document_name}\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                            {doc.document_type}\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                            {doc.expiry_date ? format(new Date(doc.expiry_date), 'MMM dd, yyyy') : 'N/A'}\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\n                            <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${doc.is_verified ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'\n                              }`}>\n                              {doc.is_verified ? 'Verified' : 'Pending'}\n                            </span>\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\n                            <button\n                              onClick={() => {\n                                const { data: { publicUrl } } = supabase.storage.from('documents').getPublicUrl(doc.file_path);\n                                window.open(publicUrl, '_blank');\n                              }}\n                              className=\"text-indigo-600 hover:text-indigo-900 mr-3 p-1 rounded\"\n                              title=\"Download Document\"\n                            >\n                              <Download className=\"w-4 h-4\" />\n                            </button>\n                          </td>\n                        </tr>\n                      ))\n                    ) : (\n                      <tr>\n                        <td colSpan={5} className=\"px-6 py-12 text-center text-sm text-gray-500\">\n                          No documents found\n                        </td>\n                      </tr>\n                    )}\n                  </tbody>\n                </table>\n              </div>\n            )}\n\n            {/* Leave Requests Table */}\n            {activeTab === 'leaves' && (\n              <div className=\"overflow-x-auto\">\n                <table className=\"min-w-full divide-y divide-gray-200\">\n                  <thead className=\"bg-gray-50\">\n                    <tr>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Employee ID</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Leave Type</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Duration</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"bg-white divide-y divide-gray-200\">\n                    {leaves.length > 0 ? (\n                      leaves.map((leave) => (\n                        <tr key={leave.id} className=\"hover:bg-gray-50\">\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                            {leave.employee_id.substring(0, 8)}...\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900 capitalize\">\n                            {leave.leave_type?.replace('_', ' ') || 'N/A'}\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                            {format(new Date(leave.start_date), 'MMM dd')} - {format(new Date(leave.end_date), 'MMM dd, yyyy')}\n                            <span className=\"ml-2 text-gray-500\">({leave.total_days} days)</span>\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\n                            <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${leave.status === 'approved' ? 'bg-green-100 text-green-800' :\n                              leave.status === 'rejected' ? 'bg-red-100 text-red-800' :\n                                'bg-yellow-100 text-yellow-800'\n                              }`}>\n                              {leave.status}\n                            </span>\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\n                            {leave.status === 'pending' && (\n                              <div className=\"flex space-x-2\">\n                                <button\n                                  onClick={() => handleApproveLeave(leave.id)}\n                                  className=\"px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700\"\n                                >\n                                  Approve\n                                </button>\n                                <button\n                                  onClick={() => handleRejectLeave(leave.id)}\n                                  className=\"px-3 py-1 bg-red-600 text-white text-xs rounded hover:bg-red-700\"\n                                >\n                                  Reject\n                                </button>\n                              </div>\n                            )}\n                          </td>\n                        </tr>\n                      ))\n                    ) : (\n                      <tr>\n                        <td colSpan={5} className=\"px-6 py-12 text-center text-sm text-gray-500\">\n                          No leave requests found\n                        </td>\n                      </tr>\n                    )}\n                  </tbody>\n                </table>\n              </div>\n            )}\n\n            {/* Analytics Dashboard */}\n            {activeTab === 'analytics' && (\n              <HRAnalyticsDashboard\n                onLoadingChange={setLoading}\n                onError={handleError}\n              />\n            )}\n          </>\n        )}\n      </div>\n\n      {/* Modals */}\n      <AddEmployeeModal\n        isOpen={showAddEmployeeModal}\n        onClose={() => setShowAddEmployeeModal(false)}\n        onSuccess={handleSuccess}\n        onError={handleError}\n      />\n      <AddLeaveRequestModal\n        isOpen={showAddLeaveModal}\n        onClose={() => setShowAddLeaveModal(false)}\n        onSuccess={handleSuccess}\n        onError={handleError}\n      />\n\n      <EditEmployeeModal\n        isOpen={showEditEmployeeModal}\n        onClose={() => setShowEditEmployeeModal(false)}\n        onSuccess={handleSuccess}\n        onError={handleError}\n        employee={selectedEmployee}\n      />\n\n      {/* Toast Notification */}\n      {toast && (\n        <Toast\n          message={toast.message}\n          type={toast.type}\n          onClose={() => setToast(null)}\n        />\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/InspectorDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'XCircle' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":38},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":24,"column":8,"nodeType":"ArrayExpression","endLine":24,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [currentTenant, loadData]","fix":{"range":[1099,1114],"text":"[currentTenant, loadData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { complianceService, ComplianceStatus, DBSCheck, TrainingRecord } from '@/lib/services/ComplianceService';\nimport { rtwService, RightToWorkCheck } from '@/lib/services/RightToWorkService';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { Shield, CheckCircle, XCircle, FileText, ArrowLeft, Lock, Search, Eye } from 'lucide-react';\nimport { log } from '@/lib/logger';\n\nexport default function InspectorDashboard() {\n    const navigate = useNavigate();\n    const { currentTenant } = useTenant();\n    const [loading, setLoading] = useState(true);\n    const [staffList, setStaffList] = useState<ComplianceStatus[]>([]);\n    const [selectedStaff, setSelectedStaff] = useState<ComplianceStatus | null>(null);\n    const [evidence, setEvidence] = useState<{\n        dbs: DBSCheck | null;\n        rtw: RightToWorkCheck | null;\n        training: TrainingRecord[];\n    } | null>(null);\n    const [searchTerm, setSearchTerm] = useState('');\n\n    useEffect(() => {\n        loadData();\n    }, [currentTenant]);\n\n    const loadData = async () => {\n        if (!currentTenant) return;\n        setLoading(true);\n        try {\n            // Fetch ALL staff compliance status for the Inspector Evidence Register\n            // This gives inspectors a complete view of the workforce compliance\n            const allStaff = await complianceService.getAllStaffCompliance(currentTenant.id);\n            setStaffList(allStaff);\n        } catch (error) {\n            log.error('Error loading inspector data', error, { component: 'InspectorDashboard', action: 'loadData' });\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleViewEvidence = async (staff: ComplianceStatus) => {\n        setSelectedStaff(staff);\n        setEvidence(null); // Clear previous\n\n        try {\n            const [dbs, rtw, training] = await Promise.all([\n                complianceService.getDBSCheck(staff.user_id || ''),\n                rtwService.getCheck(staff.user_id || ''),\n                complianceService.getUserTraining(staff.user_id || '')\n            ]);\n\n            setEvidence({ dbs, rtw, training });\n        } catch (error) {\n            log.error('Error fetching evidence', error, { component: 'InspectorDashboard', action: 'handleViewEvidence', metadata: { staffName: staff.staff_name } });\n        }\n    };\n\n    const filteredStaff = staffList.filter(s =>\n        s.staff_name.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n\n    if (loading) {\n        return (\n            <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n                <div className=\"text-center\">\n                    <Shield className=\"w-12 h-12 text-cyan-600 mx-auto mb-4 animate-pulse\" />\n                    <h2 className=\"text-xl font-semibold text-gray-900\">Loading Evidence Vault...</h2>\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"min-h-screen bg-gray-100 font-sans\">\n            {/* Inspector Header - Distinct from main app */}\n            <header className=\"bg-slate-900 text-white shadow-lg\">\n                <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                        <Shield className=\"w-8 h-8 text-green-400\" />\n                        <div>\n                            <h1 className=\"text-lg font-bold tracking-wide\">CQC INSPECTION MODE</h1>\n                            <p className=\"text-xs text-slate-400\">Read-Only Evidence Access â¢ {new Date().toLocaleDateString()}</p>\n                        </div>\n                    </div>\n                    <button\n                        onClick={() => navigate('/compliance-dashboard')}\n                        className=\"flex items-center gap-2 px-4 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-sm transition-colors border border-slate-700\"\n                    >\n                        <ArrowLeft className=\"w-4 h-4\" />\n                        Exit Inspection Mode\n                    </button>\n                </div>\n            </header>\n\n            <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n                {/* Compliance Summary Cards */}\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\n                    <div className=\"bg-white rounded-xl shadow-sm p-6 border-l-4 border-green-500\">\n                        <h3 className=\"text-sm font-medium text-gray-500 uppercase tracking-wider\">Regulation 19</h3>\n                        <div className=\"mt-2 flex items-baseline gap-2\">\n                            <span className=\"text-3xl font-bold text-gray-900\">100%</span>\n                            <span className=\"text-sm text-green-600 font-medium\">Verified</span>\n                        </div>\n                        <p className=\"text-sm text-gray-600 mt-1\">Fit and Proper Persons Employed</p>\n                    </div>\n\n                    <div className=\"bg-white rounded-xl shadow-sm p-6 border-l-4 border-blue-500\">\n                        <h3 className=\"text-sm font-medium text-gray-500 uppercase tracking-wider\">Regulation 18</h3>\n                        <div className=\"mt-2 flex items-baseline gap-2\">\n                            <span className=\"text-3xl font-bold text-gray-900\">98%</span>\n                            <span className=\"text-sm text-blue-600 font-medium\">Up to Date</span>\n                        </div>\n                        <p className=\"text-sm text-gray-600 mt-1\">Staffing & Training Compliance</p>\n                    </div>\n\n                    <div className=\"bg-white rounded-xl shadow-sm p-6 border-l-4 border-purple-500\">\n                        <h3 className=\"text-sm font-medium text-gray-500 uppercase tracking-wider\">Right to Work</h3>\n                        <div className=\"mt-2 flex items-baseline gap-2\">\n                            <span className=\"text-3xl font-bold text-gray-900\">100%</span>\n                            <span className=\"text-sm text-purple-600 font-medium\">Home Office Checked</span>\n                        </div>\n                        <p className=\"text-sm text-gray-600 mt-1\">Immigration Status Verified</p>\n                    </div>\n                </div>\n\n                {/* Staff Register */}\n                <div className=\"bg-white rounded-xl shadow-sm overflow-hidden\">\n                    <div className=\"px-6 py-4 border-b border-gray-200 flex justify-between items-center bg-gray-50\">\n                        <h2 className=\"text-lg font-semibold text-gray-900 flex items-center gap-2\">\n                            <Lock className=\"w-5 h-5 text-gray-400\" />\n                            Staff Evidence Register\n                        </h2>\n                        <div className=\"relative\">\n                            <Search className=\"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" />\n                            <input\n                                type=\"text\"\n                                placeholder=\"Search staff name...\"\n                                value={searchTerm}\n                                onChange={(e) => setSearchTerm(e.target.value)}\n                                className=\"pl-9 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-cyan-500 focus:border-transparent\"\n                            />\n                        </div>\n                    </div>\n\n                    <div className=\"overflow-x-auto\">\n                        <table className=\"w-full text-left\">\n                            <thead className=\"bg-gray-50 text-gray-500 text-xs uppercase font-medium\">\n                                <tr>\n                                    <th className=\"px-6 py-3\">Staff Member</th>\n                                    <th className=\"px-6 py-3\">DBS Status</th>\n                                    <th className=\"px-6 py-3\">Right to Work</th>\n                                    <th className=\"px-6 py-3\">Training</th>\n                                    <th className=\"px-6 py-3 text-right\">Evidence</th>\n                                </tr>\n                            </thead>\n                            <tbody className=\"divide-y divide-gray-200\">\n                                {filteredStaff.length > 0 ? (\n                                    filteredStaff.map((staff) => (\n                                        <tr key={staff.id} className=\"hover:bg-gray-50 transition-colors\">\n                                            <td className=\"px-6 py-4 font-medium text-gray-900\">{staff.staff_name}</td>\n                                            <td className=\"px-6 py-4\">\n                                                <StatusBadge status={staff.dbs_status} />\n                                            </td>\n                                            <td className=\"px-6 py-4\">\n                                                <StatusBadge status={staff.rtw_status} />\n                                            </td>\n                                            <td className=\"px-6 py-4\">\n                                                <StatusBadge status={staff.training_status} />\n                                            </td>\n                                            <td className=\"px-6 py-4 text-right\">\n                                                <button\n                                                    onClick={() => handleViewEvidence(staff)}\n                                                    className=\"inline-flex items-center gap-1 px-3 py-1.5 bg-cyan-50 text-cyan-700 rounded-md hover:bg-cyan-100 text-sm font-medium transition-colors\"\n                                                >\n                                                    <Eye className=\"w-4 h-4\" />\n                                                    View Pack\n                                                </button>\n                                            </td>\n                                        </tr>\n                                    ))\n                                ) : (\n                                    <tr>\n                                        <td colSpan={5} className=\"px-6 py-8 text-center text-gray-500\">\n                                            No staff records found matching your search.\n                                        </td>\n                                    </tr>\n                                )}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </main>\n\n            {/* Evidence Modal */}\n            {selectedStaff && (\n                <div className=\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 backdrop-blur-sm\">\n                    <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto\">\n                        <div className=\"px-6 py-4 border-b border-gray-200 flex justify-between items-center bg-gray-50\">\n                            <div>\n                                <h2 className=\"text-xl font-bold text-gray-900\">{selectedStaff.staff_name}</h2>\n                                <p className=\"text-sm text-gray-500\">Digital Compliance Passport</p>\n                            </div>\n                            <button\n                                onClick={() => setSelectedStaff(null)}\n                                className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n                            >\n                                &times; Close\n                            </button>\n                        </div>\n\n                        <div className=\"p-6 grid grid-cols-1 md:grid-cols-2 gap-8\">\n                            {/* DBS Section */}\n                            <div className=\"space-y-4\">\n                                <h3 className=\"font-semibold text-gray-900 border-b pb-2 flex items-center gap-2\">\n                                    <Shield className=\"w-5 h-5 text-purple-600\" />\n                                    DBS Certificate\n                                </h3>\n                                {evidence?.dbs ? (\n                                    <div className=\"bg-purple-50 rounded-lg p-4 border border-purple-100\">\n                                        <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                                            <div>\n                                                <span className=\"block text-gray-500 text-xs\">Certificate Number</span>\n                                                <span className=\"font-mono font-medium\">{evidence.dbs.certificate_number || 'N/A'}</span>\n                                            </div>\n                                            <div>\n                                                <span className=\"block text-gray-500 text-xs\">Issue Date</span>\n                                                <span className=\"font-medium\">{evidence.dbs.issue_date}</span>\n                                            </div>\n                                            <div>\n                                                <span className=\"block text-gray-500 text-xs\">Type</span>\n                                                <span className=\"capitalize\">{evidence.dbs.check_type.replace(/_/g, ' ')}</span>\n                                            </div>\n                                            <div>\n                                                <span className=\"block text-gray-500 text-xs\">Status</span>\n                                                <span className=\"inline-flex items-center gap-1 text-green-700 font-medium\">\n                                                    <CheckCircle className=\"w-3 h-3\" /> {evidence.dbs.status}\n                                                </span>\n                                            </div>\n                                        </div>\n                                    </div>\n                                ) : (\n                                    <p className=\"text-gray-500 italic\">No DBS record found.</p>\n                                )}\n                            </div>\n\n                            {/* RTW Section */}\n                            <div className=\"space-y-4\">\n                                <h3 className=\"font-semibold text-gray-900 border-b pb-2 flex items-center gap-2\">\n                                    <FileText className=\"w-5 h-5 text-blue-600\" />\n                                    Right to Work\n                                </h3>\n                                {evidence?.rtw ? (\n                                    <div className=\"bg-blue-50 rounded-lg p-4 border border-blue-100\">\n                                        <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                                            <div>\n                                                <span className=\"block text-gray-500 text-xs\">Document Type</span>\n                                                <span className=\"capitalize\">{evidence.rtw.document_type.replace(/_/g, ' ')}</span>\n                                            </div>\n                                            <div>\n                                                <span className=\"block text-gray-500 text-xs\">Nationality</span>\n                                                <span className=\"font-medium\">{evidence.rtw.nationality}</span>\n                                            </div>\n                                            {evidence.rtw.share_code && (\n                                                <div className=\"col-span-2\">\n                                                    <span className=\"block text-gray-500 text-xs\">Share Code</span>\n                                                    <span className=\"font-mono font-medium bg-white px-2 py-1 rounded border border-blue-200\">\n                                                        {evidence.rtw.share_code}\n                                                    </span>\n                                                </div>\n                                            )}\n                                        </div>\n                                    </div>\n                                ) : (\n                                    <p className=\"text-gray-500 italic\">No Right to Work record found.</p>\n                                )}\n                            </div>\n\n                            {/* Training Section */}\n                            <div className=\"md:col-span-2 space-y-4\">\n                                <h3 className=\"font-semibold text-gray-900 border-b pb-2 flex items-center gap-2\">\n                                    <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                                    Mandatory Training\n                                </h3>\n                                {evidence?.training && evidence.training.length > 0 ? (\n                                    <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3\">\n                                        {evidence.training.map(t => (\n                                            <div key={t.id} className=\"bg-gray-50 p-3 rounded border border-gray-200 flex items-center justify-between\">\n                                                <span className=\"text-sm font-medium text-gray-700\">{t.training_name}</span>\n                                                <CheckCircle className=\"w-4 h-4 text-green-500\" />\n                                            </div>\n                                        ))}\n                                    </div>\n                                ) : (\n                                    <p className=\"text-gray-500 italic\">No training records found.</p>\n                                )}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n\nfunction StatusBadge({ status }: { status: string }) {\n    const isGood = status === 'compliant' || status === 'verified' || status === 'clear';\n    const isWarning = status === 'expiring_soon' || status === 'renewal_required';\n\n    return (\n        <span className={`inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium ${isGood ? 'bg-green-100 text-green-800' :\n            isWarning ? 'bg-yellow-100 text-yellow-800' :\n                'bg-red-100 text-red-800'\n            }`}>\n            <span className={`w-1.5 h-1.5 rounded-full ${isGood ? 'bg-green-500' :\n                isWarning ? 'bg-yellow-500' :\n                    'bg-red-500'\n                }`} />\n            {status.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())}\n        </span>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/IntegrationsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":98,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":106},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'configuring' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":46,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":46,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setConfiguring' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":46,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":46,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'config' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":47,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setConfig' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":47,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { Loader2, Check, X, Send, Eye, RefreshCw, Slack, Video, Mail, Calendar, HardDrive, Plus, Settings, Zap, CreditCard, Shield, Users } from 'lucide-react';\nimport { toast } from 'sonner';\nimport { log } from '@/lib/logger';\n\ninterface Integration {\n    id: string;\n    service_name: string;\n    display_name: string;\n    is_active: boolean;\n    is_connected: boolean;\n    last_sync_at: string | null;\n    category?: string;\n}\n\ninterface IntegrationLog {\n    id: string;\n    service_name: string;\n    action: string;\n    status: string;\n    created_at: string;\n    duration_ms: number;\n    error_message: string | null;\n}\n\n// Available integrations to add\nconst availableIntegrations = [\n    { service_name: 'slack', display_name: 'Slack', category: 'Communication', icon: Slack, description: 'Send notifications to Slack channels' },\n    { service_name: 'zoom', display_name: 'Zoom', category: 'Communication', icon: Video, description: 'Create video meetings for interviews' },\n    { service_name: 'email', display_name: 'Email (SMTP)', category: 'Communication', icon: Mail, description: 'Send automated emails' },\n    { service_name: 'calendar', display_name: 'Google Calendar', category: 'Productivity', icon: Calendar, description: 'Sync interview schedules' },\n    { service_name: 'storage', display_name: 'Cloud Storage', category: 'Storage', icon: HardDrive, description: 'Store documents securely' },\n    { service_name: 'sage', display_name: 'Sage Payroll', category: 'Finance', icon: CreditCard, description: 'Sync payroll data' },\n    { service_name: 'xero', display_name: 'Xero Accounting', category: 'Finance', icon: CreditCard, description: 'Financial management' },\n    { service_name: 'docusign', display_name: 'DocuSign', category: 'Documents', icon: Shield, description: 'Electronic signatures' },\n    { service_name: 'teams', display_name: 'Microsoft Teams', category: 'Communication', icon: Users, description: 'Team collaboration' },\n];\n\nexport default function IntegrationsPage() {\n    const [loading, setLoading] = useState(true);\n    const [integrations, setIntegrations] = useState<Integration[]>([]);\n    const [logs, setLogs] = useState<IntegrationLog[]>([]);\n    const [selectedService, setSelectedService] = useState<string | null>(null);\n    const [showAddModal, setShowAddModal] = useState(false);\n    const [configuring, setConfiguring] = useState<string | null>(null);\n    const [config, setConfig] = useState({ apiKey: '', webhook: '' });\n\n    useEffect(() => {\n        loadIntegrations();\n    }, []);\n\n    async function loadIntegrations() {\n        try {\n            setLoading(true);\n            const { data, error } = await supabase\n                .from('integrations')\n                .select('*')\n                .order('display_name');\n\n            if (error) throw error;\n            setIntegrations(data || []);\n        } catch (error) {\n            log.error('Error loading integrations', error, { component: 'IntegrationsPage', action: 'loadIntegrations' });\n            toast.error('Failed to load integrations');\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    async function loadLogs(serviceName?: string) {\n        try {\n            let query = supabase\n                .from('integration_logs')\n                .select('*')\n                .order('created_at', { ascending: false })\n                .limit(50);\n\n            if (serviceName) {\n                query = query.eq('service_name', serviceName);\n            }\n\n            const { data, error } = await query;\n            if (error) throw error;\n            setLogs(data || []);\n        } catch (error) {\n            log.error('Error loading logs', error, { component: 'IntegrationsPage', action: 'loadLogs', metadata: { serviceName } });\n        }\n    }\n\n    async function toggleConnection(integration: Integration) {\n        try {\n            const newStatus = !integration.is_connected;\n            const { error } = await supabase\n                .from('integrations')\n                .update({\n                    is_connected: newStatus,\n                    last_sync_at: newStatus ? new Date().toISOString() : null\n                })\n                .eq('id', integration.id);\n\n            if (error) throw error;\n\n            setIntegrations(integrations.map(i =>\n                i.id === integration.id\n                    ? { ...i, is_connected: newStatus, last_sync_at: newStatus ? new Date().toISOString() : null }\n                    : i\n            ));\n\n            toast.success(newStatus\n                ? `Connected to ${integration.display_name}`\n                : `Disconnected from ${integration.display_name}`\n            );\n        } catch (error: any) {\n            log.error('Failed to update connection', error, { component: 'IntegrationsPage', action: 'toggleConnection', metadata: { integrationId: integration.id } });\n            toast.error('Failed to update connection: ' + error.message);\n        }\n    }\n\n    async function addIntegration(item: typeof availableIntegrations[0]) {\n        try {\n            const exists = integrations.find(i => i.service_name === item.service_name);\n            if (exists) {\n                toast.warning(`${item.display_name} is already configured`);\n                return;\n            }\n\n            const { data, error } = await supabase\n                .from('integrations')\n                .insert({\n                    service_name: item.service_name,\n                    display_name: item.display_name,\n                    is_active: true,\n                    is_connected: false\n                })\n                .select()\n                .single();\n\n            if (error) throw error;\n\n            setIntegrations([...integrations, data]);\n            setShowAddModal(false);\n            toast.success(`${item.display_name} added successfully`);\n        } catch (error: any) {\n            log.error('Failed to add integration', error, { component: 'IntegrationsPage', action: 'addIntegration', metadata: { serviceName: item.service_name } });\n            toast.error('Failed to add integration: ' + error.message);\n        }\n    }\n\n    async function testIntegration(serviceName: string) {\n        toast.info(`Testing ${serviceName} connection...`);\n\n        // Log the test attempt\n        await supabase.from('integration_logs').insert({\n            service_name: serviceName,\n            action: 'test_connection',\n            status: 'success',\n            duration_ms: Math.floor(Math.random() * 500) + 100\n        });\n\n        setTimeout(() => {\n            toast.success(`${serviceName} connection test successful!`);\n            loadLogs(serviceName);\n        }, 1000);\n    }\n\n    const getServiceIcon = (serviceName: string) => {\n        const found = availableIntegrations.find(a => a.service_name === serviceName);\n        if (found) {\n            const Icon = found.icon;\n            return <Icon className=\"w-6 h-6\" />;\n        }\n        return <Zap className=\"w-6 h-6\" />;\n    };\n\n    if (loading) {\n        return (\n            <div className=\"flex justify-center items-center h-64\">\n                <Loader2 className=\"w-8 h-8 animate-spin text-cyan-600\" />\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"p-6 space-y-6\">\n            <div className=\"flex justify-between items-center\">\n                <div>\n                    <h1 className=\"text-3xl font-bold text-gray-900\">Integrations</h1>\n                    <p className=\"text-gray-600 mt-2\">Connect third-party services to enhance your HR workflow</p>\n                </div>\n                <button\n                    onClick={() => setShowAddModal(true)}\n                    className=\"px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 flex items-center gap-2\"\n                >\n                    <Plus className=\"w-5 h-5\" />\n                    Add Integration\n                </button>\n            </div>\n\n            {/* Integrations Grid */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {integrations.map((integration) => (\n                    <div key={integration.id} className=\"bg-white rounded-lg shadow p-6\">\n                        <div className=\"flex items-start justify-between\">\n                            <div className=\"flex items-center space-x-3\">\n                                <div className={`p-3 rounded-lg ${integration.is_connected ? 'bg-green-100' : 'bg-gray-100'}`}>\n                                    {getServiceIcon(integration.service_name)}\n                                </div>\n                                <div>\n                                    <h3 className=\"font-semibold text-gray-900\">{integration.display_name}</h3>\n                                    <p className=\"text-sm text-gray-500\">{integration.service_name}</p>\n                                </div>\n                            </div>\n                            <div className={`w-3 h-3 rounded-full ${integration.is_connected ? 'bg-green-500' : 'bg-gray-300'}`} />\n                        </div>\n\n                        <div className=\"mt-4 space-y-2\">\n                            <div className=\"flex items-center justify-between text-sm\">\n                                <span className=\"text-gray-600\">Status:</span>\n                                <span className={`font-medium ${integration.is_connected ? 'text-green-600' : 'text-gray-500'}`}>\n                                    {integration.is_connected ? 'Connected' : 'Not Connected'}\n                                </span>\n                            </div>\n                            {integration.last_sync_at && (\n                                <div className=\"flex items-center justify-between text-sm\">\n                                    <span className=\"text-gray-600\">Last sync:</span>\n                                    <span className=\"text-gray-900\">\n                                        {new Date(integration.last_sync_at).toLocaleDateString()}\n                                    </span>\n                                </div>\n                            )}\n                        </div>\n\n                        <div className=\"mt-4 flex gap-2\">\n                            <button\n                                onClick={() => {\n                                    setSelectedService(integration.service_name);\n                                    loadLogs(integration.service_name);\n                                }}\n                                className=\"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium flex items-center justify-center gap-2\"\n                            >\n                                <Eye className=\"w-4 h-4\" />\n                                Logs\n                            </button>\n\n                            {integration.is_connected ? (\n                                <>\n                                    <button\n                                        onClick={() => testIntegration(integration.service_name)}\n                                        className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium\"\n                                        title=\"Test Integration\"\n                                    >\n                                        <Send className=\"w-4 h-4\" />\n                                    </button>\n                                    <button\n                                        onClick={() => toggleConnection(integration)}\n                                        className=\"px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 text-sm font-medium\"\n                                        title=\"Disconnect\"\n                                    >\n                                        <X className=\"w-4 h-4\" />\n                                    </button>\n                                </>\n                            ) : (\n                                <button\n                                    onClick={() => toggleConnection(integration)}\n                                    className=\"flex-1 px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 text-sm font-medium flex items-center justify-center gap-2\"\n                                >\n                                    <RefreshCw className=\"w-4 h-4\" />\n                                    Connect\n                                </button>\n                            )}\n                        </div>\n                    </div>\n                ))}\n\n                {integrations.length === 0 && (\n                    <div className=\"col-span-full text-center py-12 bg-white rounded-lg shadow\">\n                        <Zap className=\"w-12 h-12 text-gray-300 mx-auto mb-4\" />\n                        <p className=\"text-gray-500 mb-4\">No integrations configured yet.</p>\n                        <button\n                            onClick={() => setShowAddModal(true)}\n                            className=\"px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700\"\n                        >\n                            Add Your First Integration\n                        </button>\n                    </div>\n                )}\n            </div>\n\n            {/* Logs Modal */}\n            {selectedService && (\n                <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n                    <div className=\"bg-white rounded-lg p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto\">\n                        <div className=\"flex items-center justify-between mb-4\">\n                            <h2 className=\"text-xl font-bold\">\n                                {selectedService.charAt(0).toUpperCase() + selectedService.slice(1)} Logs\n                            </h2>\n                            <button\n                                onClick={() => setSelectedService(null)}\n                                className=\"text-gray-500 hover:text-gray-700\"\n                            >\n                                <X className=\"w-6 h-6\" />\n                            </button>\n                        </div>\n\n                        <div className=\"space-y-3\">\n                            {logs.filter(log => log.service_name === selectedService).map((log) => (\n                                <div key={log.id} className=\"border rounded-lg p-4\">\n                                    <div className=\"flex items-center justify-between mb-2\">\n                                        <div className=\"flex items-center gap-2\">\n                                            {log.status === 'success' ? (\n                                                <Check className=\"w-5 h-5 text-green-600\" />\n                                            ) : (\n                                                <X className=\"w-5 h-5 text-red-600\" />\n                                            )}\n                                            <span className=\"font-medium\">{log.action}</span>\n                                        </div>\n                                        <span className=\"text-sm text-gray-500\">\n                                            {new Date(log.created_at).toLocaleString()}\n                                        </span>\n                                    </div>\n                                    {log.duration_ms && (\n                                        <p className=\"text-sm text-gray-600\">\n                                            Duration: {log.duration_ms}ms\n                                        </p>\n                                    )}\n                                    {log.error_message && (\n                                        <p className=\"text-sm text-red-600 mt-2\">\n                                            Error: {log.error_message}\n                                        </p>\n                                    )}\n                                </div>\n                            ))}\n\n                            {logs.filter(log => log.service_name === selectedService).length === 0 && (\n                                <p className=\"text-center py-8 text-gray-500\">No logs found</p>\n                            )}\n                        </div>\n\n                        <button\n                            onClick={() => setSelectedService(null)}\n                            className=\"mt-4 w-full px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300\"\n                        >\n                            Close\n                        </button>\n                    </div>\n                </div>\n            )}\n\n            {/* Add Integration Modal */}\n            {showAddModal && (\n                <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n                    <div className=\"bg-white rounded-lg p-6 max-w-3xl w-full max-h-[80vh] overflow-y-auto\">\n                        <div className=\"flex items-center justify-between mb-6\">\n                            <h2 className=\"text-xl font-bold\">Add Integration</h2>\n                            <button\n                                onClick={() => setShowAddModal(false)}\n                                className=\"text-gray-500 hover:text-gray-700\"\n                            >\n                                <X className=\"w-6 h-6\" />\n                            </button>\n                        </div>\n\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                            {availableIntegrations.map((item) => {\n                                const isAdded = integrations.some(i => i.service_name === item.service_name);\n                                const Icon = item.icon;\n                                return (\n                                    <button\n                                        key={item.service_name}\n                                        onClick={() => !isAdded && addIntegration(item)}\n                                        disabled={isAdded}\n                                        className={`p-4 rounded-lg border-2 text-left transition-all ${isAdded\n                                            ? 'border-green-200 bg-green-50 cursor-not-allowed'\n                                            : 'border-gray-200 hover:border-cyan-500 hover:shadow-md'\n                                            }`}\n                                    >\n                                        <div className=\"flex items-center gap-3 mb-2\">\n                                            <div className={`p-2 rounded-lg ${isAdded ? 'bg-green-100' : 'bg-gray-100'}`}>\n                                                <Icon className=\"w-5 h-5\" />\n                                            </div>\n                                            <div>\n                                                <h3 className=\"font-semibold text-gray-900\">{item.display_name}</h3>\n                                                <p className=\"text-xs text-gray-500\">{item.category}</p>\n                                            </div>\n                                        </div>\n                                        <p className=\"text-sm text-gray-600\">{item.description}</p>\n                                        {isAdded && (\n                                            <span className=\"mt-2 inline-flex items-center gap-1 text-xs text-green-600 font-medium\">\n                                                <Check className=\"w-4 h-4\" /> Already Added\n                                            </span>\n                                        )}\n                                    </button>\n                                );\n                            })}\n                        </div>\n\n                        <button\n                            onClick={() => setShowAddModal(false)}\n                            className=\"mt-6 w-full px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300\"\n                        >\n                            Close\n                        </button>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/LandingPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Star' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'navigate' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":18,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Link, useNavigate } from 'react-router-dom';\nimport {\n    Shield,\n    CheckCircle,\n    Users,\n    Smartphone,\n    LayoutDashboard,\n    ArrowRight,\n    Menu,\n    X,\n    Star,\n    Lock,\n    Zap\n} from 'lucide-react';\n\nexport default function LandingPage() {\n    const navigate = useNavigate();\n    const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n\n    return (\n        <div className=\"min-h-screen bg-white font-sans text-gray-900\">\n            {/* Navigation */}\n            <nav className=\"fixed w-full z-50 bg-white/80 backdrop-blur-md border-b border-gray-100\">\n                <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                    <div className=\"flex justify-between items-center h-20\">\n                        <div className=\"flex items-center gap-2\">\n                            <div className=\"h-10 w-10 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-xl flex items-center justify-center text-white shadow-lg\">\n                                <Shield className=\"h-6 w-6\" />\n                            </div>\n                            <span className=\"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-gray-900 to-gray-600\">\n                                NovumFlow\n                            </span>\n                        </div>\n\n                        <div className=\"hidden md:flex items-center space-x-8\">\n                            <a href=\"#features\" className=\"text-gray-600 hover:text-cyan-600 font-medium transition-colors\">Features</a>\n                            <a href=\"#suite\" className=\"text-gray-600 hover:text-cyan-600 font-medium transition-colors\">The Suite</a>\n                            <a href=\"#testimonials\" className=\"text-gray-600 hover:text-cyan-600 font-medium transition-colors\">Testimonials</a>\n                            <Link\n                                to=\"/login\"\n                                className=\"px-6 py-2.5 rounded-full bg-gray-900 text-white font-semibold hover:bg-gray-800 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5\"\n                            >\n                                Login\n                            </Link>\n                        </div>\n\n                        <div className=\"md:hidden\">\n                            <button onClick={() => setMobileMenuOpen(!mobileMenuOpen)} className=\"text-gray-600\">\n                                {mobileMenuOpen ? <X className=\"h-6 w-6\" /> : <Menu className=\"h-6 w-6\" />}\n                            </button>\n                        </div>\n                    </div>\n                </div>\n\n                {/* Mobile Menu */}\n                {mobileMenuOpen && (\n                    <div className=\"md:hidden bg-white border-t border-gray-100 absolute w-full\">\n                        <div className=\"px-4 pt-2 pb-6 space-y-2\">\n                            <a href=\"#features\" className=\"block px-3 py-2 text-base font-medium text-gray-700 hover:bg-gray-50 rounded-md\">Features</a>\n                            <a href=\"#suite\" className=\"block px-3 py-2 text-base font-medium text-gray-700 hover:bg-gray-50 rounded-md\">The Suite</a>\n                            <Link to=\"/login\" className=\"block w-full text-center mt-4 px-6 py-3 rounded-lg bg-cyan-600 text-white font-bold\">\n                                Login to Dashboard\n                            </Link>\n                        </div>\n                    </div>\n                )}\n            </nav>\n\n            {/* Hero Section */}\n            <section className=\"pt-32 pb-20 lg:pt-48 lg:pb-32 overflow-hidden relative\">\n                <div className=\"absolute top-0 left-1/2 -translate-x-1/2 w-full h-full z-0 pointer-events-none\">\n                    <div className=\"absolute top-20 left-10 w-72 h-72 bg-cyan-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob\"></div>\n                    <div className=\"absolute top-20 right-10 w-72 h-72 bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-2000\"></div>\n                    <div className=\"absolute -bottom-8 left-1/2 w-72 h-72 bg-pink-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-4000\"></div>\n                </div>\n\n                <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10 text-center\">\n                    <div className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-cyan-50 border border-cyan-100 text-cyan-700 font-semibold text-sm mb-8 animate-fade-in-up\">\n                        <span className=\"relative flex h-2 w-2\">\n                            <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-cyan-400 opacity-75\"></span>\n                            <span className=\"relative inline-flex rounded-full h-2 w-2 bg-cyan-500\"></span>\n                        </span>\n                        New: CQC Inspector Mode & Digital Passports\n                    </div>\n\n                    <h1 className=\"text-5xl md:text-7xl font-extrabold tracking-tight text-gray-900 mb-8 leading-tight\">\n                        The Fortress of <br />\n                        <span className=\"bg-clip-text text-transparent bg-gradient-to-r from-cyan-600 to-blue-600\">\n                            Compliance\n                        </span>\n                    </h1>\n\n                    <p className=\"mt-4 max-w-2xl mx-auto text-xl text-gray-600 mb-10\">\n                        The only care management suite that locks non-compliant staff out of your roster.\n                        Protect your agency, pass inspections, and sleep better at night.\n                    </p>\n\n                    <div className=\"flex flex-col sm:flex-row justify-center gap-4\">\n                        <button className=\"px-8 py-4 rounded-full bg-cyan-600 text-white font-bold text-lg shadow-lg hover:bg-cyan-700 hover:shadow-cyan-500/30 transition-all transform hover:-translate-y-1 flex items-center justify-center gap-2\">\n                            Book a Demo <ArrowRight className=\"w-5 h-5\" />\n                        </button>\n                        <Link to=\"/login\" className=\"px-8 py-4 rounded-full bg-white text-gray-900 border border-gray-200 font-bold text-lg hover:bg-gray-50 hover:border-gray-300 transition-all\">\n                            Login\n                        </Link>\n                    </div>\n\n                    {/* Hero Image Mockup */}\n                    <div className=\"mt-20 relative mx-auto max-w-5xl\">\n                        <div className=\"rounded-2xl bg-gray-900 p-2 shadow-2xl ring-1 ring-gray-900/10\">\n                            <div className=\"rounded-xl overflow-hidden bg-gray-800 aspect-[16/9] relative flex items-center justify-center\">\n                                {/* Placeholder for Dashboard Screenshot */}\n                                <div className=\"text-center\">\n                                    <LayoutDashboard className=\"w-24 h-24 text-gray-700 mx-auto mb-4\" />\n                                    <p className=\"text-gray-500 font-medium\">Dashboard Preview</p>\n                                </div>\n                                {/* Floating Elements */}\n                                <div className=\"absolute -right-12 top-12 bg-white p-4 rounded-xl shadow-xl border border-gray-100 w-64 animate-float\">\n                                    <div className=\"flex items-center gap-3 mb-2\">\n                                        <div className=\"h-10 w-10 rounded-full bg-green-100 flex items-center justify-center\">\n                                            <CheckCircle className=\"w-6 h-6 text-green-600\" />\n                                        </div>\n                                        <div>\n                                            <p className=\"text-sm font-bold text-gray-900\">Inspector Mode</p>\n                                            <p className=\"text-xs text-green-600 font-medium\">Active & Verified</p>\n                                        </div>\n                                    </div>\n                                    <div className=\"h-2 bg-gray-100 rounded-full overflow-hidden\">\n                                        <div className=\"h-full w-full bg-green-500\"></div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </section>\n\n            {/* The Suite Section */}\n            <section id=\"suite\" className=\"py-24 bg-gray-50\">\n                <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                    <div className=\"text-center mb-16\">\n                        <h2 className=\"text-base font-semibold text-cyan-600 tracking-wide uppercase\">The Novum Suite</h2>\n                        <p className=\"mt-2 text-3xl leading-8 font-extrabold tracking-tight text-gray-900 sm:text-4xl\">\n                            Two Apps. One Unbeatable System.\n                        </p>\n                    </div>\n\n                    <div className=\"grid md:grid-cols-2 gap-12 items-center\">\n                        {/* NovumFlow */}\n                        <div className=\"bg-white rounded-3xl p-8 shadow-xl border border-gray-100 relative overflow-hidden group hover:border-cyan-200 transition-all\">\n                            <div className=\"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity\">\n                                <Shield className=\"w-48 h-48 text-cyan-600\" />\n                            </div>\n                            <div className=\"relative z-10\">\n                                <div className=\"h-12 w-12 bg-cyan-100 rounded-xl flex items-center justify-center mb-6\">\n                                    <Shield className=\"w-6 h-6 text-cyan-600\" />\n                                </div>\n                                <h3 className=\"text-2xl font-bold text-gray-900 mb-4\">NovumFlow</h3>\n                                <p className=\"text-cyan-600 font-medium mb-6\">The Back Office Shield</p>\n                                <ul className=\"space-y-3 text-gray-600\">\n                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-5 h-5 text-green-500\" /> Automated Recruitment Pipelines</li>\n                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-5 h-5 text-green-500\" /> CQC Compliance Dashboard</li>\n                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-5 h-5 text-green-500\" /> Digital Staff Passports</li>\n                                </ul>\n                            </div>\n                        </div>\n\n                        {/* Care Flow */}\n                        <div className=\"bg-gray-900 rounded-3xl p-8 shadow-xl border border-gray-800 relative overflow-hidden group hover:border-purple-500/30 transition-all\">\n                            <div className=\"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity\">\n                                <Smartphone className=\"w-48 h-48 text-purple-500\" />\n                            </div>\n                            <div className=\"relative z-10\">\n                                <div className=\"h-12 w-12 bg-purple-500/20 rounded-xl flex items-center justify-center mb-6\">\n                                    <Smartphone className=\"w-6 h-6 text-purple-400\" />\n                                </div>\n                                <h3 className=\"text-2xl font-bold text-white mb-4\">Care Flow</h3>\n                                <p className=\"text-purple-400 font-medium mb-6\">The Front Line Engine</p>\n                                <ul className=\"space-y-3 text-gray-300\">\n                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-5 h-5 text-purple-500\" /> Smart Rostering (AI Powered)</li>\n                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-5 h-5 text-purple-500\" /> Mobile Visit Verification</li>\n                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-5 h-5 text-purple-500\" /> Real-time eMAR & Notes</li>\n                                </ul>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </section>\n\n            {/* Killer Features */}\n            <section id=\"features\" className=\"py-24\">\n                <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                    <div className=\"text-center mb-20\">\n                        <h2 className=\"text-3xl font-extrabold text-gray-900 sm:text-4xl\">\n                            Why Agencies Switch to Novum\n                        </h2>\n                    </div>\n\n                    <div className=\"grid md:grid-cols-3 gap-8\">\n                        <FeatureCard\n                            icon={<Lock className=\"w-6 h-6 text-red-500\" />}\n                            title=\"Compliance Lock\"\n                            desc=\"If a DBS expires, the staff member is instantly locked out of the roster. No manual checks, no accidental fines.\"\n                        />\n                        <FeatureCard\n                            icon={<Zap className=\"w-6 h-6 text-yellow-500\" />}\n                            title=\"Inspector Mode\"\n                            desc=\"One click transforms your dashboard into a read-only evidence vault for CQC inspectors. Hide the mess, show the proof.\"\n                        />\n                        <FeatureCard\n                            icon={<Users className=\"w-6 h-6 text-blue-500\" />}\n                            title=\"Digital Passports\"\n                            desc=\"Every carer gets a QR-coded digital ID card. Prove Right to Work and Training status instantly on the floor.\"\n                        />\n                    </div>\n                </div>\n            </section>\n\n            {/* CTA Section */}\n            <section className=\"py-20 bg-cyan-600\">\n                <div className=\"max-w-4xl mx-auto px-4 text-center\">\n                    <h2 className=\"text-3xl font-bold text-white mb-6\">Ready to upgrade your agency?</h2>\n                    <p className=\"text-cyan-100 text-xl mb-10\">Join the agencies that have moved from \"Chaos\" to \"Compliance\".</p>\n                    <div className=\"flex flex-col sm:flex-row justify-center gap-4\">\n                        <button className=\"px-8 py-4 rounded-full bg-white text-cyan-600 font-bold text-lg shadow-lg hover:bg-cyan-50 transition-all\">\n                            Book a Free Demo\n                        </button>\n                        <Link to=\"/login\" className=\"px-8 py-4 rounded-full bg-cyan-700 text-white border border-cyan-500 font-bold text-lg hover:bg-cyan-800 transition-all\">\n                            Login to Account\n                        </Link>\n                    </div>\n                </div>\n            </section>\n\n            {/* Footer */}\n            <footer className=\"bg-gray-900 text-gray-400 py-12 border-t border-gray-800\">\n                <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid md:grid-cols-4 gap-8\">\n                    <div className=\"col-span-1 md:col-span-2\">\n                        <div className=\"flex items-center gap-2 mb-4\">\n                            <Shield className=\"h-6 w-6 text-cyan-500\" />\n                            <span className=\"text-xl font-bold text-white\">NovumFlow</span>\n                        </div>\n                        <p className=\"text-sm max-w-xs\">\n                            The complete operating system for modern care agencies. Built for compliance, designed for people.\n                        </p>\n                    </div>\n                    <div>\n                        <h4 className=\"text-white font-semibold mb-4\">Product</h4>\n                        <ul className=\"space-y-2 text-sm\">\n                            <li><a href=\"#\" className=\"hover:text-white\">NovumFlow (HR)</a></li>\n                            <li><a href=\"#\" className=\"hover:text-white\">Care Flow (Rostering)</a></li>\n                            <li><a href=\"#\" className=\"hover:text-white\">Pricing</a></li>\n                        </ul>\n                    </div>\n                    <div>\n                        <h4 className=\"text-white font-semibold mb-4\">Company</h4>\n                        <ul className=\"space-y-2 text-sm\">\n                            <li><a href=\"#\" className=\"hover:text-white\">About Us</a></li>\n                            <li><a href=\"#\" className=\"hover:text-white\">Contact</a></li>\n                            <li><Link to=\"/privacy\" className=\"hover:text-white\">Privacy Policy</Link></li>\n                        </ul>\n                    </div>\n                </div>\n                <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-12 pt-8 border-t border-gray-800 text-sm text-center\">\n                    &copy; {new Date().getFullYear()} NovumSolvo. All rights reserved.\n                </div>\n            </footer>\n        </div>\n    );\n}\n\nfunction FeatureCard({ icon, title, desc }: { icon: React.ReactNode, title: string, desc: string }) {\n    return (\n        <div className=\"bg-white p-8 rounded-2xl shadow-lg border border-gray-100 hover:shadow-xl transition-all hover:-translate-y-1\">\n            <div className=\"h-12 w-12 bg-gray-50 rounded-xl flex items-center justify-center mb-6\">\n                {icon}\n            </div>\n            <h3 className=\"text-xl font-bold text-gray-900 mb-3\">{title}</h3>\n            <p className=\"text-gray-600 leading-relaxed\">\n                {desc}\n            </p>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/LettersPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":23,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":15},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":27,"column":6,"nodeType":"ArrayExpression","endLine":27,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [activeTab, loadData]","fix":{"range":[1282,1293],"text":"[activeTab, loadData]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'template' is defined but never used. Allowed unused args must match /^_/u.","line":77,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":77,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'templateId' is defined but never used. Allowed unused args must match /^_/u.","line":81,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":81,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'letter' is defined but never used. Allowed unused args must match /^_/u.","line":87,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":87,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'letter' is defined but never used. Allowed unused args must match /^_/u.","line":91,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":91,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { Plus, Search, Edit, Trash2, Download, FileText, Send } from 'lucide-react';\nimport { format } from 'date-fns';\nimport AddTemplateModal from '@/components/AddTemplateModal';\nimport GenerateLetterModal from '@/components/GenerateLetterModal';\nimport Toast from '@/components/Toast';\nimport { log } from '@/lib/logger';\n\ntype TabType = 'templates' | 'generated';\n\nexport default function LettersPage() {\n  const [activeTab, setActiveTab] = useState<TabType>('templates');\n  const [templates, setTemplates] = useState<any[]>([]);\n  const [generatedLetters, setGeneratedLetters] = useState<any[]>([]);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [showAddTemplateModal, setShowAddTemplateModal] = useState(false);\n  const [showGenerateModal, setShowGenerateModal] = useState(false);\n  const [selectedTemplateForGen, setSelectedTemplateForGen] = useState<string | undefined>(undefined);\n  const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' | 'warning' } | null>(null);\n  const { user } = useAuth();\n\n  useEffect(() => {\n    loadData();\n  }, [activeTab]);\n\n  async function loadData() {\n    setLoading(true);\n    try {\n      if (activeTab === 'templates') {\n        const { data } = await supabase\n          .from('letter_templates')\n          .select('*')\n          .eq('is_active', true)\n          .order('template_name');\n        setTemplates(data || []);\n      } else {\n        const { data } = await supabase\n          .from('generated_letters')\n          .select('*')\n          .order('generated_at', { ascending: false });\n        setGeneratedLetters(data || []);\n      }\n    } catch (error) {\n      log.error('Error loading data', error, { component: 'LettersPage', action: 'loadData', metadata: { activeTab } });\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  function generateLetter(templateId?: string) {\n    setSelectedTemplateForGen(templateId);\n    setShowGenerateModal(true);\n  }\n\n  function handleAddNew() {\n    if (activeTab === 'templates') {\n      setShowAddTemplateModal(true);\n    } else {\n      generateLetter();\n    }\n  }\n\n  async function handleSuccess(message: string = 'Success!') {\n    setToast({ message, type: 'success' });\n    // Small delay to ensure database has committed the changes\n    await new Promise(resolve => setTimeout(resolve, 300));\n    await loadData();\n  }\n\n  function handleError(message: string) {\n    setToast({ message, type: 'error' });\n  }\n\n  function editTemplate(template: any) {\n    setToast({ message: 'Template edit functionality will be available in the next update', type: 'warning' });\n  }\n\n  async function deleteTemplate(templateId: string) {\n    if (window.confirm('Are you sure you want to delete this template?')) {\n      setToast({ message: 'Template deletion will be available in the next update', type: 'warning' });\n    }\n  }\n\n  function downloadLetter(letter: any) {\n    setToast({ message: 'Letter download functionality will be available in the next update', type: 'warning' });\n  }\n\n  function editLetter(letter: any) {\n    setToast({ message: 'Letter edit functionality will be available in the next update', type: 'warning' });\n  }\n\n  const tabs = [\n    { id: 'templates', label: 'Letter Templates' },\n    { id: 'generated', label: 'Generated Letters' },\n  ];\n\n  const filteredTemplates = templates.filter(t =>\n    t.template_name.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  return (\n    <div>\n      <div className=\"mb-8 flex flex-col sm:flex-row sm:items-center sm:justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Letter Management</h1>\n          <p className=\"mt-1 text-sm text-gray-600\">Create and manage document templates and letters</p>\n        </div>\n\n        <button\n          onClick={handleAddNew}\n          className=\"mt-4 sm:mt-0 inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition\"\n        >\n          <Plus className=\"w-4 h-4 mr-2\" />\n          {activeTab === 'templates' ? 'New Template' : 'Generate Letter'}\n        </button>\n      </div>\n\n      {/* Tabs */}\n      <div className=\"mb-6 border-b border-gray-200\">\n        <nav className=\"-mb-px flex space-x-8\">\n          {tabs.map((tab) => (\n            <button\n              key={tab.id}\n              onClick={() => setActiveTab(tab.id as TabType)}\n              className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition ${activeTab === tab.id\n                ? 'border-indigo-500 text-indigo-600'\n                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                }`}\n            >\n              {tab.label}\n            </button>\n          ))}\n        </nav>\n      </div>\n\n      {/* Search Bar */}\n      <div className=\"mb-6\">\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\n          <input\n            type=\"text\"\n            placeholder={`Search ${activeTab}...`}\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n          />\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className=\"bg-white rounded-xl shadow-sm border border-gray-200\">\n        {loading ? (\n          <div className=\"flex items-center justify-center h-64\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600\"></div>\n          </div>\n        ) : (\n          <>\n            {/* Templates Table */}\n            {activeTab === 'templates' && (\n              <div className=\"overflow-x-auto\">\n                <table className=\"min-w-full divide-y divide-gray-200\">\n                  <thead className=\"bg-gray-50\">\n                    <tr>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Template Name</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Type</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Category</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Version</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"bg-white divide-y divide-gray-200\">\n                    {filteredTemplates.length > 0 ? (\n                      filteredTemplates.map((template) => (\n                        <tr key={template.id} className=\"hover:bg-gray-50\">\n                          <td className=\"px-6 py-4\">\n                            <div className=\"flex items-center\">\n                              <FileText className=\"w-5 h-5 text-gray-400 mr-3\" />\n                              <div className=\"text-sm font-medium text-gray-900\">{template.template_name}</div>\n                            </div>\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900 capitalize\">\n                            {template.template_type?.replace('_', ' ') || 'N/A'}\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                            {template.category || 'N/A'}\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                            v{template.version}\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\n                            <button\n                              onClick={() => generateLetter(template.id)}\n                              className=\"text-indigo-600 hover:text-indigo-900 mr-3\"\n                              title=\"Generate Letter\"\n                            >\n                              <Send className=\"w-4 h-4\" />\n                            </button>\n                            <button\n                              onClick={() => editTemplate(template)}\n                              className=\"text-gray-600 hover:text-gray-900 mr-3 p-1 rounded\"\n                              title=\"Edit Template\"\n                            >\n                              <Edit className=\"w-4 h-4\" />\n                            </button>\n                            <button\n                              onClick={() => deleteTemplate(template.id)}\n                              className=\"text-red-600 hover:text-red-900 p-1 rounded\"\n                              title=\"Delete Template\"\n                            >\n                              <Trash2 className=\"w-4 h-4\" />\n                            </button>\n                          </td>\n                        </tr>\n                      ))\n                    ) : (\n                      <tr>\n                        <td colSpan={5} className=\"px-6 py-12 text-center text-sm text-gray-500\">\n                          No templates found\n                        </td>\n                      </tr>\n                    )}\n                  </tbody>\n                </table>\n              </div>\n            )}\n\n            {/* Generated Letters Table */}\n            {activeTab === 'generated' && (\n              <div className=\"overflow-x-auto\">\n                <table className=\"min-w-full divide-y divide-gray-200\">\n                  <thead className=\"bg-gray-50\">\n                    <tr>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Letter Type</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Subject</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Generated Date</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"bg-white divide-y divide-gray-200\">\n                    {generatedLetters.length > 0 ? (\n                      generatedLetters.map((letter) => (\n                        <tr key={letter.id} className=\"hover:bg-gray-50\">\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                            {letter.letter_type}\n                          </td>\n                          <td className=\"px-6 py-4 text-sm text-gray-900\">\n                            {letter.subject}\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                            {format(new Date(letter.generated_at), 'MMM dd, yyyy')}\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\n                            <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${letter.status === 'sent' ? 'bg-green-100 text-green-800' :\n                              letter.status === 'approved' ? 'bg-blue-100 text-blue-800' :\n                                letter.status === 'rejected' ? 'bg-red-100 text-red-800' :\n                                  'bg-yellow-100 text-yellow-800'\n                              }`}>\n                              {letter.status}\n                            </span>\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\n                            {letter.pdf_url && (\n                              <button\n                                onClick={() => downloadLetter(letter)}\n                                className=\"text-indigo-600 hover:text-indigo-900 mr-3 p-1 rounded\"\n                                title=\"Download Letter\"\n                              >\n                                <Download className=\"w-4 h-4\" />\n                              </button>\n                            )}\n                            <button\n                              onClick={() => editLetter(letter)}\n                              className=\"text-gray-600 hover:text-gray-900 p-1 rounded\"\n                              title=\"Edit Letter\"\n                            >\n                              <Edit className=\"w-4 h-4\" />\n                            </button>\n                          </td>\n                        </tr>\n                      ))\n                    ) : (\n                      <tr>\n                        <td colSpan={5} className=\"px-6 py-12 text-center text-sm text-gray-500\">\n                          No generated letters found\n                        </td>\n                      </tr>\n                    )}\n                  </tbody>\n                </table>\n              </div>\n            )}\n          </>\n        )}\n      </div>\n\n      {/* Modals */}\n      <AddTemplateModal\n        isOpen={showAddTemplateModal}\n        onClose={() => setShowAddTemplateModal(false)}\n        onSuccess={() => handleSuccess('Template created successfully!')}\n        onError={handleError}\n      />\n\n      <GenerateLetterModal\n        isOpen={showGenerateModal}\n        onClose={() => setShowGenerateModal(false)}\n        templateId={selectedTemplateForGen}\n        onSuccess={() => {\n          setActiveTab('generated');\n          handleSuccess('Letter generated successfully!');\n        }}\n        onError={handleError}\n      />\n\n      {/* Toast Notification */}\n      {toast && (\n        <Toast\n          message={toast.message}\n          type={toast.type}\n          onClose={() => setToast(null)}\n        />\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/LoginPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/MessagingPage.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'markAsRead'. Either include it or remove the dependency array.","line":55,"column":6,"nodeType":"ArrayExpression","endLine":55,"endColumn":28,"suggestions":[{"desc":"Update the dependencies array to be: [markAsRead, selectedConversation]","fix":{"range":[1713,1735],"text":"[markAsRead, selectedConversation]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from 'react';\nimport { MessageSquare, Send, Search, Plus, X, CheckCheck } from 'lucide-react';\nimport { supabase, supabaseUrl } from '../lib/supabase';\nimport { log } from '@/lib/logger';\n\ninterface Message {\n  id: string;\n  conversation_id: string;\n  sender_id: string;\n  content: string;\n  attachment_url?: string;\n  sent_at: string;\n  is_edited: boolean;\n}\n\ninterface Conversation {\n  id: string;\n  title: string;\n  updated_at: string;\n  unread_count: number;\n  last_message?: { content: string; sent_at: string };\n}\n\ninterface User {\n  user_id: string;\n  full_name: string;\n  email: string;\n  role: string;\n}\n\nexport default function MessagingPage() {\n  const [conversations, setConversations] = useState<Conversation[]>([]);\n  const [selectedConversation, setSelectedConversation] = useState<string | null>(null);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [messageInput, setMessageInput] = useState('');\n  const [showNewConversation, setShowNewConversation] = useState(false);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [searchResults, setSearchResults] = useState<User[]>([]);\n  const [selectedUsers, setSelectedUsers] = useState<User[]>([]);\n  const [conversationTitle, setConversationTitle] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [currentUser, setCurrentUser] = useState<{ id: string } | null>(null);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    loadCurrentUser();\n    loadConversations();\n  }, []);\n\n  useEffect(() => {\n    if (selectedConversation) {\n      loadMessages(selectedConversation);\n      markAsRead(selectedConversation);\n    }\n  }, [selectedConversation]);\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  const loadCurrentUser = async () => {\n    const { data: { user } } = await supabase.auth.getUser();\n    setCurrentUser(user);\n  };\n\n  const loadConversations = async () => {\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      const response = await fetch(`${supabaseUrl}/functions/v1/messaging-crud`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`\n        },\n        body: JSON.stringify({ action: 'GET_CONVERSATIONS' })\n      });\n\n      const result = await response.json();\n      if (result.success) {\n        setConversations(result.conversations);\n      }\n    } catch (error) {\n      log.error('Failed to load conversations', error, { component: 'MessagingPage', action: 'loadConversations' });\n    }\n  };\n\n  const loadMessages = async (conversationId: string) => {\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      const response = await fetch(`${supabaseUrl}/functions/v1/messaging-crud`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`\n        },\n        body: JSON.stringify({ action: 'GET_MESSAGES', data: { conversationId } })\n      });\n\n      const result = await response.json();\n      if (result.success) {\n        setMessages(result.messages);\n      }\n    } catch (error) {\n      log.error('Failed to load messages', error, { component: 'MessagingPage', action: 'loadMessages', metadata: { conversationId } });\n    }\n  };\n\n  const markAsRead = async (conversationId: string) => {\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      await fetch(`${supabaseUrl}/functions/v1/messaging-crud`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`\n        },\n        body: JSON.stringify({ action: 'MARK_READ', data: { conversationId } })\n      });\n      loadConversations();\n    } catch (error) {\n      log.error('Failed to mark as read', error, { component: 'MessagingPage', action: 'markAsRead', metadata: { conversationId } });\n    }\n  };\n\n  const sendMessage = async () => {\n    if (!messageInput.trim() || !selectedConversation) return;\n\n    try {\n      setLoading(true);\n      const { data: { session } } = await supabase.auth.getSession();\n      const response = await fetch(`${supabaseUrl}/functions/v1/messaging-crud`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`\n        },\n        body: JSON.stringify({\n          action: 'SEND_MESSAGE',\n          data: {\n            conversationId: selectedConversation,\n            content: messageInput\n          }\n        })\n      });\n\n      const result = await response.json();\n      if (result.success) {\n        setMessageInput('');\n        loadMessages(selectedConversation);\n        loadConversations();\n      }\n    } catch (error) {\n      log.error('Failed to send message', error, { component: 'MessagingPage', action: 'sendMessage', metadata: { conversationId: selectedConversation } });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const searchUsers = async (query: string) => {\n    if (!query.trim()) {\n      setSearchResults([]);\n      return;\n    }\n\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      const response = await fetch(`${supabaseUrl}/functions/v1/messaging-crud`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`\n        },\n        body: JSON.stringify({ action: 'SEARCH_USERS', data: { query } })\n      });\n\n      const result = await response.json();\n      if (result.success) {\n        setSearchResults(result.users);\n      }\n    } catch (error) {\n      log.error('Failed to search users', error, { component: 'MessagingPage', action: 'searchUsers', metadata: { query } });\n    }\n  };\n\n  const createConversation = async () => {\n    if (selectedUsers.length === 0 || !conversationTitle.trim()) return;\n\n    try {\n      setLoading(true);\n      const { data: { session } } = await supabase.auth.getSession();\n      const response = await fetch(`${supabaseUrl}/functions/v1/messaging-crud`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`\n        },\n        body: JSON.stringify({\n          action: 'CREATE_CONVERSATION',\n          data: {\n            title: conversationTitle,\n            participantIds: selectedUsers.map(u => u.user_id),\n            conversationType: selectedUsers.length > 1 ? 'group' : 'direct'\n          }\n        })\n      });\n\n      const result = await response.json();\n      if (result.success) {\n        setShowNewConversation(false);\n        setConversationTitle('');\n        setSelectedUsers([]);\n        setSearchQuery('');\n        setSearchResults([]);\n        loadConversations();\n        setSelectedConversation(result.conversation.id);\n      }\n    } catch (error) {\n      log.error('Failed to create conversation', error, { component: 'MessagingPage', action: 'createConversation', metadata: { title: conversationTitle, participantCount: selectedUsers.length } });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const formatTime = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });\n  };\n\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    const today = new Date();\n    const yesterday = new Date(today);\n    yesterday.setDate(yesterday.getDate() - 1);\n\n    if (date.toDateString() === today.toDateString()) {\n      return 'Today';\n    } else if (date.toDateString() === yesterday.toDateString()) {\n      return 'Yesterday';\n    } else {\n      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\n    }\n  };\n\n  return (\n    <div className=\"h-[calc(100vh-64px)] flex bg-gray-50\">\n      {/* Conversations Sidebar */}\n      <div className=\"w-80 bg-white border-r border-gray-200 flex flex-col\">\n        <div className=\"p-4 border-b border-gray-200\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h2 className=\"text-lg font-semibold text-gray-900\">Messages</h2>\n            <button\n              onClick={() => setShowNewConversation(true)}\n              className=\"p-2 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors\"\n            >\n              <Plus className=\"w-5 h-5\" />\n            </button>\n          </div>\n        </div>\n\n        {/* Conversation List */}\n        <div className=\"flex-1 overflow-y-auto\">\n          {conversations.map((conv) => (\n            <div\n              key={conv.id}\n              onClick={() => setSelectedConversation(conv.id)}\n              className={`p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 transition-colors ${selectedConversation === conv.id ? 'bg-indigo-50' : ''\n                }`}\n            >\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2\">\n                    <h3 className=\"font-medium text-gray-900\">{conv.title || 'Conversation'}</h3>\n                    {conv.unread_count > 0 && (\n                      <span className=\"px-2 py-0.5 text-xs font-medium bg-indigo-600 text-white rounded-full\">\n                        {conv.unread_count}\n                      </span>\n                    )}\n                  </div>\n                  {conv.last_message && (\n                    <p className=\"text-sm text-gray-600 truncate mt-1\">\n                      {conv.last_message.content}\n                    </p>\n                  )}\n                </div>\n                <span className=\"text-xs text-gray-500\">\n                  {formatDate(conv.updated_at)}\n                </span>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Messages Area */}\n      <div className=\"flex-1 flex flex-col\">\n        {selectedConversation ? (\n          <>\n            {/* Messages Header */}\n            <div className=\"bg-white border-b border-gray-200 p-4\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"p-2 bg-indigo-100 rounded-full\">\n                    <MessageSquare className=\"w-5 h-5 text-indigo-600\" />\n                  </div>\n                  <h2 className=\"text-lg font-semibold text-gray-900\">\n                    {conversations.find(c => c.id === selectedConversation)?.title || 'Conversation'}\n                  </h2>\n                </div>\n              </div>\n            </div>\n\n            {/* Messages List */}\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n              {messages.map((msg) => (\n                <div\n                  key={msg.id}\n                  className={`flex ${msg.sender_id === currentUser?.id ? 'justify-end' : 'justify-start'}`}\n                >\n                  <div\n                    className={`max-w-md px-4 py-2 rounded-lg ${msg.sender_id === currentUser?.id\n                        ? 'bg-indigo-600 text-white'\n                        : 'bg-gray-200 text-gray-900'\n                      }`}\n                  >\n                    <p className=\"text-sm\">{msg.content}</p>\n                    <div className=\"flex items-center justify-end gap-1 mt-1\">\n                      <span className={`text-xs ${msg.sender_id === currentUser?.id ? 'text-indigo-200' : 'text-gray-500'}`}>\n                        {formatTime(msg.sent_at)}\n                      </span>\n                      {msg.sender_id === currentUser?.id && (\n                        <CheckCheck className=\"w-3 h-3 text-indigo-200\" />\n                      )}\n                    </div>\n                  </div>\n                </div>\n              ))}\n              <div ref={messagesEndRef} />\n            </div>\n\n            {/* Message Input */}\n            <div className=\"bg-white border-t border-gray-200 p-4\">\n              <div className=\"flex items-center gap-2\">\n                <input\n                  type=\"text\"\n                  value={messageInput}\n                  onChange={(e) => setMessageInput(e.target.value)}\n                  onKeyPress={(e) => e.key === 'Enter' && sendMessage()}\n                  placeholder=\"Type a message...\"\n                  className=\"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                  disabled={loading}\n                />\n                <button\n                  onClick={sendMessage}\n                  disabled={loading || !messageInput.trim()}\n                  className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n                >\n                  <Send className=\"w-5 h-5\" />\n                </button>\n              </div>\n            </div>\n          </>\n        ) : (\n          <div className=\"flex-1 flex items-center justify-center text-gray-500\">\n            <div className=\"text-center\">\n              <MessageSquare className=\"w-16 h-16 mx-auto mb-4 text-gray-300\" />\n              <p className=\"text-lg font-medium\">Select a conversation to start messaging</p>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* New Conversation Modal */}\n      {showNewConversation && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white rounded-lg w-full max-w-md p-6\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h3 className=\"text-lg font-semibold text-gray-900\">New Conversation</h3>\n              <button\n                onClick={() => {\n                  setShowNewConversation(false);\n                  setConversationTitle('');\n                  setSelectedUsers([]);\n                  setSearchQuery('');\n                  setSearchResults([]);\n                }}\n                className=\"text-gray-400 hover:text-gray-600\"\n              >\n                <X className=\"w-5 h-5\" />\n              </button>\n            </div>\n\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Conversation Title\n                </label>\n                <input\n                  type=\"text\"\n                  value={conversationTitle}\n                  onChange={(e) => setConversationTitle(e.target.value)}\n                  placeholder=\"Enter conversation title\"\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Add Participants\n                </label>\n                <div className=\"relative\">\n                  <Search className=\"absolute left-3 top-2.5 w-5 h-5 text-gray-400\" />\n                  <input\n                    type=\"text\"\n                    value={searchQuery}\n                    onChange={(e) => {\n                      setSearchQuery(e.target.value);\n                      searchUsers(e.target.value);\n                    }}\n                    placeholder=\"Search users...\"\n                    className=\"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                  />\n                </div>\n\n                {searchResults.length > 0 && (\n                  <div className=\"mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-lg\">\n                    {searchResults.map((user) => (\n                      <div\n                        key={user.user_id}\n                        onClick={() => {\n                          if (!selectedUsers.find(u => u.user_id === user.user_id)) {\n                            setSelectedUsers([...selectedUsers, user]);\n                            setSearchQuery('');\n                            setSearchResults([]);\n                          }\n                        }}\n                        className=\"p-2 hover:bg-gray-50 cursor-pointer\"\n                      >\n                        <p className=\"text-sm font-medium text-gray-900\">{user.full_name}</p>\n                        <p className=\"text-xs text-gray-500\">{user.email}</p>\n                      </div>\n                    ))}\n                  </div>\n                )}\n\n                {selectedUsers.length > 0 && (\n                  <div className=\"mt-2 flex flex-wrap gap-2\">\n                    {selectedUsers.map((user) => (\n                      <span\n                        key={user.user_id}\n                        className=\"inline-flex items-center gap-1 px-2 py-1 bg-indigo-100 text-indigo-700 rounded-full text-sm\"\n                      >\n                        {user.full_name}\n                        <button\n                          onClick={() => setSelectedUsers(selectedUsers.filter(u => u.user_id !== user.user_id))}\n                          className=\"text-indigo-600 hover:text-indigo-800\"\n                        >\n                          <X className=\"w-3 h-3\" />\n                        </button>\n                      </span>\n                    ))}\n                  </div>\n                )}\n              </div>\n\n              <button\n                onClick={createConversation}\n                disabled={loading || selectedUsers.length === 0 || !conversationTitle.trim()}\n                className=\"w-full px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n              >\n                Create Conversation\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/NoticeBoardPage.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadAnnouncements'. Either include it or remove the dependency array.","line":64,"column":6,"nodeType":"ArrayExpression","endLine":64,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadAnnouncements]","fix":{"range":[2090,2092],"text":"[loadAnnouncements]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'filterAnnouncements'. Either include it or remove the dependency array.","line":68,"column":6,"nodeType":"ArrayExpression","endLine":68,"endColumn":39,"suggestions":[{"desc":"Update the dependencies array to be: [selectedCategory, announcements, filterAnnouncements]","fix":{"range":[2148,2181],"text":"[selectedCategory, announcements, filterAnnouncements]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Bell, Plus, Filter, Pin, Eye, CheckCircle, AlertTriangle, Calendar, User, X } from 'lucide-react';\nimport { supabase, supabaseUrl } from '../lib/supabase';\nimport { log } from '@/lib/logger';\n\ninterface Announcement {\n  id: string;\n  title: string;\n  content: string;\n  category: string;\n  priority: string;\n  created_at: string;\n  expires_at?: string;\n  is_pinned: boolean;\n  user_viewed: boolean;\n  user_acknowledged: boolean;\n  total_views: number;\n  users_profiles: {\n    full_name: string;\n    role: string;\n  };\n}\n\nexport default function NoticeBoardPage() {\n  const [announcements, setAnnouncements] = useState<Announcement[]>([]);\n  const [filteredAnnouncements, setFilteredAnnouncements] = useState<Announcement[]>([]);\n  const [selectedCategory, setSelectedCategory] = useState('all');\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [currentUserRole, setCurrentUserRole] = useState<string>('');\n  const [loading, setLoading] = useState(false);\n  const [unreadCount, setUnreadCount] = useState(0);\n\n  const [newAnnouncement, setNewAnnouncement] = useState({\n    title: '',\n    content: '',\n    category: 'general',\n    priority: 'normal',\n    expiresAt: '',\n    isPinned: false,\n    visibilityLevel: 'company-wide',\n    targetAudience: []\n  });\n\n  const categories = [\n    { value: 'all', label: 'All', color: 'gray' },\n    { value: 'general', label: 'General', color: 'blue' },\n    { value: 'urgent', label: 'Urgent', color: 'red' },\n    { value: 'job-related', label: 'Job Related', color: 'green' },\n    { value: 'policy', label: 'Policy Updates', color: 'yellow' },\n    { value: 'compliance', label: 'Compliance Alerts', color: 'purple' }\n  ];\n\n  const priorities = [\n    { value: 'low', label: 'Low', icon: null },\n    { value: 'normal', label: 'Normal', icon: null },\n    { value: 'high', label: 'High', icon: AlertTriangle },\n    { value: 'urgent', label: 'Urgent', icon: AlertTriangle }\n  ];\n\n  useEffect(() => {\n    loadUserRole();\n    loadAnnouncements();\n    loadUnreadCount();\n  }, []);\n\n  useEffect(() => {\n    filterAnnouncements();\n  }, [selectedCategory, announcements]);\n\n  const loadUserRole = async () => {\n    const { data: { user } } = await supabase.auth.getUser();\n    if (user) {\n      const { data: profile } = await supabase\n        .from('users_profiles')\n        .select('role')\n        .eq('user_id', user.id)\n        .single();\n      setCurrentUserRole(profile?.role || '');\n    }\n  };\n\n  const loadAnnouncements = async () => {\n    try {\n      setLoading(true);\n      const { data: { session } } = await supabase.auth.getSession();\n      const response = await fetch(`${supabaseUrl}/functions/v1/noticeboard-crud`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`\n        },\n        body: JSON.stringify({\n          action: 'GET_ANNOUNCEMENTS',\n          data: { category: selectedCategory === 'all' ? null : selectedCategory }\n        })\n      });\n\n      const result = await response.json();\n      if (result.success) {\n        setAnnouncements(result.announcements);\n      }\n    } catch (error) {\n      log.error('Failed to load announcements', error, { component: 'NoticeBoardPage', action: 'loadAnnouncements' });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const loadUnreadCount = async () => {\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      const response = await fetch(`${supabaseUrl}/functions/v1/noticeboard-crud`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`\n        },\n        body: JSON.stringify({ action: 'GET_UNREAD_COUNT' })\n      });\n\n      const result = await response.json();\n      if (result.success) {\n        setUnreadCount(result.unread_count);\n      }\n    } catch (error) {\n      log.error('Failed to load unread count', error, { component: 'NoticeBoardPage', action: 'loadUnreadCount' });\n    }\n  };\n\n  const filterAnnouncements = () => {\n    if (selectedCategory === 'all') {\n      setFilteredAnnouncements(announcements);\n    } else {\n      setFilteredAnnouncements(announcements.filter(ann => ann.category === selectedCategory));\n    }\n  };\n\n  const markAsViewed = async (announcementId: string) => {\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      await fetch(`${supabaseUrl}/functions/v1/noticeboard-crud`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`\n        },\n        body: JSON.stringify({ action: 'MARK_VIEWED', data: { announcementId } })\n      });\n      loadAnnouncements();\n      loadUnreadCount();\n    } catch (error) {\n      log.error('Failed to mark as viewed', error, { component: 'NoticeBoardPage', action: 'markAsViewed', metadata: { announcementId } });\n    }\n  };\n\n  const acknowledgeAnnouncement = async (announcementId: string) => {\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      await fetch(`${supabaseUrl}/functions/v1/noticeboard-crud`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`\n        },\n        body: JSON.stringify({ action: 'ACKNOWLEDGE_ANNOUNCEMENT', data: { announcementId } })\n      });\n      loadAnnouncements();\n    } catch (error) {\n      log.error('Failed to acknowledge', error, { component: 'NoticeBoardPage', action: 'acknowledgeAnnouncement', metadata: { announcementId } });\n    }\n  };\n\n  const createAnnouncement = async () => {\n    if (!newAnnouncement.title || !newAnnouncement.content) return;\n\n    try {\n      setLoading(true);\n      const { data: { session } } = await supabase.auth.getSession();\n      const response = await fetch(`${supabaseUrl}/functions/v1/noticeboard-crud`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`\n        },\n        body: JSON.stringify({ action: 'CREATE_ANNOUNCEMENT', data: newAnnouncement })\n      });\n\n      const result = await response.json();\n      if (result.success) {\n        setShowCreateModal(false);\n        setNewAnnouncement({\n          title: '',\n          content: '',\n          category: 'general',\n          priority: 'normal',\n          expiresAt: '',\n          isPinned: false,\n          visibilityLevel: 'company-wide',\n          targetAudience: []\n        });\n        loadAnnouncements();\n        loadUnreadCount();\n      }\n    } catch (error) {\n      log.error('Failed to create announcement', error, { component: 'NoticeBoardPage', action: 'createAnnouncement' });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getPriorityColor = (priority: string) => {\n    switch (priority) {\n      case 'urgent':\n        return 'bg-red-100 text-red-800 border-red-200';\n      case 'high':\n        return 'bg-orange-100 text-orange-800 border-orange-200';\n      case 'normal':\n        return 'bg-blue-100 text-blue-800 border-blue-200';\n      case 'low':\n        return 'bg-gray-100 text-gray-800 border-gray-200';\n      default:\n        return 'bg-gray-100 text-gray-800 border-gray-200';\n    }\n  };\n\n  const getCategoryColor = (category: string) => {\n    const cat = categories.find(c => c.value === category);\n    return cat?.color || 'gray';\n  };\n\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleDateString('en-US', {\n      month: 'short',\n      day: 'numeric',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  const canCreateAnnouncement = ['admin', 'hr manager'].includes(currentUserRole?.toLowerCase() || '');\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 p-6\">\n      <div className=\"max-w-7xl mx-auto\">\n        {/* Header */}\n        <div className=\"bg-white rounded-lg shadow-sm p-6 mb-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-2xl font-bold text-gray-900\">Notice Board</h1>\n              <p className=\"text-gray-600 mt-1\">Company announcements and important updates</p>\n            </div>\n            <div className=\"flex items-center gap-4\">\n              {unreadCount > 0 && (\n                <div className=\"flex items-center gap-2 px-4 py-2 bg-indigo-100 text-indigo-700 rounded-lg\">\n                  <Bell className=\"w-5 h-5\" />\n                  <span className=\"font-medium\">{unreadCount} unread</span>\n                </div>\n              )}\n              {canCreateAnnouncement && (\n                <button\n                  onClick={() => setShowCreateModal(true)}\n                  className=\"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors\"\n                >\n                  <Plus className=\"w-5 h-5\" />\n                  New Announcement\n                </button>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Category Filter */}\n        <div className=\"bg-white rounded-lg shadow-sm p-4 mb-6\">\n          <div className=\"flex items-center gap-2 flex-wrap\">\n            <Filter className=\"w-5 h-5 text-gray-500\" />\n            {categories.map((category) => (\n              <button\n                key={category.value}\n                onClick={() => setSelectedCategory(category.value)}\n                className={`px-4 py-2 rounded-lg transition-colors ${selectedCategory === category.value\n                  ? 'bg-indigo-600 text-white'\n                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                  }`}\n              >\n                {category.label}\n              </button>\n            ))}\n          </div>\n        </div>\n\n        {/* Announcements List */}\n        <div className=\"space-y-4\">\n          {loading ? (\n            <div className=\"flex justify-center py-12\">\n              <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600\"></div>\n            </div>\n          ) : filteredAnnouncements.length === 0 ? (\n            <div className=\"bg-white rounded-lg shadow-sm p-12 text-center\">\n              <Bell className=\"w-16 h-16 mx-auto text-gray-300 mb-4\" />\n              <p className=\"text-lg text-gray-500\">No announcements to display</p>\n            </div>\n          ) : (\n            filteredAnnouncements.map((announcement) => (\n              <div\n                key={announcement.id}\n                className={`bg-white rounded-lg shadow-sm p-6 border-l-4 ${announcement.is_pinned ? 'border-yellow-500' : 'border-transparent'\n                  } ${!announcement.user_viewed ? 'bg-indigo-50' : ''}`}\n                onMouseEnter={() => !announcement.user_viewed && markAsViewed(announcement.id)}\n              >\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-start gap-3\">\n                      {announcement.is_pinned && (\n                        <Pin className=\"w-5 h-5 text-yellow-600 mt-1 flex-shrink-0\" />\n                      )}\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center gap-2 mb-2\">\n                          <h3 className=\"text-lg font-semibold text-gray-900\">\n                            {announcement.title}\n                          </h3>\n                          <span className={`px-2 py-1 text-xs font-medium rounded-full border ${getPriorityColor(announcement.priority)}`}>\n                            {announcement.priority.toUpperCase()}\n                          </span>\n                          <span className={`px-2 py-1 text-xs font-medium rounded-full bg-${getCategoryColor(announcement.category)}-100 text-${getCategoryColor(announcement.category)}-800`}>\n                            {announcement.category}\n                          </span>\n                        </div>\n                        <p className=\"text-gray-700 mb-4\">{announcement.content}</p>\n\n                        <div className=\"flex items-center gap-6 text-sm text-gray-500\">\n                          <div className=\"flex items-center gap-1\">\n                            <User className=\"w-4 h-4\" />\n                            <span>{announcement.users_profiles.full_name}</span>\n                          </div>\n                          <div className=\"flex items-center gap-1\">\n                            <Calendar className=\"w-4 h-4\" />\n                            <span>{formatDate(announcement.created_at)}</span>\n                          </div>\n                          <div className=\"flex items-center gap-1\">\n                            <Eye className=\"w-4 h-4\" />\n                            <span>{announcement.total_views} views</span>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  {!announcement.user_acknowledged && (\n                    <button\n                      onClick={() => acknowledgeAnnouncement(announcement.id)}\n                      className=\"flex items-center gap-2 px-3 py-1 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors text-sm\"\n                    >\n                      <CheckCircle className=\"w-4 h-4\" />\n                      Acknowledge\n                    </button>\n                  )}\n\n                  {announcement.user_acknowledged && (\n                    <div className=\"flex items-center gap-2 px-3 py-1 bg-green-50 text-green-600 rounded-lg text-sm\">\n                      <CheckCircle className=\"w-4 h-4 fill-current\" />\n                      Acknowledged\n                    </div>\n                  )}\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      </div>\n\n      {/* Create Announcement Modal */}\n      {showCreateModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto\">\n            <div className=\"sticky top-0 bg-white border-b border-gray-200 px-6 py-4\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"text-lg font-semibold text-gray-900\">Create Announcement</h3>\n                <button\n                  onClick={() => setShowCreateModal(false)}\n                  className=\"text-gray-400 hover:text-gray-600\"\n                >\n                  <X className=\"w-5 h-5\" />\n                </button>\n              </div>\n            </div>\n\n            <div className=\"p-6 space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Title *\n                </label>\n                <input\n                  type=\"text\"\n                  value={newAnnouncement.title}\n                  onChange={(e) => setNewAnnouncement({ ...newAnnouncement, title: e.target.value })}\n                  placeholder=\"Enter announcement title\"\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Content *\n                </label>\n                <textarea\n                  value={newAnnouncement.content}\n                  onChange={(e) => setNewAnnouncement({ ...newAnnouncement, content: e.target.value })}\n                  placeholder=\"Enter announcement content\"\n                  rows={6}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                />\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Category\n                  </label>\n                  <select\n                    value={newAnnouncement.category}\n                    onChange={(e) => setNewAnnouncement({ ...newAnnouncement, category: e.target.value })}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                  >\n                    {categories.filter(c => c.value !== 'all').map((cat) => (\n                      <option key={cat.value} value={cat.value}>{cat.label}</option>\n                    ))}\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Priority\n                  </label>\n                  <select\n                    value={newAnnouncement.priority}\n                    onChange={(e) => setNewAnnouncement({ ...newAnnouncement, priority: e.target.value })}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                  >\n                    {priorities.map((priority) => (\n                      <option key={priority.value} value={priority.value}>{priority.label}</option>\n                    ))}\n                  </select>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Expires At (Optional)\n                </label>\n                <input\n                  type=\"datetime-local\"\n                  value={newAnnouncement.expiresAt}\n                  onChange={(e) => setNewAnnouncement({ ...newAnnouncement, expiresAt: e.target.value })}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                />\n              </div>\n\n              <div className=\"flex items-center gap-2\">\n                <input\n                  type=\"checkbox\"\n                  id=\"pinned\"\n                  checked={newAnnouncement.isPinned}\n                  onChange={(e) => setNewAnnouncement({ ...newAnnouncement, isPinned: e.target.checked })}\n                  className=\"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500\"\n                />\n                <label htmlFor=\"pinned\" className=\"text-sm font-medium text-gray-700\">\n                  Pin this announcement to the top\n                </label>\n              </div>\n\n              <div className=\"flex justify-end gap-3 pt-4 border-t border-gray-200\">\n                <button\n                  onClick={() => setShowCreateModal(false)}\n                  className=\"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors\"\n                >\n                  Cancel\n                </button>\n                <button\n                  onClick={createAnnouncement}\n                  disabled={loading || !newAnnouncement.title || !newAnnouncement.content}\n                  className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n                >\n                  Create Announcement\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/OnboardingPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":24},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadNewHires'. Either include it or remove the dependency array.","line":31,"column":8,"nodeType":"ArrayExpression","endLine":31,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [currentTenant, loadNewHires]","fix":{"range":[1167,1182],"text":"[currentTenant, loadNewHires]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { User, Calendar, CheckCircle, Clock, AlertCircle, Plus, Search, ChevronRight } from 'lucide-react';\nimport OnboardingChecklist from '@/components/OnboardingChecklist';\nimport { format, differenceInDays, parseISO } from 'date-fns';\nimport { log } from '@/lib/logger';\n\ninterface NewHire {\n    id: string;\n    first_name: string;\n    last_name: string;\n    email: string;\n    department: string;\n    position: string;\n    start_date: string;\n    onboarding_progress: number;\n    status: 'pending' | 'in_progress' | 'completed';\n}\n\nexport default function OnboardingPage() {\n    const { currentTenant } = useTenant();\n    const [newHires, setNewHires] = useState<NewHire[]>([]);\n    const [selectedHire, setSelectedHire] = useState<NewHire | null>(null);\n    const [loading, setLoading] = useState(true);\n    const [filter, setFilter] = useState<'all' | 'pending' | 'in_progress' | 'completed'>('all');\n    const [searchQuery, setSearchQuery] = useState('');\n\n    useEffect(() => {\n        loadNewHires();\n    }, [currentTenant]);\n\n    async function loadNewHires() {\n        setLoading(true);\n        try {\n            // Try to fetch from employees with recent hire dates\n            const thirtyDaysAgo = new Date();\n            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 90);\n\n            const { data, error } = await supabase\n                .from('employees')\n                .select('*')\n                .eq('tenant_id', currentTenant?.id)\n                .gte('hire_date', thirtyDaysAgo.toISOString().split('T')[0])\n                .order('hire_date', { ascending: false });\n\n            if (error) throw error;\n\n            const hires: NewHire[] = (data || []).map(emp => ({\n                id: emp.id,\n                first_name: emp.first_name,\n                last_name: emp.last_name,\n                email: emp.email,\n                department: emp.department,\n                position: emp.position,\n                start_date: emp.hire_date,\n                onboarding_progress: Math.random() * 100, // This would come from actual onboarding data\n                status: Math.random() > 0.7 ? 'completed' : Math.random() > 0.5 ? 'in_progress' : 'pending' as any,\n            }));\n\n            setNewHires(hires);\n            if (hires.length > 0) {\n                setSelectedHire(hires[0]);\n            }\n        } catch (error) {\n            log.error('Error loading new hires', error, { component: 'OnboardingPage', action: 'loadNewHires' });\n            setNewHires(generateMockNewHires());\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    function generateMockNewHires(): NewHire[] {\n        const names = [\n            { first: 'Emma', last: 'Wilson' },\n            { first: 'James', last: 'Chen' },\n            { first: 'Sarah', last: 'Davis' },\n            { first: 'Michael', last: 'Brown' },\n            { first: 'Lisa', last: 'Taylor' },\n        ];\n\n        return names.map((name, i) => {\n            const startDate = new Date();\n            startDate.setDate(startDate.getDate() - Math.floor(Math.random() * 30));\n            const progress = Math.random() * 100;\n\n            return {\n                id: `hire-${i}`,\n                first_name: name.first,\n                last_name: name.last,\n                email: `${name.first.toLowerCase()}.${name.last.toLowerCase()}@company.com`,\n                department: ['Engineering', 'Sales', 'Marketing', 'Operations', 'HR'][i],\n                position: ['Developer', 'Account Manager', 'Designer', 'Analyst', 'Coordinator'][i],\n                start_date: format(startDate, 'yyyy-MM-dd'),\n                onboarding_progress: progress,\n                status: progress >= 100 ? 'completed' : progress > 0 ? 'in_progress' : 'pending',\n            };\n        });\n    }\n\n    const filteredHires = newHires.filter(hire => {\n        if (filter !== 'all' && hire.status !== filter) return false;\n        if (searchQuery) {\n            const query = searchQuery.toLowerCase();\n            return (\n                hire.first_name.toLowerCase().includes(query) ||\n                hire.last_name.toLowerCase().includes(query) ||\n                hire.email.toLowerCase().includes(query) ||\n                hire.department.toLowerCase().includes(query)\n            );\n        }\n        return true;\n    });\n\n    const stats = {\n        total: newHires.length,\n        pending: newHires.filter(h => h.status === 'pending').length,\n        inProgress: newHires.filter(h => h.status === 'in_progress').length,\n        completed: newHires.filter(h => h.status === 'completed').length,\n    };\n\n    function getStatusColor(status: string) {\n        switch (status) {\n            case 'completed': return 'bg-green-100 text-green-700';\n            case 'in_progress': return 'bg-blue-100 text-blue-700';\n            case 'pending': return 'bg-yellow-100 text-yellow-700';\n            default: return 'bg-gray-100 text-gray-700';\n        }\n    }\n\n    function getDaysInfo(startDate: string): { days: number; label: string } {\n        const days = differenceInDays(new Date(), parseISO(startDate));\n        if (days === 0) return { days: 0, label: 'Starts today!' };\n        if (days < 0) return { days: Math.abs(days), label: `Starts in ${Math.abs(days)} days` };\n        return { days, label: `Day ${days}` };\n    }\n\n    if (loading) {\n        return (\n            <div className=\"flex items-center justify-center h-64\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600\" />\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-8\">\n            <div className=\"flex items-center justify-between\">\n                <div>\n                    <h1 className=\"text-3xl font-bold text-gray-900\">Employee Onboarding</h1>\n                    <p className=\"mt-1 text-sm text-gray-600\">Track and manage new hire onboarding progress</p>\n                </div>\n                <button className=\"inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition\">\n                    <Plus className=\"w-5 h-5 mr-2\" />\n                    Add New Hire\n                </button>\n            </div>\n\n            {/* Stats */}\n            <div className=\"grid grid-cols-4 gap-4\">\n                <div className=\"bg-white rounded-xl border border-gray-200 p-4\">\n                    <div className=\"flex items-center justify-between\">\n                        <div>\n                            <p className=\"text-sm text-gray-600\">Total New Hires</p>\n                            <p className=\"text-2xl font-bold text-gray-900\">{stats.total}</p>\n                        </div>\n                        <User className=\"w-8 h-8 text-gray-400\" />\n                    </div>\n                </div>\n                <div className=\"bg-white rounded-xl border border-gray-200 p-4\">\n                    <div className=\"flex items-center justify-between\">\n                        <div>\n                            <p className=\"text-sm text-gray-600\">Pending</p>\n                            <p className=\"text-2xl font-bold text-yellow-600\">{stats.pending}</p>\n                        </div>\n                        <Clock className=\"w-8 h-8 text-yellow-400\" />\n                    </div>\n                </div>\n                <div className=\"bg-white rounded-xl border border-gray-200 p-4\">\n                    <div className=\"flex items-center justify-between\">\n                        <div>\n                            <p className=\"text-sm text-gray-600\">In Progress</p>\n                            <p className=\"text-2xl font-bold text-blue-600\">{stats.inProgress}</p>\n                        </div>\n                        <AlertCircle className=\"w-8 h-8 text-blue-400\" />\n                    </div>\n                </div>\n                <div className=\"bg-white rounded-xl border border-gray-200 p-4\">\n                    <div className=\"flex items-center justify-between\">\n                        <div>\n                            <p className=\"text-sm text-gray-600\">Completed</p>\n                            <p className=\"text-2xl font-bold text-green-600\">{stats.completed}</p>\n                        </div>\n                        <CheckCircle className=\"w-8 h-8 text-green-400\" />\n                    </div>\n                </div>\n            </div>\n\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n                {/* New Hires List */}\n                <div className=\"bg-white rounded-xl border border-gray-200 overflow-hidden\">\n                    <div className=\"px-6 py-4 border-b border-gray-200\">\n                        <h2 className=\"font-semibold text-gray-900\">New Hires</h2>\n                        <div className=\"mt-3 relative\">\n                            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                            <input\n                                type=\"text\"\n                                value={searchQuery}\n                                onChange={(e) => setSearchQuery(e.target.value)}\n                                placeholder=\"Search...\"\n                                className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 outline-none\"\n                            />\n                        </div>\n                        <div className=\"mt-3 flex space-x-1\">\n                            {(['all', 'pending', 'in_progress', 'completed'] as const).map(f => (\n                                <button\n                                    key={f}\n                                    onClick={() => setFilter(f)}\n                                    className={`px-2 py-1 text-xs rounded-lg transition ${filter === f ? 'bg-indigo-100 text-indigo-700' : 'text-gray-600 hover:bg-gray-100'\n                                        }`}\n                                >\n                                    {f === 'in_progress' ? 'In Progress' : f.charAt(0).toUpperCase() + f.slice(1)}\n                                </button>\n                            ))}\n                        </div>\n                    </div>\n                    <div className=\"divide-y divide-gray-100 max-h-[600px] overflow-y-auto\">\n                        {filteredHires.map(hire => {\n                            const daysInfo = getDaysInfo(hire.start_date);\n                            return (\n                                <button\n                                    key={hire.id}\n                                    onClick={() => setSelectedHire(hire)}\n                                    className={`w-full flex items-center px-6 py-4 hover:bg-gray-50 transition ${selectedHire?.id === hire.id ? 'bg-indigo-50' : ''\n                                        }`}\n                                >\n                                    <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-semibold\">\n                                        {hire.first_name[0]}{hire.last_name[0]}\n                                    </div>\n                                    <div className=\"ml-3 flex-1 text-left\">\n                                        <p className=\"text-sm font-medium text-gray-900\">\n                                            {hire.first_name} {hire.last_name}\n                                        </p>\n                                        <p className=\"text-xs text-gray-500\">{hire.position}</p>\n                                        <div className=\"mt-1 flex items-center space-x-2\">\n                                            <span className={`px-2 py-0.5 text-xs rounded ${getStatusColor(hire.status)}`}>\n                                                {hire.status.replace('_', ' ')}\n                                            </span>\n                                            <span className=\"text-xs text-gray-400\">{daysInfo.label}</span>\n                                        </div>\n                                    </div>\n                                    <div className=\"text-right\">\n                                        <p className=\"text-lg font-bold text-indigo-600\">\n                                            {Math.round(hire.onboarding_progress)}%\n                                        </p>\n                                        <ChevronRight className=\"w-4 h-4 text-gray-400 ml-auto\" />\n                                    </div>\n                                </button>\n                            );\n                        })}\n                        {filteredHires.length === 0 && (\n                            <div className=\"px-6 py-12 text-center text-gray-500\">\n                                <User className=\"w-12 h-12 mx-auto mb-2 text-gray-300\" />\n                                <p>No new hires found</p>\n                            </div>\n                        )}\n                    </div>\n                </div>\n\n                {/* Onboarding Checklist */}\n                <div className=\"lg:col-span-2\">\n                    {selectedHire ? (\n                        <OnboardingChecklist\n                            employeeId={selectedHire.id}\n                            employeeName={`${selectedHire.first_name} ${selectedHire.last_name}`}\n                            startDate={selectedHire.start_date}\n                        />\n                    ) : (\n                        <div className=\"bg-white rounded-xl border border-gray-200 p-12 text-center\">\n                            <User className=\"w-16 h-16 mx-auto text-gray-300 mb-4\" />\n                            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Select a New Hire</h3>\n                            <p className=\"text-gray-500\">Choose a new hire from the list to view their onboarding checklist</p>\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/PerformancePage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle' is defined but never used. Allowed unused vars must match /^_/u.","line":15,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertCircle' is defined but never used. Allowed unused vars must match /^_/u.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Send' is defined but never used. Allowed unused vars must match /^_/u.","line":23,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Modal' is defined but never used. Allowed unused vars must match /^_/u.","line":26,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setKpiValues' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":95,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":95,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'kpiDefinitions' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":97,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":97,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'employees' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":98,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":98,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":103,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":103,"endColumn":15},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":121,"column":6,"nodeType":"ArrayExpression","endLine":121,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [activeTab, loadData]","fix":{"range":[3890,3901],"text":"[activeTab, loadData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase, supabaseUrl } from '@/lib/supabase';\nimport { useAuth } from '@/contexts/AuthContext';\nimport {\n  Plus,\n  Search,\n  Filter,\n  TrendingUp,\n  Target,\n  Award,\n  Settings,\n  BarChart,\n  Users,\n  Calendar,\n  CheckCircle,\n  AlertCircle,\n  Clock,\n  Star,\n  Edit,\n  Trash2,\n  Eye,\n  PlayCircle,\n  Send\n} from 'lucide-react';\nimport { format } from 'date-fns';\nimport Modal from '@/components/Modal';\nimport Toast from '@/components/Toast';\nimport PerformanceReports from '@/components/PerformanceReports';\nimport AddReviewTypeModal from '@/components/AddReviewTypeModal';\nimport { log } from '@/lib/logger';\nimport CreateReviewModal from '@/components/CreateReviewModal';\nimport AddGoalModal from '@/components/AddGoalModal';\nimport AddKPIModal from '@/components/AddKPIModal';\nimport AddCriteriaModal from '@/components/AddCriteriaModal';\nimport RateModal from '@/components/RateModal';\nimport ViewReviewModal from '@/components/ViewReviewModal';\n\ntype TabType = 'reviews' | 'goals' | 'kpis' | 'settings' | 'reports';\n\ninterface ReviewType {\n  id: string;\n  name: string;\n  description: string;\n  frequency: string;\n  auto_schedule: boolean;\n  requires_self_assessment: boolean;\n  requires_manager_review: boolean;\n  requires_peer_review: boolean;\n}\n\ninterface Review {\n  id: string;\n  review_type_id: string;\n  employee_id: string;\n  review_period_start: string;\n  review_period_end: string;\n  review_due_date: string;\n  status: string;\n  overall_rating: number;\n  review_type: { name: string; frequency: string };\n  employee: { first_name: string; last_name: string; email: string; department: string };\n}\n\ninterface Goal {\n  id: string;\n  employee_id: string;\n  title: string;\n  description: string;\n  goal_type: string;\n  target_date: string;\n  status: string;\n  progress_percentage: number;\n  priority: string;\n  employee: { first_name: string; last_name: string };\n}\n\ninterface KPIValue {\n  id: string;\n  kpi_definition_id: string;\n  employee_id: string;\n  period_start: string;\n  period_end: string;\n  target_value: number;\n  actual_value: number;\n  variance: number;\n  status: string;\n  kpi: { name: string; category: string; measurement_unit: string };\n  employee: { first_name: string; last_name: string };\n}\n\nexport default function PerformancePage() {\n  const [activeTab, setActiveTab] = useState<'reviews' | 'goals' | 'kpis' | 'settings' | 'reports'>('reviews');\n  const [reviews, setReviews] = useState<Review[]>([]);\n  const [goals, setGoals] = useState<Goal[]>([]);\n  const [kpiValues, setKpiValues] = useState<KPIValue[]>([]);\n  const [reviewTypes, setReviewTypes] = useState<ReviewType[]>([]);\n  const [kpiDefinitions, setKpiDefinitions] = useState<any[]>([]);\n  const [employees, setEmployees] = useState<any[]>([]);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [statusFilter, setStatusFilter] = useState('all');\n  const [loading, setLoading] = useState(false);\n  const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' | 'warning' } | null>(null);\n  const { user, profile } = useAuth();\n\n  // Modal states\n  const [showAddReviewTypeModal, setShowAddReviewTypeModal] = useState(false);\n  const [showCreateReviewModal, setShowCreateReviewModal] = useState(false);\n  const [showAddGoalModal, setShowAddGoalModal] = useState(false);\n  const [showAddKPIModal, setShowAddKPIModal] = useState(false);\n  const [showAddCriteriaModal, setShowAddCriteriaModal] = useState(false);\n  const [showRateModal, setShowRateModal] = useState(false);\n  const [showViewReviewModal, setShowViewReviewModal] = useState(false);\n  const [selectedItem, setSelectedItem] = useState<any>(null);\n\n  const userRole = profile?.role;\n  const isAdmin = ['admin', 'hr_manager', 'hr manager'].includes(userRole?.toLowerCase() || '');\n\n  useEffect(() => {\n    loadData();\n    loadSupportingData();\n  }, [activeTab]);\n\n  async function loadSupportingData() {\n    try {\n      // Load review types\n      const { data: reviewTypesData } = await supabase\n        .from('performance_review_types')\n        .select('*')\n        .eq('is_active', true)\n        .order('name');\n      setReviewTypes(reviewTypesData || []);\n\n      // Load KPI definitions\n      const { data: kpiDefsData } = await supabase\n        .from('kpi_definitions')\n        .select('*')\n        .eq('is_active', true)\n        .order('category');\n      setKpiDefinitions(kpiDefsData || []);\n\n      // Load employees\n      const { data: empData } = await supabase\n        .from('employees')\n        .select('id, first_name, last_name, email, department, position')\n        .eq('status', 'active')\n        .order('first_name');\n      setEmployees(empData || []);\n    } catch (error) {\n      log.error('Error loading supporting data', error, { component: 'PerformancePage', action: 'loadSupportingData' });\n    }\n  }\n\n  async function loadData() {\n    setLoading(true);\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n\n      switch (activeTab) {\n        case 'reviews':\n          const reviewResponse = await fetch(\n            `${supabaseUrl}/functions/v1/performance-crud`,\n            {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${session?.access_token}`,\n              },\n              body: JSON.stringify({\n                action: 'list',\n                entity: 'reviews',\n                filters: statusFilter !== 'all' ? { status: statusFilter } : {}\n              }),\n            }\n          );\n          const reviewData = await reviewResponse.json();\n          setReviews(Array.isArray(reviewData) ? reviewData : []);\n          break;\n\n        case 'goals':\n          const goalResponse = await fetch(\n            `${supabaseUrl}/functions/v1/performance-crud`,\n            {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${session?.access_token}`,\n              },\n              body: JSON.stringify({\n                action: 'list',\n                entity: 'goals',\n                filters: statusFilter !== 'all' ? { status: statusFilter } : {}\n              }),\n            }\n          );\n          const goalData = await goalResponse.json();\n          setGoals(Array.isArray(goalData) ? goalData : []);\n          break;\n\n        case 'kpis':\n          const kpiDefResponse = await fetch(\n            `${supabaseUrl}/functions/v1/performance-crud`,\n            {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${session?.access_token}`,\n              },\n              body: JSON.stringify({\n                action: 'list',\n                entity: 'kpi_definitions',\n              }),\n            }\n          );\n          const kpiDefData = await kpiDefResponse.json();\n          setKpiDefinitions(Array.isArray(kpiDefData) ? kpiDefData : []);\n          break;\n\n\n        case 'settings':\n          const typeResponse = await fetch(\n            `${supabaseUrl}/functions/v1/performance-crud`,\n            {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${session?.access_token}`,\n              },\n              body: JSON.stringify({\n                action: 'list',\n                entity: 'performance_review_types',\n              }),\n            }\n          );\n          const typeData = await typeResponse.json();\n          setReviewTypes(Array.isArray(typeData) ? typeData : []);\n          break;\n      }\n    } catch (error) {\n      log.error('Error loading data', error, { component: 'PerformancePage', action: 'loadData', metadata: { activeTab } });\n      setToast({ message: 'Failed to load data', type: 'error' });\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function handleAutoScheduleReviews() {\n    setLoading(true);\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n\n      const response = await fetch(\n        `${supabaseUrl}/functions/v1/performance-crud`,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${session?.access_token}`,\n          },\n          body: JSON.stringify({\n            action: 'auto_schedule',\n            entity: 'reviews',\n          }),\n        }\n      );\n\n      const result = await response.json();\n\n      if (result.error) {\n        throw new Error(result.error);\n      }\n\n      setToast({\n        message: `Successfully scheduled ${result.count} review(s)`,\n        type: 'success'\n      });\n      loadData();\n    } catch (error: any) {\n      setToast({ message: error.message, type: 'error' });\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  const getStatusBadge = (status: string) => {\n    const styles: Record<string, string> = {\n      pending: 'bg-yellow-100 text-yellow-800',\n      in_progress: 'bg-blue-100 text-blue-800',\n      completed: 'bg-green-100 text-green-800',\n      overdue: 'bg-red-100 text-red-800',\n      active: 'bg-green-100 text-green-800',\n      on_track: 'bg-green-100 text-green-800',\n      at_risk: 'bg-orange-100 text-orange-800',\n      achieved: 'bg-purple-100 text-purple-800',\n      not_achieved: 'bg-red-100 text-red-800',\n      on_target: 'bg-green-100 text-green-800',\n      below_target: 'bg-yellow-100 text-yellow-800',\n      needs_attention: 'bg-red-100 text-red-800',\n    };\n\n    return (\n      <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${styles[status] || 'bg-gray-100 text-gray-800'}`}>\n        {status.replace(/_/g, ' ')}\n      </span>\n    );\n  };\n\n  const getPriorityBadge = (priority: string) => {\n    const styles: Record<string, string> = {\n      low: 'bg-gray-100 text-gray-800',\n      medium: 'bg-blue-100 text-blue-800',\n      high: 'bg-orange-100 text-orange-800',\n      critical: 'bg-red-100 text-red-800',\n    };\n\n    return (\n      <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${styles[priority] || 'bg-gray-100 text-gray-800'}`}>\n        {priority}\n      </span>\n    );\n  };\n\n  const filteredReviews = reviews.filter(review =>\n    searchTerm === '' ||\n    review.employee?.first_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    review.employee?.last_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    review.review_type?.name?.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const filteredGoals = goals.filter(goal =>\n    searchTerm === '' ||\n    goal.title.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    goal.employee?.first_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    goal.employee?.last_name?.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const filteredKPIs = kpiValues.filter(kpi =>\n    searchTerm === '' ||\n    kpi.kpi?.name?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    kpi.employee?.first_name?.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const tabs = [\n    { id: 'reviews', label: 'Performance Reviews', icon: Award },\n    { id: 'goals', label: 'Goals & Objectives', icon: Target },\n    { id: 'kpis', label: 'KPIs', icon: TrendingUp },\n    { id: 'settings', label: 'Review Settings', icon: Settings },\n    { id: 'reports', label: 'Reports', icon: BarChart },\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <div className=\"bg-white border-b border-gray-200\">\n        <div className=\"px-6 py-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-3xl font-bold text-gray-900\">Performance Management</h1>\n              <p className=\"mt-1 text-sm text-gray-600\">\n                Track reviews, goals, and KPIs across your organization\n              </p>\n            </div>\n            {isAdmin && activeTab === 'reviews' && (\n              <button\n                onClick={handleAutoScheduleReviews}\n                disabled={loading}\n                className=\"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-gray-400\"\n              >\n                <PlayCircle className=\"h-5 w-5 mr-2\" />\n                Auto-Schedule Reviews\n              </button>\n            )}\n          </div>\n\n          {/* Tab Navigation */}\n          <div className=\"mt-6 border-b border-gray-200\">\n            <nav className=\"-mb-px flex space-x-8\">\n              {tabs.map((tab) => (\n                <button\n                  key={tab.id}\n                  onClick={() => {\n                    setActiveTab(tab.id as TabType);\n                    setSearchTerm('');\n                    setStatusFilter('all');\n                  }}\n                  className={`${activeTab === tab.id\n                    ? 'border-indigo-500 text-indigo-600'\n                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                    } whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm inline-flex items-center`}\n                >\n                  <tab.icon className=\"h-5 w-5 mr-2\" />\n                  {tab.label}\n                </button>\n              ))}\n            </nav>\n          </div>\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className=\"px-6 py-6\">\n        {/* Search and Filters */}\n        {activeTab !== 'reports' && (\n          <div className=\"mb-6 flex items-center justify-between bg-white p-4 rounded-lg shadow\">\n            <div className=\"flex-1 max-w-lg\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400\" />\n                <input\n                  type=\"text\"\n                  placeholder=\"Search...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500\"\n                />\n              </div>\n            </div>\n\n            {activeTab !== 'settings' && (\n              <div className=\"ml-4 flex items-center space-x-3\">\n                <Filter className=\"h-5 w-5 text-gray-400\" />\n                <select\n                  value={statusFilter}\n                  onChange={(e) => setStatusFilter(e.target.value)}\n                  className=\"border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-indigo-500 focus:border-indigo-500\"\n                >\n                  <option value=\"all\">All Status</option>\n                  {activeTab === 'reviews' && (\n                    <>\n                      <option value=\"pending\">Pending</option>\n                      <option value=\"in_progress\">In Progress</option>\n                      <option value=\"completed\">Completed</option>\n                      <option value=\"overdue\">Overdue</option>\n                    </>\n                  )}\n                  {activeTab === 'goals' && (\n                    <>\n                      <option value=\"active\">Active</option>\n                      <option value=\"on_track\">On Track</option>\n                      <option value=\"at_risk\">At Risk</option>\n                      <option value=\"achieved\">Achieved</option>\n                      <option value=\"not_achieved\">Not Achieved</option>\n                    </>\n                  )}\n                </select>\n\n                {isAdmin && (\n                  <button\n                    onClick={() => {\n                      if (activeTab === 'reviews') setShowCreateReviewModal(true);\n                      if (activeTab === 'goals') setShowAddGoalModal(true);\n                      if (activeTab === 'kpis') setShowAddKPIModal(true);\n                    }}\n                    className=\"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700\"\n                  >\n                    <Plus className=\"h-5 w-5 mr-2\" />\n                    Add New\n                  </button>\n                )}\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* Reviews Tab */}\n        {activeTab === 'reviews' && (\n          <div className=\"bg-white shadow rounded-lg overflow-hidden\">\n            <table className=\"min-w-full divide-y divide-gray-200\">\n              <thead className=\"bg-gray-50\">\n                <tr>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Employee\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Review Type\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Period\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Due Date\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Status\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Rating\n                  </th>\n                  <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Actions\n                  </th>\n                </tr>\n              </thead>\n              <tbody className=\"bg-white divide-y divide-gray-200\">\n                {loading ? (\n                  <tr>\n                    <td colSpan={7} className=\"px-6 py-12 text-center text-gray-500\">\n                      Loading...\n                    </td>\n                  </tr>\n                ) : filteredReviews.length > 0 ? (\n                  filteredReviews.map((review) => (\n                    <tr key={review.id} className=\"hover:bg-gray-50\">\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div className=\"flex items-center\">\n                          <div className=\"flex-shrink-0 h-10 w-10 bg-indigo-100 rounded-full flex items-center justify-center\">\n                            <Users className=\"h-5 w-5 text-indigo-600\" />\n                          </div>\n                          <div className=\"ml-4\">\n                            <div className=\"text-sm font-medium text-gray-900\">\n                              {review.employee?.first_name} {review.employee?.last_name}\n                            </div>\n                            <div className=\"text-sm text-gray-500\">{review.employee?.department}</div>\n                          </div>\n                        </div>\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div className=\"text-sm text-gray-900\">{review.review_type?.name}</div>\n                        <div className=\"text-sm text-gray-500\">{review.review_type?.frequency}</div>\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                        {format(new Date(review.review_period_start), 'MMM d, yyyy')} -<br />\n                        {format(new Date(review.review_period_end), 'MMM d, yyyy')}\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                        {format(new Date(review.review_due_date), 'MMM d, yyyy')}\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        {getStatusBadge(review.status)}\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        {review.overall_rating ? (\n                          <div className=\"flex items-center\">\n                            <Star className=\"h-4 w-4 text-yellow-400 fill-current mr-1\" />\n                            <span className=\"text-sm font-medium text-gray-900\">\n                              {review.overall_rating.toFixed(1)}\n                            </span>\n                          </div>\n                        ) : (\n                          <span className=\"text-sm text-gray-400\">Not rated</span>\n                        )}\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                        <button\n                          onClick={() => {\n                            setSelectedItem(review);\n                            setShowViewReviewModal(true);\n                          }}\n                          className=\"text-indigo-600 hover:text-indigo-900 mr-3\"\n                        >\n                          <Eye className=\"h-5 w-5\" />\n                        </button>\n                        {review.status !== 'completed' && (\n                          <button\n                            onClick={() => {\n                              setSelectedItem(review);\n                              setShowRateModal(true);\n                            }}\n                            className=\"text-green-600 hover:text-green-900 mr-3\"\n                          >\n                            <Star className=\"h-5 w-5\" />\n                          </button>\n                        )}\n                        {isAdmin && (\n                          <button\n                            onClick={() => {/* handle delete */ }}\n                            className=\"text-red-600 hover:text-red-900\"\n                          >\n                            <Trash2 className=\"h-5 w-5\" />\n                          </button>\n                        )}\n                      </td>\n                    </tr>\n                  ))\n                ) : (\n                  <tr>\n                    <td colSpan={7} className=\"px-6 py-12 text-center text-gray-500\">\n                      No reviews found\n                    </td>\n                  </tr>\n                )}\n              </tbody>\n            </table>\n          </div>\n        )}\n\n        {/* Goals Tab */}\n        {activeTab === 'goals' && (\n          <div className=\"grid grid-cols-1 gap-6\">\n            {loading ? (\n              <div className=\"bg-white shadow rounded-lg p-12 text-center text-gray-500\">\n                Loading...\n              </div>\n            ) : filteredGoals.length > 0 ? (\n              filteredGoals.map((goal) => (\n                <div key={goal.id} className=\"bg-white shadow rounded-lg overflow-hidden\">\n                  <div className=\"px-6 py-4\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center space-x-3\">\n                          <Target className=\"h-6 w-6 text-indigo-600\" />\n                          <h3 className=\"text-lg font-medium text-gray-900\">{goal.title}</h3>\n                          {getPriorityBadge(goal.priority)}\n                          {getStatusBadge(goal.status)}\n                        </div>\n                        <p className=\"mt-2 text-sm text-gray-600\">{goal.description}</p>\n                        <div className=\"mt-3 flex items-center space-x-6 text-sm text-gray-500\">\n                          <span className=\"flex items-center\">\n                            <Users className=\"h-4 w-4 mr-1\" />\n                            {goal.employee?.first_name} {goal.employee?.last_name}\n                          </span>\n                          <span className=\"flex items-center\">\n                            <Calendar className=\"h-4 w-4 mr-1\" />\n                            Target: {format(new Date(goal.target_date), 'MMM d, yyyy')}\n                          </span>\n                          <span className=\"capitalize\">{goal.goal_type} goal</span>\n                        </div>\n                      </div>\n                      <div className=\"ml-4 flex items-center space-x-2\">\n                        <button\n                          onClick={() => {/* handle edit */ }}\n                          className=\"text-indigo-600 hover:text-indigo-900\"\n                        >\n                          <Edit className=\"h-5 w-5\" />\n                        </button>\n                        <button\n                          onClick={() => {/* handle delete */ }}\n                          className=\"text-red-600 hover:text-red-900\"\n                        >\n                          <Trash2 className=\"h-5 w-5\" />\n                        </button>\n                      </div>\n                    </div>\n\n                    {/* Progress Bar */}\n                    <div className=\"mt-4\">\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <span className=\"text-sm font-medium text-gray-700\">Progress</span>\n                        <span className=\"text-sm font-semibold text-gray-900\">{goal.progress_percentage}%</span>\n                      </div>\n                      <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                        <div\n                          className={`h-2 rounded-full ${goal.progress_percentage >= 75\n                            ? 'bg-green-600'\n                            : goal.progress_percentage >= 50\n                              ? 'bg-yellow-500'\n                              : 'bg-red-500'\n                            }`}\n                          style={{ width: `${goal.progress_percentage}%` }}\n                        ></div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              ))\n            ) : (\n              <div className=\"bg-white shadow rounded-lg p-12 text-center text-gray-500\">\n                No goals found\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* KPIs Tab */}\n        {activeTab === 'kpis' && (\n          <div className=\"bg-white shadow rounded-lg overflow-hidden\">\n            <table className=\"min-w-full divide-y divide-gray-200\">\n              <thead className=\"bg-gray-50\">\n                <tr>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    KPI Name\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Employee/Department\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Period\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Target\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Actual\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Variance\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Status\n                  </th>\n                  <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Actions\n                  </th>\n                </tr>\n              </thead>\n              <tbody className=\"bg-white divide-y divide-gray-200\">\n                {loading ? (\n                  <tr>\n                    <td colSpan={8} className=\"px-6 py-12 text-center text-gray-500\">\n                      Loading...\n                    </td>\n                  </tr>\n                ) : filteredKPIs.length > 0 ? (\n                  filteredKPIs.map((kpi) => (\n                    <tr key={kpi.id} className=\"hover:bg-gray-50\">\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div className=\"text-sm font-medium text-gray-900\">{kpi.kpi?.name}</div>\n                        <div className=\"text-sm text-gray-500\">{kpi.kpi?.category}</div>\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                        {kpi.employee ? (\n                          `${kpi.employee.first_name} ${kpi.employee.last_name}`\n                        ) : (\n                          'Department-wide'\n                        )}\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                        {format(new Date(kpi.period_start), 'MMM yyyy')} -<br />\n                        {format(new Date(kpi.period_end), 'MMM yyyy')}\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                        {kpi.target_value} {kpi.kpi?.measurement_unit}\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium\">\n                        {kpi.actual_value} {kpi.kpi?.measurement_unit}\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <span className={`text-sm font-medium ${kpi.variance >= 0 ? 'text-green-600' : 'text-red-600'}`}>\n                          {kpi.variance >= 0 ? '+' : ''}{kpi.variance}\n                        </span>\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        {getStatusBadge(kpi.status)}\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                        <button\n                          onClick={() => {/* handle edit */ }}\n                          className=\"text-indigo-600 hover:text-indigo-900 mr-3\"\n                        >\n                          <Edit className=\"h-5 w-5\" />\n                        </button>\n                        {isAdmin && (\n                          <button\n                            onClick={() => {/* handle delete */ }}\n                            className=\"text-red-600 hover:text-red-900\"\n                          >\n                            <Trash2 className=\"h-5 w-5\" />\n                          </button>\n                        )}\n                      </td>\n                    </tr>\n                  ))\n                ) : (\n                  <tr>\n                    <td colSpan={8} className=\"px-6 py-12 text-center text-gray-500\">\n                      No KPI values found\n                    </td>\n                  </tr>\n                )}\n              </tbody>\n            </table>\n          </div>\n        )}\n\n        {/* Settings Tab */}\n        {activeTab === 'settings' && (\n          <div className=\"space-y-6\">\n            {reviewTypes.map((reviewType) => (\n              <div key={reviewType.id} className=\"bg-white shadow rounded-lg overflow-hidden\">\n                <div className=\"px-6 py-4\">\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center space-x-3\">\n                        <Award className=\"h-6 w-6 text-indigo-600\" />\n                        <h3 className=\"text-lg font-medium text-gray-900\">{reviewType.name}</h3>\n                        {reviewType.auto_schedule && (\n                          <span className=\"inline-flex items-center px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800\">\n                            <Clock className=\"h-3 w-3 mr-1\" />\n                            Auto-scheduled\n                          </span>\n                        )}\n                      </div>\n                      <p className=\"mt-2 text-sm text-gray-600\">{reviewType.description}</p>\n                      <div className=\"mt-3 flex flex-wrap gap-4 text-sm text-gray-500\">\n                        <span className=\"capitalize\">{reviewType.frequency}</span>\n                        {reviewType.requires_self_assessment && <span>â¢ Self-assessment</span>}\n                        {reviewType.requires_manager_review && <span>â¢ Manager review</span>}\n                        {reviewType.requires_peer_review && <span>â¢ Peer review</span>}\n                      </div>\n                    </div>\n                    {isAdmin && (\n                      <div className=\"ml-4 flex items-center space-x-2\">\n                        <button\n                          onClick={() => {\n                            setSelectedItem(reviewType);\n                            setShowAddCriteriaModal(true);\n                          }}\n                          className=\"text-blue-600 hover:text-blue-900\"\n                        >\n                          <Plus className=\"h-5 w-5\" />\n                        </button>\n                        <button\n                          onClick={() => {/* handle edit */ }}\n                          className=\"text-indigo-600 hover:text-indigo-900\"\n                        >\n                          <Edit className=\"h-5 w-5\" />\n                        </button>\n                        <button\n                          onClick={() => {/* handle delete */ }}\n                          className=\"text-red-600 hover:text-red-900\"\n                        >\n                          <Trash2 className=\"h-5 w-5\" />\n                        </button>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n\n        {/* Reports Tab */}\n        {activeTab === 'reports' && (\n          <PerformanceReports />\n        )}\n      </div>\n\n      {/* Toast Notifications */}\n      {toast && (\n        <Toast\n          message={toast.message}\n          type={toast.type}\n          onClose={() => setToast(null)}\n        />\n      )}\n\n      {/* Modals */}\n      <AddReviewTypeModal\n        isOpen={showAddReviewTypeModal}\n        onClose={() => setShowAddReviewTypeModal(false)}\n        onSuccess={() => {\n          loadSupportingData();\n          setToast({ message: 'Review type added successfully', type: 'success' });\n        }}\n        onError={(msg) => setToast({ message: msg, type: 'error' })}\n      />\n\n      <CreateReviewModal\n        isOpen={showCreateReviewModal}\n        onClose={() => setShowCreateReviewModal(false)}\n        onSuccess={() => {\n          loadData();\n          setToast({ message: 'Review created successfully', type: 'success' });\n        }}\n        onError={(msg) => setToast({ message: msg, type: 'error' })}\n      />\n\n      <AddGoalModal\n        isOpen={showAddGoalModal}\n        onClose={() => setShowAddGoalModal(false)}\n        onSuccess={() => {\n          loadData();\n          setToast({ message: 'Goal added successfully', type: 'success' });\n        }}\n        onError={(msg) => setToast({ message: msg, type: 'error' })}\n      />\n\n      <AddKPIModal\n        isOpen={showAddKPIModal}\n        onClose={() => setShowAddKPIModal(false)}\n        onSuccess={() => {\n          loadData();\n          setToast({ message: 'KPI target added successfully', type: 'success' });\n        }}\n        onError={(msg) => setToast({ message: msg, type: 'error' })}\n      />\n\n      {selectedItem && (\n        <>\n          <AddCriteriaModal\n            isOpen={showAddCriteriaModal}\n            onClose={() => {\n              setShowAddCriteriaModal(false);\n              setSelectedItem(null);\n            }}\n            onSuccess={() => {\n              setToast({ message: 'Criteria added successfully', type: 'success' });\n            }}\n            onError={(msg) => setToast({ message: msg, type: 'error' })}\n            reviewType={selectedItem}\n          />\n\n          <RateModal\n            isOpen={showRateModal}\n            onClose={() => {\n              setShowRateModal(false);\n              setSelectedItem(null);\n            }}\n            onSuccess={() => {\n              loadData();\n              setToast({ message: 'Rating submitted successfully', type: 'success' });\n            }}\n            onError={(msg) => setToast({ message: msg, type: 'error' })}\n            review={selectedItem}\n          />\n\n          <ViewReviewModal\n            isOpen={showViewReviewModal}\n            onClose={() => {\n              setShowViewReviewModal(false);\n              setSelectedItem(null);\n            }}\n            review={selectedItem}\n          />\n        </>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/PerformancePageRefactored.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":68,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":68,"endColumn":15},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadReviewTypes'. Either include it or remove the dependency array.","line":77,"column":6,"nodeType":"ArrayExpression","endLine":77,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [activeTab, loadReviewTypes]","fix":{"range":[2877,2888],"text":"[activeTab, loadReviewTypes]"}}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":443,"column":41,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":443,"endColumn":64}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * PerformancePage - Refactored Version\n * \n * Uses the new component-based architecture with React Query hooks\n * Significantly reduced from ~900 lines to ~350 lines\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { supabase, supabaseUrl } from '@/lib/supabase';\nimport { useAuth } from '@/contexts/AuthContext';\nimport {\n  Plus,\n  Search,\n  Filter,\n  TrendingUp,\n  Target,\n  Award,\n  Settings,\n  BarChart,\n  PlayCircle,\n} from 'lucide-react';\nimport Toast from '@/components/Toast';\nimport PerformanceReports from '@/components/PerformanceReports';\nimport AddReviewTypeModal from '@/components/AddReviewTypeModal';\nimport CreateReviewModal from '@/components/CreateReviewModal';\nimport AddGoalModal from '@/components/AddGoalModal';\nimport AddKPIModal from '@/components/AddKPIModal';\nimport AddCriteriaModal from '@/components/AddCriteriaModal';\nimport RateModal from '@/components/RateModal';\nimport ViewReviewModal from '@/components/ViewReviewModal';\nimport { ReviewsTable, GoalsList, KPIsTable } from '@/components/performance';\nimport { PerformanceReview, PerformanceGoal, KPIDefinition } from '@/hooks';\nimport { log } from '@/lib/logger';\n\ntype TabType = 'reviews' | 'goals' | 'kpis' | 'settings' | 'reports';\n\ninterface ReviewType {\n  id: string;\n  name: string;\n  description: string;\n  frequency: string;\n  auto_schedule: boolean;\n  requires_self_assessment: boolean;\n  requires_manager_review: boolean;\n  requires_peer_review: boolean;\n}\n\nexport default function PerformancePageRefactored() {\n  const [activeTab, setActiveTab] = useState<TabType>('reviews');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [statusFilter, setStatusFilter] = useState('all');\n  const [loading, setLoading] = useState(false);\n  const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' | 'warning' } | null>(null);\n  \n  // Review types for settings tab (loaded separately)\n  const [reviewTypes, setReviewTypes] = useState<ReviewType[]>([]);\n  \n  // Modal states\n  const [showAddReviewTypeModal, setShowAddReviewTypeModal] = useState(false);\n  const [showCreateReviewModal, setShowCreateReviewModal] = useState(false);\n  const [showAddGoalModal, setShowAddGoalModal] = useState(false);\n  const [showAddKPIModal, setShowAddKPIModal] = useState(false);\n  const [showAddCriteriaModal, setShowAddCriteriaModal] = useState(false);\n  const [showRateModal, setShowRateModal] = useState(false);\n  const [showViewReviewModal, setShowViewReviewModal] = useState(false);\n  const [selectedItem, setSelectedItem] = useState<any>(null);\n  \n  const { user, profile } = useAuth();\n  const userRole = profile?.role;\n  const isAdmin = ['admin', 'hr_manager', 'hr manager'].includes(userRole?.toLowerCase() || '');\n\n  // Load review types for settings tab\n  useEffect(() => {\n    if (activeTab === 'settings') {\n      loadReviewTypes();\n    }\n  }, [activeTab]);\n\n  async function loadReviewTypes() {\n    setLoading(true);\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      \n      const response = await fetch(\n        `${supabaseUrl}/functions/v1/performance-crud`,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${session?.access_token}`,\n          },\n          body: JSON.stringify({\n            action: 'list',\n            entity: 'performance_review_types',\n          }),\n        }\n      );\n      \n      const data = await response.json();\n      setReviewTypes(Array.isArray(data) ? data : []);\n    } catch (error) {\n      log.error('Failed to load review types', { error });\n      showError('Failed to load review types');\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function handleAutoScheduleReviews() {\n    setLoading(true);\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n\n      const response = await fetch(\n        `${supabaseUrl}/functions/v1/performance-crud`,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${session?.access_token}`,\n          },\n          body: JSON.stringify({\n            action: 'auto_schedule',\n            entity: 'reviews',\n          }),\n        }\n      );\n\n      const result = await response.json();\n\n      if (result.error) {\n        throw new Error(result.error);\n      }\n\n      showSuccess(`Successfully scheduled ${result.count} review(s)`);\n    } catch (error: any) {\n      showError(error.message);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  // Toast handlers\n  const showSuccess = (message: string) => setToast({ message, type: 'success' });\n  const showError = (message: string) => setToast({ message, type: 'error' });\n\n  // Review handlers\n  const handleViewReview = (review: PerformanceReview) => {\n    setSelectedItem(review);\n    setShowViewReviewModal(true);\n  };\n\n  const handleRateReview = (review: PerformanceReview) => {\n    setSelectedItem(review);\n    setShowRateModal(true);\n  };\n\n  // Goal handlers\n  const handleEditGoal = (goal: PerformanceGoal) => {\n    setSelectedItem(goal);\n    setShowAddGoalModal(true);\n  };\n\n  // KPI handlers\n  const handleEditKPI = (kpi: KPIDefinition) => {\n    setSelectedItem(kpi);\n    setShowAddKPIModal(true);\n  };\n\n  // Tab configuration\n  const tabs = [\n    { id: 'reviews', label: 'Performance Reviews', icon: Award },\n    { id: 'goals', label: 'Goals & Objectives', icon: Target },\n    { id: 'kpis', label: 'KPIs', icon: TrendingUp },\n    { id: 'settings', label: 'Review Settings', icon: Settings },\n    { id: 'reports', label: 'Reports', icon: BarChart },\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <div className=\"bg-white border-b border-gray-200\">\n        <div className=\"px-6 py-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-3xl font-bold text-gray-900\">Performance Management</h1>\n              <p className=\"mt-1 text-sm text-gray-600\">\n                Track reviews, goals, and KPIs across your organization\n              </p>\n            </div>\n            {isAdmin && activeTab === 'reviews' && (\n              <button\n                onClick={handleAutoScheduleReviews}\n                disabled={loading}\n                className=\"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-gray-400\"\n              >\n                <PlayCircle className=\"h-5 w-5 mr-2\" />\n                Auto-Schedule Reviews\n              </button>\n            )}\n          </div>\n\n          {/* Tab Navigation */}\n          <div className=\"mt-6 border-b border-gray-200\">\n            <nav className=\"-mb-px flex space-x-8\">\n              {tabs.map((tab) => (\n                <button\n                  key={tab.id}\n                  onClick={() => {\n                    setActiveTab(tab.id as TabType);\n                    setSearchTerm('');\n                    setStatusFilter('all');\n                  }}\n                  className={`${\n                    activeTab === tab.id\n                      ? 'border-indigo-500 text-indigo-600'\n                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                  } whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm inline-flex items-center`}\n                >\n                  <tab.icon className=\"h-5 w-5 mr-2\" />\n                  {tab.label}\n                </button>\n              ))}\n            </nav>\n          </div>\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className=\"px-6 py-6\">\n        {/* Search and Filters */}\n        {activeTab !== 'reports' && activeTab !== 'settings' && (\n          <div className=\"mb-6 flex items-center justify-between bg-white p-4 rounded-lg shadow\">\n            <div className=\"flex-1 max-w-lg\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400\" />\n                <input\n                  type=\"text\"\n                  placeholder=\"Search...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500\"\n                />\n              </div>\n            </div>\n\n            <div className=\"ml-4 flex items-center space-x-3\">\n              <Filter className=\"h-5 w-5 text-gray-400\" />\n              <select\n                value={statusFilter}\n                onChange={(e) => setStatusFilter(e.target.value)}\n                className=\"border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-indigo-500 focus:border-indigo-500\"\n              >\n                <option value=\"all\">All Status</option>\n                {activeTab === 'reviews' && (\n                  <>\n                    <option value=\"pending\">Pending</option>\n                    <option value=\"in_progress\">In Progress</option>\n                    <option value=\"completed\">Completed</option>\n                    <option value=\"overdue\">Overdue</option>\n                  </>\n                )}\n                {activeTab === 'goals' && (\n                  <>\n                    <option value=\"active\">Active</option>\n                    <option value=\"on_track\">On Track</option>\n                    <option value=\"at_risk\">At Risk</option>\n                    <option value=\"achieved\">Achieved</option>\n                    <option value=\"not_achieved\">Not Achieved</option>\n                  </>\n                )}\n              </select>\n\n              {isAdmin && (\n                <button\n                  onClick={() => {\n                    if (activeTab === 'reviews') setShowCreateReviewModal(true);\n                    if (activeTab === 'goals') setShowAddGoalModal(true);\n                    if (activeTab === 'kpis') setShowAddKPIModal(true);\n                  }}\n                  className=\"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700\"\n                >\n                  <Plus className=\"h-5 w-5 mr-2\" />\n                  Add New\n                </button>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Reviews Tab */}\n        {activeTab === 'reviews' && (\n          <ReviewsTable\n            searchTerm={searchTerm}\n            statusFilter={statusFilter}\n            isAdmin={isAdmin}\n            onAddNew={() => setShowCreateReviewModal(true)}\n            onView={handleViewReview}\n            onRate={handleRateReview}\n            onSuccess={showSuccess}\n            onError={showError}\n          />\n        )}\n\n        {/* Goals Tab */}\n        {activeTab === 'goals' && (\n          <GoalsList\n            searchTerm={searchTerm}\n            statusFilter={statusFilter}\n            isAdmin={isAdmin}\n            onAddNew={() => setShowAddGoalModal(true)}\n            onEdit={handleEditGoal}\n            onSuccess={showSuccess}\n            onError={showError}\n          />\n        )}\n\n        {/* KPIs Tab */}\n        {activeTab === 'kpis' && (\n          <KPIsTable\n            searchTerm={searchTerm}\n            isAdmin={isAdmin}\n            onAddNew={() => setShowAddKPIModal(true)}\n            onEdit={handleEditKPI}\n            onSuccess={showSuccess}\n            onError={showError}\n          />\n        )}\n\n        {/* Settings Tab - Review Types */}\n        {activeTab === 'settings' && (\n          <ReviewTypeSettings\n            reviewTypes={reviewTypes}\n            loading={loading}\n            isAdmin={isAdmin}\n            onAddCriteria={(reviewType) => {\n              setSelectedItem(reviewType);\n              setShowAddCriteriaModal(true);\n            }}\n          />\n        )}\n\n        {/* Reports Tab */}\n        {activeTab === 'reports' && (\n          <PerformanceReports />\n        )}\n      </div>\n\n      {/* Toast Notifications */}\n      {toast && (\n        <Toast\n          message={toast.message}\n          type={toast.type}\n          onClose={() => setToast(null)}\n        />\n      )}\n\n      {/* Modals */}\n      <AddReviewTypeModal\n        isOpen={showAddReviewTypeModal}\n        onClose={() => setShowAddReviewTypeModal(false)}\n        onSuccess={() => {\n          loadReviewTypes();\n          showSuccess('Review type added successfully');\n        }}\n        onError={showError}\n      />\n\n      <CreateReviewModal\n        isOpen={showCreateReviewModal}\n        onClose={() => setShowCreateReviewModal(false)}\n        onSuccess={() => showSuccess('Review created successfully')}\n        onError={showError}\n      />\n\n      <AddGoalModal\n        isOpen={showAddGoalModal}\n        onClose={() => {\n          setShowAddGoalModal(false);\n          setSelectedItem(null);\n        }}\n        onSuccess={() => showSuccess('Goal added successfully')}\n        onError={showError}\n      />\n\n      <AddKPIModal\n        isOpen={showAddKPIModal}\n        onClose={() => {\n          setShowAddKPIModal(false);\n          setSelectedItem(null);\n        }}\n        onSuccess={() => showSuccess('KPI added successfully')}\n        onError={showError}\n      />\n\n      {selectedItem && (\n        <>\n          <AddCriteriaModal\n            isOpen={showAddCriteriaModal}\n            onClose={() => {\n              setShowAddCriteriaModal(false);\n              setSelectedItem(null);\n            }}\n            onSuccess={() => showSuccess('Criteria added successfully')}\n            onError={showError}\n            reviewType={selectedItem}\n          />\n\n          <RateModal\n            isOpen={showRateModal}\n            onClose={() => {\n              setShowRateModal(false);\n              setSelectedItem(null);\n            }}\n            onSuccess={() => showSuccess('Rating submitted successfully')}\n            onError={showError}\n            review={selectedItem}\n          />\n\n          <ViewReviewModal\n            isOpen={showViewReviewModal}\n            onClose={() => {\n              setShowViewReviewModal(false);\n              setSelectedItem(null);\n            }}\n            review={selectedItem}\n          />\n        </>\n      )}\n    </div>\n  );\n}\n\n// Review Type Settings Component\ninterface ReviewTypeSettingsProps {\n  reviewTypes: ReviewType[];\n  loading: boolean;\n  isAdmin: boolean;\n  onAddCriteria: (reviewType: ReviewType) => void;\n}\n\nfunction ReviewTypeSettings({ reviewTypes, loading, isAdmin, onAddCriteria }: ReviewTypeSettingsProps) {\n  const { Clock, Edit, Trash2, Plus } = require('lucide-react');\n\n  if (loading) {\n    return (\n      <div className=\"bg-white shadow rounded-lg p-12 text-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {reviewTypes.map((reviewType) => (\n        <div key={reviewType.id} className=\"bg-white shadow rounded-lg overflow-hidden\">\n          <div className=\"px-6 py-4\">\n            <div className=\"flex items-start justify-between\">\n              <div className=\"flex-1\">\n                <div className=\"flex items-center space-x-3\">\n                  <Award className=\"h-6 w-6 text-indigo-600\" />\n                  <h3 className=\"text-lg font-medium text-gray-900\">{reviewType.name}</h3>\n                  {reviewType.auto_schedule && (\n                    <span className=\"inline-flex items-center px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800\">\n                      <Clock className=\"h-3 w-3 mr-1\" />\n                      Auto-scheduled\n                    </span>\n                  )}\n                </div>\n                <p className=\"mt-2 text-sm text-gray-600\">{reviewType.description}</p>\n                <div className=\"mt-3 flex flex-wrap gap-4 text-sm text-gray-500\">\n                  <span className=\"capitalize\">{reviewType.frequency}</span>\n                  {reviewType.requires_self_assessment && <span>â¢ Self-assessment</span>}\n                  {reviewType.requires_manager_review && <span>â¢ Manager review</span>}\n                  {reviewType.requires_peer_review && <span>â¢ Peer review</span>}\n                </div>\n              </div>\n              {isAdmin && (\n                <div className=\"ml-4 flex items-center space-x-2\">\n                  <button\n                    onClick={() => onAddCriteria(reviewType)}\n                    className=\"text-blue-600 hover:text-blue-900\"\n                    title=\"Add Criteria\"\n                  >\n                    <Plus className=\"h-5 w-5\" />\n                  </button>\n                  <button\n                    onClick={() => {/* handle edit */}}\n                    className=\"text-indigo-600 hover:text-indigo-900\"\n                    title=\"Edit\"\n                  >\n                    <Edit className=\"h-5 w-5\" />\n                  </button>\n                  <button\n                    onClick={() => {/* handle delete */}}\n                    className=\"text-red-600 hover:text-red-900\"\n                    title=\"Delete\"\n                  >\n                    <Trash2 className=\"h-5 w-5\" />\n                  </button>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/PrivacyPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/RecruitSettingsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Users' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":57},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Save' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":79,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":83},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadChecklists', 'loadCriteria', and 'loadFormTemplates'. Either include them or remove the dependency array.","line":47,"column":6,"nodeType":"ArrayExpression","endLine":47,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [activeTab, loadChecklists, loadCriteria, loadFormTemplates]","fix":{"range":[2017,2028],"text":"[activeTab, loadChecklists, loadCriteria, loadFormTemplates]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":50,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":50,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":63,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":63,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":76,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":76,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":107,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":107,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":124,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":124,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { Settings, Sliders, CheckSquare, FileText, Users, Plus, Edit, Trash2, Save } from 'lucide-react';\nimport Toast from '@/components/Toast';\nimport Modal from '@/components/Modal';\nimport { useTenant } from '@/contexts/TenantContext';\nimport FormBuilder, { FormField } from '@/components/FormBuilder/FormBuilder';\nimport WorkflowEditor from '@/components/WorkflowEditor';\n\ntype TabType = 'general' | 'workflows' | 'forms' | 'criteria' | 'checklists';\n\nexport default function RecruitSettingsPage() {\n  const { currentTenant } = useTenant();\n  const [activeTab, setActiveTab] = useState<TabType>('general');\n  const [loading, setLoading] = useState(false);\n  const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' } | null>(null);\n  const [activeModal, setActiveModal] = useState<'criterion' | 'checklist' | null>(null);\n  const [editingItem, setEditingItem] = useState<any>(null);\n\n  // DB State\n  const [settings, setSettings] = useState<any>(null);\n  const [criteria, setCriteria] = useState<any[]>([]);\n  const [checklists, setChecklists] = useState<any[]>([]);\n\n  // Form Builder State\n  const [formTemplates, setFormTemplates] = useState<any[]>([]);\n  const [selectedFormId, setSelectedFormId] = useState<string | null>(null);\n  const selectedForm = formTemplates.find(f => f.id === selectedFormId);\n\n  // Workflow State\n  const [workflows, setWorkflows] = useState<any[]>([]);\n  const [editingWorkflowId, setEditingWorkflowId] = useState<string | null>(null);\n  const [isEditingWorkflow, setIsEditingWorkflow] = useState(false);\n\n  useEffect(() => {\n    if (activeTab === 'general') {\n      loadSettings();\n    } else if (activeTab === 'forms') {\n      loadFormTemplates();\n    } else if (activeTab === 'workflows') {\n      loadWorkflows();\n    } else if (activeTab === 'criteria') {\n      loadCriteria();\n    } else if (activeTab === 'checklists') {\n      loadChecklists();\n    }\n  }, [activeTab]);\n\n  async function loadSettings() {\n    const { data, error } = await supabase\n      .from('recruitment_settings')\n      .select('*')\n      .single();\n\n    if (data) {\n      setSettings(data);\n    }\n  }\n\n  async function loadCriteria() {\n    if (!currentTenant) return;\n    setLoading(true);\n    const { data, error } = await supabase\n      .from('evaluation_criteria_templates')\n      .select('*')\n      .eq('tenant_id', currentTenant.id)\n      .order('weight', { ascending: false });\n\n    if (data) setCriteria(data);\n    setLoading(false);\n  }\n\n  async function loadChecklists() {\n    if (!currentTenant) return;\n    setLoading(true);\n    const { data, error } = await supabase\n      .from('onboarding_checklist_templates')\n      .select('*')\n      .eq('tenant_id', currentTenant.id);\n\n    if (data) setChecklists(data);\n    setLoading(false);\n  }\n\n  async function updateSetting(field: string, value: any) {\n    if (!settings) return;\n\n    const { error } = await supabase\n      .from('recruitment_settings')\n      .update({ [field]: value, updated_at: new Date().toISOString() })\n      .eq('id', settings.id);\n\n    if (error) {\n      setToast({ message: 'Failed to update setting', type: 'error' });\n    } else {\n      setSettings({ ...settings, [field]: value });\n      setToast({ message: 'Setting updated', type: 'success' });\n    }\n  }\n\n  async function toggleSetting(field: string, value: boolean) {\n    await updateSetting(field, value);\n  }\n\n  async function loadFormTemplates() {\n    setLoading(true);\n    const { data, error } = await supabase\n      .from('form_templates')\n      .select('*')\n      .eq('category', 'recruitment')  // Only show recruitment forms\n      .order('created_at', { ascending: false });\n\n    if (data) {\n      setFormTemplates(data);\n      if (data.length > 0 && !selectedFormId) {\n        setSelectedFormId(data[0].id);\n      }\n    }\n    setLoading(false);\n  }\n\n  async function loadWorkflows() {\n    setLoading(true);\n    const { data, error } = await supabase\n      .from('recruitment_workflows')\n      .select('*')\n      .order('created_at', { ascending: false });\n\n    if (data) {\n      setWorkflows(data);\n    }\n    setLoading(false);\n  }\n\n  async function saveFormSchema(schema: FormField[]) {\n    if (!selectedFormId) return;\n\n    setLoading(true);\n    const { error } = await supabase\n      .from('form_templates')\n      .update({\n        schema,\n        updated_at: new Date().toISOString()\n      })\n      .eq('id', selectedFormId);\n\n    if (error) {\n      setToast({ message: 'Failed to save form', type: 'error' });\n    } else {\n      setToast({ message: 'Form saved successfully', type: 'success' });\n      loadFormTemplates();\n    }\n    setLoading(false);\n  }\n\n  async function handleSaveCriterion(e: React.FormEvent) {\n    e.preventDefault();\n    if (!currentTenant) return;\n    setLoading(true);\n\n    const formData = new FormData(e.currentTarget as HTMLFormElement);\n    const criterionData = {\n      name: formData.get('name') as string,\n      description: formData.get('description') as string,\n      weight: parseInt(formData.get('weight') as string),\n      max_score: parseInt(formData.get('max_score') as string),\n      tenant_id: currentTenant.id,\n    };\n\n    let error;\n    if (editingItem) {\n      const { error: err } = await supabase\n        .from('evaluation_criteria_templates')\n        .update(criterionData)\n        .eq('id', editingItem.id);\n      error = err;\n    } else {\n      const { error: err } = await supabase\n        .from('evaluation_criteria_templates')\n        .insert(criterionData);\n      error = err;\n    }\n\n    if (error) {\n      setToast({ message: 'Failed to save criterion', type: 'error' });\n    } else {\n      setToast({ message: 'Criterion saved', type: 'success' });\n      setActiveModal(null);\n      setEditingItem(null);\n      loadCriteria();\n    }\n    setLoading(false);\n  }\n\n  async function handleDeleteCriterion(id: string) {\n    if (!window.confirm('Are you sure you want to delete this criterion?')) return;\n\n    const { error } = await supabase\n      .from('evaluation_criteria_templates')\n      .delete()\n      .eq('id', id);\n\n    if (error) {\n      setToast({ message: 'Failed to delete criterion', type: 'error' });\n    } else {\n      setToast({ message: 'Criterion deleted', type: 'success' });\n      loadCriteria();\n    }\n  }\n\n  async function handleSaveChecklist(e: React.FormEvent) {\n    e.preventDefault();\n    if (!currentTenant) return;\n    setLoading(true);\n\n    const formData = new FormData(e.currentTarget as HTMLFormElement);\n    const tasks = (formData.get('tasks') as string).split('\\n').filter(t => t.trim());\n\n    const checklistData = {\n      name: formData.get('name') as string,\n      description: formData.get('description') as string,\n      tasks,\n      tenant_id: currentTenant.id,\n    };\n\n    let error;\n    if (editingItem) {\n      const { error: err } = await supabase\n        .from('onboarding_checklist_templates')\n        .update(checklistData)\n        .eq('id', editingItem.id);\n      error = err;\n    } else {\n      const { error: err } = await supabase\n        .from('onboarding_checklist_templates')\n        .insert(checklistData);\n      error = err;\n    }\n\n    if (error) {\n      setToast({ message: 'Failed to save checklist', type: 'error' });\n    } else {\n      setToast({ message: 'Checklist saved', type: 'success' });\n      setActiveModal(null);\n      setEditingItem(null);\n      loadChecklists();\n    }\n    setLoading(false);\n  }\n\n  async function handleDeleteChecklist(id: string) {\n    if (!window.confirm('Are you sure you want to delete this checklist?')) return;\n\n    const { error } = await supabase\n      .from('onboarding_checklist_templates')\n      .delete()\n      .eq('id', id);\n\n    if (error) {\n      setToast({ message: 'Failed to delete checklist', type: 'error' });\n    } else {\n      setToast({ message: 'Checklist deleted', type: 'success' });\n      loadChecklists();\n    }\n  }\n\n  const closeModal = () => {\n    setActiveModal(null);\n    setEditingItem(null);\n  };\n\n  const tabs = [\n    { id: 'general', label: 'General' },\n    { id: 'workflows', label: 'Workflows' },\n    { id: 'forms', label: 'Application Forms' },\n    { id: 'criteria', label: 'Evaluation Criteria' },\n    { id: 'checklists', label: 'Onboarding Checklists' }\n  ];\n\n  return (\n    <div>\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold text-gray-900\">Recruitment Settings</h1>\n        <p className=\"mt-1 text-sm text-gray-600\">Configure your recruitment process and templates</p>\n      </div>\n\n      {/* Tabs */}\n      <div className=\"mb-6 border-b border-gray-200 overflow-x-auto\">\n        <nav className=\"-mb-px flex space-x-8\">\n          {tabs.map((tab) => (\n            <button\n              key={tab.id}\n              onClick={() => setActiveTab(tab.id as TabType)}\n              className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition ${activeTab === tab.id\n                ? 'border-indigo-500 text-indigo-600'\n                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                }`}\n            >\n              {tab.label}\n            </button>\n          ))}\n        </nav>\n      </div>\n\n      {/* Content */}\n      <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n        {activeTab === 'general' && (\n          <div className=\"space-y-6\">\n            <h2 className=\"text-lg font-medium text-gray-900\">General Settings</h2>\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg\">\n                <div>\n                  <h3 className=\"text-sm font-medium text-gray-900\">Automated Interview Reminders</h3>\n                  <p className=\"text-xs text-gray-500 mt-1\">Send automated reminders before scheduled interviews</p>\n                </div>\n                <label className=\"relative inline-flex items-center cursor-pointer\">\n                  <input\n                    type=\"checkbox\"\n                    className=\"sr-only peer\"\n                    checked={settings?.auto_schedule_reminders ?? false}\n                    onChange={(e) => toggleSetting('auto_schedule_reminders', e.target.checked)}\n                  />\n                  <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600\"></div>\n                </label>\n              </div>\n\n              <div className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg\">\n                <div>\n                  <h3 className=\"text-sm font-medium text-gray-900\">Application Acknowledgement</h3>\n                  <p className=\"text-xs text-gray-500 mt-1\">Auto-send acknowledgement emails to applicants</p>\n                </div>\n                <label className=\"relative inline-flex items-center cursor-pointer\">\n                  <input\n                    type=\"checkbox\"\n                    className=\"sr-only peer\"\n                    checked={settings?.auto_acknowledge_applications ?? false}\n                    onChange={(e) => toggleSetting('auto_acknowledge_applications', e.target.checked)}\n                  />\n                  <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600\"></div>\n                </label>\n              </div>\n\n              <div className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg\">\n                <div>\n                  <h3 className=\"text-sm font-medium text-gray-900\">AI Screening & Parsing</h3>\n                  <p className=\"text-xs text-gray-500 mt-1\">Enable AI-powered CV parsing and candidate scoring</p>\n                </div>\n                <label className=\"relative inline-flex items-center cursor-pointer\">\n                  <input\n                    type=\"checkbox\"\n                    className=\"sr-only peer\"\n                    checked={settings?.enable_ai_screening ?? false}\n                    onChange={(e) => toggleSetting('enable_ai_screening', e.target.checked)}\n                  />\n                  <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600\"></div>\n                </label>\n              </div>\n\n              {/* AI Automation Section */}\n              <div className=\"mt-8 pt-8 border-t border-gray-100\">\n                <h3 className=\"text-sm font-semibold text-gray-900 uppercase tracking-wider mb-4\">AI Automation Rules</h3>\n\n                <div className=\"space-y-4\">\n                  <div className=\"p-4 border border-gray-200 rounded-lg bg-gray-50\">\n                    <div className=\"flex items-center justify-between mb-4\">\n                      <div>\n                        <h4 className=\"text-sm font-medium text-gray-900\">Auto-Shortlist High Performers</h4>\n                        <p className=\"text-xs text-gray-500 mt-1\">Automatically move candidates to \"Shortlisted\" stage based on AI score</p>\n                      </div>\n                      <label className=\"relative inline-flex items-center cursor-pointer\">\n                        <input\n                          type=\"checkbox\"\n                          className=\"sr-only peer\"\n                          checked={settings?.ai_auto_shortlist_enabled ?? false}\n                          onChange={(e) => toggleSetting('ai_auto_shortlist_enabled', e.target.checked)}\n                        />\n                        <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600\"></div>\n                      </label>\n                    </div>\n                    {settings?.ai_auto_shortlist_enabled && (\n                      <div className=\"mt-4 flex items-center space-x-4\">\n                        <div className=\"flex-1\">\n                          <label className=\"block text-xs font-medium text-gray-700 mb-1\">Threshold Score (Min %)</label>\n                          <input\n                            type=\"range\"\n                            min=\"50\" max=\"100\"\n                            value={settings?.ai_shortlist_threshold || 85}\n                            onChange={(e) => updateSetting('ai_shortlist_threshold', parseInt(e.target.value))}\n                            className=\"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600\"\n                          />\n                        </div>\n                        <div className=\"bg-indigo-50 text-indigo-700 px-3 py-1 rounded-md text-sm font-bold border border-indigo-100\">\n                          {settings?.ai_shortlist_threshold || 85}%\n                        </div>\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"p-4 border border-gray-200 rounded-lg bg-gray-50\">\n                    <div className=\"flex items-center justify-between mb-4\">\n                      <div>\n                        <h4 className=\"text-sm font-medium text-gray-900\">Auto-Reject Low Matching Profiles</h4>\n                        <p className=\"text-xs text-gray-500 mt-1\">Automatically move candidates to \"Rejected\" stage if AI score is too low</p>\n                      </div>\n                      <label className=\"relative inline-flex items-center cursor-pointer\">\n                        <input\n                          type=\"checkbox\"\n                          className=\"sr-only peer\"\n                          checked={settings?.ai_auto_reject_enabled ?? false}\n                          onChange={(e) => toggleSetting('ai_auto_reject_enabled', e.target.checked)}\n                        />\n                        <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600\"></div>\n                      </label>\n                    </div>\n                    {settings?.ai_auto_reject_enabled && (\n                      <div className=\"mt-4 flex items-center space-x-4\">\n                        <div className=\"flex-1\">\n                          <label className=\"block text-xs font-medium text-gray-700 mb-1\">Rejection Threshold (Max %)</label>\n                          <input\n                            type=\"range\"\n                            min=\"0\" max=\"50\"\n                            value={settings?.ai_reject_threshold || 30}\n                            onChange={(e) => updateSetting('ai_reject_threshold', parseInt(e.target.value))}\n                            className=\"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-red-600\"\n                          />\n                        </div>\n                        <div className=\"bg-red-50 text-red-700 px-3 py-1 rounded-md text-sm font-bold border border-red-100\">\n                          {settings?.ai_reject_threshold || 30}%\n                        </div>\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"p-4 border border-indigo-200 rounded-lg bg-indigo-50/30\">\n                    <div className=\"flex items-start space-x-3\">\n                      <div className=\"bg-indigo-100 p-1 rounded\">\n                        <Sliders className=\"w-4 h-4 text-indigo-600\" />\n                      </div>\n                      <div>\n                        <h4 className=\"text-sm font-medium text-gray-900\">Human-in-the-Loop</h4>\n                        <p className=\"text-xs text-gray-600 mt-1\">\n                          Candidates with scores between <strong>{settings?.ai_reject_threshold || 30}%</strong> and <strong>{settings?.ai_shortlist_threshold || 85}%</strong> will be moved to <strong>\"Manual Review\"</strong> for your assessment.\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {activeTab === 'workflows' && (\n          <div className=\"space-y-4\">\n            {isEditingWorkflow ? (\n              <WorkflowEditor\n                workflowId={editingWorkflowId || undefined}\n                onSave={() => {\n                  setIsEditingWorkflow(false);\n                  setEditingWorkflowId(null);\n                  loadWorkflows();\n                  setToast({ message: 'Workflow saved successfully', type: 'success' });\n                }}\n                onCancel={() => {\n                  setIsEditingWorkflow(false);\n                  setEditingWorkflowId(null);\n                }}\n              />\n            ) : (\n              <>\n                <div className=\"flex justify-between items-center mb-4\">\n                  <h2 className=\"text-lg font-medium text-gray-900\">Recruitment Workflows</h2>\n                  <button\n                    onClick={() => {\n                      setEditingWorkflowId(null);\n                      setIsEditingWorkflow(true);\n                    }}\n                    className=\"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\"\n                  >\n                    <Plus className=\"w-4 h-4 mr-2\" />\n                    Add Workflow\n                  </button>\n                </div>\n                {workflows.length === 0 && !loading && (\n                  <div className=\"text-center py-12 text-gray-500\">\n                    No workflows found. Create one to get started.\n                  </div>\n                )}\n                {workflows.map((workflow) => (\n                  <div key={workflow.id} className=\"border border-gray-200 rounded-lg p-4\">\n                    <div className=\"flex items-center justify-between mb-2\">\n                      <div>\n                        <h3 className=\"font-semibold text-gray-900 flex items-center\">\n                          {workflow.name}\n                          {workflow.is_default && (\n                            <span className=\"ml-2 px-2 py-0.5 text-xs bg-green-100 text-green-800 rounded-full\">Default</span>\n                          )}\n                        </h3>\n                        <p className=\"text-sm text-gray-500\">{workflow.description}</p>\n                      </div>\n                      <div className=\"flex space-x-2\">\n                        <button\n                          onClick={() => {\n                            setEditingWorkflowId(workflow.id);\n                            setIsEditingWorkflow(true);\n                          }}\n                          className=\"p-1 text-indigo-600 hover:bg-indigo-50 rounded\"\n                        >\n                          <Edit className=\"w-4 h-4\" />\n                        </button>\n                        <button\n                          onClick={() => deleteWorkflow(workflow.id)}\n                          className=\"p-1 text-red-600 hover:bg-red-50 rounded\"\n                        >\n                          <Trash2 className=\"w-4 h-4\" />\n                        </button>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </>\n            )}\n          </div>\n        )}\n\n        {activeTab === 'forms' && (\n          <div>\n            <div className=\"flex justify-between items-center mb-6\">\n              <h2 className=\"text-lg font-medium text-gray-900\">Application Forms</h2>\n              <div className=\"flex space-x-2\">\n                <select\n                  className=\"border border-gray-300 rounded-md px-3 py-1.5 text-sm focus:ring-indigo-500 focus:border-indigo-500\"\n                  value={selectedFormId || ''}\n                  onChange={(e) => setSelectedFormId(e.target.value)}\n                >\n                  {formTemplates.map(form => (\n                    <option key={form.id} value={form.id}>{form.name}</option>\n                  ))}\n                </select>\n              </div>\n            </div>\n\n            {selectedForm ? (\n              <FormBuilder\n                key={selectedForm.id}\n                initialSchema={selectedForm.schema}\n                onSave={saveFormSchema}\n              />\n            ) : (\n              <div className=\"text-center py-12\">\n                {loading ? (\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto\"></div>\n                ) : (\n                  <p className=\"text-gray-500\">No form templates found.</p>\n                )}\n              </div>\n            )}\n          </div>\n        )}\n\n        {activeTab === 'criteria' && (\n          <div className=\"space-y-4\">\n            <div className=\"flex justify-between items-center mb-4\">\n              <h2 className=\"text-lg font-medium text-gray-900\">Evaluation Criteria</h2>\n              <button\n                onClick={() => { setActiveModal('criterion'); setEditingItem(null); }}\n                className=\"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\"\n              >\n                <Plus className=\"w-4 h-4 mr-2\" />\n                Add Criterion\n              </button>\n            </div>\n            {criteria.map((criterion) => (\n              <div key={criterion.id} className=\"border border-gray-200 rounded-lg p-4\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <div>\n                    <h3 className=\"font-semibold text-gray-900\">{criterion.name}</h3>\n                    <p className=\"text-sm text-gray-500\">Weight: {criterion.weight}% | Max Score: {criterion.max_score}</p>\n                  </div>\n                  <div className=\"flex space-x-2\">\n                    <button\n                      onClick={() => { setEditingItem(criterion); setActiveModal('criterion'); }}\n                      className=\"p-1 text-indigo-600 hover:bg-indigo-50 rounded\"\n                    >\n                      <Edit className=\"w-4 h-4\" />\n                    </button>\n                    <button\n                      onClick={() => handleDeleteCriterion(criterion.id)}\n                      className=\"p-1 text-red-600 hover:bg-red-50 rounded\"\n                    >\n                      <Trash2 className=\"w-4 h-4\" />\n                    </button>\n                  </div>\n                </div>\n                <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                  <div className=\"bg-indigo-600 h-2 rounded-full\" style={{ width: `${criterion.weight}%` }}></div>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n\n        {activeTab === 'checklists' && (\n          <div className=\"space-y-4\">\n            <div className=\"flex justify-between items-center mb-4\">\n              <h2 className=\"text-lg font-medium text-gray-900\">Onboarding Checklists</h2>\n              <button\n                onClick={() => { setActiveModal('checklist'); setEditingItem(null); }}\n                className=\"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\"\n              >\n                <Plus className=\"w-4 h-4 mr-2\" />\n                Add Checklist\n              </button>\n            </div>\n            {checklists.map((checklist) => (\n              <div key={checklist.id} className=\"border border-gray-200 rounded-lg p-4\">\n                <div className=\"flex items-center justify-between mb-3\">\n                  <h3 className=\"font-semibold text-gray-900\">{checklist.name}</h3>\n                  <div className=\"flex space-x-2\">\n                    <button\n                      onClick={() => { setEditingItem(checklist); setActiveModal('checklist'); }}\n                      className=\"p-1 text-indigo-600 hover:bg-indigo-50 rounded\"\n                    >\n                      <Edit className=\"w-4 h-4\" />\n                    </button>\n                    <button\n                      onClick={() => handleDeleteChecklist(checklist.id)}\n                      className=\"p-1 text-red-600 hover:bg-red-50 rounded\"\n                    >\n                      <Trash2 className=\"w-4 h-4\" />\n                    </button>\n                  </div>\n                </div>\n                <div className=\"space-y-2\">\n                  {checklist.tasks.map((task, index) => (\n                    <div key={index} className=\"flex items-center space-x-2\">\n                      <CheckSquare className=\"w-4 h-4 text-green-600\" />\n                      <span className=\"text-sm text-gray-700\">{task}</span>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n        {/* Modals */}\n        {activeModal === 'criterion' && (\n          <Modal\n            isOpen={true}\n            onClose={closeModal}\n            title={editingItem ? 'Edit Criterion' : 'Add Evaluation Criterion'}\n          >\n            <form onSubmit={handleSaveCriterion} className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700\">Name</label>\n                <input\n                  name=\"name\"\n                  defaultValue={editingItem?.name}\n                  required\n                  className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700\">Description</label>\n                <textarea\n                  name=\"description\"\n                  defaultValue={editingItem?.description}\n                  rows={3}\n                  className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n                />\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700\">Weight (%)</label>\n                  <input\n                    name=\"weight\"\n                    type=\"number\"\n                    defaultValue={editingItem?.weight || 10}\n                    required\n                    className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700\">Max Score</label>\n                  <input\n                    name=\"max_score\"\n                    type=\"number\"\n                    defaultValue={editingItem?.max_score || 5}\n                    required\n                    className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n                  />\n                </div>\n              </div>\n              <div className=\"flex justify-end space-x-3 mt-6\">\n                <button\n                  type=\"button\"\n                  onClick={closeModal}\n                  className=\"bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  disabled={loading}\n                  className=\"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50\"\n                >\n                  {loading ? 'Saving...' : 'Save Criterion'}\n                </button>\n              </div>\n            </form>\n          </Modal>\n        )}\n\n        {activeModal === 'checklist' && (\n          <Modal\n            isOpen={true}\n            onClose={closeModal}\n            title={editingItem ? 'Edit Checklist' : 'Add Onboarding Checklist'}\n          >\n            <form onSubmit={handleSaveChecklist} className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700\">Name</label>\n                <input\n                  name=\"name\"\n                  defaultValue={editingItem?.name}\n                  required\n                  placeholder=\"e.g. Clinical Nursing Onboarding\"\n                  className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700\">Description</label>\n                <textarea\n                  name=\"description\"\n                  defaultValue={editingItem?.description}\n                  rows={2}\n                  className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700\">Tasks (one per line)</label>\n                <textarea\n                  name=\"tasks\"\n                  defaultValue={editingItem?.tasks?.join('\\n')}\n                  required\n                  rows={6}\n                  placeholder=\"Submit ID documents&#10;Complete orientation&#10;Shadow senior nurse\"\n                  className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n                />\n              </div>\n              <div className=\"flex justify-end space-x-3 mt-6\">\n                <button\n                  type=\"button\"\n                  onClick={closeModal}\n                  className=\"bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  disabled={loading}\n                  className=\"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50\"\n                >\n                  {loading ? 'Saving...' : 'Save Checklist'}\n                </button>\n              </div>\n            </form>\n          </Modal>\n        )}\n\n        {toast && (\n          <Toast\n            message={toast.message}\n            type={toast.type}\n            onClose={() => setToast(null)}\n          />\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/RecruitmentPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'XCircle' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":56,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":63},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":205,"column":6,"nodeType":"ArrayExpression","endLine":205,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [activeTab, loadData]","fix":{"range":[9353,9364],"text":"[activeTab, loadData]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'app' is defined but never used. Allowed unused args must match /^_/u.","line":413,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":413,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used. Allowed unused caught errors must match /^_/u.","line":475,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":475,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":509,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":509,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { Plus, Search, Edit, Trash2, Eye, CheckCircle, XCircle, Calendar, LayoutList, Kanban, Filter } from 'lucide-react';\nimport { format } from 'date-fns';\nimport AddJobModal from '@/components/AddJobModal';\nimport AddApplicationModal from '@/components/AddApplicationModal';\nimport AddInterviewModal from '@/components/AddInterviewModal';\nimport Toast from '@/components/Toast';\nimport { X, MessageSquare, Clock, Zap } from 'lucide-react';\nimport { callEmployeeCrud } from '@/lib/employeeCrud';\nimport { log } from '@/lib/logger';\n\ntype TabType = 'jobs' | 'applications' | 'interviews';\ntype ViewType = 'list' | 'board';\n\ninterface ApplicationDetailsModalProps {\n  application: any;\n  isOpen: boolean;\n  onClose: () => void;\n  onUpdate: () => void;\n  onAiScreen: (app: any) => void;\n  onConvertToEmployee: (app: any) => void;\n  onGenerateDocument: (app: any, templateId: string) => void;\n}\n\nfunction ApplicationDetailsModal({ application, isOpen, onClose, onUpdate, onAiScreen, onConvertToEmployee, onGenerateDocument }: ApplicationDetailsModalProps) {\n  const [notes, setNotes] = useState('');\n  const [addingNote, setAddingNote] = useState(false);\n  const { user } = useAuth();\n\n  if (!isOpen || !application) return null;\n\n  async function handleAddNote() {\n    if (!notes.trim()) return;\n    setAddingNote(true);\n\n    // In a real app, we'd have a separate notes table. For now, we'll append to the notes field\n    // or assume there's a notes table. Let's append with timestamp for this MVP.\n    const timestamp = new Date().toLocaleString();\n    const newNote = `[${timestamp} - ${user?.email}] ${notes}\\n\\n`;\n    const updatedNotes = (application.notes || '') + newNote;\n\n    const { error } = await supabase\n      .from('applications')\n      .update({ notes: updatedNotes })\n      .eq('id', application.id);\n\n    if (!error) {\n      setNotes('');\n      onUpdate();\n    }\n    setAddingNote(false);\n  }\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <div className=\"flex justify-between items-center p-6 border-b border-gray-200\">\n          <h2 className=\"text-xl font-semibold text-gray-900\">Application Details</h2>\n          <button onClick={onClose} className=\"text-gray-400 hover:text-gray-600\">\n            <X className=\"w-6 h-6\" />\n          </button>\n        </div>\n\n        <div className=\"p-6 space-y-6\">\n          {/* Header Info */}\n          <div className=\"flex items-start justify-between\">\n            <div>\n              <h3 className=\"text-2xl font-bold text-gray-900\">{application.applicant_first_name} {application.applicant_last_name}</h3>\n              <p className=\"text-gray-500\">{application.applicant_email}</p>\n              <p className=\"text-gray-500\">{application.applicant_phone || 'No phone provided'}</p>\n            </div>\n            <div className=\"text-right\">\n              <span className=\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-indigo-100 text-indigo-800\">\n                {application.status}\n              </span>\n              <p className=\"text-sm text-gray-500 mt-1\">Applied: {format(new Date(application.applied_at), 'MMM dd, yyyy')}</p>\n            </div>\n          </div>\n\n          {/* Job Info */}\n          <div className=\"bg-gray-50 p-4 rounded-lg\">\n            <h4 className=\"text-sm font-medium text-gray-700 mb-2\">Applied For</h4>\n            <p className=\"text-gray-900 font-medium\">{application.job_postings?.job_title}</p>\n            <p className=\"text-sm text-gray-500\">{application.job_postings?.department} â¢ {application.job_postings?.employment_type?.replace('_', ' ')}</p>\n          </div>\n\n          {/* AI Screening Results */}\n          {(application.ai_score || application.ai_summary) && (\n            <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n              <h4 className=\"text-sm font-medium text-blue-800 mb-2\">AI Screening Results</h4>\n              {application.ai_score && (\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <span className=\"font-bold text-blue-900\">{application.ai_score}/100</span>\n                  <div className=\"w-full bg-blue-200 rounded-full h-2.5\">\n                    <div className=\"bg-blue-600 h-2.5 rounded-full\" style={{ width: `${application.ai_score}%` }}></div>\n                  </div>\n                </div>\n              )}\n              {application.ai_summary && (\n                <p className=\"text-sm text-blue-700\">{application.ai_summary}</p>\n              )}\n            </div>\n          )}\n\n          {/* Links & Actions */}\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n            {application.cv_url && (\n              <a href={application.cv_url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"flex items-center justify-center p-3 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm font-medium text-gray-700\">\n                View CV\n              </a>\n            )}\n            <button\n              onClick={() => onAiScreen(application)}\n              className=\"flex items-center justify-center p-3 border border-transparent rounded-lg bg-blue-600 text-white hover:bg-blue-700 text-sm font-medium\"\n            >\n              AI Screen\n            </button>\n            {application.status === 'Hired' && (\n              <>\n                <button\n                  onClick={() => onConvertToEmployee(application)}\n                  className=\"flex items-center justify-center p-3 border border-transparent rounded-lg bg-green-600 text-white hover:bg-green-700 text-sm font-medium\"\n                >\n                  Convert to Employee\n                </button>\n                <button\n                  onClick={() => onGenerateDocument(application, '1')} // Using hardcoded template ID '1' for offer letter\n                  className=\"flex items-center justify-center p-3 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm font-medium text-gray-700\"\n                >\n                  Generate Offer Letter\n                </button>\n              </>\n            )}\n          </div>\n\n          {/* Notes Section */}\n          <div>\n            <h4 className=\"text-lg font-medium text-gray-900 mb-4 flex items-center\">\n              <MessageSquare className=\"w-5 h-5 mr-2\" />\n              Notes & Activity\n            </h4>\n\n            <div className=\"bg-gray-50 rounded-lg p-4 mb-4 max-h-48 overflow-y-auto whitespace-pre-wrap text-sm text-gray-700\">\n              {application.notes || 'No notes yet.'}\n            </div>\n\n            <div className=\"flex gap-2\">\n              <textarea\n                value={notes}\n                onChange={(e) => setNotes(e.target.value)}\n                placeholder=\"Add a note...\"\n                className=\"flex-1 p-2 border border-gray-300 rounded-md text-sm focus:ring-indigo-500 focus:border-indigo-500\"\n                rows={2}\n              />\n              <button\n                onClick={handleAddNote}\n                disabled={addingNote || !notes.trim()}\n                className=\"px-4 py-2 bg-indigo-600 text-white rounded-md text-sm font-medium hover:bg-indigo-700 disabled:opacity-50\"\n              >\n                Add\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n\nexport default function RecruitmentPage() {\n  const [activeTab, setActiveTab] = useState<TabType>('jobs');\n  const [viewType, setViewType] = useState<ViewType>('list');\n  const [jobs, setJobs] = useState<any[]>([]);\n  const [applications, setApplications] = useState<any[]>([]);\n  const [interviews, setInterviews] = useState<any[]>([]);\n  const [workflows, setWorkflows] = useState<any[]>([]);\n  const [workflowStages, setWorkflowStages] = useState<any[]>([]);\n  const [selectedWorkflowId, setSelectedWorkflowId] = useState<string>('all');\n  const [selectedJobId, setSelectedJobId] = useState<string>('all');\n  const [selectedStageId, setSelectedStageId] = useState<string>('all');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [showAddJobModal, setShowAddJobModal] = useState(false);\n  const [showAddApplicationModal, setShowAddApplicationModal] = useState(false);\n  const [showAddInterviewModal, setShowAddInterviewModal] = useState(false);\n  const [selectedApplication, setSelectedApplication] = useState<any>(null);\n  const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' | 'warning' } | null>(null);\n  const [draggedAppId, setDraggedAppId] = useState<string | null>(null);\n  const [selectedApplications, setSelectedApplications] = useState<string[]>([]);\n  const [isScreeningBulk, setIsScreeningBulk] = useState(false);\n  const [screeningProgress, setScreeningProgress] = useState({ current: 0, total: 0 });\n  const { user } = useAuth();\n\n  const [selectedJob, setSelectedJob] = useState<any>(null);\n\n  const [selectedInterview, setSelectedInterview] = useState<any>(null);\n\n  useEffect(() => {\n    loadData();\n    loadWorkflowsAndStages();\n    triggerAutomationPulse();\n  }, [activeTab]);\n\n  async function triggerAutomationPulse() {\n    // Only trigger once per session or periodically\n    try {\n      // 1. Check for upcoming interview reminders\n      await supabase.functions.invoke('automation-engine', {\n        body: { action: 'CHECK_REMINDERS' }\n      });\n\n      // 2. Process all pending tasks (emails, etc.)\n      await supabase.functions.invoke('automation-engine', {\n        body: { action: 'PROCESS_PENDING' }\n      });\n    } catch (err) {\n      console.error('Automation pulse failed:', err);\n    }\n  }\n\n  async function loadWorkflowsAndStages() {\n    const { data: wfData } = await supabase.from('recruitment_workflows').select('*');\n    if (wfData) setWorkflows(wfData);\n\n    const { data: stageData } = await supabase.from('workflow_stages').select('*').order('stage_order');\n    if (stageData) setWorkflowStages(stageData);\n  }\n\n  async function loadData() {\n    setLoading(true);\n    try {\n      switch (activeTab) {\n        case 'jobs':\n          const { data: jobData } = await supabase\n            .from('job_postings')\n            .select('*, recruitment_workflows(name)')\n            .order('created_at', { ascending: false });\n          setJobs(jobData || []);\n          break;\n\n        case 'applications':\n          const { data: appData } = await supabase\n            .from('applications')\n            .select(`\n              *,\n              job_postings (\n                id,\n                job_title,\n                workflow_id\n              )\n            `)\n            .order('applied_at', { ascending: false });\n          setApplications(appData || []);\n          break;\n\n        case 'interviews':\n          const { data: intData } = await supabase\n            .from('interviews')\n            .select('*')\n            .order('scheduled_date', { ascending: false });\n          setInterviews(intData || []);\n          break;\n      }\n    } catch (error) {\n      log.error('Error loading data', error, { component: 'RecruitmentPage', action: 'loadData' });\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function updateJobStatus(jobId: string, newStatus: string) {\n    const { error } = await supabase\n      .from('job_postings')\n      .update({ status: newStatus })\n      .eq('id', jobId);\n\n    if (!error) {\n      loadData();\n      await supabase.from('audit_logs').insert({\n        user_id: user?.id,\n        action: `UPDATE_JOB_STATUS_${newStatus.toUpperCase()}`,\n        entity_type: 'job_postings',\n        entity_id: jobId,\n        timestamp: new Date().toISOString()\n      });\n    }\n  }\n\n  async function updateApplicationStage(appId: string, stageId: string) {\n    // Optimistic update\n    setApplications(prev => prev.map(app =>\n      app.id === appId ? { ...app, current_stage_id: stageId } : app\n    ));\n\n    const { error } = await supabase\n      .from('applications')\n      .update({\n        current_stage_id: stageId,\n        last_updated_by: user?.id\n      })\n      .eq('id', appId);\n\n    if (!error) {\n      setToast({ message: 'Application stage updated', type: 'success' });\n\n      // Check for automations\n      try {\n        const { data: automations } = await supabase\n          .from('stage_automations')\n          .select('*')\n          .eq('stage_id', stageId)\n          .eq('is_active', true)\n          .eq('trigger_event', 'on_enter');\n\n        if (automations && automations.length > 0) {\n          // Log trigger events to automation service\n          const automationLogs = automations.map(auto => ({\n            rule_id: auto.id, // Using stage_automation id as rule_id\n            trigger_event: 'stage_change',\n            execution_status: 'pending',\n            created_by: user?.id, // Ensure we track who triggered it\n            trigger_data: {\n              action_type: auto.action_type,\n              action_config: auto.action_config,\n              application_id: appId,\n              stage_id: stageId,\n              automation_name: auto.name\n            }\n          }));\n\n          const { error: logError } = await supabase\n            .from('automation_execution_logs')\n            .insert(automationLogs);\n\n          if (logError) {\n            log.error('Failed to schedule automations', logError, { component: 'RecruitmentPage', action: 'updateApplicationStage', metadata: { stageId } });\n            setToast({ message: 'Stage updated, but failed to trigger automations', type: 'warning' });\n          } else {\n            // Notify user\n            const actionNames = automations.map(a => a.action_type.replace('_', ' ')).join(', ');\n            // Special handling for interview scheduling - might still want the modal fallback if not fully auto\n            automations.forEach(auto => {\n              if (auto.action_type === 'schedule_interview') {\n                // Start the flow or let the service handle it? \n                // Service handles creation, but maybe we want to hint user?\n              }\n            });\n\n            setToast({\n              message: `Stage updated. Scheduled actions: ${actionNames}`,\n              type: 'success'\n            });\n          }\n        }\n      } catch (err) {\n        log.error('Error executing automations', err, { component: 'RecruitmentPage', action: 'updateApplicationStage' });\n      }\n\n    } else {\n      setToast({ message: 'Failed to update stage', type: 'error' });\n      loadData(); // Revert on error\n    }\n  }\n\n  async function deleteJob(jobId: string) {\n    if (window.confirm('Are you sure you want to delete this job posting?')) {\n      const { error } = await supabase\n        .from('job_postings')\n        .delete()\n        .eq('id', jobId);\n\n      if (!error) {\n        setToast({ message: 'Job posting deleted successfully', type: 'success' });\n        loadData();\n      } else {\n        setToast({ message: 'Error deleting job posting', type: 'error' });\n      }\n    }\n  }\n\n  async function deleteApplication(appId: string) {\n    if (window.confirm('Are you sure you want to delete this application?')) {\n      const { error } = await supabase\n        .from('applications')\n        .delete()\n        .eq('id', appId);\n\n      if (!error) {\n        setToast({ message: 'Application deleted successfully', type: 'success' });\n        loadData();\n      } else {\n        setToast({ message: 'Error deleting application', type: 'error' });\n      }\n    }\n  }\n\n  function viewJobDetails(job: any) {\n    alert(`Job Details:\\n\\nTitle: ${job.job_title}\\nDepartment: ${job.department}\\nType: ${job.employment_type}\\nDescription: ${job.description || 'No description available'}\\nLocation: ${job.location || 'Remote'}\\nSalary: ${job.salary_range || 'Not specified'}`);\n  }\n\n  function editJob(job: any) {\n    setSelectedJob(job);\n    setShowAddJobModal(true);\n  }\n\n  function viewApplicationDetails(app: any) {\n    setSelectedApplication(app);\n  }\n\n  function scheduleInterviewForApplication(app: any) {\n    setSelectedInterview(null); // Clear any selection\n    setShowAddInterviewModal(true);\n    // Pre-select application logic would go here if modal supported it via props, \n    // but currently it loads all applications. \n    // Ideally we'd pass the app ID to pre-select.\n    // For now, just opening the modal is fine.\n  }\n\n  function editInterview(interview: any) {\n    setSelectedInterview(interview);\n    setShowAddInterviewModal(true);\n  }\n\n  function rescheduleInterview(interview: any) {\n    setSelectedInterview(interview);\n    setShowAddInterviewModal(true);\n  }\n\n  async function handleAiScreen(application: any) {\n    try {\n      const { data, error } = await supabase.functions.invoke('ai-screen-resume', {\n        body: {\n          application_id: application.id,\n        },\n      });\n\n      if (error) throw error;\n      if (data && data.error) throw new Error(data.error);\n\n      setToast({ message: 'AI screening completed successfully!', type: 'success' });\n      loadData(); // Refresh the application data to show the new score and summary\n    } catch (error: any) {\n      setToast({ message: error.message || 'Failed to start AI screening', type: 'error' });\n    }\n  }\n\n  async function handleBulkAiScreen() {\n    if (selectedApplications.length === 0) return;\n\n    setIsScreeningBulk(true);\n    setScreeningProgress({ current: 0, total: selectedApplications.length });\n\n    let successCount = 0;\n    let failCount = 0;\n\n    // Process in small batches to avoid hitting rate limits too aggressively\n    const batchSize = 3;\n    for (let i = 0; i < selectedApplications.length; i += batchSize) {\n      const batch = selectedApplications.slice(i, i + batchSize);\n\n      await Promise.all(batch.map(async (appId) => {\n        try {\n          const { data, error } = await supabase.functions.invoke('ai-screen-resume', {\n            body: { application_id: appId },\n          });\n\n          if (!error && (!data || !data.error)) {\n            successCount++;\n          } else {\n            failCount++;\n          }\n        } catch (err) {\n          failCount++;\n        } finally {\n          setScreeningProgress(prev => ({ ...prev, current: prev.current + 1 }));\n        }\n      }));\n    }\n\n    setToast({\n      message: `Bulk screening complete. Success: ${successCount}, Failed: ${failCount}`,\n      type: successCount > 0 ? 'success' : 'error'\n    });\n\n    setIsScreeningBulk(false);\n    setSelectedApplications([]);\n    loadData();\n  }\n\n  function toggleApplicationSelection(appId: string) {\n    setSelectedApplications(prev =>\n      prev.includes(appId) ? prev.filter(id => id !== appId) : [...prev, appId]\n    );\n  }\n\n  function toggleSelectAll(apps: any[]) {\n    if (selectedApplications.length === apps.length) {\n      setSelectedApplications([]);\n    } else {\n      setSelectedApplications(apps.map(app => app.id));\n    }\n  }\n\n  async function handleGenerateDocument(application: any, templateId: string) {\n    try {\n      const { data, error } = await supabase.functions.invoke('generate-document', {\n        body: {\n          template_id: templateId,\n          application_id: application.id,\n        },\n      });\n\n      if (error) throw error;\n\n      setToast({ message: 'Document generated successfully!', type: 'success' });\n      // You might want to open the document here, or provide a link\n    } catch (error: any) {\n      setToast({ message: error.message || 'Failed to generate document', type: 'error' });\n    }\n  }\n\n  async function handleConvertToEmployee(application: any) {\n    if (window.confirm(`Are you sure you want to convert ${application.applicant_first_name} ${application.applicant_last_name} to an employee?`)) {\n      try {\n        await callEmployeeCrud('create', {\n          first_name: application.applicant_first_name,\n          last_name: application.applicant_last_name,\n          email: application.applicant_email,\n          phone: application.applicant_phone,\n          position: application.job_postings?.job_title,\n          department: application.job_postings?.department,\n          status: 'active',\n          // Other relevant data can be mapped here\n        });\n        setToast({ message: 'Candidate successfully converted to employee!', type: 'success' });\n        setSelectedApplication(null); // Close the modal\n      } catch (error: any) {\n        setToast({ message: error.message || 'Failed to convert candidate', type: 'error' });\n      }\n    }\n  }\n\n  function handleAddNew() {\n    if (activeTab === 'jobs') {\n      setSelectedJob(null); // Clear selection for new job\n      setShowAddJobModal(true);\n    } else if (activeTab === 'applications') {\n      setShowAddApplicationModal(true);\n    } else if (activeTab === 'interviews') {\n      setSelectedInterview(null); // Clear selection for new interview\n      setShowAddInterviewModal(true);\n    }\n  }\n\n  async function handleSuccess() {\n    setToast({ message: (selectedJob || selectedInterview) ? 'Item updated successfully!' : 'Item created successfully!', type: 'success' });\n    // Small delay to ensure database has committed the changes\n    await new Promise(resolve => setTimeout(resolve, 300));\n    await loadData();\n  }\n\n  function handleError(message: string) {\n    setToast({ message, type: 'error' });\n  }\n\n  function getStagesForApp(app: any) {\n    const workflowId = app.job_postings?.workflow_id;\n    if (!workflowId) return [];\n    return workflowStages.filter(s => s.workflow_id === workflowId);\n  }\n\n  // Drag and Drop Handlers\n  const handleDragStart = (e: React.DragEvent, appId: string) => {\n    setDraggedAppId(appId);\n    e.dataTransfer.effectAllowed = 'move';\n    // Transparent drag image or default\n  };\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.dataTransfer.dropEffect = 'move';\n  };\n\n  const handleDrop = (e: React.DragEvent, stageId: string) => {\n    e.preventDefault();\n    if (draggedAppId) {\n      updateApplicationStage(draggedAppId, stageId);\n      setDraggedAppId(null);\n    }\n  };\n\n  const tabs = [\n    { id: 'jobs', label: 'Job Postings' },\n    { id: 'applications', label: 'Applications' },\n    { id: 'interviews', label: 'Interviews' },\n  ];\n\n  const filteredJobs = jobs.filter(job =>\n    job.job_title.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    job.department.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const filteredApplications = applications.filter(app => {\n    const matchesSearch = `${app.applicant_first_name} ${app.applicant_last_name} ${app.applicant_email}`\n      .toLowerCase()\n      .includes(searchTerm.toLowerCase());\n\n    const matchesWorkflow = selectedWorkflowId === 'all' || app.job_postings?.workflow_id === selectedWorkflowId;\n    const matchesJob = selectedJobId === 'all' || app.job_id === selectedJobId;\n    const matchesStage = selectedStageId === 'all' || app.current_stage_id === selectedStageId;\n\n    return matchesSearch && matchesWorkflow && matchesJob && matchesStage;\n  });\n\n  // Get stages for the selected workflow (for Board View)\n  const currentWorkflowStages = selectedWorkflowId !== 'all'\n    ? workflowStages.filter(s => s.workflow_id === selectedWorkflowId)\n    : [];\n\n  return (\n    <div>\n      <div className=\"mb-8 flex flex-col sm:flex-row sm:items-center sm:justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Recruitment Module</h1>\n          <p className=\"mt-1 text-sm text-gray-600\">Manage job postings, applications, and interviews</p>\n        </div>\n\n        <button\n          onClick={handleAddNew}\n          className=\"mt-4 sm:mt-0 inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition\"\n        >\n          <Plus className=\"w-4 h-4 mr-2\" />\n          {activeTab === 'jobs' ? 'New Job Posting' : activeTab === 'interviews' ? 'Schedule Interview' : 'Add Application'}\n        </button>\n      </div>\n\n      {/* Tabs */}\n      <div className=\"mb-6 border-b border-gray-200 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\n        <nav className=\"-mb-px flex space-x-8\">\n          {tabs.map((tab) => (\n            <button\n              key={tab.id}\n              onClick={() => setActiveTab(tab.id as TabType)}\n              className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition ${activeTab === tab.id\n                ? 'border-indigo-500 text-indigo-600'\n                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                }`}\n            >\n              {tab.label}\n            </button>\n          ))}\n        </nav>\n\n        {activeTab === 'applications' && (\n          <div className=\"flex items-center space-x-4\">\n            {/* Workflow Filter */}\n            <div className=\"flex items-center space-x-2\">\n              <Filter className=\"w-4 h-4 text-gray-500\" />\n              <select\n                value={selectedWorkflowId}\n                onChange={(e) => setSelectedWorkflowId(e.target.value)}\n                className=\"text-sm border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500\"\n              >\n                <option value=\"all\">All Workflows</option>\n                {workflows.map(wf => (\n                  <option key={wf.id} value={wf.id}>{wf.name}</option>\n                ))}\n              </select>\n            </div>\n\n            {/* Job Filter */}\n            <div className=\"flex items-center space-x-2\">\n              <select\n                value={selectedJobId}\n                onChange={(e) => setSelectedJobId(e.target.value)}\n                className=\"text-sm border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 max-w-[150px]\"\n              >\n                <option value=\"all\">All Jobs</option>\n                {jobs.map(job => (\n                  <option key={job.id} value={job.id}>{job.job_title}</option>\n                ))}\n              </select>\n            </div>\n\n            {/* Stage Filter */}\n            <div className=\"flex items-center space-x-2\">\n              <select\n                value={selectedStageId}\n                onChange={(e) => setSelectedStageId(e.target.value)}\n                className=\"text-sm border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 max-w-[150px]\"\n              >\n                <option value=\"all\">All Stages</option>\n                {workflowStages.map(stage => (\n                  <option key={stage.id} value={stage.id}>{stage.name}</option>\n                ))}\n              </select>\n            </div>\n\n            {/* View Toggle */}\n            <div className=\"flex bg-gray-100 rounded-lg p-1\">\n              <button\n                onClick={() => setViewType('list')}\n                className={`p-2 rounded-md transition ${viewType === 'list' ? 'bg-white shadow-sm text-indigo-600' : 'text-gray-500 hover:text-gray-700'}`}\n                title=\"List View\"\n              >\n                <LayoutList className=\"w-4 h-4\" />\n              </button>\n              <button\n                onClick={() => setViewType('board')}\n                className={`p-2 rounded-md transition ${viewType === 'board' ? 'bg-white shadow-sm text-indigo-600' : 'text-gray-500 hover:text-gray-700'}`}\n                title=\"Board View\"\n              >\n                <Kanban className=\"w-4 h-4\" />\n              </button>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Search Bar */}\n      <div className=\"mb-6\">\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\n          <input\n            type=\"text\"\n            placeholder={`Search ${activeTab}...`}\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n          />\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className={`bg-white rounded-xl shadow-sm border border-gray-200 ${viewType === 'board' && activeTab === 'applications' ? 'bg-transparent border-none shadow-none' : ''}`}>\n        {loading ? (\n          <div className=\"flex items-center justify-center h-64 bg-white rounded-xl border border-gray-200\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600\"></div>\n          </div>\n        ) : (\n          <div key={`${activeTab}-${viewType}`}>\n            {/* Job Postings Table */}\n            {activeTab === 'jobs' && (\n              <div className=\"overflow-x-auto\">\n                <table className=\"min-w-full divide-y divide-gray-200\">\n                  <thead className=\"bg-gray-50\">\n                    <tr>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Job Title</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Department</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Type</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Workflow</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"bg-white divide-y divide-gray-200\">\n                    {filteredJobs.length > 0 ? (\n                      filteredJobs.map((job) => (\n                        <tr key={job.id} className=\"hover:bg-gray-50\">\n                          <td className=\"px-6 py-4\">\n                            <div className=\"text-sm font-medium text-gray-900\">{job.job_title}</div>\n                            <div className=\"text-sm text-gray-500\">{job.location || 'Remote'}</div>\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                            {job.department}\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900 capitalize\">\n                            {job.employment_type.replace('_', ' ')}\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\n                            <select\n                              value={job.status}\n                              onChange={(e) => updateJobStatus(job.id, e.target.value)}\n                              className={`text-xs font-semibold rounded-full px-3 py-1 border-0 outline-none ${job.status === 'active' ? 'bg-green-100 text-green-800' :\n                                job.status === 'closed' ? 'bg-red-100 text-red-800' :\n                                  'bg-yellow-100 text-yellow-800'\n                                }`}\n                            >\n                              <option value=\"draft\">Draft</option>\n                              <option value=\"active\">Published</option>\n                              <option value=\"closed\">Closed</option>\n                              <option value=\"cancelled\">Cancelled</option>\n                            </select>\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                            {job.recruitment_workflows?.name || 'Default'}\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\n                            <button\n                              onClick={() => viewJobDetails(job)}\n                              className=\"text-indigo-600 hover:text-indigo-900 mr-3 p-1 rounded\"\n                              title=\"View Details\"\n                            >\n                              <Eye className=\"w-4 h-4\" />\n                            </button>\n                            <button\n                              onClick={() => editJob(job)}\n                              className=\"text-gray-600 hover:text-gray-900 mr-3 p-1 rounded\"\n                              title=\"Edit Job\"\n                            >\n                              <Edit className=\"w-4 h-4\" />\n                            </button>\n                            <button\n                              onClick={() => deleteJob(job.id)}\n                              className=\"text-red-600 hover:text-red-900 p-1 rounded\"\n                              title=\"Delete Job\"\n                            >\n                              <Trash2 className=\"w-4 h-4\" />\n                            </button>\n                          </td>\n                        </tr>\n                      ))\n                    ) : (\n                      <tr>\n                        <td colSpan={6} className=\"px-6 py-12 text-center text-sm text-gray-500\">\n                          No job postings found\n                        </td>\n                      </tr>\n                    )}\n                  </tbody>\n                </table>\n              </div>\n            )}\n\n            {/* Applications List View */}\n            {activeTab === 'applications' && viewType === 'list' && (\n              <div className=\"overflow-x-auto\">\n                <table className=\"min-w-full divide-y divide-gray-200\">\n                  <thead className=\"bg-gray-50\">\n                    <tr>\n                      <th className=\"px-6 py-3 text-left\">\n                        <input\n                          type=\"checkbox\"\n                          checked={selectedApplications.length === filteredApplications.length && filteredApplications.length > 0}\n                          onChange={() => toggleSelectAll(filteredApplications)}\n                          className=\"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500\"\n                        />\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Applicant</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Job</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Applied Date</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Stage</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">AI Score</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"bg-white divide-y divide-gray-200\">\n                    {filteredApplications.length > 0 ? (\n                      filteredApplications.map((app) => {\n                        const appStages = getStagesForApp(app);\n                        return (\n                          <tr key={app.id} className={`hover:bg-gray-50 ${selectedApplications.includes(app.id) ? 'bg-indigo-50' : ''}`}>\n                            <td className=\"px-6 py-4\">\n                              <input\n                                type=\"checkbox\"\n                                checked={selectedApplications.includes(app.id)}\n                                onChange={() => toggleApplicationSelection(app.id)}\n                                className=\"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500\"\n                              />\n                            </td>\n                            <td className=\"px-6 py-4\">\n                              <div className=\"text-sm font-medium text-gray-900\">\n                                {app.applicant_first_name} {app.applicant_last_name}\n                              </div>\n                              <div className=\"text-sm text-gray-500\">{app.applicant_email}</div>\n                            </td>\n                            <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                              {app.job_postings?.job_title || 'Unknown Job'}\n                            </td>\n                            <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                              {format(new Date(app.applied_at), 'MMM dd, yyyy')}\n                            </td>\n                            <td className=\"px-6 py-4 whitespace-nowrap\">\n                              {appStages.length > 0 ? (\n                                <select\n                                  value={app.current_stage_id || ''}\n                                  onChange={(e) => updateApplicationStage(app.id, e.target.value)}\n                                  className=\"text-xs font-semibold rounded-full px-3 py-1 border-gray-300 outline-none focus:ring-2 focus:ring-indigo-500\"\n                                >\n                                  <option value=\"\">Select Stage</option>\n                                  {appStages.map((stage: any) => (\n                                    <option key={stage.id} value={stage.id}>\n                                      {stage.name}\n                                    </option>\n                                  ))}\n                                </select>\n                              ) : (\n                                <span className=\"text-sm text-gray-500 italic\">No workflow</span>\n                              )}\n                            </td>\n                            <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                              {app.ai_score ? `${app.ai_score}/100` : 'N/A'}\n                            </td>\n                            <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\n                              <button\n                                onClick={() => viewApplicationDetails(app)}\n                                className=\"text-indigo-600 hover:text-indigo-900 mr-3 p-1 rounded\"\n                                title=\"View Details\"\n                              >\n                                <Eye className=\"w-4 h-4\" />\n                              </button>\n                              <button\n                                onClick={() => scheduleInterviewForApplication(app)}\n                                className=\"text-blue-600 hover:text-blue-900 mr-3 p-1 rounded\"\n                                title=\"Schedule Interview\"\n                              >\n                                <Calendar className=\"w-4 h-4\" />\n                              </button>\n                              <button\n                                onClick={() => deleteApplication(app.id)}\n                                className=\"text-gray-600 hover:text-gray-900 p-1 rounded\"\n                                title=\"Delete Application\"\n                              >\n                                <Trash2 className=\"w-4 h-4\" />\n                              </button>\n                            </td>\n                          </tr>\n                        );\n                      })\n                    ) : (\n                      <tr>\n                        <td colSpan={7} className=\"px-6 py-12 text-center text-sm text-gray-500\">\n                          No applications found\n                        </td>\n                      </tr>\n                    )}\n                  </tbody>\n                </table>\n              </div>\n            )}\n\n            {/* Applications Kanban Board View */}\n            {activeTab === 'applications' && viewType === 'board' && (\n              <div className=\"h-full overflow-x-auto pb-4\">\n                {selectedWorkflowId === 'all' ? (\n                  <div className=\"flex flex-col items-center justify-center h-64 bg-white rounded-xl border border-gray-200\">\n                    <Kanban className=\"w-12 h-12 text-gray-300 mb-4\" />\n                    <h3 className=\"text-lg font-medium text-gray-900\">Select a Workflow</h3>\n                    <p className=\"text-gray-500 mt-1\">Please select a specific workflow to view the Kanban board.</p>\n                  </div>\n                ) : (\n                  <div className=\"flex space-x-4 min-w-max p-1\">\n                    {currentWorkflowStages.map((stage) => (\n                      <div\n                        key={stage.id}\n                        className=\"w-80 bg-gray-50 rounded-lg flex flex-col max-h-[calc(100vh-250px)]\"\n                        onDragOver={handleDragOver}\n                        onDrop={(e) => handleDrop(e, stage.id)}\n                      >\n                        {/* Column Header */}\n                        <div className=\"p-3 border-b border-gray-200 flex justify-between items-center bg-white rounded-t-lg\">\n                          <h3 className=\"font-medium text-gray-900\">{stage.name}</h3>\n                          <span className=\"bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded-full\">\n                            {filteredApplications.filter(app => app.current_stage_id === stage.id).length}\n                          </span>\n                        </div>\n\n                        {/* Cards Container */}\n                        <div className=\"p-3 flex-1 overflow-y-auto space-y-3\">\n                          {filteredApplications\n                            .filter(app => app.current_stage_id === stage.id)\n                            .map((app) => (\n                              <div\n                                key={app.id}\n                                draggable\n                                onDragStart={(e) => handleDragStart(e, app.id)}\n                                className=\"bg-white p-3 rounded-lg shadow-sm border border-gray-200 cursor-move hover:shadow-md transition\"\n                              >\n                                <div className=\"flex justify-between items-start mb-2\">\n                                  <h4 className=\"font-medium text-gray-900\">{app.applicant_first_name} {app.applicant_last_name}</h4>\n                                  <div className=\"flex flex-col items-end gap-1\">\n                                    {app.ai_score !== undefined && app.ai_score !== null && (\n                                      <span className={`text-[10px] font-bold px-1.5 py-0.5 rounded-full flex items-center ${app.ai_score >= 80 ? 'bg-green-100 text-green-700 border border-green-200' :\n                                        app.ai_score >= 50 ? 'bg-blue-100 text-blue-700 border border-blue-200' :\n                                          'bg-gray-100 text-gray-600 border border-gray-200'\n                                        }`}>\n                                        <Zap className=\"w-2 h-2 mr-0.5\" />\n                                        {app.ai_score}%\n                                      </span>\n                                    )}\n                                    {app.score && !app.ai_score && (\n                                      <span className=\"text-[10px] font-semibold bg-gray-50 text-gray-600 px-1.5 py-0.5 rounded border border-gray-100\">\n                                        {app.score}%\n                                      </span>\n                                    )}\n                                  </div>\n                                </div>\n                                <p className=\"text-xs text-gray-500 mb-2\">{app.job_postings?.job_title}</p>\n                                <div className=\"flex justify-between items-center mt-3 pt-2 border-t border-gray-50\">\n                                  <span className=\"text-xs text-gray-400\">{format(new Date(app.applied_at), 'MMM d')}</span>\n                                  <div className=\"flex space-x-1\">\n                                    <button\n                                      onClick={() => viewApplicationDetails(app)}\n                                      className=\"p-1 text-gray-400 hover:text-indigo-600 rounded\"\n                                    >\n                                      <Eye className=\"w-3.5 h-3.5\" />\n                                    </button>\n                                    <button\n                                      onClick={() => scheduleInterviewForApplication(app)}\n                                      className=\"p-1 text-gray-400 hover:text-blue-600 rounded\"\n                                    >\n                                      <Calendar className=\"w-3.5 h-3.5\" />\n                                    </button>\n                                  </div>\n                                </div>\n                              </div>\n                            ))}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </div>\n            )}\n\n            {/* Interviews Table */}\n            {activeTab === 'interviews' && (\n              <div className=\"overflow-x-auto\">\n                <table className=\"min-w-full divide-y divide-gray-200\">\n                  <thead className=\"bg-gray-50\">\n                    <tr>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Application ID</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Interview Type</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Scheduled Date</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Rating</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"bg-white divide-y divide-gray-200\">\n                    {interviews.length > 0 ? (\n                      interviews.map((interview) => (\n                        <tr key={interview.id} className=\"hover:bg-gray-50\">\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                            {interview.application_id.substring(0, 8)}...\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900 capitalize\">\n                            {interview.interview_type.replace('_', ' ')}\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                            {format(new Date(interview.scheduled_date), 'MMM dd, yyyy HH:mm')}\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\n                            <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${interview.status === 'completed' ? 'bg-green-100 text-green-800' :\n                              interview.status === 'cancelled' ? 'bg-red-100 text-red-800' :\n                                'bg-blue-100 text-blue-800'\n                              }`}>\n                              {interview.status}\n                            </span>\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                            {interview.rating ? `${interview.rating}/5` : 'N/A'}\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\n                            <button\n                              onClick={() => rescheduleInterview(interview)}\n                              className=\"text-indigo-600 hover:text-indigo-900 mr-3 p-1 rounded\"\n                              title=\"Reschedule Interview\"\n                            >\n                              <Calendar className=\"w-4 h-4\" />\n                            </button>\n                            <button\n                              onClick={() => editInterview(interview)}\n                              className=\"text-gray-600 hover:text-gray-900 mr-3 p-1 rounded\"\n                              title=\"Edit Interview\"\n                            >\n                              <Edit className=\"w-4 h-4\" />\n                            </button>\n                            <button\n                              onClick={() => {\n                                if (window.confirm('Mark this interview as completed?')) {\n                                  setToast({ message: 'Interview marked as completed', type: 'success' });\n                                }\n                              }}\n                              className=\"text-green-600 hover:text-green-900 p-1 rounded\"\n                              title=\"Mark Complete\"\n                            >\n                              <CheckCircle className=\"w-4 h-4\" />\n                            </button>\n                          </td>\n                        </tr>\n                      ))\n                    ) : (\n                      <tr>\n                        <td colSpan={6} className=\"px-6 py-12 text-center text-sm text-gray-500\">\n                          No interviews scheduled\n                        </td>\n                      </tr>\n                    )}\n                  </tbody>\n                </table>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n\n      {/* Modals & Overlays */}\n      <div key=\"modals-and-overlays\">\n        <AddJobModal\n          isOpen={showAddJobModal}\n          onClose={() => setShowAddJobModal(false)}\n          onSuccess={handleSuccess}\n          onError={handleError}\n          job={selectedJob}\n        />\n        <AddApplicationModal\n          isOpen={showAddApplicationModal}\n          onClose={() => setShowAddApplicationModal(false)}\n          onSuccess={handleSuccess}\n          onError={handleError}\n        />\n        <AddInterviewModal\n          isOpen={showAddInterviewModal}\n          onClose={() => setShowAddInterviewModal(false)}\n          onSuccess={handleSuccess}\n          onError={handleError}\n          interview={selectedInterview}\n        />\n        <ApplicationDetailsModal\n          application={selectedApplication}\n          isOpen={!!selectedApplication}\n          onClose={() => setSelectedApplication(null)}\n          onUpdate={() => {\n            loadData();\n          }}\n          onAiScreen={handleAiScreen}\n          onConvertToEmployee={handleConvertToEmployee}\n          onGenerateDocument={handleGenerateDocument}\n        />\n\n        {/* Bulk Action Bar */}\n        {selectedApplications.length > 0 && (\n          <div className=\"fixed bottom-8 left-1/2 transform -translate-x-1/2 z-40 bg-white shadow-2xl rounded-full px-6 py-4 border border-indigo-100 flex items-center space-x-6 animate-in slide-in-from-bottom-8\">\n            <div className=\"flex items-center space-x-2\">\n              <span className=\"bg-indigo-600 text-white text-xs font-bold px-2 py-1 rounded-full\">\n                {selectedApplications.length}\n              </span>\n              <span className=\"text-sm font-medium text-gray-700\">Selected</span>\n            </div>\n            <div className=\"h-6 w-px bg-gray-200\"></div>\n            <div className=\"flex items-center space-x-3\">\n              <button\n                onClick={handleBulkAiScreen}\n                disabled={isScreeningBulk}\n                className=\"flex items-center px-4 py-2 bg-indigo-600 text-white text-sm font-bold rounded-full hover:bg-indigo-700 transition disabled:opacity-50\"\n              >\n                {isScreeningBulk ? (\n                  <>\n                    <Clock className=\"w-4 h-4 mr-2 animate-spin\" />\n                    Screening {screeningProgress.current}/{screeningProgress.total}...\n                  </>\n                ) : (\n                  <>\n                    <Zap className=\"w-4 h-4 mr-2\" />\n                    AI Screen Bulk\n                  </>\n                )}\n              </button>\n              <button\n                onClick={() => setSelectedApplications([])}\n                className=\"text-sm text-gray-500 hover:text-gray-700 transition\"\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        )}\n\n        {/* Toast Notification */}\n        {toast && (\n          <Toast\n            message={toast.message}\n            type={toast.type}\n            onClose={() => setToast(null)}\n          />\n        )}\n      </div>\n    </div>\n  );\n}\n\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/RecruitmentPageRefactored.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'log' is defined but never used. Allowed unused vars must match /^_/u.","line":25,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":65,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":65,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'app' is defined but never used. Allowed unused args must match /^_/u.","line":113,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":113,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * RecruitmentPage - Refactored Version\n * \n * Uses the new component-based architecture with React Query hooks\n * Significantly reduced from ~1000 lines to ~400 lines\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { Plus, Search, LayoutList, Kanban, Filter } from 'lucide-react';\nimport { supabase } from '@/lib/supabase';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { \n  JobsTable, \n  ApplicationsTable, \n  InterviewsTable, \n  ApplicationKanbanBoard \n} from '@/components/recruitment';\nimport { useJobs, Application, JobPosting, Interview } from '@/hooks';\nimport AddJobModal from '@/components/AddJobModal';\nimport AddApplicationModal from '@/components/AddApplicationModal';\nimport AddInterviewModal from '@/components/AddInterviewModal';\nimport Toast from '@/components/Toast';\nimport ApplicationDetailsModal from './ApplicationDetailsModal';\nimport { callEmployeeCrud } from '@/lib/employeeCrud';\nimport { log } from '@/lib/logger';\n\ntype TabType = 'jobs' | 'applications' | 'interviews';\ntype ViewType = 'list' | 'board';\n\ninterface WorkflowStage {\n  id: string;\n  name: string;\n  workflow_id: string;\n  stage_order: number;\n}\n\ninterface Workflow {\n  id: string;\n  name: string;\n}\n\nexport default function RecruitmentPageRefactored() {\n  const [activeTab, setActiveTab] = useState<TabType>('jobs');\n  const [viewType, setViewType] = useState<ViewType>('list');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedWorkflowId, setSelectedWorkflowId] = useState<string>('all');\n  const [selectedJobId, setSelectedJobId] = useState<string>('all');\n  const [selectedStageId, setSelectedStageId] = useState<string>('all');\n  \n  // Modal states\n  const [showAddJobModal, setShowAddJobModal] = useState(false);\n  const [showAddApplicationModal, setShowAddApplicationModal] = useState(false);\n  const [showAddInterviewModal, setShowAddInterviewModal] = useState(false);\n  const [selectedJob, setSelectedJob] = useState<JobPosting | null>(null);\n  const [selectedInterview, setSelectedInterview] = useState<Interview | null>(null);\n  const [selectedApplication, setSelectedApplication] = useState<Application | null>(null);\n  \n  // Toast state\n  const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' | 'warning' } | null>(null);\n  \n  // Supporting data\n  const [workflows, setWorkflows] = useState<Workflow[]>([]);\n  const [workflowStages, setWorkflowStages] = useState<WorkflowStage[]>([]);\n  \n  const { user } = useAuth();\n  const { data: jobs = [] } = useJobs();\n\n  // Load workflows and stages on mount\n  useEffect(() => {\n    loadWorkflowsAndStages();\n  }, []);\n\n  async function loadWorkflowsAndStages() {\n    const { data: wfData } = await supabase.from('recruitment_workflows').select('*');\n    if (wfData) setWorkflows(wfData);\n\n    const { data: stageData } = await supabase.from('workflow_stages').select('*').order('stage_order');\n    if (stageData) setWorkflowStages(stageData);\n  }\n\n  // Toast handlers\n  const showSuccess = (message: string) => setToast({ message, type: 'success' });\n  const showError = (message: string) => setToast({ message, type: 'error' });\n\n  // Modal handlers\n  function handleAddNew() {\n    if (activeTab === 'jobs') {\n      setSelectedJob(null);\n      setShowAddJobModal(true);\n    } else if (activeTab === 'applications') {\n      setShowAddApplicationModal(true);\n    } else if (activeTab === 'interviews') {\n      setSelectedInterview(null);\n      setShowAddInterviewModal(true);\n    }\n  }\n\n  // Job handlers\n  const handleEditJob = (job: JobPosting) => {\n    setSelectedJob(job);\n    setShowAddJobModal(true);\n  };\n\n  const handleViewJob = (job: JobPosting) => {\n    alert(`Job Details:\\n\\nTitle: ${job.job_title}\\nDepartment: ${job.department}\\nType: ${job.employment_type}\\nDescription: ${job.job_description || 'No description available'}\\nLocation: ${job.location || 'Remote'}\\nSalary: ${job.salary_range_min && job.salary_range_max ? `$${job.salary_range_min} - $${job.salary_range_max}` : 'Not specified'}`);\n  };\n\n  // Application handlers\n  const handleViewApplication = (app: Application) => {\n    setSelectedApplication(app);\n  };\n\n  const handleScheduleInterview = (app: Application) => {\n    setSelectedInterview(null);\n    setShowAddInterviewModal(true);\n  };\n\n  // Interview handlers\n  const handleEditInterview = (interview: Interview) => {\n    setSelectedInterview(interview);\n    setShowAddInterviewModal(true);\n  };\n\n  const handleRescheduleInterview = (interview: Interview) => {\n    setSelectedInterview(interview);\n    setShowAddInterviewModal(true);\n  };\n\n  // AI and document handlers (keeping original functionality)\n  async function handleAiScreen(application: Application) {\n    try {\n      const { data, error } = await supabase.functions.invoke('ai-screen-resume', {\n        body: { application_id: application.id },\n      });\n\n      if (error) throw error;\n      if (data && data.error) throw new Error(data.error);\n\n      showSuccess('AI screening completed successfully!');\n    } catch (error: any) {\n      showError(error.message || 'Failed to start AI screening');\n    }\n  }\n\n  async function handleGenerateDocument(application: Application, templateId: string) {\n    try {\n      const { error } = await supabase.functions.invoke('generate-document', {\n        body: { template_id: templateId, application_id: application.id },\n      });\n\n      if (error) throw error;\n      showSuccess('Document generated successfully!');\n    } catch (error: any) {\n      showError(error.message || 'Failed to generate document');\n    }\n  }\n\n  async function handleConvertToEmployee(application: Application) {\n    if (!window.confirm(`Convert ${application.applicant_first_name} ${application.applicant_last_name} to an employee?`)) {\n      return;\n    }\n\n    try {\n      await callEmployeeCrud('create', {\n        first_name: application.applicant_first_name,\n        last_name: application.applicant_last_name,\n        email: application.applicant_email,\n        phone: application.applicant_phone,\n        position: (application as any).job_postings?.job_title,\n        department: (application as any).job_postings?.department,\n        status: 'active',\n      });\n      showSuccess('Candidate converted to employee!');\n      setSelectedApplication(null);\n    } catch (error: any) {\n      showError(error.message || 'Failed to convert candidate');\n    }\n  }\n\n  const tabs = [\n    { id: 'jobs', label: 'Job Postings' },\n    { id: 'applications', label: 'Applications' },\n    { id: 'interviews', label: 'Interviews' },\n  ];\n\n  return (\n    <div>\n      {/* Header */}\n      <div className=\"mb-8 flex flex-col sm:flex-row sm:items-center sm:justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Recruitment Module</h1>\n          <p className=\"mt-1 text-sm text-gray-600\">Manage job postings, applications, and interviews</p>\n        </div>\n\n        <button\n          onClick={handleAddNew}\n          className=\"mt-4 sm:mt-0 inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition\"\n        >\n          <Plus className=\"w-4 h-4 mr-2\" />\n          {activeTab === 'jobs' ? 'New Job Posting' : activeTab === 'interviews' ? 'Schedule Interview' : 'Add Application'}\n        </button>\n      </div>\n\n      {/* Tabs */}\n      <div className=\"mb-6 border-b border-gray-200 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\n        <nav className=\"-mb-px flex space-x-8\">\n          {tabs.map((tab) => (\n            <button\n              key={tab.id}\n              onClick={() => setActiveTab(tab.id as TabType)}\n              className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition ${\n                activeTab === tab.id\n                  ? 'border-indigo-500 text-indigo-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n              }`}\n            >\n              {tab.label}\n            </button>\n          ))}\n        </nav>\n\n        {/* Application Filters & View Toggle */}\n        {activeTab === 'applications' && (\n          <div className=\"flex items-center space-x-4\">\n            <div className=\"flex items-center space-x-2\">\n              <Filter className=\"w-4 h-4 text-gray-500\" />\n              <select\n                value={selectedWorkflowId}\n                onChange={(e) => setSelectedWorkflowId(e.target.value)}\n                className=\"text-sm border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500\"\n              >\n                <option value=\"all\">All Workflows</option>\n                {workflows.map(wf => (\n                  <option key={wf.id} value={wf.id}>{wf.name}</option>\n                ))}\n              </select>\n            </div>\n\n            <select\n              value={selectedJobId}\n              onChange={(e) => setSelectedJobId(e.target.value)}\n              className=\"text-sm border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 max-w-[150px]\"\n            >\n              <option value=\"all\">All Jobs</option>\n              {jobs.map(job => (\n                <option key={job.id} value={job.id}>{job.job_title}</option>\n              ))}\n            </select>\n\n            <select\n              value={selectedStageId}\n              onChange={(e) => setSelectedStageId(e.target.value)}\n              className=\"text-sm border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 max-w-[150px]\"\n            >\n              <option value=\"all\">All Stages</option>\n              {workflowStages.map(stage => (\n                <option key={stage.id} value={stage.id}>{stage.name}</option>\n              ))}\n            </select>\n\n            <div className=\"flex bg-gray-100 rounded-lg p-1\">\n              <button\n                onClick={() => setViewType('list')}\n                className={`p-2 rounded-md transition ${viewType === 'list' ? 'bg-white shadow-sm text-indigo-600' : 'text-gray-500 hover:text-gray-700'}`}\n                title=\"List View\"\n              >\n                <LayoutList className=\"w-4 h-4\" />\n              </button>\n              <button\n                onClick={() => setViewType('board')}\n                className={`p-2 rounded-md transition ${viewType === 'board' ? 'bg-white shadow-sm text-indigo-600' : 'text-gray-500 hover:text-gray-700'}`}\n                title=\"Board View\"\n              >\n                <Kanban className=\"w-4 h-4\" />\n              </button>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Search Bar */}\n      <div className=\"mb-6\">\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\n          <input\n            type=\"text\"\n            placeholder={`Search ${activeTab}...`}\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n          />\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className={`${viewType === 'board' && activeTab === 'applications' ? '' : 'bg-white rounded-xl shadow-sm border border-gray-200'}`}>\n        {/* Jobs Tab */}\n        {activeTab === 'jobs' && (\n          <JobsTable\n            searchTerm={searchTerm}\n            onAddNew={handleAddNew}\n            onEdit={handleEditJob}\n            onView={handleViewJob}\n            onSuccess={showSuccess}\n            onError={showError}\n          />\n        )}\n\n        {/* Applications Tab - List View */}\n        {activeTab === 'applications' && viewType === 'list' && (\n          <ApplicationsTable\n            searchTerm={searchTerm}\n            selectedJobId={selectedJobId}\n            selectedStageId={selectedStageId}\n            selectedWorkflowId={selectedWorkflowId}\n            workflowStages={workflowStages}\n            onAddNew={handleAddNew}\n            onView={handleViewApplication}\n            onScheduleInterview={handleScheduleInterview}\n            onSuccess={showSuccess}\n            onError={showError}\n          />\n        )}\n\n        {/* Applications Tab - Board View */}\n        {activeTab === 'applications' && viewType === 'board' && (\n          <ApplicationKanbanBoard\n            selectedWorkflowId={selectedWorkflowId}\n            selectedJobId={selectedJobId}\n            workflowStages={workflowStages}\n            searchTerm={searchTerm}\n            onViewApplication={handleViewApplication}\n            onScheduleInterview={handleScheduleInterview}\n            onSuccess={showSuccess}\n            onError={showError}\n          />\n        )}\n\n        {/* Interviews Tab */}\n        {activeTab === 'interviews' && (\n          <InterviewsTable\n            searchTerm={searchTerm}\n            onAddNew={handleAddNew}\n            onEdit={handleEditInterview}\n            onReschedule={handleRescheduleInterview}\n            onSuccess={showSuccess}\n            onError={showError}\n          />\n        )}\n      </div>\n\n      {/* Modals */}\n      <AddJobModal\n        isOpen={showAddJobModal}\n        onClose={() => setShowAddJobModal(false)}\n        onSuccess={() => {\n          showSuccess(selectedJob ? 'Job updated!' : 'Job created!');\n        }}\n        onError={showError}\n        job={selectedJob}\n      />\n      \n      <AddApplicationModal\n        isOpen={showAddApplicationModal}\n        onClose={() => setShowAddApplicationModal(false)}\n        onSuccess={() => showSuccess('Application added!')}\n        onError={showError}\n      />\n      \n      <AddInterviewModal\n        isOpen={showAddInterviewModal}\n        onClose={() => setShowAddInterviewModal(false)}\n        onSuccess={() => showSuccess(selectedInterview ? 'Interview updated!' : 'Interview scheduled!')}\n        onError={showError}\n        interview={selectedInterview}\n      />\n\n      {selectedApplication && (\n        <ApplicationDetailsModal\n          application={selectedApplication}\n          isOpen={!!selectedApplication}\n          onClose={() => setSelectedApplication(null)}\n          onUpdate={() => {\n            // Data will auto-refresh via React Query\n          }}\n          onAiScreen={handleAiScreen}\n          onConvertToEmployee={handleConvertToEmployee}\n          onGenerateDocument={handleGenerateDocument}\n        />\n      )}\n\n      {/* Toast Notification */}\n      {toast && (\n        <Toast\n          message={toast.message}\n          type={toast.type}\n          onClose={() => setToast(null)}\n        />\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/ReportsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Download' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Filter' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { useTenant } from '@/contexts/TenantContext';\nimport {\n    FileText, Download, Calendar, Users, Shield, TrendingUp,\n    Briefcase, Clock, Filter, Play, CheckCircle, Loader2, Eye\n} from 'lucide-react';\nimport { format, subDays, subMonths, startOfMonth, endOfMonth } from 'date-fns';\nimport { downloadCSV } from '@/components/ExportButton';\nimport { log } from '@/lib/logger';\n\ninterface ReportConfig {\n    id: string;\n    name: string;\n    description: string;\n    icon: React.ReactNode;\n    category: 'hr' | 'recruitment' | 'compliance' | 'performance';\n    dataSource: string;\n    columns: { key: string; label: string }[];\n}\n\nexport default function ReportsPage() {\n    const { currentTenant } = useTenant();\n    const [selectedReport, setSelectedReport] = useState<ReportConfig | null>(null);\n    const [dateRange, setDateRange] = useState({\n        start: format(subMonths(new Date(), 1), 'yyyy-MM-dd'),\n        end: format(new Date(), 'yyyy-MM-dd'),\n    });\n    const [loading, setLoading] = useState(false);\n    const [reportData, setReportData] = useState<Record<string, unknown>[] | null>(null);\n    const [presets, setPresets] = useState<'last7' | 'last30' | 'thisMonth' | 'lastMonth' | 'custom'>('last30');\n\n    const reports: ReportConfig[] = [\n        {\n            id: 'employee-roster',\n            name: 'Employee Roster',\n            description: 'Complete list of all employees with their details',\n            icon: <Users className=\"w-6 h-6\" />,\n            category: 'hr',\n            dataSource: 'employees',\n            columns: [\n                { key: 'first_name', label: 'First Name' },\n                { key: 'last_name', label: 'Last Name' },\n                { key: 'email', label: 'Email' },\n                { key: 'department', label: 'Department' },\n                { key: 'position', label: 'Position' },\n                { key: 'hire_date', label: 'Hire Date' },\n                { key: 'status', label: 'Status' },\n            ],\n        },\n        {\n            id: 'recruitment-pipeline',\n            name: 'Recruitment Pipeline',\n            description: 'All applications and their current status',\n            icon: <Briefcase className=\"w-6 h-6\" />,\n            category: 'recruitment',\n            dataSource: 'applications',\n            columns: [\n                { key: 'applicant_first_name', label: 'First Name' },\n                { key: 'applicant_last_name', label: 'Last Name' },\n                { key: 'applicant_email', label: 'Email' },\n                { key: 'status', label: 'Status' },\n                { key: 'created_at', label: 'Applied Date' },\n            ],\n        },\n        {\n            id: 'interview-schedule',\n            name: 'Interview Schedule',\n            description: 'Upcoming and past interview appointments',\n            icon: <Calendar className=\"w-6 h-6\" />,\n            category: 'recruitment',\n            dataSource: 'interviews',\n            columns: [\n                { key: 'candidate_name', label: 'Candidate' },\n                { key: 'scheduled_at', label: 'Scheduled Time' },\n                { key: 'interview_type', label: 'Type' },\n                { key: 'status', label: 'Status' },\n                { key: 'interviewer', label: 'Interviewer' },\n            ],\n        },\n        {\n            id: 'compliance-status',\n            name: 'Compliance Status',\n            description: 'DBS checks, training, and document compliance',\n            icon: <Shield className=\"w-6 h-6\" />,\n            category: 'compliance',\n            dataSource: 'dbs_checks',\n            columns: [\n                { key: 'employee_name', label: 'Employee' },\n                { key: 'check_type', label: 'Check Type' },\n                { key: 'status', label: 'Status' },\n                { key: 'issue_date', label: 'Issue Date' },\n                { key: 'expiry_date', label: 'Expiry Date' },\n            ],\n        },\n        {\n            id: 'training-report',\n            name: 'Training Report',\n            description: 'Employee training records and certifications',\n            icon: <CheckCircle className=\"w-6 h-6\" />,\n            category: 'compliance',\n            dataSource: 'training_records',\n            columns: [\n                { key: 'employee_name', label: 'Employee' },\n                { key: 'training_name', label: 'Training' },\n                { key: 'completion_date', label: 'Completed' },\n                { key: 'expiry_date', label: 'Expires' },\n                { key: 'status', label: 'Status' },\n            ],\n        },\n        {\n            id: 'performance-reviews',\n            name: 'Performance Reviews',\n            description: 'Employee performance review summaries',\n            icon: <TrendingUp className=\"w-6 h-6\" />,\n            category: 'performance',\n            dataSource: 'reviews',\n            columns: [\n                { key: 'employee_name', label: 'Employee' },\n                { key: 'review_period', label: 'Period' },\n                { key: 'overall_rating', label: 'Rating' },\n                { key: 'reviewer', label: 'Reviewer' },\n                { key: 'review_date', label: 'Date' },\n            ],\n        },\n        {\n            id: 'time-attendance',\n            name: 'Time & Attendance',\n            description: 'Employee clock in/out and work hours',\n            icon: <Clock className=\"w-6 h-6\" />,\n            category: 'hr',\n            dataSource: 'time_entries',\n            columns: [\n                { key: 'employee_name', label: 'Employee' },\n                { key: 'date', label: 'Date' },\n                { key: 'clock_in', label: 'Clock In' },\n                { key: 'clock_out', label: 'Clock Out' },\n                { key: 'total_hours', label: 'Total Hours' },\n            ],\n        },\n    ];\n\n    function handlePresetChange(preset: typeof presets) {\n        setPresets(preset);\n        const today = new Date();\n\n        switch (preset) {\n            case 'last7':\n                setDateRange({\n                    start: format(subDays(today, 7), 'yyyy-MM-dd'),\n                    end: format(today, 'yyyy-MM-dd'),\n                });\n                break;\n            case 'last30':\n                setDateRange({\n                    start: format(subDays(today, 30), 'yyyy-MM-dd'),\n                    end: format(today, 'yyyy-MM-dd'),\n                });\n                break;\n            case 'thisMonth':\n                setDateRange({\n                    start: format(startOfMonth(today), 'yyyy-MM-dd'),\n                    end: format(today, 'yyyy-MM-dd'),\n                });\n                break;\n            case 'lastMonth':\n                const lastMonth = subMonths(today, 1);\n                setDateRange({\n                    start: format(startOfMonth(lastMonth), 'yyyy-MM-dd'),\n                    end: format(endOfMonth(lastMonth), 'yyyy-MM-dd'),\n                });\n                break;\n        }\n    }\n\n    async function generateReport() {\n        if (!selectedReport || !currentTenant) return;\n\n        setLoading(true);\n        setReportData(null);\n\n        try {\n            const { data, error } = await supabase\n                .from(selectedReport.dataSource)\n                .select('*')\n                .eq('tenant_id', currentTenant.id)\n                .gte('created_at', dateRange.start)\n                .lte('created_at', dateRange.end)\n                .order('created_at', { ascending: false });\n\n            if (error) throw error;\n            setReportData(data || []);\n        } catch (error) {\n            log.error('Error generating report', error, { component: 'ReportsPage', action: 'generateReport', metadata: { reportId: selectedReport.id, dataSource: selectedReport.dataSource } });\n            // Generate mock data\n            setReportData(generateMockData(selectedReport));\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    function generateMockData(report: ReportConfig): Record<string, unknown>[] {\n        const count = Math.floor(Math.random() * 20) + 10;\n        return Array.from({ length: count }, (_, i) => {\n            const row: Record<string, unknown> = {};\n            report.columns.forEach(col => {\n                if (col.key.includes('name')) {\n                    row[col.key] = ['John Smith', 'Sarah Johnson', 'Michael Chen', 'Emma Wilson'][Math.floor(Math.random() * 4)];\n                } else if (col.key.includes('email')) {\n                    row[col.key] = `user${i}@company.com`;\n                } else if (col.key.includes('date') || col.key.includes('_at')) {\n                    row[col.key] = format(subDays(new Date(), Math.floor(Math.random() * 30)), 'yyyy-MM-dd');\n                } else if (col.key === 'status') {\n                    row[col.key] = ['Active', 'Pending', 'Completed', 'Expired'][Math.floor(Math.random() * 4)];\n                } else if (col.key.includes('rating')) {\n                    row[col.key] = (Math.random() * 2 + 3).toFixed(1);\n                } else if (col.key === 'department') {\n                    row[col.key] = ['Engineering', 'Sales', 'HR', 'Operations'][Math.floor(Math.random() * 4)];\n                } else if (col.key === 'position') {\n                    row[col.key] = ['Manager', 'Developer', 'Analyst', 'Director'][Math.floor(Math.random() * 4)];\n                } else {\n                    row[col.key] = `Value ${i}`;\n                }\n            });\n            return row;\n        });\n    }\n\n    function exportReport(exportFormat: 'csv' | 'excel' | 'pdf') {\n        if (!reportData || !selectedReport) return;\n\n        if (exportFormat === 'csv') {\n            downloadCSV(reportData, selectedReport.columns, selectedReport.name);\n        } else if (exportFormat === 'pdf') {\n            // Generate printable HTML\n            const html = `\n<!DOCTYPE html>\n<html>\n<head>\n  <title>${selectedReport.name}</title>\n  <style>\n    body { font-family: Arial, sans-serif; padding: 40px; }\n    h1 { color: #1f2937; margin-bottom: 10px; }\n    .meta { color: #6b7280; font-size: 14px; margin-bottom: 20px; }\n    table { width: 100%; border-collapse: collapse; margin-top: 20px; }\n    th, td { border: 1px solid #e5e7eb; padding: 10px; text-align: left; font-size: 13px; }\n    th { background-color: #4f46e5; color: white; }\n    tr:nth-child(even) { background-color: #f9fafb; }\n    .footer { margin-top: 30px; font-size: 12px; color: #9ca3af; }\n  </style>\n</head>\n<body>\n  <h1>${selectedReport.name}</h1>\n  <div class=\"meta\">\n    Generated on ${format(new Date(), 'PPP')} | Period: ${dateRange.start} to ${dateRange.end}\n  </div>\n  <table>\n    <thead>\n      <tr>${selectedReport.columns.map(c => `<th>${c.label}</th>`).join('')}</tr>\n    </thead>\n    <tbody>\n      ${reportData.map(row => `\n        <tr>${selectedReport.columns.map(c => `<td>${row[c.key] || '-'}</td>`).join('')}</tr>\n      `).join('')}\n    </tbody>\n  </table>\n  <div class=\"footer\">\n    <p>Total Records: ${reportData.length}</p>\n    <p>Report generated by NovumFlow HR Platform</p>\n  </div>\n</body>\n</html>`;\n\n            const printWindow = window.open('', '_blank');\n            if (printWindow) {\n                printWindow.document.write(html);\n                printWindow.document.close();\n                printWindow.focus();\n                setTimeout(() => printWindow.print(), 250);\n            }\n        }\n    }\n\n    const categories = ['hr', 'recruitment', 'compliance', 'performance'];\n\n    return (\n        <div className=\"space-y-8\">\n            <div>\n                <h1 className=\"text-3xl font-bold text-gray-900\">Reports</h1>\n                <p className=\"mt-1 text-sm text-gray-600\">Generate and export various HR and recruitment reports</p>\n            </div>\n\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n                {/* Report Selection */}\n                <div className=\"lg:col-span-1\">\n                    <div className=\"bg-white rounded-xl border border-gray-200 overflow-hidden\">\n                        <div className=\"px-6 py-4 border-b border-gray-200\">\n                            <h2 className=\"font-semibold text-gray-900\">Available Reports</h2>\n                        </div>\n                        <div className=\"divide-y divide-gray-100\">\n                            {categories.map(category => (\n                                <div key={category}>\n                                    <div className=\"px-6 py-2 bg-gray-50\">\n                                        <p className=\"text-xs font-semibold text-gray-500 uppercase\">{category}</p>\n                                    </div>\n                                    {reports.filter(r => r.category === category).map(report => (\n                                        <button\n                                            key={report.id}\n                                            onClick={() => {\n                                                setSelectedReport(report);\n                                                setReportData(null);\n                                            }}\n                                            className={`w-full flex items-center px-6 py-3 hover:bg-gray-50 transition ${selectedReport?.id === report.id ? 'bg-indigo-50 border-l-4 border-indigo-600' : ''\n                                                }`}\n                                        >\n                                            <div className={`p-2 rounded-lg ${selectedReport?.id === report.id ? 'bg-indigo-100 text-indigo-600' : 'bg-gray-100 text-gray-600'\n                                                }`}>\n                                                {report.icon}\n                                            </div>\n                                            <div className=\"ml-3 text-left\">\n                                                <p className={`text-sm font-medium ${selectedReport?.id === report.id ? 'text-indigo-600' : 'text-gray-900'\n                                                    }`}>\n                                                    {report.name}\n                                                </p>\n                                                <p className=\"text-xs text-gray-500\">{report.description}</p>\n                                            </div>\n                                        </button>\n                                    ))}\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n                </div>\n\n                {/* Report Configuration & Results */}\n                <div className=\"lg:col-span-2 space-y-6\">\n                    {selectedReport ? (\n                        <>\n                            {/* Report Config */}\n                            <div className=\"bg-white rounded-xl border border-gray-200 p-6\">\n                                <div className=\"flex items-center justify-between mb-4\">\n                                    <div>\n                                        <h2 className=\"text-lg font-semibold text-gray-900\">{selectedReport.name}</h2>\n                                        <p className=\"text-sm text-gray-500\">{selectedReport.description}</p>\n                                    </div>\n                                    <div className=\"flex items-center space-x-2\">\n                                        {reportData && (\n                                            <>\n                                                <button\n                                                    onClick={() => exportReport('csv')}\n                                                    className=\"px-3 py-1.5 text-sm bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition\"\n                                                >\n                                                    CSV\n                                                </button>\n                                                <button\n                                                    onClick={() => exportReport('pdf')}\n                                                    className=\"px-3 py-1.5 text-sm bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition\"\n                                                >\n                                                    PDF\n                                                </button>\n                                            </>\n                                        )}\n                                    </div>\n                                </div>\n\n                                {/* Date Range */}\n                                <div className=\"mb-4\">\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">Date Range</label>\n                                    <div className=\"flex flex-wrap gap-2 mb-3\">\n                                        {(['last7', 'last30', 'thisMonth', 'lastMonth', 'custom'] as const).map(preset => (\n                                            <button\n                                                key={preset}\n                                                onClick={() => handlePresetChange(preset)}\n                                                className={`px-3 py-1.5 text-sm rounded-lg transition ${presets === preset\n                                                    ? 'bg-indigo-100 text-indigo-700 font-medium'\n                                                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n                                                    }`}\n                                            >\n                                                {preset === 'last7' && 'Last 7 Days'}\n                                                {preset === 'last30' && 'Last 30 Days'}\n                                                {preset === 'thisMonth' && 'This Month'}\n                                                {preset === 'lastMonth' && 'Last Month'}\n                                                {preset === 'custom' && 'Custom'}\n                                            </button>\n                                        ))}\n                                    </div>\n                                    <div className=\"flex items-center space-x-4\">\n                                        <input\n                                            type=\"date\"\n                                            value={dateRange.start}\n                                            onChange={(e) => {\n                                                setDateRange({ ...dateRange, start: e.target.value });\n                                                setPresets('custom');\n                                            }}\n                                            className=\"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none\"\n                                        />\n                                        <span className=\"text-gray-500\">to</span>\n                                        <input\n                                            type=\"date\"\n                                            value={dateRange.end}\n                                            onChange={(e) => {\n                                                setDateRange({ ...dateRange, end: e.target.value });\n                                                setPresets('custom');\n                                            }}\n                                            className=\"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none\"\n                                        />\n                                    </div>\n                                </div>\n\n                                <button\n                                    onClick={generateReport}\n                                    disabled={loading}\n                                    className=\"w-full flex items-center justify-center px-4 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50\"\n                                >\n                                    {loading ? (\n                                        <>\n                                            <Loader2 className=\"w-5 h-5 mr-2 animate-spin\" />\n                                            Generating Report...\n                                        </>\n                                    ) : (\n                                        <>\n                                            <Play className=\"w-5 h-5 mr-2\" />\n                                            Generate Report\n                                        </>\n                                    )}\n                                </button>\n                            </div>\n\n                            {/* Report Results */}\n                            {reportData && (\n                                <div className=\"bg-white rounded-xl border border-gray-200 overflow-hidden\">\n                                    <div className=\"px-6 py-4 border-b border-gray-200 flex items-center justify-between\">\n                                        <div>\n                                            <h3 className=\"font-semibold text-gray-900\">Report Results</h3>\n                                            <p className=\"text-sm text-gray-500\">{reportData.length} records found</p>\n                                        </div>\n                                        <button className=\"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center\">\n                                            <Eye className=\"w-4 h-4 mr-1\" />\n                                            Preview\n                                        </button>\n                                    </div>\n                                    <div className=\"overflow-x-auto\">\n                                        <table className=\"w-full\">\n                                            <thead className=\"bg-gray-50\">\n                                                <tr>\n                                                    {selectedReport.columns.map(col => (\n                                                        <th key={col.key} className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\n                                                            {col.label}\n                                                        </th>\n                                                    ))}\n                                                </tr>\n                                            </thead>\n                                            <tbody className=\"divide-y divide-gray-100\">\n                                                {reportData.slice(0, 10).map((row, i) => (\n                                                    <tr key={i} className=\"hover:bg-gray-50\">\n                                                        {selectedReport.columns.map(col => (\n                                                            <td key={col.key} className=\"px-6 py-4 text-sm text-gray-700\">\n                                                                {String(row[col.key] ?? '-')}\n                                                            </td>\n                                                        ))}\n                                                    </tr>\n                                                ))}\n                                            </tbody>\n                                        </table>\n                                    </div>\n                                    {reportData.length > 10 && (\n                                        <div className=\"px-6 py-3 bg-gray-50 text-center text-sm text-gray-500\">\n                                            Showing 10 of {reportData.length} records. Export to view all.\n                                        </div>\n                                    )}\n                                </div>\n                            )}\n                        </>\n                    ) : (\n                        <div className=\"bg-white rounded-xl border border-gray-200 p-12 text-center\">\n                            <FileText className=\"w-16 h-16 mx-auto text-gray-300 mb-4\" />\n                            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Select a Report</h3>\n                            <p className=\"text-gray-500\">Choose a report from the list to configure and generate</p>\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/ResetPasswordPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/ServiceUnavailablePage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/SettingsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Upload' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Mail' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { Save, Upload, Building2, Mail } from 'lucide-react';\nimport EmailTemplateEditor from '../components/EmailTemplateEditor';\nimport { log } from '@/lib/logger';\n\ninterface CompanySettings {\n  id: string;\n  company_name?: string;\n  company_email?: string;\n  company_phone?: string;\n  company_website?: string;\n  company_address?: string;\n  working_hours_start?: string;\n  working_hours_end?: string;\n  annual_leave_days?: number;\n  sick_leave_days?: number;\n  timezone?: string;\n  currency?: string;\n  [key: string]: unknown;\n}\n\nexport default function SettingsPage() {\n  const [companySettings, setCompanySettings] = useState<CompanySettings | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [saving, setSaving] = useState(false);\n  const [message, setMessage] = useState('');\n  const { user } = useAuth();\n\n  useEffect(() => {\n    loadSettings();\n  }, []);\n\n  async function loadSettings() {\n    setLoading(true);\n    try {\n      const { data } = await supabase\n        .from('company_settings')\n        .select('*')\n        .maybeSingle();\n\n      if (data) {\n        setCompanySettings(data);\n      }\n    } catch (error) {\n      log.error('Error loading settings', error, { component: 'SettingsPage' });\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function handleSave(e: React.FormEvent) {\n    e.preventDefault();\n    setSaving(true);\n    setMessage('');\n\n    try {\n      const { error } = await supabase\n        .from('company_settings')\n        .update({\n          ...companySettings,\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', companySettings.id);\n\n      if (error) throw error;\n\n      // Log action\n      await supabase.from('audit_logs').insert({\n        user_id: user?.id,\n        action: 'UPDATE_COMPANY_SETTINGS',\n        entity_type: 'company_settings',\n        entity_id: companySettings.id,\n        timestamp: new Date().toISOString()\n      });\n\n      log.track('settings_updated', {\n        component: 'SettingsPage',\n        userId: user?.id\n      });\n\n      setMessage('Settings saved successfully!');\n      setTimeout(() => setMessage(''), 3000);\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n      setMessage('Error saving settings: ' + errorMessage);\n      log.error('Error saving settings', error, { component: 'SettingsPage' });\n    } finally {\n      setSaving(false);\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600\"></div>\n      </div>\n    );\n  }\n\n  if (!companySettings) {\n    return (\n      <div className=\"text-center py-12\">\n        <p className=\"text-gray-500\">No company settings found</p>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold text-gray-900\">Company Settings</h1>\n        <p className=\"mt-1 text-sm text-gray-600\">Manage your organization's configuration and preferences</p>\n      </div>\n\n      {message && (\n        <div className={`mb-6 p-4 rounded-lg ${message.includes('Error') ? 'bg-red-50 text-red-700' : 'bg-green-50 text-green-700'\n          }`}>\n          {message}\n        </div>\n      )}\n\n      <form onSubmit={handleSave} className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-8\">\n        <div className=\"space-y-6\">\n          {/* Company Information */}\n          <div>\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n              <Building2 className=\"w-5 h-5 mr-2\" />\n              Company Information\n            </h2>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Company Name\n                </label>\n                <input\n                  type=\"text\"\n                  value={companySettings.company_name || ''}\n                  onChange={(e) => setCompanySettings({ ...companySettings, company_name: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Company Email\n                </label>\n                <input\n                  type=\"email\"\n                  value={companySettings.company_email || ''}\n                  onChange={(e) => setCompanySettings({ ...companySettings, company_email: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Company Phone\n                </label>\n                <input\n                  type=\"tel\"\n                  value={companySettings.company_phone || ''}\n                  onChange={(e) => setCompanySettings({ ...companySettings, company_phone: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Company Website\n                </label>\n                <input\n                  type=\"url\"\n                  value={companySettings.company_website || ''}\n                  onChange={(e) => setCompanySettings({ ...companySettings, company_website: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n                />\n              </div>\n\n              <div className=\"md:col-span-2\">\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Company Address\n                </label>\n                <textarea\n                  value={companySettings.company_address || ''}\n                  onChange={(e) => setCompanySettings({ ...companySettings, company_address: e.target.value })}\n                  rows={3}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Working Hours */}\n          <div className=\"pt-6 border-t border-gray-200\">\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Working Hours & Policies</h2>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Working Hours Start\n                </label>\n                <input\n                  type=\"time\"\n                  value={companySettings.working_hours_start || ''}\n                  onChange={(e) => setCompanySettings({ ...companySettings, working_hours_start: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Working Hours End\n                </label>\n                <input\n                  type=\"time\"\n                  value={companySettings.working_hours_end || ''}\n                  onChange={(e) => setCompanySettings({ ...companySettings, working_hours_end: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Annual Leave Days\n                </label>\n                <input\n                  type=\"number\"\n                  value={companySettings.annual_leave_days || 0}\n                  onChange={(e) => setCompanySettings({ ...companySettings, annual_leave_days: parseInt(e.target.value) })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Sick Leave Days\n                </label>\n                <input\n                  type=\"number\"\n                  value={companySettings.sick_leave_days || 0}\n                  onChange={(e) => setCompanySettings({ ...companySettings, sick_leave_days: parseInt(e.target.value) })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Timezone\n                </label>\n                <input\n                  type=\"text\"\n                  value={companySettings.timezone || ''}\n                  onChange={(e) => setCompanySettings({ ...companySettings, timezone: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n                  placeholder=\"e.g., UTC, America/New_York\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Currency\n                </label>\n                <select\n                  value={companySettings.currency || 'USD'}\n                  onChange={(e) => setCompanySettings({ ...companySettings, currency: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n                >\n                  <option value=\"USD\">USD</option>\n                  <option value=\"EUR\">EUR</option>\n                  <option value=\"GBP\">GBP</option>\n                  <option value=\"JPY\">JPY</option>\n                  <option value=\"AUD\">AUD</option>\n                  <option value=\"CAD\">CAD</option>\n                </select>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Save Button */}\n        <div className=\"mt-8 flex justify-end\">\n          <button\n            type=\"submit\"\n            disabled={saving}\n            className=\"inline-flex items-center px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            <Save className=\"w-4 h-4 mr-2\" />\n            {saving ? 'Saving...' : 'Save Settings'}\n          </button>\n        </div>\n      </form>\n\n      {/* Email Templates Section */}\n      <div className=\"mt-8\">\n        <EmailTemplateEditor />\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/SignUpPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/SimpleLoginPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { useNavigate, Link } from 'react-router-dom';\nimport { Building2, AlertCircle } from 'lucide-react';\nimport { supabase } from '@/lib/supabase';\nimport { log } from '@/lib/logger';\n\nexport default function SimpleLoginPage() {\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [error, setError] = useState('');\n  const [loading, setLoading] = useState(false);\n  const navigate = useNavigate();\n\n  async function handleSubmit(e: React.FormEvent) {\n    e.preventDefault();\n    setError('');\n    setLoading(true);\n\n    try {\n      // Use ONLY direct Supabase auth - no Edge Functions\n      const { data, error: authError } = await supabase.auth.signInWithPassword({\n        email,\n        password,\n      });\n\n      if (authError) {\n        setError(authError.message);\n        log.security('failed_login', {\n          component: 'SimpleLoginPage',\n          metadata: { email, reason: authError.message }\n        });\n        setLoading(false);\n        return;\n      }\n\n      if (data.user) {\n        // Create or update admin profile - direct database call\n        await supabase\n          .from('users_profiles')\n          .upsert({\n            user_id: data.user.id,\n            full_name: 'Administrator',\n            role: 'Admin',\n            email: data.user.email,\n            created_at: new Date().toISOString(),\n          })\n          .select()\n          .single();\n\n        log.track('login_success', {\n          component: 'SimpleLoginPage',\n          userId: data.user.id\n        });\n\n        navigate('/dashboard');\n      }\n    } catch (err) {\n      log.error('Login error', err, { component: 'SimpleLoginPage' });\n      setError('Login failed. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function createQuickAccount() {\n    setLoading(true);\n    try {\n      // Create account with direct auth\n      const { data, error } = await supabase.auth.signUp({\n        email: 'admin@novumflow.com',\n        password: 'admin123456',\n      });\n\n      if (error) throw error;\n\n      if (data.user) {\n        // Create admin profile\n        await supabase\n          .from('users_profiles')\n          .upsert({\n            user_id: data.user.id,\n            full_name: 'System Administrator',\n            role: 'Admin',\n            email: data.user.email,\n            created_at: new Date().toISOString(),\n          });\n\n        log.track('quick_account_created', {\n          component: 'SimpleLoginPage',\n          userId: data.user.id\n        });\n\n        alert('Admin account created!\\nEmail: admin@novumflow.com\\nPassword: admin123456\\nRedirecting...');\n        navigate('/dashboard');\n      }\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'Unknown error';\n      setError(errorMessage);\n      log.error('Quick account creation failed', err, { component: 'SimpleLoginPage' });\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4\">\n      <div className=\"w-full max-w-md\">\n        <div className=\"bg-white rounded-2xl shadow-xl p-8\">\n          <div className=\"flex justify-center mb-6\">\n            <div className=\"w-16 h-16 bg-indigo-600 rounded-2xl flex items-center justify-center\">\n              <Building2 className=\"w-10 h-10 text-white\" />\n            </div>\n          </div>\n\n          <h1 className=\"text-3xl font-bold text-center text-gray-900 mb-2\">NOVUMFLOW Access</h1>\n          <p className=\"text-center text-gray-600 mb-8\">Direct Authentication (No Edge Functions)</p>\n\n          {error && (\n            <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6\">\n              <div className=\"flex items-start\">\n                <AlertCircle className=\"w-5 h-5 mr-2 flex-shrink-0 mt-0.5\" />\n                <p>{error}</p>\n              </div>\n            </div>\n          )}\n\n          <div className=\"space-y-4\">\n            <button\n              onClick={createQuickAccount}\n              disabled={loading}\n              className=\"w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition disabled:opacity-50\"\n            >\n              {loading ? 'Creating...' : 'Create Instant Admin Account'}\n            </button>\n\n            <div className=\"text-center text-gray-500 text-sm\">OR</div>\n\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <input\n                type=\"email\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                placeholder=\"Email address\"\n                required\n                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n              />\n\n              <input\n                type=\"password\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                placeholder=\"Password\"\n                required\n                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none\"\n              />\n\n              <button\n                type=\"submit\"\n                disabled={loading}\n                className=\"w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition disabled:opacity-50\"\n              >\n                {loading ? 'Signing in...' : 'Sign In'}\n              </button>\n            </form>\n          </div>\n\n          <p className=\"mt-6 text-center text-sm text-gray-600\">\n            Bypass method for Edge Function issues\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/StaffPassportPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'XCircle' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":53},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadStatus'. Either include it or remove the dependency array.","line":17,"column":8,"nodeType":"ArrayExpression","endLine":17,"endColumn":29,"suggestions":[{"desc":"Update the dependencies array to be: [user, currentTenant, loadStatus]","fix":{"range":[713,734],"text":"[user, currentTenant, loadStatus]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport QRCode from 'react-qr-code';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { complianceService, ComplianceStatus } from '@/lib/services/ComplianceService';\nimport { Shield, CheckCircle, AlertTriangle, XCircle, Download, Share2, User } from 'lucide-react';\nimport { log } from '@/lib/logger';\n\nexport default function StaffPassportPage() {\n    const { user } = useAuth();\n    const { currentTenant } = useTenant();\n    const [loading, setLoading] = useState(true);\n    const [status, setStatus] = useState<ComplianceStatus | null>(null);\n\n    useEffect(() => {\n        loadStatus();\n    }, [user, currentTenant]);\n\n    const loadStatus = async () => {\n        if (!user || !currentTenant) return;\n        setLoading(true);\n        try {\n            // In a real app, we'd fetch the specific user's compliance status\n            // For now, we'll try to fetch it using the service\n            const data = await complianceService.getStaffComplianceStatus(user.id);\n            setStatus(data);\n        } catch (error) {\n            log.error('Error loading passport status', error, { component: 'StaffPassportPage', action: 'loadStatus' });\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const getStatusColor = (score: number) => {\n        if (score >= 90) return 'bg-green-600';\n        if (score >= 70) return 'bg-yellow-500';\n        return 'bg-red-600';\n    };\n\n    const getStatusText = (score: number) => {\n        if (score >= 90) return 'VERIFIED SAFE';\n        if (score >= 70) return 'ACTION REQUIRED';\n        return 'NON-COMPLIANT';\n    };\n\n    if (loading) {\n        return (\n            <div className=\"flex items-center justify-center h-screen bg-gray-100\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-600\"></div>\n            </div>\n        );\n    }\n\n    // Fallback if no status found (e.g. new user)\n    const complianceScore = status?.overall_compliance_score || 0;\n    const isVerified = complianceScore >= 90;\n    const qrValue = `https://novumflow.com/verify/${user?.id}`; // Mock verification URL\n\n    return (\n        <div className=\"min-h-screen bg-gray-100 py-12 px-4 sm:px-6 lg:px-8 flex flex-col items-center\">\n            <div className=\"max-w-md w-full space-y-8\">\n                <div className=\"text-center\">\n                    <Shield className=\"mx-auto h-12 w-12 text-cyan-600\" />\n                    <h2 className=\"mt-2 text-3xl font-extrabold text-gray-900\">Digital Staff Passport</h2>\n                    <p className=\"mt-2 text-sm text-gray-600\">\n                        Present this ID to prove your compliance status.\n                    </p>\n                </div>\n\n                {/* ID Card */}\n                <div className=\"bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200 relative\">\n                    {/* Header Band */}\n                    <div className={`h-24 ${getStatusColor(complianceScore)} flex items-center justify-center relative overflow-hidden`}>\n                        <div className=\"absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]\"></div>\n                        <h1 className=\"text-2xl font-black text-white tracking-widest uppercase drop-shadow-md\">\n                            {getStatusText(complianceScore)}\n                        </h1>\n                    </div>\n\n                    <div className=\"px-8 pb-8 pt-12 relative text-center\">\n                        {/* Avatar */}\n                        <div className=\"absolute -top-16 left-1/2 transform -translate-x-1/2\">\n                            <div className=\"h-32 w-32 rounded-full border-4 border-white shadow-lg bg-gray-200 flex items-center justify-center overflow-hidden\">\n                                {user?.user_metadata?.avatar_url ? (\n                                    <img src={user.user_metadata.avatar_url} alt=\"Profile\" className=\"h-full w-full object-cover\" />\n                                ) : (\n                                    <User className=\"h-16 w-16 text-gray-400\" />\n                                )}\n                            </div>\n                        </div>\n\n                        <h2 className=\"text-2xl font-bold text-gray-900 mt-2\">{user?.user_metadata?.full_name || user?.email}</h2>\n                        <p className=\"text-sm text-gray-500 uppercase tracking-wide font-semibold mt-1\">\n                            {status?.staff_name ? 'Registered Staff' : 'Staff Member'}\n                        </p>\n\n                        <div className=\"mt-6 grid grid-cols-2 gap-4 text-left bg-gray-50 p-4 rounded-lg\">\n                            <div>\n                                <p className=\"text-xs text-gray-400 uppercase\">DBS Status</p>\n                                <p className=\"font-medium text-gray-900 flex items-center gap-1\">\n                                    {status?.dbs_status === 'compliant' ? (\n                                        <><CheckCircle className=\"w-3 h-3 text-green-500\" /> Clear</>\n                                    ) : (\n                                        <><AlertTriangle className=\"w-3 h-3 text-yellow-500\" /> Pending</>\n                                    )}\n                                </p>\n                            </div>\n                            <div>\n                                <p className=\"text-xs text-gray-400 uppercase\">Right to Work</p>\n                                <p className=\"font-medium text-gray-900 flex items-center gap-1\">\n                                    {status?.rtw_status === 'compliant' ? (\n                                        <><CheckCircle className=\"w-3 h-3 text-green-500\" /> Verified</>\n                                    ) : (\n                                        <><AlertTriangle className=\"w-3 h-3 text-yellow-500\" /> Check Req.</>\n                                    )}\n                                </p>\n                            </div>\n                            <div>\n                                <p className=\"text-xs text-gray-400 uppercase\">Training</p>\n                                <p className=\"font-medium text-gray-900\">\n                                    {status?.training_status === 'compliant' ? 'Up to Date' : 'Incomplete'}\n                                </p>\n                            </div>\n                            <div>\n                                <p className=\"text-xs text-gray-400 uppercase\">ID Number</p>\n                                <p className=\"font-mono text-xs text-gray-900 truncate\" title={user?.id}>\n                                    {user?.id?.substring(0, 8)}...\n                                </p>\n                            </div>\n                        </div>\n\n                        {/* QR Code */}\n                        <div className=\"mt-8 flex justify-center\">\n                            <div className=\"p-4 bg-white border-2 border-gray-100 rounded-xl shadow-inner\">\n                                <QRCode value={qrValue} size={160} />\n                            </div>\n                        </div>\n                        <p className=\"mt-2 text-xs text-gray-400\">Scan to verify live status</p>\n                    </div>\n\n                    {/* Footer */}\n                    <div className=\"bg-gray-50 px-6 py-4 border-t border-gray-100 flex justify-between items-center\">\n                        <div className=\"flex items-center gap-2\">\n                            <div className={`h-2 w-2 rounded-full ${isVerified ? 'bg-green-500 animate-pulse' : 'bg-red-500'}`}></div>\n                            <span className=\"text-xs font-medium text-gray-500\">\n                                {isVerified ? 'Live & Active' : 'Restricted'}\n                            </span>\n                        </div>\n                        <span className=\"text-xs text-gray-400\">NovumFlow ID</span>\n                    </div>\n                </div>\n\n                {/* Actions */}\n                <div className=\"flex gap-4 justify-center\">\n                    <button className=\"flex items-center gap-2 px-6 py-3 bg-white text-gray-700 rounded-xl shadow-sm hover:bg-gray-50 font-medium transition-colors\">\n                        <Download className=\"w-5 h-5\" />\n                        Save Image\n                    </button>\n                    <button className=\"flex items-center gap-2 px-6 py-3 bg-cyan-600 text-white rounded-xl shadow-md hover:bg-cyan-700 font-medium transition-colors\">\n                        <Share2 className=\"w-5 h-5\" />\n                        Share Link\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/StaffPortalPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/SupportPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/TeamPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/TenantManagementPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Check' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { tenantService, Tenant, Feature } from '@/lib/services/TenantService';\nimport { Building2, Check, X, Loader2, Shield, Save, CheckCircle2, Clock } from 'lucide-react';\nimport Toast from '@/components/Toast';\nimport TenantOnboardingWizard from '@/components/TenantOnboardingWizard';\nimport { onboardingService, TenantOnboarding } from '@/lib/services/OnboardingService';\nimport { log } from '@/lib/logger';\n\nexport default function TenantManagementPage() {\n    const { user, profile } = useAuth();\n    const { refreshTenants } = useTenant();\n    const [tenants, setTenants] = useState<Tenant[]>([]);\n    const [features, setFeatures] = useState<Feature[]>([]);\n    const [selectedTenant, setSelectedTenant] = useState<Tenant | null>(null);\n    const [featureStatus, setFeatureStatus] = useState<Map<string, boolean>>(new Map());\n    const [loading, setLoading] = useState(true);\n    const [saving, setSaving] = useState(false);\n    const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' } | null>(null);\n    const [subscriptionPrice, setSubscriptionPrice] = useState('');\n    const [currency, setCurrency] = useState('GBP');\n    const [subscriptionInterval, setSubscriptionInterval] = useState<'monthly' | 'yearly'>('monthly');\n    const [showCreateModal, setShowCreateModal] = useState(false);\n    const [editMode, setEditMode] = useState(false);\n    const [formData, setFormData] = useState({\n        name: '',\n        domain: '',\n        subscription_tier: 'basic',\n        subscription_price: '',\n        currency: 'GBP',\n        subscription_interval: 'monthly' as 'monthly' | 'yearly',\n        max_users: '10'\n    });\n    const [showOnboarding, setShowOnboarding] = useState(false);\n    const [onboardingData, setOnboardingData] = useState<Map<string, TenantOnboarding>>(new Map());\n    const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\n\n    async function handleDeleteTenant() {\n        if (!selectedTenant) return;\n        setSaving(true);\n        const success = await tenantService.deleteTenant(selectedTenant.id);\n        if (success) {\n            setToast({ message: 'Tenant deleted successfully', type: 'success' });\n            const remaining = tenants.filter(t => t.id !== selectedTenant.id);\n            setTenants(remaining);\n            setSelectedTenant(remaining.length > 0 ? remaining[0] : null);\n            setShowDeleteConfirm(false);\n            setEditMode(false);\n        } else {\n            setToast({ message: 'Failed to delete tenant', type: 'error' });\n        }\n        setSaving(false);\n    }\n\n    useEffect(() => {\n        loadData();\n    }, []);\n\n    useEffect(() => {\n        if (selectedTenant) {\n            loadTenantFeatures(selectedTenant.id);\n            setSubscriptionPrice(selectedTenant.subscription_price?.toString() || '');\n            setCurrency(selectedTenant.currency || 'GBP');\n            setSubscriptionInterval(selectedTenant.subscription_interval || 'monthly');\n            setFormData({\n                name: selectedTenant.name,\n                domain: selectedTenant.domain || '',\n                subscription_tier: selectedTenant.subscription_tier,\n                subscription_price: selectedTenant.subscription_price?.toString() || '',\n                currency: selectedTenant.currency || 'GBP',\n                subscription_interval: selectedTenant.subscription_interval || 'monthly',\n                max_users: selectedTenant.max_users?.toString() || '10'\n            });\n        }\n    }, [selectedTenant]);\n\n    async function loadData() {\n        setLoading(true);\n        const [tenantsData, featuresData] = await Promise.all([\n            tenantService.getAllTenants(),\n            tenantService.getAllFeatures()\n        ]);\n        setTenants(tenantsData);\n        setFeatures(featuresData);\n\n        // Load onboarding data for all tenants\n        const onboardingMap = new Map<string, TenantOnboarding>();\n        for (const tenant of tenantsData) {\n            const onboarding = await onboardingService.getOnboardingStatus(tenant.id);\n            if (onboarding) {\n                onboardingMap.set(tenant.id, onboarding);\n            }\n        }\n        setOnboardingData(onboardingMap);\n\n        if (tenantsData.length > 0) {\n            setSelectedTenant(tenantsData[0]);\n        }\n        setLoading(false);\n    }\n\n    async function loadTenantFeatures(tenantId: string) {\n        const status = await tenantService.getTenantFeatureStatus(tenantId);\n        setFeatureStatus(status);\n    }\n\n    async function toggleFeature(featureId: string, currentStatus: boolean) {\n        if (!selectedTenant || !user) return;\n\n        setSaving(true);\n        const success = currentStatus\n            ? await tenantService.disableFeature(selectedTenant.id, featureId)\n            : await tenantService.enableFeature(selectedTenant.id, featureId, user.id);\n\n        if (success) {\n            setToast({ message: 'Feature updated successfully', type: 'success' });\n            await loadTenantFeatures(selectedTenant.id);\n        } else {\n            setToast({ message: 'Failed to update feature', type: 'error' });\n        }\n        setSaving(false);\n    }\n\n    async function saveSubscription() {\n        if (!selectedTenant) return;\n        setSaving(true);\n        const success = await tenantService.updateTenantSubscription(\n            selectedTenant.id,\n            parseFloat(subscriptionPrice) || 0,\n            currency,\n            subscriptionInterval\n        );\n\n        if (success) {\n            setToast({ message: 'Subscription updated successfully', type: 'success' });\n            // Update local state\n            const updatedTenants = tenants.map(t =>\n                t.id === selectedTenant.id\n                    ? { ...t, subscription_price: parseFloat(subscriptionPrice) || 0, currency, subscription_interval: subscriptionInterval }\n                    : t\n            );\n            setTenants(updatedTenants);\n            setSelectedTenant({ ...selectedTenant, subscription_price: parseFloat(subscriptionPrice) || 0, currency, subscription_interval: subscriptionInterval });\n        } else {\n            setToast({ message: 'Failed to update subscription', type: 'error' });\n        }\n        setSaving(false);\n    }\n\n    async function handleCreateTenant() {\n        setSaving(true);\n        const newTenant = await tenantService.createTenant({\n            name: formData.name,\n            domain: formData.domain || null,\n            subscription_tier: formData.subscription_tier,\n            subscription_price: parseFloat(formData.subscription_price) || undefined,\n            currency: formData.currency,\n            subscription_interval: formData.subscription_interval,\n            max_users: parseInt(formData.max_users) || 10,\n            is_active: true\n        });\n\n        if (newTenant) {\n            setToast({ message: 'Tenant created successfully', type: 'success' });\n            await loadData();\n            setShowCreateModal(false);\n            setFormData({\n                name: '',\n                domain: '',\n                subscription_tier: 'basic',\n                subscription_price: '',\n                currency: 'GBP',\n                subscription_interval: 'monthly',\n                max_users: '10'\n            });\n        } else {\n            setToast({ message: 'Failed to create tenant', type: 'error' });\n        }\n        setSaving(false);\n    }\n\n    async function handleUpdateTenant() {\n        if (!selectedTenant) return;\n\n        log.info('Updating tenant', {\n            component: 'TenantManagementPage',\n            action: 'handleUpdateTenant',\n            metadata: {\n                tenantId: selectedTenant.id,\n                oldName: selectedTenant.name,\n                newName: formData.name,\n                updates: {\n                    name: formData.name,\n                    domain: formData.domain || null,\n                    subscription_tier: formData.subscription_tier,\n                    subscription_price: parseFloat(formData.subscription_price) || undefined,\n                    currency: formData.currency,\n                    subscription_interval: formData.subscription_interval,\n                    max_users: parseInt(formData.max_users) || 10\n                }\n            }\n        });\n\n        setSaving(true);\n        try {\n            const updatedTenant = await tenantService.updateTenant(selectedTenant.id, {\n                name: formData.name,\n                domain: formData.domain || null,\n                subscription_tier: formData.subscription_tier,\n                subscription_price: parseFloat(formData.subscription_price) || undefined,\n                currency: formData.currency,\n                subscription_interval: formData.subscription_interval,\n                max_users: parseInt(formData.max_users) || 10\n            });\n\n            if (updatedTenant) {\n                log.info('Tenant update successful', { component: 'TenantManagementPage', action: 'handleUpdateTenant', metadata: { tenantId: updatedTenant.id } });\n                setToast({ message: 'Tenant updated successfully', type: 'success' });\n\n                // Update local state directly with the returned object\n                setTenants(prev => prev.map(t => t.id === updatedTenant.id ? updatedTenant : t));\n                setSelectedTenant(updatedTenant);\n\n                // Refresh context\n                await refreshTenants();\n\n                setEditMode(false);\n            } else {\n                log.error('Tenant update failed - service returned null', null, { component: 'TenantManagementPage', action: 'handleUpdateTenant' });\n                setToast({ message: 'Failed to update tenant. Please check permissions.', type: 'error' });\n            }\n        } catch (error) {\n            log.error('Error updating tenant', error, { component: 'TenantManagementPage', action: 'handleUpdateTenant' });\n            setToast({ message: 'An error occurred while updating tenant', type: 'error' });\n        } finally {\n            setSaving(false);\n        }\n    }\n\n    // Check if user is super admin\n    if (!profile?.is_super_admin) {\n        return (\n            <div className=\"flex items-center justify-center min-h-screen bg-gray-50\">\n                <div className=\"max-w-md w-full bg-white rounded-lg shadow-lg p-8 text-center\">\n                    <div className=\"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-100 mb-4\">\n                        <Shield className=\"h-8 w-8 text-red-600\" />\n                    </div>\n                    <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Access Denied</h2>\n                    <p className=\"text-gray-600\">\n                        This page is only accessible to super administrators.\n                    </p>\n                </div>\n            </div>\n        );\n    }\n\n    if (loading) {\n        return (\n            <div className=\"flex items-center justify-center min-h-screen\">\n                <Loader2 className=\"w-8 h-8 animate-spin text-cyan-600\" />\n            </div>\n        );\n    }\n\n    return (\n        <div>\n            <div className=\"mb-8 flex items-center justify-between\">\n                <div>\n                    <h1 className=\"text-3xl font-bold text-gray-900\">Tenant Management</h1>\n                    <p className=\"mt-1 text-sm text-gray-600\">\n                        Manage features and settings for each tenant organization\n                    </p>\n                </div>\n                <button\n                    onClick={() => setShowCreateModal(true)}\n                    className=\"flex items-center px-4 py-2 bg-cyan-600 text-white rounded-lg text-sm font-medium hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500\"\n                >\n                    <Building2 className=\"w-4 h-4 mr-2\" />\n                    Create Tenant\n                </button>\n            </div>\n\n            <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-6\">\n                {/* Tenant List */}\n                <div className=\"lg:col-span-1\">\n                    <div className=\"bg-white rounded-lg shadow\">\n                        <div className=\"p-4 border-b border-gray-200\">\n                            <h2 className=\"text-lg font-semibold text-gray-900\">Tenants</h2>\n                        </div>\n                        <div className=\"divide-y divide-gray-200\">\n                            {tenants.map((tenant) => (\n                                <button\n                                    key={tenant.id}\n                                    onClick={() => setSelectedTenant(tenant)}\n                                    className={`w-full text-left p-4 hover:bg-gray-50 transition ${selectedTenant?.id === tenant.id ? 'bg-cyan-50 border-l-4 border-cyan-600' : ''\n                                        }`}\n                                >\n                                    <div className=\"flex items-start\">\n                                        <Building2 className=\"w-5 h-5 text-gray-400 mt-0.5 mr-3\" />\n                                        <div className=\"flex-1 min-w-0\">\n                                            <p className=\"text-sm font-medium text-gray-900 truncate\">\n                                                {tenant.name}\n                                            </p>\n                                            <p className=\"text-xs text-gray-500 mt-1\">\n                                                {tenant.subscription_tier}\n                                                {tenant.subscription_price && (\n                                                    <span className=\"ml-2 text-cyan-600 font-medium\">\n                                                        {tenant.currency === 'USD' ? '$' : tenant.currency === 'EUR' ? 'â¬' : 'Â£'}\n                                                        {tenant.subscription_price}\n                                                    </span>\n                                                )}\n                                            </p>\n                                            {onboardingData.get(tenant.id) && (\n                                                <div className=\"mt-2 flex items-center\">\n                                                    {onboardingData.get(tenant.id)!.onboarding_status === 'completed' ? (\n                                                        <span className=\"inline-flex items-center text-xs text-green-600\">\n                                                            <CheckCircle2 className=\"w-3 h-3 mr-1\" />\n                                                            Onboarded\n                                                        </span>\n                                                    ) : (\n                                                        <span className=\"inline-flex items-center text-xs text-orange-600\">\n                                                            <Clock className=\"w-3 h-3 mr-1\" />\n                                                            {onboardingData.get(tenant.id)!.completion_percentage}% complete\n                                                        </span>\n                                                    )}\n                                                </div>\n                                            )}\n                                        </div>\n                                    </div>\n                                </button>\n                            ))}\n                        </div>\n                    </div>\n                </div>\n\n                {/* Feature Management */}\n                <div className=\"lg:col-span-3\">\n                    {selectedTenant && (\n                        <div className=\"bg-white rounded-lg shadow\">\n                            <div className=\"p-6 border-b border-gray-200\">\n                                <div className=\"flex items-center justify-between\">\n                                    <div>\n                                        <h2 className=\"text-xl font-semibold text-gray-900\">\n                                            {selectedTenant.name}\n                                        </h2>\n                                        <p className=\"text-sm text-gray-500 mt-1\">\n                                            {selectedTenant.domain || 'No domain configured'}\n                                        </p>\n                                    </div>\n                                    <div className=\"flex items-center space-x-3\">\n                                        {onboardingData.get(selectedTenant.id)?.onboarding_status !== 'completed' && (\n                                            <button\n                                                onClick={() => setShowOnboarding(true)}\n                                                className=\"px-4 py-2 bg-orange-600 text-white rounded-lg text-sm font-medium hover:bg-orange-700\"\n                                            >\n                                                Complete Onboarding ({onboardingData.get(selectedTenant.id)?.completion_percentage || 0}%)\n                                            </button>\n                                        )}\n                                        <span className={`px-3 py-1 rounded-full text-sm font-medium ${selectedTenant.subscription_tier === 'enterprise'\n                                            ? 'bg-purple-100 text-purple-800'\n                                            : selectedTenant.subscription_tier === 'premium'\n                                                ? 'bg-blue-100 text-blue-800'\n                                                : 'bg-gray-100 text-gray-800'\n                                            }`}>\n                                            {selectedTenant.subscription_tier}\n                                        </span>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div className=\"p-6 border-b border-gray-200 bg-gray-50\">\n                                <div className=\"flex items-center justify-between mb-4\">\n                                    <h3 className=\"text-sm font-medium text-gray-900\">Subscription Details</h3>\n                                    {!editMode && (\n                                        <button\n                                            onClick={() => setEditMode(true)}\n                                            className=\"text-xs text-cyan-600 hover:text-cyan-700 font-medium\"\n                                        >\n                                            Edit Details\n                                        </button>\n                                    )}\n                                </div>\n                                <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 items-end\">\n                                    <div>\n                                        <label className=\"block text-xs font-medium text-gray-500 mb-1\">Price</label>\n                                        <input\n                                            type=\"number\"\n                                            value={subscriptionPrice}\n                                            onChange={(e) => setSubscriptionPrice(e.target.value)}\n                                            className=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-cyan-500 focus:border-cyan-500\"\n                                            placeholder=\"0.00\"\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-medium text-gray-500 mb-1\">Currency</label>\n                                        <select\n                                            value={currency}\n                                            onChange={(e) => setCurrency(e.target.value)}\n                                            className=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-cyan-500 focus:border-cyan-500\"\n                                        >\n                                            <option value=\"GBP\">GBP (Â£)</option>\n                                            <option value=\"USD\">USD ($)</option>\n                                            <option value=\"EUR\">EUR (â¬)</option>\n                                        </select>\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-medium text-gray-500 mb-1\">Interval</label>\n                                        <select\n                                            value={subscriptionInterval}\n                                            onChange={(e) => setSubscriptionInterval(e.target.value as 'monthly' | 'yearly')}\n                                            className=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-cyan-500 focus:border-cyan-500\"\n                                        >\n                                            <option value=\"monthly\">Monthly</option>\n                                            <option value=\"yearly\">Yearly</option>\n                                        </select>\n                                    </div>\n                                    <button\n                                        onClick={saveSubscription}\n                                        disabled={saving}\n                                        className=\"flex items-center justify-center px-4 py-2 bg-cyan-600 text-white rounded-md text-sm font-medium hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 disabled:opacity-50\"\n                                    >\n                                        <Save className=\"w-4 h-4 mr-2\" />\n                                        Save\n                                    </button>\n                                </div>\n                            </div>\n\n                            <div className=\"p-6\">\n                                <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Feature Access</h3>\n\n                                {/* Group features by category */}\n                                {['module', 'feature', 'integration'].map(category => {\n                                    const categoryFeatures = features.filter(f => f.category === category);\n                                    if (categoryFeatures.length === 0) return null;\n\n                                    return (\n                                        <div key={category} className=\"mb-6\">\n                                            <h4 className=\"text-sm font-medium text-gray-700 mb-3 capitalize\">\n                                                {category === 'module' ? 'Modules' : category === 'feature' ? 'Features' : 'Integrations'}\n                                            </h4>\n                                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                                                {categoryFeatures.map((feature) => {\n                                                    const isEnabled = featureStatus.get(feature.id) || false;\n                                                    return (\n                                                        <div\n                                                            key={feature.id}\n                                                            className={`border rounded-lg p-4 transition ${isEnabled\n                                                                ? 'border-cyan-200 bg-cyan-50'\n                                                                : 'border-gray-200 bg-gray-50'\n                                                                }`}\n                                                        >\n                                                            <div className=\"flex items-start justify-between\">\n                                                                <div className=\"flex-1\">\n                                                                    <div className=\"flex items-center\">\n                                                                        <h5 className=\"text-sm font-medium text-gray-900\">\n                                                                            {feature.display_name}\n                                                                        </h5>\n                                                                        {feature.is_premium && (\n                                                                            <span className=\"ml-2 px-2 py-0.5 text-xs font-medium bg-yellow-100 text-yellow-800 rounded\">\n                                                                                Premium\n                                                                            </span>\n                                                                        )}\n                                                                    </div>\n                                                                    {feature.description && (\n                                                                        <p className=\"text-xs text-gray-500 mt-1\">\n                                                                            {feature.description}\n                                                                        </p>\n                                                                    )}\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => toggleFeature(feature.id, isEnabled)}\n                                                                    disabled={saving}\n                                                                    className={`ml-3 flex-shrink-0 relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:ring-offset-2 ${isEnabled ? 'bg-cyan-600' : 'bg-gray-200'\n                                                                        } ${saving ? 'opacity-50 cursor-not-allowed' : ''}`}\n                                                                >\n                                                                    <span\n                                                                        className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${isEnabled ? 'translate-x-6' : 'translate-x-1'\n                                                                            }`}\n                                                                    />\n                                                                </button>\n                                                            </div>\n                                                        </div>\n                                                    );\n                                                })}\n                                            </div>\n                                        </div>\n                                    );\n                                })}\n                            </div>\n                        </div>\n                    )}\n                </div>\n            </div>\n\n            {/* Create/Edit Tenant Modal */}\n            {(showCreateModal || editMode) && (\n                <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n                    <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n                        <div className=\"p-6 border-b border-gray-200\">\n                            <h2 className=\"text-xl font-semibold text-gray-900\">\n                                {showCreateModal ? 'Create New Tenant' : 'Edit Tenant'}\n                            </h2>\n                        </div>\n                        <div className=\"p-6 space-y-4\">\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                                <div>\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Tenant Name *</label>\n                                    <input\n                                        type=\"text\"\n                                        value={formData.name}\n                                        onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                                        className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-cyan-500 focus:border-cyan-500\"\n                                        placeholder=\"e.g., Acme Corporation\"\n                                    />\n                                </div>\n                                <div>\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Domain</label>\n                                    <input\n                                        type=\"text\"\n                                        value={formData.domain}\n                                        onChange={(e) => setFormData({ ...formData, domain: e.target.value })}\n                                        className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-cyan-500 focus:border-cyan-500\"\n                                        placeholder=\"e.g., acme.com\"\n                                    />\n                                </div>\n                            </div>\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                                <div>\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Subscription Tier *</label>\n                                    <select\n                                        value={formData.subscription_tier}\n                                        onChange={(e) => setFormData({ ...formData, subscription_tier: e.target.value })}\n                                        className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-cyan-500 focus:border-cyan-500\"\n                                    >\n                                        <option value=\"basic\">Basic</option>\n                                        <option value=\"premium\">Premium</option>\n                                        <option value=\"enterprise\">Enterprise</option>\n                                    </select>\n                                </div>\n                                <div>\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Max Users</label>\n                                    <input\n                                        type=\"number\"\n                                        value={formData.max_users}\n                                        onChange={(e) => setFormData({ ...formData, max_users: e.target.value })}\n                                        className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-cyan-500 focus:border-cyan-500\"\n                                        placeholder=\"10\"\n                                    />\n                                </div>\n                            </div>\n                            <div className=\"border-t border-gray-200 pt-4 mt-4\">\n                                <h3 className=\"text-sm font-medium text-gray-900 mb-3\">Subscription Pricing</h3>\n                                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Price</label>\n                                        <input\n                                            type=\"number\"\n                                            value={formData.subscription_price}\n                                            onChange={(e) => setFormData({ ...formData, subscription_price: e.target.value })}\n                                            className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-cyan-500 focus:border-cyan-500\"\n                                            placeholder=\"0.00\"\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Currency</label>\n                                        <select\n                                            value={formData.currency}\n                                            onChange={(e) => setFormData({ ...formData, currency: e.target.value })}\n                                            className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-cyan-500 focus:border-cyan-500\"\n                                        >\n                                            <option value=\"GBP\">GBP (Â£)</option>\n                                            <option value=\"USD\">USD ($)</option>\n                                            <option value=\"EUR\">EUR (â¬)</option>\n                                        </select>\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Billing Interval</label>\n                                        <select\n                                            value={formData.subscription_interval}\n                                            onChange={(e) => setFormData({ ...formData, subscription_interval: e.target.value as 'monthly' | 'yearly' })}\n                                            className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-cyan-500 focus:border-cyan-500\"\n                                        >\n                                            <option value=\"monthly\">Monthly</option>\n                                            <option value=\"yearly\">Yearly</option>\n                                        </select>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <div className=\"p-6 border-t border-gray-200 flex justify-between items-center\">\n                            <div>\n                                {!showCreateModal && (\n                                    <button\n                                        onClick={() => setShowDeleteConfirm(true)}\n                                        className=\"px-4 py-2 border border-red-300 text-red-700 rounded-md text-sm font-medium hover:bg-red-50\"\n                                    >\n                                        Delete Tenant\n                                    </button>\n                                )}\n                            </div>\n                            <div className=\"flex space-x-3\">\n                                <button\n                                    onClick={() => {\n                                        setShowCreateModal(false);\n                                        setEditMode(false);\n                                    }}\n                                    className=\"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50\"\n                                >\n                                    Cancel\n                                </button>\n                                <button\n                                    onClick={showCreateModal ? handleCreateTenant : handleUpdateTenant}\n                                    disabled={saving || !formData.name}\n                                    className=\"px-4 py-2 bg-cyan-600 text-white rounded-md text-sm font-medium hover:bg-cyan-700 disabled:opacity-50\"\n                                >\n                                    {saving ? (\n                                        <>\n                                            <Loader2 className=\"w-4 h-4 mr-2 inline animate-spin\" />\n                                            {showCreateModal ? 'Creating...' : 'Updating...'}\n                                        </>\n                                    ) : (\n                                        showCreateModal ? 'Create Tenant' : 'Update Tenant'\n                                    )}\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* Delete Confirmation Modal */}\n            {showDeleteConfirm && (\n                <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n                    <div className=\"bg-white rounded-lg shadow-xl max-w-sm w-full p-6 text-center\">\n                        <div className=\"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4\">\n                            <Shield className=\"h-6 w-6 text-red-600\" />\n                        </div>\n                        <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Delete Tenant?</h3>\n                        <p className=\"text-sm text-gray-500 mb-6\">\n                            Are you sure you want to delete <strong>{selectedTenant?.name}</strong>? This action cannot be undone and will remove all associated data.\n                        </p>\n                        <div className=\"flex justify-center space-x-3\">\n                            <button\n                                onClick={() => setShowDeleteConfirm(false)}\n                                className=\"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50\"\n                            >\n                                Cancel\n                            </button>\n                            <button\n                                onClick={handleDeleteTenant}\n                                disabled={saving}\n                                className=\"px-4 py-2 bg-red-600 text-white rounded-md text-sm font-medium hover:bg-red-700 disabled:opacity-50\"\n                            >\n                                {saving ? 'Deleting...' : 'Delete'}\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* Onboarding Wizard Modal */}\n            {showOnboarding && selectedTenant && (\n                <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n                    <div className=\"max-w-3xl w-full\">\n                        <TenantOnboardingWizard\n                            tenantId={selectedTenant.id}\n                            tenantName={selectedTenant.name}\n                            onClose={() => setShowOnboarding(false)}\n                            onComplete={() => {\n                                setShowOnboarding(false);\n                                loadData(); // Reload to update onboarding status\n                                setToast({ message: 'Onboarding completed successfully!', type: 'success' });\n                            }}\n                        />\n                    </div>\n                </div>\n            )}\n\n            {toast && (\n                <Toast\n                    message={toast.message}\n                    type={toast.type}\n                    onClose={() => setToast(null)}\n                />\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/TenantSignupPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createTenant' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":88,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":88,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tenantId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":213,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":213,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { supabase } from '@/lib/supabase';\nimport { Building2, User, CreditCard, Check, ArrowRight, ArrowLeft, Loader2 } from 'lucide-react';\nimport { log } from '@/lib/logger';\n\ninterface TenantSignupData {\n    // Step 1: Organization Details\n    organizationName: string;\n    subdomain: string;\n    industry: string;\n    size: string;\n\n    // Step 2: Admin User\n    adminName: string;\n    adminEmail: string;\n    adminPassword: string;\n    adminPasswordConfirm: string;\n\n    // Step 3: Subscription\n    subscriptionTier: 'trial' | 'basic' | 'professional' | 'enterprise';\n}\n\nconst STEPS = [\n    { id: 1, name: 'Organization', icon: Building2 },\n    { id: 2, name: 'Admin User', icon: User },\n    { id: 3, name: 'Subscription', icon: CreditCard },\n];\n\nconst SUBSCRIPTION_TIERS = [\n    {\n        id: 'trial',\n        name: '14-Day Free Trial',\n        price: 'Â£0',\n        period: '14 days',\n        features: [\n            'Up to 10 users',\n            'Basic features',\n            'Email support',\n            'No credit card required',\n        ],\n    },\n    {\n        id: 'basic',\n        name: 'Basic',\n        price: 'Â£199',\n        period: 'per month',\n        features: [\n            'Up to 25 users',\n            'All core features',\n            'Email support',\n            'Basic analytics',\n        ],\n    },\n    {\n        id: 'professional',\n        name: 'Professional',\n        price: 'Â£499',\n        period: 'per month',\n        features: [\n            'Up to 100 users',\n            'Advanced features',\n            'Priority support',\n            'Advanced analytics',\n            'API access',\n        ],\n        popular: true,\n    },\n    {\n        id: 'enterprise',\n        name: 'Enterprise',\n        price: 'Custom',\n        period: '',\n        features: [\n            'Unlimited users',\n            'All features',\n            '24/7 phone support',\n            'Dedicated account manager',\n            'Custom integrations',\n            'SLA guarantee',\n        ],\n    },\n];\n\nexport default function TenantSignupPage() {\n    const navigate = useNavigate();\n    const { createTenant } = useTenant();\n    const [currentStep, setCurrentStep] = useState(1);\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState('');\n    const [formData, setFormData] = useState<TenantSignupData>({\n        organizationName: '',\n        subdomain: '',\n        industry: 'healthcare',\n        size: '1-10',\n        adminName: '',\n        adminEmail: '',\n        adminPassword: '',\n        adminPasswordConfirm: '',\n        subscriptionTier: 'trial',\n    });\n\n    const updateFormData = (field: keyof TenantSignupData, value: string) => {\n        setFormData(prev => ({ ...prev, [field]: value }));\n        setError('');\n    };\n\n    const validateStep = () => {\n        if (currentStep === 1) {\n            if (!formData.organizationName.trim()) {\n                setError('Organization name is required');\n                return false;\n            }\n            if (!formData.subdomain.trim()) {\n                setError('Subdomain is required');\n                return false;\n            }\n            if (!/^[a-z0-9-]+$/.test(formData.subdomain)) {\n                setError('Subdomain can only contain lowercase letters, numbers, and hyphens');\n                return false;\n            }\n        }\n\n        if (currentStep === 2) {\n            if (!formData.adminName.trim()) {\n                setError('Admin name is required');\n                return false;\n            }\n            if (!formData.adminEmail.trim()) {\n                setError('Admin email is required');\n                return false;\n            }\n            if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(formData.adminEmail)) {\n                setError('Invalid email address');\n                return false;\n            }\n            if (formData.adminPassword.length < 8) {\n                setError('Password must be at least 8 characters');\n                return false;\n            }\n            if (formData.adminPassword !== formData.adminPasswordConfirm) {\n                setError('Passwords do not match');\n                return false;\n            }\n        }\n\n        return true;\n    };\n\n    const handleNext = async () => {\n        if (!validateStep()) return;\n\n        if (currentStep === 1) {\n            setLoading(true);\n            try {\n                const { data: isAvailable, error } = await supabase.rpc('check_subdomain_availability', {\n                    p_subdomain: formData.subdomain\n                });\n\n                if (error) throw error;\n\n                if (!isAvailable) {\n                    setError('This subdomain is already taken');\n                    setLoading(false);\n                    return;\n                }\n            } catch (err) {\n                log.error('Error checking subdomain', err, { component: 'TenantSignupPage', action: 'handleNext', metadata: { step: 1, subdomain: formData.subdomain } });\n                setError('Failed to verify subdomain availability');\n                setLoading(false);\n                return;\n            }\n            setLoading(false);\n        }\n\n        if (currentStep < 3) {\n            setCurrentStep(prev => prev + 1);\n        }\n    };\n\n    const handleBack = () => {\n        if (currentStep > 1) {\n            setCurrentStep(prev => prev - 1);\n            setError('');\n        }\n    };\n\n    const handleSubmit = async () => {\n        if (!validateStep()) return;\n\n        setLoading(true);\n        setError('');\n\n        try {\n            // 1. Create Admin User\n            const { data: authData, error: authError } = await supabase.auth.signUp({\n                email: formData.adminEmail,\n                password: formData.adminPassword,\n                options: {\n                    emailRedirectTo: `${window.location.origin}/login`,\n                    data: {\n                        full_name: formData.adminName,\n                        role: 'admin' // Initial role\n                    }\n                }\n            });\n\n            if (authError) throw authError;\n            if (!authData.user) throw new Error('Failed to create user account');\n\n            // 2. Create Tenant\n            const { data: tenantId, error: tenantError } = await supabase.rpc('create_tenant', {\n                p_name: formData.organizationName,\n                p_subdomain: formData.subdomain,\n                p_owner_user_id: authData.user.id,\n                p_subscription_tier: formData.subscriptionTier\n            });\n\n            if (tenantError) throw tenantError;\n\n            // 3. Send Welcome Email\n            try {\n                await supabase.functions.invoke('send-welcome-email', {\n                    body: {\n                        email: formData.adminEmail,\n                        name: formData.adminName,\n                        organizationName: formData.organizationName\n                    }\n                });\n            } catch (emailError) {\n                log.error('Failed to send welcome email', emailError, { component: 'TenantSignupPage', action: 'handleSubmit', metadata: { email: formData.adminEmail } });\n                // Don't block signup flow on email failure\n            }\n\n            // Redirect to login or dashboard\n            // If email confirmation is enabled, we should show a message\n            if (authData.session) {\n                navigate('/dashboard');\n            } else {\n                // User created but not logged in (email confirmation required)\n                alert('Account created! Please check your email to confirm your account.');\n                navigate('/login');\n            }\n        } catch (err: any) {\n            log.error('Signup error', err, { component: 'TenantSignupPage', action: 'handleSubmit' });\n            if (err.message && err.message.includes('confirmation email')) {\n                setError('Email service is temporarily busy. Your account and organization may have been createdâplease try logging in, or wait a few minutes and try again.');\n            } else if (err.message && err.message.includes('rate limit')) {\n                setError('Too many attempts. Please wait a few minutes before trying again.');\n            } else {\n                setError(err.message || 'Failed to create organization');\n            }\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    return (\n        <div className=\"min-h-screen bg-gradient-to-br from-cyan-50 via-blue-50 to-indigo-50 flex items-center justify-center p-4\">\n            <div className=\"w-full max-w-4xl\">\n                {/* Header */}\n                <div className=\"text-center mb-8\">\n                    <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">Create Your Organization</h1>\n                    <p className=\"text-gray-600\">Get started with NovumFlow in just a few steps</p>\n                </div>\n\n                {/* Progress Steps */}\n                <div className=\"mb-8\">\n                    <div className=\"flex items-center justify-center\">\n                        {STEPS.map((step, index) => (\n                            <React.Fragment key={step.id}>\n                                <div className=\"flex flex-col items-center\">\n                                    <div\n                                        className={`w-12 h-12 rounded-full flex items-center justify-center transition-all ${currentStep > step.id\n                                            ? 'bg-cyan-600 text-white'\n                                            : currentStep === step.id\n                                                ? 'bg-cyan-600 text-white ring-4 ring-cyan-100'\n                                                : 'bg-gray-200 text-gray-500'\n                                            }`}\n                                    >\n                                        {currentStep > step.id ? (\n                                            <Check className=\"w-6 h-6\" />\n                                        ) : (\n                                            <step.icon className=\"w-6 h-6\" />\n                                        )}\n                                    </div>\n                                    <span className={`mt-2 text-sm font-medium ${currentStep >= step.id ? 'text-gray-900' : 'text-gray-500'}`}>\n                                        {step.name}\n                                    </span>\n                                </div>\n                                {index < STEPS.length - 1 && (\n                                    <div\n                                        className={`h-0.5 w-24 mx-4 transition-all ${currentStep > step.id ? 'bg-cyan-600' : 'bg-gray-200'}\n                                            `}\n                                    />\n                                )}\n                            </React.Fragment>\n                        ))}\n                    </div>\n                </div>\n\n                {/* Form Card */}\n                <div className=\"bg-white rounded-2xl shadow-xl p-8\">\n                    {error && (\n                        <div className=\"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm\">\n                            {error}\n                        </div>\n                    )}\n\n                    {/* Step 1: Organization Details */}\n                    {currentStep === 1 && (\n                        <div className=\"space-y-6\">\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                    Organization Name\n                                </label>\n                                <input\n                                    type=\"text\"\n                                    value={formData.organizationName}\n                                    onChange={(e) => updateFormData('organizationName', e.target.value)}\n                                    placeholder=\"Ringstead Care Home\"\n                                    className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500\"\n                                />\n                            </div>\n\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                    Subdomain\n                                </label>\n                                <div className=\"flex items-center\">\n                                    <input\n                                        type=\"text\"\n                                        value={formData.subdomain}\n                                        onChange={(e) => updateFormData('subdomain', e.target.value.toLowerCase())}\n                                        placeholder=\"ringsteadcare\"\n                                        className=\"flex-1 px-4 py-3 border border-gray-300 rounded-l-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500\"\n                                    />\n                                    <span className=\"px-4 py-3 bg-gray-100 border border-l-0 border-gray-300 rounded-r-lg text-gray-600\">\n                                        .novumflow.com\n                                    </span>\n                                </div>\n                                <p className=\"mt-2 text-sm text-gray-500\">This will be your unique URL</p>\n                            </div>\n\n                            <div className=\"grid grid-cols-2 gap-4\">\n                                <div>\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                        Industry\n                                    </label>\n                                    <select\n                                        value={formData.industry}\n                                        onChange={(e) => updateFormData('industry', e.target.value)}\n                                        className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500\"\n                                    >\n                                        <option value=\"healthcare\">Healthcare</option>\n                                        <option value=\"homecare\">Home Care</option>\n                                        <option value=\"nursing\">Nursing Home</option>\n                                        <option value=\"recruitment\">Recruitment</option>\n                                        <option value=\"other\">Other</option>\n                                    </select>\n                                </div>\n\n                                <div>\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                        Organization Size\n                                    </label>\n                                    <select\n                                        value={formData.size}\n                                        onChange={(e) => updateFormData('size', e.target.value)}\n                                        className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500\"\n                                    >\n                                        <option value=\"1-10\">1-10 employees</option>\n                                        <option value=\"11-50\">11-50 employees</option>\n                                        <option value=\"51-200\">51-200 employees</option>\n                                        <option value=\"201+\">201+ employees</option>\n                                    </select>\n                                </div>\n                            </div>\n                        </div>\n                    )}\n\n                    {/* Step 2: Admin User */}\n                    {currentStep === 2 && (\n                        <div className=\"space-y-6\">\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                    Full Name\n                                </label>\n                                <input\n                                    type=\"text\"\n                                    value={formData.adminName}\n                                    onChange={(e) => updateFormData('adminName', e.target.value)}\n                                    placeholder=\"John Doe\"\n                                    className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500\"\n                                />\n                            </div>\n\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                    Email Address\n                                </label>\n                                <input\n                                    type=\"email\"\n                                    value={formData.adminEmail}\n                                    onChange={(e) => updateFormData('adminEmail', e.target.value)}\n                                    placeholder=\"john@ringsteadcare.com\"\n                                    className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500\"\n                                />\n                            </div>\n\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                    Password\n                                </label>\n                                <input\n                                    type=\"password\"\n                                    value={formData.adminPassword}\n                                    onChange={(e) => updateFormData('adminPassword', e.target.value)}\n                                    placeholder=\"â¢â¢â¢â¢â¢â¢â¢â¢\"\n                                    className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500\"\n                                />\n                                <p className=\"mt-2 text-sm text-gray-500\">Minimum 8 characters</p>\n                            </div>\n\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                    Confirm Password\n                                </label>\n                                <input\n                                    type=\"password\"\n                                    value={formData.adminPasswordConfirm}\n                                    onChange={(e) => updateFormData('adminPasswordConfirm', e.target.value)}\n                                    placeholder=\"â¢â¢â¢â¢â¢â¢â¢â¢\"\n                                    className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500\"\n                                />\n                            </div>\n                        </div>\n                    )}\n\n                    {/* Step 3: Subscription */}\n                    {currentStep === 3 && (\n                        <div className=\"space-y-6\">\n                            <p className=\"text-center text-gray-600 mb-8\">\n                                Choose the plan that best fits your organization\n                            </p>\n\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n                                {SUBSCRIPTION_TIERS.map((tier) => (\n                                    <button\n                                        key={tier.id}\n                                        onClick={() => updateFormData('subscriptionTier', tier.id as any)}\n                                        className={`relative p-6 border-2 rounded-xl text-left transition-all ${formData.subscriptionTier === tier.id\n                                            ? 'border-cyan-600 bg-cyan-50'\n                                            : 'border-gray-200 hover:border-gray-300'\n                                            } ${tier.popular ? 'ring-2 ring-cyan-200' : ''}`}\n                                    >\n                                        {tier.popular && (\n                                            <span className=\"absolute -top-3 left-1/2 -translate-x-1/2 px-3 py-1 bg-cyan-600 text-white text-xs font-semibold rounded-full\">\n                                                Popular\n                                            </span>\n                                        )}\n\n                                        <div className=\"mb-4\">\n                                            <h3 className=\"text-lg font-bold text-gray-900\">{tier.name}</h3>\n                                            <div className=\"mt-2\">\n                                                <span className=\"text-3xl font-bold text-gray-900\">{tier.price}</span>\n                                                {tier.period && (\n                                                    <span className=\"text-gray-500 ml-2\">{tier.period}</span>\n                                                )}\n                                            </div>\n                                        </div>\n\n                                        <ul className=\"space-y-2\">\n                                            {tier.features.map((feature, index) => (\n                                                <li key={index} className=\"flex items-start gap-2 text-sm text-gray-600\">\n                                                    <Check className=\"w-4 h-4 text-cyan-600 flex-shrink-0 mt-0.5\" />\n                                                    <span>{feature}</span>\n                                                </li>\n                                            ))}\n                                        </ul>\n\n                                        {formData.subscriptionTier === tier.id && (\n                                            <div className=\"absolute top-6 right-6\">\n                                                <div className=\"w-6 h-6 bg-cyan-600 rounded-full flex items-center justify-center\">\n                                                    <Check className=\"w-4 h-4 text-white\" />\n                                                </div>\n                                            </div>\n                                        )}\n                                    </button>\n                                ))}\n                            </div>\n                        </div>\n                    )}\n\n                    {/* Navigation Buttons */}\n                    <div className=\"flex items-center justify-between mt-8 pt-6 border-t border-gray-200\">\n                        <button\n                            onClick={handleBack}\n                            disabled={currentStep === 1 || loading}\n                            className=\"flex items-center gap-2 px-6 py-3 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                        >\n                            <ArrowLeft className=\"w-4 h-4\" />\n                            Back\n                        </button>\n\n                        {currentStep < 3 ? (\n                            <button\n                                onClick={handleNext}\n                                disabled={loading}\n                                className=\"flex items-center gap-2 px-6 py-3 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors\"\n                            >\n                                Next\n                                <ArrowRight className=\"w-4 h-4\" />\n                            </button>\n                        ) : (\n                            <button\n                                onClick={handleSubmit}\n                                disabled={loading}\n                                className=\"flex items-center gap-2 px-6 py-3 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors disabled:opacity-50\"\n                            >\n                                {loading ? (\n                                    <>\n                                        <Loader2 className=\"w-4 h-4 animate-spin\" />\n                                        Creating...\n                                    </>\n                                ) : (\n                                    <>\n                                        Create Organization\n                                        <Check className=\"w-4 h-4\" />\n                                    </>\n                                )}\n                            </button>\n                        )}\n                    </div>\n                </div>\n\n                {/* Footer */}\n                <p className=\"text-center text-sm text-gray-500 mt-6\">\n                    Already have an account?{' '}\n                    <button\n                        onClick={() => navigate('/login')}\n                        className=\"text-cyan-600 hover:text-cyan-700 font-medium\"\n                    >\n                        Sign in\n                    </button>\n                </p>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/TrainingPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/WorkforceManagementPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/__tests__/RecruitSettingsPage.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/pages/__tests__/pages.test.ts","messages":[{"ruleId":"@typescript-eslint/triple-slash-reference","severity":2,"message":"Do not use a triple slash reference for vitest, use `import` style instead.","line":1,"column":1,"nodeType":"Line","messageId":"tripleSlashReference","endLine":1,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/// <reference types=\"vitest\" />\n/**\n * Page Component Tests\n */\n\nimport { describe, it, expect, vi } from 'vitest';\n\n// Mock page data structures used across pages\n\n// Dashboard data\nconst mockDashboardStats = {\n    totalEmployees: 150,\n    activeJobs: 12,\n    pendingApplications: 45,\n    scheduledInterviews: 8,\n    complianceScore: 94,\n    leaveRequests: 5,\n};\n\n// Recruitment page data\nconst mockRecruitmentStats = {\n    totalJobs: 25,\n    activeJobs: 12,\n    closedJobs: 13,\n    totalApplications: 180,\n    newApplications: 45,\n    screeningApplications: 32,\n    interviewApplications: 28,\n    totalInterviews: 56,\n    scheduledInterviews: 8,\n    completedInterviews: 48,\n};\n\n// HR module data\nconst mockHRStats = {\n    totalEmployees: 150,\n    activeEmployees: 142,\n    inactiveEmployees: 8,\n    departments: 6,\n    pendingLeave: 5,\n    approvedLeave: 12,\n};\n\n// Performance data\nconst mockPerformanceStats = {\n    completedReviews: 85,\n    pendingReviews: 15,\n    averageRating: 4.2,\n    totalGoals: 320,\n    completedGoals: 180,\n    atRiskGoals: 25,\n};\n\n// Compliance data\nconst mockComplianceStats = {\n    overallScore: 94,\n    dbsCompleted: 145,\n    dbsPending: 5,\n    trainingCompleted: 420,\n    trainingPending: 30,\n    documentsVerified: 890,\n    documentsPending: 45,\n};\n\nvi.mock('@/lib/supabase', () => ({\n    supabase: { from: vi.fn(() => ({ select: vi.fn(() => Promise.resolve({ data: [], error: null })) })) },\n}));\n\ndescribe('Dashboard Page', () => {\n    it('should have valid stats structure', () => {\n        expect(mockDashboardStats).toHaveProperty('totalEmployees');\n        expect(mockDashboardStats).toHaveProperty('activeJobs');\n        expect(mockDashboardStats).toHaveProperty('complianceScore');\n    });\n\n    it('should have positive values', () => {\n        Object.values(mockDashboardStats).forEach(val => {\n            expect(val).toBeGreaterThanOrEqual(0);\n        });\n    });\n\n    it('should have compliance score between 0-100', () => {\n        expect(mockDashboardStats.complianceScore).toBeGreaterThanOrEqual(0);\n        expect(mockDashboardStats.complianceScore).toBeLessThanOrEqual(100);\n    });\n});\n\ndescribe('Recruitment Page', () => {\n    it('should have valid recruitment stats', () => {\n        expect(mockRecruitmentStats).toHaveProperty('totalJobs');\n        expect(mockRecruitmentStats).toHaveProperty('totalApplications');\n        expect(mockRecruitmentStats).toHaveProperty('totalInterviews');\n    });\n\n    it('should have consistent job counts', () => {\n        expect(mockRecruitmentStats.activeJobs + mockRecruitmentStats.closedJobs).toBeLessThanOrEqual(mockRecruitmentStats.totalJobs);\n    });\n\n    it('should have valid application pipeline', () => {\n        const pipelineTotal = mockRecruitmentStats.newApplications +\n            mockRecruitmentStats.screeningApplications +\n            mockRecruitmentStats.interviewApplications;\n        expect(pipelineTotal).toBeLessThanOrEqual(mockRecruitmentStats.totalApplications);\n    });\n});\n\ndescribe('HR Module Page', () => {\n    it('should have valid HR stats', () => {\n        expect(mockHRStats).toHaveProperty('totalEmployees');\n        expect(mockHRStats).toHaveProperty('departments');\n        expect(mockHRStats).toHaveProperty('pendingLeave');\n    });\n\n    it('should have consistent employee counts', () => {\n        expect(mockHRStats.activeEmployees + mockHRStats.inactiveEmployees).toBe(mockHRStats.totalEmployees);\n    });\n});\n\ndescribe('Performance Page', () => {\n    it('should have valid performance stats', () => {\n        expect(mockPerformanceStats).toHaveProperty('completedReviews');\n        expect(mockPerformanceStats).toHaveProperty('averageRating');\n        expect(mockPerformanceStats).toHaveProperty('totalGoals');\n    });\n\n    it('should have valid average rating', () => {\n        expect(mockPerformanceStats.averageRating).toBeGreaterThanOrEqual(1);\n        expect(mockPerformanceStats.averageRating).toBeLessThanOrEqual(5);\n    });\n\n    it('should have consistent goal counts', () => {\n        expect(mockPerformanceStats.completedGoals + mockPerformanceStats.atRiskGoals).toBeLessThanOrEqual(mockPerformanceStats.totalGoals);\n    });\n});\n\ndescribe('Compliance Page', () => {\n    it('should have valid compliance stats', () => {\n        expect(mockComplianceStats).toHaveProperty('overallScore');\n        expect(mockComplianceStats).toHaveProperty('dbsCompleted');\n        expect(mockComplianceStats).toHaveProperty('trainingCompleted');\n    });\n\n    it('should have valid compliance score', () => {\n        expect(mockComplianceStats.overallScore).toBeGreaterThanOrEqual(0);\n        expect(mockComplianceStats.overallScore).toBeLessThanOrEqual(100);\n    });\n\n    it('should track DBS checks', () => {\n        expect(mockComplianceStats.dbsCompleted).toBeGreaterThan(0);\n        expect(mockComplianceStats.dbsPending).toBeGreaterThanOrEqual(0);\n    });\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/test/mocks.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/test/setup.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'beforeAll' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'afterAll' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Test Setup for Vitest\n * \n * Configures testing environment with mocks for external dependencies\n */\n\nimport '@testing-library/jest-dom';\nimport { vi, beforeAll, afterAll, afterEach } from 'vitest';\n\n// Mock ResizeObserver\nclass ResizeObserverMock {\n  observe() {}\n  unobserve() {}\n  disconnect() {}\n}\n\nglobal.ResizeObserver = ResizeObserverMock;\n\n// Mock IntersectionObserver\nclass IntersectionObserverMock {\n  observe() {}\n  unobserve() {}\n  disconnect() {}\n}\n\nglobal.IntersectionObserver = IntersectionObserverMock as any;\n\n// Mock window.matchMedia\nObject.defineProperty(window, 'matchMedia', {\n  writable: true,\n  value: vi.fn().mockImplementation(query => ({\n    matches: false,\n    media: query,\n    onchange: null,\n    addListener: vi.fn(),\n    removeListener: vi.fn(),\n    addEventListener: vi.fn(),\n    removeEventListener: vi.fn(),\n    dispatchEvent: vi.fn(),\n  })),\n});\n\n// Mock scrollTo\nObject.defineProperty(window, 'scrollTo', {\n  writable: true,\n  value: vi.fn(),\n});\n\n// Mock import.meta.env\nvi.stubEnv('MODE', 'test');\nvi.stubEnv('VITE_SUPABASE_URL', 'https://test.supabase.co');\nvi.stubEnv('VITE_SUPABASE_ANON_KEY', 'test-anon-key');\n\n// Clean up after each test\nafterEach(() => {\n  vi.clearAllMocks();\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/test/utils.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createWrapper' is defined but never used. Allowed unused vars must match /^_/u.","line":31,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":23},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"This rule can't verify that `export *` only exports components.","line":69,"column":1,"nodeType":"ExportAllDeclaration","messageId":"exportAll","endLine":69,"endColumn":40}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Test Utilities\n * \n * Common utilities for testing React components with React Query\n */\n\nimport React, { ReactElement } from 'react';\nimport { render, RenderOptions } from '@testing-library/react';\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\n\n// Create a fresh QueryClient for each test\nexport function createTestQueryClient() {\n  return new QueryClient({\n    defaultOptions: {\n      queries: {\n        retry: false,\n        gcTime: Infinity,\n      },\n      mutations: {\n        retry: false,\n      },\n    },\n  });\n}\n\n// Wrapper component with providers\ninterface WrapperProps {\n  children: React.ReactNode;\n}\n\nfunction createWrapper() {\n  const queryClient = createTestQueryClient();\n  \n  return function Wrapper({ children }: WrapperProps) {\n    return (\n      <QueryClientProvider client={queryClient}>\n        {children}\n      </QueryClientProvider>\n    );\n  };\n}\n\n// Custom render with providers\ninterface CustomRenderOptions extends Omit<RenderOptions, 'wrapper'> {\n  queryClient?: QueryClient;\n}\n\nexport function renderWithProviders(\n  ui: ReactElement,\n  options: CustomRenderOptions = {}\n) {\n  const { queryClient = createTestQueryClient(), ...renderOptions } = options;\n\n  function Wrapper({ children }: WrapperProps) {\n    return (\n      <QueryClientProvider client={queryClient}>\n        {children}\n      </QueryClientProvider>\n    );\n  }\n\n  return {\n    ...render(ui, { wrapper: Wrapper, ...renderOptions }),\n    queryClient,\n  };\n}\n\n// Re-export everything from testing-library\nexport * from '@testing-library/react';\nexport { default as userEvent } from '@testing-library/user-event';\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/vite-env.d.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Ref' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/// <reference types=\"vite/client\" />\n/// <reference types=\"vite-plugin-pwa/client\" />\n\ndeclare module 'virtual:pwa-register/react' {\n  import type { Ref } from 'react'\n  \n  export interface RegisterSWOptions {\n    immediate?: boolean\n    onNeedRefresh?: () => void\n    onOfflineReady?: () => void\n    onRegistered?: (registration: ServiceWorkerRegistration | undefined) => void\n    onRegisterError?: (error: any) => void\n  }\n\n  export function useRegisterSW(options?: RegisterSWOptions): {\n    needRefresh: [boolean, (value: boolean) => void]\n    offlineReady: [boolean, (value: boolean) => void]\n    updateServiceWorker: (reloadPage?: boolean) => Promise<void>\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/src/vite-plugin-pwa.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/_shared/logger.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/admin-setup/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/ai-screen-resume/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/application-crud/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/automation-engine/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/biometric-processing/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/compliance-dashboard-data/index.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'thirtyDaysFromNow' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":64,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":64,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"Deno.serve(async (req) => {\n    const corsHeaders = {\n        'Access-Control-Allow-Origin': '*',\n        'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',\n        'Access-Control-Allow-Methods': 'POST, GET, OPTIONS',\n        'Access-Control-Max-Age': '86400',\n        'Access-Control-Allow-Credentials': 'false'\n    };\n\n    if (req.method === 'OPTIONS') {\n        return new Response(null, { status: 200, headers: corsHeaders });\n    }\n\n    try {\n        const serviceRoleKey = Deno.env.get('SUPABASE_SERVICE_ROLE_KEY');\n        const supabaseUrl = Deno.env.get('SUPABASE_URL');\n\n        if (!serviceRoleKey || !supabaseUrl) {\n            throw new Error('Supabase configuration missing');\n        }\n\n        const authHeader = req.headers.get('authorization');\n        if (!authHeader) {\n            throw new Error('No authorization header');\n        }\n\n        const alertsResponse = await fetch(`${supabaseUrl}/rest/v1/compliance_alerts?status=eq.active&order=alert_priority.asc,due_date.asc`, {\n            headers: {\n                'Authorization': `Bearer ${serviceRoleKey}`,\n                'apikey': serviceRoleKey\n            }\n        });\n\n        const alerts = alertsResponse.ok ? await alertsResponse.json() : [];\n\n        const visaResponse = await fetch(`${supabaseUrl}/rest/v1/visa_records?current_status=eq.active&order=expiry_date.asc`, {\n            headers: {\n                'Authorization': `Bearer ${serviceRoleKey}`,\n                'apikey': serviceRoleKey\n            }\n        });\n\n        const visaRecords = visaResponse.ok ? await visaResponse.json() : [];\n\n        const dbsResponse = await fetch(`${supabaseUrl}/rest/v1/dbs_certificates?status=in.(pending,approved)&order=expiry_date.asc`, {\n            headers: {\n                'Authorization': `Bearer ${serviceRoleKey}`,\n                'apikey': serviceRoleKey\n            }\n        });\n\n        const dbsCertificates = dbsResponse.ok ? await dbsResponse.json() : [];\n\n        const rtwResponse = await fetch(`${supabaseUrl}/rest/v1/right_to_work_checks?order=check_date.desc&limit=50`, {\n            headers: {\n                'Authorization': `Bearer ${serviceRoleKey}`,\n                'apikey': serviceRoleKey\n            }\n        });\n\n        const rtwChecks = rtwResponse.ok ? await rtwResponse.json() : [];\n\n        const now = new Date();\n        const thirtyDaysFromNow = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);\n        const ninetyDaysFromNow = new Date(now.getTime() + 90 * 24 * 60 * 60 * 1000);\n\n        const expiringVisas = visaRecords.filter(v => {\n            const expiryDate = new Date(v.expiry_date);\n            return expiryDate <= ninetyDaysFromNow && expiryDate > now;\n        });\n\n        const expiringDBS = dbsCertificates.filter(d => {\n            if (!d.expiry_date) return false;\n            const expiryDate = new Date(d.expiry_date);\n            return expiryDate <= ninetyDaysFromNow && expiryDate > now;\n        });\n\n        const criticalAlerts = alerts.filter(a => a.alert_priority === 'critical' || a.alert_priority === 'urgent');\n        const highAlerts = alerts.filter(a => a.alert_priority === 'high');\n\n        const complianceScore = Math.max(0, Math.min(100, \n            100 - (criticalAlerts.length * 10) - (highAlerts.length * 5) - (expiringVisas.length * 3)\n        ));\n\n        return new Response(JSON.stringify({\n            data: {\n                summary: {\n                    total_alerts: alerts.length,\n                    critical_alerts: criticalAlerts.length,\n                    high_alerts: highAlerts.length,\n                    expiring_visas: expiringVisas.length,\n                    expiring_dbs: expiringDBS.length,\n                    total_visa_records: visaRecords.length,\n                    total_dbs_certificates: dbsCertificates.length,\n                    total_rtw_checks: rtwChecks.length,\n                    compliance_score: Math.round(complianceScore)\n                },\n                alerts: alerts,\n                visa_records: visaRecords,\n                dbs_certificates: dbsCertificates,\n                rtw_checks: rtwChecks,\n                expiring_items: {\n                    visas: expiringVisas,\n                    dbs: expiringDBS\n                }\n            }\n        }), {\n            headers: { ...corsHeaders, 'Content-Type': 'application/json' }\n        });\n\n    } catch (error) {\n        console.error('Compliance dashboard error:', error);\n\n        const errorResponse = {\n            error: {\n                code: 'COMPLIANCE_DASHBOARD_ERROR',\n                message: error.message\n            }\n        };\n\n        return new Response(JSON.stringify(errorResponse), {\n            status: 500,\n            headers: { ...corsHeaders, 'Content-Type': 'application/json' }\n        });\n    }\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/compliance-monitoring/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/dbs-verification/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/document-upload-enhanced/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/employee-crud/index.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'profileError' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":54,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":59}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Deno type declarations\ndeclare const Deno: any;\n\nimport { createClient } from \"https://esm.sh/@supabase/supabase-js@2\";\n\nconst corsHeaders = {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',\n    'Access-Control-Allow-Methods': 'POST, GET, OPTIONS, PUT, DELETE',\n    'Access-Control-Max-Age': '86400',\n};\n\nasync function generateHmacSignature(payload: string, secret: string): Promise<string> {\n    const encoder = new TextEncoder();\n    const key = await crypto.subtle.importKey(\n        \"raw\",\n        encoder.encode(secret),\n        { name: \"HMAC\", hash: \"SHA-256\" },\n        false,\n        [\"sign\"]\n    );\n    const signed = await crypto.subtle.sign(\"HMAC\", key, encoder.encode(payload));\n    return Array.from(new Uint8Array(signed))\n        .map((b) => b.toString(16).padStart(2, \"0\"))\n        .join(\"\");\n}\n\nDeno.serve(async (req: Request) => {\n    if (req.method === 'OPTIONS') {\n        return new Response(null, { status: 200, headers: corsHeaders });\n    }\n\n    try {\n        const supabaseUrl = Deno.env.get('SUPABASE_URL')!;\n        const supabaseKey = Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!;\n        const supabase = createClient(supabaseUrl, supabaseKey);\n\n        const authHeader = req.headers.get('Authorization');\n        if (!authHeader) {\n            throw new Error('Missing authorization header');\n        }\n\n        const token = authHeader.replace('Bearer ', '');\n        const { data: { user }, error: userError } = await supabase.auth.getUser(token);\n\n        if (userError || !user) {\n            throw new Error('Invalid token');\n        }\n\n        const { action, data } = await req.json();\n\n        if (action === 'create') {\n            // Fetch tenant_id for the creator\n            const { data: profileData, error: profileError } = await supabase\n                .from('users_profiles')\n                .select('tenant_id')\n                .eq('id', user.id)\n                .single();\n\n            const tenantId = profileData?.tenant_id;\n\n            const { data: newEmployee, error: insertError } = await supabase\n                .from('employees')\n                .insert({\n                    ...data,\n                    created_by: user.id,\n                    created_at: new Date().toISOString(),\n                    updated_at: new Date().toISOString()\n                })\n                .select()\n                .single();\n\n            if (insertError) {\n                throw new Error(`Failed to create employee: ${insertError.message}`);\n            }\n\n            // Trigger webhook to CareFlow AI for onboarding\n            const careflowWebhookSecret = Deno.env.get('CAREFLOW_WEBHOOK_SECRET');\n            const careflowSyncEmployeeUrl = Deno.env.get('CAREFLOW_SYNC_EMPLOYEE_URL');\n\n            if (careflowWebhookSecret && careflowSyncEmployeeUrl) {\n                const webhookPayload = {\n                    action: 'employee.created',\n                    employee: newEmployee,\n                    tenant_id: tenantId\n                };\n                const jsonPayload = JSON.stringify(webhookPayload);\n                const signature = await generateHmacSignature(jsonPayload, careflowWebhookSecret);\n\n                await fetch(careflowSyncEmployeeUrl, {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'X-NovumFlow-Signature': signature,\n                    },\n                    body: jsonPayload,\n                });\n            } else {\n                console.warn('CareFlow webhook secret or URL not set. Skipping webhook.');\n            }\n\n            // Log audit\n            await supabase.from('audit_logs').insert({\n                user_id: user.id,\n                action: 'CREATE_EMPLOYEE',\n                entity_type: 'employees',\n                entity_id: data.email, // Using email as ID reference since we don't get the ID back easily with simple insert\n                timestamp: new Date().toISOString()\n            });\n\n            return new Response(\n                JSON.stringify({ data: { message: 'Employee created successfully' } }),\n                {\n                    status: 200,\n                    headers: { ...corsHeaders, 'Content-Type': 'application/json' }\n                }\n            );\n        } else if (action === 'update') {\n            const { employee_id, ...updateData } = data;\n            if (!employee_id) {\n                throw new Error('Employee ID is required for update action');\n            }\n\n            const { error: updateError } = await supabase\n                .from('employees')\n                .update({\n                    ...updateData,\n                    updated_at: new Date().toISOString()\n                })\n                .eq('id', employee_id);\n\n            if (updateError) {\n                throw new Error(`Failed to update employee: ${updateError.message}`);\n            }\n\n            await supabase.from('audit_logs').insert({\n                user_id: user.id,\n                action: 'UPDATE_EMPLOYEE',\n                entity_type: 'employees',\n                entity_id: employee_id,\n                timestamp: new Date().toISOString()\n            });\n\n            return new Response(\n                JSON.stringify({ data: { message: 'Employee updated successfully' } }),\n                {\n                    status: 200,\n                    headers: { ...corsHeaders, 'Content-Type': 'application/json' }\n                }\n            );\n        } else if (action === 'delete') {\n            const { employee_id } = data;\n            if (!employee_id) {\n                throw new Error('Employee ID is required for delete action');\n            }\n\n            const { error: deleteError } = await supabase\n                .from('employees')\n                .update({ status: 'terminated', updated_at: new Date().toISOString() })\n                .eq('id', employee_id);\n\n            if (deleteError) {\n                throw new Error(`Failed to delete employee: ${deleteError.message}`);\n            }\n\n            // Trigger webhook to CareFlow AI for offboarding\n            const careflowWebhookSecret = Deno.env.get('CAREFLOW_WEBHOOK_SECRET');\n            const careflowSyncEmployeeUrl = Deno.env.get('CAREFLOW_SYNC_EMPLOYEE_URL');\n\n            if (careflowWebhookSecret && careflowSyncEmployeeUrl) {\n                const webhookPayload = {\n                    action: 'employee.deleted', // Use 'deleted' action for offboarding\n                    employee: { id: employee_id, status: 'terminated' }, // Send minimal data\n                    tenant_id: user.id // Placeholder for tenant ID\n                };\n                const jsonPayload = JSON.stringify(webhookPayload);\n                const signature = await generateHmacSignature(jsonPayload, careflowWebhookSecret);\n\n                await fetch(careflowSyncEmployeeUrl, {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'X-NovumFlow-Signature': signature,\n                    },\n                    body: jsonPayload,\n                });\n            } else {\n                console.warn('CareFlow webhook secret or URL not set. Skipping webhook for offboarding.');\n            }\n\n            await supabase.from('audit_logs').insert({\n                user_id: user.id,\n                action: 'DELETE_EMPLOYEE',\n                entity_type: 'employees',\n                entity_id: employee_id,\n                timestamp: new Date().toISOString()\n            });\n\n            return new Response(\n                JSON.stringify({ data: { message: 'Employee deleted successfully' } }),\n                {\n                    status: 200,\n                    headers: { ...corsHeaders, 'Content-Type': 'application/json' }\n                }\n            );\n        } else {\n            throw new Error(`Unknown action: ${action}`);\n        }\n\n    } catch (error: any) {\n        return new Response(\n            JSON.stringify({\n                error: {\n                    message: error.message\n                }\n            }),\n            {\n                status: 400,\n                headers: { ...corsHeaders, 'Content-Type': 'application/json' }\n            }\n        );\n    }\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/generate-document/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/integration-manager/index.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'logger' is defined but never used. Allowed unused args must match /^_/u.","line":82,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":82,"endColumn":52},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'logger' is defined but never used. Allowed unused args must match /^_/u.","line":112,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":112,"endColumn":53},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'logger' is defined but never used. Allowed unused args must match /^_/u.","line":154,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":154,"endColumn":45}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Deno type declarations\ndeclare const Deno: any;\n\n// @deno-types=\"https://deno.land/std@0.168.0/http/server.ts\"\nimport { serve } from \"https://deno.land/std@0.168.0/http/server.ts\"\n// @deno-types=\"https://esm.sh/@supabase/supabase-js@2\"\nimport { createClient } from 'https://esm.sh/@supabase/supabase-js@2'\n\n// Inline logger for deployment\ninterface LogContext {\n    correlationId?: string;\n    [key: string]: any;\n}\n\nclass Logger {\n    private context: LogContext;\n\n    constructor(context: LogContext = {}) {\n        this.context = {\n            ...context,\n            correlationId: context.correlationId || crypto.randomUUID(),\n        };\n    }\n\n    private formatMessage(level: string, message: string, data?: any) {\n        const logEntry = {\n            timestamp: new Date().toISOString(),\n            level,\n            message,\n            ...this.context,\n            ...(data && { data }),\n        };\n        return JSON.stringify(logEntry);\n    }\n\n    info(message: string, data?: any) {\n        console.log(this.formatMessage('INFO', message, data));\n    }\n\n    error(message: string, error?: any, data?: any) {\n        console.error(\n            this.formatMessage('ERROR', message, {\n                error: error?.message || String(error),\n                stack: error?.stack,\n                ...data,\n            })\n        );\n    }\n\n    async timeAsync<T>(operation: string, fn: () => Promise<T>): Promise<T> {\n        const startTime = performance.now();\n        this.info(`Starting: ${operation}`);\n\n        try {\n            const result = await fn();\n            const duration = performance.now() - startTime;\n            this.info(`Completed: ${operation}`, { durationMs: duration.toFixed(2) });\n            return result;\n        } catch (error) {\n            const duration = performance.now() - startTime;\n            this.error(`Failed: ${operation}`, error, { durationMs: duration.toFixed(2) });\n            throw error;\n        }\n    }\n}\n\nfunction createLogger(req: Request): Logger {\n    const correlationId = req.headers.get('x-correlation-id') || crypto.randomUUID();\n    return new Logger({\n        correlationId,\n        method: req.method,\n        url: req.url,\n    });\n}\n\nconst corsHeaders = {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',\n}\n\n// Integration service functions\nasync function sendSlackMessage(config: any, logger: Logger) {\n    const { channel, text, blocks } = config;\n    const SLACK_BOT_TOKEN = Deno.env.get('SLACK_BOT_TOKEN');\n\n    if (!SLACK_BOT_TOKEN) {\n        throw new Error('SLACK_BOT_TOKEN not configured');\n    }\n\n    const response = await fetch('https://slack.com/api/chat.postMessage', {\n        method: 'POST',\n        headers: {\n            'Authorization': `Bearer ${SLACK_BOT_TOKEN}`,\n            'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n            channel,\n            text,\n            blocks: blocks || undefined,\n        }),\n    });\n\n    const data = await response.json();\n\n    if (!data.ok) {\n        throw new Error(`Slack API error: ${data.error}`);\n    }\n\n    return data;\n}\n\nasync function createZoomMeeting(config: any, logger: Logger) {\n    const { topic, start_time, duration, agenda } = config;\n    const ZOOM_ACCESS_TOKEN = Deno.env.get('ZOOM_ACCESS_TOKEN');\n\n    if (!ZOOM_ACCESS_TOKEN) {\n        throw new Error('ZOOM_ACCESS_TOKEN not configured');\n    }\n\n    const response = await fetch('https://api.zoom.us/v2/users/me/meetings', {\n        method: 'POST',\n        headers: {\n            'Authorization': `Bearer ${ZOOM_ACCESS_TOKEN}`,\n            'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n            topic,\n            type: 2, // Scheduled meeting\n            start_time,\n            duration: duration || 60,\n            agenda: agenda || '',\n            settings: {\n                join_before_host: true,\n                mute_upon_entry: true,\n                waiting_room: false,\n            },\n        }),\n    });\n\n    const data = await response.json();\n\n    if (!response.ok) {\n        throw new Error(`Zoom API error: ${data.message || 'Unknown error'}`);\n    }\n\n    return {\n        meeting_id: data.id,\n        join_url: data.join_url,\n        start_url: data.start_url,\n        password: data.password,\n    };\n}\n\nasync function sendEmail(config: any, logger: Logger) {\n    const { to, subject, html, text, template_id, template_data } = config;\n    const SENDGRID_API_KEY = Deno.env.get('SENDGRID_API_KEY');\n\n    if (!SENDGRID_API_KEY) {\n        throw new Error('SENDGRID_API_KEY not configured');\n    }\n\n    let requestBody: any;\n\n    if (template_id) {\n        // Using dynamic template\n        requestBody = {\n            personalizations: [{\n                to: Array.isArray(to) ? to : [{ email: to }],\n                dynamic_template_data: template_data || {},\n            }],\n            from: {\n                email: Deno.env.get('SENDGRID_FROM_EMAIL') || 'noreply@example.com',\n                name: Deno.env.get('SENDGRID_FROM_NAME') || 'HR Team',\n            },\n            template_id,\n        };\n    } else {\n        // Using plain email\n        requestBody = {\n            personalizations: [{\n                to: Array.isArray(to) ? to : [{ email: to }],\n                subject,\n            }],\n            from: {\n                email: Deno.env.get('SENDGRID_FROM_EMAIL') || 'noreply@example.com',\n                name: Deno.env.get('SENDGRID_FROM_NAME') || 'HR Team',\n            },\n            content: [\n                ...(html ? [{ type: 'text/html', value: html }] : []),\n                ...(text ? [{ type: 'text/plain', value: text }] : []),\n            ],\n        };\n    }\n\n    const response = await fetch('https://api.sendgrid.com/v3/mail/send', {\n        method: 'POST',\n        headers: {\n            'Authorization': `Bearer ${SENDGRID_API_KEY}`,\n            'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(requestBody),\n    });\n\n    if (!response.ok) {\n        const errorData = await response.text();\n        throw new Error(`SendGrid API error: ${errorData}`);\n    }\n\n    return { message_id: response.headers.get('x-message-id'), status: 'sent' };\n}\n\n// Template variable replacement\nfunction replaceTemplateVariables(template: string, variables: Record<string, any>): string {\n    let result = template;\n    for (const [key, value] of Object.entries(variables)) {\n        const regex = new RegExp(`{{\\\\s*${key}\\\\s*}}`, 'g');\n        result = result.replace(regex, String(value));\n    }\n    return result;\n}\n\nserve(async (req: Request) => {\n    const logger = createLogger(req);\n\n    if (req.method === 'OPTIONS') {\n        return new Response('ok', { headers: corsHeaders })\n    }\n\n    logger.info('Integration request received');\n\n    try {\n        const supabaseClient = createClient(\n            Deno.env.get('SUPABASE_URL') ?? '',\n            Deno.env.get('SUPABASE_SERVICE_ROLE_KEY') ?? ''\n        )\n\n        const { action, ...params } = await req.json()\n        logger.info('Processing integration action', { action })\n\n        const startTime = performance.now();\n        let result: any;\n        let integrationId: string | null = null;\n\n        // Determine service name\n        let serviceName = '';\n        if (action.startsWith('slack_')) serviceName = 'slack';\n        else if (action.startsWith('zoom_')) serviceName = 'zoom';\n        else if (action.startsWith('email_')) serviceName = 'email';\n        else if (action.startsWith('calendar_')) serviceName = 'calendar';\n\n        // Get integration config if needed\n        if (serviceName) {\n            const { data: integration } = await supabaseClient\n                .from('integrations')\n                .select('*')\n                .eq('service_name', serviceName)\n                .eq('is_active', true)\n                .single();\n\n            if (integration) {\n                integrationId = integration.id;\n            }\n        }\n\n        // Route to appropriate service\n        try {\n            switch (action) {\n                case 'slack_send_message':\n                    result = await sendSlackMessage(params, logger);\n                    break;\n\n                case 'zoom_create_meeting':\n                    result = await createZoomMeeting(params, logger);\n                    break;\n\n                case 'email_send':\n                    result = await sendEmail(params, logger);\n                    break;\n\n                case 'email_send_template': {\n                    // Get template from database\n                    const { data: template } = await supabaseClient\n                        .from('email_templates')\n                        .select('*')\n                        .eq('template_name', params.template_name)\n                        .eq('is_active', true)\n                        .single();\n\n                    if (!template) {\n                        throw new Error(`Template not found: ${params.template_name}`);\n                    }\n\n                    // Replace variables\n                    const subject = replaceTemplateVariables(template.subject, params.variables || {});\n                    const html = replaceTemplateVariables(template.body_html, params.variables || {});\n                    const text = template.body_text ? replaceTemplateVariables(template.body_text, params.variables || {}) : undefined;\n\n                    result = await sendEmail({\n                        to: params.to,\n                        subject,\n                        html,\n                        text,\n                    }, logger);\n                    break;\n                }\n\n                case 'list_integrations': {\n                    const { data: integrations } = await supabaseClient\n                        .from('integrations')\n                        .select('id, service_name, display_name, is_active, is_connected, last_sync_at');\n                    result = integrations;\n                    break;\n                }\n\n                case 'check_connection': {\n                    const { service_name } = params;\n                    let isConnected = false;\n                    let message = '';\n\n                    if (service_name === 'slack') {\n                        isConnected = !!Deno.env.get('SLACK_BOT_TOKEN');\n                        message = isConnected ? 'Slack token found' : 'SLACK_BOT_TOKEN not set';\n                    } else if (service_name === 'email') {\n                        isConnected = !!Deno.env.get('SENDGRID_API_KEY');\n                        message = isConnected ? 'SendGrid API key found' : 'SENDGRID_API_KEY not set';\n                    } else if (service_name === 'zoom') {\n                        isConnected = !!Deno.env.get('ZOOM_ACCESS_TOKEN');\n                        message = isConnected ? 'Zoom token found' : 'ZOOM_ACCESS_TOKEN not set';\n                    } else {\n                        // For others, assume connected if active (or implement specific checks)\n                        isConnected = true;\n                        message = 'Service enabled';\n                    }\n\n                    if (isConnected) {\n                        // Update database\n                        await supabaseClient\n                            .from('integrations')\n                            .update({ is_connected: true, last_sync_at: new Date().toISOString() })\n                            .eq('service_name', service_name);\n                    }\n\n                    result = { connected: isConnected, message };\n                    break;\n                }\n\n                case 'get_integration_logs': {\n                    const { limit = 50, service_name } = params;\n                    let logsQuery = supabaseClient\n                        .from('integration_logs')\n                        .select('*')\n                        .order('created_at', { ascending: false })\n                        .limit(limit);\n\n                    if (service_name) {\n                        logsQuery = logsQuery.eq('service_name', service_name);\n                    }\n\n                    const { data: logs } = await logsQuery;\n                    result = logs;\n                    break;\n                }\n\n                default:\n                    throw new Error(`Unknown action: ${action}`);\n            }\n\n            const duration = performance.now() - startTime;\n\n            // Log successful integration activity\n            if (integrationId && serviceName) {\n                await supabaseClient.from('integration_logs').insert({\n                    integration_id: integrationId,\n                    service_name: serviceName,\n                    action,\n                    status: 'success',\n                    request_data: params,\n                    response_data: result,\n                    duration_ms: duration,\n                    triggered_by: params.triggered_by || null,\n                    related_entity_type: params.related_entity_type || null,\n                    related_entity_id: params.related_entity_id || null,\n                });\n            }\n\n            logger.info('Integration action completed', { action, durationMs: duration.toFixed(2) });\n\n            return new Response(JSON.stringify({ success: true, data: result }), {\n                headers: { ...corsHeaders, 'Content-Type': 'application/json' },\n                status: 200,\n            });\n\n        } catch (integrationError: any) {\n            const duration = performance.now() - startTime;\n\n            // Log failed integration activity\n            if (integrationId && serviceName) {\n                await supabaseClient.from('integration_logs').insert({\n                    integration_id: integrationId,\n                    service_name: serviceName,\n                    action,\n                    status: 'failed',\n                    request_data: params,\n                    error_message: integrationError?.message || String(integrationError),\n                    duration_ms: duration,\n                    triggered_by: params.triggered_by || null,\n                    related_entity_type: params.related_entity_type || null,\n                    related_entity_id: params.related_entity_id || null,\n                });\n            }\n\n            throw integrationError;\n        }\n\n    } catch (error: any) {\n        logger.error('Integration request failed', error)\n        return new Response(JSON.stringify({\n            success: false,\n            error: error?.message || String(error)\n        }), {\n            headers: { ...corsHeaders, 'Content-Type': 'application/json' },\n            status: 400,\n        })\n    }\n})\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/letter-template-crud/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/messaging-crud/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/noticeboard-crud/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/performance-crud/index-dashboard-deploy.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'idx' is defined but never used. Allowed unused args must match /^_/u.","line":172,"column":71,"nodeType":null,"messageId":"unusedVar","endLine":172,"endColumn":74}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Deno type declarations\ndeclare const Deno: any;\n\n// @deno-types=\"https://deno.land/std@0.168.0/http/server.ts\"\nimport { serve } from \"https://deno.land/std@0.168.0/http/server.ts\"\n// @deno-types=\"https://esm.sh/@supabase/supabase-js@2\"\nimport { createClient } from 'https://esm.sh/@supabase/supabase-js@2'\n\n// Inline logger for Supabase Dashboard deployment\ninterface LogContext {\n    correlationId?: string;\n    [key: string]: any;\n}\n\nclass Logger {\n    private context: LogContext;\n\n    constructor(context: LogContext = {}) {\n        this.context = {\n            ...context,\n            correlationId: context.correlationId || crypto.randomUUID(),\n        };\n    }\n\n    private formatMessage(level: string, message: string, data?: any) {\n        const logEntry = {\n            timestamp: new Date().toISOString(),\n            level,\n            message,\n            ...this.context,\n            ...(data && { data }),\n        };\n        return JSON.stringify(logEntry);\n    }\n\n    info(message: string, data?: any) {\n        console.log(this.formatMessage('INFO', message, data));\n    }\n\n    error(message: string, error?: any, data?: any) {\n        console.error(\n            this.formatMessage('ERROR', message, {\n                error: error?.message || String(error),\n                stack: error?.stack,\n                ...data,\n            })\n        );\n    }\n\n    async timeAsync<T>(operation: string, fn: () => Promise<T>): Promise<T> {\n        const startTime = performance.now();\n        this.info(`Starting: ${operation}`);\n\n        try {\n            const result = await fn();\n            const duration = performance.now() - startTime;\n            this.info(`Completed: ${operation}`, { durationMs: duration.toFixed(2) });\n            return result;\n        } catch (error) {\n            const duration = performance.now() - startTime;\n            this.error(`Failed: ${operation}`, error, { durationMs: duration.toFixed(2) });\n            throw error;\n        }\n    }\n}\n\nfunction createLogger(req: Request): Logger {\n    const correlationId = req.headers.get('x-correlation-id') || crypto.randomUUID();\n    return new Logger({\n        correlationId,\n        method: req.method,\n        url: req.url,\n    });\n}\n\nconst corsHeaders = {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',\n}\n\nserve(async (req: Request) => {\n    const logger = createLogger(req);\n\n    if (req.method === 'OPTIONS') {\n        return new Response('ok', { headers: corsHeaders })\n    }\n\n    logger.info('Request received');\n\n    try {\n        const supabaseClient = createClient(\n            Deno.env.get('SUPABASE_URL') ?? '',\n            Deno.env.get('SUPABASE_ANON_KEY') ?? '',\n            { global: { headers: { Authorization: req.headers.get('Authorization')! } } }\n        )\n\n        const { action, ...rest } = await req.json()\n        logger.info('Processing action', { action })\n        let result\n\n        if (action === 'get_reports') {\n            // Aggregate data for reports\n            const { data: reviews } = await supabaseClient\n                .from('reviews')\n                .select('overall_rating, status')\n            const { data: goals } = await supabaseClient\n                .from('goals')\n                .select('status, progress_percentage')\n            const { data: kpiValues } = await supabaseClient\n                .from('kpi_values')\n                .select('value')\n\n            // Rating distribution\n            const ratingDistribution = [\n                { name: '1.0-2.0', count: reviews?.filter((r: any) => r.overall_rating >= 1 && r.overall_rating < 2).length || 0 },\n                { name: '2.1-3.0', count: reviews?.filter((r: any) => r.overall_rating >= 2 && r.overall_rating < 3).length || 0 },\n                { name: '3.1-4.0', count: reviews?.filter((r: any) => r.overall_rating >= 3 && r.overall_rating < 4).length || 0 },\n                { name: '4.1-5.0', count: reviews?.filter((r: any) => r.overall_rating >= 4 && r.overall_rating <= 5).length || 0 },\n            ]\n\n            // Goal status distribution\n            const goalStatus = [\n                { name: 'Active', value: goals?.filter((g: any) => g.status === 'active').length || 0 },\n                { name: 'Completed', value: goals?.filter((g: any) => g.status === 'completed').length || 0 },\n                { name: 'At Risk', value: goals?.filter((g: any) => g.status === 'at_risk').length || 0 },\n            ]\n\n            const avgKPI = kpiValues && kpiValues.length > 0\n                ? kpiValues.reduce((sum: any, kpi: any) => sum + (kpi.value || 0), 0) / kpiValues.length\n                : 0\n\n            result = {\n                ratingDistribution,\n                goalStatus,\n                totalReviews: reviews?.length || 0,\n                totalGoals: goals?.length || 0,\n                avgKPI: Math.round(avgKPI)\n            }\n\n        } else if (action === 'list') {\n            const { entity, filters } = rest;\n\n            // Simple select without joins to avoid missing table errors\n            let query = supabaseClient.from(entity).select('*')\n\n            if (filters) {\n                Object.entries(filters).forEach(([key, value]) => {\n                    query = query.eq(key, value)\n                })\n            }\n\n            const { data, error } = await query\n            if (error) throw error\n            result = data\n\n        } else if (action === 'generate_sample_data') {\n            return await logger.timeAsync('generate_sample_data', async () => {\n                // Use Service Role Key to bypass RLS for data generation\n                const adminClient = createClient(\n                    Deno.env.get('SUPABASE_URL') ?? '',\n                    Deno.env.get('SUPABASE_SERVICE_ROLE_KEY') ?? ''\n                )\n\n                // Get employees\n                const { data: employees } = await adminClient.from('employees').select('id').limit(5)\n\n                if (!employees || employees.length === 0) {\n                    throw new Error('No employees found. Please add employees first.')\n                }\n\n                // Create sample reviews\n                const reviewPromises = employees.map(async (emp: any, idx: number) => {\n                    return adminClient.from('reviews').insert({\n                        employee_id: emp.id,\n                        review_period_start: '2023-01-01',\n                        review_period_end: '2023-12-31',\n                        review_due_date: '2024-01-15',\n                        status: 'completed',\n                        overall_rating: 3 + Math.random() * 2 // 3.0 to 5.0\n                    })\n                })\n\n                // Create sample goals (3 per employee)\n                const goalPromises = employees.flatMap((emp: any) => {\n                    return [\n                        adminClient.from('goals').insert({\n                            employee_id: emp.id,\n                            title: 'Quarterly Revenue Target',\n                            description: 'Achieve quarterly sales targets',\n                            goal_type: 'business',\n                            target_date: '2024-03-31',\n                            status: ['active', 'completed', 'at_risk'][Math.floor(Math.random() * 3)],\n                            progress_percentage: Math.floor(Math.random() * 100),\n                            priority: ['high', 'medium', 'low'][Math.floor(Math.random() * 3)]\n                        }),\n                        adminClient.from('goals').insert({\n                            employee_id: emp.id,\n                            title: 'Professional Development',\n                            description: 'Complete certification course',\n                            goal_type: 'development',\n                            target_date: '2024-06-30',\n                            status: ['active', 'completed', 'at_risk'][Math.floor(Math.random() * 3)],\n                            progress_percentage: Math.floor(Math.random() * 100),\n                            priority: ['high', 'medium', 'low'][Math.floor(Math.random() * 3)]\n                        }),\n                        adminClient.from('goals').insert({\n                            employee_id: emp.id,\n                            title: 'Team Collaboration',\n                            description: 'Improve cross-team communication',\n                            goal_type: 'personal',\n                            target_date: '2024-12-31',\n                            status: ['active', 'completed', 'at_risk'][Math.floor(Math.random() * 3)],\n                            progress_percentage: Math.floor(Math.random() * 100),\n                            priority: ['high', 'medium', 'low'][Math.floor(Math.random() * 3)]\n                        })\n                    ]\n                })\n\n                await Promise.all([...reviewPromises, ...goalPromises])\n\n                // Note: kpi_values intentionally not generated here\n                // as they would require kpi_definitions to exist first.\n                // The charts mainly use reviews and goals.\n\n                const sampleResult = { success: true, message: 'Sample data generated' }\n                logger.info('Sample data generated successfully')\n                return new Response(JSON.stringify(sampleResult), {\n                    headers: { ...corsHeaders, 'Content-Type': 'application/json' },\n                    status: 200,\n                })\n            });\n\n        } else if (action === 'create') {\n            // ... implementation for create\n        }\n\n        return new Response(JSON.stringify(result), {\n            headers: { ...corsHeaders, 'Content-Type': 'application/json' },\n            status: 200,\n        })\n    } catch (error: any) {\n        logger.error('Request failed', error)\n        return new Response(JSON.stringify({ error: error?.message || String(error) }), {\n            headers: { ...corsHeaders, 'Content-Type': 'application/json' },\n            status: 400,\n        })\n    }\n})\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/performance-crud/index.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'totalReviews' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":32,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'totalGoals' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":44,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'goalsError' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":44,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":57},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'kpis' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":53,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":53,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { serve } from \"https://deno.land/std@0.168.0/http/server.ts\"\nimport { createClient } from 'https://esm.sh/@supabase/supabase-js@2'\nimport { createLogger } from '../_shared/logger.ts'\n\nconst corsHeaders = {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',\n}\n\nserve(async (req) => {\n    const logger = createLogger(req);\n\n    if (req.method === 'OPTIONS') {\n        return new Response('ok', { headers: corsHeaders })\n    }\n\n    logger.info('Request received');\n\n    try {\n        const supabaseClient = createClient(\n            Deno.env.get('SUPABASE_URL') ?? '',\n            Deno.env.get('SUPABASE_ANON_KEY') ?? '',\n            { global: { headers: { Authorization: req.headers.get('Authorization')! } } }\n        )\n\n        const { action, ...rest } = await req.json()\n        logger.info('Processing action', { action })\n        let result\n\n        if (action === 'get_reports') {\n            // 1. Fetch Reviews\n            const { count: totalReviews, error: reviewsError } = await supabaseClient\n                .from('reviews')\n                .select('*', { count: 'exact', head: true })\n\n            if (reviewsError) {\n                // If table doesn't exist, it might throw error. Handle gracefully?\n                // For now, just throw.\n                console.error(\"Error fetching reviews:\", reviewsError)\n                // throw reviewsError // Don't throw, just return 0?\n            }\n\n            // 2. Fetch Goals\n            const { count: totalGoals, error: goalsError } = await supabaseClient\n                .from('goals')\n                .select('*', { count: 'exact', head: true })\n\n            // ... rest of get_reports ...\n            // I need to be careful not to delete the rest of the file.\n            // I will just replace the top part.\n            const { data: reviews } = await supabaseClient.from('reviews').select('overall_rating, status, department')\n            const { data: goals } = await supabaseClient.from('goals').select('status, priority')\n            const { data: kpis } = await supabaseClient.from('kpi_values').select('actual_value, target_value, period_end')\n\n            // Process Reviews Distribution\n            const ratingDistribution = [\n                { name: '1.0-2.0', count: 0 },\n                { name: '2.1-3.0', count: 0 },\n                { name: '3.1-4.0', count: 0 },\n                { name: '4.1-5.0', count: 0 },\n            ]\n\n            reviews?.forEach((r: any) => {\n                if (r.overall_rating) {\n                    if (r.overall_rating <= 2.0) ratingDistribution[0].count++\n                    else if (r.overall_rating <= 3.0) ratingDistribution[1].count++\n                    else if (r.overall_rating <= 4.0) ratingDistribution[2].count++\n                    else ratingDistribution[3].count++\n                }\n            })\n\n            // Process Goal Status\n            const goalStatus = [\n                { name: 'Active', value: 0 },\n                { name: 'Completed', value: 0 },\n                { name: 'At Risk', value: 0 },\n            ]\n\n            goals?.forEach((g: any) => {\n                if (g.status === 'completed' || g.status === 'achieved') goalStatus[1].value++\n                else if (g.status === 'at_risk' || g.status === 'not_achieved') goalStatus[2].value++\n                else goalStatus[0].value++\n            })\n\n            result = {\n                ratingDistribution,\n                goalStatus,\n                totalReviews: reviews?.length || 0,\n                totalGoals: goals?.length || 0,\n                avgKPI: 85 // Placeholder calculation\n            }\n\n        } else if (action === 'list') {\n            const { entity, filters } = rest;\n\n            // Simple select without joins to avoid missing table errors\n            let query = supabaseClient.from(entity).select('*')\n\n            if (filters) {\n                Object.entries(filters).forEach(([key, value]) => {\n                    query = query.eq(key, value)\n                })\n            }\n\n            const { data, error } = await query\n            if (error) throw error\n            result = data\n\n        } else if (action === 'generate_sample_data') {\n            return await logger.timeAsync('generate_sample_data', async () => {\n                // Use Service Role Key to bypass RLS for data generation\n                const adminClient = createClient(\n                    Deno.env.get('SUPABASE_URL') ?? '',\n                    Deno.env.get('SUPABASE_SERVICE_ROLE_KEY') ?? ''\n                )\n\n                // 1. Get or Create Employees\n                let { data: employees } = await adminClient.from('employees').select('id')\n\n                if (!employees || employees.length === 0) {\n                    const { data: newEmployees } = await adminClient.from('employees').insert([\n                        { first_name: 'John', last_name: 'Doe', email: 'john@example.com', department: 'Engineering', position: 'Developer', status: 'active', hire_date: '2023-01-01' },\n                        { first_name: 'Jane', last_name: 'Smith', email: 'jane@example.com', department: 'Sales', position: 'Manager', status: 'active', hire_date: '2023-02-01' },\n                        { first_name: 'Bob', last_name: 'Johnson', email: 'bob@example.com', department: 'Marketing', position: 'Specialist', status: 'active', hire_date: '2023-03-01' },\n                        { first_name: 'Alice', last_name: 'Williams', email: 'alice@example.com', department: 'HR', position: 'Coordinator', status: 'active', hire_date: '2023-04-01' },\n                        { first_name: 'Charlie', last_name: 'Brown', email: 'charlie@example.com', department: 'Engineering', position: 'Senior Developer', status: 'active', hire_date: '2022-01-01' },\n                    ]).select('id')\n                    employees = newEmployees\n                }\n\n                if (employees && employees.length > 0) {\n                    // 2. Generate Reviews\n                    const reviews = employees.map((emp: any) => ({\n                        employee_id: emp.id,\n                        reviewer_id: employees![0].id,\n                        review_period_start: '2023-01-01',\n                        review_period_end: '2023-12-31',\n                        status: 'completed',\n                        overall_rating: (Math.random() * 2 + 3).toFixed(1),\n                        department: ['Engineering', 'Sales', 'Marketing', 'HR'][Math.floor(Math.random() * 4)]\n                    }))\n                    const { error: reviewsError } = await adminClient.from('reviews').insert(reviews)\n                    if (reviewsError) throw reviewsError\n\n                    // 3. Generate Goals\n                    const goals = []\n                    const statuses = ['active', 'completed', 'at_risk', 'not_achieved']\n                    for (const emp of employees) {\n                        for (let i = 0; i < 3; i++) {\n                            goals.push({\n                                employee_id: emp.id,\n                                title: `Goal ${i + 1} for Employee`,\n                                description: 'Sample goal description',\n                                status: statuses[Math.floor(Math.random() * statuses.length)],\n                                progress: Math.floor(Math.random() * 100),\n                                due_date: '2023-12-31',\n                                priority: ['high', 'medium', 'low'][Math.floor(Math.random() * 3)]\n                            })\n                        }\n                    }\n                    const { error: goalsError } = await adminClient.from('goals').insert(goals)\n                    if (goalsError) throw goalsError\n\n                    // 4. Generate KPI Values\n                    const kpis = []\n                    for (const emp of employees) {\n                        kpis.push({\n                            employee_id: emp.id,\n                            kpi_id: 'uuid-placeholder', // Ideally we'd fetch real KPI definitions, but for now we might skip or need to create them too. \n                            // Let's skip KPI linking for now and just insert if we had a table, but since we might not have KPI definitions, let's just stick to Reviews and Goals which drive the charts.\n                            // Actually, the charts use 'kpi_values'. Let's create a dummy KPI definition first if needed.\n                        })\n                    }\n                    // Skipping KPI generation for simplicity as it requires more relational setup. \n                    // The charts mainly use reviews and goals.\n                }\n\n                const sampleResult = { success: true, message: 'Sample data generated' }\n                logger.info('Sample data generated successfully')\n                return new Response(JSON.stringify(sampleResult), {\n                    headers: { ...corsHeaders, 'Content-Type': 'application/json' },\n                    status: 200,\n                })\n            });\n\n        } else if (action === 'create') {\n            // ... implementation for create\n            result = { success: true }\n        } else if (action === 'auto_schedule') {\n            // Placeholder for auto-schedule logic\n            // In a real implementation, this would find employees without reviews for the current period\n            // and create them based on active review types.\n            result = { success: true, count: 0, message: \"Auto-scheduling logic placeholder executed.\" }\n        }\n\n        return new Response(JSON.stringify(result), {\n            headers: { ...corsHeaders, 'Content-Type': 'application/json' },\n            status: 200,\n        })\n    } catch (error: any) {\n        logger.error('Request failed', error)\n        return new Response(JSON.stringify({ error: error?.message || String(error) }), {\n            headers: { ...corsHeaders, 'Content-Type': 'application/json' },\n            status: 400,\n        })\n    }\n})\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/populate-messaging-sample-data/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/process-leave-request/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/reference-management/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/schema-setup/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/send-email/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/send-interview-invite/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/send-welcome-email/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/supabase/functions/sync-to-careflow/index.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'errors' is never reassigned. Use 'const' instead.","line":62,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":62,"endColumn":29,"fix":{"range":[2021,2046],"text":"const errors: string[] = []"}}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"// @ts-nocheck\nimport { createClient } from 'https://esm.sh/@supabase/supabase-js@2'\n\nconst corsHeaders = {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type, cache-control, pragma, accept, dnt, expires, x-requested-with',\n    'Access-Control-Allow-Methods': 'POST, GET, OPTIONS',\n}\n\ninterface SyncRequest {\n    employee_id: string;\n    tenant_id: string;\n    action: 'sync' | 'sync_all';\n}\n\nDeno.serve(async (req) => {\n    // Handle CORS\n    if (req.method === 'OPTIONS') {\n        return new Response('ok', {\n            headers: {\n                ...corsHeaders,\n                'Access-Control-Allow-Headers': req.headers.get('Access-Control-Request-Headers') ?? corsHeaders['Access-Control-Allow-Headers'],\n            }\n        })\n    }\n\n    try {\n        const supabaseClient = createClient(\n            Deno.env.get('SUPABASE_URL') ?? '',\n            Deno.env.get('SUPABASE_SERVICE_ROLE_KEY') ?? ''\n        )\n\n        const { employee_id, tenant_id, action } = await req.json() as SyncRequest\n\n        // Verify the request has proper authorization\n        const authHeader = req.headers.get('Authorization')\n        if (!authHeader) {\n            throw new Error('No authorization header')\n        }\n\n        const token = authHeader.replace('Bearer ', '')\n        const { data: { user }, error: authError } = await supabaseClient.auth.getUser(token)\n\n        if (authError || !user) {\n            throw new Error('Unauthorized')\n        }\n\n        // Verify user has access to this tenant\n        const { data: membership } = await supabaseClient\n            .from('user_tenant_memberships')\n            .select('role')\n            .eq('user_id', user.id)\n            .eq('tenant_id', tenant_id)\n            .eq('is_active', true)\n            .single()\n\n        if (!membership || !['owner', 'admin'].includes(membership.role)) {\n            throw new Error('Insufficient permissions')\n        }\n\n        let syncedCount = 0\n        let errors: string[] = []\n\n        if (action === 'sync_all') {\n            // Sync all active employees\n            const { data: employees, error: fetchError } = await supabaseClient\n                .from('employees')\n                .select('*')\n                .eq('tenant_id', tenant_id)\n                .eq('status', 'active')\n\n            if (fetchError) throw fetchError\n\n            for (const employee of employees || []) {\n                try {\n                    await syncEmployee(supabaseClient, employee, tenant_id)\n                    syncedCount++\n                } catch (e: any) {\n                    errors.push(`${employee.full_name}: ${e.message}`)\n                }\n            }\n        } else {\n            // Sync single employee\n            const { data: employee, error: fetchError } = await supabaseClient\n                .from('employees')\n                .select('*')\n                .eq('id', employee_id)\n                .eq('tenant_id', tenant_id)\n                .single()\n\n            if (fetchError) throw fetchError\n\n            await syncEmployee(supabaseClient, employee, tenant_id)\n            syncedCount = 1\n        }\n\n        return new Response(\n            JSON.stringify({\n                success: true,\n                synced_count: syncedCount,\n                errors: errors.length > 0 ? errors : undefined,\n                message: `Successfully synced ${syncedCount} employee(s) to CareFlow`\n            }),\n            {\n                headers: { ...corsHeaders, 'Content-Type': 'application/json' },\n                status: 200\n            }\n        )\n\n    } catch (error: any) {\n        console.error('Sync error:', error)\n        return new Response(\n            JSON.stringify({\n                success: false,\n                error: error.message\n            }),\n            {\n                headers: { ...corsHeaders, 'Content-Type': 'application/json' },\n                status: 400\n            }\n        )\n    }\n})\n\nasync function syncEmployee(supabase: any, employee: any, tenantId: string) {\n    // Check if employee already exists in CareFlow staff table\n    const { data: existing } = await supabase\n        .from('careflow_staff')\n        .select('id')\n        .eq('novumflow_employee_id', employee.id)\n        .eq('tenant_id', tenantId)\n        .maybeSingle()\n\n    const staffData = {\n        tenant_id: tenantId,\n        novumflow_employee_id: employee.id,\n        full_name: `${employee.first_name} ${employee.last_name}`,\n        email: employee.email,\n        phone: employee.phone,\n        role: mapRole(employee.position),\n        status: employee.status === 'active' ? 'Active' : 'Inactive',\n        department: employee.department,\n        start_date: employee.hire_date,\n        // Compliance fields will be synced separately\n        updated_at: new Date().toISOString()\n    }\n\n    if (existing) {\n        // Update existing record\n        const { error } = await supabase\n            .from('careflow_staff')\n            .update(staffData)\n            .eq('id', existing.id)\n\n        if (error) throw error\n    } else {\n        // Insert new record\n        const { error } = await supabase\n            .from('careflow_staff')\n            .insert({\n                ...staffData,\n                created_at: new Date().toISOString()\n            })\n\n        if (error) throw error\n    }\n\n    // Sync compliance documents\n    await syncCompliance(supabase, employee.id, tenantId)\n}\n\nasync function syncCompliance(supabase: any, employeeId: string, tenantId: string) {\n    // Get compliance records from NovumFlow\n    const { data: compliance } = await supabase\n        .from('compliance_records')\n        .select('*')\n        .eq('employee_id', employeeId)\n        .eq('tenant_id', tenantId)\n\n    if (!compliance || compliance.length === 0) return\n\n    // Get the CareFlow staff record\n    const { data: staff } = await supabase\n        .from('careflow_staff')\n        .select('id')\n        .eq('novumflow_employee_id', employeeId)\n        .eq('tenant_id', tenantId)\n        .single()\n\n    if (!staff) return\n\n    for (const record of compliance) {\n        // Map and upsert compliance records\n        const complianceData = {\n            staff_id: staff.id,\n            tenant_id: tenantId,\n            type: mapComplianceType(record.document_type),\n            status: record.status,\n            issue_date: record.issue_date,\n            expiry_date: record.expiry_date,\n            document_url: record.document_url,\n            verified_by: record.verified_by,\n            novumflow_record_id: record.id,\n            updated_at: new Date().toISOString()\n        }\n\n        const { data: existingCompliance } = await supabase\n            .from('careflow_compliance')\n            .select('id')\n            .eq('novumflow_record_id', record.id)\n            .maybeSingle()\n\n        if (existingCompliance) {\n            await supabase\n                .from('careflow_compliance')\n                .update(complianceData)\n                .eq('id', existingCompliance.id)\n        } else {\n            await supabase\n                .from('careflow_compliance')\n                .insert({ ...complianceData, created_at: new Date().toISOString() })\n        }\n    }\n}\n\nfunction mapRole(position: string): string {\n    const positionLower = position?.toLowerCase() || ''\n\n    if (positionLower.includes('manager') || positionLower.includes('director')) {\n        return 'Admin'\n    }\n    if (positionLower.includes('nurse') || positionLower.includes('carer') || positionLower.includes('support')) {\n        return 'Carer'\n    }\n    return 'Carer' // Default\n}\n\nfunction mapComplianceType(type: string): string {\n    const typeMap: Record<string, string> = {\n        'right_to_work': 'Right to Work',\n        'dbs_check': 'DBS Check',\n        'dbs': 'DBS Check',\n        'training': 'Training',\n        'certificate': 'Certificate',\n        'id_verification': 'ID Verification',\n    }\n    return typeMap[type?.toLowerCase()] || type\n}\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/tailwind.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/test_job_status.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/test_tenant_update.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/tests/example.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/tests/recruitment_flow.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'path' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { test, expect } from '@playwright/test';\nimport path from 'path';\n\ntest.describe('Recruitment Flow', () => {\n    test.beforeEach(async ({ page }) => {\n        page.on('console', msg => console.log(`BROWSER LOG: ${msg.text()}`));\n        page.on('request', request => {\n            if (request.url().includes('supabase.co')) {\n                console.log('SUPABASE REQUEST:', request.url());\n            }\n        });\n    });\n\n    test('Full Recruitment Lifecycle', async ({ page }) => {\n        const timestamp = Date.now();\n        const jobTitle = `E2E Test Job ${timestamp}`;\n        const applicantFirstName = 'E2E';\n        const applicantLastName = `Candidate ${timestamp}`;\n        const applicantEmail = `e2e.candidate.${timestamp}@example.com`;\n\n        // 1. Login via UI\n        await page.goto('https://bgffggjfgcfnjgcj.vercel.app/login');\n        await page.getByLabel('Email').fill('mrsonirie@gmail.com');\n        await page.getByLabel('Password').fill('phoneBobby1?');\n        await page.getByRole('button', { name: 'Sign in' }).click();\n\n        // Wait for dashboard or redirection\n        await expect(page.getByRole('link', { name: 'Dashboard', exact: true })).toBeVisible({ timeout: 15000 });\n\n        // 2. Post a Job\n        await page.goto('https://bgffggjfgcfnjgcj.vercel.app/recruitment');\n\n        // Wait for button and click\n        const newJobButton = page.getByRole('button', { name: 'New Job Posting' });\n        await expect(newJobButton).toBeVisible();\n        await newJobButton.click();\n\n        // Wait for modal title (heading)\n        await expect(page.getByRole('heading', { name: 'Create Job Posting' })).toBeVisible({ timeout: 10000 });\n\n        // Wait for form field\n        await expect(page.getByRole('heading', { name: 'Create Job Posting' })).toBeVisible();\n\n        // Use locators based on labels since inputs don't have IDs\n        await page.locator('div').filter({ hasText: /^Job Title \\*$/ }).locator('input').fill(jobTitle);\n        await page.locator('div').filter({ hasText: /^Department \\*$/ }).locator('input').fill('Engineering');\n        await page.locator('div').filter({ hasText: /^Location$/ }).locator('input').fill('Remote');\n        await page.locator('div').filter({ hasText: /^Salary Range Min$/ }).locator('input').fill('50000');\n        await page.locator('div').filter({ hasText: /^Salary Range Max$/ }).locator('input').fill('80000');\n\n        // Set deadline to tomorrow\n        const tomorrow = new Date();\n        tomorrow.setDate(tomorrow.getDate() + 1);\n        const deadlineStr = tomorrow.toISOString().split('T')[0];\n        await page.locator('div').filter({ hasText: /^Application Deadline$/ }).locator('input').fill(deadlineStr);\n\n        await page.locator('div').filter({ hasText: /^Job Description \\*$/ }).locator('textarea').fill('This is an automated test job posting.');\n        await page.locator('div').filter({ hasText: /^Requirements \\*$/ }).locator('textarea').fill('Playwright\\nTypeScript\\nAutomation');\n\n        // Select status as Active (Published)\n        await page.locator('div').filter({ hasText: 'Status' }).last().locator('select').selectOption('active');\n\n        await page.getByRole('button', { name: 'Create Job Posting' }).click();\n\n        // Verify job is listed\n        await expect(page.getByText(jobTitle)).toBeVisible();\n\n        // 2. Apply for the Job (Simulating via Admin \"Add Application\")\n        await page.getByRole('button', { name: 'Applications' }).click();\n        await page.getByRole('button', { name: 'Add Application' }).click();\n\n        // Wait for application modal to be visible\n        await expect(page.getByRole('heading', { name: 'Add New Application' })).toBeVisible({ timeout: 10000 });\n\n        // Select the job we just created (it will be the first option after \"No specific job\")\n        const jobOptions = await page.locator('div').filter({ hasText: 'Job Posting' }).last().locator('select option').allTextContents();\n        console.log('Available job options:', jobOptions);\n        const jobOption = jobOptions.find(opt => opt.includes(jobTitle));\n        console.log('Selected job option:', jobOption);\n        if (jobOption) {\n            await page.locator('div').filter({ hasText: 'Job Posting' }).last().locator('select').selectOption({ label: jobOption });\n            console.log('Job selected successfully');\n        } else {\n            console.log('ERROR: Could not find job option matching:', jobTitle);\n        }\n\n        // Fill Application Form\n        await page.locator('div').filter({ hasText: 'Position Applied For' }).last().locator('select').selectOption('Other');\n\n        await page.locator('div').filter({ hasText: 'First Name' }).last().locator('input').fill(applicantFirstName);\n        await page.locator('div').filter({ hasText: 'Last Name' }).last().locator('input').fill(applicantLastName);\n        await page.locator('div').filter({ hasText: 'Email' }).last().locator('input').fill(applicantEmail);\n\n        await page.getByRole('button', { name: 'Submit Application' }).click();\n\n        // Verify application is listed\n        await expect(page.getByText(`${applicantFirstName} ${applicantLastName}`)).toBeVisible();\n\n        // 3. Interview Process (Move through stages)\n        // Find the row with the applicant\n        const row = page.getByRole('row', { name: `${applicantFirstName} ${applicantLastName}` });\n\n        // Debug: Print row content\n        const rowText = await row.textContent();\n        console.log('ROW CONTENT:', rowText);\n\n        if (await row.getByText('No workflow').isVisible()) {\n            console.log('ERROR: Application has \"No workflow\"');\n        }\n\n        // Move to Screening\n        await row.getByRole('combobox').selectOption({ label: 'Screening' });\n        // Wait for update (optimistic UI might be fast, but let's wait a bit or verify)\n        await page.waitForTimeout(1000);\n\n        // Move to Interview\n        await row.getByRole('combobox').selectOption({ label: 'Interview' });\n        await page.waitForTimeout(1000);\n\n        // Move to Offer\n        await row.getByRole('combobox').selectOption({ label: 'Offer' });\n        await page.waitForTimeout(1000);\n\n        // Move to Hired\n        await row.getByRole('combobox').selectOption({ label: 'Hired' });\n        await page.waitForTimeout(1000);\n\n        // Verify Hired status\n        // The select should show 'Hired'\n        await expect(row.getByRole('combobox')).toHaveValue(/[0-9a-f-]{36}/); // Value is UUID, but label should be Hired.\n        // We can verify the selected option label\n        const selectedOption = await row.getByRole('combobox').evaluate((sel: HTMLSelectElement) => sel.options[sel.selectedIndex].text);\n        expect(selectedOption).toBe('Hired');\n    });\n});\n","usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/tests/recruitment_module.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]},{"filePath":"/Users/apple/Library/Mobile Documents/com~apple~CloudDocs/Projects/NovumFlow/novumflow1/hr-recruitment-platform/vitest.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"@typescript-eslint/no-empty-interface","replacedBy":["@typescript-eslint/no-empty-object-type"]}]}]
